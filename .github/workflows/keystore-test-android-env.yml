name: Configure Android Keystore for E2E Tests

on:
  push:

permissions:
  contents: write
  id-token: write

jobs:
  ios-e2e:
    runs-on: ubuntu-latest
    env:
      GITHUB_CI: "true"
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Keystores for iOS E2E Tests
        uses: MetaMask/github-tools/.github/actions/configure-keystore@e2e-env-actions-keystore
        with:
          aws-role-to-assume: 'arn:aws:iam::722264665990:role/metamask-mobile-build-signing-certificate-manager'
          aws-region: 'us-east-2'
          platform: 'android'
          environment: 'qa'

      - name: Check keystore file and contents
        shell: bash
        run: |
          echo "📁 Checking keystore file at: $ANDROID_KEYSTORE_PATH"
          if [[ ! -f "$ANDROID_KEYSTORE_PATH" ]]; then
            echo "❌ Keystore file not found"
            exit 1
          fi

          echo "🔐 Counting keystore entries..."
          alias_count=$(keytool -list \
            -keystore "$ANDROID_KEYSTORE_PATH" \
            -storepass "$BITRISEIO_ANDROID_QA_KEYSTORE_PASSWORD" \
            2>/dev/null | grep -c "Alias name")

          echo "✅ Keystore entry count: $alias_count"

