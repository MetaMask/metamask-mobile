name: Configure Android Keystore for E2E Tests

on:
  push:

permissions:
  contents: write
  id-token: write

jobs:
  ios-e2e:
    runs-on: ubuntu-latest
    env:
      GITHUB_CI: "true"
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Keystores for iOS E2E Tests
        uses: MetaMask/github-tools/.github/actions/configure-keystore@e2e-env-actions-keystore
        with:
          aws-role-to-assume: 'arn:aws:iam::722264665990:role/metamask-mobile-build-signing-certificate-manager'
          aws-region: 'us-east-2'
          platform: 'android'
          environment: 'qa'

      - name: Check keystore file and entry count
        shell: bash
        run: |
          echo "üìÅ Keystore path: ${ANDROID_KEYSTORE_PATH}"

          if [[ ! -s "$ANDROID_KEYSTORE_PATH" ]]; then
            echo "‚ùå Keystore file is missing or empty"
            exit 1
          fi

          echo "üîê Validating keystore..."
          keytool -list \
            -keystore "$ANDROID_KEYSTORE_PATH" \
            -storepass "$BITRISEIO_ANDROID_QA_KEYSTORE_PASSWORD" \
            > /tmp/keystore_output.txt 2>/tmp/keystore_error.txt || {
              echo "‚ùå keytool failed. Output:"
              cat /tmp/keystore_error.txt
              exit 1
            }

          alias_count=$(grep -c "Alias name" /tmp/keystore_output.txt)
          echo "‚úÖ Keystore entry count: $alias_count"


