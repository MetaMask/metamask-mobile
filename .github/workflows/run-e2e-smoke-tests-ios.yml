name: iOS E2E Smoke Tests

on:
  workflow_call:

permissions:
  contents: read
  id-token: write

jobs:
  confirmations-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: confirmations-ios-smoke
      platform: ios
      test_suite_tag: "SmokeConfirmations"
    secrets: inherit

  confirmations-redesigned-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: confirmations-redesigned-ios-smoke
      platform: ios
      test_suite_tag: "SmokeConfirmationsRedesigned"
    secrets: inherit

  trade-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: trade-ios-smoke
      platform: ios
      test_suite_tag: "SmokeTrade"
    secrets: inherit

  wallet-platform-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: wallet-platform-ios-smoke
      platform: ios
      test_suite_tag: "SmokeWalletPlatform"
    secrets: inherit

  identity-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: identity-ios-smoke
      platform: ios
      test_suite_tag: "SmokeIdentity"
    secrets: inherit

  accounts-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: accounts-ios-smoke
      platform: ios
      test_suite_tag: "SmokeAccounts"
    secrets: inherit

  network-abstraction-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: network-abstraction-ios-smoke
      platform: ios
      test_suite_tag: "SmokeNetworkAbstractions"
    secrets: inherit

  network-expansion-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: network-expansion-ios-smoke
      platform: ios
      test_suite_tag: "SmokeNetworkExpansion"
    secrets: inherit

  performance-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: performance-ios-smoke
      platform: ios
      test_suite_tag: "SmokePerformance"
    secrets: inherit

  card-ios-smoke:
    uses: ./.github/workflows/run-e2e-workflow.yml
    with:
      test-suite-name: card-ios-smoke
      platform: ios
      test_suite_tag: "SmokeCard"
    secrets: inherit

  report-ios-smoke-tests:
    name: Report iOS Smoke Tests
    runs-on: ubuntu-latest
    if: ${{ !cancelled() }}
    needs:
      - confirmations-ios-smoke
      - confirmations-redesigned-ios-smoke
      - trade-ios-smoke
      - wallet-platform-ios-smoke
      - identity-ios-smoke
      - accounts-ios-smoke
      - network-abstraction-ios-smoke
      - network-expansion-ios-smoke
      - performance-ios-smoke
      - card-ios-smoke

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Download all test results
        uses: actions/download-artifact@v4
        with:
          path: all-test-results/
          pattern: "*-ios-test-results"

      - name: Post Test Report
        uses: dorny/test-reporter@dc3a92680fcc15842eef52e8c4606ea7ce6bd3f3
        with:
          name: "iOS E2E Smoke Test Results"
          path: "all-test-results/**/*.xml"
          reporter: "jest-junit"
          fail-on-error: false
          list-suites: "failed"
          list-tests: "failed"

      - name: Upload merged report
        uses: actions/upload-artifact@v4
        with:
          name: ios-merged-test-report
          path: all-test-results/**/*.xml
