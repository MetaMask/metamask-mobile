name: Stable Branch Sync

permissions:
  pull-requests: write
  contents: write
  issues: write

on:
  push:
    branches:
        - stable

jobs:
  get-next-version:
    name: Get next version vX.Y.Z
    runs-on: ubuntu-latest
    outputs:
      next-version: ${{ env.NEXT_SEMVER_VERSION }}
    steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            fetch-depth: 0

        - name: Configure Git
          run: |
            git config --global user.name "github-actions[bot]"
            git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

        - name: Get the next semver version
          id: get-next-semver-version
          env:
            FORCE_NEXT_SEMVER_VERSION: ${{ vars.FORCE_NEXT_SEMVER_VERSION }}
          run: ./get-next-semver-version.sh "$FORCE_NEXT_SEMVER_VERSION"
          working-directory: '.github/scripts'

  run-stable-sync:
    name: Run Stable branch sync
    runs-on: ubuntu-latest
    needs: get-next-version
    steps:
      - name: Run stable branch sync
        uses: MetaMask/github-tools/.github/actions/stable-sync@v1
        with:
          semver-version: ${{ needs.get-next-version.outputs.next-version }}
          repo-type: 'mobile'
          stable-branch-name: 'stable'
          github-token: ${{ secrets.STABLE_SYNC_TOKEN }}
