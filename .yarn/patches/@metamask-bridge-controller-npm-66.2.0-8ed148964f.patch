diff --git a/dist/bridge-controller.cjs b/dist/bridge-controller.cjs
index 6615343402dc3236ec434ef8ced172b5c91bb8dc..7c55e7384c4bfd3f6c43d0dbe66fc5976e6b6697 100644
--- a/dist/bridge-controller.cjs
+++ b/dist/bridge-controller.cjs
@@ -10,7 +10,7 @@ var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (
     if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
     return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
 };
-var _BridgeController_instances, _BridgeController_abortController, _BridgeController_quotesFirstFetched, _BridgeController_location, _BridgeController_clientId, _BridgeController_clientVersion, _BridgeController_getLayer1GasFee, _BridgeController_fetchFn, _BridgeController_trackMetaMetricsFn, _BridgeController_trace, _BridgeController_config, _BridgeController_trackResponseValidationFailures, _BridgeController_getExchangeRateSources, _BridgeController_fetchAssetExchangeRates, _BridgeController_hasInsufficientBalance, _BridgeController_shouldResetApproval, _BridgeController_fetchBridgeQuotes, _BridgeController_handleQuoteStreaming, _BridgeController_setMinimumBalanceForRentExemptionInLamports, _BridgeController_getMultichainSelectedAccount, _BridgeController_getNetworkClientByChainId, _BridgeController_getRequestMetadata, _BridgeController_getQuoteFetchData, _BridgeController_getEventProperties, _BridgeController_trackInputChangedEvents, _BridgeController_getUSDTMainnetAllowance;
+var _BridgeController_instances, _BridgeController_abortController, _BridgeController_quotesFirstFetched, _BridgeController_location, _BridgeController_clientId, _BridgeController_clientVersion, _BridgeController_getLayer1GasFee, _BridgeController_fetchFn, _BridgeController_trackMetaMetricsFn, _BridgeController_trace, _BridgeController_config, _BridgeController_trackResponseValidationFailures, _BridgeController_getExchangeRateSources, _BridgeController_fetchAssetExchangeRates, _BridgeController_hasInsufficientBalance, _BridgeController_shouldResetApproval, _BridgeController_fetchBridgeQuotes, _BridgeController_handleQuoteStreaming, _BridgeController_setMinimumBalanceForRentExemptionInLamports, _BridgeController_getMultichainSelectedAccount, _BridgeController_getNetworkClientByChainId, _BridgeController_getJwt, _BridgeController_getRequestMetadata, _BridgeController_getQuoteFetchData, _BridgeController_getEventProperties, _BridgeController_trackInputChangedEvents, _BridgeController_getUSDTMainnetAllowance;
 Object.defineProperty(exports, "__esModule", { value: true });
 exports.BridgeController = void 0;
 /* eslint-disable @typescript-eslint/explicit-function-return-type */
@@ -183,6 +183,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
          */
         this.fetchQuotes = async (quoteRequest, abortSignal = null, featureId = null) => {
             const bridgeFeatureFlags = (0, feature_flags_1.getBridgeFeatureFlags)(this.messenger);
+            const jwt = await __classPrivateFieldGet(this, _BridgeController_getJwt, "f").call(this);
             // If featureId is specified, retrieve the quoteRequestOverrides for that featureId
             const quoteRequestOverrides = featureId
                 ? bridgeFeatureFlags.quoteRequestOverrides?.[featureId]
@@ -191,7 +192,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
             // If quoteRequestOverrides is specified, merge it with the quoteRequest
             const { quotes: baseQuotes, validationFailures } = await (0, fetch_1.fetchBridgeQuotes)(quoteRequestOverrides
                 ? { ...quoteRequest, ...quoteRequestOverrides, resetApproval }
-                : { ...quoteRequest, resetApproval }, abortSignal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), __classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? bridge_1.BRIDGE_PROD_API_BASE_URL, featureId, __classPrivateFieldGet(this, _BridgeController_clientVersion, "f"));
+                : { ...quoteRequest, resetApproval }, abortSignal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), jwt, __classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? bridge_1.BRIDGE_PROD_API_BASE_URL, featureId, __classPrivateFieldGet(this, _BridgeController_clientVersion, "f"));
             __classPrivateFieldGet(this, _BridgeController_trackResponseValidationFailures, "f").call(this, validationFailures);
             const quotesWithFees = await (0, quote_fees_1.appendFeesToQuotes)(baseQuotes, this.messenger, __classPrivateFieldGet(this, _BridgeController_getLayer1GasFee, "f"), __classPrivateFieldGet(this, _BridgeController_instances, "m", _BridgeController_getMultichainSelectedAccount).call(this, quoteRequest.walletAddress));
             return (0, quote_1.sortQuotes)(quotesWithFees, featureId);
@@ -358,6 +359,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
                 state.quotesLastFetched = Date.now();
                 state.quotesLoadingStatus = types_1.RequestStatus.LOADING;
             });
+            const jwt = await __classPrivateFieldGet(this, _BridgeController_getJwt, "f").call(this);
             try {
                 await __classPrivateFieldGet(this, _BridgeController_trace, "f").call(this, {
                     name: (0, bridge_2.isCrossChain)(updatedQuoteRequest.srcChainId, updatedQuoteRequest.destChainId)
@@ -374,7 +376,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
                     __classPrivateFieldGet(this, _BridgeController_setMinimumBalanceForRentExemptionInLamports, "f").call(this, updatedQuoteRequest.srcChainId, selectedAccount?.metadata?.snap?.id);
                     // Use SSE if enabled and return early
                     if (shouldStream) {
-                        await __classPrivateFieldGet(this, _BridgeController_handleQuoteStreaming, "f").call(this, updatedQuoteRequest, selectedAccount);
+                        await __classPrivateFieldGet(this, _BridgeController_handleQuoteStreaming, "f").call(this, updatedQuoteRequest, jwt, selectedAccount);
                         return;
                     }
                     // Otherwise use regular fetch
@@ -441,7 +443,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
                 this.stopAllPolling();
             }
         });
-        _BridgeController_handleQuoteStreaming.set(this, async (updatedQuoteRequest, selectedAccount) => {
+        _BridgeController_handleQuoteStreaming.set(this, async (updatedQuoteRequest, jwt, selectedAccount) => {
             /**
              * Tracks the number of valid quotes received from the current stream, which is used
              * to determine when to clear the quotes list and set the initial load time
@@ -452,7 +454,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
              * before setting quotesLoadingStatus to FETCHED
              */
             const pendingFeeAppendPromises = new Set();
-            await (0, fetch_1.fetchBridgeQuoteStream)(__classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), updatedQuoteRequest, __classPrivateFieldGet(this, _BridgeController_abortController, "f")?.signal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? bridge_1.BRIDGE_PROD_API_BASE_URL, {
+            await (0, fetch_1.fetchBridgeQuoteStream)(__classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), updatedQuoteRequest, __classPrivateFieldGet(this, _BridgeController_abortController, "f")?.signal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), jwt, __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? bridge_1.BRIDGE_PROD_API_BASE_URL, {
                 onValidationFailure: __classPrivateFieldGet(this, _BridgeController_trackResponseValidationFailures, "f"),
                 onValidQuoteReceived: async (quote) => {
                     const feeAppendPromise = (async () => {
@@ -516,6 +518,16 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
                     minimumBalanceForRentExemptionInLamports;
             });
         });
+        _BridgeController_getJwt.set(this, async () => {
+            try {
+                const token = await this.messenger.call('AuthenticationController:getBearerToken');
+                return token;
+            }
+            catch (error) {
+                console.error('Error getting JWT token for bridge-api request', error);
+                return undefined;
+            }
+        });
         _BridgeController_getRequestMetadata.set(this, () => {
             return {
                 slippage_limit: this.state.quoteRequest.slippage,
@@ -683,7 +695,7 @@ class BridgeController extends (0, polling_controller_1.StaticIntervalPollingCon
     }
 }
 exports.BridgeController = BridgeController;
-_BridgeController_abortController = new WeakMap(), _BridgeController_quotesFirstFetched = new WeakMap(), _BridgeController_location = new WeakMap(), _BridgeController_clientId = new WeakMap(), _BridgeController_clientVersion = new WeakMap(), _BridgeController_getLayer1GasFee = new WeakMap(), _BridgeController_fetchFn = new WeakMap(), _BridgeController_trackMetaMetricsFn = new WeakMap(), _BridgeController_trace = new WeakMap(), _BridgeController_config = new WeakMap(), _BridgeController_trackResponseValidationFailures = new WeakMap(), _BridgeController_getExchangeRateSources = new WeakMap(), _BridgeController_fetchAssetExchangeRates = new WeakMap(), _BridgeController_hasInsufficientBalance = new WeakMap(), _BridgeController_shouldResetApproval = new WeakMap(), _BridgeController_fetchBridgeQuotes = new WeakMap(), _BridgeController_handleQuoteStreaming = new WeakMap(), _BridgeController_setMinimumBalanceForRentExemptionInLamports = new WeakMap(), _BridgeController_getRequestMetadata = new WeakMap(), _BridgeController_getQuoteFetchData = new WeakMap(), _BridgeController_getEventProperties = new WeakMap(), _BridgeController_trackInputChangedEvents = new WeakMap(), _BridgeController_getUSDTMainnetAllowance = new WeakMap(), _BridgeController_instances = new WeakSet(), _BridgeController_getMultichainSelectedAccount = function _BridgeController_getMultichainSelectedAccount(walletAddress) {
+_BridgeController_abortController = new WeakMap(), _BridgeController_quotesFirstFetched = new WeakMap(), _BridgeController_location = new WeakMap(), _BridgeController_clientId = new WeakMap(), _BridgeController_clientVersion = new WeakMap(), _BridgeController_getLayer1GasFee = new WeakMap(), _BridgeController_fetchFn = new WeakMap(), _BridgeController_trackMetaMetricsFn = new WeakMap(), _BridgeController_trace = new WeakMap(), _BridgeController_config = new WeakMap(), _BridgeController_trackResponseValidationFailures = new WeakMap(), _BridgeController_getExchangeRateSources = new WeakMap(), _BridgeController_fetchAssetExchangeRates = new WeakMap(), _BridgeController_hasInsufficientBalance = new WeakMap(), _BridgeController_shouldResetApproval = new WeakMap(), _BridgeController_fetchBridgeQuotes = new WeakMap(), _BridgeController_handleQuoteStreaming = new WeakMap(), _BridgeController_setMinimumBalanceForRentExemptionInLamports = new WeakMap(), _BridgeController_getJwt = new WeakMap(), _BridgeController_getRequestMetadata = new WeakMap(), _BridgeController_getQuoteFetchData = new WeakMap(), _BridgeController_getEventProperties = new WeakMap(), _BridgeController_trackInputChangedEvents = new WeakMap(), _BridgeController_getUSDTMainnetAllowance = new WeakMap(), _BridgeController_instances = new WeakSet(), _BridgeController_getMultichainSelectedAccount = function _BridgeController_getMultichainSelectedAccount(walletAddress) {
     const addressToUse = walletAddress ?? this.state.quoteRequest.walletAddress;
     if (!addressToUse) {
         throw new Error('Account address is required');
diff --git a/dist/bridge-controller.cjs.map b/dist/bridge-controller.cjs.map
index 11f26d8dfcf8d41cc2b457c76d50b620926af483..04b7e066020fb2adc1462a815c434b9121303aa1 100644
--- a/dist/bridge-controller.cjs.map
+++ b/dist/bridge-controller.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-controller.cjs","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { BigNumber } from '@ethersproject/bignumber';\nimport { Contract } from '@ethersproject/contracts';\nimport { Web3Provider } from '@ethersproject/providers';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport type { InternalAccount } from '@metamask/keyring-internal-api';\nimport { abiERC20 } from '@metamask/metamask-eth-abis';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport type { TransactionController } from '@metamask/transaction-controller';\nimport type { CaipAssetType, Hex } from '@metamask/utils';\n\nimport type { BridgeClientId } from './constants/bridge';\nimport {\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_PROD_API_BASE_URL,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_ETHEREUM_ADDRESS,\n  REFRESH_INTERVAL_MS,\n} from './constants/bridge';\nimport { CHAIN_IDS } from './constants/chains';\nimport { SWAPS_CONTRACT_ADDRESSES } from './constants/swaps';\nimport { TraceName } from './constants/traces';\nimport { selectIsAssetExchangeRateInState } from './selectors';\nimport { RequestStatus } from './types';\nimport type {\n  L1GasFees,\n  GenericQuoteRequest,\n  NonEvmFees,\n  QuoteRequest,\n  QuoteResponse,\n  BridgeControllerState,\n  BridgeControllerMessenger,\n  FetchFunction,\n} from './types';\nimport { getAssetIdsForToken, toExchangeRates } from './utils/assets';\nimport { hasSufficientBalance } from './utils/balance';\nimport {\n  getDefaultBridgeControllerState,\n  isCrossChain,\n  isEthUsdt,\n  isNonEvmChainId,\n  isSolanaChainId,\n} from './utils/bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToCaip,\n  formatChainIdToHex,\n} from './utils/caip-formatters';\nimport {\n  getBridgeFeatureFlags,\n  hasMinimumRequiredVersion,\n} from './utils/feature-flags';\nimport {\n  fetchAssetPrices,\n  fetchBridgeQuotes,\n  fetchBridgeQuoteStream,\n} from './utils/fetch';\nimport {\n  AbortReason,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  UnifiedSwapBridgeEventName,\n} from './utils/metrics/constants';\nimport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapTypeFromQuote,\n  isCustomSlippage,\n  isHardwareWallet,\n  toInputChangedPropertyKey,\n  toInputChangedPropertyValue,\n} from './utils/metrics/properties';\nimport type {\n  QuoteFetchData,\n  RequestMetadata,\n  RequiredEventContextFromClient,\n} from './utils/metrics/types';\nimport type { CrossChainSwapsEventProperties } from './utils/metrics/types';\nimport { isValidQuoteRequest, sortQuotes } from './utils/quote';\nimport { appendFeesToQuotes } from './utils/quote-fees';\nimport { getMinimumBalanceForRentExemptionInLamports } from './utils/snaps';\nimport type { FeatureId } from './utils/validators';\n\nconst metadata: StateMetadata<BridgeControllerState> = {\n  quoteRequest: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotes: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesInitialLoadTime: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLastFetched: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLoadingStatus: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quoteFetchError: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesRefreshCount: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  assetExchangeRates: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  minimumBalanceForRentExemptionInLamports: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/**\n * The input to start polling for the {@link BridgeController}\n *\n * @param updatedQuoteRequest - The updated quote request\n * @param context - The context contains properties that can't be populated by the\n * controller and need to be provided by the client for analytics\n */\ntype BridgePollingInput = {\n  updatedQuoteRequest: GenericQuoteRequest;\n  context: Pick<\n    RequiredEventContextFromClient,\n    UnifiedSwapBridgeEventName.QuotesError\n  >[UnifiedSwapBridgeEventName.QuotesError] &\n    Pick<\n      RequiredEventContextFromClient,\n      UnifiedSwapBridgeEventName.QuotesRequested\n    >[UnifiedSwapBridgeEventName.QuotesRequested];\n};\n\nexport class BridgeController extends StaticIntervalPollingController<BridgePollingInput>()<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState,\n  BridgeControllerMessenger\n> {\n  #abortController: AbortController | undefined;\n\n  #quotesFirstFetched: number | undefined;\n\n  /**\n   * Stores the location/entry point from which the user initiated the swap or bridge flow.\n   * Set via setLocation() before navigating to the swap/bridge flow.\n   * Used as default for all subsequent internal events.\n   */\n  #location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #clientVersion: string;\n\n  readonly #getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #trackMetaMetricsFn: <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    properties: CrossChainSwapsEventProperties<EventName>,\n  ) => void;\n\n  readonly #trace: TraceCallback;\n\n  readonly #config: {\n    customBridgeApiBaseUrl?: string;\n  };\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    clientVersion,\n    getLayer1GasFee,\n    fetchFn,\n    config,\n    trackMetaMetricsFn,\n    traceFn,\n  }: {\n    messenger: BridgeControllerMessenger;\n    state?: Partial<BridgeControllerState>;\n    clientId: BridgeClientId;\n    clientVersion: string;\n    getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n    fetchFn: FetchFunction;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    trackMetaMetricsFn: <\n      EventName extends\n        (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n    >(\n      eventName: EventName,\n      properties: CrossChainSwapsEventProperties<EventName>,\n    ) => void;\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      state: {\n        ...getDefaultBridgeControllerState(),\n        ...state,\n      },\n    });\n\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.#abortController = new AbortController();\n    this.#getLayer1GasFee = getLayer1GasFee;\n    this.#clientId = clientId;\n    this.#clientVersion = clientVersion;\n    this.#fetchFn = fetchFn;\n    this.#trackMetaMetricsFn = trackMetaMetricsFn;\n    this.#config = config ?? {};\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,\n      this.setChainIntervalLength.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,\n      this.updateBridgeQuoteRequestParams.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,\n      this.trackUnifiedSwapBridgeEvent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,\n      this.stopPollingForQuotes.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:fetchQuotes`,\n      this.fetchQuotes.bind(this),\n    );\n  }\n\n  _executePoll = async (pollingInput: BridgePollingInput) => {\n    await this.#fetchBridgeQuotes(pollingInput);\n  };\n\n  updateBridgeQuoteRequestParams = async (\n    paramsToUpdate: Partial<GenericQuoteRequest> & {\n      walletAddress: GenericQuoteRequest['walletAddress'];\n    },\n    context: BridgePollingInput['context'],\n  ) => {\n    this.#trackInputChangedEvents(paramsToUpdate);\n    this.resetState(AbortReason.QuoteRequestUpdated);\n    const updatedQuoteRequest = {\n      ...DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,\n      ...paramsToUpdate,\n    };\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n    });\n\n    if (isValidQuoteRequest(updatedQuoteRequest)) {\n      this.#quotesFirstFetched = Date.now();\n      const isSrcChainNonEVM = isNonEvmChainId(updatedQuoteRequest.srcChainId);\n      const providerConfig = isSrcChainNonEVM\n        ? undefined\n        : this.#getNetworkClientByChainId(\n            formatChainIdToHex(updatedQuoteRequest.srcChainId),\n          )?.configuration;\n\n      let insufficientBal: boolean | undefined;\n      let resetApproval: boolean = Boolean(paramsToUpdate.resetApproval);\n      if (isSrcChainNonEVM) {\n        // If the source chain is not an EVM network, use value from params\n        insufficientBal = paramsToUpdate.insufficientBal;\n      } else if (providerConfig?.rpcUrl?.includes('tenderly')) {\n        // If the rpcUrl is a tenderly fork (e2e tests), set insufficientBal=true\n        // The bridge-api filters out quotes if the balance on mainnet is insufficient so this override allows quotes to always be returned\n        insufficientBal = true;\n      } else {\n        // Set loading status if RPC calls are made before the quotes are fetched\n        this.update((state) => {\n          state.quotesLoadingStatus = RequestStatus.LOADING;\n        });\n        resetApproval = await this.#shouldResetApproval(updatedQuoteRequest);\n        // Otherwise query the src token balance from the RPC provider\n        insufficientBal =\n          paramsToUpdate.insufficientBal ??\n          (await this.#hasInsufficientBalance(updatedQuoteRequest));\n      }\n\n      // Set refresh rate based on the source chain before starting polling\n      this.setChainIntervalLength();\n      this.startPolling({\n        updatedQuoteRequest: {\n          ...updatedQuoteRequest,\n          insufficientBal,\n          resetApproval,\n        },\n        context,\n      });\n    }\n  };\n\n  /**\n   * Fetches quotes for specified request without updating the controller state\n   * This method does not start polling for quotes and does not emit UnifiedSwapBridge events\n   *\n   * @param quoteRequest - The parameters for quote requests to fetch\n   * @param abortSignal - The abort signal to cancel all the requests\n   * @param featureId - The feature ID that maps to quoteParam overrides from LD\n   * @returns A list of validated quotes\n   */\n  fetchQuotes = async (\n    quoteRequest: GenericQuoteRequest,\n    abortSignal: AbortSignal | null = null,\n    featureId: FeatureId | null = null,\n  ): Promise<(QuoteResponse & L1GasFees & NonEvmFees)[]> => {\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n    // If featureId is specified, retrieve the quoteRequestOverrides for that featureId\n    const quoteRequestOverrides = featureId\n      ? bridgeFeatureFlags.quoteRequestOverrides?.[featureId]\n      : undefined;\n    const resetApproval = await this.#shouldResetApproval(quoteRequest);\n\n    // If quoteRequestOverrides is specified, merge it with the quoteRequest\n    const { quotes: baseQuotes, validationFailures } = await fetchBridgeQuotes(\n      quoteRequestOverrides\n        ? { ...quoteRequest, ...quoteRequestOverrides, resetApproval }\n        : { ...quoteRequest, resetApproval },\n      abortSignal,\n      this.#clientId,\n      this.#fetchFn,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      featureId,\n      this.#clientVersion,\n    );\n\n    this.#trackResponseValidationFailures(validationFailures);\n\n    const quotesWithFees = await appendFeesToQuotes(\n      baseQuotes,\n      this.messenger,\n      this.#getLayer1GasFee,\n      this.#getMultichainSelectedAccount(quoteRequest.walletAddress),\n    );\n\n    return sortQuotes(quotesWithFees, featureId);\n  };\n\n  readonly #trackResponseValidationFailures = (\n    validationFailures: string[],\n  ) => {\n    if (validationFailures.length === 0) {\n      return;\n    }\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesValidationFailed,\n      {\n        failures: validationFailures,\n        location: this.#location,\n      },\n    );\n  };\n\n  readonly #getExchangeRateSources = () => {\n    return {\n      ...this.messenger.call('MultichainAssetsRatesController:getState'),\n      ...this.messenger.call('CurrencyRateController:getState'),\n      ...this.messenger.call('TokenRatesController:getState'),\n      ...this.state,\n    };\n  };\n\n  /**\n   * Fetches the exchange rates for the assets in the quote request if they are not already in the state\n   * In addition to the selected tokens, this also fetches the native asset for the source and destination chains\n   *\n   * @param quoteRequest - The quote request\n   * @param quoteRequest.srcChainId - The source chain ID\n   * @param quoteRequest.srcTokenAddress - The source token address\n   * @param quoteRequest.destChainId - The destination chain ID\n   * @param quoteRequest.destTokenAddress - The destination token address\n   */\n  readonly #fetchAssetExchangeRates = async ({\n    srcChainId,\n    srcTokenAddress,\n    destChainId,\n    destTokenAddress,\n  }: Partial<GenericQuoteRequest>) => {\n    const assetIds: Set<CaipAssetType> = new Set([]);\n    const exchangeRateSources = this.#getExchangeRateSources();\n    if (\n      srcTokenAddress &&\n      srcChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        srcChainId,\n        srcTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(srcTokenAddress, srcChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n    if (\n      destTokenAddress &&\n      destChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        destChainId,\n        destTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(destTokenAddress, destChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n\n    const currency = this.messenger.call(\n      'CurrencyRateController:getState',\n    ).currentCurrency;\n\n    if (assetIds.size === 0) {\n      return;\n    }\n\n    const pricesByAssetId = await fetchAssetPrices({\n      assetIds,\n      currencies: new Set([currency]),\n      clientId: this.#clientId,\n      clientVersion: this.#clientVersion,\n      fetchFn: this.#fetchFn,\n      signal: this.#abortController?.signal,\n    });\n    const exchangeRates = toExchangeRates(currency, pricesByAssetId);\n    this.update((state) => {\n      state.assetExchangeRates = {\n        ...state.assetExchangeRates,\n        ...exchangeRates,\n      };\n    });\n  };\n\n  readonly #hasInsufficientBalance = async (\n    quoteRequest: GenericQuoteRequest,\n  ) => {\n    try {\n      const srcChainIdInHex = formatChainIdToHex(quoteRequest.srcChainId);\n      const provider =\n        this.#getNetworkClientByChainId(srcChainIdInHex)?.provider;\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n\n      return !(\n        provider &&\n        normalizedSrcTokenAddress &&\n        quoteRequest.srcTokenAmount &&\n        srcChainIdInHex &&\n        (await hasSufficientBalance(\n          provider,\n          quoteRequest.walletAddress,\n          normalizedSrcTokenAddress,\n          quoteRequest.srcTokenAmount,\n          srcChainIdInHex,\n        ))\n      );\n    } catch (error) {\n      console.warn('Failed to set insufficientBal', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  readonly #shouldResetApproval = async (quoteRequest: GenericQuoteRequest) => {\n    if (isNonEvmChainId(quoteRequest.srcChainId)) {\n      return false;\n    }\n    try {\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n      if (isEthUsdt(quoteRequest.srcChainId, normalizedSrcTokenAddress)) {\n        const allowance = BigNumber.from(\n          await this.#getUSDTMainnetAllowance(\n            quoteRequest.walletAddress,\n            normalizedSrcTokenAddress,\n            quoteRequest.destChainId,\n          ),\n        );\n        return allowance.lt(quoteRequest.srcTokenAmount) && allowance.gt(0);\n      }\n      return false;\n    } catch (error) {\n      console.warn('Failed to set resetApproval', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  stopPollingForQuotes = (\n    reason?: AbortReason,\n    context?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n  ) => {\n    this.stopAllPolling();\n    // If polling is stopped before quotes finish loading, track QuotesReceived\n    if (this.state.quotesLoadingStatus === RequestStatus.LOADING && context) {\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesReceived,\n        context,\n      );\n    }\n    // Clears quotes list in state\n    this.#abortController?.abort(reason);\n  };\n\n  /**\n   * Sets the location/entry point for the current swap or bridge flow.\n   * Call this when the user enters the flow so that all internally-fired\n   * events (InputChanged, QuotesRequested, etc.) carry the correct location.\n   *\n   * @param location - The entry point from which the user initiated the flow\n   */\n  setLocation = (location: MetaMetricsSwapsEventSource) => {\n    this.#location = location;\n  };\n\n  resetState = (reason = AbortReason.ResetState) => {\n    this.stopPollingForQuotes(reason);\n    this.update((state) => {\n      // Cannot do direct assignment to state, i.e. state = {... }, need to manually assign each field\n      state.quoteRequest = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest;\n      state.quotesInitialLoadTime =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime;\n      state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      state.quotesLastFetched =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched;\n      state.quotesLoadingStatus =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesRefreshCount =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount;\n      state.assetExchangeRates =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates;\n      state.minimumBalanceForRentExemptionInLamports =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  /**\n   * Sets the interval length based on the source chain\n   */\n  setChainIntervalLength = () => {\n    const { state } = this;\n    const { srcChainId } = state.quoteRequest;\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n\n    const refreshRateOverride = srcChainId\n      ? bridgeFeatureFlags.chains[formatChainIdToCaip(srcChainId)]?.refreshRate\n      : undefined;\n    const defaultRefreshRate = bridgeFeatureFlags.refreshRate;\n    this.setIntervalLength(refreshRateOverride ?? defaultRefreshRate);\n  };\n\n  readonly #fetchBridgeQuotes = async ({\n    updatedQuoteRequest,\n    context,\n  }: BridgePollingInput) => {\n    this.#abortController?.abort(AbortReason.NewQuoteRequest);\n    this.#abortController = new AbortController();\n\n    this.#fetchAssetExchangeRates(updatedQuoteRequest).catch((error) =>\n      console.warn('Failed to fetch asset exchange rates', error),\n    );\n\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesRequested,\n      context,\n    );\n\n    const { sse, maxRefreshCount } = getBridgeFeatureFlags(this.messenger);\n    const shouldStream =\n      sse?.enabled &&\n      hasMinimumRequiredVersion(this.#clientVersion, sse.minimumVersion);\n\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesLastFetched = Date.now();\n      state.quotesLoadingStatus = RequestStatus.LOADING;\n    });\n\n    try {\n      await this.#trace(\n        {\n          name: isCrossChain(\n            updatedQuoteRequest.srcChainId,\n            updatedQuoteRequest.destChainId,\n          )\n            ? TraceName.BridgeQuotesFetched\n            : TraceName.SwapQuotesFetched,\n          data: {\n            srcChainId: formatChainIdToCaip(updatedQuoteRequest.srcChainId),\n            destChainId: formatChainIdToCaip(updatedQuoteRequest.destChainId),\n          },\n        },\n        async () => {\n          const selectedAccount = this.#getMultichainSelectedAccount(\n            updatedQuoteRequest.walletAddress,\n          );\n          // This call is not awaited to prevent blocking quote fetching if the snap takes too long to respond\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.#setMinimumBalanceForRentExemptionInLamports(\n            updatedQuoteRequest.srcChainId,\n            selectedAccount?.metadata?.snap?.id,\n          );\n          // Use SSE if enabled and return early\n          if (shouldStream) {\n            await this.#handleQuoteStreaming(\n              updatedQuoteRequest,\n              selectedAccount,\n            );\n            return;\n          }\n          // Otherwise use regular fetch\n          const quotes = await this.fetchQuotes(\n            updatedQuoteRequest,\n            this.#abortController?.signal,\n          );\n          this.update((state) => {\n            // Set the initial load time if this is the first fetch\n            if (\n              state.quotesRefreshCount ===\n                DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount &&\n              this.#quotesFirstFetched\n            ) {\n              state.quotesInitialLoadTime =\n                Date.now() - this.#quotesFirstFetched;\n            }\n            state.quotes = quotes;\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      );\n    } catch (error) {\n      // Reset the quotes list if the fetch fails to avoid showing stale quotes\n      this.update((state) => {\n        state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      });\n      // Ignore abort errors\n      if (\n        (error as Error).toString().includes('AbortError') ||\n        (error as Error).toString().includes('FetchRequestCanceledException') ||\n        [\n          AbortReason.ResetState,\n          AbortReason.NewQuoteRequest,\n          AbortReason.QuoteRequestUpdated,\n          AbortReason.TransactionSubmitted,\n        ].includes(error as AbortReason)\n      ) {\n        // Exit the function early to prevent other state updates\n        return;\n      }\n\n      // Update loading status and error message\n      this.update((state) => {\n        // The error object reference is not guaranteed to exist on mobile so reading\n        // the message directly could cause an error.\n        let errorMessage;\n        try {\n          errorMessage =\n            (error as Error)?.message ?? (error as Error).toString();\n        } catch {\n          // Intentionally empty\n        } finally {\n          state.quoteFetchError = errorMessage ?? 'Unknown error';\n        }\n        state.quotesLoadingStatus = RequestStatus.ERROR;\n      });\n      // Track event and log error\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesError,\n        context,\n      );\n      console.log(\n        `Failed to ${shouldStream ? 'stream' : 'fetch'} bridge quotes`,\n        error,\n      );\n    }\n\n    // Update refresh count after fetching, validation and fee calculation have completed\n    this.update((state) => {\n      state.quotesRefreshCount += 1;\n    });\n    // Stop polling if the maximum number of refreshes has been reached\n    if (\n      updatedQuoteRequest.insufficientBal ||\n      (!updatedQuoteRequest.insufficientBal &&\n        this.state.quotesRefreshCount >= maxRefreshCount)\n    ) {\n      this.stopAllPolling();\n    }\n  };\n\n  readonly #handleQuoteStreaming = async (\n    updatedQuoteRequest: GenericQuoteRequest,\n    selectedAccount?: InternalAccount,\n  ) => {\n    /**\n     * Tracks the number of valid quotes received from the current stream, which is used\n     * to determine when to clear the quotes list and set the initial load time\n     */\n    let validQuotesCounter = 0;\n    /**\n     * Tracks all pending promises from appendFeesToQuotes calls to ensure they complete\n     * before setting quotesLoadingStatus to FETCHED\n     */\n    const pendingFeeAppendPromises = new Set<Promise<void>>();\n\n    await fetchBridgeQuoteStream(\n      this.#fetchFn,\n      updatedQuoteRequest,\n      this.#abortController?.signal,\n      this.#clientId,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      {\n        onValidationFailure: this.#trackResponseValidationFailures,\n        onValidQuoteReceived: async (quote: QuoteResponse) => {\n          const feeAppendPromise = (async () => {\n            const quotesWithFees = await appendFeesToQuotes(\n              [quote],\n              this.messenger,\n              this.#getLayer1GasFee,\n              selectedAccount,\n            );\n            if (quotesWithFees.length > 0) {\n              validQuotesCounter += 1;\n            }\n            this.update((state) => {\n              // Clear previous quotes and quotes load time when first quote in the current\n              // polling loop is received\n              // This enables clients to continue showing the previous quotes while new\n              // quotes are loading\n              // Note: If there are no valid quotes until the 2nd fetch, quotesInitialLoadTime will be > refreshRate\n              if (validQuotesCounter === 1) {\n                state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n                if (!state.quotesInitialLoadTime && this.#quotesFirstFetched) {\n                  // Set the initial load time after the first quote is received\n                  state.quotesInitialLoadTime =\n                    Date.now() - this.#quotesFirstFetched;\n                }\n              }\n              state.quotes = [...state.quotes, ...quotesWithFees];\n            });\n          })();\n          pendingFeeAppendPromises.add(feeAppendPromise);\n          feeAppendPromise\n            .catch((error) => {\n              // Catch errors to prevent them from breaking stream processing\n              // If appendFeesToQuotes throws, the state update never happens, so no invalid entry is added\n              console.error('Error appending fees to quote', error);\n            })\n            .finally(() => {\n              pendingFeeAppendPromises.delete(feeAppendPromise);\n            });\n          // Await the promise to ensure errors are caught and handled before continuing\n          // The promise is also tracked in pendingFeeAppendPromises for onClose to wait for\n          await feeAppendPromise;\n        },\n        onClose: async () => {\n          // Wait for all pending appendFeesToQuotes operations to complete\n          // before setting quotesLoadingStatus to FETCHED\n          await Promise.allSettled(Array.from(pendingFeeAppendPromises));\n          this.update((state) => {\n            // If there are no valid quotes in the current stream, clear the quotes list\n            // to remove quotes from the previous stream\n            if (validQuotesCounter === 0) {\n              state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n            }\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      },\n      this.#clientVersion,\n    );\n  };\n\n  readonly #setMinimumBalanceForRentExemptionInLamports = async (\n    srcChainId: GenericQuoteRequest['srcChainId'],\n    snapId?: string,\n  ) => {\n    if (!isSolanaChainId(srcChainId) || !snapId) {\n      return;\n    }\n    const minimumBalanceForRentExemptionInLamports =\n      await getMinimumBalanceForRentExemptionInLamports(snapId, this.messenger);\n    this.update((state) => {\n      state.minimumBalanceForRentExemptionInLamports =\n        minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  #getMultichainSelectedAccount(\n    walletAddress?: GenericQuoteRequest['walletAddress'],\n  ) {\n    const addressToUse = walletAddress ?? this.state.quoteRequest.walletAddress;\n    if (!addressToUse) {\n      throw new Error('Account address is required');\n    }\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      addressToUse,\n    );\n    return selectedAccount;\n  }\n\n  #getNetworkClientByChainId(chainId: Hex) {\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      chainId,\n    );\n    if (!networkClientId) {\n      throw new Error(`No network client found for chainId: ${chainId}`);\n    }\n    const networkClient = this.messenger.call(\n      'NetworkController:getNetworkClientById',\n      networkClientId,\n    );\n    return networkClient;\n  }\n\n  readonly #getRequestMetadata = (): Omit<\n    RequestMetadata,\n    | 'stx_enabled'\n    | 'usd_amount_source'\n    | 'security_warnings'\n    | 'is_hardware_wallet'\n  > => {\n    return {\n      slippage_limit: this.state.quoteRequest.slippage,\n      swap_type: getSwapTypeFromQuote(this.state.quoteRequest),\n      custom_slippage: isCustomSlippage(this.state.quoteRequest.slippage),\n    };\n  };\n\n  readonly #getQuoteFetchData = (): Omit<\n    QuoteFetchData,\n    'best_quote_provider' | 'price_impact' | 'can_submit'\n  > => {\n    return {\n      quotes_count: this.state.quotes.length,\n      quotes_list: this.state.quotes.map(({ quote }) =>\n        formatProviderLabel(quote),\n      ),\n      initial_load_time_all_quotes: this.state.quotesInitialLoadTime ?? 0,\n      has_gas_included_quote: this.state.quotes.some(\n        ({ quote }) => quote.gasIncluded,\n      ),\n    };\n  };\n\n  readonly #getEventProperties = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): CrossChainSwapsEventProperties<EventName> => {\n    const clientProps = propertiesFromClient as Record<string, unknown>;\n    const baseProperties = {\n      ...propertiesFromClient,\n      location: clientProps?.location ?? this.#location,\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n    };\n    switch (eventName) {\n      case UnifiedSwapBridgeEventName.ButtonClicked:\n      case UnifiedSwapBridgeEventName.PageViewed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesValidationFailed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesReceived:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesRequested:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesError:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          error_message: this.state.quoteFetchError,\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.AllQuotesOpened:\n      case UnifiedSwapBridgeEventName.AllQuotesSorted:\n      case UnifiedSwapBridgeEventName.QuoteSelected:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.Failed: {\n        // Populate the properties that the error occurred before the tx was submitted\n        return {\n          ...baseProperties,\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          ...propertiesFromClient,\n        };\n      }\n      case UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:\n        return baseProperties;\n      // These events may be published after the bridge-controller state is reset\n      // So the BridgeStatusController populates all the properties\n      case UnifiedSwapBridgeEventName.Submitted:\n      case UnifiedSwapBridgeEventName.Completed:\n        return propertiesFromClient;\n      case UnifiedSwapBridgeEventName.InputChanged:\n      default:\n        return baseProperties;\n    }\n  };\n\n  readonly #trackInputChangedEvents = (\n    paramsToUpdate: Partial<GenericQuoteRequest>,\n  ) => {\n    Object.entries(paramsToUpdate).forEach(([key, value]) => {\n      const inputKey = toInputChangedPropertyKey[key as keyof QuoteRequest];\n      const inputValue =\n        toInputChangedPropertyValue[key as keyof QuoteRequest]?.(\n          paramsToUpdate,\n        );\n      if (\n        inputKey &&\n        inputValue !== undefined &&\n        value !== this.state.quoteRequest[key as keyof GenericQuoteRequest]\n      ) {\n        this.trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.InputChanged,\n          {\n            input: inputKey,\n            input_value: inputValue,\n            location: this.#location,\n          },\n        );\n      }\n    });\n  };\n\n  /**\n   * This method tracks cross-chain swaps events\n   *\n   * @param eventName - The name of the event to track\n   * @param propertiesFromClient - Properties that can't be calculated from the event name and need to be provided by the client\n   * @example\n   * this.trackUnifiedSwapBridgeEvent(UnifiedSwapBridgeEventName.ActionOpened, {\n   *   location: MetaMetricsSwapsEventSource.MainView,\n   * });\n   */\n  trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ) => {\n    try {\n      const combinedPropertiesForEvent = this.#getEventProperties<EventName>(\n        eventName,\n        propertiesFromClient,\n      );\n\n      this.#trackMetaMetricsFn(eventName, combinedPropertiesForEvent);\n    } catch (error) {\n      console.error(\n        `Error tracking cross-chain swaps MetaMetrics event ${eventName}`,\n        error,\n      );\n    }\n  };\n\n  /**\n   *\n   * @param walletAddress - The address of the account to get the allowance for\n   * @param contractAddress - The address of the ERC20 token contract on mainnet\n   * @param destinationChainId - The chain ID of the destination network\n   * @returns The atomic allowance of the ERC20 token contract\n   */\n  readonly #getUSDTMainnetAllowance = async (\n    walletAddress: string,\n    contractAddress: string,\n    destinationChainId: GenericQuoteRequest['destChainId'],\n  ): Promise<string> => {\n    const networkClient = this.#getNetworkClientByChainId(CHAIN_IDS.MAINNET);\n    const provider = networkClient?.provider;\n    if (!provider) {\n      throw new Error('No provider found');\n    }\n\n    const ethersProvider = new Web3Provider(provider);\n    const contract = new Contract(contractAddress, abiERC20, ethersProvider);\n    const spenderAddress = isCrossChain(CHAIN_IDS.MAINNET, destinationChainId)\n      ? METABRIDGE_ETHEREUM_ADDRESS\n      : SWAPS_CONTRACT_ADDRESSES[CHAIN_IDS.MAINNET];\n    const allowance: BigNumber = await contract.allowance(\n      walletAddress,\n      spenderAddress,\n    );\n    return allowance.toString();\n  };\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"bridge-controller.cjs","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { BigNumber } from '@ethersproject/bignumber';\nimport { Contract } from '@ethersproject/contracts';\nimport { Web3Provider } from '@ethersproject/providers';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport type { InternalAccount } from '@metamask/keyring-internal-api';\nimport { abiERC20 } from '@metamask/metamask-eth-abis';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport type { TransactionController } from '@metamask/transaction-controller';\nimport type { CaipAssetType, Hex } from '@metamask/utils';\n\nimport type { BridgeClientId } from './constants/bridge';\nimport {\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_PROD_API_BASE_URL,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_ETHEREUM_ADDRESS,\n  REFRESH_INTERVAL_MS,\n} from './constants/bridge';\nimport { CHAIN_IDS } from './constants/chains';\nimport { SWAPS_CONTRACT_ADDRESSES } from './constants/swaps';\nimport { TraceName } from './constants/traces';\nimport { selectIsAssetExchangeRateInState } from './selectors';\nimport { RequestStatus } from './types';\nimport type {\n  L1GasFees,\n  GenericQuoteRequest,\n  NonEvmFees,\n  QuoteRequest,\n  QuoteResponse,\n  BridgeControllerState,\n  BridgeControllerMessenger,\n  FetchFunction,\n} from './types';\nimport { getAssetIdsForToken, toExchangeRates } from './utils/assets';\nimport { hasSufficientBalance } from './utils/balance';\nimport {\n  getDefaultBridgeControllerState,\n  isCrossChain,\n  isEthUsdt,\n  isNonEvmChainId,\n  isSolanaChainId,\n} from './utils/bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToCaip,\n  formatChainIdToHex,\n} from './utils/caip-formatters';\nimport {\n  getBridgeFeatureFlags,\n  hasMinimumRequiredVersion,\n} from './utils/feature-flags';\nimport {\n  fetchAssetPrices,\n  fetchBridgeQuotes,\n  fetchBridgeQuoteStream,\n} from './utils/fetch';\nimport {\n  AbortReason,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  UnifiedSwapBridgeEventName,\n} from './utils/metrics/constants';\nimport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapTypeFromQuote,\n  isCustomSlippage,\n  isHardwareWallet,\n  toInputChangedPropertyKey,\n  toInputChangedPropertyValue,\n} from './utils/metrics/properties';\nimport type {\n  QuoteFetchData,\n  RequestMetadata,\n  RequiredEventContextFromClient,\n} from './utils/metrics/types';\nimport type { CrossChainSwapsEventProperties } from './utils/metrics/types';\nimport { isValidQuoteRequest, sortQuotes } from './utils/quote';\nimport { appendFeesToQuotes } from './utils/quote-fees';\nimport { getMinimumBalanceForRentExemptionInLamports } from './utils/snaps';\nimport type { FeatureId } from './utils/validators';\n\nconst metadata: StateMetadata<BridgeControllerState> = {\n  quoteRequest: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotes: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesInitialLoadTime: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLastFetched: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLoadingStatus: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quoteFetchError: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesRefreshCount: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  assetExchangeRates: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  minimumBalanceForRentExemptionInLamports: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/**\n * The input to start polling for the {@link BridgeController}\n *\n * @param updatedQuoteRequest - The updated quote request\n * @param context - The context contains properties that can't be populated by the\n * controller and need to be provided by the client for analytics\n */\ntype BridgePollingInput = {\n  updatedQuoteRequest: GenericQuoteRequest;\n  context: Pick<\n    RequiredEventContextFromClient,\n    UnifiedSwapBridgeEventName.QuotesError\n  >[UnifiedSwapBridgeEventName.QuotesError] &\n    Pick<\n      RequiredEventContextFromClient,\n      UnifiedSwapBridgeEventName.QuotesRequested\n    >[UnifiedSwapBridgeEventName.QuotesRequested];\n};\n\nexport class BridgeController extends StaticIntervalPollingController<BridgePollingInput>()<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState,\n  BridgeControllerMessenger\n> {\n  #abortController: AbortController | undefined;\n\n  #quotesFirstFetched: number | undefined;\n\n  /**\n   * Stores the location/entry point from which the user initiated the swap or bridge flow.\n   * Set via setLocation() before navigating to the swap/bridge flow.\n   * Used as default for all subsequent internal events.\n   */\n  #location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #clientVersion: string;\n\n  readonly #getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #trackMetaMetricsFn: <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    properties: CrossChainSwapsEventProperties<EventName>,\n  ) => void;\n\n  readonly #trace: TraceCallback;\n\n  readonly #config: {\n    customBridgeApiBaseUrl?: string;\n  };\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    clientVersion,\n    getLayer1GasFee,\n    fetchFn,\n    config,\n    trackMetaMetricsFn,\n    traceFn,\n  }: {\n    messenger: BridgeControllerMessenger;\n    state?: Partial<BridgeControllerState>;\n    clientId: BridgeClientId;\n    clientVersion: string;\n    getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n    fetchFn: FetchFunction;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    trackMetaMetricsFn: <\n      EventName extends\n        (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n    >(\n      eventName: EventName,\n      properties: CrossChainSwapsEventProperties<EventName>,\n    ) => void;\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      state: {\n        ...getDefaultBridgeControllerState(),\n        ...state,\n      },\n    });\n\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.#abortController = new AbortController();\n    this.#getLayer1GasFee = getLayer1GasFee;\n    this.#clientId = clientId;\n    this.#clientVersion = clientVersion;\n    this.#fetchFn = fetchFn;\n    this.#trackMetaMetricsFn = trackMetaMetricsFn;\n    this.#config = config ?? {};\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,\n      this.setChainIntervalLength.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,\n      this.updateBridgeQuoteRequestParams.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,\n      this.trackUnifiedSwapBridgeEvent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,\n      this.stopPollingForQuotes.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:fetchQuotes`,\n      this.fetchQuotes.bind(this),\n    );\n  }\n\n  _executePoll = async (pollingInput: BridgePollingInput) => {\n    await this.#fetchBridgeQuotes(pollingInput);\n  };\n\n  updateBridgeQuoteRequestParams = async (\n    paramsToUpdate: Partial<GenericQuoteRequest> & {\n      walletAddress: GenericQuoteRequest['walletAddress'];\n    },\n    context: BridgePollingInput['context'],\n  ) => {\n    this.#trackInputChangedEvents(paramsToUpdate);\n    this.resetState(AbortReason.QuoteRequestUpdated);\n    const updatedQuoteRequest = {\n      ...DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,\n      ...paramsToUpdate,\n    };\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n    });\n\n    if (isValidQuoteRequest(updatedQuoteRequest)) {\n      this.#quotesFirstFetched = Date.now();\n      const isSrcChainNonEVM = isNonEvmChainId(updatedQuoteRequest.srcChainId);\n      const providerConfig = isSrcChainNonEVM\n        ? undefined\n        : this.#getNetworkClientByChainId(\n            formatChainIdToHex(updatedQuoteRequest.srcChainId),\n          )?.configuration;\n\n      let insufficientBal: boolean | undefined;\n      let resetApproval: boolean = Boolean(paramsToUpdate.resetApproval);\n      if (isSrcChainNonEVM) {\n        // If the source chain is not an EVM network, use value from params\n        insufficientBal = paramsToUpdate.insufficientBal;\n      } else if (providerConfig?.rpcUrl?.includes('tenderly')) {\n        // If the rpcUrl is a tenderly fork (e2e tests), set insufficientBal=true\n        // The bridge-api filters out quotes if the balance on mainnet is insufficient so this override allows quotes to always be returned\n        insufficientBal = true;\n      } else {\n        // Set loading status if RPC calls are made before the quotes are fetched\n        this.update((state) => {\n          state.quotesLoadingStatus = RequestStatus.LOADING;\n        });\n        resetApproval = await this.#shouldResetApproval(updatedQuoteRequest);\n        // Otherwise query the src token balance from the RPC provider\n        insufficientBal =\n          paramsToUpdate.insufficientBal ??\n          (await this.#hasInsufficientBalance(updatedQuoteRequest));\n      }\n\n      // Set refresh rate based on the source chain before starting polling\n      this.setChainIntervalLength();\n      this.startPolling({\n        updatedQuoteRequest: {\n          ...updatedQuoteRequest,\n          insufficientBal,\n          resetApproval,\n        },\n        context,\n      });\n    }\n  };\n\n  /**\n   * Fetches quotes for specified request without updating the controller state\n   * This method does not start polling for quotes and does not emit UnifiedSwapBridge events\n   *\n   * @param quoteRequest - The parameters for quote requests to fetch\n   * @param abortSignal - The abort signal to cancel all the requests\n   * @param featureId - The feature ID that maps to quoteParam overrides from LD\n   * @returns A list of validated quotes\n   */\n  fetchQuotes = async (\n    quoteRequest: GenericQuoteRequest,\n    abortSignal: AbortSignal | null = null,\n    featureId: FeatureId | null = null,\n  ): Promise<(QuoteResponse & L1GasFees & NonEvmFees)[]> => {\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n    const jwt = await this.#getJwt();\n    // If featureId is specified, retrieve the quoteRequestOverrides for that featureId\n    const quoteRequestOverrides = featureId\n      ? bridgeFeatureFlags.quoteRequestOverrides?.[featureId]\n      : undefined;\n    const resetApproval = await this.#shouldResetApproval(quoteRequest);\n\n    // If quoteRequestOverrides is specified, merge it with the quoteRequest\n    const { quotes: baseQuotes, validationFailures } = await fetchBridgeQuotes(\n      quoteRequestOverrides\n        ? { ...quoteRequest, ...quoteRequestOverrides, resetApproval }\n        : { ...quoteRequest, resetApproval },\n      abortSignal,\n      this.#clientId,\n      jwt,\n      this.#fetchFn,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      featureId,\n      this.#clientVersion,\n    );\n\n    this.#trackResponseValidationFailures(validationFailures);\n\n    const quotesWithFees = await appendFeesToQuotes(\n      baseQuotes,\n      this.messenger,\n      this.#getLayer1GasFee,\n      this.#getMultichainSelectedAccount(quoteRequest.walletAddress),\n    );\n\n    return sortQuotes(quotesWithFees, featureId);\n  };\n\n  readonly #trackResponseValidationFailures = (\n    validationFailures: string[],\n  ) => {\n    if (validationFailures.length === 0) {\n      return;\n    }\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesValidationFailed,\n      {\n        failures: validationFailures,\n        location: this.#location,\n      },\n    );\n  };\n\n  readonly #getExchangeRateSources = () => {\n    return {\n      ...this.messenger.call('MultichainAssetsRatesController:getState'),\n      ...this.messenger.call('CurrencyRateController:getState'),\n      ...this.messenger.call('TokenRatesController:getState'),\n      ...this.state,\n    };\n  };\n\n  /**\n   * Fetches the exchange rates for the assets in the quote request if they are not already in the state\n   * In addition to the selected tokens, this also fetches the native asset for the source and destination chains\n   *\n   * @param quoteRequest - The quote request\n   * @param quoteRequest.srcChainId - The source chain ID\n   * @param quoteRequest.srcTokenAddress - The source token address\n   * @param quoteRequest.destChainId - The destination chain ID\n   * @param quoteRequest.destTokenAddress - The destination token address\n   */\n  readonly #fetchAssetExchangeRates = async ({\n    srcChainId,\n    srcTokenAddress,\n    destChainId,\n    destTokenAddress,\n  }: Partial<GenericQuoteRequest>) => {\n    const assetIds: Set<CaipAssetType> = new Set([]);\n    const exchangeRateSources = this.#getExchangeRateSources();\n    if (\n      srcTokenAddress &&\n      srcChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        srcChainId,\n        srcTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(srcTokenAddress, srcChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n    if (\n      destTokenAddress &&\n      destChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        destChainId,\n        destTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(destTokenAddress, destChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n\n    const currency = this.messenger.call(\n      'CurrencyRateController:getState',\n    ).currentCurrency;\n\n    if (assetIds.size === 0) {\n      return;\n    }\n\n    const pricesByAssetId = await fetchAssetPrices({\n      assetIds,\n      currencies: new Set([currency]),\n      clientId: this.#clientId,\n      clientVersion: this.#clientVersion,\n      fetchFn: this.#fetchFn,\n      signal: this.#abortController?.signal,\n    });\n    const exchangeRates = toExchangeRates(currency, pricesByAssetId);\n    this.update((state) => {\n      state.assetExchangeRates = {\n        ...state.assetExchangeRates,\n        ...exchangeRates,\n      };\n    });\n  };\n\n  readonly #hasInsufficientBalance = async (\n    quoteRequest: GenericQuoteRequest,\n  ) => {\n    try {\n      const srcChainIdInHex = formatChainIdToHex(quoteRequest.srcChainId);\n      const provider =\n        this.#getNetworkClientByChainId(srcChainIdInHex)?.provider;\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n\n      return !(\n        provider &&\n        normalizedSrcTokenAddress &&\n        quoteRequest.srcTokenAmount &&\n        srcChainIdInHex &&\n        (await hasSufficientBalance(\n          provider,\n          quoteRequest.walletAddress,\n          normalizedSrcTokenAddress,\n          quoteRequest.srcTokenAmount,\n          srcChainIdInHex,\n        ))\n      );\n    } catch (error) {\n      console.warn('Failed to set insufficientBal', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  readonly #shouldResetApproval = async (quoteRequest: GenericQuoteRequest) => {\n    if (isNonEvmChainId(quoteRequest.srcChainId)) {\n      return false;\n    }\n    try {\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n      if (isEthUsdt(quoteRequest.srcChainId, normalizedSrcTokenAddress)) {\n        const allowance = BigNumber.from(\n          await this.#getUSDTMainnetAllowance(\n            quoteRequest.walletAddress,\n            normalizedSrcTokenAddress,\n            quoteRequest.destChainId,\n          ),\n        );\n        return allowance.lt(quoteRequest.srcTokenAmount) && allowance.gt(0);\n      }\n      return false;\n    } catch (error) {\n      console.warn('Failed to set resetApproval', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  stopPollingForQuotes = (\n    reason?: AbortReason,\n    context?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n  ) => {\n    this.stopAllPolling();\n    // If polling is stopped before quotes finish loading, track QuotesReceived\n    if (this.state.quotesLoadingStatus === RequestStatus.LOADING && context) {\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesReceived,\n        context,\n      );\n    }\n    // Clears quotes list in state\n    this.#abortController?.abort(reason);\n  };\n\n  /**\n   * Sets the location/entry point for the current swap or bridge flow.\n   * Call this when the user enters the flow so that all internally-fired\n   * events (InputChanged, QuotesRequested, etc.) carry the correct location.\n   *\n   * @param location - The entry point from which the user initiated the flow\n   */\n  setLocation = (location: MetaMetricsSwapsEventSource) => {\n    this.#location = location;\n  };\n\n  resetState = (reason = AbortReason.ResetState) => {\n    this.stopPollingForQuotes(reason);\n    this.update((state) => {\n      // Cannot do direct assignment to state, i.e. state = {... }, need to manually assign each field\n      state.quoteRequest = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest;\n      state.quotesInitialLoadTime =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime;\n      state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      state.quotesLastFetched =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched;\n      state.quotesLoadingStatus =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesRefreshCount =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount;\n      state.assetExchangeRates =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates;\n      state.minimumBalanceForRentExemptionInLamports =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  /**\n   * Sets the interval length based on the source chain\n   */\n  setChainIntervalLength = () => {\n    const { state } = this;\n    const { srcChainId } = state.quoteRequest;\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n\n    const refreshRateOverride = srcChainId\n      ? bridgeFeatureFlags.chains[formatChainIdToCaip(srcChainId)]?.refreshRate\n      : undefined;\n    const defaultRefreshRate = bridgeFeatureFlags.refreshRate;\n    this.setIntervalLength(refreshRateOverride ?? defaultRefreshRate);\n  };\n\n  readonly #fetchBridgeQuotes = async ({\n    updatedQuoteRequest,\n    context,\n  }: BridgePollingInput) => {\n    this.#abortController?.abort(AbortReason.NewQuoteRequest);\n    this.#abortController = new AbortController();\n\n    this.#fetchAssetExchangeRates(updatedQuoteRequest).catch((error) =>\n      console.warn('Failed to fetch asset exchange rates', error),\n    );\n\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesRequested,\n      context,\n    );\n\n    const { sse, maxRefreshCount } = getBridgeFeatureFlags(this.messenger);\n    const shouldStream =\n      sse?.enabled &&\n      hasMinimumRequiredVersion(this.#clientVersion, sse.minimumVersion);\n\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesLastFetched = Date.now();\n      state.quotesLoadingStatus = RequestStatus.LOADING;\n    });\n\n    const jwt = await this.#getJwt();\n\n    try {\n      await this.#trace(\n        {\n          name: isCrossChain(\n            updatedQuoteRequest.srcChainId,\n            updatedQuoteRequest.destChainId,\n          )\n            ? TraceName.BridgeQuotesFetched\n            : TraceName.SwapQuotesFetched,\n          data: {\n            srcChainId: formatChainIdToCaip(updatedQuoteRequest.srcChainId),\n            destChainId: formatChainIdToCaip(updatedQuoteRequest.destChainId),\n          },\n        },\n        async () => {\n          const selectedAccount = this.#getMultichainSelectedAccount(\n            updatedQuoteRequest.walletAddress,\n          );\n          // This call is not awaited to prevent blocking quote fetching if the snap takes too long to respond\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.#setMinimumBalanceForRentExemptionInLamports(\n            updatedQuoteRequest.srcChainId,\n            selectedAccount?.metadata?.snap?.id,\n          );\n          // Use SSE if enabled and return early\n          if (shouldStream) {\n            await this.#handleQuoteStreaming(\n              updatedQuoteRequest,\n              jwt,\n              selectedAccount,\n            );\n            return;\n          }\n          // Otherwise use regular fetch\n          const quotes = await this.fetchQuotes(\n            updatedQuoteRequest,\n            this.#abortController?.signal,\n          );\n          this.update((state) => {\n            // Set the initial load time if this is the first fetch\n            if (\n              state.quotesRefreshCount ===\n                DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount &&\n              this.#quotesFirstFetched\n            ) {\n              state.quotesInitialLoadTime =\n                Date.now() - this.#quotesFirstFetched;\n            }\n            state.quotes = quotes;\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      );\n    } catch (error) {\n      // Reset the quotes list if the fetch fails to avoid showing stale quotes\n      this.update((state) => {\n        state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      });\n      // Ignore abort errors\n      if (\n        (error as Error).toString().includes('AbortError') ||\n        (error as Error).toString().includes('FetchRequestCanceledException') ||\n        [\n          AbortReason.ResetState,\n          AbortReason.NewQuoteRequest,\n          AbortReason.QuoteRequestUpdated,\n          AbortReason.TransactionSubmitted,\n        ].includes(error as AbortReason)\n      ) {\n        // Exit the function early to prevent other state updates\n        return;\n      }\n\n      // Update loading status and error message\n      this.update((state) => {\n        // The error object reference is not guaranteed to exist on mobile so reading\n        // the message directly could cause an error.\n        let errorMessage;\n        try {\n          errorMessage =\n            (error as Error)?.message ?? (error as Error).toString();\n        } catch {\n          // Intentionally empty\n        } finally {\n          state.quoteFetchError = errorMessage ?? 'Unknown error';\n        }\n        state.quotesLoadingStatus = RequestStatus.ERROR;\n      });\n      // Track event and log error\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesError,\n        context,\n      );\n      console.log(\n        `Failed to ${shouldStream ? 'stream' : 'fetch'} bridge quotes`,\n        error,\n      );\n    }\n\n    // Update refresh count after fetching, validation and fee calculation have completed\n    this.update((state) => {\n      state.quotesRefreshCount += 1;\n    });\n    // Stop polling if the maximum number of refreshes has been reached\n    if (\n      updatedQuoteRequest.insufficientBal ||\n      (!updatedQuoteRequest.insufficientBal &&\n        this.state.quotesRefreshCount >= maxRefreshCount)\n    ) {\n      this.stopAllPolling();\n    }\n  };\n\n  readonly #handleQuoteStreaming = async (\n    updatedQuoteRequest: GenericQuoteRequest,\n    jwt?: string,\n    selectedAccount?: InternalAccount,\n  ) => {\n    /**\n     * Tracks the number of valid quotes received from the current stream, which is used\n     * to determine when to clear the quotes list and set the initial load time\n     */\n    let validQuotesCounter = 0;\n    /**\n     * Tracks all pending promises from appendFeesToQuotes calls to ensure they complete\n     * before setting quotesLoadingStatus to FETCHED\n     */\n    const pendingFeeAppendPromises = new Set<Promise<void>>();\n\n    await fetchBridgeQuoteStream(\n      this.#fetchFn,\n      updatedQuoteRequest,\n      this.#abortController?.signal,\n      this.#clientId,\n      jwt,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      {\n        onValidationFailure: this.#trackResponseValidationFailures,\n        onValidQuoteReceived: async (quote: QuoteResponse) => {\n          const feeAppendPromise = (async () => {\n            const quotesWithFees = await appendFeesToQuotes(\n              [quote],\n              this.messenger,\n              this.#getLayer1GasFee,\n              selectedAccount,\n            );\n            if (quotesWithFees.length > 0) {\n              validQuotesCounter += 1;\n            }\n            this.update((state) => {\n              // Clear previous quotes and quotes load time when first quote in the current\n              // polling loop is received\n              // This enables clients to continue showing the previous quotes while new\n              // quotes are loading\n              // Note: If there are no valid quotes until the 2nd fetch, quotesInitialLoadTime will be > refreshRate\n              if (validQuotesCounter === 1) {\n                state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n                if (!state.quotesInitialLoadTime && this.#quotesFirstFetched) {\n                  // Set the initial load time after the first quote is received\n                  state.quotesInitialLoadTime =\n                    Date.now() - this.#quotesFirstFetched;\n                }\n              }\n              state.quotes = [...state.quotes, ...quotesWithFees];\n            });\n          })();\n          pendingFeeAppendPromises.add(feeAppendPromise);\n          feeAppendPromise\n            .catch((error) => {\n              // Catch errors to prevent them from breaking stream processing\n              // If appendFeesToQuotes throws, the state update never happens, so no invalid entry is added\n              console.error('Error appending fees to quote', error);\n            })\n            .finally(() => {\n              pendingFeeAppendPromises.delete(feeAppendPromise);\n            });\n          // Await the promise to ensure errors are caught and handled before continuing\n          // The promise is also tracked in pendingFeeAppendPromises for onClose to wait for\n          await feeAppendPromise;\n        },\n        onClose: async () => {\n          // Wait for all pending appendFeesToQuotes operations to complete\n          // before setting quotesLoadingStatus to FETCHED\n          await Promise.allSettled(Array.from(pendingFeeAppendPromises));\n          this.update((state) => {\n            // If there are no valid quotes in the current stream, clear the quotes list\n            // to remove quotes from the previous stream\n            if (validQuotesCounter === 0) {\n              state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n            }\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      },\n      this.#clientVersion,\n    );\n  };\n\n  readonly #setMinimumBalanceForRentExemptionInLamports = async (\n    srcChainId: GenericQuoteRequest['srcChainId'],\n    snapId?: string,\n  ) => {\n    if (!isSolanaChainId(srcChainId) || !snapId) {\n      return;\n    }\n    const minimumBalanceForRentExemptionInLamports =\n      await getMinimumBalanceForRentExemptionInLamports(snapId, this.messenger);\n    this.update((state) => {\n      state.minimumBalanceForRentExemptionInLamports =\n        minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  #getMultichainSelectedAccount(\n    walletAddress?: GenericQuoteRequest['walletAddress'],\n  ) {\n    const addressToUse = walletAddress ?? this.state.quoteRequest.walletAddress;\n    if (!addressToUse) {\n      throw new Error('Account address is required');\n    }\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      addressToUse,\n    );\n    return selectedAccount;\n  }\n\n  #getNetworkClientByChainId(chainId: Hex) {\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      chainId,\n    );\n    if (!networkClientId) {\n      throw new Error(`No network client found for chainId: ${chainId}`);\n    }\n    const networkClient = this.messenger.call(\n      'NetworkController:getNetworkClientById',\n      networkClientId,\n    );\n    return networkClient;\n  }\n\n  readonly #getJwt = async (): Promise<string | undefined> => {\n    try {\n      const token = await this.messenger.call(\n        'AuthenticationController:getBearerToken',\n      );\n      return token;\n    } catch (error) {\n      console.error('Error getting JWT token for bridge-api request', error);\n      return undefined;\n    }\n  };\n\n  readonly #getRequestMetadata = (): Omit<\n    RequestMetadata,\n    | 'stx_enabled'\n    | 'usd_amount_source'\n    | 'security_warnings'\n    | 'is_hardware_wallet'\n  > => {\n    return {\n      slippage_limit: this.state.quoteRequest.slippage,\n      swap_type: getSwapTypeFromQuote(this.state.quoteRequest),\n      custom_slippage: isCustomSlippage(this.state.quoteRequest.slippage),\n    };\n  };\n\n  readonly #getQuoteFetchData = (): Omit<\n    QuoteFetchData,\n    'best_quote_provider' | 'price_impact' | 'can_submit'\n  > => {\n    return {\n      quotes_count: this.state.quotes.length,\n      quotes_list: this.state.quotes.map(({ quote }) =>\n        formatProviderLabel(quote),\n      ),\n      initial_load_time_all_quotes: this.state.quotesInitialLoadTime ?? 0,\n      has_gas_included_quote: this.state.quotes.some(\n        ({ quote }) => quote.gasIncluded,\n      ),\n    };\n  };\n\n  readonly #getEventProperties = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): CrossChainSwapsEventProperties<EventName> => {\n    const clientProps = propertiesFromClient as Record<string, unknown>;\n    const baseProperties = {\n      ...propertiesFromClient,\n      location: clientProps?.location ?? this.#location,\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n    };\n    switch (eventName) {\n      case UnifiedSwapBridgeEventName.ButtonClicked:\n      case UnifiedSwapBridgeEventName.PageViewed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesValidationFailed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesReceived:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesRequested:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesError:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          error_message: this.state.quoteFetchError,\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.AllQuotesOpened:\n      case UnifiedSwapBridgeEventName.AllQuotesSorted:\n      case UnifiedSwapBridgeEventName.QuoteSelected:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.Failed: {\n        // Populate the properties that the error occurred before the tx was submitted\n        return {\n          ...baseProperties,\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          ...propertiesFromClient,\n        };\n      }\n      case UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:\n        return baseProperties;\n      // These events may be published after the bridge-controller state is reset\n      // So the BridgeStatusController populates all the properties\n      case UnifiedSwapBridgeEventName.Submitted:\n      case UnifiedSwapBridgeEventName.Completed:\n        return propertiesFromClient;\n      case UnifiedSwapBridgeEventName.InputChanged:\n      default:\n        return baseProperties;\n    }\n  };\n\n  readonly #trackInputChangedEvents = (\n    paramsToUpdate: Partial<GenericQuoteRequest>,\n  ) => {\n    Object.entries(paramsToUpdate).forEach(([key, value]) => {\n      const inputKey = toInputChangedPropertyKey[key as keyof QuoteRequest];\n      const inputValue =\n        toInputChangedPropertyValue[key as keyof QuoteRequest]?.(\n          paramsToUpdate,\n        );\n      if (\n        inputKey &&\n        inputValue !== undefined &&\n        value !== this.state.quoteRequest[key as keyof GenericQuoteRequest]\n      ) {\n        this.trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.InputChanged,\n          {\n            input: inputKey,\n            input_value: inputValue,\n            location: this.#location,\n          },\n        );\n      }\n    });\n  };\n\n  /**\n   * This method tracks cross-chain swaps events\n   *\n   * @param eventName - The name of the event to track\n   * @param propertiesFromClient - Properties that can't be calculated from the event name and need to be provided by the client\n   * @example\n   * this.trackUnifiedSwapBridgeEvent(UnifiedSwapBridgeEventName.ActionOpened, {\n   *   location: MetaMetricsSwapsEventSource.MainView,\n   * });\n   */\n  trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ) => {\n    try {\n      const combinedPropertiesForEvent = this.#getEventProperties<EventName>(\n        eventName,\n        propertiesFromClient,\n      );\n\n      this.#trackMetaMetricsFn(eventName, combinedPropertiesForEvent);\n    } catch (error) {\n      console.error(\n        `Error tracking cross-chain swaps MetaMetrics event ${eventName}`,\n        error,\n      );\n    }\n  };\n\n  /**\n   *\n   * @param walletAddress - The address of the account to get the allowance for\n   * @param contractAddress - The address of the ERC20 token contract on mainnet\n   * @param destinationChainId - The chain ID of the destination network\n   * @returns The atomic allowance of the ERC20 token contract\n   */\n  readonly #getUSDTMainnetAllowance = async (\n    walletAddress: string,\n    contractAddress: string,\n    destinationChainId: GenericQuoteRequest['destChainId'],\n  ): Promise<string> => {\n    const networkClient = this.#getNetworkClientByChainId(CHAIN_IDS.MAINNET);\n    const provider = networkClient?.provider;\n    if (!provider) {\n      throw new Error('No provider found');\n    }\n\n    const ethersProvider = new Web3Provider(provider);\n    const contract = new Contract(contractAddress, abiERC20, ethersProvider);\n    const spenderAddress = isCrossChain(CHAIN_IDS.MAINNET, destinationChainId)\n      ? METABRIDGE_ETHEREUM_ADDRESS\n      : SWAPS_CONTRACT_ADDRESSES[CHAIN_IDS.MAINNET];\n    const allowance: BigNumber = await contract.allowance(\n      walletAddress,\n      spenderAddress,\n    );\n    return allowance.toString();\n  };\n}\n"]}
\ No newline at end of file
diff --git a/dist/bridge-controller.d.cts.map b/dist/bridge-controller.d.cts.map
index 2616003e372ab90fc7304561293f57430b4bdc21..d2c4286804c44dcf09e20e731bb11a44ece1514d 100644
--- a/dist/bridge-controller.d.cts.map
+++ b/dist/bridge-controller.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-controller.d.cts","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,EAAE,aAAa,EAAE,mCAAmC;AAIhE,OAAO,KAAK,EAAE,qBAAqB,EAAE,yCAAyC;AAG9E,OAAO,KAAK,EAAE,cAAc,EAAE,+BAA2B;AACzD,OAAO,EACL,sBAAsB,EAKvB,+BAA2B;AAM5B,OAAO,KAAK,EACV,SAAS,EACT,mBAAmB,EACnB,UAAU,EAEV,aAAa,EACb,qBAAqB,EACrB,yBAAyB,EACzB,aAAa,EACd,oBAAgB;AAwBjB,OAAO,EACL,WAAW,EACX,2BAA2B,EAE3B,0BAA0B,EAC3B,sCAAkC;AAUnC,OAAO,KAAK,EAGV,8BAA8B,EAC/B,kCAA8B;AAC/B,OAAO,KAAK,EAAE,8BAA8B,EAAE,kCAA8B;AAI5E,OAAO,KAAK,EAAE,SAAS,EAAE,+BAA2B;AA2DpD;;;;;;GAMG;AACH,KAAK,kBAAkB,GAAG;IACxB,mBAAmB,EAAE,mBAAmB,CAAC;IACzC,OAAO,EAAE,IAAI,CACX,8BAA8B,EAC9B,0BAA0B,CAAC,WAAW,CACvC,CAAC,0BAA0B,CAAC,WAAW,CAAC,GACvC,IAAI,CACF,8BAA8B,EAC9B,0BAA0B,CAAC,eAAe,CAC3C,CAAC,0BAA0B,CAAC,eAAe,CAAC,CAAC;CACjD,CAAC;;;;;;;;;;;;;;;;AAEF,qBAAa,gBAAiB,SAAQ,sBACpC,OAAO,sBAAsB,EAC7B,qBAAqB,EACrB,yBAAyB,CAC1B;;gBAkCa,EACV,SAAS,EACT,KAAK,EACL,QAAQ,EACR,aAAa,EACb,eAAe,EACf,OAAO,EACP,MAAM,EACN,kBAAkB,EAClB,OAAO,GACR,EAAE;QACD,SAAS,EAAE,yBAAyB,CAAC;QACrC,KAAK,CAAC,EAAE,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACvC,QAAQ,EAAE,cAAc,CAAC;QACzB,aAAa,EAAE,MAAM,CAAC;QACtB,eAAe,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,eAAe,CAAC;QACxE,OAAO,EAAE,aAAa,CAAC;QACvB,MAAM,CAAC,EAAE;YACP,sBAAsB,CAAC,EAAE,MAAM,CAAC;SACjC,CAAC;QACF,kBAAkB,EAAE,CAClB,SAAS,SACP,CAAC,OAAO,0BAA0B,CAAC,CAAC,MAAM,OAAO,0BAA0B,CAAC,EAE9E,SAAS,EAAE,SAAS,EACpB,UAAU,EAAE,8BAA8B,CAAC,SAAS,CAAC,KAClD,IAAI,CAAC;QACV,OAAO,CAAC,EAAE,aAAa,CAAC;KACzB;IAiDD,YAAY,iBAAwB,kBAAkB,mBAEpD;IAEF,8BAA8B,mBACZ,QAAQ,mBAAmB,CAAC,GAAG;QAC7C,aAAa,EAAE,mBAAmB,CAAC,eAAe,CAAC,CAAC;KACrD,WACQ,kBAAkB,CAAC,SAAS,CAAC,mBAqDtC;IAEF;;;;;;;;OAQG;IACH,WAAW,iBACK,mBAAmB,gBACpB,WAAW,GAAG,IAAI,cACpB,SAAS,GAAG,IAAI,KAC1B,QAAQ,CAAC,aAAa,GAAG,SAAS,GAAG,UAAU,CAAC,EAAE,CAAC,CA+BpD;IAyJF,oBAAoB,YACT,WAAW,YACV,8BAA8B,CAAC,2BAA2B,cAAc,CAAC,UAYnF;IAEF;;;;;;OAMG;IACH,WAAW,aAAc,2BAA2B,UAElD;IAEF,UAAU,iCAoBR;IAEF;;OAEG;IACH,sBAAsB,aAUpB;IAqaF;;;;;;;;;OASG;IACH,2BAA2B,iKAuBzB;CA+BH"}
\ No newline at end of file
+{"version":3,"file":"bridge-controller.d.cts","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,EAAE,aAAa,EAAE,mCAAmC;AAIhE,OAAO,KAAK,EAAE,qBAAqB,EAAE,yCAAyC;AAG9E,OAAO,KAAK,EAAE,cAAc,EAAE,+BAA2B;AACzD,OAAO,EACL,sBAAsB,EAKvB,+BAA2B;AAM5B,OAAO,KAAK,EACV,SAAS,EACT,mBAAmB,EACnB,UAAU,EAEV,aAAa,EACb,qBAAqB,EACrB,yBAAyB,EACzB,aAAa,EACd,oBAAgB;AAwBjB,OAAO,EACL,WAAW,EACX,2BAA2B,EAE3B,0BAA0B,EAC3B,sCAAkC;AAUnC,OAAO,KAAK,EAGV,8BAA8B,EAC/B,kCAA8B;AAC/B,OAAO,KAAK,EAAE,8BAA8B,EAAE,kCAA8B;AAI5E,OAAO,KAAK,EAAE,SAAS,EAAE,+BAA2B;AA2DpD;;;;;;GAMG;AACH,KAAK,kBAAkB,GAAG;IACxB,mBAAmB,EAAE,mBAAmB,CAAC;IACzC,OAAO,EAAE,IAAI,CACX,8BAA8B,EAC9B,0BAA0B,CAAC,WAAW,CACvC,CAAC,0BAA0B,CAAC,WAAW,CAAC,GACvC,IAAI,CACF,8BAA8B,EAC9B,0BAA0B,CAAC,eAAe,CAC3C,CAAC,0BAA0B,CAAC,eAAe,CAAC,CAAC;CACjD,CAAC;;;;;;;;;;;;;;;;AAEF,qBAAa,gBAAiB,SAAQ,sBACpC,OAAO,sBAAsB,EAC7B,qBAAqB,EACrB,yBAAyB,CAC1B;;gBAkCa,EACV,SAAS,EACT,KAAK,EACL,QAAQ,EACR,aAAa,EACb,eAAe,EACf,OAAO,EACP,MAAM,EACN,kBAAkB,EAClB,OAAO,GACR,EAAE;QACD,SAAS,EAAE,yBAAyB,CAAC;QACrC,KAAK,CAAC,EAAE,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACvC,QAAQ,EAAE,cAAc,CAAC;QACzB,aAAa,EAAE,MAAM,CAAC;QACtB,eAAe,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,eAAe,CAAC;QACxE,OAAO,EAAE,aAAa,CAAC;QACvB,MAAM,CAAC,EAAE;YACP,sBAAsB,CAAC,EAAE,MAAM,CAAC;SACjC,CAAC;QACF,kBAAkB,EAAE,CAClB,SAAS,SACP,CAAC,OAAO,0BAA0B,CAAC,CAAC,MAAM,OAAO,0BAA0B,CAAC,EAE9E,SAAS,EAAE,SAAS,EACpB,UAAU,EAAE,8BAA8B,CAAC,SAAS,CAAC,KAClD,IAAI,CAAC;QACV,OAAO,CAAC,EAAE,aAAa,CAAC;KACzB;IAiDD,YAAY,iBAAwB,kBAAkB,mBAEpD;IAEF,8BAA8B,mBACZ,QAAQ,mBAAmB,CAAC,GAAG;QAC7C,aAAa,EAAE,mBAAmB,CAAC,eAAe,CAAC,CAAC;KACrD,WACQ,kBAAkB,CAAC,SAAS,CAAC,mBAqDtC;IAEF;;;;;;;;OAQG;IACH,WAAW,iBACK,mBAAmB,gBACpB,WAAW,GAAG,IAAI,cACpB,SAAS,GAAG,IAAI,KAC1B,QAAQ,CAAC,aAAa,GAAG,SAAS,GAAG,UAAU,CAAC,EAAE,CAAC,CAiCpD;IAyJF,oBAAoB,YACT,WAAW,YACV,8BAA8B,CAAC,2BAA2B,cAAc,CAAC,UAYnF;IAEF;;;;;;OAMG;IACH,WAAW,aAAc,2BAA2B,UAElD;IAEF,UAAU,iCAoBR;IAEF;;OAEG;IACH,sBAAsB,aAUpB;IAsbF;;;;;;;;;OASG;IACH,2BAA2B,iKAuBzB;CA+BH"}
\ No newline at end of file
diff --git a/dist/bridge-controller.d.mts.map b/dist/bridge-controller.d.mts.map
index fd82c85292cd090b9106511d27312f40b1c5c30b..4fccd12e99da5e44bc8a6293fe6637ae1f79b606 100644
--- a/dist/bridge-controller.d.mts.map
+++ b/dist/bridge-controller.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-controller.d.mts","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,EAAE,aAAa,EAAE,mCAAmC;AAIhE,OAAO,KAAK,EAAE,qBAAqB,EAAE,yCAAyC;AAG9E,OAAO,KAAK,EAAE,cAAc,EAAE,+BAA2B;AACzD,OAAO,EACL,sBAAsB,EAKvB,+BAA2B;AAM5B,OAAO,KAAK,EACV,SAAS,EACT,mBAAmB,EACnB,UAAU,EAEV,aAAa,EACb,qBAAqB,EACrB,yBAAyB,EACzB,aAAa,EACd,oBAAgB;AAwBjB,OAAO,EACL,WAAW,EACX,2BAA2B,EAE3B,0BAA0B,EAC3B,sCAAkC;AAUnC,OAAO,KAAK,EAGV,8BAA8B,EAC/B,kCAA8B;AAC/B,OAAO,KAAK,EAAE,8BAA8B,EAAE,kCAA8B;AAI5E,OAAO,KAAK,EAAE,SAAS,EAAE,+BAA2B;AA2DpD;;;;;;GAMG;AACH,KAAK,kBAAkB,GAAG;IACxB,mBAAmB,EAAE,mBAAmB,CAAC;IACzC,OAAO,EAAE,IAAI,CACX,8BAA8B,EAC9B,0BAA0B,CAAC,WAAW,CACvC,CAAC,0BAA0B,CAAC,WAAW,CAAC,GACvC,IAAI,CACF,8BAA8B,EAC9B,0BAA0B,CAAC,eAAe,CAC3C,CAAC,0BAA0B,CAAC,eAAe,CAAC,CAAC;CACjD,CAAC;;;;;;;;;;;;;;;;AAEF,qBAAa,gBAAiB,SAAQ,sBACpC,OAAO,sBAAsB,EAC7B,qBAAqB,EACrB,yBAAyB,CAC1B;;gBAkCa,EACV,SAAS,EACT,KAAK,EACL,QAAQ,EACR,aAAa,EACb,eAAe,EACf,OAAO,EACP,MAAM,EACN,kBAAkB,EAClB,OAAO,GACR,EAAE;QACD,SAAS,EAAE,yBAAyB,CAAC;QACrC,KAAK,CAAC,EAAE,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACvC,QAAQ,EAAE,cAAc,CAAC;QACzB,aAAa,EAAE,MAAM,CAAC;QACtB,eAAe,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,eAAe,CAAC;QACxE,OAAO,EAAE,aAAa,CAAC;QACvB,MAAM,CAAC,EAAE;YACP,sBAAsB,CAAC,EAAE,MAAM,CAAC;SACjC,CAAC;QACF,kBAAkB,EAAE,CAClB,SAAS,SACP,CAAC,OAAO,0BAA0B,CAAC,CAAC,MAAM,OAAO,0BAA0B,CAAC,EAE9E,SAAS,EAAE,SAAS,EACpB,UAAU,EAAE,8BAA8B,CAAC,SAAS,CAAC,KAClD,IAAI,CAAC;QACV,OAAO,CAAC,EAAE,aAAa,CAAC;KACzB;IAiDD,YAAY,iBAAwB,kBAAkB,mBAEpD;IAEF,8BAA8B,mBACZ,QAAQ,mBAAmB,CAAC,GAAG;QAC7C,aAAa,EAAE,mBAAmB,CAAC,eAAe,CAAC,CAAC;KACrD,WACQ,kBAAkB,CAAC,SAAS,CAAC,mBAqDtC;IAEF;;;;;;;;OAQG;IACH,WAAW,iBACK,mBAAmB,gBACpB,WAAW,GAAG,IAAI,cACpB,SAAS,GAAG,IAAI,KAC1B,QAAQ,CAAC,aAAa,GAAG,SAAS,GAAG,UAAU,CAAC,EAAE,CAAC,CA+BpD;IAyJF,oBAAoB,YACT,WAAW,YACV,8BAA8B,CAAC,2BAA2B,cAAc,CAAC,UAYnF;IAEF;;;;;;OAMG;IACH,WAAW,aAAc,2BAA2B,UAElD;IAEF,UAAU,iCAoBR;IAEF;;OAEG;IACH,sBAAsB,aAUpB;IAqaF;;;;;;;;;OASG;IACH,2BAA2B,iKAuBzB;CA+BH"}
\ No newline at end of file
+{"version":3,"file":"bridge-controller.d.mts","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,EAAE,aAAa,EAAE,mCAAmC;AAIhE,OAAO,KAAK,EAAE,qBAAqB,EAAE,yCAAyC;AAG9E,OAAO,KAAK,EAAE,cAAc,EAAE,+BAA2B;AACzD,OAAO,EACL,sBAAsB,EAKvB,+BAA2B;AAM5B,OAAO,KAAK,EACV,SAAS,EACT,mBAAmB,EACnB,UAAU,EAEV,aAAa,EACb,qBAAqB,EACrB,yBAAyB,EACzB,aAAa,EACd,oBAAgB;AAwBjB,OAAO,EACL,WAAW,EACX,2BAA2B,EAE3B,0BAA0B,EAC3B,sCAAkC;AAUnC,OAAO,KAAK,EAGV,8BAA8B,EAC/B,kCAA8B;AAC/B,OAAO,KAAK,EAAE,8BAA8B,EAAE,kCAA8B;AAI5E,OAAO,KAAK,EAAE,SAAS,EAAE,+BAA2B;AA2DpD;;;;;;GAMG;AACH,KAAK,kBAAkB,GAAG;IACxB,mBAAmB,EAAE,mBAAmB,CAAC;IACzC,OAAO,EAAE,IAAI,CACX,8BAA8B,EAC9B,0BAA0B,CAAC,WAAW,CACvC,CAAC,0BAA0B,CAAC,WAAW,CAAC,GACvC,IAAI,CACF,8BAA8B,EAC9B,0BAA0B,CAAC,eAAe,CAC3C,CAAC,0BAA0B,CAAC,eAAe,CAAC,CAAC;CACjD,CAAC;;;;;;;;;;;;;;;;AAEF,qBAAa,gBAAiB,SAAQ,sBACpC,OAAO,sBAAsB,EAC7B,qBAAqB,EACrB,yBAAyB,CAC1B;;gBAkCa,EACV,SAAS,EACT,KAAK,EACL,QAAQ,EACR,aAAa,EACb,eAAe,EACf,OAAO,EACP,MAAM,EACN,kBAAkB,EAClB,OAAO,GACR,EAAE;QACD,SAAS,EAAE,yBAAyB,CAAC;QACrC,KAAK,CAAC,EAAE,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACvC,QAAQ,EAAE,cAAc,CAAC;QACzB,aAAa,EAAE,MAAM,CAAC;QACtB,eAAe,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,eAAe,CAAC;QACxE,OAAO,EAAE,aAAa,CAAC;QACvB,MAAM,CAAC,EAAE;YACP,sBAAsB,CAAC,EAAE,MAAM,CAAC;SACjC,CAAC;QACF,kBAAkB,EAAE,CAClB,SAAS,SACP,CAAC,OAAO,0BAA0B,CAAC,CAAC,MAAM,OAAO,0BAA0B,CAAC,EAE9E,SAAS,EAAE,SAAS,EACpB,UAAU,EAAE,8BAA8B,CAAC,SAAS,CAAC,KAClD,IAAI,CAAC;QACV,OAAO,CAAC,EAAE,aAAa,CAAC;KACzB;IAiDD,YAAY,iBAAwB,kBAAkB,mBAEpD;IAEF,8BAA8B,mBACZ,QAAQ,mBAAmB,CAAC,GAAG;QAC7C,aAAa,EAAE,mBAAmB,CAAC,eAAe,CAAC,CAAC;KACrD,WACQ,kBAAkB,CAAC,SAAS,CAAC,mBAqDtC;IAEF;;;;;;;;OAQG;IACH,WAAW,iBACK,mBAAmB,gBACpB,WAAW,GAAG,IAAI,cACpB,SAAS,GAAG,IAAI,KAC1B,QAAQ,CAAC,aAAa,GAAG,SAAS,GAAG,UAAU,CAAC,EAAE,CAAC,CAiCpD;IAyJF,oBAAoB,YACT,WAAW,YACV,8BAA8B,CAAC,2BAA2B,cAAc,CAAC,UAYnF;IAEF;;;;;;OAMG;IACH,WAAW,aAAc,2BAA2B,UAElD;IAEF,UAAU,iCAoBR;IAEF;;OAEG;IACH,sBAAsB,aAUpB;IAsbF;;;;;;;;;OASG;IACH,2BAA2B,iKAuBzB;CA+BH"}
\ No newline at end of file
diff --git a/dist/bridge-controller.mjs b/dist/bridge-controller.mjs
index 76ef1e2a2e71f899a10fcf17752f7a34e2b72905..2d4e840a5d13b30def4a37c876233c1a95292828 100644
--- a/dist/bridge-controller.mjs
+++ b/dist/bridge-controller.mjs
@@ -9,7 +9,7 @@ var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (
     if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
     return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
 };
-var _BridgeController_instances, _BridgeController_abortController, _BridgeController_quotesFirstFetched, _BridgeController_location, _BridgeController_clientId, _BridgeController_clientVersion, _BridgeController_getLayer1GasFee, _BridgeController_fetchFn, _BridgeController_trackMetaMetricsFn, _BridgeController_trace, _BridgeController_config, _BridgeController_trackResponseValidationFailures, _BridgeController_getExchangeRateSources, _BridgeController_fetchAssetExchangeRates, _BridgeController_hasInsufficientBalance, _BridgeController_shouldResetApproval, _BridgeController_fetchBridgeQuotes, _BridgeController_handleQuoteStreaming, _BridgeController_setMinimumBalanceForRentExemptionInLamports, _BridgeController_getMultichainSelectedAccount, _BridgeController_getNetworkClientByChainId, _BridgeController_getRequestMetadata, _BridgeController_getQuoteFetchData, _BridgeController_getEventProperties, _BridgeController_trackInputChangedEvents, _BridgeController_getUSDTMainnetAllowance;
+var _BridgeController_instances, _BridgeController_abortController, _BridgeController_quotesFirstFetched, _BridgeController_location, _BridgeController_clientId, _BridgeController_clientVersion, _BridgeController_getLayer1GasFee, _BridgeController_fetchFn, _BridgeController_trackMetaMetricsFn, _BridgeController_trace, _BridgeController_config, _BridgeController_trackResponseValidationFailures, _BridgeController_getExchangeRateSources, _BridgeController_fetchAssetExchangeRates, _BridgeController_hasInsufficientBalance, _BridgeController_shouldResetApproval, _BridgeController_fetchBridgeQuotes, _BridgeController_handleQuoteStreaming, _BridgeController_setMinimumBalanceForRentExemptionInLamports, _BridgeController_getMultichainSelectedAccount, _BridgeController_getNetworkClientByChainId, _BridgeController_getJwt, _BridgeController_getRequestMetadata, _BridgeController_getQuoteFetchData, _BridgeController_getEventProperties, _BridgeController_trackInputChangedEvents, _BridgeController_getUSDTMainnetAllowance;
 /* eslint-disable @typescript-eslint/explicit-function-return-type */
 import { BigNumber } from "@ethersproject/bignumber";
 import { Contract } from "@ethersproject/contracts";
@@ -180,6 +180,7 @@ export class BridgeController extends StaticIntervalPollingController() {
          */
         this.fetchQuotes = async (quoteRequest, abortSignal = null, featureId = null) => {
             const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);
+            const jwt = await __classPrivateFieldGet(this, _BridgeController_getJwt, "f").call(this);
             // If featureId is specified, retrieve the quoteRequestOverrides for that featureId
             const quoteRequestOverrides = featureId
                 ? bridgeFeatureFlags.quoteRequestOverrides?.[featureId]
@@ -188,7 +189,7 @@ export class BridgeController extends StaticIntervalPollingController() {
             // If quoteRequestOverrides is specified, merge it with the quoteRequest
             const { quotes: baseQuotes, validationFailures } = await fetchBridgeQuotes(quoteRequestOverrides
                 ? { ...quoteRequest, ...quoteRequestOverrides, resetApproval }
-                : { ...quoteRequest, resetApproval }, abortSignal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), __classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL, featureId, __classPrivateFieldGet(this, _BridgeController_clientVersion, "f"));
+                : { ...quoteRequest, resetApproval }, abortSignal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), jwt, __classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL, featureId, __classPrivateFieldGet(this, _BridgeController_clientVersion, "f"));
             __classPrivateFieldGet(this, _BridgeController_trackResponseValidationFailures, "f").call(this, validationFailures);
             const quotesWithFees = await appendFeesToQuotes(baseQuotes, this.messenger, __classPrivateFieldGet(this, _BridgeController_getLayer1GasFee, "f"), __classPrivateFieldGet(this, _BridgeController_instances, "m", _BridgeController_getMultichainSelectedAccount).call(this, quoteRequest.walletAddress));
             return sortQuotes(quotesWithFees, featureId);
@@ -355,6 +356,7 @@ export class BridgeController extends StaticIntervalPollingController() {
                 state.quotesLastFetched = Date.now();
                 state.quotesLoadingStatus = RequestStatus.LOADING;
             });
+            const jwt = await __classPrivateFieldGet(this, _BridgeController_getJwt, "f").call(this);
             try {
                 await __classPrivateFieldGet(this, _BridgeController_trace, "f").call(this, {
                     name: isCrossChain(updatedQuoteRequest.srcChainId, updatedQuoteRequest.destChainId)
@@ -371,7 +373,7 @@ export class BridgeController extends StaticIntervalPollingController() {
                     __classPrivateFieldGet(this, _BridgeController_setMinimumBalanceForRentExemptionInLamports, "f").call(this, updatedQuoteRequest.srcChainId, selectedAccount?.metadata?.snap?.id);
                     // Use SSE if enabled and return early
                     if (shouldStream) {
-                        await __classPrivateFieldGet(this, _BridgeController_handleQuoteStreaming, "f").call(this, updatedQuoteRequest, selectedAccount);
+                        await __classPrivateFieldGet(this, _BridgeController_handleQuoteStreaming, "f").call(this, updatedQuoteRequest, jwt, selectedAccount);
                         return;
                     }
                     // Otherwise use regular fetch
@@ -438,7 +440,7 @@ export class BridgeController extends StaticIntervalPollingController() {
                 this.stopAllPolling();
             }
         });
-        _BridgeController_handleQuoteStreaming.set(this, async (updatedQuoteRequest, selectedAccount) => {
+        _BridgeController_handleQuoteStreaming.set(this, async (updatedQuoteRequest, jwt, selectedAccount) => {
             /**
              * Tracks the number of valid quotes received from the current stream, which is used
              * to determine when to clear the quotes list and set the initial load time
@@ -449,7 +451,7 @@ export class BridgeController extends StaticIntervalPollingController() {
              * before setting quotesLoadingStatus to FETCHED
              */
             const pendingFeeAppendPromises = new Set();
-            await fetchBridgeQuoteStream(__classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), updatedQuoteRequest, __classPrivateFieldGet(this, _BridgeController_abortController, "f")?.signal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL, {
+            await fetchBridgeQuoteStream(__classPrivateFieldGet(this, _BridgeController_fetchFn, "f"), updatedQuoteRequest, __classPrivateFieldGet(this, _BridgeController_abortController, "f")?.signal, __classPrivateFieldGet(this, _BridgeController_clientId, "f"), jwt, __classPrivateFieldGet(this, _BridgeController_config, "f").customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL, {
                 onValidationFailure: __classPrivateFieldGet(this, _BridgeController_trackResponseValidationFailures, "f"),
                 onValidQuoteReceived: async (quote) => {
                     const feeAppendPromise = (async () => {
@@ -513,6 +515,16 @@ export class BridgeController extends StaticIntervalPollingController() {
                     minimumBalanceForRentExemptionInLamports;
             });
         });
+        _BridgeController_getJwt.set(this, async () => {
+            try {
+                const token = await this.messenger.call('AuthenticationController:getBearerToken');
+                return token;
+            }
+            catch (error) {
+                console.error('Error getting JWT token for bridge-api request', error);
+                return undefined;
+            }
+        });
         _BridgeController_getRequestMetadata.set(this, () => {
             return {
                 slippage_limit: this.state.quoteRequest.slippage,
@@ -679,7 +691,7 @@ export class BridgeController extends StaticIntervalPollingController() {
         this.messenger.registerActionHandler(`${BRIDGE_CONTROLLER_NAME}:fetchQuotes`, this.fetchQuotes.bind(this));
     }
 }
-_BridgeController_abortController = new WeakMap(), _BridgeController_quotesFirstFetched = new WeakMap(), _BridgeController_location = new WeakMap(), _BridgeController_clientId = new WeakMap(), _BridgeController_clientVersion = new WeakMap(), _BridgeController_getLayer1GasFee = new WeakMap(), _BridgeController_fetchFn = new WeakMap(), _BridgeController_trackMetaMetricsFn = new WeakMap(), _BridgeController_trace = new WeakMap(), _BridgeController_config = new WeakMap(), _BridgeController_trackResponseValidationFailures = new WeakMap(), _BridgeController_getExchangeRateSources = new WeakMap(), _BridgeController_fetchAssetExchangeRates = new WeakMap(), _BridgeController_hasInsufficientBalance = new WeakMap(), _BridgeController_shouldResetApproval = new WeakMap(), _BridgeController_fetchBridgeQuotes = new WeakMap(), _BridgeController_handleQuoteStreaming = new WeakMap(), _BridgeController_setMinimumBalanceForRentExemptionInLamports = new WeakMap(), _BridgeController_getRequestMetadata = new WeakMap(), _BridgeController_getQuoteFetchData = new WeakMap(), _BridgeController_getEventProperties = new WeakMap(), _BridgeController_trackInputChangedEvents = new WeakMap(), _BridgeController_getUSDTMainnetAllowance = new WeakMap(), _BridgeController_instances = new WeakSet(), _BridgeController_getMultichainSelectedAccount = function _BridgeController_getMultichainSelectedAccount(walletAddress) {
+_BridgeController_abortController = new WeakMap(), _BridgeController_quotesFirstFetched = new WeakMap(), _BridgeController_location = new WeakMap(), _BridgeController_clientId = new WeakMap(), _BridgeController_clientVersion = new WeakMap(), _BridgeController_getLayer1GasFee = new WeakMap(), _BridgeController_fetchFn = new WeakMap(), _BridgeController_trackMetaMetricsFn = new WeakMap(), _BridgeController_trace = new WeakMap(), _BridgeController_config = new WeakMap(), _BridgeController_trackResponseValidationFailures = new WeakMap(), _BridgeController_getExchangeRateSources = new WeakMap(), _BridgeController_fetchAssetExchangeRates = new WeakMap(), _BridgeController_hasInsufficientBalance = new WeakMap(), _BridgeController_shouldResetApproval = new WeakMap(), _BridgeController_fetchBridgeQuotes = new WeakMap(), _BridgeController_handleQuoteStreaming = new WeakMap(), _BridgeController_setMinimumBalanceForRentExemptionInLamports = new WeakMap(), _BridgeController_getJwt = new WeakMap(), _BridgeController_getRequestMetadata = new WeakMap(), _BridgeController_getQuoteFetchData = new WeakMap(), _BridgeController_getEventProperties = new WeakMap(), _BridgeController_trackInputChangedEvents = new WeakMap(), _BridgeController_getUSDTMainnetAllowance = new WeakMap(), _BridgeController_instances = new WeakSet(), _BridgeController_getMultichainSelectedAccount = function _BridgeController_getMultichainSelectedAccount(walletAddress) {
     const addressToUse = walletAddress ?? this.state.quoteRequest.walletAddress;
     if (!addressToUse) {
         throw new Error('Account address is required');
diff --git a/dist/bridge-controller.mjs.map b/dist/bridge-controller.mjs.map
index 966b5bddc1f3713f5c8d8c096a72818d231bbbcf..d141d53469e321e79b389b14895d8f376a5afd2a 100644
--- a/dist/bridge-controller.mjs.map
+++ b/dist/bridge-controller.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-controller.mjs","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { BigNumber } from '@ethersproject/bignumber';\nimport { Contract } from '@ethersproject/contracts';\nimport { Web3Provider } from '@ethersproject/providers';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport type { InternalAccount } from '@metamask/keyring-internal-api';\nimport { abiERC20 } from '@metamask/metamask-eth-abis';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport type { TransactionController } from '@metamask/transaction-controller';\nimport type { CaipAssetType, Hex } from '@metamask/utils';\n\nimport type { BridgeClientId } from './constants/bridge';\nimport {\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_PROD_API_BASE_URL,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_ETHEREUM_ADDRESS,\n  REFRESH_INTERVAL_MS,\n} from './constants/bridge';\nimport { CHAIN_IDS } from './constants/chains';\nimport { SWAPS_CONTRACT_ADDRESSES } from './constants/swaps';\nimport { TraceName } from './constants/traces';\nimport { selectIsAssetExchangeRateInState } from './selectors';\nimport { RequestStatus } from './types';\nimport type {\n  L1GasFees,\n  GenericQuoteRequest,\n  NonEvmFees,\n  QuoteRequest,\n  QuoteResponse,\n  BridgeControllerState,\n  BridgeControllerMessenger,\n  FetchFunction,\n} from './types';\nimport { getAssetIdsForToken, toExchangeRates } from './utils/assets';\nimport { hasSufficientBalance } from './utils/balance';\nimport {\n  getDefaultBridgeControllerState,\n  isCrossChain,\n  isEthUsdt,\n  isNonEvmChainId,\n  isSolanaChainId,\n} from './utils/bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToCaip,\n  formatChainIdToHex,\n} from './utils/caip-formatters';\nimport {\n  getBridgeFeatureFlags,\n  hasMinimumRequiredVersion,\n} from './utils/feature-flags';\nimport {\n  fetchAssetPrices,\n  fetchBridgeQuotes,\n  fetchBridgeQuoteStream,\n} from './utils/fetch';\nimport {\n  AbortReason,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  UnifiedSwapBridgeEventName,\n} from './utils/metrics/constants';\nimport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapTypeFromQuote,\n  isCustomSlippage,\n  isHardwareWallet,\n  toInputChangedPropertyKey,\n  toInputChangedPropertyValue,\n} from './utils/metrics/properties';\nimport type {\n  QuoteFetchData,\n  RequestMetadata,\n  RequiredEventContextFromClient,\n} from './utils/metrics/types';\nimport type { CrossChainSwapsEventProperties } from './utils/metrics/types';\nimport { isValidQuoteRequest, sortQuotes } from './utils/quote';\nimport { appendFeesToQuotes } from './utils/quote-fees';\nimport { getMinimumBalanceForRentExemptionInLamports } from './utils/snaps';\nimport type { FeatureId } from './utils/validators';\n\nconst metadata: StateMetadata<BridgeControllerState> = {\n  quoteRequest: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotes: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesInitialLoadTime: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLastFetched: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLoadingStatus: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quoteFetchError: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesRefreshCount: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  assetExchangeRates: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  minimumBalanceForRentExemptionInLamports: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/**\n * The input to start polling for the {@link BridgeController}\n *\n * @param updatedQuoteRequest - The updated quote request\n * @param context - The context contains properties that can't be populated by the\n * controller and need to be provided by the client for analytics\n */\ntype BridgePollingInput = {\n  updatedQuoteRequest: GenericQuoteRequest;\n  context: Pick<\n    RequiredEventContextFromClient,\n    UnifiedSwapBridgeEventName.QuotesError\n  >[UnifiedSwapBridgeEventName.QuotesError] &\n    Pick<\n      RequiredEventContextFromClient,\n      UnifiedSwapBridgeEventName.QuotesRequested\n    >[UnifiedSwapBridgeEventName.QuotesRequested];\n};\n\nexport class BridgeController extends StaticIntervalPollingController<BridgePollingInput>()<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState,\n  BridgeControllerMessenger\n> {\n  #abortController: AbortController | undefined;\n\n  #quotesFirstFetched: number | undefined;\n\n  /**\n   * Stores the location/entry point from which the user initiated the swap or bridge flow.\n   * Set via setLocation() before navigating to the swap/bridge flow.\n   * Used as default for all subsequent internal events.\n   */\n  #location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #clientVersion: string;\n\n  readonly #getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #trackMetaMetricsFn: <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    properties: CrossChainSwapsEventProperties<EventName>,\n  ) => void;\n\n  readonly #trace: TraceCallback;\n\n  readonly #config: {\n    customBridgeApiBaseUrl?: string;\n  };\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    clientVersion,\n    getLayer1GasFee,\n    fetchFn,\n    config,\n    trackMetaMetricsFn,\n    traceFn,\n  }: {\n    messenger: BridgeControllerMessenger;\n    state?: Partial<BridgeControllerState>;\n    clientId: BridgeClientId;\n    clientVersion: string;\n    getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n    fetchFn: FetchFunction;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    trackMetaMetricsFn: <\n      EventName extends\n        (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n    >(\n      eventName: EventName,\n      properties: CrossChainSwapsEventProperties<EventName>,\n    ) => void;\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      state: {\n        ...getDefaultBridgeControllerState(),\n        ...state,\n      },\n    });\n\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.#abortController = new AbortController();\n    this.#getLayer1GasFee = getLayer1GasFee;\n    this.#clientId = clientId;\n    this.#clientVersion = clientVersion;\n    this.#fetchFn = fetchFn;\n    this.#trackMetaMetricsFn = trackMetaMetricsFn;\n    this.#config = config ?? {};\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,\n      this.setChainIntervalLength.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,\n      this.updateBridgeQuoteRequestParams.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,\n      this.trackUnifiedSwapBridgeEvent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,\n      this.stopPollingForQuotes.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:fetchQuotes`,\n      this.fetchQuotes.bind(this),\n    );\n  }\n\n  _executePoll = async (pollingInput: BridgePollingInput) => {\n    await this.#fetchBridgeQuotes(pollingInput);\n  };\n\n  updateBridgeQuoteRequestParams = async (\n    paramsToUpdate: Partial<GenericQuoteRequest> & {\n      walletAddress: GenericQuoteRequest['walletAddress'];\n    },\n    context: BridgePollingInput['context'],\n  ) => {\n    this.#trackInputChangedEvents(paramsToUpdate);\n    this.resetState(AbortReason.QuoteRequestUpdated);\n    const updatedQuoteRequest = {\n      ...DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,\n      ...paramsToUpdate,\n    };\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n    });\n\n    if (isValidQuoteRequest(updatedQuoteRequest)) {\n      this.#quotesFirstFetched = Date.now();\n      const isSrcChainNonEVM = isNonEvmChainId(updatedQuoteRequest.srcChainId);\n      const providerConfig = isSrcChainNonEVM\n        ? undefined\n        : this.#getNetworkClientByChainId(\n            formatChainIdToHex(updatedQuoteRequest.srcChainId),\n          )?.configuration;\n\n      let insufficientBal: boolean | undefined;\n      let resetApproval: boolean = Boolean(paramsToUpdate.resetApproval);\n      if (isSrcChainNonEVM) {\n        // If the source chain is not an EVM network, use value from params\n        insufficientBal = paramsToUpdate.insufficientBal;\n      } else if (providerConfig?.rpcUrl?.includes('tenderly')) {\n        // If the rpcUrl is a tenderly fork (e2e tests), set insufficientBal=true\n        // The bridge-api filters out quotes if the balance on mainnet is insufficient so this override allows quotes to always be returned\n        insufficientBal = true;\n      } else {\n        // Set loading status if RPC calls are made before the quotes are fetched\n        this.update((state) => {\n          state.quotesLoadingStatus = RequestStatus.LOADING;\n        });\n        resetApproval = await this.#shouldResetApproval(updatedQuoteRequest);\n        // Otherwise query the src token balance from the RPC provider\n        insufficientBal =\n          paramsToUpdate.insufficientBal ??\n          (await this.#hasInsufficientBalance(updatedQuoteRequest));\n      }\n\n      // Set refresh rate based on the source chain before starting polling\n      this.setChainIntervalLength();\n      this.startPolling({\n        updatedQuoteRequest: {\n          ...updatedQuoteRequest,\n          insufficientBal,\n          resetApproval,\n        },\n        context,\n      });\n    }\n  };\n\n  /**\n   * Fetches quotes for specified request without updating the controller state\n   * This method does not start polling for quotes and does not emit UnifiedSwapBridge events\n   *\n   * @param quoteRequest - The parameters for quote requests to fetch\n   * @param abortSignal - The abort signal to cancel all the requests\n   * @param featureId - The feature ID that maps to quoteParam overrides from LD\n   * @returns A list of validated quotes\n   */\n  fetchQuotes = async (\n    quoteRequest: GenericQuoteRequest,\n    abortSignal: AbortSignal | null = null,\n    featureId: FeatureId | null = null,\n  ): Promise<(QuoteResponse & L1GasFees & NonEvmFees)[]> => {\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n    // If featureId is specified, retrieve the quoteRequestOverrides for that featureId\n    const quoteRequestOverrides = featureId\n      ? bridgeFeatureFlags.quoteRequestOverrides?.[featureId]\n      : undefined;\n    const resetApproval = await this.#shouldResetApproval(quoteRequest);\n\n    // If quoteRequestOverrides is specified, merge it with the quoteRequest\n    const { quotes: baseQuotes, validationFailures } = await fetchBridgeQuotes(\n      quoteRequestOverrides\n        ? { ...quoteRequest, ...quoteRequestOverrides, resetApproval }\n        : { ...quoteRequest, resetApproval },\n      abortSignal,\n      this.#clientId,\n      this.#fetchFn,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      featureId,\n      this.#clientVersion,\n    );\n\n    this.#trackResponseValidationFailures(validationFailures);\n\n    const quotesWithFees = await appendFeesToQuotes(\n      baseQuotes,\n      this.messenger,\n      this.#getLayer1GasFee,\n      this.#getMultichainSelectedAccount(quoteRequest.walletAddress),\n    );\n\n    return sortQuotes(quotesWithFees, featureId);\n  };\n\n  readonly #trackResponseValidationFailures = (\n    validationFailures: string[],\n  ) => {\n    if (validationFailures.length === 0) {\n      return;\n    }\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesValidationFailed,\n      {\n        failures: validationFailures,\n        location: this.#location,\n      },\n    );\n  };\n\n  readonly #getExchangeRateSources = () => {\n    return {\n      ...this.messenger.call('MultichainAssetsRatesController:getState'),\n      ...this.messenger.call('CurrencyRateController:getState'),\n      ...this.messenger.call('TokenRatesController:getState'),\n      ...this.state,\n    };\n  };\n\n  /**\n   * Fetches the exchange rates for the assets in the quote request if they are not already in the state\n   * In addition to the selected tokens, this also fetches the native asset for the source and destination chains\n   *\n   * @param quoteRequest - The quote request\n   * @param quoteRequest.srcChainId - The source chain ID\n   * @param quoteRequest.srcTokenAddress - The source token address\n   * @param quoteRequest.destChainId - The destination chain ID\n   * @param quoteRequest.destTokenAddress - The destination token address\n   */\n  readonly #fetchAssetExchangeRates = async ({\n    srcChainId,\n    srcTokenAddress,\n    destChainId,\n    destTokenAddress,\n  }: Partial<GenericQuoteRequest>) => {\n    const assetIds: Set<CaipAssetType> = new Set([]);\n    const exchangeRateSources = this.#getExchangeRateSources();\n    if (\n      srcTokenAddress &&\n      srcChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        srcChainId,\n        srcTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(srcTokenAddress, srcChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n    if (\n      destTokenAddress &&\n      destChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        destChainId,\n        destTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(destTokenAddress, destChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n\n    const currency = this.messenger.call(\n      'CurrencyRateController:getState',\n    ).currentCurrency;\n\n    if (assetIds.size === 0) {\n      return;\n    }\n\n    const pricesByAssetId = await fetchAssetPrices({\n      assetIds,\n      currencies: new Set([currency]),\n      clientId: this.#clientId,\n      clientVersion: this.#clientVersion,\n      fetchFn: this.#fetchFn,\n      signal: this.#abortController?.signal,\n    });\n    const exchangeRates = toExchangeRates(currency, pricesByAssetId);\n    this.update((state) => {\n      state.assetExchangeRates = {\n        ...state.assetExchangeRates,\n        ...exchangeRates,\n      };\n    });\n  };\n\n  readonly #hasInsufficientBalance = async (\n    quoteRequest: GenericQuoteRequest,\n  ) => {\n    try {\n      const srcChainIdInHex = formatChainIdToHex(quoteRequest.srcChainId);\n      const provider =\n        this.#getNetworkClientByChainId(srcChainIdInHex)?.provider;\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n\n      return !(\n        provider &&\n        normalizedSrcTokenAddress &&\n        quoteRequest.srcTokenAmount &&\n        srcChainIdInHex &&\n        (await hasSufficientBalance(\n          provider,\n          quoteRequest.walletAddress,\n          normalizedSrcTokenAddress,\n          quoteRequest.srcTokenAmount,\n          srcChainIdInHex,\n        ))\n      );\n    } catch (error) {\n      console.warn('Failed to set insufficientBal', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  readonly #shouldResetApproval = async (quoteRequest: GenericQuoteRequest) => {\n    if (isNonEvmChainId(quoteRequest.srcChainId)) {\n      return false;\n    }\n    try {\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n      if (isEthUsdt(quoteRequest.srcChainId, normalizedSrcTokenAddress)) {\n        const allowance = BigNumber.from(\n          await this.#getUSDTMainnetAllowance(\n            quoteRequest.walletAddress,\n            normalizedSrcTokenAddress,\n            quoteRequest.destChainId,\n          ),\n        );\n        return allowance.lt(quoteRequest.srcTokenAmount) && allowance.gt(0);\n      }\n      return false;\n    } catch (error) {\n      console.warn('Failed to set resetApproval', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  stopPollingForQuotes = (\n    reason?: AbortReason,\n    context?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n  ) => {\n    this.stopAllPolling();\n    // If polling is stopped before quotes finish loading, track QuotesReceived\n    if (this.state.quotesLoadingStatus === RequestStatus.LOADING && context) {\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesReceived,\n        context,\n      );\n    }\n    // Clears quotes list in state\n    this.#abortController?.abort(reason);\n  };\n\n  /**\n   * Sets the location/entry point for the current swap or bridge flow.\n   * Call this when the user enters the flow so that all internally-fired\n   * events (InputChanged, QuotesRequested, etc.) carry the correct location.\n   *\n   * @param location - The entry point from which the user initiated the flow\n   */\n  setLocation = (location: MetaMetricsSwapsEventSource) => {\n    this.#location = location;\n  };\n\n  resetState = (reason = AbortReason.ResetState) => {\n    this.stopPollingForQuotes(reason);\n    this.update((state) => {\n      // Cannot do direct assignment to state, i.e. state = {... }, need to manually assign each field\n      state.quoteRequest = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest;\n      state.quotesInitialLoadTime =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime;\n      state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      state.quotesLastFetched =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched;\n      state.quotesLoadingStatus =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesRefreshCount =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount;\n      state.assetExchangeRates =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates;\n      state.minimumBalanceForRentExemptionInLamports =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  /**\n   * Sets the interval length based on the source chain\n   */\n  setChainIntervalLength = () => {\n    const { state } = this;\n    const { srcChainId } = state.quoteRequest;\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n\n    const refreshRateOverride = srcChainId\n      ? bridgeFeatureFlags.chains[formatChainIdToCaip(srcChainId)]?.refreshRate\n      : undefined;\n    const defaultRefreshRate = bridgeFeatureFlags.refreshRate;\n    this.setIntervalLength(refreshRateOverride ?? defaultRefreshRate);\n  };\n\n  readonly #fetchBridgeQuotes = async ({\n    updatedQuoteRequest,\n    context,\n  }: BridgePollingInput) => {\n    this.#abortController?.abort(AbortReason.NewQuoteRequest);\n    this.#abortController = new AbortController();\n\n    this.#fetchAssetExchangeRates(updatedQuoteRequest).catch((error) =>\n      console.warn('Failed to fetch asset exchange rates', error),\n    );\n\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesRequested,\n      context,\n    );\n\n    const { sse, maxRefreshCount } = getBridgeFeatureFlags(this.messenger);\n    const shouldStream =\n      sse?.enabled &&\n      hasMinimumRequiredVersion(this.#clientVersion, sse.minimumVersion);\n\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesLastFetched = Date.now();\n      state.quotesLoadingStatus = RequestStatus.LOADING;\n    });\n\n    try {\n      await this.#trace(\n        {\n          name: isCrossChain(\n            updatedQuoteRequest.srcChainId,\n            updatedQuoteRequest.destChainId,\n          )\n            ? TraceName.BridgeQuotesFetched\n            : TraceName.SwapQuotesFetched,\n          data: {\n            srcChainId: formatChainIdToCaip(updatedQuoteRequest.srcChainId),\n            destChainId: formatChainIdToCaip(updatedQuoteRequest.destChainId),\n          },\n        },\n        async () => {\n          const selectedAccount = this.#getMultichainSelectedAccount(\n            updatedQuoteRequest.walletAddress,\n          );\n          // This call is not awaited to prevent blocking quote fetching if the snap takes too long to respond\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.#setMinimumBalanceForRentExemptionInLamports(\n            updatedQuoteRequest.srcChainId,\n            selectedAccount?.metadata?.snap?.id,\n          );\n          // Use SSE if enabled and return early\n          if (shouldStream) {\n            await this.#handleQuoteStreaming(\n              updatedQuoteRequest,\n              selectedAccount,\n            );\n            return;\n          }\n          // Otherwise use regular fetch\n          const quotes = await this.fetchQuotes(\n            updatedQuoteRequest,\n            this.#abortController?.signal,\n          );\n          this.update((state) => {\n            // Set the initial load time if this is the first fetch\n            if (\n              state.quotesRefreshCount ===\n                DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount &&\n              this.#quotesFirstFetched\n            ) {\n              state.quotesInitialLoadTime =\n                Date.now() - this.#quotesFirstFetched;\n            }\n            state.quotes = quotes;\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      );\n    } catch (error) {\n      // Reset the quotes list if the fetch fails to avoid showing stale quotes\n      this.update((state) => {\n        state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      });\n      // Ignore abort errors\n      if (\n        (error as Error).toString().includes('AbortError') ||\n        (error as Error).toString().includes('FetchRequestCanceledException') ||\n        [\n          AbortReason.ResetState,\n          AbortReason.NewQuoteRequest,\n          AbortReason.QuoteRequestUpdated,\n          AbortReason.TransactionSubmitted,\n        ].includes(error as AbortReason)\n      ) {\n        // Exit the function early to prevent other state updates\n        return;\n      }\n\n      // Update loading status and error message\n      this.update((state) => {\n        // The error object reference is not guaranteed to exist on mobile so reading\n        // the message directly could cause an error.\n        let errorMessage;\n        try {\n          errorMessage =\n            (error as Error)?.message ?? (error as Error).toString();\n        } catch {\n          // Intentionally empty\n        } finally {\n          state.quoteFetchError = errorMessage ?? 'Unknown error';\n        }\n        state.quotesLoadingStatus = RequestStatus.ERROR;\n      });\n      // Track event and log error\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesError,\n        context,\n      );\n      console.log(\n        `Failed to ${shouldStream ? 'stream' : 'fetch'} bridge quotes`,\n        error,\n      );\n    }\n\n    // Update refresh count after fetching, validation and fee calculation have completed\n    this.update((state) => {\n      state.quotesRefreshCount += 1;\n    });\n    // Stop polling if the maximum number of refreshes has been reached\n    if (\n      updatedQuoteRequest.insufficientBal ||\n      (!updatedQuoteRequest.insufficientBal &&\n        this.state.quotesRefreshCount >= maxRefreshCount)\n    ) {\n      this.stopAllPolling();\n    }\n  };\n\n  readonly #handleQuoteStreaming = async (\n    updatedQuoteRequest: GenericQuoteRequest,\n    selectedAccount?: InternalAccount,\n  ) => {\n    /**\n     * Tracks the number of valid quotes received from the current stream, which is used\n     * to determine when to clear the quotes list and set the initial load time\n     */\n    let validQuotesCounter = 0;\n    /**\n     * Tracks all pending promises from appendFeesToQuotes calls to ensure they complete\n     * before setting quotesLoadingStatus to FETCHED\n     */\n    const pendingFeeAppendPromises = new Set<Promise<void>>();\n\n    await fetchBridgeQuoteStream(\n      this.#fetchFn,\n      updatedQuoteRequest,\n      this.#abortController?.signal,\n      this.#clientId,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      {\n        onValidationFailure: this.#trackResponseValidationFailures,\n        onValidQuoteReceived: async (quote: QuoteResponse) => {\n          const feeAppendPromise = (async () => {\n            const quotesWithFees = await appendFeesToQuotes(\n              [quote],\n              this.messenger,\n              this.#getLayer1GasFee,\n              selectedAccount,\n            );\n            if (quotesWithFees.length > 0) {\n              validQuotesCounter += 1;\n            }\n            this.update((state) => {\n              // Clear previous quotes and quotes load time when first quote in the current\n              // polling loop is received\n              // This enables clients to continue showing the previous quotes while new\n              // quotes are loading\n              // Note: If there are no valid quotes until the 2nd fetch, quotesInitialLoadTime will be > refreshRate\n              if (validQuotesCounter === 1) {\n                state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n                if (!state.quotesInitialLoadTime && this.#quotesFirstFetched) {\n                  // Set the initial load time after the first quote is received\n                  state.quotesInitialLoadTime =\n                    Date.now() - this.#quotesFirstFetched;\n                }\n              }\n              state.quotes = [...state.quotes, ...quotesWithFees];\n            });\n          })();\n          pendingFeeAppendPromises.add(feeAppendPromise);\n          feeAppendPromise\n            .catch((error) => {\n              // Catch errors to prevent them from breaking stream processing\n              // If appendFeesToQuotes throws, the state update never happens, so no invalid entry is added\n              console.error('Error appending fees to quote', error);\n            })\n            .finally(() => {\n              pendingFeeAppendPromises.delete(feeAppendPromise);\n            });\n          // Await the promise to ensure errors are caught and handled before continuing\n          // The promise is also tracked in pendingFeeAppendPromises for onClose to wait for\n          await feeAppendPromise;\n        },\n        onClose: async () => {\n          // Wait for all pending appendFeesToQuotes operations to complete\n          // before setting quotesLoadingStatus to FETCHED\n          await Promise.allSettled(Array.from(pendingFeeAppendPromises));\n          this.update((state) => {\n            // If there are no valid quotes in the current stream, clear the quotes list\n            // to remove quotes from the previous stream\n            if (validQuotesCounter === 0) {\n              state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n            }\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      },\n      this.#clientVersion,\n    );\n  };\n\n  readonly #setMinimumBalanceForRentExemptionInLamports = async (\n    srcChainId: GenericQuoteRequest['srcChainId'],\n    snapId?: string,\n  ) => {\n    if (!isSolanaChainId(srcChainId) || !snapId) {\n      return;\n    }\n    const minimumBalanceForRentExemptionInLamports =\n      await getMinimumBalanceForRentExemptionInLamports(snapId, this.messenger);\n    this.update((state) => {\n      state.minimumBalanceForRentExemptionInLamports =\n        minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  #getMultichainSelectedAccount(\n    walletAddress?: GenericQuoteRequest['walletAddress'],\n  ) {\n    const addressToUse = walletAddress ?? this.state.quoteRequest.walletAddress;\n    if (!addressToUse) {\n      throw new Error('Account address is required');\n    }\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      addressToUse,\n    );\n    return selectedAccount;\n  }\n\n  #getNetworkClientByChainId(chainId: Hex) {\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      chainId,\n    );\n    if (!networkClientId) {\n      throw new Error(`No network client found for chainId: ${chainId}`);\n    }\n    const networkClient = this.messenger.call(\n      'NetworkController:getNetworkClientById',\n      networkClientId,\n    );\n    return networkClient;\n  }\n\n  readonly #getRequestMetadata = (): Omit<\n    RequestMetadata,\n    | 'stx_enabled'\n    | 'usd_amount_source'\n    | 'security_warnings'\n    | 'is_hardware_wallet'\n  > => {\n    return {\n      slippage_limit: this.state.quoteRequest.slippage,\n      swap_type: getSwapTypeFromQuote(this.state.quoteRequest),\n      custom_slippage: isCustomSlippage(this.state.quoteRequest.slippage),\n    };\n  };\n\n  readonly #getQuoteFetchData = (): Omit<\n    QuoteFetchData,\n    'best_quote_provider' | 'price_impact' | 'can_submit'\n  > => {\n    return {\n      quotes_count: this.state.quotes.length,\n      quotes_list: this.state.quotes.map(({ quote }) =>\n        formatProviderLabel(quote),\n      ),\n      initial_load_time_all_quotes: this.state.quotesInitialLoadTime ?? 0,\n      has_gas_included_quote: this.state.quotes.some(\n        ({ quote }) => quote.gasIncluded,\n      ),\n    };\n  };\n\n  readonly #getEventProperties = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): CrossChainSwapsEventProperties<EventName> => {\n    const clientProps = propertiesFromClient as Record<string, unknown>;\n    const baseProperties = {\n      ...propertiesFromClient,\n      location: clientProps?.location ?? this.#location,\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n    };\n    switch (eventName) {\n      case UnifiedSwapBridgeEventName.ButtonClicked:\n      case UnifiedSwapBridgeEventName.PageViewed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesValidationFailed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesReceived:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesRequested:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesError:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          error_message: this.state.quoteFetchError,\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.AllQuotesOpened:\n      case UnifiedSwapBridgeEventName.AllQuotesSorted:\n      case UnifiedSwapBridgeEventName.QuoteSelected:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.Failed: {\n        // Populate the properties that the error occurred before the tx was submitted\n        return {\n          ...baseProperties,\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          ...propertiesFromClient,\n        };\n      }\n      case UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:\n        return baseProperties;\n      // These events may be published after the bridge-controller state is reset\n      // So the BridgeStatusController populates all the properties\n      case UnifiedSwapBridgeEventName.Submitted:\n      case UnifiedSwapBridgeEventName.Completed:\n        return propertiesFromClient;\n      case UnifiedSwapBridgeEventName.InputChanged:\n      default:\n        return baseProperties;\n    }\n  };\n\n  readonly #trackInputChangedEvents = (\n    paramsToUpdate: Partial<GenericQuoteRequest>,\n  ) => {\n    Object.entries(paramsToUpdate).forEach(([key, value]) => {\n      const inputKey = toInputChangedPropertyKey[key as keyof QuoteRequest];\n      const inputValue =\n        toInputChangedPropertyValue[key as keyof QuoteRequest]?.(\n          paramsToUpdate,\n        );\n      if (\n        inputKey &&\n        inputValue !== undefined &&\n        value !== this.state.quoteRequest[key as keyof GenericQuoteRequest]\n      ) {\n        this.trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.InputChanged,\n          {\n            input: inputKey,\n            input_value: inputValue,\n            location: this.#location,\n          },\n        );\n      }\n    });\n  };\n\n  /**\n   * This method tracks cross-chain swaps events\n   *\n   * @param eventName - The name of the event to track\n   * @param propertiesFromClient - Properties that can't be calculated from the event name and need to be provided by the client\n   * @example\n   * this.trackUnifiedSwapBridgeEvent(UnifiedSwapBridgeEventName.ActionOpened, {\n   *   location: MetaMetricsSwapsEventSource.MainView,\n   * });\n   */\n  trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ) => {\n    try {\n      const combinedPropertiesForEvent = this.#getEventProperties<EventName>(\n        eventName,\n        propertiesFromClient,\n      );\n\n      this.#trackMetaMetricsFn(eventName, combinedPropertiesForEvent);\n    } catch (error) {\n      console.error(\n        `Error tracking cross-chain swaps MetaMetrics event ${eventName}`,\n        error,\n      );\n    }\n  };\n\n  /**\n   *\n   * @param walletAddress - The address of the account to get the allowance for\n   * @param contractAddress - The address of the ERC20 token contract on mainnet\n   * @param destinationChainId - The chain ID of the destination network\n   * @returns The atomic allowance of the ERC20 token contract\n   */\n  readonly #getUSDTMainnetAllowance = async (\n    walletAddress: string,\n    contractAddress: string,\n    destinationChainId: GenericQuoteRequest['destChainId'],\n  ): Promise<string> => {\n    const networkClient = this.#getNetworkClientByChainId(CHAIN_IDS.MAINNET);\n    const provider = networkClient?.provider;\n    if (!provider) {\n      throw new Error('No provider found');\n    }\n\n    const ethersProvider = new Web3Provider(provider);\n    const contract = new Contract(contractAddress, abiERC20, ethersProvider);\n    const spenderAddress = isCrossChain(CHAIN_IDS.MAINNET, destinationChainId)\n      ? METABRIDGE_ETHEREUM_ADDRESS\n      : SWAPS_CONTRACT_ADDRESSES[CHAIN_IDS.MAINNET];\n    const allowance: BigNumber = await contract.allowance(\n      walletAddress,\n      spenderAddress,\n    );\n    return allowance.toString();\n  };\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"bridge-controller.mjs","sourceRoot":"","sources":["../src/bridge-controller.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { BigNumber } from '@ethersproject/bignumber';\nimport { Contract } from '@ethersproject/contracts';\nimport { Web3Provider } from '@ethersproject/providers';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport type { InternalAccount } from '@metamask/keyring-internal-api';\nimport { abiERC20 } from '@metamask/metamask-eth-abis';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport type { TransactionController } from '@metamask/transaction-controller';\nimport type { CaipAssetType, Hex } from '@metamask/utils';\n\nimport type { BridgeClientId } from './constants/bridge';\nimport {\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_PROD_API_BASE_URL,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_ETHEREUM_ADDRESS,\n  REFRESH_INTERVAL_MS,\n} from './constants/bridge';\nimport { CHAIN_IDS } from './constants/chains';\nimport { SWAPS_CONTRACT_ADDRESSES } from './constants/swaps';\nimport { TraceName } from './constants/traces';\nimport { selectIsAssetExchangeRateInState } from './selectors';\nimport { RequestStatus } from './types';\nimport type {\n  L1GasFees,\n  GenericQuoteRequest,\n  NonEvmFees,\n  QuoteRequest,\n  QuoteResponse,\n  BridgeControllerState,\n  BridgeControllerMessenger,\n  FetchFunction,\n} from './types';\nimport { getAssetIdsForToken, toExchangeRates } from './utils/assets';\nimport { hasSufficientBalance } from './utils/balance';\nimport {\n  getDefaultBridgeControllerState,\n  isCrossChain,\n  isEthUsdt,\n  isNonEvmChainId,\n  isSolanaChainId,\n} from './utils/bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToCaip,\n  formatChainIdToHex,\n} from './utils/caip-formatters';\nimport {\n  getBridgeFeatureFlags,\n  hasMinimumRequiredVersion,\n} from './utils/feature-flags';\nimport {\n  fetchAssetPrices,\n  fetchBridgeQuotes,\n  fetchBridgeQuoteStream,\n} from './utils/fetch';\nimport {\n  AbortReason,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  UnifiedSwapBridgeEventName,\n} from './utils/metrics/constants';\nimport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapTypeFromQuote,\n  isCustomSlippage,\n  isHardwareWallet,\n  toInputChangedPropertyKey,\n  toInputChangedPropertyValue,\n} from './utils/metrics/properties';\nimport type {\n  QuoteFetchData,\n  RequestMetadata,\n  RequiredEventContextFromClient,\n} from './utils/metrics/types';\nimport type { CrossChainSwapsEventProperties } from './utils/metrics/types';\nimport { isValidQuoteRequest, sortQuotes } from './utils/quote';\nimport { appendFeesToQuotes } from './utils/quote-fees';\nimport { getMinimumBalanceForRentExemptionInLamports } from './utils/snaps';\nimport type { FeatureId } from './utils/validators';\n\nconst metadata: StateMetadata<BridgeControllerState> = {\n  quoteRequest: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotes: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesInitialLoadTime: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLastFetched: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesLoadingStatus: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quoteFetchError: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  quotesRefreshCount: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  assetExchangeRates: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n  minimumBalanceForRentExemptionInLamports: {\n    includeInStateLogs: true,\n    persist: false,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/**\n * The input to start polling for the {@link BridgeController}\n *\n * @param updatedQuoteRequest - The updated quote request\n * @param context - The context contains properties that can't be populated by the\n * controller and need to be provided by the client for analytics\n */\ntype BridgePollingInput = {\n  updatedQuoteRequest: GenericQuoteRequest;\n  context: Pick<\n    RequiredEventContextFromClient,\n    UnifiedSwapBridgeEventName.QuotesError\n  >[UnifiedSwapBridgeEventName.QuotesError] &\n    Pick<\n      RequiredEventContextFromClient,\n      UnifiedSwapBridgeEventName.QuotesRequested\n    >[UnifiedSwapBridgeEventName.QuotesRequested];\n};\n\nexport class BridgeController extends StaticIntervalPollingController<BridgePollingInput>()<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState,\n  BridgeControllerMessenger\n> {\n  #abortController: AbortController | undefined;\n\n  #quotesFirstFetched: number | undefined;\n\n  /**\n   * Stores the location/entry point from which the user initiated the swap or bridge flow.\n   * Set via setLocation() before navigating to the swap/bridge flow.\n   * Used as default for all subsequent internal events.\n   */\n  #location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #clientVersion: string;\n\n  readonly #getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #trackMetaMetricsFn: <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    properties: CrossChainSwapsEventProperties<EventName>,\n  ) => void;\n\n  readonly #trace: TraceCallback;\n\n  readonly #config: {\n    customBridgeApiBaseUrl?: string;\n  };\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    clientVersion,\n    getLayer1GasFee,\n    fetchFn,\n    config,\n    trackMetaMetricsFn,\n    traceFn,\n  }: {\n    messenger: BridgeControllerMessenger;\n    state?: Partial<BridgeControllerState>;\n    clientId: BridgeClientId;\n    clientVersion: string;\n    getLayer1GasFee: typeof TransactionController.prototype.getLayer1GasFee;\n    fetchFn: FetchFunction;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    trackMetaMetricsFn: <\n      EventName extends\n        (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n    >(\n      eventName: EventName,\n      properties: CrossChainSwapsEventProperties<EventName>,\n    ) => void;\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      state: {\n        ...getDefaultBridgeControllerState(),\n        ...state,\n      },\n    });\n\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.#abortController = new AbortController();\n    this.#getLayer1GasFee = getLayer1GasFee;\n    this.#clientId = clientId;\n    this.#clientVersion = clientVersion;\n    this.#fetchFn = fetchFn;\n    this.#trackMetaMetricsFn = trackMetaMetricsFn;\n    this.#config = config ?? {};\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,\n      this.setChainIntervalLength.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,\n      this.updateBridgeQuoteRequestParams.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,\n      this.trackUnifiedSwapBridgeEvent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,\n      this.stopPollingForQuotes.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_CONTROLLER_NAME}:fetchQuotes`,\n      this.fetchQuotes.bind(this),\n    );\n  }\n\n  _executePoll = async (pollingInput: BridgePollingInput) => {\n    await this.#fetchBridgeQuotes(pollingInput);\n  };\n\n  updateBridgeQuoteRequestParams = async (\n    paramsToUpdate: Partial<GenericQuoteRequest> & {\n      walletAddress: GenericQuoteRequest['walletAddress'];\n    },\n    context: BridgePollingInput['context'],\n  ) => {\n    this.#trackInputChangedEvents(paramsToUpdate);\n    this.resetState(AbortReason.QuoteRequestUpdated);\n    const updatedQuoteRequest = {\n      ...DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,\n      ...paramsToUpdate,\n    };\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n    });\n\n    if (isValidQuoteRequest(updatedQuoteRequest)) {\n      this.#quotesFirstFetched = Date.now();\n      const isSrcChainNonEVM = isNonEvmChainId(updatedQuoteRequest.srcChainId);\n      const providerConfig = isSrcChainNonEVM\n        ? undefined\n        : this.#getNetworkClientByChainId(\n            formatChainIdToHex(updatedQuoteRequest.srcChainId),\n          )?.configuration;\n\n      let insufficientBal: boolean | undefined;\n      let resetApproval: boolean = Boolean(paramsToUpdate.resetApproval);\n      if (isSrcChainNonEVM) {\n        // If the source chain is not an EVM network, use value from params\n        insufficientBal = paramsToUpdate.insufficientBal;\n      } else if (providerConfig?.rpcUrl?.includes('tenderly')) {\n        // If the rpcUrl is a tenderly fork (e2e tests), set insufficientBal=true\n        // The bridge-api filters out quotes if the balance on mainnet is insufficient so this override allows quotes to always be returned\n        insufficientBal = true;\n      } else {\n        // Set loading status if RPC calls are made before the quotes are fetched\n        this.update((state) => {\n          state.quotesLoadingStatus = RequestStatus.LOADING;\n        });\n        resetApproval = await this.#shouldResetApproval(updatedQuoteRequest);\n        // Otherwise query the src token balance from the RPC provider\n        insufficientBal =\n          paramsToUpdate.insufficientBal ??\n          (await this.#hasInsufficientBalance(updatedQuoteRequest));\n      }\n\n      // Set refresh rate based on the source chain before starting polling\n      this.setChainIntervalLength();\n      this.startPolling({\n        updatedQuoteRequest: {\n          ...updatedQuoteRequest,\n          insufficientBal,\n          resetApproval,\n        },\n        context,\n      });\n    }\n  };\n\n  /**\n   * Fetches quotes for specified request without updating the controller state\n   * This method does not start polling for quotes and does not emit UnifiedSwapBridge events\n   *\n   * @param quoteRequest - The parameters for quote requests to fetch\n   * @param abortSignal - The abort signal to cancel all the requests\n   * @param featureId - The feature ID that maps to quoteParam overrides from LD\n   * @returns A list of validated quotes\n   */\n  fetchQuotes = async (\n    quoteRequest: GenericQuoteRequest,\n    abortSignal: AbortSignal | null = null,\n    featureId: FeatureId | null = null,\n  ): Promise<(QuoteResponse & L1GasFees & NonEvmFees)[]> => {\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n    const jwt = await this.#getJwt();\n    // If featureId is specified, retrieve the quoteRequestOverrides for that featureId\n    const quoteRequestOverrides = featureId\n      ? bridgeFeatureFlags.quoteRequestOverrides?.[featureId]\n      : undefined;\n    const resetApproval = await this.#shouldResetApproval(quoteRequest);\n\n    // If quoteRequestOverrides is specified, merge it with the quoteRequest\n    const { quotes: baseQuotes, validationFailures } = await fetchBridgeQuotes(\n      quoteRequestOverrides\n        ? { ...quoteRequest, ...quoteRequestOverrides, resetApproval }\n        : { ...quoteRequest, resetApproval },\n      abortSignal,\n      this.#clientId,\n      jwt,\n      this.#fetchFn,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      featureId,\n      this.#clientVersion,\n    );\n\n    this.#trackResponseValidationFailures(validationFailures);\n\n    const quotesWithFees = await appendFeesToQuotes(\n      baseQuotes,\n      this.messenger,\n      this.#getLayer1GasFee,\n      this.#getMultichainSelectedAccount(quoteRequest.walletAddress),\n    );\n\n    return sortQuotes(quotesWithFees, featureId);\n  };\n\n  readonly #trackResponseValidationFailures = (\n    validationFailures: string[],\n  ) => {\n    if (validationFailures.length === 0) {\n      return;\n    }\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesValidationFailed,\n      {\n        failures: validationFailures,\n        location: this.#location,\n      },\n    );\n  };\n\n  readonly #getExchangeRateSources = () => {\n    return {\n      ...this.messenger.call('MultichainAssetsRatesController:getState'),\n      ...this.messenger.call('CurrencyRateController:getState'),\n      ...this.messenger.call('TokenRatesController:getState'),\n      ...this.state,\n    };\n  };\n\n  /**\n   * Fetches the exchange rates for the assets in the quote request if they are not already in the state\n   * In addition to the selected tokens, this also fetches the native asset for the source and destination chains\n   *\n   * @param quoteRequest - The quote request\n   * @param quoteRequest.srcChainId - The source chain ID\n   * @param quoteRequest.srcTokenAddress - The source token address\n   * @param quoteRequest.destChainId - The destination chain ID\n   * @param quoteRequest.destTokenAddress - The destination token address\n   */\n  readonly #fetchAssetExchangeRates = async ({\n    srcChainId,\n    srcTokenAddress,\n    destChainId,\n    destTokenAddress,\n  }: Partial<GenericQuoteRequest>) => {\n    const assetIds: Set<CaipAssetType> = new Set([]);\n    const exchangeRateSources = this.#getExchangeRateSources();\n    if (\n      srcTokenAddress &&\n      srcChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        srcChainId,\n        srcTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(srcTokenAddress, srcChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n    if (\n      destTokenAddress &&\n      destChainId &&\n      !selectIsAssetExchangeRateInState(\n        exchangeRateSources,\n        destChainId,\n        destTokenAddress,\n      )\n    ) {\n      getAssetIdsForToken(destTokenAddress, destChainId).forEach((assetId) =>\n        assetIds.add(assetId),\n      );\n    }\n\n    const currency = this.messenger.call(\n      'CurrencyRateController:getState',\n    ).currentCurrency;\n\n    if (assetIds.size === 0) {\n      return;\n    }\n\n    const pricesByAssetId = await fetchAssetPrices({\n      assetIds,\n      currencies: new Set([currency]),\n      clientId: this.#clientId,\n      clientVersion: this.#clientVersion,\n      fetchFn: this.#fetchFn,\n      signal: this.#abortController?.signal,\n    });\n    const exchangeRates = toExchangeRates(currency, pricesByAssetId);\n    this.update((state) => {\n      state.assetExchangeRates = {\n        ...state.assetExchangeRates,\n        ...exchangeRates,\n      };\n    });\n  };\n\n  readonly #hasInsufficientBalance = async (\n    quoteRequest: GenericQuoteRequest,\n  ) => {\n    try {\n      const srcChainIdInHex = formatChainIdToHex(quoteRequest.srcChainId);\n      const provider =\n        this.#getNetworkClientByChainId(srcChainIdInHex)?.provider;\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n\n      return !(\n        provider &&\n        normalizedSrcTokenAddress &&\n        quoteRequest.srcTokenAmount &&\n        srcChainIdInHex &&\n        (await hasSufficientBalance(\n          provider,\n          quoteRequest.walletAddress,\n          normalizedSrcTokenAddress,\n          quoteRequest.srcTokenAmount,\n          srcChainIdInHex,\n        ))\n      );\n    } catch (error) {\n      console.warn('Failed to set insufficientBal', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  readonly #shouldResetApproval = async (quoteRequest: GenericQuoteRequest) => {\n    if (isNonEvmChainId(quoteRequest.srcChainId)) {\n      return false;\n    }\n    try {\n      const normalizedSrcTokenAddress = formatAddressToCaipReference(\n        quoteRequest.srcTokenAddress,\n      );\n      if (isEthUsdt(quoteRequest.srcChainId, normalizedSrcTokenAddress)) {\n        const allowance = BigNumber.from(\n          await this.#getUSDTMainnetAllowance(\n            quoteRequest.walletAddress,\n            normalizedSrcTokenAddress,\n            quoteRequest.destChainId,\n          ),\n        );\n        return allowance.lt(quoteRequest.srcTokenAmount) && allowance.gt(0);\n      }\n      return false;\n    } catch (error) {\n      console.warn('Failed to set resetApproval', error);\n      // Fall back to true so the backend returns quotes\n      return true;\n    }\n  };\n\n  stopPollingForQuotes = (\n    reason?: AbortReason,\n    context?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n  ) => {\n    this.stopAllPolling();\n    // If polling is stopped before quotes finish loading, track QuotesReceived\n    if (this.state.quotesLoadingStatus === RequestStatus.LOADING && context) {\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesReceived,\n        context,\n      );\n    }\n    // Clears quotes list in state\n    this.#abortController?.abort(reason);\n  };\n\n  /**\n   * Sets the location/entry point for the current swap or bridge flow.\n   * Call this when the user enters the flow so that all internally-fired\n   * events (InputChanged, QuotesRequested, etc.) carry the correct location.\n   *\n   * @param location - The entry point from which the user initiated the flow\n   */\n  setLocation = (location: MetaMetricsSwapsEventSource) => {\n    this.#location = location;\n  };\n\n  resetState = (reason = AbortReason.ResetState) => {\n    this.stopPollingForQuotes(reason);\n    this.update((state) => {\n      // Cannot do direct assignment to state, i.e. state = {... }, need to manually assign each field\n      state.quoteRequest = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest;\n      state.quotesInitialLoadTime =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime;\n      state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      state.quotesLastFetched =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched;\n      state.quotesLoadingStatus =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesRefreshCount =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount;\n      state.assetExchangeRates =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates;\n      state.minimumBalanceForRentExemptionInLamports =\n        DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  /**\n   * Sets the interval length based on the source chain\n   */\n  setChainIntervalLength = () => {\n    const { state } = this;\n    const { srcChainId } = state.quoteRequest;\n    const bridgeFeatureFlags = getBridgeFeatureFlags(this.messenger);\n\n    const refreshRateOverride = srcChainId\n      ? bridgeFeatureFlags.chains[formatChainIdToCaip(srcChainId)]?.refreshRate\n      : undefined;\n    const defaultRefreshRate = bridgeFeatureFlags.refreshRate;\n    this.setIntervalLength(refreshRateOverride ?? defaultRefreshRate);\n  };\n\n  readonly #fetchBridgeQuotes = async ({\n    updatedQuoteRequest,\n    context,\n  }: BridgePollingInput) => {\n    this.#abortController?.abort(AbortReason.NewQuoteRequest);\n    this.#abortController = new AbortController();\n\n    this.#fetchAssetExchangeRates(updatedQuoteRequest).catch((error) =>\n      console.warn('Failed to fetch asset exchange rates', error),\n    );\n\n    this.trackUnifiedSwapBridgeEvent(\n      UnifiedSwapBridgeEventName.QuotesRequested,\n      context,\n    );\n\n    const { sse, maxRefreshCount } = getBridgeFeatureFlags(this.messenger);\n    const shouldStream =\n      sse?.enabled &&\n      hasMinimumRequiredVersion(this.#clientVersion, sse.minimumVersion);\n\n    this.update((state) => {\n      state.quoteRequest = updatedQuoteRequest;\n      state.quoteFetchError = DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError;\n      state.quotesLastFetched = Date.now();\n      state.quotesLoadingStatus = RequestStatus.LOADING;\n    });\n\n    const jwt = await this.#getJwt();\n\n    try {\n      await this.#trace(\n        {\n          name: isCrossChain(\n            updatedQuoteRequest.srcChainId,\n            updatedQuoteRequest.destChainId,\n          )\n            ? TraceName.BridgeQuotesFetched\n            : TraceName.SwapQuotesFetched,\n          data: {\n            srcChainId: formatChainIdToCaip(updatedQuoteRequest.srcChainId),\n            destChainId: formatChainIdToCaip(updatedQuoteRequest.destChainId),\n          },\n        },\n        async () => {\n          const selectedAccount = this.#getMultichainSelectedAccount(\n            updatedQuoteRequest.walletAddress,\n          );\n          // This call is not awaited to prevent blocking quote fetching if the snap takes too long to respond\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.#setMinimumBalanceForRentExemptionInLamports(\n            updatedQuoteRequest.srcChainId,\n            selectedAccount?.metadata?.snap?.id,\n          );\n          // Use SSE if enabled and return early\n          if (shouldStream) {\n            await this.#handleQuoteStreaming(\n              updatedQuoteRequest,\n              jwt,\n              selectedAccount,\n            );\n            return;\n          }\n          // Otherwise use regular fetch\n          const quotes = await this.fetchQuotes(\n            updatedQuoteRequest,\n            this.#abortController?.signal,\n          );\n          this.update((state) => {\n            // Set the initial load time if this is the first fetch\n            if (\n              state.quotesRefreshCount ===\n                DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount &&\n              this.#quotesFirstFetched\n            ) {\n              state.quotesInitialLoadTime =\n                Date.now() - this.#quotesFirstFetched;\n            }\n            state.quotes = quotes;\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      );\n    } catch (error) {\n      // Reset the quotes list if the fetch fails to avoid showing stale quotes\n      this.update((state) => {\n        state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n      });\n      // Ignore abort errors\n      if (\n        (error as Error).toString().includes('AbortError') ||\n        (error as Error).toString().includes('FetchRequestCanceledException') ||\n        [\n          AbortReason.ResetState,\n          AbortReason.NewQuoteRequest,\n          AbortReason.QuoteRequestUpdated,\n          AbortReason.TransactionSubmitted,\n        ].includes(error as AbortReason)\n      ) {\n        // Exit the function early to prevent other state updates\n        return;\n      }\n\n      // Update loading status and error message\n      this.update((state) => {\n        // The error object reference is not guaranteed to exist on mobile so reading\n        // the message directly could cause an error.\n        let errorMessage;\n        try {\n          errorMessage =\n            (error as Error)?.message ?? (error as Error).toString();\n        } catch {\n          // Intentionally empty\n        } finally {\n          state.quoteFetchError = errorMessage ?? 'Unknown error';\n        }\n        state.quotesLoadingStatus = RequestStatus.ERROR;\n      });\n      // Track event and log error\n      this.trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.QuotesError,\n        context,\n      );\n      console.log(\n        `Failed to ${shouldStream ? 'stream' : 'fetch'} bridge quotes`,\n        error,\n      );\n    }\n\n    // Update refresh count after fetching, validation and fee calculation have completed\n    this.update((state) => {\n      state.quotesRefreshCount += 1;\n    });\n    // Stop polling if the maximum number of refreshes has been reached\n    if (\n      updatedQuoteRequest.insufficientBal ||\n      (!updatedQuoteRequest.insufficientBal &&\n        this.state.quotesRefreshCount >= maxRefreshCount)\n    ) {\n      this.stopAllPolling();\n    }\n  };\n\n  readonly #handleQuoteStreaming = async (\n    updatedQuoteRequest: GenericQuoteRequest,\n    jwt?: string,\n    selectedAccount?: InternalAccount,\n  ) => {\n    /**\n     * Tracks the number of valid quotes received from the current stream, which is used\n     * to determine when to clear the quotes list and set the initial load time\n     */\n    let validQuotesCounter = 0;\n    /**\n     * Tracks all pending promises from appendFeesToQuotes calls to ensure they complete\n     * before setting quotesLoadingStatus to FETCHED\n     */\n    const pendingFeeAppendPromises = new Set<Promise<void>>();\n\n    await fetchBridgeQuoteStream(\n      this.#fetchFn,\n      updatedQuoteRequest,\n      this.#abortController?.signal,\n      this.#clientId,\n      jwt,\n      this.#config.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n      {\n        onValidationFailure: this.#trackResponseValidationFailures,\n        onValidQuoteReceived: async (quote: QuoteResponse) => {\n          const feeAppendPromise = (async () => {\n            const quotesWithFees = await appendFeesToQuotes(\n              [quote],\n              this.messenger,\n              this.#getLayer1GasFee,\n              selectedAccount,\n            );\n            if (quotesWithFees.length > 0) {\n              validQuotesCounter += 1;\n            }\n            this.update((state) => {\n              // Clear previous quotes and quotes load time when first quote in the current\n              // polling loop is received\n              // This enables clients to continue showing the previous quotes while new\n              // quotes are loading\n              // Note: If there are no valid quotes until the 2nd fetch, quotesInitialLoadTime will be > refreshRate\n              if (validQuotesCounter === 1) {\n                state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n                if (!state.quotesInitialLoadTime && this.#quotesFirstFetched) {\n                  // Set the initial load time after the first quote is received\n                  state.quotesInitialLoadTime =\n                    Date.now() - this.#quotesFirstFetched;\n                }\n              }\n              state.quotes = [...state.quotes, ...quotesWithFees];\n            });\n          })();\n          pendingFeeAppendPromises.add(feeAppendPromise);\n          feeAppendPromise\n            .catch((error) => {\n              // Catch errors to prevent them from breaking stream processing\n              // If appendFeesToQuotes throws, the state update never happens, so no invalid entry is added\n              console.error('Error appending fees to quote', error);\n            })\n            .finally(() => {\n              pendingFeeAppendPromises.delete(feeAppendPromise);\n            });\n          // Await the promise to ensure errors are caught and handled before continuing\n          // The promise is also tracked in pendingFeeAppendPromises for onClose to wait for\n          await feeAppendPromise;\n        },\n        onClose: async () => {\n          // Wait for all pending appendFeesToQuotes operations to complete\n          // before setting quotesLoadingStatus to FETCHED\n          await Promise.allSettled(Array.from(pendingFeeAppendPromises));\n          this.update((state) => {\n            // If there are no valid quotes in the current stream, clear the quotes list\n            // to remove quotes from the previous stream\n            if (validQuotesCounter === 0) {\n              state.quotes = DEFAULT_BRIDGE_CONTROLLER_STATE.quotes;\n            }\n            state.quotesLoadingStatus = RequestStatus.FETCHED;\n          });\n        },\n      },\n      this.#clientVersion,\n    );\n  };\n\n  readonly #setMinimumBalanceForRentExemptionInLamports = async (\n    srcChainId: GenericQuoteRequest['srcChainId'],\n    snapId?: string,\n  ) => {\n    if (!isSolanaChainId(srcChainId) || !snapId) {\n      return;\n    }\n    const minimumBalanceForRentExemptionInLamports =\n      await getMinimumBalanceForRentExemptionInLamports(snapId, this.messenger);\n    this.update((state) => {\n      state.minimumBalanceForRentExemptionInLamports =\n        minimumBalanceForRentExemptionInLamports;\n    });\n  };\n\n  #getMultichainSelectedAccount(\n    walletAddress?: GenericQuoteRequest['walletAddress'],\n  ) {\n    const addressToUse = walletAddress ?? this.state.quoteRequest.walletAddress;\n    if (!addressToUse) {\n      throw new Error('Account address is required');\n    }\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      addressToUse,\n    );\n    return selectedAccount;\n  }\n\n  #getNetworkClientByChainId(chainId: Hex) {\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      chainId,\n    );\n    if (!networkClientId) {\n      throw new Error(`No network client found for chainId: ${chainId}`);\n    }\n    const networkClient = this.messenger.call(\n      'NetworkController:getNetworkClientById',\n      networkClientId,\n    );\n    return networkClient;\n  }\n\n  readonly #getJwt = async (): Promise<string | undefined> => {\n    try {\n      const token = await this.messenger.call(\n        'AuthenticationController:getBearerToken',\n      );\n      return token;\n    } catch (error) {\n      console.error('Error getting JWT token for bridge-api request', error);\n      return undefined;\n    }\n  };\n\n  readonly #getRequestMetadata = (): Omit<\n    RequestMetadata,\n    | 'stx_enabled'\n    | 'usd_amount_source'\n    | 'security_warnings'\n    | 'is_hardware_wallet'\n  > => {\n    return {\n      slippage_limit: this.state.quoteRequest.slippage,\n      swap_type: getSwapTypeFromQuote(this.state.quoteRequest),\n      custom_slippage: isCustomSlippage(this.state.quoteRequest.slippage),\n    };\n  };\n\n  readonly #getQuoteFetchData = (): Omit<\n    QuoteFetchData,\n    'best_quote_provider' | 'price_impact' | 'can_submit'\n  > => {\n    return {\n      quotes_count: this.state.quotes.length,\n      quotes_list: this.state.quotes.map(({ quote }) =>\n        formatProviderLabel(quote),\n      ),\n      initial_load_time_all_quotes: this.state.quotesInitialLoadTime ?? 0,\n      has_gas_included_quote: this.state.quotes.some(\n        ({ quote }) => quote.gasIncluded,\n      ),\n    };\n  };\n\n  readonly #getEventProperties = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): CrossChainSwapsEventProperties<EventName> => {\n    const clientProps = propertiesFromClient as Record<string, unknown>;\n    const baseProperties = {\n      ...propertiesFromClient,\n      location: clientProps?.location ?? this.#location,\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n    };\n    switch (eventName) {\n      case UnifiedSwapBridgeEventName.ButtonClicked:\n      case UnifiedSwapBridgeEventName.PageViewed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesValidationFailed:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesReceived:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          refresh_count: this.state.quotesRefreshCount,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesRequested:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.QuotesError:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          error_message: this.state.quoteFetchError,\n          has_sufficient_funds: !this.state.quoteRequest.insufficientBal,\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.AllQuotesOpened:\n      case UnifiedSwapBridgeEventName.AllQuotesSorted:\n      case UnifiedSwapBridgeEventName.QuoteSelected:\n        return {\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          is_hardware_wallet: isHardwareWallet(\n            this.#getMultichainSelectedAccount(),\n          ),\n          ...baseProperties,\n        };\n      case UnifiedSwapBridgeEventName.Failed: {\n        // Populate the properties that the error occurred before the tx was submitted\n        return {\n          ...baseProperties,\n          ...getRequestParams(this.state.quoteRequest),\n          ...this.#getRequestMetadata(),\n          ...this.#getQuoteFetchData(),\n          ...propertiesFromClient,\n        };\n      }\n      case UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:\n        return baseProperties;\n      // These events may be published after the bridge-controller state is reset\n      // So the BridgeStatusController populates all the properties\n      case UnifiedSwapBridgeEventName.Submitted:\n      case UnifiedSwapBridgeEventName.Completed:\n        return propertiesFromClient;\n      case UnifiedSwapBridgeEventName.InputChanged:\n      default:\n        return baseProperties;\n    }\n  };\n\n  readonly #trackInputChangedEvents = (\n    paramsToUpdate: Partial<GenericQuoteRequest>,\n  ) => {\n    Object.entries(paramsToUpdate).forEach(([key, value]) => {\n      const inputKey = toInputChangedPropertyKey[key as keyof QuoteRequest];\n      const inputValue =\n        toInputChangedPropertyValue[key as keyof QuoteRequest]?.(\n          paramsToUpdate,\n        );\n      if (\n        inputKey &&\n        inputValue !== undefined &&\n        value !== this.state.quoteRequest[key as keyof GenericQuoteRequest]\n      ) {\n        this.trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.InputChanged,\n          {\n            input: inputKey,\n            input_value: inputValue,\n            location: this.#location,\n          },\n        );\n      }\n    });\n  };\n\n  /**\n   * This method tracks cross-chain swaps events\n   *\n   * @param eventName - The name of the event to track\n   * @param propertiesFromClient - Properties that can't be calculated from the event name and need to be provided by the client\n   * @example\n   * this.trackUnifiedSwapBridgeEvent(UnifiedSwapBridgeEventName.ActionOpened, {\n   *   location: MetaMetricsSwapsEventSource.MainView,\n   * });\n   */\n  trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      (typeof UnifiedSwapBridgeEventName)[keyof typeof UnifiedSwapBridgeEventName],\n  >(\n    eventName: EventName,\n    propertiesFromClient: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ) => {\n    try {\n      const combinedPropertiesForEvent = this.#getEventProperties<EventName>(\n        eventName,\n        propertiesFromClient,\n      );\n\n      this.#trackMetaMetricsFn(eventName, combinedPropertiesForEvent);\n    } catch (error) {\n      console.error(\n        `Error tracking cross-chain swaps MetaMetrics event ${eventName}`,\n        error,\n      );\n    }\n  };\n\n  /**\n   *\n   * @param walletAddress - The address of the account to get the allowance for\n   * @param contractAddress - The address of the ERC20 token contract on mainnet\n   * @param destinationChainId - The chain ID of the destination network\n   * @returns The atomic allowance of the ERC20 token contract\n   */\n  readonly #getUSDTMainnetAllowance = async (\n    walletAddress: string,\n    contractAddress: string,\n    destinationChainId: GenericQuoteRequest['destChainId'],\n  ): Promise<string> => {\n    const networkClient = this.#getNetworkClientByChainId(CHAIN_IDS.MAINNET);\n    const provider = networkClient?.provider;\n    if (!provider) {\n      throw new Error('No provider found');\n    }\n\n    const ethersProvider = new Web3Provider(provider);\n    const contract = new Contract(contractAddress, abiERC20, ethersProvider);\n    const spenderAddress = isCrossChain(CHAIN_IDS.MAINNET, destinationChainId)\n      ? METABRIDGE_ETHEREUM_ADDRESS\n      : SWAPS_CONTRACT_ADDRESSES[CHAIN_IDS.MAINNET];\n    const allowance: BigNumber = await contract.allowance(\n      walletAddress,\n      spenderAddress,\n    );\n    return allowance.toString();\n  };\n}\n"]}
\ No newline at end of file
diff --git a/dist/index.cjs b/dist/index.cjs
index e4640ec0d0de9b3b744a3f23269e3d8ecbce30e3..f65d3ba41d705af3b868dc7e729aaf548f67168a 100644
--- a/dist/index.cjs
+++ b/dist/index.cjs
@@ -1,12 +1,13 @@
 "use strict";
 Object.defineProperty(exports, "__esModule", { value: true });
-exports.getNativeAssetForChainId = exports.isNonEvmChainId = exports.isTronChainId = exports.isBitcoinChainId = exports.isSolanaChainId = exports.isNativeAddress = exports.isEthUsdt = exports.MetricsSwapType = exports.MetricsActionType = exports.ALLOWED_CONTRACT_ADDRESSES = exports.SWAPS_WRAPPED_TOKENS_ADDRESSES = exports.SWAPS_CONTRACT_ADDRESSES = exports.SWAPS_API_V2_BASE_URL = exports.SWAPS_CHAINID_DEFAULT_TOKEN_MAP = exports.BRIDGE_PROD_API_BASE_URL = exports.BRIDGE_DEV_API_BASE_URL = exports.METABRIDGE_CHAIN_TO_ADDRESS_MAP = exports.DEFAULT_BRIDGE_CONTROLLER_STATE = exports.DEFAULT_MAX_REFRESH_COUNT = exports.REFRESH_INTERVAL_MS = exports.BRIDGE_MM_FEE_RATE = exports.BRIDGE_PREFERRED_GAS_ESTIMATE = exports.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE = exports.BRIDGE_QUOTE_MAX_ETA_SECONDS = exports.BRIDGE_CONTROLLER_NAME = exports.BridgeClientId = exports.ALLOWED_BRIDGE_CHAIN_IDS = exports.FeatureId = exports.BridgeAssetSchema = exports.ActionTypes = exports.FeeType = exports.BridgeBackgroundAction = exports.BridgeUserAction = exports.RequestStatus = exports.ChainId = exports.SortOrder = exports.AssetType = exports.StatusTypes = exports.AbortReason = exports.getQuotesReceivedProperties = exports.isCustomSlippage = exports.isHardwareWallet = exports.getSwapType = exports.getRequestParams = exports.formatProviderLabel = exports.PollingStatus = exports.MetaMetricsSwapsEventSource = exports.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = exports.UnifiedSwapBridgeEventName = exports.BridgeController = void 0;
-exports.fetchTokens = exports.getSwapsContractAddress = exports.isValidSwapsContractAddress = exports.BRIDGE_DEFAULT_SLIPPAGE = exports.getBridgeFeatureFlags = exports.DEFAULT_FEATURE_FLAG_CONFIG = exports.selectMinimumBalanceForRentExemptionInSOL = exports.selectBridgeFeatureFlags = exports.selectIsQuoteExpired = exports.selectExchangeRateByChainIdAndAddress = exports.selectDefaultSlippagePercentage = exports.selectBridgeQuotes = exports.isEvmTxData = exports.isTronTrade = exports.isBitcoinTrade = exports.extractTradeData = exports.formatAddressToAssetId = exports.formatAddressToCaipReference = exports.formatChainIdToHex = exports.formatChainIdToCaip = exports.getClientHeaders = exports.fetchBridgeTokens = exports.calcLatestSrcBalance = exports.calcSlippagePercentage = exports.formatEtaInMinutes = exports.isValidQuoteRequest = exports.isCrossChain = exports.getDefaultBridgeControllerState = void 0;
+exports.isNonEvmChainId = exports.isTronChainId = exports.isBitcoinChainId = exports.isSolanaChainId = exports.isNativeAddress = exports.isEthUsdt = exports.MetricsSwapType = exports.MetricsActionType = exports.ALLOWED_CONTRACT_ADDRESSES = exports.SWAPS_WRAPPED_TOKENS_ADDRESSES = exports.SWAPS_CONTRACT_ADDRESSES = exports.SWAPS_API_V2_BASE_URL = exports.SWAPS_CHAINID_DEFAULT_TOKEN_MAP = exports.BRIDGE_PROD_API_BASE_URL = exports.BRIDGE_DEV_API_BASE_URL = exports.METABRIDGE_CHAIN_TO_ADDRESS_MAP = exports.DEFAULT_BRIDGE_CONTROLLER_STATE = exports.DEFAULT_MAX_REFRESH_COUNT = exports.REFRESH_INTERVAL_MS = exports.BRIDGE_MM_FEE_RATE = exports.BRIDGE_PREFERRED_GAS_ESTIMATE = exports.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE = exports.BRIDGE_QUOTE_MAX_ETA_SECONDS = exports.BRIDGE_CONTROLLER_NAME = exports.BridgeClientId = exports.ALLOWED_BRIDGE_CHAIN_IDS = exports.FeatureId = exports.BridgeAssetSchema = exports.ActionTypes = exports.FeeType = exports.BridgeBackgroundAction = exports.BridgeUserAction = exports.RequestStatus = exports.ChainId = exports.SortOrder = exports.AssetType = exports.StatusTypes = exports.AbortReason = exports.getQuotesReceivedProperties = exports.isCustomSlippage = exports.isHardwareWallet = exports.getSwapType = exports.getRequestParams = exports.formatProviderLabel = exports.PollingStatus = exports.MetaMetricsSwapsEventSource = exports.InputAmountPreset = exports.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = exports.UnifiedSwapBridgeEventName = exports.BridgeController = void 0;
+exports.fetchTokens = exports.getSwapsContractAddress = exports.isValidSwapsContractAddress = exports.BRIDGE_DEFAULT_SLIPPAGE = exports.getBridgeFeatureFlags = exports.DEFAULT_FEATURE_FLAG_CONFIG = exports.selectMinimumBalanceForRentExemptionInSOL = exports.selectBridgeFeatureFlags = exports.selectIsQuoteExpired = exports.selectExchangeRateByChainIdAndAddress = exports.selectDefaultSlippagePercentage = exports.selectBridgeQuotes = exports.isEvmTxData = exports.isTronTrade = exports.isBitcoinTrade = exports.extractTradeData = exports.formatAddressToAssetId = exports.formatAddressToCaipReference = exports.formatChainIdToHex = exports.formatChainIdToCaip = exports.getClientHeaders = exports.fetchBridgeTokens = exports.calcLatestSrcBalance = exports.calcSlippagePercentage = exports.formatEtaInMinutes = exports.isValidQuoteRequest = exports.isCrossChain = exports.getDefaultBridgeControllerState = exports.getNativeAssetForChainId = void 0;
 var bridge_controller_1 = require("./bridge-controller.cjs");
 Object.defineProperty(exports, "BridgeController", { enumerable: true, get: function () { return bridge_controller_1.BridgeController; } });
 var constants_1 = require("./utils/metrics/constants.cjs");
 Object.defineProperty(exports, "UnifiedSwapBridgeEventName", { enumerable: true, get: function () { return constants_1.UnifiedSwapBridgeEventName; } });
 Object.defineProperty(exports, "UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY", { enumerable: true, get: function () { return constants_1.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY; } });
+Object.defineProperty(exports, "InputAmountPreset", { enumerable: true, get: function () { return constants_1.InputAmountPreset; } });
 Object.defineProperty(exports, "MetaMetricsSwapsEventSource", { enumerable: true, get: function () { return constants_1.MetaMetricsSwapsEventSource; } });
 Object.defineProperty(exports, "PollingStatus", { enumerable: true, get: function () { return constants_1.PollingStatus; } });
 var properties_1 = require("./utils/metrics/properties.cjs");
diff --git a/dist/index.cjs.map b/dist/index.cjs.map
index e0c39e3d26124079108894c81dc69c2b47ef4329..1138ed6774b54f2d4ca2d6da62b4defc751138e0 100644
--- a/dist/index.cjs.map
+++ b/dist/index.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"index.cjs","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["export { BridgeController } from './bridge-controller';\n\nexport {\n  UnifiedSwapBridgeEventName,\n  UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,\n  MetaMetricsSwapsEventSource,\n  PollingStatus,\n} from './utils/metrics/constants';\n\nexport type {\n  RequiredEventContextFromClient,\n  CrossChainSwapsEventProperties,\n  TradeData,\n  RequestParams,\n  RequestMetadata,\n  TxStatusData,\n  QuoteFetchData,\n  QuoteWarning,\n} from './utils/metrics/types';\n\nexport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapType,\n  isHardwareWallet,\n  isCustomSlippage,\n  getQuotesReceivedProperties,\n} from './utils/metrics/properties';\n\nexport type {\n  ChainConfiguration,\n  L1GasFees,\n  NonEvmFees,\n  QuoteMetadata,\n  GasMultiplierByChainId,\n  FeatureFlagResponse,\n  BridgeAsset,\n  GenericQuoteRequest,\n  Protocol,\n  TokenAmountValues,\n  Step,\n  RefuelData,\n  Quote,\n  QuoteResponse,\n  FeeData,\n  TxData,\n  Intent,\n  IntentOrderLike,\n  BitcoinTradeData,\n  TronTradeData,\n  BridgeControllerState,\n  BridgeControllerAction,\n  BridgeControllerActions,\n  BridgeControllerEvents,\n  BridgeControllerMessenger,\n  FeatureFlagsPlatformConfig,\n} from './types';\n\nexport { AbortReason } from './utils/metrics/constants';\n\nexport { StatusTypes } from './types';\n\nexport {\n  AssetType,\n  SortOrder,\n  ChainId,\n  RequestStatus,\n  BridgeUserAction,\n  BridgeBackgroundAction,\n  type BridgeControllerGetStateAction,\n  type BridgeControllerStateChangeEvent,\n} from './types';\n\nexport {\n  FeeType,\n  ActionTypes,\n  BridgeAssetSchema,\n  FeatureId,\n} from './utils/validators';\n\nexport {\n  ALLOWED_BRIDGE_CHAIN_IDS,\n  BridgeClientId,\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_QUOTE_MAX_ETA_SECONDS,\n  BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE,\n  BRIDGE_PREFERRED_GAS_ESTIMATE,\n  BRIDGE_MM_FEE_RATE,\n  REFRESH_INTERVAL_MS,\n  DEFAULT_MAX_REFRESH_COUNT,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_CHAIN_TO_ADDRESS_MAP,\n  BRIDGE_DEV_API_BASE_URL,\n  BRIDGE_PROD_API_BASE_URL,\n} from './constants/bridge';\n\nexport type { AllowedBridgeChainIds } from './constants/bridge';\n\nexport {\n  /**\n   * @deprecated This type should not be used. Use {@link BridgeAsset} instead.\n   */\n  type SwapsTokenObject,\n  /**\n   * @deprecated This map should not be used. Use getNativeAssetForChainId\" } instead.\n   */\n  SWAPS_CHAINID_DEFAULT_TOKEN_MAP,\n} from './constants/tokens';\n\nexport {\n  SWAPS_API_V2_BASE_URL,\n  SWAPS_CONTRACT_ADDRESSES,\n  SWAPS_WRAPPED_TOKENS_ADDRESSES,\n  ALLOWED_CONTRACT_ADDRESSES,\n} from './constants/swaps';\n\nexport { MetricsActionType, MetricsSwapType } from './utils/metrics/constants';\n\nexport {\n  isEthUsdt,\n  isNativeAddress,\n  isSolanaChainId,\n  isBitcoinChainId,\n  isTronChainId,\n  isNonEvmChainId,\n  getNativeAssetForChainId,\n  getDefaultBridgeControllerState,\n  isCrossChain,\n} from './utils/bridge';\n\nexport {\n  isValidQuoteRequest,\n  formatEtaInMinutes,\n  calcSlippagePercentage,\n} from './utils/quote';\n\nexport { calcLatestSrcBalance } from './utils/balance';\n\nexport { fetchBridgeTokens, getClientHeaders } from './utils/fetch';\n\nexport {\n  formatChainIdToCaip,\n  formatChainIdToHex,\n  formatAddressToCaipReference,\n  formatAddressToAssetId,\n} from './utils/caip-formatters';\n\nexport {\n  extractTradeData,\n  isBitcoinTrade,\n  isTronTrade,\n  isEvmTxData,\n  type Trade,\n} from './utils/trade-utils';\n\nexport {\n  selectBridgeQuotes,\n  selectDefaultSlippagePercentage,\n  type BridgeAppState,\n  selectExchangeRateByChainIdAndAddress,\n  selectIsQuoteExpired,\n  selectBridgeFeatureFlags,\n  selectMinimumBalanceForRentExemptionInSOL,\n} from './selectors';\n\nexport { DEFAULT_FEATURE_FLAG_CONFIG } from './constants/bridge';\n\nexport { getBridgeFeatureFlags } from './utils/feature-flags';\n\nexport { BRIDGE_DEFAULT_SLIPPAGE } from './utils/slippage';\n\nexport {\n  isValidSwapsContractAddress,\n  getSwapsContractAddress,\n  fetchTokens,\n  type SwapsToken,\n} from './utils/swaps';\n"]}
\ No newline at end of file
+{"version":3,"file":"index.cjs","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["export { BridgeController } from './bridge-controller';\n\nexport {\n  UnifiedSwapBridgeEventName,\n  UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,\n  InputAmountPreset,\n  MetaMetricsSwapsEventSource,\n  PollingStatus,\n} from './utils/metrics/constants';\n\nexport type {\n  RequiredEventContextFromClient,\n  CrossChainSwapsEventProperties,\n  TradeData,\n  RequestParams,\n  RequestMetadata,\n  TxStatusData,\n  QuoteFetchData,\n  QuoteWarning,\n} from './utils/metrics/types';\n\nexport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapType,\n  isHardwareWallet,\n  isCustomSlippage,\n  getQuotesReceivedProperties,\n} from './utils/metrics/properties';\n\nexport type {\n  ChainConfiguration,\n  L1GasFees,\n  NonEvmFees,\n  QuoteMetadata,\n  GasMultiplierByChainId,\n  FeatureFlagResponse,\n  BridgeAsset,\n  GenericQuoteRequest,\n  Protocol,\n  TokenAmountValues,\n  Step,\n  RefuelData,\n  Quote,\n  QuoteResponse,\n  FeeData,\n  TxData,\n  Intent,\n  IntentOrderLike,\n  BitcoinTradeData,\n  TronTradeData,\n  BridgeControllerState,\n  BridgeControllerAction,\n  BridgeControllerActions,\n  BridgeControllerEvents,\n  BridgeControllerMessenger,\n  FeatureFlagsPlatformConfig,\n} from './types';\n\nexport { AbortReason } from './utils/metrics/constants';\n\nexport { StatusTypes } from './types';\n\nexport {\n  AssetType,\n  SortOrder,\n  ChainId,\n  RequestStatus,\n  BridgeUserAction,\n  BridgeBackgroundAction,\n  type BridgeControllerGetStateAction,\n  type BridgeControllerStateChangeEvent,\n} from './types';\n\nexport {\n  FeeType,\n  ActionTypes,\n  BridgeAssetSchema,\n  FeatureId,\n} from './utils/validators';\n\nexport {\n  ALLOWED_BRIDGE_CHAIN_IDS,\n  BridgeClientId,\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_QUOTE_MAX_ETA_SECONDS,\n  BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE,\n  BRIDGE_PREFERRED_GAS_ESTIMATE,\n  BRIDGE_MM_FEE_RATE,\n  REFRESH_INTERVAL_MS,\n  DEFAULT_MAX_REFRESH_COUNT,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_CHAIN_TO_ADDRESS_MAP,\n  BRIDGE_DEV_API_BASE_URL,\n  BRIDGE_PROD_API_BASE_URL,\n} from './constants/bridge';\n\nexport type { AllowedBridgeChainIds } from './constants/bridge';\n\nexport {\n  /**\n   * @deprecated This type should not be used. Use {@link BridgeAsset} instead.\n   */\n  type SwapsTokenObject,\n  /**\n   * @deprecated This map should not be used. Use getNativeAssetForChainId\" } instead.\n   */\n  SWAPS_CHAINID_DEFAULT_TOKEN_MAP,\n} from './constants/tokens';\n\nexport {\n  SWAPS_API_V2_BASE_URL,\n  SWAPS_CONTRACT_ADDRESSES,\n  SWAPS_WRAPPED_TOKENS_ADDRESSES,\n  ALLOWED_CONTRACT_ADDRESSES,\n} from './constants/swaps';\n\nexport { MetricsActionType, MetricsSwapType } from './utils/metrics/constants';\n\nexport {\n  isEthUsdt,\n  isNativeAddress,\n  isSolanaChainId,\n  isBitcoinChainId,\n  isTronChainId,\n  isNonEvmChainId,\n  getNativeAssetForChainId,\n  getDefaultBridgeControllerState,\n  isCrossChain,\n} from './utils/bridge';\n\nexport {\n  isValidQuoteRequest,\n  formatEtaInMinutes,\n  calcSlippagePercentage,\n} from './utils/quote';\n\nexport { calcLatestSrcBalance } from './utils/balance';\n\nexport { fetchBridgeTokens, getClientHeaders } from './utils/fetch';\n\nexport {\n  formatChainIdToCaip,\n  formatChainIdToHex,\n  formatAddressToCaipReference,\n  formatAddressToAssetId,\n} from './utils/caip-formatters';\n\nexport {\n  extractTradeData,\n  isBitcoinTrade,\n  isTronTrade,\n  isEvmTxData,\n  type Trade,\n} from './utils/trade-utils';\n\nexport {\n  selectBridgeQuotes,\n  selectDefaultSlippagePercentage,\n  type BridgeAppState,\n  selectExchangeRateByChainIdAndAddress,\n  selectIsQuoteExpired,\n  selectBridgeFeatureFlags,\n  selectMinimumBalanceForRentExemptionInSOL,\n} from './selectors';\n\nexport { DEFAULT_FEATURE_FLAG_CONFIG } from './constants/bridge';\n\nexport { getBridgeFeatureFlags } from './utils/feature-flags';\n\nexport { BRIDGE_DEFAULT_SLIPPAGE } from './utils/slippage';\n\nexport {\n  isValidSwapsContractAddress,\n  getSwapsContractAddress,\n  fetchTokens,\n  type SwapsToken,\n} from './utils/swaps';\n"]}
\ No newline at end of file
diff --git a/dist/index.d.cts b/dist/index.d.cts
index 4eb188305b0e64eb13b8da8db90fc3634a7ae9ac..1f8096e438d9cfef41afd5302639b8fa69d14bff 100644
--- a/dist/index.d.cts
+++ b/dist/index.d.cts
@@ -1,5 +1,5 @@
 export { BridgeController } from "./bridge-controller.cjs";
-export { UnifiedSwapBridgeEventName, UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY, MetaMetricsSwapsEventSource, PollingStatus, } from "./utils/metrics/constants.cjs";
+export { UnifiedSwapBridgeEventName, UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY, InputAmountPreset, MetaMetricsSwapsEventSource, PollingStatus, } from "./utils/metrics/constants.cjs";
 export type { RequiredEventContextFromClient, CrossChainSwapsEventProperties, TradeData, RequestParams, RequestMetadata, TxStatusData, QuoteFetchData, QuoteWarning, } from "./utils/metrics/types.cjs";
 export { formatProviderLabel, getRequestParams, getSwapType, isHardwareWallet, isCustomSlippage, getQuotesReceivedProperties, } from "./utils/metrics/properties.cjs";
 export type { ChainConfiguration, L1GasFees, NonEvmFees, QuoteMetadata, GasMultiplierByChainId, FeatureFlagResponse, BridgeAsset, GenericQuoteRequest, Protocol, TokenAmountValues, Step, RefuelData, Quote, QuoteResponse, FeeData, TxData, Intent, IntentOrderLike, BitcoinTradeData, TronTradeData, BridgeControllerState, BridgeControllerAction, BridgeControllerActions, BridgeControllerEvents, BridgeControllerMessenger, FeatureFlagsPlatformConfig, } from "./types.cjs";
diff --git a/dist/index.d.cts.map b/dist/index.d.cts.map
index 41ef3f65a4cc8a5056252f2efdcc99660e63122c..bd415f31133071c2923ecef6884961c09a3af261 100644
--- a/dist/index.d.cts.map
+++ b/dist/index.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"index.d.cts","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"index.d.cts","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/index.d.mts b/dist/index.d.mts
index f33e3c96e01d30e45b70a192db616cb554e6c717..704de2291860b7afb37d0d904db9c5240b618c7b 100644
--- a/dist/index.d.mts
+++ b/dist/index.d.mts
@@ -1,5 +1,5 @@
 export { BridgeController } from "./bridge-controller.mjs";
-export { UnifiedSwapBridgeEventName, UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY, MetaMetricsSwapsEventSource, PollingStatus, } from "./utils/metrics/constants.mjs";
+export { UnifiedSwapBridgeEventName, UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY, InputAmountPreset, MetaMetricsSwapsEventSource, PollingStatus, } from "./utils/metrics/constants.mjs";
 export type { RequiredEventContextFromClient, CrossChainSwapsEventProperties, TradeData, RequestParams, RequestMetadata, TxStatusData, QuoteFetchData, QuoteWarning, } from "./utils/metrics/types.mjs";
 export { formatProviderLabel, getRequestParams, getSwapType, isHardwareWallet, isCustomSlippage, getQuotesReceivedProperties, } from "./utils/metrics/properties.mjs";
 export type { ChainConfiguration, L1GasFees, NonEvmFees, QuoteMetadata, GasMultiplierByChainId, FeatureFlagResponse, BridgeAsset, GenericQuoteRequest, Protocol, TokenAmountValues, Step, RefuelData, Quote, QuoteResponse, FeeData, TxData, Intent, IntentOrderLike, BitcoinTradeData, TronTradeData, BridgeControllerState, BridgeControllerAction, BridgeControllerActions, BridgeControllerEvents, BridgeControllerMessenger, FeatureFlagsPlatformConfig, } from "./types.mjs";
diff --git a/dist/index.d.mts.map b/dist/index.d.mts.map
index 618e841a8bcd025ad3d854dda024267cd285aca6..581ebde8e2168aad0455ab91bc3783826054d25d 100644
--- a/dist/index.d.mts.map
+++ b/dist/index.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"index.d.mts","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"index.d.mts","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/index.mjs b/dist/index.mjs
index 62858a48c645d25edd1ee150109fb9013d8d07cb..6c150005c0ef1c27d611850f88a0180201739829 100644
--- a/dist/index.mjs
+++ b/dist/index.mjs
@@ -1,5 +1,5 @@
 export { BridgeController } from "./bridge-controller.mjs";
-export { UnifiedSwapBridgeEventName, UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY, MetaMetricsSwapsEventSource, PollingStatus } from "./utils/metrics/constants.mjs";
+export { UnifiedSwapBridgeEventName, UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY, InputAmountPreset, MetaMetricsSwapsEventSource, PollingStatus } from "./utils/metrics/constants.mjs";
 export { formatProviderLabel, getRequestParams, getSwapType, isHardwareWallet, isCustomSlippage, getQuotesReceivedProperties } from "./utils/metrics/properties.mjs";
 export { AbortReason } from "./utils/metrics/constants.mjs";
 export { StatusTypes } from "./types.mjs";
diff --git a/dist/index.mjs.map b/dist/index.mjs.map
index 7ca4f17347263d84f31bb236a852d6f310e60210..090de06de044cf60141f300a11ee58add0cfab2a 100644
--- a/dist/index.mjs.map
+++ b/dist/index.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"index.mjs","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,gCAA4B;AAEvD,OAAO,EACL,0BAA0B,EAC1B,kCAAkC,EAClC,2BAA2B,EAC3B,aAAa,EACd,sCAAkC;AAanC,OAAO,EACL,mBAAmB,EACnB,gBAAgB,EAChB,WAAW,EACX,gBAAgB,EAChB,gBAAgB,EAChB,2BAA2B,EAC5B,uCAAmC;AA+BpC,OAAO,EAAE,WAAW,EAAE,sCAAkC;AAExD,OAAO,EAAE,WAAW,EAAE,oBAAgB;AAEtC,OAAO,EACL,SAAS,EACT,SAAS,EACT,OAAO,EACP,aAAa,EACb,gBAAgB,EAChB,sBAAsB,EAGvB,oBAAgB;AAEjB,OAAO,EACL,OAAO,EACP,WAAW,EACX,iBAAiB,EACjB,SAAS,EACV,+BAA2B;AAE5B,OAAO,EACL,wBAAwB,EACxB,cAAc,EACd,sBAAsB,EACtB,4BAA4B,EAC5B,6CAA6C,EAC7C,6BAA6B,EAC7B,kBAAkB,EAClB,mBAAmB,EACnB,yBAAyB,EACzB,+BAA+B,EAC/B,+BAA+B,EAC/B,uBAAuB,EACvB,wBAAwB,EACzB,+BAA2B;AAI5B,OAAO;AAKL;;GAEG;AACH,+BAA+B,EAChC,+BAA2B;AAE5B,OAAO,EACL,qBAAqB,EACrB,wBAAwB,EACxB,8BAA8B,EAC9B,0BAA0B,EAC3B,8BAA0B;AAE3B,OAAO,EAAE,iBAAiB,EAAE,eAAe,EAAE,sCAAkC;AAE/E,OAAO,EACL,SAAS,EACT,eAAe,EACf,eAAe,EACf,gBAAgB,EAChB,aAAa,EACb,eAAe,EACf,wBAAwB,EACxB,+BAA+B,EAC/B,YAAY,EACb,2BAAuB;AAExB,OAAO,EACL,mBAAmB,EACnB,kBAAkB,EAClB,sBAAsB,EACvB,0BAAsB;AAEvB,OAAO,EAAE,oBAAoB,EAAE,4BAAwB;AAEvD,OAAO,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,0BAAsB;AAEpE,OAAO,EACL,mBAAmB,EACnB,kBAAkB,EAClB,4BAA4B,EAC5B,sBAAsB,EACvB,oCAAgC;AAEjC,OAAO,EACL,gBAAgB,EAChB,cAAc,EACd,WAAW,EACX,WAAW,EAEZ,gCAA4B;AAE7B,OAAO,EACL,kBAAkB,EAClB,+BAA+B,EAE/B,qCAAqC,EACrC,oBAAoB,EACpB,wBAAwB,EACxB,yCAAyC,EAC1C,wBAAoB;AAErB,OAAO,EAAE,2BAA2B,EAAE,+BAA2B;AAEjE,OAAO,EAAE,qBAAqB,EAAE,kCAA8B;AAE9D,OAAO,EAAE,uBAAuB,EAAE,6BAAyB;AAE3D,OAAO,EACL,2BAA2B,EAC3B,uBAAuB,EACvB,WAAW,EAEZ,0BAAsB","sourcesContent":["export { BridgeController } from './bridge-controller';\n\nexport {\n  UnifiedSwapBridgeEventName,\n  UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,\n  MetaMetricsSwapsEventSource,\n  PollingStatus,\n} from './utils/metrics/constants';\n\nexport type {\n  RequiredEventContextFromClient,\n  CrossChainSwapsEventProperties,\n  TradeData,\n  RequestParams,\n  RequestMetadata,\n  TxStatusData,\n  QuoteFetchData,\n  QuoteWarning,\n} from './utils/metrics/types';\n\nexport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapType,\n  isHardwareWallet,\n  isCustomSlippage,\n  getQuotesReceivedProperties,\n} from './utils/metrics/properties';\n\nexport type {\n  ChainConfiguration,\n  L1GasFees,\n  NonEvmFees,\n  QuoteMetadata,\n  GasMultiplierByChainId,\n  FeatureFlagResponse,\n  BridgeAsset,\n  GenericQuoteRequest,\n  Protocol,\n  TokenAmountValues,\n  Step,\n  RefuelData,\n  Quote,\n  QuoteResponse,\n  FeeData,\n  TxData,\n  Intent,\n  IntentOrderLike,\n  BitcoinTradeData,\n  TronTradeData,\n  BridgeControllerState,\n  BridgeControllerAction,\n  BridgeControllerActions,\n  BridgeControllerEvents,\n  BridgeControllerMessenger,\n  FeatureFlagsPlatformConfig,\n} from './types';\n\nexport { AbortReason } from './utils/metrics/constants';\n\nexport { StatusTypes } from './types';\n\nexport {\n  AssetType,\n  SortOrder,\n  ChainId,\n  RequestStatus,\n  BridgeUserAction,\n  BridgeBackgroundAction,\n  type BridgeControllerGetStateAction,\n  type BridgeControllerStateChangeEvent,\n} from './types';\n\nexport {\n  FeeType,\n  ActionTypes,\n  BridgeAssetSchema,\n  FeatureId,\n} from './utils/validators';\n\nexport {\n  ALLOWED_BRIDGE_CHAIN_IDS,\n  BridgeClientId,\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_QUOTE_MAX_ETA_SECONDS,\n  BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE,\n  BRIDGE_PREFERRED_GAS_ESTIMATE,\n  BRIDGE_MM_FEE_RATE,\n  REFRESH_INTERVAL_MS,\n  DEFAULT_MAX_REFRESH_COUNT,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_CHAIN_TO_ADDRESS_MAP,\n  BRIDGE_DEV_API_BASE_URL,\n  BRIDGE_PROD_API_BASE_URL,\n} from './constants/bridge';\n\nexport type { AllowedBridgeChainIds } from './constants/bridge';\n\nexport {\n  /**\n   * @deprecated This type should not be used. Use {@link BridgeAsset} instead.\n   */\n  type SwapsTokenObject,\n  /**\n   * @deprecated This map should not be used. Use getNativeAssetForChainId\" } instead.\n   */\n  SWAPS_CHAINID_DEFAULT_TOKEN_MAP,\n} from './constants/tokens';\n\nexport {\n  SWAPS_API_V2_BASE_URL,\n  SWAPS_CONTRACT_ADDRESSES,\n  SWAPS_WRAPPED_TOKENS_ADDRESSES,\n  ALLOWED_CONTRACT_ADDRESSES,\n} from './constants/swaps';\n\nexport { MetricsActionType, MetricsSwapType } from './utils/metrics/constants';\n\nexport {\n  isEthUsdt,\n  isNativeAddress,\n  isSolanaChainId,\n  isBitcoinChainId,\n  isTronChainId,\n  isNonEvmChainId,\n  getNativeAssetForChainId,\n  getDefaultBridgeControllerState,\n  isCrossChain,\n} from './utils/bridge';\n\nexport {\n  isValidQuoteRequest,\n  formatEtaInMinutes,\n  calcSlippagePercentage,\n} from './utils/quote';\n\nexport { calcLatestSrcBalance } from './utils/balance';\n\nexport { fetchBridgeTokens, getClientHeaders } from './utils/fetch';\n\nexport {\n  formatChainIdToCaip,\n  formatChainIdToHex,\n  formatAddressToCaipReference,\n  formatAddressToAssetId,\n} from './utils/caip-formatters';\n\nexport {\n  extractTradeData,\n  isBitcoinTrade,\n  isTronTrade,\n  isEvmTxData,\n  type Trade,\n} from './utils/trade-utils';\n\nexport {\n  selectBridgeQuotes,\n  selectDefaultSlippagePercentage,\n  type BridgeAppState,\n  selectExchangeRateByChainIdAndAddress,\n  selectIsQuoteExpired,\n  selectBridgeFeatureFlags,\n  selectMinimumBalanceForRentExemptionInSOL,\n} from './selectors';\n\nexport { DEFAULT_FEATURE_FLAG_CONFIG } from './constants/bridge';\n\nexport { getBridgeFeatureFlags } from './utils/feature-flags';\n\nexport { BRIDGE_DEFAULT_SLIPPAGE } from './utils/slippage';\n\nexport {\n  isValidSwapsContractAddress,\n  getSwapsContractAddress,\n  fetchTokens,\n  type SwapsToken,\n} from './utils/swaps';\n"]}
\ No newline at end of file
+{"version":3,"file":"index.mjs","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,gCAA4B;AAEvD,OAAO,EACL,0BAA0B,EAC1B,kCAAkC,EAClC,iBAAiB,EACjB,2BAA2B,EAC3B,aAAa,EACd,sCAAkC;AAanC,OAAO,EACL,mBAAmB,EACnB,gBAAgB,EAChB,WAAW,EACX,gBAAgB,EAChB,gBAAgB,EAChB,2BAA2B,EAC5B,uCAAmC;AA+BpC,OAAO,EAAE,WAAW,EAAE,sCAAkC;AAExD,OAAO,EAAE,WAAW,EAAE,oBAAgB;AAEtC,OAAO,EACL,SAAS,EACT,SAAS,EACT,OAAO,EACP,aAAa,EACb,gBAAgB,EAChB,sBAAsB,EAGvB,oBAAgB;AAEjB,OAAO,EACL,OAAO,EACP,WAAW,EACX,iBAAiB,EACjB,SAAS,EACV,+BAA2B;AAE5B,OAAO,EACL,wBAAwB,EACxB,cAAc,EACd,sBAAsB,EACtB,4BAA4B,EAC5B,6CAA6C,EAC7C,6BAA6B,EAC7B,kBAAkB,EAClB,mBAAmB,EACnB,yBAAyB,EACzB,+BAA+B,EAC/B,+BAA+B,EAC/B,uBAAuB,EACvB,wBAAwB,EACzB,+BAA2B;AAI5B,OAAO;AAKL;;GAEG;AACH,+BAA+B,EAChC,+BAA2B;AAE5B,OAAO,EACL,qBAAqB,EACrB,wBAAwB,EACxB,8BAA8B,EAC9B,0BAA0B,EAC3B,8BAA0B;AAE3B,OAAO,EAAE,iBAAiB,EAAE,eAAe,EAAE,sCAAkC;AAE/E,OAAO,EACL,SAAS,EACT,eAAe,EACf,eAAe,EACf,gBAAgB,EAChB,aAAa,EACb,eAAe,EACf,wBAAwB,EACxB,+BAA+B,EAC/B,YAAY,EACb,2BAAuB;AAExB,OAAO,EACL,mBAAmB,EACnB,kBAAkB,EAClB,sBAAsB,EACvB,0BAAsB;AAEvB,OAAO,EAAE,oBAAoB,EAAE,4BAAwB;AAEvD,OAAO,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,0BAAsB;AAEpE,OAAO,EACL,mBAAmB,EACnB,kBAAkB,EAClB,4BAA4B,EAC5B,sBAAsB,EACvB,oCAAgC;AAEjC,OAAO,EACL,gBAAgB,EAChB,cAAc,EACd,WAAW,EACX,WAAW,EAEZ,gCAA4B;AAE7B,OAAO,EACL,kBAAkB,EAClB,+BAA+B,EAE/B,qCAAqC,EACrC,oBAAoB,EACpB,wBAAwB,EACxB,yCAAyC,EAC1C,wBAAoB;AAErB,OAAO,EAAE,2BAA2B,EAAE,+BAA2B;AAEjE,OAAO,EAAE,qBAAqB,EAAE,kCAA8B;AAE9D,OAAO,EAAE,uBAAuB,EAAE,6BAAyB;AAE3D,OAAO,EACL,2BAA2B,EAC3B,uBAAuB,EACvB,WAAW,EAEZ,0BAAsB","sourcesContent":["export { BridgeController } from './bridge-controller';\n\nexport {\n  UnifiedSwapBridgeEventName,\n  UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,\n  InputAmountPreset,\n  MetaMetricsSwapsEventSource,\n  PollingStatus,\n} from './utils/metrics/constants';\n\nexport type {\n  RequiredEventContextFromClient,\n  CrossChainSwapsEventProperties,\n  TradeData,\n  RequestParams,\n  RequestMetadata,\n  TxStatusData,\n  QuoteFetchData,\n  QuoteWarning,\n} from './utils/metrics/types';\n\nexport {\n  formatProviderLabel,\n  getRequestParams,\n  getSwapType,\n  isHardwareWallet,\n  isCustomSlippage,\n  getQuotesReceivedProperties,\n} from './utils/metrics/properties';\n\nexport type {\n  ChainConfiguration,\n  L1GasFees,\n  NonEvmFees,\n  QuoteMetadata,\n  GasMultiplierByChainId,\n  FeatureFlagResponse,\n  BridgeAsset,\n  GenericQuoteRequest,\n  Protocol,\n  TokenAmountValues,\n  Step,\n  RefuelData,\n  Quote,\n  QuoteResponse,\n  FeeData,\n  TxData,\n  Intent,\n  IntentOrderLike,\n  BitcoinTradeData,\n  TronTradeData,\n  BridgeControllerState,\n  BridgeControllerAction,\n  BridgeControllerActions,\n  BridgeControllerEvents,\n  BridgeControllerMessenger,\n  FeatureFlagsPlatformConfig,\n} from './types';\n\nexport { AbortReason } from './utils/metrics/constants';\n\nexport { StatusTypes } from './types';\n\nexport {\n  AssetType,\n  SortOrder,\n  ChainId,\n  RequestStatus,\n  BridgeUserAction,\n  BridgeBackgroundAction,\n  type BridgeControllerGetStateAction,\n  type BridgeControllerStateChangeEvent,\n} from './types';\n\nexport {\n  FeeType,\n  ActionTypes,\n  BridgeAssetSchema,\n  FeatureId,\n} from './utils/validators';\n\nexport {\n  ALLOWED_BRIDGE_CHAIN_IDS,\n  BridgeClientId,\n  BRIDGE_CONTROLLER_NAME,\n  BRIDGE_QUOTE_MAX_ETA_SECONDS,\n  BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE,\n  BRIDGE_PREFERRED_GAS_ESTIMATE,\n  BRIDGE_MM_FEE_RATE,\n  REFRESH_INTERVAL_MS,\n  DEFAULT_MAX_REFRESH_COUNT,\n  DEFAULT_BRIDGE_CONTROLLER_STATE,\n  METABRIDGE_CHAIN_TO_ADDRESS_MAP,\n  BRIDGE_DEV_API_BASE_URL,\n  BRIDGE_PROD_API_BASE_URL,\n} from './constants/bridge';\n\nexport type { AllowedBridgeChainIds } from './constants/bridge';\n\nexport {\n  /**\n   * @deprecated This type should not be used. Use {@link BridgeAsset} instead.\n   */\n  type SwapsTokenObject,\n  /**\n   * @deprecated This map should not be used. Use getNativeAssetForChainId\" } instead.\n   */\n  SWAPS_CHAINID_DEFAULT_TOKEN_MAP,\n} from './constants/tokens';\n\nexport {\n  SWAPS_API_V2_BASE_URL,\n  SWAPS_CONTRACT_ADDRESSES,\n  SWAPS_WRAPPED_TOKENS_ADDRESSES,\n  ALLOWED_CONTRACT_ADDRESSES,\n} from './constants/swaps';\n\nexport { MetricsActionType, MetricsSwapType } from './utils/metrics/constants';\n\nexport {\n  isEthUsdt,\n  isNativeAddress,\n  isSolanaChainId,\n  isBitcoinChainId,\n  isTronChainId,\n  isNonEvmChainId,\n  getNativeAssetForChainId,\n  getDefaultBridgeControllerState,\n  isCrossChain,\n} from './utils/bridge';\n\nexport {\n  isValidQuoteRequest,\n  formatEtaInMinutes,\n  calcSlippagePercentage,\n} from './utils/quote';\n\nexport { calcLatestSrcBalance } from './utils/balance';\n\nexport { fetchBridgeTokens, getClientHeaders } from './utils/fetch';\n\nexport {\n  formatChainIdToCaip,\n  formatChainIdToHex,\n  formatAddressToCaipReference,\n  formatAddressToAssetId,\n} from './utils/caip-formatters';\n\nexport {\n  extractTradeData,\n  isBitcoinTrade,\n  isTronTrade,\n  isEvmTxData,\n  type Trade,\n} from './utils/trade-utils';\n\nexport {\n  selectBridgeQuotes,\n  selectDefaultSlippagePercentage,\n  type BridgeAppState,\n  selectExchangeRateByChainIdAndAddress,\n  selectIsQuoteExpired,\n  selectBridgeFeatureFlags,\n  selectMinimumBalanceForRentExemptionInSOL,\n} from './selectors';\n\nexport { DEFAULT_FEATURE_FLAG_CONFIG } from './constants/bridge';\n\nexport { getBridgeFeatureFlags } from './utils/feature-flags';\n\nexport { BRIDGE_DEFAULT_SLIPPAGE } from './utils/slippage';\n\nexport {\n  isValidSwapsContractAddress,\n  getSwapsContractAddress,\n  fetchTokens,\n  type SwapsToken,\n} from './utils/swaps';\n"]}
\ No newline at end of file
diff --git a/dist/types.cjs.map b/dist/types.cjs.map
index fa803e15d4876efcac1e1473da2904ec8e492068..0b147e3a1d20f087a5a679813a5ee4cfd2f736ef 100644
--- a/dist/types.cjs.map
+++ b/dist/types.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"types.cjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":";;;AAmDA;;GAEG;AACH,IAAY,SAYX;AAZD,WAAY,SAAS;IACnB,4DAA4D;IAC5D,8BAAiB,CAAA;IACjB,qBAAqB;IACrB,4BAAe,CAAA;IACf,kCAAkC;IAClC,wBAAW,CAAA;IACX;;;OAGG;IACH,gCAAmB,CAAA;AACrB,CAAC,EAZW,SAAS,yBAAT,SAAS,QAYpB;AAmFD;;GAEG;AACH,IAAY,SAGX;AAHD,WAAY,SAAS;IACnB,wCAA2B,CAAA;IAC3B,wCAA2B,CAAA;AAC7B,CAAC,EAHW,SAAS,yBAAT,SAAS,QAGpB;AAyED,IAAY,WAMX;AAND,WAAY,WAAW;IACrB,sCAAuB,CAAA;IACvB,kCAAmB,CAAA;IACnB,gCAAiB,CAAA;IACjB,kCAAmB,CAAA;IACnB,oCAAqB,CAAA;AACvB,CAAC,EANW,WAAW,2BAAX,WAAW,QAMtB;AAoDD,IAAY,OAiBX;AAjBD,WAAY,OAAO;IACjB,mCAAO,CAAA;IACP,8CAAa,CAAA;IACb,oCAAQ,CAAA;IACR,6CAAa,CAAA;IACb,2CAAY,CAAA;IACZ,wCAAW,CAAA;IACX,iDAAgB,CAAA;IAChB,mDAAiB,CAAA;IACjB,2CAAa,CAAA;IACb,wDAAyB,CAAA;IACzB,gDAAoB,CAAA;IACpB,6CAAgB,CAAA;IAChB,sCAAU,CAAA;IACV,yCAAW,CAAA;IACX,+CAAc,CAAA;IACd,8CAAc,CAAA;AAChB,CAAC,EAjBW,OAAO,uBAAP,OAAO,QAiBlB;AAID,IAAY,aAIX;AAJD,WAAY,aAAa;IACvB,uDAAO,CAAA;IACP,uDAAO,CAAA;IACP,mDAAK,CAAA;AACP,CAAC,EAJW,aAAa,6BAAb,aAAa,QAIxB;AACD,IAAY,gBAGX;AAHD,WAAY,gBAAgB;IAC1B,6DAAyC,CAAA;IACzC,0EAAsD,CAAA;AACxD,CAAC,EAHW,gBAAgB,gCAAhB,gBAAgB,QAG3B;AACD,IAAY,sBAMX;AAND,WAAY,sBAAsB;IAChC,8EAAoD,CAAA;IACpD,oDAA0B,CAAA;IAC1B,iFAAuD,CAAA;IACvD,0EAAgD,CAAA;IAChD,sDAA4B,CAAA;AAC9B,CAAC,EANW,sBAAsB,sCAAtB,sBAAsB,QAMjC","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  GetCurrencyRateState,\n  MultichainAssetsRatesControllerGetStateAction,\n  TokenRatesControllerGetStateAction,\n} from '@metamask/assets-controllers';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n} from '@metamask/network-controller';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  CaipAccountId,\n  CaipAssetId,\n  CaipAssetType,\n  CaipChainId,\n  Hex,\n} from '@metamask/utils';\n\nimport type { BridgeController } from './bridge-controller';\nimport type { BRIDGE_CONTROLLER_NAME } from './constants/bridge';\nimport type {\n  BitcoinTradeDataSchema,\n  BridgeAssetSchema,\n  ChainConfigurationSchema,\n  ChainRankingSchema,\n  FeatureId,\n  FeeDataSchema,\n  IntentSchema,\n  PlatformConfigSchema,\n  ProtocolSchema,\n  QuoteResponseSchema,\n  QuoteSchema,\n  StepSchema,\n  TronTradeDataSchema,\n  TxDataSchema,\n} from './utils/validators';\n\nexport type FetchFunction = (\n  input: RequestInfo | URL | string,\n  init?: RequestInit,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n) => Promise<any>;\n\n/**\n * The types of assets that a user can send\n */\nexport enum AssetType {\n  /** The native asset for the current network, such as ETH */\n  native = 'NATIVE',\n  /** An ERC20 token */\n  token = 'TOKEN',\n  /** An ERC721 or ERC1155 token. */\n  NFT = 'NFT',\n  /**\n   * A transaction interacting with a contract that isn't a token method\n   * interaction will be marked as dealing with an unknown asset type.\n   */\n  unknown = 'UNKNOWN',\n}\n\nexport type ChainConfiguration = Infer<typeof ChainConfigurationSchema>;\n\nexport type ChainRanking = Infer<typeof ChainRankingSchema>;\n\nexport type L1GasFees = {\n  l1GasFeesInHexWei?: string; // l1 fees for approval and trade in hex wei, appended by BridgeController.#appendL1GasFees\n};\n\nexport type NonEvmFees = {\n  nonEvmFeesInNative?: string; // Non-EVM chain fees in native units (SOL for Solana, BTC for Bitcoin)\n};\n\n/**\n * The types of values for the token amount and its values when converted to the user's selected currency and USD\n */\nexport type TokenAmountValues = {\n  /**\n   * The amount of the token\n   *\n   * @example \"1000000000000000000\"\n   */\n  amount: string;\n  /**\n   * The amount of the token in the user's selected currency\n   *\n   * @example \"4.55\"\n   */\n  valueInCurrency: string | null;\n  /**\n   * The amount of the token in USD\n   *\n   * @example \"1.234\"\n   */\n  usd: string | null;\n};\n\n/**\n * Asset exchange rate values for a given chain and address\n */\nexport type ExchangeRate = { exchangeRate?: string; usdExchangeRate?: string };\n\n/**\n * Values derived from the quote response\n */\nexport type QuoteMetadata = {\n  /**\n   * If gas is included, this is the value of the src or dest token that was used to pay for the gas\n   */\n  includedTxFees?: TokenAmountValues | null;\n  /**\n   * The gas fee for the bridge transaction.\n   * effective is the gas fee that is shown to the user. If this value is not\n   * included in the trade, the calculation falls back to the gasLimit (total)\n   * total is the gas fee that is spent by the user, including refunds.\n   * max is the max gas fee that will be used by the transaction.\n   */\n  gasFee: Record<'effective' | 'total' | 'max', TokenAmountValues>;\n  totalNetworkFee: TokenAmountValues; // estimatedGasFees + relayerFees\n  totalMaxNetworkFee: TokenAmountValues; // maxGasFees + relayerFees\n  /**\n   * The amount that the user will receive (destTokenAmount)\n   */\n  toTokenAmount: TokenAmountValues;\n  /**\n   * The minimum amount that the user will receive (minDestTokenAmount)\n   */\n  minToTokenAmount: TokenAmountValues;\n  /**\n   * If gas is included: toTokenAmount\n   * Otherwise: toTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValues, 'amount'>;\n  /**\n   * The amount that the user will send, including fees\n   * srcTokenAmount + metabridgeFee + txFee\n   */\n  sentAmount: TokenAmountValues;\n  swapRate: string; // destTokenAmount / sentAmount\n  cost: Omit<TokenAmountValues, 'amount'>; // sentAmount - adjustedReturn\n};\n\n/**\n * Sort order set by the user\n */\nexport enum SortOrder {\n  COST_ASC = 'cost_ascending',\n  ETA_ASC = 'time_descending',\n}\n\n/**\n * This is the interface for the asset object returned by the bridge-api\n * This type is used in the QuoteResponse and in the fetchBridgeTokens response\n */\nexport type BridgeAsset = Infer<typeof BridgeAssetSchema>;\n\n/**\n * This is the interface for the token object used in the extension client\n * In addition to the {@link BridgeAsset} fields, it includes balance information\n */\nexport type BridgeToken = {\n  address: string;\n  symbol: string;\n  image: string;\n  decimals: number;\n  chainId: number | Hex | ChainId | CaipChainId;\n  balance: string; // raw balance\n  // TODO deprecate this field and use balance instead\n  string: string | undefined; // normalized balance as a stringified number\n  tokenFiatAmount?: number | null;\n  occurrences?: number;\n};\n\ntype DecimalChainId = string;\nexport type GasMultiplierByChainId = Record<DecimalChainId, number>;\n\nexport type FeatureFlagResponse = Infer<typeof PlatformConfigSchema>;\n\n// TODO move definition to validators.ts\n/**\n * This is the interface for the quote request sent to the bridge-api\n * and should only be used by the fetchBridgeQuotes utility function\n * Components and redux stores should use the {@link GenericQuoteRequest} type\n */\nexport type QuoteRequest<\n  ChainIdType = ChainId | number,\n  TokenAddressType = string,\n  WalletAddressType = string,\n> = {\n  walletAddress: WalletAddressType;\n  destWalletAddress?: WalletAddressType;\n  srcChainId: ChainIdType;\n  destChainId: ChainIdType;\n  srcTokenAddress: TokenAddressType;\n  destTokenAddress: TokenAddressType;\n  /**\n   * This is the amount sent, in atomic amount\n   */\n  srcTokenAmount: string;\n  slippage?: number;\n  aggIds?: string[];\n  bridgeIds?: string[];\n  insufficientBal?: boolean;\n  resetApproval?: boolean;\n  refuel?: boolean;\n  /**\n   * Whether the response should include gasless swap quotes\n   * This should be true if the user has opted in to STX on the client\n   * and the current network has STX support\n   */\n  gasIncluded: boolean;\n  /**\n   * Whether to request quotes that use EIP-7702 delegated gasless execution\n   */\n  gasIncluded7702: boolean;\n  /**\n   * The fee that will be charged by MetaMask\n   */\n  fee?: number;\n};\n\nexport enum StatusTypes {\n  SUBMITTED = 'SUBMITTED',\n  UNKNOWN = 'UNKNOWN',\n  FAILED = 'FAILED',\n  PENDING = 'PENDING',\n  COMPLETE = 'COMPLETE',\n}\n\n/**\n * These are types that components pass in. Since data is a mix of types when coming from the redux store, we need to use a generic type that can cover all the types.\n * Payloads with this type are transformed into QuoteRequest by fetchBridgeQuotes right before fetching quotes\n */\nexport type GenericQuoteRequest = QuoteRequest<\n  Hex | CaipChainId | string | number, // chainIds\n  Hex | CaipAssetId | string, // assetIds/addresses\n  Hex | CaipAccountId | string // accountIds/addresses\n>;\n\nexport type Protocol = Infer<typeof ProtocolSchema>;\n\nexport type Step = Infer<typeof StepSchema>;\n\nexport type RefuelData = Step;\n\nexport type FeeData = Infer<typeof FeeDataSchema>;\n\nexport type Quote = Infer<typeof QuoteSchema>;\n\nexport type TxData = Infer<typeof TxDataSchema>;\n\nexport type Intent = Infer<typeof IntentSchema>;\nexport type IntentOrderLike = Intent['order'];\n\nexport type BitcoinTradeData = Infer<typeof BitcoinTradeDataSchema>;\n\nexport type TronTradeData = Infer<typeof TronTradeDataSchema>;\n/**\n * This is the type for the quote response from the bridge-api\n * TxDataType can be overriden to be a string when the quote is non-evm\n * ApprovalType can be overriden when you know the specific approval type (e.g., TxData for EVM-only contexts)\n */\nexport type QuoteResponse<\n  TxDataType = TxData | string | BitcoinTradeData | TronTradeData,\n  ApprovalType = TxData | TronTradeData,\n> = Infer<typeof QuoteResponseSchema> & {\n  trade: TxDataType;\n  approval?: ApprovalType;\n  /**\n   * Appended to the quote response based on the quote request\n   */\n  featureId?: FeatureId;\n  /**\n   * Appended to the quote response based on the quote request resetApproval flag\n   * If defined, the quote's total network fee will include the reset approval's gas limit.\n   */\n  resetApproval?: TxData;\n};\n\nexport enum ChainId {\n  ETH = 1,\n  OPTIMISM = 10,\n  BSC = 56,\n  POLYGON = 137,\n  ZKSYNC = 324,\n  BASE = 8453,\n  ARBITRUM = 42161,\n  AVALANCHE = 43114,\n  LINEA = 59144,\n  SOLANA = 1151111081099710,\n  BTC = 20000000000001,\n  TRON = 728126428,\n  SEI = 1329,\n  MONAD = 143,\n  HYPEREVM = 999,\n  MEGAETH = 4326,\n}\n\nexport type FeatureFlagsPlatformConfig = Infer<typeof PlatformConfigSchema>;\n\nexport enum RequestStatus {\n  LOADING,\n  FETCHED,\n  ERROR,\n}\nexport enum BridgeUserAction {\n  SELECT_DEST_NETWORK = 'selectDestNetwork',\n  UPDATE_QUOTE_PARAMS = 'updateBridgeQuoteRequestParams',\n}\nexport enum BridgeBackgroundAction {\n  SET_CHAIN_INTERVAL_LENGTH = 'setChainIntervalLength',\n  RESET_STATE = 'resetState',\n  TRACK_METAMETRICS_EVENT = 'trackUnifiedSwapBridgeEvent',\n  STOP_POLLING_FOR_QUOTES = 'stopPollingForQuotes',\n  FETCH_QUOTES = 'fetchQuotes',\n}\n\nexport type BridgeControllerState = {\n  quoteRequest: Partial<GenericQuoteRequest>;\n  quotes: (QuoteResponse & L1GasFees & NonEvmFees)[];\n  /**\n   * The time elapsed between the initial quote fetch and when the first valid quote was received\n   */\n  quotesInitialLoadTime: number | null;\n  /**\n   * The timestamp of when the latest quote fetch started\n   */\n  quotesLastFetched: number | null;\n  /**\n   * The status of the quote fetch, including fee calculations and validations\n   * This is set to\n   * - LOADING when the quote fetch starts\n   * - FETCHED when the process completes successfully, including when quotes are empty\n   * - ERROR when any errors occur\n   *\n   * When SSE is enabled, this is set to LOADING even when a quote is available. It is only\n   * set to FETCHED when the stream is closed and all quotes have been received\n   */\n  quotesLoadingStatus: RequestStatus | null;\n  quoteFetchError: string | null;\n  /**\n   * The number of times the quotes have been refreshed, starts at 0 and is\n   * incremented at the end of each quote fetch\n   */\n  quotesRefreshCount: number;\n  /**\n   * Asset exchange rates for EVM and multichain assets that are not indexed by the assets controllers\n   */\n  assetExchangeRates: Record<CaipAssetType, ExchangeRate>;\n  /**\n   * When the src token is SOL, this needs to be subtracted from their balance to determine\n   * the max amount that can be sent.\n   */\n  minimumBalanceForRentExemptionInLamports: string | null;\n};\n\nexport type BridgeControllerAction<\n  FunctionName extends keyof BridgeController,\n> = {\n  type: `${typeof BRIDGE_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeController[FunctionName];\n};\n\nexport type BridgeControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\nexport type BridgeControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeControllerActions =\n  | BridgeControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.SET_CHAIN_INTERVAL_LENGTH>\n  | BridgeControllerAction<BridgeBackgroundAction.RESET_STATE>\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | BridgeControllerAction<BridgeBackgroundAction.FETCH_QUOTES>\n  | BridgeControllerAction<BridgeUserAction.UPDATE_QUOTE_PARAMS>;\n\nexport type BridgeControllerEvents = BridgeControllerStateChangeEvent;\n\nexport type AllowedActions =\n  | AccountsControllerGetAccountByAddressAction\n  | GetCurrencyRateState\n  | TokenRatesControllerGetStateAction\n  | MultichainAssetsRatesControllerGetStateAction\n  | HandleSnapRequest\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | RemoteFeatureFlagControllerGetStateAction;\nexport type AllowedEvents = never;\n\n/**\n * The messenger for the BridgeController.\n */\nexport type BridgeControllerMessenger = Messenger<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerActions | AllowedActions,\n  BridgeControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
+{"version":3,"file":"types.cjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":";;;AAoDA;;GAEG;AACH,IAAY,SAYX;AAZD,WAAY,SAAS;IACnB,4DAA4D;IAC5D,8BAAiB,CAAA;IACjB,qBAAqB;IACrB,4BAAe,CAAA;IACf,kCAAkC;IAClC,wBAAW,CAAA;IACX;;;OAGG;IACH,gCAAmB,CAAA;AACrB,CAAC,EAZW,SAAS,yBAAT,SAAS,QAYpB;AAmFD;;GAEG;AACH,IAAY,SAGX;AAHD,WAAY,SAAS;IACnB,wCAA2B,CAAA;IAC3B,wCAA2B,CAAA;AAC7B,CAAC,EAHW,SAAS,yBAAT,SAAS,QAGpB;AAyED,IAAY,WAMX;AAND,WAAY,WAAW;IACrB,sCAAuB,CAAA;IACvB,kCAAmB,CAAA;IACnB,gCAAiB,CAAA;IACjB,kCAAmB,CAAA;IACnB,oCAAqB,CAAA;AACvB,CAAC,EANW,WAAW,2BAAX,WAAW,QAMtB;AAoDD,IAAY,OAiBX;AAjBD,WAAY,OAAO;IACjB,mCAAO,CAAA;IACP,8CAAa,CAAA;IACb,oCAAQ,CAAA;IACR,6CAAa,CAAA;IACb,2CAAY,CAAA;IACZ,wCAAW,CAAA;IACX,iDAAgB,CAAA;IAChB,mDAAiB,CAAA;IACjB,2CAAa,CAAA;IACb,wDAAyB,CAAA;IACzB,gDAAoB,CAAA;IACpB,6CAAgB,CAAA;IAChB,sCAAU,CAAA;IACV,yCAAW,CAAA;IACX,+CAAc,CAAA;IACd,8CAAc,CAAA;AAChB,CAAC,EAjBW,OAAO,uBAAP,OAAO,QAiBlB;AAID,IAAY,aAIX;AAJD,WAAY,aAAa;IACvB,uDAAO,CAAA;IACP,uDAAO,CAAA;IACP,mDAAK,CAAA;AACP,CAAC,EAJW,aAAa,6BAAb,aAAa,QAIxB;AACD,IAAY,gBAGX;AAHD,WAAY,gBAAgB;IAC1B,6DAAyC,CAAA;IACzC,0EAAsD,CAAA;AACxD,CAAC,EAHW,gBAAgB,gCAAhB,gBAAgB,QAG3B;AACD,IAAY,sBAMX;AAND,WAAY,sBAAsB;IAChC,8EAAoD,CAAA;IACpD,oDAA0B,CAAA;IAC1B,iFAAuD,CAAA;IACvD,0EAAgD,CAAA;IAChD,sDAA4B,CAAA;AAC9B,CAAC,EANW,sBAAsB,sCAAtB,sBAAsB,QAMjC","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  GetCurrencyRateState,\n  MultichainAssetsRatesControllerGetStateAction,\n  TokenRatesControllerGetStateAction,\n} from '@metamask/assets-controllers';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n} from '@metamask/network-controller';\nimport type { AuthenticationControllerGetBearerToken } from '@metamask/profile-sync-controller/auth';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  CaipAccountId,\n  CaipAssetId,\n  CaipAssetType,\n  CaipChainId,\n  Hex,\n} from '@metamask/utils';\n\nimport type { BridgeController } from './bridge-controller';\nimport type { BRIDGE_CONTROLLER_NAME } from './constants/bridge';\nimport type {\n  BitcoinTradeDataSchema,\n  BridgeAssetSchema,\n  ChainConfigurationSchema,\n  ChainRankingSchema,\n  FeatureId,\n  FeeDataSchema,\n  IntentSchema,\n  PlatformConfigSchema,\n  ProtocolSchema,\n  QuoteResponseSchema,\n  QuoteSchema,\n  StepSchema,\n  TronTradeDataSchema,\n  TxDataSchema,\n} from './utils/validators';\n\nexport type FetchFunction = (\n  input: RequestInfo | URL | string,\n  init?: RequestInit,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n) => Promise<any>;\n\n/**\n * The types of assets that a user can send\n */\nexport enum AssetType {\n  /** The native asset for the current network, such as ETH */\n  native = 'NATIVE',\n  /** An ERC20 token */\n  token = 'TOKEN',\n  /** An ERC721 or ERC1155 token. */\n  NFT = 'NFT',\n  /**\n   * A transaction interacting with a contract that isn't a token method\n   * interaction will be marked as dealing with an unknown asset type.\n   */\n  unknown = 'UNKNOWN',\n}\n\nexport type ChainConfiguration = Infer<typeof ChainConfigurationSchema>;\n\nexport type ChainRanking = Infer<typeof ChainRankingSchema>;\n\nexport type L1GasFees = {\n  l1GasFeesInHexWei?: string; // l1 fees for approval and trade in hex wei, appended by BridgeController.#appendL1GasFees\n};\n\nexport type NonEvmFees = {\n  nonEvmFeesInNative?: string; // Non-EVM chain fees in native units (SOL for Solana, BTC for Bitcoin)\n};\n\n/**\n * The types of values for the token amount and its values when converted to the user's selected currency and USD\n */\nexport type TokenAmountValues = {\n  /**\n   * The amount of the token\n   *\n   * @example \"1000000000000000000\"\n   */\n  amount: string;\n  /**\n   * The amount of the token in the user's selected currency\n   *\n   * @example \"4.55\"\n   */\n  valueInCurrency: string | null;\n  /**\n   * The amount of the token in USD\n   *\n   * @example \"1.234\"\n   */\n  usd: string | null;\n};\n\n/**\n * Asset exchange rate values for a given chain and address\n */\nexport type ExchangeRate = { exchangeRate?: string; usdExchangeRate?: string };\n\n/**\n * Values derived from the quote response\n */\nexport type QuoteMetadata = {\n  /**\n   * If gas is included, this is the value of the src or dest token that was used to pay for the gas\n   */\n  includedTxFees?: TokenAmountValues | null;\n  /**\n   * The gas fee for the bridge transaction.\n   * effective is the gas fee that is shown to the user. If this value is not\n   * included in the trade, the calculation falls back to the gasLimit (total)\n   * total is the gas fee that is spent by the user, including refunds.\n   * max is the max gas fee that will be used by the transaction.\n   */\n  gasFee: Record<'effective' | 'total' | 'max', TokenAmountValues>;\n  totalNetworkFee: TokenAmountValues; // estimatedGasFees + relayerFees\n  totalMaxNetworkFee: TokenAmountValues; // maxGasFees + relayerFees\n  /**\n   * The amount that the user will receive (destTokenAmount)\n   */\n  toTokenAmount: TokenAmountValues;\n  /**\n   * The minimum amount that the user will receive (minDestTokenAmount)\n   */\n  minToTokenAmount: TokenAmountValues;\n  /**\n   * If gas is included: toTokenAmount\n   * Otherwise: toTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValues, 'amount'>;\n  /**\n   * The amount that the user will send, including fees\n   * srcTokenAmount + metabridgeFee + txFee\n   */\n  sentAmount: TokenAmountValues;\n  swapRate: string; // destTokenAmount / sentAmount\n  cost: Omit<TokenAmountValues, 'amount'>; // sentAmount - adjustedReturn\n};\n\n/**\n * Sort order set by the user\n */\nexport enum SortOrder {\n  COST_ASC = 'cost_ascending',\n  ETA_ASC = 'time_descending',\n}\n\n/**\n * This is the interface for the asset object returned by the bridge-api\n * This type is used in the QuoteResponse and in the fetchBridgeTokens response\n */\nexport type BridgeAsset = Infer<typeof BridgeAssetSchema>;\n\n/**\n * This is the interface for the token object used in the extension client\n * In addition to the {@link BridgeAsset} fields, it includes balance information\n */\nexport type BridgeToken = {\n  address: string;\n  symbol: string;\n  image: string;\n  decimals: number;\n  chainId: number | Hex | ChainId | CaipChainId;\n  balance: string; // raw balance\n  // TODO deprecate this field and use balance instead\n  string: string | undefined; // normalized balance as a stringified number\n  tokenFiatAmount?: number | null;\n  occurrences?: number;\n};\n\ntype DecimalChainId = string;\nexport type GasMultiplierByChainId = Record<DecimalChainId, number>;\n\nexport type FeatureFlagResponse = Infer<typeof PlatformConfigSchema>;\n\n// TODO move definition to validators.ts\n/**\n * This is the interface for the quote request sent to the bridge-api\n * and should only be used by the fetchBridgeQuotes utility function\n * Components and redux stores should use the {@link GenericQuoteRequest} type\n */\nexport type QuoteRequest<\n  ChainIdType = ChainId | number,\n  TokenAddressType = string,\n  WalletAddressType = string,\n> = {\n  walletAddress: WalletAddressType;\n  destWalletAddress?: WalletAddressType;\n  srcChainId: ChainIdType;\n  destChainId: ChainIdType;\n  srcTokenAddress: TokenAddressType;\n  destTokenAddress: TokenAddressType;\n  /**\n   * This is the amount sent, in atomic amount\n   */\n  srcTokenAmount: string;\n  slippage?: number;\n  aggIds?: string[];\n  bridgeIds?: string[];\n  insufficientBal?: boolean;\n  resetApproval?: boolean;\n  refuel?: boolean;\n  /**\n   * Whether the response should include gasless swap quotes\n   * This should be true if the user has opted in to STX on the client\n   * and the current network has STX support\n   */\n  gasIncluded: boolean;\n  /**\n   * Whether to request quotes that use EIP-7702 delegated gasless execution\n   */\n  gasIncluded7702: boolean;\n  /**\n   * The fee that will be charged by MetaMask\n   */\n  fee?: number;\n};\n\nexport enum StatusTypes {\n  SUBMITTED = 'SUBMITTED',\n  UNKNOWN = 'UNKNOWN',\n  FAILED = 'FAILED',\n  PENDING = 'PENDING',\n  COMPLETE = 'COMPLETE',\n}\n\n/**\n * These are types that components pass in. Since data is a mix of types when coming from the redux store, we need to use a generic type that can cover all the types.\n * Payloads with this type are transformed into QuoteRequest by fetchBridgeQuotes right before fetching quotes\n */\nexport type GenericQuoteRequest = QuoteRequest<\n  Hex | CaipChainId | string | number, // chainIds\n  Hex | CaipAssetId | string, // assetIds/addresses\n  Hex | CaipAccountId | string // accountIds/addresses\n>;\n\nexport type Protocol = Infer<typeof ProtocolSchema>;\n\nexport type Step = Infer<typeof StepSchema>;\n\nexport type RefuelData = Step;\n\nexport type FeeData = Infer<typeof FeeDataSchema>;\n\nexport type Quote = Infer<typeof QuoteSchema>;\n\nexport type TxData = Infer<typeof TxDataSchema>;\n\nexport type Intent = Infer<typeof IntentSchema>;\nexport type IntentOrderLike = Intent['order'];\n\nexport type BitcoinTradeData = Infer<typeof BitcoinTradeDataSchema>;\n\nexport type TronTradeData = Infer<typeof TronTradeDataSchema>;\n/**\n * This is the type for the quote response from the bridge-api\n * TxDataType can be overriden to be a string when the quote is non-evm\n * ApprovalType can be overriden when you know the specific approval type (e.g., TxData for EVM-only contexts)\n */\nexport type QuoteResponse<\n  TxDataType = TxData | string | BitcoinTradeData | TronTradeData,\n  ApprovalType = TxData | TronTradeData,\n> = Infer<typeof QuoteResponseSchema> & {\n  trade: TxDataType;\n  approval?: ApprovalType;\n  /**\n   * Appended to the quote response based on the quote request\n   */\n  featureId?: FeatureId;\n  /**\n   * Appended to the quote response based on the quote request resetApproval flag\n   * If defined, the quote's total network fee will include the reset approval's gas limit.\n   */\n  resetApproval?: TxData;\n};\n\nexport enum ChainId {\n  ETH = 1,\n  OPTIMISM = 10,\n  BSC = 56,\n  POLYGON = 137,\n  ZKSYNC = 324,\n  BASE = 8453,\n  ARBITRUM = 42161,\n  AVALANCHE = 43114,\n  LINEA = 59144,\n  SOLANA = 1151111081099710,\n  BTC = 20000000000001,\n  TRON = 728126428,\n  SEI = 1329,\n  MONAD = 143,\n  HYPEREVM = 999,\n  MEGAETH = 4326,\n}\n\nexport type FeatureFlagsPlatformConfig = Infer<typeof PlatformConfigSchema>;\n\nexport enum RequestStatus {\n  LOADING,\n  FETCHED,\n  ERROR,\n}\nexport enum BridgeUserAction {\n  SELECT_DEST_NETWORK = 'selectDestNetwork',\n  UPDATE_QUOTE_PARAMS = 'updateBridgeQuoteRequestParams',\n}\nexport enum BridgeBackgroundAction {\n  SET_CHAIN_INTERVAL_LENGTH = 'setChainIntervalLength',\n  RESET_STATE = 'resetState',\n  TRACK_METAMETRICS_EVENT = 'trackUnifiedSwapBridgeEvent',\n  STOP_POLLING_FOR_QUOTES = 'stopPollingForQuotes',\n  FETCH_QUOTES = 'fetchQuotes',\n}\n\nexport type BridgeControllerState = {\n  quoteRequest: Partial<GenericQuoteRequest>;\n  quotes: (QuoteResponse & L1GasFees & NonEvmFees)[];\n  /**\n   * The time elapsed between the initial quote fetch and when the first valid quote was received\n   */\n  quotesInitialLoadTime: number | null;\n  /**\n   * The timestamp of when the latest quote fetch started\n   */\n  quotesLastFetched: number | null;\n  /**\n   * The status of the quote fetch, including fee calculations and validations\n   * This is set to\n   * - LOADING when the quote fetch starts\n   * - FETCHED when the process completes successfully, including when quotes are empty\n   * - ERROR when any errors occur\n   *\n   * When SSE is enabled, this is set to LOADING even when a quote is available. It is only\n   * set to FETCHED when the stream is closed and all quotes have been received\n   */\n  quotesLoadingStatus: RequestStatus | null;\n  quoteFetchError: string | null;\n  /**\n   * The number of times the quotes have been refreshed, starts at 0 and is\n   * incremented at the end of each quote fetch\n   */\n  quotesRefreshCount: number;\n  /**\n   * Asset exchange rates for EVM and multichain assets that are not indexed by the assets controllers\n   */\n  assetExchangeRates: Record<CaipAssetType, ExchangeRate>;\n  /**\n   * When the src token is SOL, this needs to be subtracted from their balance to determine\n   * the max amount that can be sent.\n   */\n  minimumBalanceForRentExemptionInLamports: string | null;\n};\n\nexport type BridgeControllerAction<\n  FunctionName extends keyof BridgeController,\n> = {\n  type: `${typeof BRIDGE_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeController[FunctionName];\n};\n\nexport type BridgeControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\nexport type BridgeControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeControllerActions =\n  | BridgeControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.SET_CHAIN_INTERVAL_LENGTH>\n  | BridgeControllerAction<BridgeBackgroundAction.RESET_STATE>\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | BridgeControllerAction<BridgeBackgroundAction.FETCH_QUOTES>\n  | BridgeControllerAction<BridgeUserAction.UPDATE_QUOTE_PARAMS>;\n\nexport type BridgeControllerEvents = BridgeControllerStateChangeEvent;\n\nexport type AllowedActions =\n  | AccountsControllerGetAccountByAddressAction\n  | AuthenticationControllerGetBearerToken\n  | GetCurrencyRateState\n  | TokenRatesControllerGetStateAction\n  | MultichainAssetsRatesControllerGetStateAction\n  | HandleSnapRequest\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | RemoteFeatureFlagControllerGetStateAction;\nexport type AllowedEvents = never;\n\n/**\n * The messenger for the BridgeController.\n */\nexport type BridgeControllerMessenger = Messenger<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerActions | AllowedActions,\n  BridgeControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
diff --git a/dist/types.d.cts b/dist/types.d.cts
index 157c7cfd5112461493ac991b8ddec19635ebb885..267d7406e304aae6382c6630018771cdda1485f2 100644
--- a/dist/types.d.cts
+++ b/dist/types.d.cts
@@ -3,6 +3,7 @@ import type { GetCurrencyRateState, MultichainAssetsRatesControllerGetStateActio
 import type { ControllerGetStateAction, ControllerStateChangeEvent } from "@metamask/base-controller";
 import type { Messenger } from "@metamask/messenger";
 import type { NetworkControllerFindNetworkClientIdByChainIdAction, NetworkControllerGetNetworkClientByIdAction } from "@metamask/network-controller";
+import type { AuthenticationControllerGetBearerToken } from "@metamask/profile-sync-controller/auth";
 import type { RemoteFeatureFlagControllerGetStateAction } from "@metamask/remote-feature-flag-controller";
 import type { HandleSnapRequest } from "@metamask/snaps-controllers";
 import type { Infer } from "@metamask/superstruct";
@@ -296,7 +297,7 @@ export type BridgeControllerGetStateAction = ControllerGetStateAction<typeof BRI
 export type BridgeControllerStateChangeEvent = ControllerStateChangeEvent<typeof BRIDGE_CONTROLLER_NAME, BridgeControllerState>;
 export type BridgeControllerActions = BridgeControllerGetStateAction | BridgeControllerAction<BridgeBackgroundAction.SET_CHAIN_INTERVAL_LENGTH> | BridgeControllerAction<BridgeBackgroundAction.RESET_STATE> | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT> | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES> | BridgeControllerAction<BridgeBackgroundAction.FETCH_QUOTES> | BridgeControllerAction<BridgeUserAction.UPDATE_QUOTE_PARAMS>;
 export type BridgeControllerEvents = BridgeControllerStateChangeEvent;
-export type AllowedActions = AccountsControllerGetAccountByAddressAction | GetCurrencyRateState | TokenRatesControllerGetStateAction | MultichainAssetsRatesControllerGetStateAction | HandleSnapRequest | NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetNetworkClientByIdAction | RemoteFeatureFlagControllerGetStateAction;
+export type AllowedActions = AccountsControllerGetAccountByAddressAction | AuthenticationControllerGetBearerToken | GetCurrencyRateState | TokenRatesControllerGetStateAction | MultichainAssetsRatesControllerGetStateAction | HandleSnapRequest | NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetNetworkClientByIdAction | RemoteFeatureFlagControllerGetStateAction;
 export type AllowedEvents = never;
 /**
  * The messenger for the BridgeController.
diff --git a/dist/types.d.cts.map b/dist/types.d.cts.map
index aa6961c06b4a5dc3b6201a333b47809cdffc347a..5dc978b454dd7d9182c34aca56fa23351619e656 100644
--- a/dist/types.d.cts.map
+++ b/dist/types.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"types.d.cts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"types.d.cts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,2CAA2C,EAAE,sCAAsC;AACjG,OAAO,KAAK,EACV,oBAAoB,EACpB,6CAA6C,EAC7C,kCAAkC,EACnC,qCAAqC;AACtC,OAAO,KAAK,EACV,wBAAwB,EACxB,0BAA0B,EAC3B,kCAAkC;AACnC,OAAO,KAAK,EAAE,SAAS,EAAE,4BAA4B;AACrD,OAAO,KAAK,EACV,mDAAmD,EACnD,2CAA2C,EAC5C,qCAAqC;AACtC,OAAO,KAAK,EAAE,sCAAsC,EAAE,+CAA+C;AACrG,OAAO,KAAK,EAAE,yCAAyC,EAAE,iDAAiD;AAC1G,OAAO,KAAK,EAAE,iBAAiB,EAAE,oCAAoC;AACrE,OAAO,KAAK,EAAE,KAAK,EAAE,8BAA8B;AACnD,OAAO,KAAK,EACV,aAAa,EACb,WAAW,EACX,aAAa,EACb,WAAW,EACX,GAAG,EACJ,wBAAwB;AAEzB,OAAO,KAAK,EAAE,gBAAgB,EAAE,gCAA4B;AAC5D,OAAO,KAAK,EAAE,sBAAsB,EAAE,+BAA2B;AACjE,OAAO,KAAK,EACV,sBAAsB,EACtB,iBAAiB,EACjB,wBAAwB,EACxB,kBAAkB,EAClB,SAAS,EACT,aAAa,EACb,YAAY,EACZ,oBAAoB,EACpB,cAAc,EACd,mBAAmB,EACnB,WAAW,EACX,UAAU,EACV,mBAAmB,EACnB,YAAY,EACb,+BAA2B;AAE5B,MAAM,MAAM,aAAa,GAAG,CAC1B,KAAK,EAAE,WAAW,GAAG,GAAG,GAAG,MAAM,EACjC,IAAI,CAAC,EAAE,WAAW,KAEf,OAAO,CAAC,GAAG,CAAC,CAAC;AAElB;;GAEG;AACH,oBAAY,SAAS;IACnB,4DAA4D;IAC5D,MAAM,WAAW;IACjB,qBAAqB;IACrB,KAAK,UAAU;IACf,kCAAkC;IAClC,GAAG,QAAQ;IACX;;;OAGG;IACH,OAAO,YAAY;CACpB;AAED,MAAM,MAAM,kBAAkB,GAAG,KAAK,CAAC,OAAO,wBAAwB,CAAC,CAAC;AAExE,MAAM,MAAM,YAAY,GAAG,KAAK,CAAC,OAAO,kBAAkB,CAAC,CAAC;AAE5D,MAAM,MAAM,SAAS,GAAG;IACtB,iBAAiB,CAAC,EAAE,MAAM,CAAC;CAC5B,CAAC;AAEF,MAAM,MAAM,UAAU,GAAG;IACvB,kBAAkB,CAAC,EAAE,MAAM,CAAC;CAC7B,CAAC;AAEF;;GAEG;AACH,MAAM,MAAM,iBAAiB,GAAG;IAC9B;;;;OAIG;IACH,MAAM,EAAE,MAAM,CAAC;IACf;;;;OAIG;IACH,eAAe,EAAE,MAAM,GAAG,IAAI,CAAC;IAC/B;;;;OAIG;IACH,GAAG,EAAE,MAAM,GAAG,IAAI,CAAC;CACpB,CAAC;AAEF;;GAEG;AACH,MAAM,MAAM,YAAY,GAAG;IAAE,YAAY,CAAC,EAAE,MAAM,CAAC;IAAC,eAAe,CAAC,EAAE,MAAM,CAAA;CAAE,CAAC;AAE/E;;GAEG;AACH,MAAM,MAAM,aAAa,GAAG;IAC1B;;OAEG;IACH,cAAc,CAAC,EAAE,iBAAiB,GAAG,IAAI,CAAC;IAC1C;;;;;;OAMG;IACH,MAAM,EAAE,MAAM,CAAC,WAAW,GAAG,OAAO,GAAG,KAAK,EAAE,iBAAiB,CAAC,CAAC;IACjE,eAAe,EAAE,iBAAiB,CAAC;IACnC,kBAAkB,EAAE,iBAAiB,CAAC;IACtC;;OAEG;IACH,aAAa,EAAE,iBAAiB,CAAC;IACjC;;OAEG;IACH,gBAAgB,EAAE,iBAAiB,CAAC;IACpC;;;OAGG;IACH,cAAc,EAAE,IAAI,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;IAClD;;;OAGG;IACH,UAAU,EAAE,iBAAiB,CAAC;IAC9B,QAAQ,EAAE,MAAM,CAAC;IACjB,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;CACzC,CAAC;AAEF;;GAEG;AACH,oBAAY,SAAS;IACnB,QAAQ,mBAAmB;IAC3B,OAAO,oBAAoB;CAC5B;AAED;;;GAGG;AACH,MAAM,MAAM,WAAW,GAAG,KAAK,CAAC,OAAO,iBAAiB,CAAC,CAAC;AAE1D;;;GAGG;AACH,MAAM,MAAM,WAAW,GAAG;IACxB,OAAO,EAAE,MAAM,CAAC;IAChB,MAAM,EAAE,MAAM,CAAC;IACf,KAAK,EAAE,MAAM,CAAC;IACd,QAAQ,EAAE,MAAM,CAAC;IACjB,OAAO,EAAE,MAAM,GAAG,GAAG,GAAG,OAAO,GAAG,WAAW,CAAC;IAC9C,OAAO,EAAE,MAAM,CAAC;IAEhB,MAAM,EAAE,MAAM,GAAG,SAAS,CAAC;IAC3B,eAAe,CAAC,EAAE,MAAM,GAAG,IAAI,CAAC;IAChC,WAAW,CAAC,EAAE,MAAM,CAAC;CACtB,CAAC;AAEF,KAAK,cAAc,GAAG,MAAM,CAAC;AAC7B,MAAM,MAAM,sBAAsB,GAAG,MAAM,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;AAEpE,MAAM,MAAM,mBAAmB,GAAG,KAAK,CAAC,OAAO,oBAAoB,CAAC,CAAC;AAGrE;;;;GAIG;AACH,MAAM,MAAM,YAAY,CACtB,WAAW,GAAG,OAAO,GAAG,MAAM,EAC9B,gBAAgB,GAAG,MAAM,EACzB,iBAAiB,GAAG,MAAM,IACxB;IACF,aAAa,EAAE,iBAAiB,CAAC;IACjC,iBAAiB,CAAC,EAAE,iBAAiB,CAAC;IACtC,UAAU,EAAE,WAAW,CAAC;IACxB,WAAW,EAAE,WAAW,CAAC;IACzB,eAAe,EAAE,gBAAgB,CAAC;IAClC,gBAAgB,EAAE,gBAAgB,CAAC;IACnC;;OAEG;IACH,cAAc,EAAE,MAAM,CAAC;IACvB,QAAQ,CAAC,EAAE,MAAM,CAAC;IAClB,MAAM,CAAC,EAAE,MAAM,EAAE,CAAC;IAClB,SAAS,CAAC,EAAE,MAAM,EAAE,CAAC;IACrB,eAAe,CAAC,EAAE,OAAO,CAAC;IAC1B,aAAa,CAAC,EAAE,OAAO,CAAC;IACxB,MAAM,CAAC,EAAE,OAAO,CAAC;IACjB;;;;OAIG;IACH,WAAW,EAAE,OAAO,CAAC;IACrB;;OAEG;IACH,eAAe,EAAE,OAAO,CAAC;IACzB;;OAEG;IACH,GAAG,CAAC,EAAE,MAAM,CAAC;CACd,CAAC;AAEF,oBAAY,WAAW;IACrB,SAAS,cAAc;IACvB,OAAO,YAAY;IACnB,MAAM,WAAW;IACjB,OAAO,YAAY;IACnB,QAAQ,aAAa;CACtB;AAED;;;GAGG;AACH,MAAM,MAAM,mBAAmB,GAAG,YAAY,CAC5C,GAAG,GAAG,WAAW,GAAG,MAAM,GAAG,MAAM,EAAE,WAAW;AAChD,AADqC,WAAW;AAChD,GAAG,GAAG,WAAW,GAAG,MAAM,EAAE,qBAAqB;AACjD,AAD4B,qBAAqB;AACjD,GAAG,GAAG,aAAa,GAAG,MAAM,CAC7B,CAAC;AAEF,MAAM,MAAM,QAAQ,GAAG,KAAK,CAAC,OAAO,cAAc,CAAC,CAAC;AAEpD,MAAM,MAAM,IAAI,GAAG,KAAK,CAAC,OAAO,UAAU,CAAC,CAAC;AAE5C,MAAM,MAAM,UAAU,GAAG,IAAI,CAAC;AAE9B,MAAM,MAAM,OAAO,GAAG,KAAK,CAAC,OAAO,aAAa,CAAC,CAAC;AAElD,MAAM,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,WAAW,CAAC,CAAC;AAE9C,MAAM,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,YAAY,CAAC,CAAC;AAEhD,MAAM,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,YAAY,CAAC,CAAC;AAChD,MAAM,MAAM,eAAe,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;AAE9C,MAAM,MAAM,gBAAgB,GAAG,KAAK,CAAC,OAAO,sBAAsB,CAAC,CAAC;AAEpE,MAAM,MAAM,aAAa,GAAG,KAAK,CAAC,OAAO,mBAAmB,CAAC,CAAC;AAC9D;;;;GAIG;AACH,MAAM,MAAM,aAAa,CACvB,UAAU,GAAG,MAAM,GAAG,MAAM,GAAG,gBAAgB,GAAG,aAAa,EAC/D,YAAY,GAAG,MAAM,GAAG,aAAa,IACnC,KAAK,CAAC,OAAO,mBAAmB,CAAC,GAAG;IACtC,KAAK,EAAE,UAAU,CAAC;IAClB,QAAQ,CAAC,EAAE,YAAY,CAAC;IACxB;;OAEG;IACH,SAAS,CAAC,EAAE,SAAS,CAAC;IACtB;;;OAGG;IACH,aAAa,CAAC,EAAE,MAAM,CAAC;CACxB,CAAC;AAEF,oBAAY,OAAO;IACjB,GAAG,IAAI;IACP,QAAQ,KAAK;IACb,GAAG,KAAK;IACR,OAAO,MAAM;IACb,MAAM,MAAM;IACZ,IAAI,OAAO;IACX,QAAQ,QAAQ;IAChB,SAAS,QAAQ;IACjB,KAAK,QAAQ;IACb,MAAM,mBAAmB;IACzB,GAAG,iBAAiB;IACpB,IAAI,YAAY;IAChB,GAAG,OAAO;IACV,KAAK,MAAM;IACX,QAAQ,MAAM;IACd,OAAO,OAAO;CACf;AAED,MAAM,MAAM,0BAA0B,GAAG,KAAK,CAAC,OAAO,oBAAoB,CAAC,CAAC;AAE5E,oBAAY,aAAa;IACvB,OAAO,IAAA;IACP,OAAO,IAAA;IACP,KAAK,IAAA;CACN;AACD,oBAAY,gBAAgB;IAC1B,mBAAmB,sBAAsB;IACzC,mBAAmB,mCAAmC;CACvD;AACD,oBAAY,sBAAsB;IAChC,yBAAyB,2BAA2B;IACpD,WAAW,eAAe;IAC1B,uBAAuB,gCAAgC;IACvD,uBAAuB,yBAAyB;IAChD,YAAY,gBAAgB;CAC7B;AAED,MAAM,MAAM,qBAAqB,GAAG;IAClC,YAAY,EAAE,OAAO,CAAC,mBAAmB,CAAC,CAAC;IAC3C,MAAM,EAAE,CAAC,aAAa,GAAG,SAAS,GAAG,UAAU,CAAC,EAAE,CAAC;IACnD;;OAEG;IACH,qBAAqB,EAAE,MAAM,GAAG,IAAI,CAAC;IACrC;;OAEG;IACH,iBAAiB,EAAE,MAAM,GAAG,IAAI,CAAC;IACjC;;;;;;;;;OASG;IACH,mBAAmB,EAAE,aAAa,GAAG,IAAI,CAAC;IAC1C,eAAe,EAAE,MAAM,GAAG,IAAI,CAAC;IAC/B;;;OAGG;IACH,kBAAkB,EAAE,MAAM,CAAC;IAC3B;;OAEG;IACH,kBAAkB,EAAE,MAAM,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;IACxD;;;OAGG;IACH,wCAAwC,EAAE,MAAM,GAAG,IAAI,CAAC;CACzD,CAAC;AAEF,MAAM,MAAM,sBAAsB,CAChC,YAAY,SAAS,MAAM,gBAAgB,IACzC;IACF,IAAI,EAAE,GAAG,OAAO,sBAAsB,IAAI,YAAY,EAAE,CAAC;IACzD,OAAO,EAAE,gBAAgB,CAAC,YAAY,CAAC,CAAC;CACzC,CAAC;AAEF,MAAM,MAAM,8BAA8B,GAAG,wBAAwB,CACnE,OAAO,sBAAsB,EAC7B,qBAAqB,CACtB,CAAC;AAEF,MAAM,MAAM,gCAAgC,GAAG,0BAA0B,CACvE,OAAO,sBAAsB,EAC7B,qBAAqB,CACtB,CAAC;AAGF,MAAM,MAAM,uBAAuB,GAC/B,8BAA8B,GAC9B,sBAAsB,CAAC,sBAAsB,CAAC,yBAAyB,CAAC,GACxE,sBAAsB,CAAC,sBAAsB,CAAC,WAAW,CAAC,GAC1D,sBAAsB,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,GACtE,sBAAsB,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,GACtE,sBAAsB,CAAC,sBAAsB,CAAC,YAAY,CAAC,GAC3D,sBAAsB,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,CAAC;AAEjE,MAAM,MAAM,sBAAsB,GAAG,gCAAgC,CAAC;AAEtE,MAAM,MAAM,cAAc,GACtB,2CAA2C,GAC3C,sCAAsC,GACtC,oBAAoB,GACpB,kCAAkC,GAClC,6CAA6C,GAC7C,iBAAiB,GACjB,mDAAmD,GACnD,2CAA2C,GAC3C,yCAAyC,CAAC;AAC9C,MAAM,MAAM,aAAa,GAAG,KAAK,CAAC;AAElC;;GAEG;AACH,MAAM,MAAM,yBAAyB,GAAG,SAAS,CAC/C,OAAO,sBAAsB,EAC7B,uBAAuB,GAAG,cAAc,EACxC,sBAAsB,GAAG,aAAa,CACvC,CAAC"}
\ No newline at end of file
diff --git a/dist/types.d.mts b/dist/types.d.mts
index a5a3669ce573db04997ab8c8004eb98f7d7a6369..2b4d3f528436313b8e4df3649123022486f3b7a4 100644
--- a/dist/types.d.mts
+++ b/dist/types.d.mts
@@ -3,6 +3,7 @@ import type { GetCurrencyRateState, MultichainAssetsRatesControllerGetStateActio
 import type { ControllerGetStateAction, ControllerStateChangeEvent } from "@metamask/base-controller";
 import type { Messenger } from "@metamask/messenger";
 import type { NetworkControllerFindNetworkClientIdByChainIdAction, NetworkControllerGetNetworkClientByIdAction } from "@metamask/network-controller";
+import type { AuthenticationControllerGetBearerToken } from "@metamask/profile-sync-controller/auth";
 import type { RemoteFeatureFlagControllerGetStateAction } from "@metamask/remote-feature-flag-controller";
 import type { HandleSnapRequest } from "@metamask/snaps-controllers";
 import type { Infer } from "@metamask/superstruct";
@@ -296,7 +297,7 @@ export type BridgeControllerGetStateAction = ControllerGetStateAction<typeof BRI
 export type BridgeControllerStateChangeEvent = ControllerStateChangeEvent<typeof BRIDGE_CONTROLLER_NAME, BridgeControllerState>;
 export type BridgeControllerActions = BridgeControllerGetStateAction | BridgeControllerAction<BridgeBackgroundAction.SET_CHAIN_INTERVAL_LENGTH> | BridgeControllerAction<BridgeBackgroundAction.RESET_STATE> | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT> | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES> | BridgeControllerAction<BridgeBackgroundAction.FETCH_QUOTES> | BridgeControllerAction<BridgeUserAction.UPDATE_QUOTE_PARAMS>;
 export type BridgeControllerEvents = BridgeControllerStateChangeEvent;
-export type AllowedActions = AccountsControllerGetAccountByAddressAction | GetCurrencyRateState | TokenRatesControllerGetStateAction | MultichainAssetsRatesControllerGetStateAction | HandleSnapRequest | NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetNetworkClientByIdAction | RemoteFeatureFlagControllerGetStateAction;
+export type AllowedActions = AccountsControllerGetAccountByAddressAction | AuthenticationControllerGetBearerToken | GetCurrencyRateState | TokenRatesControllerGetStateAction | MultichainAssetsRatesControllerGetStateAction | HandleSnapRequest | NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetNetworkClientByIdAction | RemoteFeatureFlagControllerGetStateAction;
 export type AllowedEvents = never;
 /**
  * The messenger for the BridgeController.
diff --git a/dist/types.d.mts.map b/dist/types.d.mts.map
index 4a78b59e0fb23f3ab304798b91ac3d68f5629f85..62db407b56942fad628c2417f6fd7930f074a07a 100644
--- a/dist/types.d.mts.map
+++ b/dist/types.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"types.d.mts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"types.d.mts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/types.mjs.map b/dist/types.mjs.map
index 6fca3760e820fb7a69cf7721b05eeca6b0b46b3e..60ea8cef9620f101979ef9006b4b0241e63f8efb 100644
--- a/dist/types.mjs.map
+++ b/dist/types.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"types.mjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"AAmDA;;GAEG;AACH,MAAM,CAAN,IAAY,SAYX;AAZD,WAAY,SAAS;IACnB,4DAA4D;IAC5D,8BAAiB,CAAA;IACjB,qBAAqB;IACrB,4BAAe,CAAA;IACf,kCAAkC;IAClC,wBAAW,CAAA;IACX;;;OAGG;IACH,gCAAmB,CAAA;AACrB,CAAC,EAZW,SAAS,KAAT,SAAS,QAYpB;AAmFD;;GAEG;AACH,MAAM,CAAN,IAAY,SAGX;AAHD,WAAY,SAAS;IACnB,wCAA2B,CAAA;IAC3B,wCAA2B,CAAA;AAC7B,CAAC,EAHW,SAAS,KAAT,SAAS,QAGpB;AAyED,MAAM,CAAN,IAAY,WAMX;AAND,WAAY,WAAW;IACrB,sCAAuB,CAAA;IACvB,kCAAmB,CAAA;IACnB,gCAAiB,CAAA;IACjB,kCAAmB,CAAA;IACnB,oCAAqB,CAAA;AACvB,CAAC,EANW,WAAW,KAAX,WAAW,QAMtB;AAoDD,MAAM,CAAN,IAAY,OAiBX;AAjBD,WAAY,OAAO;IACjB,mCAAO,CAAA;IACP,8CAAa,CAAA;IACb,oCAAQ,CAAA;IACR,6CAAa,CAAA;IACb,2CAAY,CAAA;IACZ,wCAAW,CAAA;IACX,iDAAgB,CAAA;IAChB,mDAAiB,CAAA;IACjB,2CAAa,CAAA;IACb,wDAAyB,CAAA;IACzB,gDAAoB,CAAA;IACpB,6CAAgB,CAAA;IAChB,sCAAU,CAAA;IACV,yCAAW,CAAA;IACX,+CAAc,CAAA;IACd,8CAAc,CAAA;AAChB,CAAC,EAjBW,OAAO,KAAP,OAAO,QAiBlB;AAID,MAAM,CAAN,IAAY,aAIX;AAJD,WAAY,aAAa;IACvB,uDAAO,CAAA;IACP,uDAAO,CAAA;IACP,mDAAK,CAAA;AACP,CAAC,EAJW,aAAa,KAAb,aAAa,QAIxB;AACD,MAAM,CAAN,IAAY,gBAGX;AAHD,WAAY,gBAAgB;IAC1B,6DAAyC,CAAA;IACzC,0EAAsD,CAAA;AACxD,CAAC,EAHW,gBAAgB,KAAhB,gBAAgB,QAG3B;AACD,MAAM,CAAN,IAAY,sBAMX;AAND,WAAY,sBAAsB;IAChC,8EAAoD,CAAA;IACpD,oDAA0B,CAAA;IAC1B,iFAAuD,CAAA;IACvD,0EAAgD,CAAA;IAChD,sDAA4B,CAAA;AAC9B,CAAC,EANW,sBAAsB,KAAtB,sBAAsB,QAMjC","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  GetCurrencyRateState,\n  MultichainAssetsRatesControllerGetStateAction,\n  TokenRatesControllerGetStateAction,\n} from '@metamask/assets-controllers';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n} from '@metamask/network-controller';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  CaipAccountId,\n  CaipAssetId,\n  CaipAssetType,\n  CaipChainId,\n  Hex,\n} from '@metamask/utils';\n\nimport type { BridgeController } from './bridge-controller';\nimport type { BRIDGE_CONTROLLER_NAME } from './constants/bridge';\nimport type {\n  BitcoinTradeDataSchema,\n  BridgeAssetSchema,\n  ChainConfigurationSchema,\n  ChainRankingSchema,\n  FeatureId,\n  FeeDataSchema,\n  IntentSchema,\n  PlatformConfigSchema,\n  ProtocolSchema,\n  QuoteResponseSchema,\n  QuoteSchema,\n  StepSchema,\n  TronTradeDataSchema,\n  TxDataSchema,\n} from './utils/validators';\n\nexport type FetchFunction = (\n  input: RequestInfo | URL | string,\n  init?: RequestInit,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n) => Promise<any>;\n\n/**\n * The types of assets that a user can send\n */\nexport enum AssetType {\n  /** The native asset for the current network, such as ETH */\n  native = 'NATIVE',\n  /** An ERC20 token */\n  token = 'TOKEN',\n  /** An ERC721 or ERC1155 token. */\n  NFT = 'NFT',\n  /**\n   * A transaction interacting with a contract that isn't a token method\n   * interaction will be marked as dealing with an unknown asset type.\n   */\n  unknown = 'UNKNOWN',\n}\n\nexport type ChainConfiguration = Infer<typeof ChainConfigurationSchema>;\n\nexport type ChainRanking = Infer<typeof ChainRankingSchema>;\n\nexport type L1GasFees = {\n  l1GasFeesInHexWei?: string; // l1 fees for approval and trade in hex wei, appended by BridgeController.#appendL1GasFees\n};\n\nexport type NonEvmFees = {\n  nonEvmFeesInNative?: string; // Non-EVM chain fees in native units (SOL for Solana, BTC for Bitcoin)\n};\n\n/**\n * The types of values for the token amount and its values when converted to the user's selected currency and USD\n */\nexport type TokenAmountValues = {\n  /**\n   * The amount of the token\n   *\n   * @example \"1000000000000000000\"\n   */\n  amount: string;\n  /**\n   * The amount of the token in the user's selected currency\n   *\n   * @example \"4.55\"\n   */\n  valueInCurrency: string | null;\n  /**\n   * The amount of the token in USD\n   *\n   * @example \"1.234\"\n   */\n  usd: string | null;\n};\n\n/**\n * Asset exchange rate values for a given chain and address\n */\nexport type ExchangeRate = { exchangeRate?: string; usdExchangeRate?: string };\n\n/**\n * Values derived from the quote response\n */\nexport type QuoteMetadata = {\n  /**\n   * If gas is included, this is the value of the src or dest token that was used to pay for the gas\n   */\n  includedTxFees?: TokenAmountValues | null;\n  /**\n   * The gas fee for the bridge transaction.\n   * effective is the gas fee that is shown to the user. If this value is not\n   * included in the trade, the calculation falls back to the gasLimit (total)\n   * total is the gas fee that is spent by the user, including refunds.\n   * max is the max gas fee that will be used by the transaction.\n   */\n  gasFee: Record<'effective' | 'total' | 'max', TokenAmountValues>;\n  totalNetworkFee: TokenAmountValues; // estimatedGasFees + relayerFees\n  totalMaxNetworkFee: TokenAmountValues; // maxGasFees + relayerFees\n  /**\n   * The amount that the user will receive (destTokenAmount)\n   */\n  toTokenAmount: TokenAmountValues;\n  /**\n   * The minimum amount that the user will receive (minDestTokenAmount)\n   */\n  minToTokenAmount: TokenAmountValues;\n  /**\n   * If gas is included: toTokenAmount\n   * Otherwise: toTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValues, 'amount'>;\n  /**\n   * The amount that the user will send, including fees\n   * srcTokenAmount + metabridgeFee + txFee\n   */\n  sentAmount: TokenAmountValues;\n  swapRate: string; // destTokenAmount / sentAmount\n  cost: Omit<TokenAmountValues, 'amount'>; // sentAmount - adjustedReturn\n};\n\n/**\n * Sort order set by the user\n */\nexport enum SortOrder {\n  COST_ASC = 'cost_ascending',\n  ETA_ASC = 'time_descending',\n}\n\n/**\n * This is the interface for the asset object returned by the bridge-api\n * This type is used in the QuoteResponse and in the fetchBridgeTokens response\n */\nexport type BridgeAsset = Infer<typeof BridgeAssetSchema>;\n\n/**\n * This is the interface for the token object used in the extension client\n * In addition to the {@link BridgeAsset} fields, it includes balance information\n */\nexport type BridgeToken = {\n  address: string;\n  symbol: string;\n  image: string;\n  decimals: number;\n  chainId: number | Hex | ChainId | CaipChainId;\n  balance: string; // raw balance\n  // TODO deprecate this field and use balance instead\n  string: string | undefined; // normalized balance as a stringified number\n  tokenFiatAmount?: number | null;\n  occurrences?: number;\n};\n\ntype DecimalChainId = string;\nexport type GasMultiplierByChainId = Record<DecimalChainId, number>;\n\nexport type FeatureFlagResponse = Infer<typeof PlatformConfigSchema>;\n\n// TODO move definition to validators.ts\n/**\n * This is the interface for the quote request sent to the bridge-api\n * and should only be used by the fetchBridgeQuotes utility function\n * Components and redux stores should use the {@link GenericQuoteRequest} type\n */\nexport type QuoteRequest<\n  ChainIdType = ChainId | number,\n  TokenAddressType = string,\n  WalletAddressType = string,\n> = {\n  walletAddress: WalletAddressType;\n  destWalletAddress?: WalletAddressType;\n  srcChainId: ChainIdType;\n  destChainId: ChainIdType;\n  srcTokenAddress: TokenAddressType;\n  destTokenAddress: TokenAddressType;\n  /**\n   * This is the amount sent, in atomic amount\n   */\n  srcTokenAmount: string;\n  slippage?: number;\n  aggIds?: string[];\n  bridgeIds?: string[];\n  insufficientBal?: boolean;\n  resetApproval?: boolean;\n  refuel?: boolean;\n  /**\n   * Whether the response should include gasless swap quotes\n   * This should be true if the user has opted in to STX on the client\n   * and the current network has STX support\n   */\n  gasIncluded: boolean;\n  /**\n   * Whether to request quotes that use EIP-7702 delegated gasless execution\n   */\n  gasIncluded7702: boolean;\n  /**\n   * The fee that will be charged by MetaMask\n   */\n  fee?: number;\n};\n\nexport enum StatusTypes {\n  SUBMITTED = 'SUBMITTED',\n  UNKNOWN = 'UNKNOWN',\n  FAILED = 'FAILED',\n  PENDING = 'PENDING',\n  COMPLETE = 'COMPLETE',\n}\n\n/**\n * These are types that components pass in. Since data is a mix of types when coming from the redux store, we need to use a generic type that can cover all the types.\n * Payloads with this type are transformed into QuoteRequest by fetchBridgeQuotes right before fetching quotes\n */\nexport type GenericQuoteRequest = QuoteRequest<\n  Hex | CaipChainId | string | number, // chainIds\n  Hex | CaipAssetId | string, // assetIds/addresses\n  Hex | CaipAccountId | string // accountIds/addresses\n>;\n\nexport type Protocol = Infer<typeof ProtocolSchema>;\n\nexport type Step = Infer<typeof StepSchema>;\n\nexport type RefuelData = Step;\n\nexport type FeeData = Infer<typeof FeeDataSchema>;\n\nexport type Quote = Infer<typeof QuoteSchema>;\n\nexport type TxData = Infer<typeof TxDataSchema>;\n\nexport type Intent = Infer<typeof IntentSchema>;\nexport type IntentOrderLike = Intent['order'];\n\nexport type BitcoinTradeData = Infer<typeof BitcoinTradeDataSchema>;\n\nexport type TronTradeData = Infer<typeof TronTradeDataSchema>;\n/**\n * This is the type for the quote response from the bridge-api\n * TxDataType can be overriden to be a string when the quote is non-evm\n * ApprovalType can be overriden when you know the specific approval type (e.g., TxData for EVM-only contexts)\n */\nexport type QuoteResponse<\n  TxDataType = TxData | string | BitcoinTradeData | TronTradeData,\n  ApprovalType = TxData | TronTradeData,\n> = Infer<typeof QuoteResponseSchema> & {\n  trade: TxDataType;\n  approval?: ApprovalType;\n  /**\n   * Appended to the quote response based on the quote request\n   */\n  featureId?: FeatureId;\n  /**\n   * Appended to the quote response based on the quote request resetApproval flag\n   * If defined, the quote's total network fee will include the reset approval's gas limit.\n   */\n  resetApproval?: TxData;\n};\n\nexport enum ChainId {\n  ETH = 1,\n  OPTIMISM = 10,\n  BSC = 56,\n  POLYGON = 137,\n  ZKSYNC = 324,\n  BASE = 8453,\n  ARBITRUM = 42161,\n  AVALANCHE = 43114,\n  LINEA = 59144,\n  SOLANA = 1151111081099710,\n  BTC = 20000000000001,\n  TRON = 728126428,\n  SEI = 1329,\n  MONAD = 143,\n  HYPEREVM = 999,\n  MEGAETH = 4326,\n}\n\nexport type FeatureFlagsPlatformConfig = Infer<typeof PlatformConfigSchema>;\n\nexport enum RequestStatus {\n  LOADING,\n  FETCHED,\n  ERROR,\n}\nexport enum BridgeUserAction {\n  SELECT_DEST_NETWORK = 'selectDestNetwork',\n  UPDATE_QUOTE_PARAMS = 'updateBridgeQuoteRequestParams',\n}\nexport enum BridgeBackgroundAction {\n  SET_CHAIN_INTERVAL_LENGTH = 'setChainIntervalLength',\n  RESET_STATE = 'resetState',\n  TRACK_METAMETRICS_EVENT = 'trackUnifiedSwapBridgeEvent',\n  STOP_POLLING_FOR_QUOTES = 'stopPollingForQuotes',\n  FETCH_QUOTES = 'fetchQuotes',\n}\n\nexport type BridgeControllerState = {\n  quoteRequest: Partial<GenericQuoteRequest>;\n  quotes: (QuoteResponse & L1GasFees & NonEvmFees)[];\n  /**\n   * The time elapsed between the initial quote fetch and when the first valid quote was received\n   */\n  quotesInitialLoadTime: number | null;\n  /**\n   * The timestamp of when the latest quote fetch started\n   */\n  quotesLastFetched: number | null;\n  /**\n   * The status of the quote fetch, including fee calculations and validations\n   * This is set to\n   * - LOADING when the quote fetch starts\n   * - FETCHED when the process completes successfully, including when quotes are empty\n   * - ERROR when any errors occur\n   *\n   * When SSE is enabled, this is set to LOADING even when a quote is available. It is only\n   * set to FETCHED when the stream is closed and all quotes have been received\n   */\n  quotesLoadingStatus: RequestStatus | null;\n  quoteFetchError: string | null;\n  /**\n   * The number of times the quotes have been refreshed, starts at 0 and is\n   * incremented at the end of each quote fetch\n   */\n  quotesRefreshCount: number;\n  /**\n   * Asset exchange rates for EVM and multichain assets that are not indexed by the assets controllers\n   */\n  assetExchangeRates: Record<CaipAssetType, ExchangeRate>;\n  /**\n   * When the src token is SOL, this needs to be subtracted from their balance to determine\n   * the max amount that can be sent.\n   */\n  minimumBalanceForRentExemptionInLamports: string | null;\n};\n\nexport type BridgeControllerAction<\n  FunctionName extends keyof BridgeController,\n> = {\n  type: `${typeof BRIDGE_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeController[FunctionName];\n};\n\nexport type BridgeControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\nexport type BridgeControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeControllerActions =\n  | BridgeControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.SET_CHAIN_INTERVAL_LENGTH>\n  | BridgeControllerAction<BridgeBackgroundAction.RESET_STATE>\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | BridgeControllerAction<BridgeBackgroundAction.FETCH_QUOTES>\n  | BridgeControllerAction<BridgeUserAction.UPDATE_QUOTE_PARAMS>;\n\nexport type BridgeControllerEvents = BridgeControllerStateChangeEvent;\n\nexport type AllowedActions =\n  | AccountsControllerGetAccountByAddressAction\n  | GetCurrencyRateState\n  | TokenRatesControllerGetStateAction\n  | MultichainAssetsRatesControllerGetStateAction\n  | HandleSnapRequest\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | RemoteFeatureFlagControllerGetStateAction;\nexport type AllowedEvents = never;\n\n/**\n * The messenger for the BridgeController.\n */\nexport type BridgeControllerMessenger = Messenger<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerActions | AllowedActions,\n  BridgeControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
+{"version":3,"file":"types.mjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"AAoDA;;GAEG;AACH,MAAM,CAAN,IAAY,SAYX;AAZD,WAAY,SAAS;IACnB,4DAA4D;IAC5D,8BAAiB,CAAA;IACjB,qBAAqB;IACrB,4BAAe,CAAA;IACf,kCAAkC;IAClC,wBAAW,CAAA;IACX;;;OAGG;IACH,gCAAmB,CAAA;AACrB,CAAC,EAZW,SAAS,KAAT,SAAS,QAYpB;AAmFD;;GAEG;AACH,MAAM,CAAN,IAAY,SAGX;AAHD,WAAY,SAAS;IACnB,wCAA2B,CAAA;IAC3B,wCAA2B,CAAA;AAC7B,CAAC,EAHW,SAAS,KAAT,SAAS,QAGpB;AAyED,MAAM,CAAN,IAAY,WAMX;AAND,WAAY,WAAW;IACrB,sCAAuB,CAAA;IACvB,kCAAmB,CAAA;IACnB,gCAAiB,CAAA;IACjB,kCAAmB,CAAA;IACnB,oCAAqB,CAAA;AACvB,CAAC,EANW,WAAW,KAAX,WAAW,QAMtB;AAoDD,MAAM,CAAN,IAAY,OAiBX;AAjBD,WAAY,OAAO;IACjB,mCAAO,CAAA;IACP,8CAAa,CAAA;IACb,oCAAQ,CAAA;IACR,6CAAa,CAAA;IACb,2CAAY,CAAA;IACZ,wCAAW,CAAA;IACX,iDAAgB,CAAA;IAChB,mDAAiB,CAAA;IACjB,2CAAa,CAAA;IACb,wDAAyB,CAAA;IACzB,gDAAoB,CAAA;IACpB,6CAAgB,CAAA;IAChB,sCAAU,CAAA;IACV,yCAAW,CAAA;IACX,+CAAc,CAAA;IACd,8CAAc,CAAA;AAChB,CAAC,EAjBW,OAAO,KAAP,OAAO,QAiBlB;AAID,MAAM,CAAN,IAAY,aAIX;AAJD,WAAY,aAAa;IACvB,uDAAO,CAAA;IACP,uDAAO,CAAA;IACP,mDAAK,CAAA;AACP,CAAC,EAJW,aAAa,KAAb,aAAa,QAIxB;AACD,MAAM,CAAN,IAAY,gBAGX;AAHD,WAAY,gBAAgB;IAC1B,6DAAyC,CAAA;IACzC,0EAAsD,CAAA;AACxD,CAAC,EAHW,gBAAgB,KAAhB,gBAAgB,QAG3B;AACD,MAAM,CAAN,IAAY,sBAMX;AAND,WAAY,sBAAsB;IAChC,8EAAoD,CAAA;IACpD,oDAA0B,CAAA;IAC1B,iFAAuD,CAAA;IACvD,0EAAgD,CAAA;IAChD,sDAA4B,CAAA;AAC9B,CAAC,EANW,sBAAsB,KAAtB,sBAAsB,QAMjC","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  GetCurrencyRateState,\n  MultichainAssetsRatesControllerGetStateAction,\n  TokenRatesControllerGetStateAction,\n} from '@metamask/assets-controllers';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n} from '@metamask/network-controller';\nimport type { AuthenticationControllerGetBearerToken } from '@metamask/profile-sync-controller/auth';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  CaipAccountId,\n  CaipAssetId,\n  CaipAssetType,\n  CaipChainId,\n  Hex,\n} from '@metamask/utils';\n\nimport type { BridgeController } from './bridge-controller';\nimport type { BRIDGE_CONTROLLER_NAME } from './constants/bridge';\nimport type {\n  BitcoinTradeDataSchema,\n  BridgeAssetSchema,\n  ChainConfigurationSchema,\n  ChainRankingSchema,\n  FeatureId,\n  FeeDataSchema,\n  IntentSchema,\n  PlatformConfigSchema,\n  ProtocolSchema,\n  QuoteResponseSchema,\n  QuoteSchema,\n  StepSchema,\n  TronTradeDataSchema,\n  TxDataSchema,\n} from './utils/validators';\n\nexport type FetchFunction = (\n  input: RequestInfo | URL | string,\n  init?: RequestInit,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n) => Promise<any>;\n\n/**\n * The types of assets that a user can send\n */\nexport enum AssetType {\n  /** The native asset for the current network, such as ETH */\n  native = 'NATIVE',\n  /** An ERC20 token */\n  token = 'TOKEN',\n  /** An ERC721 or ERC1155 token. */\n  NFT = 'NFT',\n  /**\n   * A transaction interacting with a contract that isn't a token method\n   * interaction will be marked as dealing with an unknown asset type.\n   */\n  unknown = 'UNKNOWN',\n}\n\nexport type ChainConfiguration = Infer<typeof ChainConfigurationSchema>;\n\nexport type ChainRanking = Infer<typeof ChainRankingSchema>;\n\nexport type L1GasFees = {\n  l1GasFeesInHexWei?: string; // l1 fees for approval and trade in hex wei, appended by BridgeController.#appendL1GasFees\n};\n\nexport type NonEvmFees = {\n  nonEvmFeesInNative?: string; // Non-EVM chain fees in native units (SOL for Solana, BTC for Bitcoin)\n};\n\n/**\n * The types of values for the token amount and its values when converted to the user's selected currency and USD\n */\nexport type TokenAmountValues = {\n  /**\n   * The amount of the token\n   *\n   * @example \"1000000000000000000\"\n   */\n  amount: string;\n  /**\n   * The amount of the token in the user's selected currency\n   *\n   * @example \"4.55\"\n   */\n  valueInCurrency: string | null;\n  /**\n   * The amount of the token in USD\n   *\n   * @example \"1.234\"\n   */\n  usd: string | null;\n};\n\n/**\n * Asset exchange rate values for a given chain and address\n */\nexport type ExchangeRate = { exchangeRate?: string; usdExchangeRate?: string };\n\n/**\n * Values derived from the quote response\n */\nexport type QuoteMetadata = {\n  /**\n   * If gas is included, this is the value of the src or dest token that was used to pay for the gas\n   */\n  includedTxFees?: TokenAmountValues | null;\n  /**\n   * The gas fee for the bridge transaction.\n   * effective is the gas fee that is shown to the user. If this value is not\n   * included in the trade, the calculation falls back to the gasLimit (total)\n   * total is the gas fee that is spent by the user, including refunds.\n   * max is the max gas fee that will be used by the transaction.\n   */\n  gasFee: Record<'effective' | 'total' | 'max', TokenAmountValues>;\n  totalNetworkFee: TokenAmountValues; // estimatedGasFees + relayerFees\n  totalMaxNetworkFee: TokenAmountValues; // maxGasFees + relayerFees\n  /**\n   * The amount that the user will receive (destTokenAmount)\n   */\n  toTokenAmount: TokenAmountValues;\n  /**\n   * The minimum amount that the user will receive (minDestTokenAmount)\n   */\n  minToTokenAmount: TokenAmountValues;\n  /**\n   * If gas is included: toTokenAmount\n   * Otherwise: toTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValues, 'amount'>;\n  /**\n   * The amount that the user will send, including fees\n   * srcTokenAmount + metabridgeFee + txFee\n   */\n  sentAmount: TokenAmountValues;\n  swapRate: string; // destTokenAmount / sentAmount\n  cost: Omit<TokenAmountValues, 'amount'>; // sentAmount - adjustedReturn\n};\n\n/**\n * Sort order set by the user\n */\nexport enum SortOrder {\n  COST_ASC = 'cost_ascending',\n  ETA_ASC = 'time_descending',\n}\n\n/**\n * This is the interface for the asset object returned by the bridge-api\n * This type is used in the QuoteResponse and in the fetchBridgeTokens response\n */\nexport type BridgeAsset = Infer<typeof BridgeAssetSchema>;\n\n/**\n * This is the interface for the token object used in the extension client\n * In addition to the {@link BridgeAsset} fields, it includes balance information\n */\nexport type BridgeToken = {\n  address: string;\n  symbol: string;\n  image: string;\n  decimals: number;\n  chainId: number | Hex | ChainId | CaipChainId;\n  balance: string; // raw balance\n  // TODO deprecate this field and use balance instead\n  string: string | undefined; // normalized balance as a stringified number\n  tokenFiatAmount?: number | null;\n  occurrences?: number;\n};\n\ntype DecimalChainId = string;\nexport type GasMultiplierByChainId = Record<DecimalChainId, number>;\n\nexport type FeatureFlagResponse = Infer<typeof PlatformConfigSchema>;\n\n// TODO move definition to validators.ts\n/**\n * This is the interface for the quote request sent to the bridge-api\n * and should only be used by the fetchBridgeQuotes utility function\n * Components and redux stores should use the {@link GenericQuoteRequest} type\n */\nexport type QuoteRequest<\n  ChainIdType = ChainId | number,\n  TokenAddressType = string,\n  WalletAddressType = string,\n> = {\n  walletAddress: WalletAddressType;\n  destWalletAddress?: WalletAddressType;\n  srcChainId: ChainIdType;\n  destChainId: ChainIdType;\n  srcTokenAddress: TokenAddressType;\n  destTokenAddress: TokenAddressType;\n  /**\n   * This is the amount sent, in atomic amount\n   */\n  srcTokenAmount: string;\n  slippage?: number;\n  aggIds?: string[];\n  bridgeIds?: string[];\n  insufficientBal?: boolean;\n  resetApproval?: boolean;\n  refuel?: boolean;\n  /**\n   * Whether the response should include gasless swap quotes\n   * This should be true if the user has opted in to STX on the client\n   * and the current network has STX support\n   */\n  gasIncluded: boolean;\n  /**\n   * Whether to request quotes that use EIP-7702 delegated gasless execution\n   */\n  gasIncluded7702: boolean;\n  /**\n   * The fee that will be charged by MetaMask\n   */\n  fee?: number;\n};\n\nexport enum StatusTypes {\n  SUBMITTED = 'SUBMITTED',\n  UNKNOWN = 'UNKNOWN',\n  FAILED = 'FAILED',\n  PENDING = 'PENDING',\n  COMPLETE = 'COMPLETE',\n}\n\n/**\n * These are types that components pass in. Since data is a mix of types when coming from the redux store, we need to use a generic type that can cover all the types.\n * Payloads with this type are transformed into QuoteRequest by fetchBridgeQuotes right before fetching quotes\n */\nexport type GenericQuoteRequest = QuoteRequest<\n  Hex | CaipChainId | string | number, // chainIds\n  Hex | CaipAssetId | string, // assetIds/addresses\n  Hex | CaipAccountId | string // accountIds/addresses\n>;\n\nexport type Protocol = Infer<typeof ProtocolSchema>;\n\nexport type Step = Infer<typeof StepSchema>;\n\nexport type RefuelData = Step;\n\nexport type FeeData = Infer<typeof FeeDataSchema>;\n\nexport type Quote = Infer<typeof QuoteSchema>;\n\nexport type TxData = Infer<typeof TxDataSchema>;\n\nexport type Intent = Infer<typeof IntentSchema>;\nexport type IntentOrderLike = Intent['order'];\n\nexport type BitcoinTradeData = Infer<typeof BitcoinTradeDataSchema>;\n\nexport type TronTradeData = Infer<typeof TronTradeDataSchema>;\n/**\n * This is the type for the quote response from the bridge-api\n * TxDataType can be overriden to be a string when the quote is non-evm\n * ApprovalType can be overriden when you know the specific approval type (e.g., TxData for EVM-only contexts)\n */\nexport type QuoteResponse<\n  TxDataType = TxData | string | BitcoinTradeData | TronTradeData,\n  ApprovalType = TxData | TronTradeData,\n> = Infer<typeof QuoteResponseSchema> & {\n  trade: TxDataType;\n  approval?: ApprovalType;\n  /**\n   * Appended to the quote response based on the quote request\n   */\n  featureId?: FeatureId;\n  /**\n   * Appended to the quote response based on the quote request resetApproval flag\n   * If defined, the quote's total network fee will include the reset approval's gas limit.\n   */\n  resetApproval?: TxData;\n};\n\nexport enum ChainId {\n  ETH = 1,\n  OPTIMISM = 10,\n  BSC = 56,\n  POLYGON = 137,\n  ZKSYNC = 324,\n  BASE = 8453,\n  ARBITRUM = 42161,\n  AVALANCHE = 43114,\n  LINEA = 59144,\n  SOLANA = 1151111081099710,\n  BTC = 20000000000001,\n  TRON = 728126428,\n  SEI = 1329,\n  MONAD = 143,\n  HYPEREVM = 999,\n  MEGAETH = 4326,\n}\n\nexport type FeatureFlagsPlatformConfig = Infer<typeof PlatformConfigSchema>;\n\nexport enum RequestStatus {\n  LOADING,\n  FETCHED,\n  ERROR,\n}\nexport enum BridgeUserAction {\n  SELECT_DEST_NETWORK = 'selectDestNetwork',\n  UPDATE_QUOTE_PARAMS = 'updateBridgeQuoteRequestParams',\n}\nexport enum BridgeBackgroundAction {\n  SET_CHAIN_INTERVAL_LENGTH = 'setChainIntervalLength',\n  RESET_STATE = 'resetState',\n  TRACK_METAMETRICS_EVENT = 'trackUnifiedSwapBridgeEvent',\n  STOP_POLLING_FOR_QUOTES = 'stopPollingForQuotes',\n  FETCH_QUOTES = 'fetchQuotes',\n}\n\nexport type BridgeControllerState = {\n  quoteRequest: Partial<GenericQuoteRequest>;\n  quotes: (QuoteResponse & L1GasFees & NonEvmFees)[];\n  /**\n   * The time elapsed between the initial quote fetch and when the first valid quote was received\n   */\n  quotesInitialLoadTime: number | null;\n  /**\n   * The timestamp of when the latest quote fetch started\n   */\n  quotesLastFetched: number | null;\n  /**\n   * The status of the quote fetch, including fee calculations and validations\n   * This is set to\n   * - LOADING when the quote fetch starts\n   * - FETCHED when the process completes successfully, including when quotes are empty\n   * - ERROR when any errors occur\n   *\n   * When SSE is enabled, this is set to LOADING even when a quote is available. It is only\n   * set to FETCHED when the stream is closed and all quotes have been received\n   */\n  quotesLoadingStatus: RequestStatus | null;\n  quoteFetchError: string | null;\n  /**\n   * The number of times the quotes have been refreshed, starts at 0 and is\n   * incremented at the end of each quote fetch\n   */\n  quotesRefreshCount: number;\n  /**\n   * Asset exchange rates for EVM and multichain assets that are not indexed by the assets controllers\n   */\n  assetExchangeRates: Record<CaipAssetType, ExchangeRate>;\n  /**\n   * When the src token is SOL, this needs to be subtracted from their balance to determine\n   * the max amount that can be sent.\n   */\n  minimumBalanceForRentExemptionInLamports: string | null;\n};\n\nexport type BridgeControllerAction<\n  FunctionName extends keyof BridgeController,\n> = {\n  type: `${typeof BRIDGE_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeController[FunctionName];\n};\n\nexport type BridgeControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\nexport type BridgeControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeControllerActions =\n  | BridgeControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.SET_CHAIN_INTERVAL_LENGTH>\n  | BridgeControllerAction<BridgeBackgroundAction.RESET_STATE>\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | BridgeControllerAction<BridgeBackgroundAction.FETCH_QUOTES>\n  | BridgeControllerAction<BridgeUserAction.UPDATE_QUOTE_PARAMS>;\n\nexport type BridgeControllerEvents = BridgeControllerStateChangeEvent;\n\nexport type AllowedActions =\n  | AccountsControllerGetAccountByAddressAction\n  | AuthenticationControllerGetBearerToken\n  | GetCurrencyRateState\n  | TokenRatesControllerGetStateAction\n  | MultichainAssetsRatesControllerGetStateAction\n  | HandleSnapRequest\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | RemoteFeatureFlagControllerGetStateAction;\nexport type AllowedEvents = never;\n\n/**\n * The messenger for the BridgeController.\n */\nexport type BridgeControllerMessenger = Messenger<\n  typeof BRIDGE_CONTROLLER_NAME,\n  BridgeControllerActions | AllowedActions,\n  BridgeControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
diff --git a/dist/utils/fetch.cjs b/dist/utils/fetch.cjs
index cdbe2a98fe0a35714434c0ed115f24960408df39..e70999bf67048bb8bc4d07ada041120727feb969 100644
--- a/dist/utils/fetch.cjs
+++ b/dist/utils/fetch.cjs
@@ -1,35 +1,39 @@
 "use strict";
 Object.defineProperty(exports, "__esModule", { value: true });
 exports.fetchBridgeQuoteStream = exports.fetchAssetPrices = exports.fetchBridgeQuotes = exports.fetchBridgeTokens = exports.getClientHeaders = void 0;
+/* eslint-disable @typescript-eslint/explicit-function-return-type */
 const superstruct_1 = require("@metamask/superstruct");
 const bridge_1 = require("./bridge.cjs");
 const caip_formatters_1 = require("./caip-formatters.cjs");
 const fetch_server_events_1 = require("./fetch-server-events.cjs");
 const trade_utils_1 = require("./trade-utils.cjs");
 const validators_1 = require("./validators.cjs");
-const getClientHeaders = (clientId, clientVersion) => ({
+const getClientHeaders = ({ clientId, clientVersion, jwt, }) => ({
     'X-Client-Id': clientId,
+    ...(jwt ? { Authorization: `Bearer ${jwt}` } : {}),
     ...(clientVersion ? { 'Client-Version': clientVersion } : {}),
 });
 exports.getClientHeaders = getClientHeaders;
 /**
  * Returns a list of enabled (unblocked) tokens
  *
+ * @deprecated Use the popular and search bridge-api endpoints instead
+ *
  * @param chainId - The chain ID to fetch tokens for
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of enabled (unblocked) tokens
  */
-async function fetchBridgeTokens(chainId, clientId, fetchFn, bridgeApiBaseUrl, clientVersion) {
-    // TODO make token api v2 call
+async function fetchBridgeTokens(chainId, clientId, jwt, fetchFn, bridgeApiBaseUrl, clientVersion) {
     const url = `${bridgeApiBaseUrl}/getTokens?chainId=${(0, caip_formatters_1.formatChainIdToDec)(chainId)}`;
     // TODO we will need to cache these. In Extension fetchWithCache is used. This is due to the following:
     // If we allow selecting dest networks which the user has not imported,
     // note that the Assets controller won't be able to provide tokens. In extension we fetch+cache the token list from bridge-api to handle this
     const tokens = await fetchFn(url, {
-        headers: (0, exports.getClientHeaders)(clientId, clientVersion),
+        headers: (0, exports.getClientHeaders)({ clientId, clientVersion, jwt }),
     });
     const transformedTokens = {};
     tokens.forEach((token) => {
@@ -86,17 +90,18 @@ const formatQueryParams = (request) => {
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param featureId - The feature ID to append to each quote
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quotes
  */
-async function fetchBridgeQuotes(request, signal, clientId, fetchFn, bridgeApiBaseUrl, featureId, clientVersion) {
+async function fetchBridgeQuotes(request, signal, clientId, jwt, fetchFn, bridgeApiBaseUrl, featureId, clientVersion) {
     const queryParams = formatQueryParams(request);
     const url = `${bridgeApiBaseUrl}/getQuote?${queryParams}`;
     const quotes = await fetchFn(url, {
-        headers: (0, exports.getClientHeaders)(clientId, clientVersion),
+        headers: (0, exports.getClientHeaders)({ clientId, clientVersion, jwt }),
         signal,
     });
     const uniqueValidationFailures = new Set([]);
@@ -108,10 +113,10 @@ async function fetchBridgeQuotes(request, signal, clientId, fetchFn, bridgeApiBa
         catch (error) {
             if (error instanceof superstruct_1.StructError) {
                 error.failures().forEach(({ branch, path }) => {
-                    const aggregatorId = branch?.[0]?.quote?.bridgeId ||
-                        branch?.[0]?.quote?.bridges?.[0] ||
-                        quoteResponse?.quote?.bridgeId ||
-                        quoteResponse?.quote?.bridges?.[0] ||
+                    const aggregatorId = branch?.[0]?.quote?.bridgeId ??
+                        branch?.[0]?.quote?.bridges?.[0] ??
+                        quoteResponse?.quote?.bridgeId ??
+                        quoteResponse?.quote?.bridges?.[0] ??
                         'unknown';
                     const pathString = path?.join('.') || 'unknown';
                     uniqueValidationFailures.add([aggregatorId, pathString].join('|'));
@@ -154,7 +159,7 @@ const fetchAssetPricesForCurrency = async (request) => {
     });
     const url = `https://price.api.cx.metamask.io/v3/spot-prices?${queryParams}`;
     const priceApiResponse = (await fetchFn(url, {
-        headers: (0, exports.getClientHeaders)(clientId, clientVersion),
+        headers: (0, exports.getClientHeaders)({ clientId, clientVersion }),
         signal,
     }));
     if (!priceApiResponse || typeof priceApiResponse !== 'object') {
@@ -209,6 +214,7 @@ exports.fetchAssetPrices = fetchAssetPrices;
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param serverEventHandlers - The server event handlers
  * @param serverEventHandlers.onValidationFailure - The function to handle validation failures
@@ -217,7 +223,7 @@ exports.fetchAssetPrices = fetchAssetPrices;
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quote promises
  */
-async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId, bridgeApiBaseUrl, serverEventHandlers, clientVersion) {
+async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId, jwt, bridgeApiBaseUrl, serverEventHandlers, clientVersion) {
     const queryParams = formatQueryParams(request);
     const onMessage = async (quoteResponse) => {
         const uniqueValidationFailures = new Set([]);
@@ -240,11 +246,11 @@ async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId, bridge
         catch (error) {
             if (error instanceof superstruct_1.StructError) {
                 error.failures().forEach(({ branch, path }) => {
-                    const aggregatorId = branch?.[0]?.quote?.bridgeId ||
-                        branch?.[0]?.quote?.bridges?.[0] ||
-                        quoteResponse?.quote?.bridgeId ||
-                        quoteResponse?.quote?.bridges?.[0] ||
-                        'unknown';
+                    const aggregatorId = branch?.[0]?.quote?.bridgeId ??
+                        branch?.[0]?.quote?.bridges?.[0] ??
+                        quoteResponse?.quote?.bridgeId ??
+                        (quoteResponse?.quote?.bridges?.[0] ||
+                            'unknown');
                     const pathString = path?.join('.') || 'unknown';
                     uniqueValidationFailures.add([aggregatorId, pathString].join('|'));
                 });
@@ -262,14 +268,14 @@ async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId, bridge
     const urlStream = `${bridgeApiBaseUrl}/getQuoteStream?${queryParams}`;
     await (0, fetch_server_events_1.fetchServerEvents)(urlStream, {
         headers: {
-            ...(0, exports.getClientHeaders)(clientId, clientVersion),
+            ...(0, exports.getClientHeaders)({ clientId, clientVersion, jwt }),
             'Content-Type': 'text/event-stream',
         },
         signal,
         onMessage,
-        onError: (e) => {
+        onError: (error) => {
             // Rethrow error to prevent silent fetch failures
-            throw e;
+            throw error;
         },
         onClose: async () => {
             await serverEventHandlers.onClose();
diff --git a/dist/utils/fetch.cjs.map b/dist/utils/fetch.cjs.map
index be0192a53303d448cbc97ca334c3f2001df4c02f..bda4913781cdc8f7a11d23f9230bbec3faab4081 100644
--- a/dist/utils/fetch.cjs.map
+++ b/dist/utils/fetch.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"fetch.cjs","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"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","sourcesContent":["import { StructError } from '@metamask/superstruct';\nimport type { CaipAssetType, CaipChainId, Hex } from '@metamask/utils';\n\nimport { getEthUsdtResetData } from './bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToDec,\n} from './caip-formatters';\nimport { fetchServerEvents } from './fetch-server-events';\nimport { isEvmTxData } from './trade-utils';\nimport type { FeatureId } from './validators';\nimport { validateQuoteResponse, validateSwapsTokenObject } from './validators';\nimport type {\n  QuoteResponse,\n  FetchFunction,\n  GenericQuoteRequest,\n  QuoteRequest,\n  BridgeAsset,\n} from '../types';\n\nexport const getClientHeaders = (clientId: string, clientVersion?: string) => ({\n  'X-Client-Id': clientId,\n  ...(clientVersion ? { 'Client-Version': clientVersion } : {}),\n});\n\n/**\n * Returns a list of enabled (unblocked) tokens\n *\n * @param chainId - The chain ID to fetch tokens for\n * @param clientId - The client ID for metrics\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of enabled (unblocked) tokens\n */\nexport async function fetchBridgeTokens(\n  chainId: Hex | CaipChainId,\n  clientId: string,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  clientVersion?: string,\n): Promise<Record<string, BridgeAsset>> {\n  // TODO make token api v2 call\n  const url = `${bridgeApiBaseUrl}/getTokens?chainId=${formatChainIdToDec(chainId)}`;\n\n  // TODO we will need to cache these. In Extension fetchWithCache is used. This is due to the following:\n  // If we allow selecting dest networks which the user has not imported,\n  // note that the Assets controller won't be able to provide tokens. In extension we fetch+cache the token list from bridge-api to handle this\n  const tokens = await fetchFn(url, {\n    headers: getClientHeaders(clientId, clientVersion),\n  });\n\n  const transformedTokens: Record<string, BridgeAsset> = {};\n  tokens.forEach((token: unknown) => {\n    if (validateSwapsTokenObject(token)) {\n      transformedTokens[token.address] = token;\n    }\n  });\n  return transformedTokens;\n}\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n *\n * @param request - The quote request\n * @returns A URLSearchParams object with the query parameters\n */\nconst formatQueryParams = (request: GenericQuoteRequest): URLSearchParams => {\n  const destWalletAddress = request.destWalletAddress ?? request.walletAddress;\n  // Transform the generic quote request into QuoteRequest\n  const normalizedRequest: QuoteRequest = {\n    walletAddress: formatAddressToCaipReference(request.walletAddress),\n    destWalletAddress: formatAddressToCaipReference(destWalletAddress),\n    srcChainId: formatChainIdToDec(request.srcChainId),\n    destChainId: formatChainIdToDec(request.destChainId),\n    srcTokenAddress: formatAddressToCaipReference(request.srcTokenAddress),\n    destTokenAddress: formatAddressToCaipReference(request.destTokenAddress),\n    srcTokenAmount: request.srcTokenAmount,\n    insufficientBal: Boolean(request.insufficientBal),\n    resetApproval: Boolean(request.resetApproval),\n    gasIncluded: Boolean(request.gasIncluded),\n    gasIncluded7702: Boolean(request.gasIncluded7702),\n  };\n  if (request.slippage !== undefined) {\n    normalizedRequest.slippage = request.slippage;\n  }\n  if (request.fee !== undefined) {\n    normalizedRequest.fee = request.fee;\n  }\n  if (request.aggIds && request.aggIds.length > 0) {\n    normalizedRequest.aggIds = request.aggIds;\n  }\n  if (request.bridgeIds && request.bridgeIds.length > 0) {\n    normalizedRequest.bridgeIds = request.bridgeIds;\n  }\n\n  const queryParams = new URLSearchParams();\n  Object.entries(normalizedRequest).forEach(([key, value]) => {\n    queryParams.append(key, value.toString());\n  });\n  return queryParams;\n};\n\n/**\n * Fetches quotes from the bridge-api's getQuote endpoint\n *\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param featureId - The feature ID to append to each quote\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quotes\n */\nexport async function fetchBridgeQuotes(\n  request: GenericQuoteRequest,\n  signal: AbortSignal | null,\n  clientId: string,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  featureId: FeatureId | null,\n  clientVersion?: string,\n): Promise<{\n  quotes: QuoteResponse[];\n  validationFailures: string[];\n}> {\n  const queryParams = formatQueryParams(request);\n\n  const url = `${bridgeApiBaseUrl}/getQuote?${queryParams}`;\n  const quotes: unknown[] = await fetchFn(url, {\n    headers: getClientHeaders(clientId, clientVersion),\n    signal,\n  });\n\n  const uniqueValidationFailures: Set<string> = new Set<string>([]);\n  const filteredQuotes = quotes\n    .filter((quoteResponse: unknown): quoteResponse is QuoteResponse => {\n      try {\n        return validateQuoteResponse(quoteResponse);\n      } catch (error) {\n        if (error instanceof StructError) {\n          error.failures().forEach(({ branch, path }) => {\n            const aggregatorId =\n              branch?.[0]?.quote?.bridgeId ||\n              branch?.[0]?.quote?.bridges?.[0] ||\n              (quoteResponse as QuoteResponse)?.quote?.bridgeId ||\n              (quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ||\n              'unknown';\n            const pathString = path?.join('.') || 'unknown';\n            uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n          });\n        }\n        return false;\n      }\n    })\n    .map((quote) => ({\n      ...quote,\n      featureId: featureId ?? undefined,\n      // Append the reset approval data to the quote response if the request\n      // has resetApproval set to true and the quote has an approval\n      resetApproval:\n        request.resetApproval && quote.approval && isEvmTxData(quote.approval)\n          ? {\n              ...quote.approval,\n              data: getEthUsdtResetData(request.destChainId),\n            }\n          : undefined,\n    }));\n\n  const validationFailures = Array.from(uniqueValidationFailures);\n  if (uniqueValidationFailures.size > 0) {\n    console.warn('Quote validation failed', validationFailures);\n  }\n\n  return {\n    quotes: filteredQuotes,\n    validationFailures,\n  };\n}\n\nconst fetchAssetPricesForCurrency = async (request: {\n  currency: string;\n  assetIds: Set<CaipAssetType>;\n  clientId: string;\n  clientVersion?: string;\n  fetchFn: FetchFunction;\n  signal?: AbortSignal;\n}): Promise<Record<CaipAssetType, { [currency: string]: string }>> => {\n  const { currency, assetIds, clientId, clientVersion, fetchFn, signal } =\n    request;\n  const validAssetIds = Array.from(assetIds).filter(Boolean);\n  if (validAssetIds.length === 0) {\n    return {};\n  }\n\n  const queryParams = new URLSearchParams({\n    assetIds: validAssetIds.filter(Boolean).join(','),\n    vsCurrency: currency,\n  });\n  const url = `https://price.api.cx.metamask.io/v3/spot-prices?${queryParams}`;\n  const priceApiResponse = (await fetchFn(url, {\n    headers: getClientHeaders(clientId, clientVersion),\n    signal,\n  })) as Record<CaipAssetType, { [currency: string]: number }>;\n  if (!priceApiResponse || typeof priceApiResponse !== 'object') {\n    return {};\n  }\n\n  return Object.entries(priceApiResponse).reduce<\n    Record<CaipAssetType, { [currency: string]: string }>\n  >((acc, [assetId, currencyToPrice]) => {\n    if (!currencyToPrice) {\n      return acc;\n    }\n    if (!acc[assetId as CaipAssetType]) {\n      acc[assetId as CaipAssetType] = {};\n    }\n    if (currencyToPrice[currency]) {\n      acc[assetId as CaipAssetType][currency] =\n        currencyToPrice[currency].toString();\n    }\n    return acc;\n  }, {});\n};\n\n/**\n * Fetches the asset prices from the price API for multiple currencies\n *\n * @param request - The request object\n * @returns The asset prices by assetId\n */\nexport const fetchAssetPrices = async (\n  request: {\n    currencies: Set<string>;\n  } & Omit<Parameters<typeof fetchAssetPricesForCurrency>[0], 'currency'>,\n): Promise<\n  Record<CaipAssetType, { [currency: string]: string } | undefined>\n> => {\n  const { currencies, ...args } = request;\n\n  const combinedPrices = await Promise.allSettled(\n    Array.from(currencies).map(\n      async (currency) =>\n        await fetchAssetPricesForCurrency({ ...args, currency }),\n    ),\n  ).then((priceApiResponse) => {\n    return priceApiResponse.reduce<\n      Record<CaipAssetType, { [currency: string]: string }>\n    >((acc, result) => {\n      if (result.status === 'fulfilled') {\n        Object.entries(result.value).forEach(([assetId, currencyToPrice]) => {\n          const existingPrices = acc[assetId as CaipAssetType];\n          if (!existingPrices) {\n            acc[assetId as CaipAssetType] = {};\n          }\n          Object.entries(currencyToPrice).forEach(([currency, price]) => {\n            acc[assetId as CaipAssetType][currency] = price;\n          });\n        });\n      }\n      return acc;\n    }, {});\n  });\n\n  return combinedPrices;\n};\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n * then fetches quotes from the bridge-api\n *\n * @param fetchFn - The fetch function to use\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param serverEventHandlers - The server event handlers\n * @param serverEventHandlers.onValidationFailure - The function to handle validation failures\n * @param serverEventHandlers.onValidQuoteReceived - The function to handle valid quotes\n * @param serverEventHandlers.onClose - The function to run when the stream is closed and there are no thrown errors\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quote promises\n */\nexport async function fetchBridgeQuoteStream(\n  fetchFn: FetchFunction,\n  request: GenericQuoteRequest,\n  signal: AbortSignal | undefined,\n  clientId: string,\n  bridgeApiBaseUrl: string,\n  serverEventHandlers: {\n    onClose: () => void | Promise<void>;\n    onValidationFailure: (validationFailures: string[]) => void;\n    onValidQuoteReceived: (quotes: QuoteResponse) => Promise<void>;\n  },\n  clientVersion?: string,\n): Promise<void> {\n  const queryParams = formatQueryParams(request);\n\n  const onMessage = async (quoteResponse: unknown): Promise<void> => {\n    const uniqueValidationFailures: Set<string> = new Set<string>([]);\n\n    try {\n      if (validateQuoteResponse(quoteResponse)) {\n        return await serverEventHandlers.onValidQuoteReceived({\n          ...quoteResponse,\n          // Append the reset approval data to the quote response if the request has resetApproval set to true and the quote has an approval\n          resetApproval:\n            request.resetApproval &&\n            quoteResponse.approval &&\n            isEvmTxData(quoteResponse.approval)\n              ? {\n                  ...quoteResponse.approval,\n                  data: getEthUsdtResetData(request.destChainId),\n                }\n              : undefined,\n        });\n      }\n    } catch (error) {\n      if (error instanceof StructError) {\n        error.failures().forEach(({ branch, path }) => {\n          const aggregatorId =\n            branch?.[0]?.quote?.bridgeId ||\n            branch?.[0]?.quote?.bridges?.[0] ||\n            (quoteResponse as QuoteResponse)?.quote?.bridgeId ||\n            (quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ||\n            'unknown';\n          const pathString = path?.join('.') || 'unknown';\n          uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n        });\n      }\n      const validationFailures = Array.from(uniqueValidationFailures);\n      if (uniqueValidationFailures.size > 0) {\n        console.warn('Quote validation failed', validationFailures);\n        return serverEventHandlers.onValidationFailure(validationFailures);\n      }\n      // Rethrow any unexpected errors\n      throw error;\n    }\n    return undefined;\n  };\n\n  const urlStream = `${bridgeApiBaseUrl}/getQuoteStream?${queryParams}`;\n  await fetchServerEvents(urlStream, {\n    headers: {\n      ...getClientHeaders(clientId, clientVersion),\n      'Content-Type': 'text/event-stream',\n    },\n    signal,\n    onMessage,\n    onError: (e) => {\n      // Rethrow error to prevent silent fetch failures\n      throw e;\n    },\n    onClose: async () => {\n      await serverEventHandlers.onClose();\n    },\n    fetchFn,\n  });\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"fetch.cjs","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { StructError } from '@metamask/superstruct';\nimport type { CaipAssetType, CaipChainId, Hex } from '@metamask/utils';\n\nimport { getEthUsdtResetData } from './bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToDec,\n} from './caip-formatters';\nimport { fetchServerEvents } from './fetch-server-events';\nimport { isEvmTxData } from './trade-utils';\nimport type { FeatureId } from './validators';\nimport { validateQuoteResponse, validateSwapsTokenObject } from './validators';\nimport type {\n  QuoteResponse,\n  FetchFunction,\n  GenericQuoteRequest,\n  QuoteRequest,\n  BridgeAsset,\n} from '../types';\n\nexport const getClientHeaders = ({\n  clientId,\n  clientVersion,\n  jwt,\n}: {\n  clientId: string;\n  clientVersion?: string;\n  jwt?: string;\n}) => ({\n  'X-Client-Id': clientId,\n  ...(jwt ? { Authorization: `Bearer ${jwt}` } : {}),\n  ...(clientVersion ? { 'Client-Version': clientVersion } : {}),\n});\n\n/**\n * Returns a list of enabled (unblocked) tokens\n *\n * @deprecated Use the popular and search bridge-api endpoints instead\n *\n * @param chainId - The chain ID to fetch tokens for\n * @param clientId - The client ID for metrics\n * @param jwt - The JWT token for authentication\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of enabled (unblocked) tokens\n */\nexport async function fetchBridgeTokens(\n  chainId: Hex | CaipChainId,\n  clientId: string,\n  jwt: string | undefined,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  clientVersion?: string,\n): Promise<Record<string, BridgeAsset>> {\n  const url = `${bridgeApiBaseUrl}/getTokens?chainId=${formatChainIdToDec(chainId)}`;\n\n  // TODO we will need to cache these. In Extension fetchWithCache is used. This is due to the following:\n  // If we allow selecting dest networks which the user has not imported,\n  // note that the Assets controller won't be able to provide tokens. In extension we fetch+cache the token list from bridge-api to handle this\n  const tokens = await fetchFn(url, {\n    headers: getClientHeaders({ clientId, clientVersion, jwt }),\n  });\n\n  const transformedTokens: Record<string, BridgeAsset> = {};\n  tokens.forEach((token: unknown) => {\n    if (validateSwapsTokenObject(token)) {\n      transformedTokens[token.address] = token;\n    }\n  });\n  return transformedTokens;\n}\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n *\n * @param request - The quote request\n * @returns A URLSearchParams object with the query parameters\n */\nconst formatQueryParams = (request: GenericQuoteRequest): URLSearchParams => {\n  const destWalletAddress = request.destWalletAddress ?? request.walletAddress;\n  // Transform the generic quote request into QuoteRequest\n  const normalizedRequest: QuoteRequest = {\n    walletAddress: formatAddressToCaipReference(request.walletAddress),\n    destWalletAddress: formatAddressToCaipReference(destWalletAddress),\n    srcChainId: formatChainIdToDec(request.srcChainId),\n    destChainId: formatChainIdToDec(request.destChainId),\n    srcTokenAddress: formatAddressToCaipReference(request.srcTokenAddress),\n    destTokenAddress: formatAddressToCaipReference(request.destTokenAddress),\n    srcTokenAmount: request.srcTokenAmount,\n    insufficientBal: Boolean(request.insufficientBal),\n    resetApproval: Boolean(request.resetApproval),\n    gasIncluded: Boolean(request.gasIncluded),\n    gasIncluded7702: Boolean(request.gasIncluded7702),\n  };\n  if (request.slippage !== undefined) {\n    normalizedRequest.slippage = request.slippage;\n  }\n  if (request.fee !== undefined) {\n    normalizedRequest.fee = request.fee;\n  }\n  if (request.aggIds && request.aggIds.length > 0) {\n    normalizedRequest.aggIds = request.aggIds;\n  }\n  if (request.bridgeIds && request.bridgeIds.length > 0) {\n    normalizedRequest.bridgeIds = request.bridgeIds;\n  }\n\n  const queryParams = new URLSearchParams();\n  Object.entries(normalizedRequest).forEach(([key, value]) => {\n    queryParams.append(key, value.toString());\n  });\n  return queryParams;\n};\n\n/**\n * Fetches quotes from the bridge-api's getQuote endpoint\n *\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param jwt - The JWT token for authentication\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param featureId - The feature ID to append to each quote\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quotes\n */\nexport async function fetchBridgeQuotes(\n  request: GenericQuoteRequest,\n  signal: AbortSignal | null,\n  clientId: string,\n  jwt: string | undefined,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  featureId: FeatureId | null,\n  clientVersion?: string,\n): Promise<{\n  quotes: QuoteResponse[];\n  validationFailures: string[];\n}> {\n  const queryParams = formatQueryParams(request);\n\n  const url = `${bridgeApiBaseUrl}/getQuote?${queryParams}`;\n  const quotes: unknown[] = await fetchFn(url, {\n    headers: getClientHeaders({ clientId, clientVersion, jwt }),\n    signal,\n  });\n\n  const uniqueValidationFailures: Set<string> = new Set<string>([]);\n  const filteredQuotes = quotes\n    .filter((quoteResponse: unknown): quoteResponse is QuoteResponse => {\n      try {\n        return validateQuoteResponse(quoteResponse);\n      } catch (error) {\n        if (error instanceof StructError) {\n          error.failures().forEach(({ branch, path }) => {\n            const aggregatorId =\n              branch?.[0]?.quote?.bridgeId ??\n              branch?.[0]?.quote?.bridges?.[0] ??\n              (quoteResponse as QuoteResponse)?.quote?.bridgeId ??\n              (quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ??\n              'unknown';\n            const pathString = path?.join('.') || 'unknown';\n            uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n          });\n        }\n        return false;\n      }\n    })\n    .map((quote) => ({\n      ...quote,\n      featureId: featureId ?? undefined,\n      // Append the reset approval data to the quote response if the request\n      // has resetApproval set to true and the quote has an approval\n      resetApproval:\n        request.resetApproval && quote.approval && isEvmTxData(quote.approval)\n          ? {\n              ...quote.approval,\n              data: getEthUsdtResetData(request.destChainId),\n            }\n          : undefined,\n    }));\n\n  const validationFailures = Array.from(uniqueValidationFailures);\n  if (uniqueValidationFailures.size > 0) {\n    console.warn('Quote validation failed', validationFailures);\n  }\n\n  return {\n    quotes: filteredQuotes,\n    validationFailures,\n  };\n}\n\nconst fetchAssetPricesForCurrency = async (request: {\n  currency: string;\n  assetIds: Set<CaipAssetType>;\n  clientId: string;\n  clientVersion?: string;\n  fetchFn: FetchFunction;\n  signal?: AbortSignal;\n}): Promise<Record<CaipAssetType, { [currency: string]: string }>> => {\n  const { currency, assetIds, clientId, clientVersion, fetchFn, signal } =\n    request;\n  const validAssetIds = Array.from(assetIds).filter(Boolean);\n  if (validAssetIds.length === 0) {\n    return {};\n  }\n\n  const queryParams = new URLSearchParams({\n    assetIds: validAssetIds.filter(Boolean).join(','),\n    vsCurrency: currency,\n  });\n  const url = `https://price.api.cx.metamask.io/v3/spot-prices?${queryParams}`;\n  const priceApiResponse = (await fetchFn(url, {\n    headers: getClientHeaders({ clientId, clientVersion }),\n    signal,\n  })) as Record<CaipAssetType, { [currency: string]: number }>;\n  if (!priceApiResponse || typeof priceApiResponse !== 'object') {\n    return {};\n  }\n\n  return Object.entries(priceApiResponse).reduce<\n    Record<CaipAssetType, { [currency: string]: string }>\n  >((acc, [assetId, currencyToPrice]) => {\n    if (!currencyToPrice) {\n      return acc;\n    }\n    if (!acc[assetId as CaipAssetType]) {\n      acc[assetId as CaipAssetType] = {};\n    }\n    if (currencyToPrice[currency]) {\n      acc[assetId as CaipAssetType][currency] =\n        currencyToPrice[currency].toString();\n    }\n    return acc;\n  }, {});\n};\n\n/**\n * Fetches the asset prices from the price API for multiple currencies\n *\n * @param request - The request object\n * @returns The asset prices by assetId\n */\nexport const fetchAssetPrices = async (\n  request: {\n    currencies: Set<string>;\n  } & Omit<Parameters<typeof fetchAssetPricesForCurrency>[0], 'currency'>,\n): Promise<\n  Record<CaipAssetType, { [currency: string]: string } | undefined>\n> => {\n  const { currencies, ...args } = request;\n\n  const combinedPrices = await Promise.allSettled(\n    Array.from(currencies).map(\n      async (currency) =>\n        await fetchAssetPricesForCurrency({ ...args, currency }),\n    ),\n  ).then((priceApiResponse) => {\n    return priceApiResponse.reduce<\n      Record<CaipAssetType, { [currency: string]: string }>\n    >((acc, result) => {\n      if (result.status === 'fulfilled') {\n        Object.entries(result.value).forEach(([assetId, currencyToPrice]) => {\n          const existingPrices = acc[assetId as CaipAssetType];\n          if (!existingPrices) {\n            acc[assetId as CaipAssetType] = {};\n          }\n          Object.entries(currencyToPrice).forEach(([currency, price]) => {\n            acc[assetId as CaipAssetType][currency] = price;\n          });\n        });\n      }\n      return acc;\n    }, {});\n  });\n\n  return combinedPrices;\n};\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n * then fetches quotes from the bridge-api\n *\n * @param fetchFn - The fetch function to use\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param jwt - The JWT token for authentication\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param serverEventHandlers - The server event handlers\n * @param serverEventHandlers.onValidationFailure - The function to handle validation failures\n * @param serverEventHandlers.onValidQuoteReceived - The function to handle valid quotes\n * @param serverEventHandlers.onClose - The function to run when the stream is closed and there are no thrown errors\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quote promises\n */\nexport async function fetchBridgeQuoteStream(\n  fetchFn: FetchFunction,\n  request: GenericQuoteRequest,\n  signal: AbortSignal | undefined,\n  clientId: string,\n  jwt: string | undefined,\n  bridgeApiBaseUrl: string,\n  serverEventHandlers: {\n    onClose: () => void | Promise<void>;\n    onValidationFailure: (validationFailures: string[]) => void;\n    onValidQuoteReceived: (quotes: QuoteResponse) => Promise<void>;\n  },\n  clientVersion?: string,\n): Promise<void> {\n  const queryParams = formatQueryParams(request);\n\n  const onMessage = async (quoteResponse: unknown): Promise<void> => {\n    const uniqueValidationFailures: Set<string> = new Set<string>([]);\n\n    try {\n      if (validateQuoteResponse(quoteResponse)) {\n        return await serverEventHandlers.onValidQuoteReceived({\n          ...quoteResponse,\n          // Append the reset approval data to the quote response if the request has resetApproval set to true and the quote has an approval\n          resetApproval:\n            request.resetApproval &&\n            quoteResponse.approval &&\n            isEvmTxData(quoteResponse.approval)\n              ? {\n                  ...quoteResponse.approval,\n                  data: getEthUsdtResetData(request.destChainId),\n                }\n              : undefined,\n        });\n      }\n    } catch (error) {\n      if (error instanceof StructError) {\n        error.failures().forEach(({ branch, path }) => {\n          const aggregatorId =\n            branch?.[0]?.quote?.bridgeId ??\n            branch?.[0]?.quote?.bridges?.[0] ??\n            (quoteResponse as QuoteResponse)?.quote?.bridgeId ??\n            ((quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ||\n              ('unknown' as string));\n          const pathString = path?.join('.') || 'unknown';\n          uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n        });\n      }\n      const validationFailures = Array.from(uniqueValidationFailures);\n      if (uniqueValidationFailures.size > 0) {\n        console.warn('Quote validation failed', validationFailures);\n        return serverEventHandlers.onValidationFailure(validationFailures);\n      }\n      // Rethrow any unexpected errors\n      throw error;\n    }\n    return undefined;\n  };\n\n  const urlStream = `${bridgeApiBaseUrl}/getQuoteStream?${queryParams}`;\n  await fetchServerEvents(urlStream, {\n    headers: {\n      ...getClientHeaders({ clientId, clientVersion, jwt }),\n      'Content-Type': 'text/event-stream',\n    },\n    signal,\n    onMessage,\n    onError: (error) => {\n      // Rethrow error to prevent silent fetch failures\n      throw error;\n    },\n    onClose: async () => {\n      await serverEventHandlers.onClose();\n    },\n    fetchFn,\n  });\n}\n"]}
\ No newline at end of file
diff --git a/dist/utils/fetch.d.cts b/dist/utils/fetch.d.cts
index f2d6b1502c14e4984460005b2eea40de1f163dbd..b86b352c1766ac97c25300f156785f85e162c77b 100644
--- a/dist/utils/fetch.d.cts
+++ b/dist/utils/fetch.d.cts
@@ -1,34 +1,43 @@
 import type { CaipAssetType, CaipChainId, Hex } from "@metamask/utils";
 import type { FeatureId } from "./validators.cjs";
 import type { QuoteResponse, FetchFunction, GenericQuoteRequest, BridgeAsset } from "../types.cjs";
-export declare const getClientHeaders: (clientId: string, clientVersion?: string) => {
+export declare const getClientHeaders: ({ clientId, clientVersion, jwt, }: {
+    clientId: string;
+    clientVersion?: string | undefined;
+    jwt?: string | undefined;
+}) => {
     'Client-Version'?: string | undefined;
+    Authorization?: string | undefined;
     'X-Client-Id': string;
 };
 /**
  * Returns a list of enabled (unblocked) tokens
  *
+ * @deprecated Use the popular and search bridge-api endpoints instead
+ *
  * @param chainId - The chain ID to fetch tokens for
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of enabled (unblocked) tokens
  */
-export declare function fetchBridgeTokens(chainId: Hex | CaipChainId, clientId: string, fetchFn: FetchFunction, bridgeApiBaseUrl: string, clientVersion?: string): Promise<Record<string, BridgeAsset>>;
+export declare function fetchBridgeTokens(chainId: Hex | CaipChainId, clientId: string, jwt: string | undefined, fetchFn: FetchFunction, bridgeApiBaseUrl: string, clientVersion?: string): Promise<Record<string, BridgeAsset>>;
 /**
  * Fetches quotes from the bridge-api's getQuote endpoint
  *
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param featureId - The feature ID to append to each quote
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quotes
  */
-export declare function fetchBridgeQuotes(request: GenericQuoteRequest, signal: AbortSignal | null, clientId: string, fetchFn: FetchFunction, bridgeApiBaseUrl: string, featureId: FeatureId | null, clientVersion?: string): Promise<{
+export declare function fetchBridgeQuotes(request: GenericQuoteRequest, signal: AbortSignal | null, clientId: string, jwt: string | undefined, fetchFn: FetchFunction, bridgeApiBaseUrl: string, featureId: FeatureId | null, clientVersion?: string): Promise<{
     quotes: QuoteResponse[];
     validationFailures: string[];
 }>;
@@ -61,6 +70,7 @@ export declare const fetchAssetPrices: (request: {
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param serverEventHandlers - The server event handlers
  * @param serverEventHandlers.onValidationFailure - The function to handle validation failures
@@ -69,7 +79,7 @@ export declare const fetchAssetPrices: (request: {
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quote promises
  */
-export declare function fetchBridgeQuoteStream(fetchFn: FetchFunction, request: GenericQuoteRequest, signal: AbortSignal | undefined, clientId: string, bridgeApiBaseUrl: string, serverEventHandlers: {
+export declare function fetchBridgeQuoteStream(fetchFn: FetchFunction, request: GenericQuoteRequest, signal: AbortSignal | undefined, clientId: string, jwt: string | undefined, bridgeApiBaseUrl: string, serverEventHandlers: {
     onClose: () => void | Promise<void>;
     onValidationFailure: (validationFailures: string[]) => void;
     onValidQuoteReceived: (quotes: QuoteResponse) => Promise<void>;
diff --git a/dist/utils/fetch.d.cts.map b/dist/utils/fetch.d.cts.map
index f496478029e8939ce920c63a211c70cf20e76af7..e655208367cc9ce0e709f8ea2e8d39f12a848fa9 100644
--- a/dist/utils/fetch.d.cts.map
+++ b/dist/utils/fetch.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"fetch.d.cts","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG,EAAE,wBAAwB;AASvE,OAAO,KAAK,EAAE,SAAS,EAAE,yBAAqB;AAE9C,OAAO,KAAK,EACV,aAAa,EACb,aAAa,EACb,mBAAmB,EAEnB,WAAW,EACZ,qBAAiB;AAElB,eAAO,MAAM,gBAAgB,aAAc,MAAM,kBAAkB,MAAM;;;CAGvE,CAAC;AAEH;;;;;;;;;GASG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,GAAG,GAAG,WAAW,EAC1B,QAAQ,EAAE,MAAM,EAChB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,CAkBtC;AA4CD;;;;;;;;;;;GAWG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,IAAI,EAC1B,QAAQ,EAAE,MAAM,EAChB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,SAAS,EAAE,SAAS,GAAG,IAAI,EAC3B,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC;IACT,MAAM,EAAE,aAAa,EAAE,CAAC;IACxB,kBAAkB,EAAE,MAAM,EAAE,CAAC;CAC9B,CAAC,CAqDD;AAED,QAAA,MAAM,2BAA2B,YAAmB;IAClD,QAAQ,EAAE,MAAM,CAAC;IACjB,QAAQ,EAAE,IAAI,aAAa,CAAC,CAAC;IAC7B,QAAQ,EAAE,MAAM,CAAC;IACjB,aAAa,CAAC,EAAE,MAAM,CAAC;IACvB,OAAO,EAAE,aAAa,CAAC;IACvB,MAAM,CAAC,EAAE,WAAW,CAAC;CACtB;;GAoCA,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,gBAAgB,YAClB;IACP,UAAU,EAAE,IAAI,MAAM,CAAC,CAAC;CACzB,GAAG,KAAK,WAAW,kCAAkC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC;;eA+BxE,CAAC;AAEF;;;;;;;;;;;;;;;GAeG;AACH,wBAAsB,sBAAsB,CAC1C,OAAO,EAAE,aAAa,EACtB,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,SAAS,EAC/B,QAAQ,EAAE,MAAM,EAChB,gBAAgB,EAAE,MAAM,EACxB,mBAAmB,EAAE;IACnB,OAAO,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IACpC,mBAAmB,EAAE,CAAC,kBAAkB,EAAE,MAAM,EAAE,KAAK,IAAI,CAAC;IAC5D,oBAAoB,EAAE,CAAC,MAAM,EAAE,aAAa,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;CAChE,EACD,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,IAAI,CAAC,CA+Df"}
\ No newline at end of file
+{"version":3,"file":"fetch.d.cts","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"AAEA,OAAO,KAAK,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG,EAAE,wBAAwB;AASvE,OAAO,KAAK,EAAE,SAAS,EAAE,yBAAqB;AAE9C,OAAO,KAAK,EACV,aAAa,EACb,aAAa,EACb,mBAAmB,EAEnB,WAAW,EACZ,qBAAiB;AAElB,eAAO,MAAM,gBAAgB;cAKjB,MAAM;;;;;;;CAOhB,CAAC;AAEH;;;;;;;;;;;;GAYG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,GAAG,GAAG,WAAW,EAC1B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,EACvB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,CAiBtC;AA4CD;;;;;;;;;;;;GAYG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,IAAI,EAC1B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,EACvB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,SAAS,EAAE,SAAS,GAAG,IAAI,EAC3B,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC;IACT,MAAM,EAAE,aAAa,EAAE,CAAC;IACxB,kBAAkB,EAAE,MAAM,EAAE,CAAC;CAC9B,CAAC,CAqDD;AAED,QAAA,MAAM,2BAA2B,YAAmB;IAClD,QAAQ,EAAE,MAAM,CAAC;IACjB,QAAQ,EAAE,IAAI,aAAa,CAAC,CAAC;IAC7B,QAAQ,EAAE,MAAM,CAAC;IACjB,aAAa,CAAC,EAAE,MAAM,CAAC;IACvB,OAAO,EAAE,aAAa,CAAC;IACvB,MAAM,CAAC,EAAE,WAAW,CAAC;CACtB;;GAoCA,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,gBAAgB,YAClB;IACP,UAAU,EAAE,IAAI,MAAM,CAAC,CAAC;CACzB,GAAG,KAAK,WAAW,kCAAkC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC;;eA+BxE,CAAC;AAEF;;;;;;;;;;;;;;;;GAgBG;AACH,wBAAsB,sBAAsB,CAC1C,OAAO,EAAE,aAAa,EACtB,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,SAAS,EAC/B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,EACvB,gBAAgB,EAAE,MAAM,EACxB,mBAAmB,EAAE;IACnB,OAAO,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IACpC,mBAAmB,EAAE,CAAC,kBAAkB,EAAE,MAAM,EAAE,KAAK,IAAI,CAAC;IAC5D,oBAAoB,EAAE,CAAC,MAAM,EAAE,aAAa,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;CAChE,EACD,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,IAAI,CAAC,CA+Df"}
\ No newline at end of file
diff --git a/dist/utils/fetch.d.mts b/dist/utils/fetch.d.mts
index 0ee5787841ec891f471f644483b3d8ae40b6ef9f..79a9df78fe4e80700afa073cc68d240b0500e302 100644
--- a/dist/utils/fetch.d.mts
+++ b/dist/utils/fetch.d.mts
@@ -1,34 +1,43 @@
 import type { CaipAssetType, CaipChainId, Hex } from "@metamask/utils";
 import type { FeatureId } from "./validators.mjs";
 import type { QuoteResponse, FetchFunction, GenericQuoteRequest, BridgeAsset } from "../types.mjs";
-export declare const getClientHeaders: (clientId: string, clientVersion?: string) => {
+export declare const getClientHeaders: ({ clientId, clientVersion, jwt, }: {
+    clientId: string;
+    clientVersion?: string | undefined;
+    jwt?: string | undefined;
+}) => {
     'Client-Version'?: string | undefined;
+    Authorization?: string | undefined;
     'X-Client-Id': string;
 };
 /**
  * Returns a list of enabled (unblocked) tokens
  *
+ * @deprecated Use the popular and search bridge-api endpoints instead
+ *
  * @param chainId - The chain ID to fetch tokens for
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of enabled (unblocked) tokens
  */
-export declare function fetchBridgeTokens(chainId: Hex | CaipChainId, clientId: string, fetchFn: FetchFunction, bridgeApiBaseUrl: string, clientVersion?: string): Promise<Record<string, BridgeAsset>>;
+export declare function fetchBridgeTokens(chainId: Hex | CaipChainId, clientId: string, jwt: string | undefined, fetchFn: FetchFunction, bridgeApiBaseUrl: string, clientVersion?: string): Promise<Record<string, BridgeAsset>>;
 /**
  * Fetches quotes from the bridge-api's getQuote endpoint
  *
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param featureId - The feature ID to append to each quote
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quotes
  */
-export declare function fetchBridgeQuotes(request: GenericQuoteRequest, signal: AbortSignal | null, clientId: string, fetchFn: FetchFunction, bridgeApiBaseUrl: string, featureId: FeatureId | null, clientVersion?: string): Promise<{
+export declare function fetchBridgeQuotes(request: GenericQuoteRequest, signal: AbortSignal | null, clientId: string, jwt: string | undefined, fetchFn: FetchFunction, bridgeApiBaseUrl: string, featureId: FeatureId | null, clientVersion?: string): Promise<{
     quotes: QuoteResponse[];
     validationFailures: string[];
 }>;
@@ -61,6 +70,7 @@ export declare const fetchAssetPrices: (request: {
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param serverEventHandlers - The server event handlers
  * @param serverEventHandlers.onValidationFailure - The function to handle validation failures
@@ -69,7 +79,7 @@ export declare const fetchAssetPrices: (request: {
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quote promises
  */
-export declare function fetchBridgeQuoteStream(fetchFn: FetchFunction, request: GenericQuoteRequest, signal: AbortSignal | undefined, clientId: string, bridgeApiBaseUrl: string, serverEventHandlers: {
+export declare function fetchBridgeQuoteStream(fetchFn: FetchFunction, request: GenericQuoteRequest, signal: AbortSignal | undefined, clientId: string, jwt: string | undefined, bridgeApiBaseUrl: string, serverEventHandlers: {
     onClose: () => void | Promise<void>;
     onValidationFailure: (validationFailures: string[]) => void;
     onValidQuoteReceived: (quotes: QuoteResponse) => Promise<void>;
diff --git a/dist/utils/fetch.d.mts.map b/dist/utils/fetch.d.mts.map
index 27c5e70d3cbf0137de3a228e3056e6e241be958c..ef72153c49314f6dd25674425a774f168ea5db97 100644
--- a/dist/utils/fetch.d.mts.map
+++ b/dist/utils/fetch.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"fetch.d.mts","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG,EAAE,wBAAwB;AASvE,OAAO,KAAK,EAAE,SAAS,EAAE,yBAAqB;AAE9C,OAAO,KAAK,EACV,aAAa,EACb,aAAa,EACb,mBAAmB,EAEnB,WAAW,EACZ,qBAAiB;AAElB,eAAO,MAAM,gBAAgB,aAAc,MAAM,kBAAkB,MAAM;;;CAGvE,CAAC;AAEH;;;;;;;;;GASG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,GAAG,GAAG,WAAW,EAC1B,QAAQ,EAAE,MAAM,EAChB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,CAkBtC;AA4CD;;;;;;;;;;;GAWG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,IAAI,EAC1B,QAAQ,EAAE,MAAM,EAChB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,SAAS,EAAE,SAAS,GAAG,IAAI,EAC3B,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC;IACT,MAAM,EAAE,aAAa,EAAE,CAAC;IACxB,kBAAkB,EAAE,MAAM,EAAE,CAAC;CAC9B,CAAC,CAqDD;AAED,QAAA,MAAM,2BAA2B,YAAmB;IAClD,QAAQ,EAAE,MAAM,CAAC;IACjB,QAAQ,EAAE,IAAI,aAAa,CAAC,CAAC;IAC7B,QAAQ,EAAE,MAAM,CAAC;IACjB,aAAa,CAAC,EAAE,MAAM,CAAC;IACvB,OAAO,EAAE,aAAa,CAAC;IACvB,MAAM,CAAC,EAAE,WAAW,CAAC;CACtB;;GAoCA,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,gBAAgB,YAClB;IACP,UAAU,EAAE,IAAI,MAAM,CAAC,CAAC;CACzB,GAAG,KAAK,WAAW,kCAAkC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC;;eA+BxE,CAAC;AAEF;;;;;;;;;;;;;;;GAeG;AACH,wBAAsB,sBAAsB,CAC1C,OAAO,EAAE,aAAa,EACtB,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,SAAS,EAC/B,QAAQ,EAAE,MAAM,EAChB,gBAAgB,EAAE,MAAM,EACxB,mBAAmB,EAAE;IACnB,OAAO,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IACpC,mBAAmB,EAAE,CAAC,kBAAkB,EAAE,MAAM,EAAE,KAAK,IAAI,CAAC;IAC5D,oBAAoB,EAAE,CAAC,MAAM,EAAE,aAAa,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;CAChE,EACD,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,IAAI,CAAC,CA+Df"}
\ No newline at end of file
+{"version":3,"file":"fetch.d.mts","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"AAEA,OAAO,KAAK,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG,EAAE,wBAAwB;AASvE,OAAO,KAAK,EAAE,SAAS,EAAE,yBAAqB;AAE9C,OAAO,KAAK,EACV,aAAa,EACb,aAAa,EACb,mBAAmB,EAEnB,WAAW,EACZ,qBAAiB;AAElB,eAAO,MAAM,gBAAgB;cAKjB,MAAM;;;;;;;CAOhB,CAAC;AAEH;;;;;;;;;;;;GAYG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,GAAG,GAAG,WAAW,EAC1B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,EACvB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,CAiBtC;AA4CD;;;;;;;;;;;;GAYG;AACH,wBAAsB,iBAAiB,CACrC,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,IAAI,EAC1B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,EACvB,OAAO,EAAE,aAAa,EACtB,gBAAgB,EAAE,MAAM,EACxB,SAAS,EAAE,SAAS,GAAG,IAAI,EAC3B,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC;IACT,MAAM,EAAE,aAAa,EAAE,CAAC;IACxB,kBAAkB,EAAE,MAAM,EAAE,CAAC;CAC9B,CAAC,CAqDD;AAED,QAAA,MAAM,2BAA2B,YAAmB;IAClD,QAAQ,EAAE,MAAM,CAAC;IACjB,QAAQ,EAAE,IAAI,aAAa,CAAC,CAAC;IAC7B,QAAQ,EAAE,MAAM,CAAC;IACjB,aAAa,CAAC,EAAE,MAAM,CAAC;IACvB,OAAO,EAAE,aAAa,CAAC;IACvB,MAAM,CAAC,EAAE,WAAW,CAAC;CACtB;;GAoCA,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,gBAAgB,YAClB;IACP,UAAU,EAAE,IAAI,MAAM,CAAC,CAAC;CACzB,GAAG,KAAK,WAAW,kCAAkC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC;;eA+BxE,CAAC;AAEF;;;;;;;;;;;;;;;;GAgBG;AACH,wBAAsB,sBAAsB,CAC1C,OAAO,EAAE,aAAa,EACtB,OAAO,EAAE,mBAAmB,EAC5B,MAAM,EAAE,WAAW,GAAG,SAAS,EAC/B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,EACvB,gBAAgB,EAAE,MAAM,EACxB,mBAAmB,EAAE;IACnB,OAAO,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IACpC,mBAAmB,EAAE,CAAC,kBAAkB,EAAE,MAAM,EAAE,KAAK,IAAI,CAAC;IAC5D,oBAAoB,EAAE,CAAC,MAAM,EAAE,aAAa,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;CAChE,EACD,aAAa,CAAC,EAAE,MAAM,GACrB,OAAO,CAAC,IAAI,CAAC,CA+Df"}
\ No newline at end of file
diff --git a/dist/utils/fetch.mjs b/dist/utils/fetch.mjs
index 48fa67c5eea15a384afa54f1b7a8b334f1b5d8b9..617d2e0b2db0c3e345a1a1f0f3bb54cda0cf75bb 100644
--- a/dist/utils/fetch.mjs
+++ b/dist/utils/fetch.mjs
@@ -1,31 +1,35 @@
+/* eslint-disable @typescript-eslint/explicit-function-return-type */
 import { StructError } from "@metamask/superstruct";
 import { getEthUsdtResetData } from "./bridge.mjs";
 import { formatAddressToCaipReference, formatChainIdToDec } from "./caip-formatters.mjs";
 import { fetchServerEvents } from "./fetch-server-events.mjs";
 import { isEvmTxData } from "./trade-utils.mjs";
 import { validateQuoteResponse, validateSwapsTokenObject } from "./validators.mjs";
-export const getClientHeaders = (clientId, clientVersion) => ({
+export const getClientHeaders = ({ clientId, clientVersion, jwt, }) => ({
     'X-Client-Id': clientId,
+    ...(jwt ? { Authorization: `Bearer ${jwt}` } : {}),
     ...(clientVersion ? { 'Client-Version': clientVersion } : {}),
 });
 /**
  * Returns a list of enabled (unblocked) tokens
  *
+ * @deprecated Use the popular and search bridge-api endpoints instead
+ *
  * @param chainId - The chain ID to fetch tokens for
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of enabled (unblocked) tokens
  */
-export async function fetchBridgeTokens(chainId, clientId, fetchFn, bridgeApiBaseUrl, clientVersion) {
-    // TODO make token api v2 call
+export async function fetchBridgeTokens(chainId, clientId, jwt, fetchFn, bridgeApiBaseUrl, clientVersion) {
     const url = `${bridgeApiBaseUrl}/getTokens?chainId=${formatChainIdToDec(chainId)}`;
     // TODO we will need to cache these. In Extension fetchWithCache is used. This is due to the following:
     // If we allow selecting dest networks which the user has not imported,
     // note that the Assets controller won't be able to provide tokens. In extension we fetch+cache the token list from bridge-api to handle this
     const tokens = await fetchFn(url, {
-        headers: getClientHeaders(clientId, clientVersion),
+        headers: getClientHeaders({ clientId, clientVersion, jwt }),
     });
     const transformedTokens = {};
     tokens.forEach((token) => {
@@ -81,17 +85,18 @@ const formatQueryParams = (request) => {
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param fetchFn - The fetch function to use
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param featureId - The feature ID to append to each quote
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quotes
  */
-export async function fetchBridgeQuotes(request, signal, clientId, fetchFn, bridgeApiBaseUrl, featureId, clientVersion) {
+export async function fetchBridgeQuotes(request, signal, clientId, jwt, fetchFn, bridgeApiBaseUrl, featureId, clientVersion) {
     const queryParams = formatQueryParams(request);
     const url = `${bridgeApiBaseUrl}/getQuote?${queryParams}`;
     const quotes = await fetchFn(url, {
-        headers: getClientHeaders(clientId, clientVersion),
+        headers: getClientHeaders({ clientId, clientVersion, jwt }),
         signal,
     });
     const uniqueValidationFailures = new Set([]);
@@ -103,10 +108,10 @@ export async function fetchBridgeQuotes(request, signal, clientId, fetchFn, brid
         catch (error) {
             if (error instanceof StructError) {
                 error.failures().forEach(({ branch, path }) => {
-                    const aggregatorId = branch?.[0]?.quote?.bridgeId ||
-                        branch?.[0]?.quote?.bridges?.[0] ||
-                        quoteResponse?.quote?.bridgeId ||
-                        quoteResponse?.quote?.bridges?.[0] ||
+                    const aggregatorId = branch?.[0]?.quote?.bridgeId ??
+                        branch?.[0]?.quote?.bridges?.[0] ??
+                        quoteResponse?.quote?.bridgeId ??
+                        quoteResponse?.quote?.bridges?.[0] ??
                         'unknown';
                     const pathString = path?.join('.') || 'unknown';
                     uniqueValidationFailures.add([aggregatorId, pathString].join('|'));
@@ -148,7 +153,7 @@ const fetchAssetPricesForCurrency = async (request) => {
     });
     const url = `https://price.api.cx.metamask.io/v3/spot-prices?${queryParams}`;
     const priceApiResponse = (await fetchFn(url, {
-        headers: getClientHeaders(clientId, clientVersion),
+        headers: getClientHeaders({ clientId, clientVersion }),
         signal,
     }));
     if (!priceApiResponse || typeof priceApiResponse !== 'object') {
@@ -202,6 +207,7 @@ export const fetchAssetPrices = async (request) => {
  * @param request - The quote request
  * @param signal - The abort signal
  * @param clientId - The client ID for metrics
+ * @param jwt - The JWT token for authentication
  * @param bridgeApiBaseUrl - The base URL for the bridge API
  * @param serverEventHandlers - The server event handlers
  * @param serverEventHandlers.onValidationFailure - The function to handle validation failures
@@ -210,7 +216,7 @@ export const fetchAssetPrices = async (request) => {
  * @param clientVersion - The client version for metrics (optional)
  * @returns A list of bridge tx quote promises
  */
-export async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId, bridgeApiBaseUrl, serverEventHandlers, clientVersion) {
+export async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId, jwt, bridgeApiBaseUrl, serverEventHandlers, clientVersion) {
     const queryParams = formatQueryParams(request);
     const onMessage = async (quoteResponse) => {
         const uniqueValidationFailures = new Set([]);
@@ -233,11 +239,11 @@ export async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId,
         catch (error) {
             if (error instanceof StructError) {
                 error.failures().forEach(({ branch, path }) => {
-                    const aggregatorId = branch?.[0]?.quote?.bridgeId ||
-                        branch?.[0]?.quote?.bridges?.[0] ||
-                        quoteResponse?.quote?.bridgeId ||
-                        quoteResponse?.quote?.bridges?.[0] ||
-                        'unknown';
+                    const aggregatorId = branch?.[0]?.quote?.bridgeId ??
+                        branch?.[0]?.quote?.bridges?.[0] ??
+                        quoteResponse?.quote?.bridgeId ??
+                        (quoteResponse?.quote?.bridges?.[0] ||
+                            'unknown');
                     const pathString = path?.join('.') || 'unknown';
                     uniqueValidationFailures.add([aggregatorId, pathString].join('|'));
                 });
@@ -255,14 +261,14 @@ export async function fetchBridgeQuoteStream(fetchFn, request, signal, clientId,
     const urlStream = `${bridgeApiBaseUrl}/getQuoteStream?${queryParams}`;
     await fetchServerEvents(urlStream, {
         headers: {
-            ...getClientHeaders(clientId, clientVersion),
+            ...getClientHeaders({ clientId, clientVersion, jwt }),
             'Content-Type': 'text/event-stream',
         },
         signal,
         onMessage,
-        onError: (e) => {
+        onError: (error) => {
             // Rethrow error to prevent silent fetch failures
-            throw e;
+            throw error;
         },
         onClose: async () => {
             await serverEventHandlers.onClose();
diff --git a/dist/utils/fetch.mjs.map b/dist/utils/fetch.mjs.map
index 47e61ae7dd1dcb801766c1c915a5d6a4053bf07b..f39e190f2eb2ee1510c74d9c19734d585036cd35 100644
--- a/dist/utils/fetch.mjs.map
+++ b/dist/utils/fetch.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"fetch.mjs","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"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","sourcesContent":["import { StructError } from '@metamask/superstruct';\nimport type { CaipAssetType, CaipChainId, Hex } from '@metamask/utils';\n\nimport { getEthUsdtResetData } from './bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToDec,\n} from './caip-formatters';\nimport { fetchServerEvents } from './fetch-server-events';\nimport { isEvmTxData } from './trade-utils';\nimport type { FeatureId } from './validators';\nimport { validateQuoteResponse, validateSwapsTokenObject } from './validators';\nimport type {\n  QuoteResponse,\n  FetchFunction,\n  GenericQuoteRequest,\n  QuoteRequest,\n  BridgeAsset,\n} from '../types';\n\nexport const getClientHeaders = (clientId: string, clientVersion?: string) => ({\n  'X-Client-Id': clientId,\n  ...(clientVersion ? { 'Client-Version': clientVersion } : {}),\n});\n\n/**\n * Returns a list of enabled (unblocked) tokens\n *\n * @param chainId - The chain ID to fetch tokens for\n * @param clientId - The client ID for metrics\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of enabled (unblocked) tokens\n */\nexport async function fetchBridgeTokens(\n  chainId: Hex | CaipChainId,\n  clientId: string,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  clientVersion?: string,\n): Promise<Record<string, BridgeAsset>> {\n  // TODO make token api v2 call\n  const url = `${bridgeApiBaseUrl}/getTokens?chainId=${formatChainIdToDec(chainId)}`;\n\n  // TODO we will need to cache these. In Extension fetchWithCache is used. This is due to the following:\n  // If we allow selecting dest networks which the user has not imported,\n  // note that the Assets controller won't be able to provide tokens. In extension we fetch+cache the token list from bridge-api to handle this\n  const tokens = await fetchFn(url, {\n    headers: getClientHeaders(clientId, clientVersion),\n  });\n\n  const transformedTokens: Record<string, BridgeAsset> = {};\n  tokens.forEach((token: unknown) => {\n    if (validateSwapsTokenObject(token)) {\n      transformedTokens[token.address] = token;\n    }\n  });\n  return transformedTokens;\n}\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n *\n * @param request - The quote request\n * @returns A URLSearchParams object with the query parameters\n */\nconst formatQueryParams = (request: GenericQuoteRequest): URLSearchParams => {\n  const destWalletAddress = request.destWalletAddress ?? request.walletAddress;\n  // Transform the generic quote request into QuoteRequest\n  const normalizedRequest: QuoteRequest = {\n    walletAddress: formatAddressToCaipReference(request.walletAddress),\n    destWalletAddress: formatAddressToCaipReference(destWalletAddress),\n    srcChainId: formatChainIdToDec(request.srcChainId),\n    destChainId: formatChainIdToDec(request.destChainId),\n    srcTokenAddress: formatAddressToCaipReference(request.srcTokenAddress),\n    destTokenAddress: formatAddressToCaipReference(request.destTokenAddress),\n    srcTokenAmount: request.srcTokenAmount,\n    insufficientBal: Boolean(request.insufficientBal),\n    resetApproval: Boolean(request.resetApproval),\n    gasIncluded: Boolean(request.gasIncluded),\n    gasIncluded7702: Boolean(request.gasIncluded7702),\n  };\n  if (request.slippage !== undefined) {\n    normalizedRequest.slippage = request.slippage;\n  }\n  if (request.fee !== undefined) {\n    normalizedRequest.fee = request.fee;\n  }\n  if (request.aggIds && request.aggIds.length > 0) {\n    normalizedRequest.aggIds = request.aggIds;\n  }\n  if (request.bridgeIds && request.bridgeIds.length > 0) {\n    normalizedRequest.bridgeIds = request.bridgeIds;\n  }\n\n  const queryParams = new URLSearchParams();\n  Object.entries(normalizedRequest).forEach(([key, value]) => {\n    queryParams.append(key, value.toString());\n  });\n  return queryParams;\n};\n\n/**\n * Fetches quotes from the bridge-api's getQuote endpoint\n *\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param featureId - The feature ID to append to each quote\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quotes\n */\nexport async function fetchBridgeQuotes(\n  request: GenericQuoteRequest,\n  signal: AbortSignal | null,\n  clientId: string,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  featureId: FeatureId | null,\n  clientVersion?: string,\n): Promise<{\n  quotes: QuoteResponse[];\n  validationFailures: string[];\n}> {\n  const queryParams = formatQueryParams(request);\n\n  const url = `${bridgeApiBaseUrl}/getQuote?${queryParams}`;\n  const quotes: unknown[] = await fetchFn(url, {\n    headers: getClientHeaders(clientId, clientVersion),\n    signal,\n  });\n\n  const uniqueValidationFailures: Set<string> = new Set<string>([]);\n  const filteredQuotes = quotes\n    .filter((quoteResponse: unknown): quoteResponse is QuoteResponse => {\n      try {\n        return validateQuoteResponse(quoteResponse);\n      } catch (error) {\n        if (error instanceof StructError) {\n          error.failures().forEach(({ branch, path }) => {\n            const aggregatorId =\n              branch?.[0]?.quote?.bridgeId ||\n              branch?.[0]?.quote?.bridges?.[0] ||\n              (quoteResponse as QuoteResponse)?.quote?.bridgeId ||\n              (quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ||\n              'unknown';\n            const pathString = path?.join('.') || 'unknown';\n            uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n          });\n        }\n        return false;\n      }\n    })\n    .map((quote) => ({\n      ...quote,\n      featureId: featureId ?? undefined,\n      // Append the reset approval data to the quote response if the request\n      // has resetApproval set to true and the quote has an approval\n      resetApproval:\n        request.resetApproval && quote.approval && isEvmTxData(quote.approval)\n          ? {\n              ...quote.approval,\n              data: getEthUsdtResetData(request.destChainId),\n            }\n          : undefined,\n    }));\n\n  const validationFailures = Array.from(uniqueValidationFailures);\n  if (uniqueValidationFailures.size > 0) {\n    console.warn('Quote validation failed', validationFailures);\n  }\n\n  return {\n    quotes: filteredQuotes,\n    validationFailures,\n  };\n}\n\nconst fetchAssetPricesForCurrency = async (request: {\n  currency: string;\n  assetIds: Set<CaipAssetType>;\n  clientId: string;\n  clientVersion?: string;\n  fetchFn: FetchFunction;\n  signal?: AbortSignal;\n}): Promise<Record<CaipAssetType, { [currency: string]: string }>> => {\n  const { currency, assetIds, clientId, clientVersion, fetchFn, signal } =\n    request;\n  const validAssetIds = Array.from(assetIds).filter(Boolean);\n  if (validAssetIds.length === 0) {\n    return {};\n  }\n\n  const queryParams = new URLSearchParams({\n    assetIds: validAssetIds.filter(Boolean).join(','),\n    vsCurrency: currency,\n  });\n  const url = `https://price.api.cx.metamask.io/v3/spot-prices?${queryParams}`;\n  const priceApiResponse = (await fetchFn(url, {\n    headers: getClientHeaders(clientId, clientVersion),\n    signal,\n  })) as Record<CaipAssetType, { [currency: string]: number }>;\n  if (!priceApiResponse || typeof priceApiResponse !== 'object') {\n    return {};\n  }\n\n  return Object.entries(priceApiResponse).reduce<\n    Record<CaipAssetType, { [currency: string]: string }>\n  >((acc, [assetId, currencyToPrice]) => {\n    if (!currencyToPrice) {\n      return acc;\n    }\n    if (!acc[assetId as CaipAssetType]) {\n      acc[assetId as CaipAssetType] = {};\n    }\n    if (currencyToPrice[currency]) {\n      acc[assetId as CaipAssetType][currency] =\n        currencyToPrice[currency].toString();\n    }\n    return acc;\n  }, {});\n};\n\n/**\n * Fetches the asset prices from the price API for multiple currencies\n *\n * @param request - The request object\n * @returns The asset prices by assetId\n */\nexport const fetchAssetPrices = async (\n  request: {\n    currencies: Set<string>;\n  } & Omit<Parameters<typeof fetchAssetPricesForCurrency>[0], 'currency'>,\n): Promise<\n  Record<CaipAssetType, { [currency: string]: string } | undefined>\n> => {\n  const { currencies, ...args } = request;\n\n  const combinedPrices = await Promise.allSettled(\n    Array.from(currencies).map(\n      async (currency) =>\n        await fetchAssetPricesForCurrency({ ...args, currency }),\n    ),\n  ).then((priceApiResponse) => {\n    return priceApiResponse.reduce<\n      Record<CaipAssetType, { [currency: string]: string }>\n    >((acc, result) => {\n      if (result.status === 'fulfilled') {\n        Object.entries(result.value).forEach(([assetId, currencyToPrice]) => {\n          const existingPrices = acc[assetId as CaipAssetType];\n          if (!existingPrices) {\n            acc[assetId as CaipAssetType] = {};\n          }\n          Object.entries(currencyToPrice).forEach(([currency, price]) => {\n            acc[assetId as CaipAssetType][currency] = price;\n          });\n        });\n      }\n      return acc;\n    }, {});\n  });\n\n  return combinedPrices;\n};\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n * then fetches quotes from the bridge-api\n *\n * @param fetchFn - The fetch function to use\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param serverEventHandlers - The server event handlers\n * @param serverEventHandlers.onValidationFailure - The function to handle validation failures\n * @param serverEventHandlers.onValidQuoteReceived - The function to handle valid quotes\n * @param serverEventHandlers.onClose - The function to run when the stream is closed and there are no thrown errors\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quote promises\n */\nexport async function fetchBridgeQuoteStream(\n  fetchFn: FetchFunction,\n  request: GenericQuoteRequest,\n  signal: AbortSignal | undefined,\n  clientId: string,\n  bridgeApiBaseUrl: string,\n  serverEventHandlers: {\n    onClose: () => void | Promise<void>;\n    onValidationFailure: (validationFailures: string[]) => void;\n    onValidQuoteReceived: (quotes: QuoteResponse) => Promise<void>;\n  },\n  clientVersion?: string,\n): Promise<void> {\n  const queryParams = formatQueryParams(request);\n\n  const onMessage = async (quoteResponse: unknown): Promise<void> => {\n    const uniqueValidationFailures: Set<string> = new Set<string>([]);\n\n    try {\n      if (validateQuoteResponse(quoteResponse)) {\n        return await serverEventHandlers.onValidQuoteReceived({\n          ...quoteResponse,\n          // Append the reset approval data to the quote response if the request has resetApproval set to true and the quote has an approval\n          resetApproval:\n            request.resetApproval &&\n            quoteResponse.approval &&\n            isEvmTxData(quoteResponse.approval)\n              ? {\n                  ...quoteResponse.approval,\n                  data: getEthUsdtResetData(request.destChainId),\n                }\n              : undefined,\n        });\n      }\n    } catch (error) {\n      if (error instanceof StructError) {\n        error.failures().forEach(({ branch, path }) => {\n          const aggregatorId =\n            branch?.[0]?.quote?.bridgeId ||\n            branch?.[0]?.quote?.bridges?.[0] ||\n            (quoteResponse as QuoteResponse)?.quote?.bridgeId ||\n            (quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ||\n            'unknown';\n          const pathString = path?.join('.') || 'unknown';\n          uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n        });\n      }\n      const validationFailures = Array.from(uniqueValidationFailures);\n      if (uniqueValidationFailures.size > 0) {\n        console.warn('Quote validation failed', validationFailures);\n        return serverEventHandlers.onValidationFailure(validationFailures);\n      }\n      // Rethrow any unexpected errors\n      throw error;\n    }\n    return undefined;\n  };\n\n  const urlStream = `${bridgeApiBaseUrl}/getQuoteStream?${queryParams}`;\n  await fetchServerEvents(urlStream, {\n    headers: {\n      ...getClientHeaders(clientId, clientVersion),\n      'Content-Type': 'text/event-stream',\n    },\n    signal,\n    onMessage,\n    onError: (e) => {\n      // Rethrow error to prevent silent fetch failures\n      throw e;\n    },\n    onClose: async () => {\n      await serverEventHandlers.onClose();\n    },\n    fetchFn,\n  });\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"fetch.mjs","sourceRoot":"","sources":["../../src/utils/fetch.ts"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,OAAO,EAAE,WAAW,EAAE,8BAA8B;AAGpD,OAAO,EAAE,mBAAmB,EAAE,qBAAiB;AAC/C,OAAO,EACL,4BAA4B,EAC5B,kBAAkB,EACnB,8BAA0B;AAC3B,OAAO,EAAE,iBAAiB,EAAE,kCAA8B;AAC1D,OAAO,EAAE,WAAW,EAAE,0BAAsB;AAE5C,OAAO,EAAE,qBAAqB,EAAE,wBAAwB,EAAE,yBAAqB;AAS/E,MAAM,CAAC,MAAM,gBAAgB,GAAG,CAAC,EAC/B,QAAQ,EACR,aAAa,EACb,GAAG,GAKJ,EAAE,EAAE,CAAC,CAAC;IACL,aAAa,EAAE,QAAQ;IACvB,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,aAAa,EAAE,UAAU,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IAClD,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,gBAAgB,EAAE,aAAa,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;CAC9D,CAAC,CAAC;AAEH;;;;;;;;;;;;GAYG;AACH,MAAM,CAAC,KAAK,UAAU,iBAAiB,CACrC,OAA0B,EAC1B,QAAgB,EAChB,GAAuB,EACvB,OAAsB,EACtB,gBAAwB,EACxB,aAAsB;IAEtB,MAAM,GAAG,GAAG,GAAG,gBAAgB,sBAAsB,kBAAkB,CAAC,OAAO,CAAC,EAAE,CAAC;IAEnF,uGAAuG;IACvG,uEAAuE;IACvE,6IAA6I;IAC7I,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,GAAG,EAAE;QAChC,OAAO,EAAE,gBAAgB,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC;KAC5D,CAAC,CAAC;IAEH,MAAM,iBAAiB,GAAgC,EAAE,CAAC;IAC1D,MAAM,CAAC,OAAO,CAAC,CAAC,KAAc,EAAE,EAAE;QAChC,IAAI,wBAAwB,CAAC,KAAK,CAAC,EAAE,CAAC;YACpC,iBAAiB,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;QAC3C,CAAC;IACH,CAAC,CAAC,CAAC;IACH,OAAO,iBAAiB,CAAC;AAC3B,CAAC;AAED;;;;;GAKG;AACH,MAAM,iBAAiB,GAAG,CAAC,OAA4B,EAAmB,EAAE;IAC1E,MAAM,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,IAAI,OAAO,CAAC,aAAa,CAAC;IAC7E,wDAAwD;IACxD,MAAM,iBAAiB,GAAiB;QACtC,aAAa,EAAE,4BAA4B,CAAC,OAAO,CAAC,aAAa,CAAC;QAClE,iBAAiB,EAAE,4BAA4B,CAAC,iBAAiB,CAAC;QAClE,UAAU,EAAE,kBAAkB,CAAC,OAAO,CAAC,UAAU,CAAC;QAClD,WAAW,EAAE,kBAAkB,CAAC,OAAO,CAAC,WAAW,CAAC;QACpD,eAAe,EAAE,4BAA4B,CAAC,OAAO,CAAC,eAAe,CAAC;QACtE,gBAAgB,EAAE,4BAA4B,CAAC,OAAO,CAAC,gBAAgB,CAAC;QACxE,cAAc,EAAE,OAAO,CAAC,cAAc;QACtC,eAAe,EAAE,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC;QACjD,aAAa,EAAE,OAAO,CAAC,OAAO,CAAC,aAAa,CAAC;QAC7C,WAAW,EAAE,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC;QACzC,eAAe,EAAE,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC;KAClD,CAAC;IACF,IAAI,OAAO,CAAC,QAAQ,KAAK,SAAS,EAAE,CAAC;QACnC,iBAAiB,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;IAChD,CAAC;IACD,IAAI,OAAO,CAAC,GAAG,KAAK,SAAS,EAAE,CAAC;QAC9B,iBAAiB,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC;IACtC,CAAC;IACD,IAAI,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QAChD,iBAAiB,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;IAC5C,CAAC;IACD,IAAI,OAAO,CAAC,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACtD,iBAAiB,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;IAClD,CAAC;IAED,MAAM,WAAW,GAAG,IAAI,eAAe,EAAE,CAAC;IAC1C,MAAM,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE;QACzD,WAAW,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC5C,CAAC,CAAC,CAAC;IACH,OAAO,WAAW,CAAC;AACrB,CAAC,CAAC;AAEF;;;;;;;;;;;;GAYG;AACH,MAAM,CAAC,KAAK,UAAU,iBAAiB,CACrC,OAA4B,EAC5B,MAA0B,EAC1B,QAAgB,EAChB,GAAuB,EACvB,OAAsB,EACtB,gBAAwB,EACxB,SAA2B,EAC3B,aAAsB;IAKtB,MAAM,WAAW,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC;IAE/C,MAAM,GAAG,GAAG,GAAG,gBAAgB,aAAa,WAAW,EAAE,CAAC;IAC1D,MAAM,MAAM,GAAc,MAAM,OAAO,CAAC,GAAG,EAAE;QAC3C,OAAO,EAAE,gBAAgB,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC;QAC3D,MAAM;KACP,CAAC,CAAC;IAEH,MAAM,wBAAwB,GAAgB,IAAI,GAAG,CAAS,EAAE,CAAC,CAAC;IAClE,MAAM,cAAc,GAAG,MAAM;SAC1B,MAAM,CAAC,CAAC,aAAsB,EAAkC,EAAE;QACjE,IAAI,CAAC;YACH,OAAO,qBAAqB,CAAC,aAAa,CAAC,CAAC;QAC9C,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,WAAW,EAAE,CAAC;gBACjC,KAAK,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE;oBAC5C,MAAM,YAAY,GAChB,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,QAAQ;wBAC5B,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;wBAC/B,aAA+B,EAAE,KAAK,EAAE,QAAQ;wBAChD,aAA+B,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;wBACrD,SAAS,CAAC;oBACZ,MAAM,UAAU,GAAG,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,SAAS,CAAC;oBAChD,wBAAwB,CAAC,GAAG,CAAC,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;gBACrE,CAAC,CAAC,CAAC;YACL,CAAC;YACD,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC,CAAC;SACD,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QACf,GAAG,KAAK;QACR,SAAS,EAAE,SAAS,IAAI,SAAS;QACjC,sEAAsE;QACtE,8DAA8D;QAC9D,aAAa,EACX,OAAO,CAAC,aAAa,IAAI,KAAK,CAAC,QAAQ,IAAI,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC;YACpE,CAAC,CAAC;gBACE,GAAG,KAAK,CAAC,QAAQ;gBACjB,IAAI,EAAE,mBAAmB,CAAC,OAAO,CAAC,WAAW,CAAC;aAC/C;YACH,CAAC,CAAC,SAAS;KAChB,CAAC,CAAC,CAAC;IAEN,MAAM,kBAAkB,GAAG,KAAK,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;IAChE,IAAI,wBAAwB,CAAC,IAAI,GAAG,CAAC,EAAE,CAAC;QACtC,OAAO,CAAC,IAAI,CAAC,yBAAyB,EAAE,kBAAkB,CAAC,CAAC;IAC9D,CAAC;IAED,OAAO;QACL,MAAM,EAAE,cAAc;QACtB,kBAAkB;KACnB,CAAC;AACJ,CAAC;AAED,MAAM,2BAA2B,GAAG,KAAK,EAAE,OAO1C,EAAkE,EAAE;IACnE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,aAAa,EAAE,OAAO,EAAE,MAAM,EAAE,GACpE,OAAO,CAAC;IACV,MAAM,aAAa,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAC3D,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC/B,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,MAAM,WAAW,GAAG,IAAI,eAAe,CAAC;QACtC,QAAQ,EAAE,aAAa,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC;QACjD,UAAU,EAAE,QAAQ;KACrB,CAAC,CAAC;IACH,MAAM,GAAG,GAAG,mDAAmD,WAAW,EAAE,CAAC;IAC7E,MAAM,gBAAgB,GAAG,CAAC,MAAM,OAAO,CAAC,GAAG,EAAE;QAC3C,OAAO,EAAE,gBAAgB,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAE,CAAC;QACtD,MAAM;KACP,CAAC,CAA0D,CAAC;IAC7D,IAAI,CAAC,gBAAgB,IAAI,OAAO,gBAAgB,KAAK,QAAQ,EAAE,CAAC;QAC9D,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,OAAO,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,MAAM,CAE5C,CAAC,GAAG,EAAE,CAAC,OAAO,EAAE,eAAe,CAAC,EAAE,EAAE;QACpC,IAAI,CAAC,eAAe,EAAE,CAAC;YACrB,OAAO,GAAG,CAAC;QACb,CAAC;QACD,IAAI,CAAC,GAAG,CAAC,OAAwB,CAAC,EAAE,CAAC;YACnC,GAAG,CAAC,OAAwB,CAAC,GAAG,EAAE,CAAC;QACrC,CAAC;QACD,IAAI,eAAe,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC9B,GAAG,CAAC,OAAwB,CAAC,CAAC,QAAQ,CAAC;gBACrC,eAAe,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC;QACzC,CAAC;QACD,OAAO,GAAG,CAAC;IACb,CAAC,EAAE,EAAE,CAAC,CAAC;AACT,CAAC,CAAC;AAEF;;;;;GAKG;AACH,MAAM,CAAC,MAAM,gBAAgB,GAAG,KAAK,EACnC,OAEuE,EAGvE,EAAE;IACF,MAAM,EAAE,UAAU,EAAE,GAAG,IAAI,EAAE,GAAG,OAAO,CAAC;IAExC,MAAM,cAAc,GAAG,MAAM,OAAO,CAAC,UAAU,CAC7C,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CACxB,KAAK,EAAE,QAAQ,EAAE,EAAE,CACjB,MAAM,2BAA2B,CAAC,EAAE,GAAG,IAAI,EAAE,QAAQ,EAAE,CAAC,CAC3D,CACF,CAAC,IAAI,CAAC,CAAC,gBAAgB,EAAE,EAAE;QAC1B,OAAO,gBAAgB,CAAC,MAAM,CAE5B,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE;YAChB,IAAI,MAAM,CAAC,MAAM,KAAK,WAAW,EAAE,CAAC;gBAClC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,EAAE,eAAe,CAAC,EAAE,EAAE;oBAClE,MAAM,cAAc,GAAG,GAAG,CAAC,OAAwB,CAAC,CAAC;oBACrD,IAAI,CAAC,cAAc,EAAE,CAAC;wBACpB,GAAG,CAAC,OAAwB,CAAC,GAAG,EAAE,CAAC;oBACrC,CAAC;oBACD,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,EAAE;wBAC5D,GAAG,CAAC,OAAwB,CAAC,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;oBAClD,CAAC,CAAC,CAAC;gBACL,CAAC,CAAC,CAAC;YACL,CAAC;YACD,OAAO,GAAG,CAAC;QACb,CAAC,EAAE,EAAE,CAAC,CAAC;IACT,CAAC,CAAC,CAAC;IAEH,OAAO,cAAc,CAAC;AACxB,CAAC,CAAC;AAEF;;;;;;;;;;;;;;;;GAgBG;AACH,MAAM,CAAC,KAAK,UAAU,sBAAsB,CAC1C,OAAsB,EACtB,OAA4B,EAC5B,MAA+B,EAC/B,QAAgB,EAChB,GAAuB,EACvB,gBAAwB,EACxB,mBAIC,EACD,aAAsB;IAEtB,MAAM,WAAW,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC;IAE/C,MAAM,SAAS,GAAG,KAAK,EAAE,aAAsB,EAAiB,EAAE;QAChE,MAAM,wBAAwB,GAAgB,IAAI,GAAG,CAAS,EAAE,CAAC,CAAC;QAElE,IAAI,CAAC;YACH,IAAI,qBAAqB,CAAC,aAAa,CAAC,EAAE,CAAC;gBACzC,OAAO,MAAM,mBAAmB,CAAC,oBAAoB,CAAC;oBACpD,GAAG,aAAa;oBAChB,kIAAkI;oBAClI,aAAa,EACX,OAAO,CAAC,aAAa;wBACrB,aAAa,CAAC,QAAQ;wBACtB,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC;wBACjC,CAAC,CAAC;4BACE,GAAG,aAAa,CAAC,QAAQ;4BACzB,IAAI,EAAE,mBAAmB,CAAC,OAAO,CAAC,WAAW,CAAC;yBAC/C;wBACH,CAAC,CAAC,SAAS;iBAChB,CAAC,CAAC;YACL,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,WAAW,EAAE,CAAC;gBACjC,KAAK,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE;oBAC5C,MAAM,YAAY,GAChB,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,QAAQ;wBAC5B,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;wBAC/B,aAA+B,EAAE,KAAK,EAAE,QAAQ;wBACjD,CAAE,aAA+B,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;4BACnD,SAAoB,CAAC,CAAC;oBAC3B,MAAM,UAAU,GAAG,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,SAAS,CAAC;oBAChD,wBAAwB,CAAC,GAAG,CAAC,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;gBACrE,CAAC,CAAC,CAAC;YACL,CAAC;YACD,MAAM,kBAAkB,GAAG,KAAK,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAChE,IAAI,wBAAwB,CAAC,IAAI,GAAG,CAAC,EAAE,CAAC;gBACtC,OAAO,CAAC,IAAI,CAAC,yBAAyB,EAAE,kBAAkB,CAAC,CAAC;gBAC5D,OAAO,mBAAmB,CAAC,mBAAmB,CAAC,kBAAkB,CAAC,CAAC;YACrE,CAAC;YACD,gCAAgC;YAChC,MAAM,KAAK,CAAC;QACd,CAAC;QACD,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC;IAEF,MAAM,SAAS,GAAG,GAAG,gBAAgB,mBAAmB,WAAW,EAAE,CAAC;IACtE,MAAM,iBAAiB,CAAC,SAAS,EAAE;QACjC,OAAO,EAAE;YACP,GAAG,gBAAgB,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC;YACrD,cAAc,EAAE,mBAAmB;SACpC;QACD,MAAM;QACN,SAAS;QACT,OAAO,EAAE,CAAC,KAAK,EAAE,EAAE;YACjB,iDAAiD;YACjD,MAAM,KAAK,CAAC;QACd,CAAC;QACD,OAAO,EAAE,KAAK,IAAI,EAAE;YAClB,MAAM,mBAAmB,CAAC,OAAO,EAAE,CAAC;QACtC,CAAC;QACD,OAAO;KACR,CAAC,CAAC;AACL,CAAC","sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { StructError } from '@metamask/superstruct';\nimport type { CaipAssetType, CaipChainId, Hex } from '@metamask/utils';\n\nimport { getEthUsdtResetData } from './bridge';\nimport {\n  formatAddressToCaipReference,\n  formatChainIdToDec,\n} from './caip-formatters';\nimport { fetchServerEvents } from './fetch-server-events';\nimport { isEvmTxData } from './trade-utils';\nimport type { FeatureId } from './validators';\nimport { validateQuoteResponse, validateSwapsTokenObject } from './validators';\nimport type {\n  QuoteResponse,\n  FetchFunction,\n  GenericQuoteRequest,\n  QuoteRequest,\n  BridgeAsset,\n} from '../types';\n\nexport const getClientHeaders = ({\n  clientId,\n  clientVersion,\n  jwt,\n}: {\n  clientId: string;\n  clientVersion?: string;\n  jwt?: string;\n}) => ({\n  'X-Client-Id': clientId,\n  ...(jwt ? { Authorization: `Bearer ${jwt}` } : {}),\n  ...(clientVersion ? { 'Client-Version': clientVersion } : {}),\n});\n\n/**\n * Returns a list of enabled (unblocked) tokens\n *\n * @deprecated Use the popular and search bridge-api endpoints instead\n *\n * @param chainId - The chain ID to fetch tokens for\n * @param clientId - The client ID for metrics\n * @param jwt - The JWT token for authentication\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of enabled (unblocked) tokens\n */\nexport async function fetchBridgeTokens(\n  chainId: Hex | CaipChainId,\n  clientId: string,\n  jwt: string | undefined,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  clientVersion?: string,\n): Promise<Record<string, BridgeAsset>> {\n  const url = `${bridgeApiBaseUrl}/getTokens?chainId=${formatChainIdToDec(chainId)}`;\n\n  // TODO we will need to cache these. In Extension fetchWithCache is used. This is due to the following:\n  // If we allow selecting dest networks which the user has not imported,\n  // note that the Assets controller won't be able to provide tokens. In extension we fetch+cache the token list from bridge-api to handle this\n  const tokens = await fetchFn(url, {\n    headers: getClientHeaders({ clientId, clientVersion, jwt }),\n  });\n\n  const transformedTokens: Record<string, BridgeAsset> = {};\n  tokens.forEach((token: unknown) => {\n    if (validateSwapsTokenObject(token)) {\n      transformedTokens[token.address] = token;\n    }\n  });\n  return transformedTokens;\n}\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n *\n * @param request - The quote request\n * @returns A URLSearchParams object with the query parameters\n */\nconst formatQueryParams = (request: GenericQuoteRequest): URLSearchParams => {\n  const destWalletAddress = request.destWalletAddress ?? request.walletAddress;\n  // Transform the generic quote request into QuoteRequest\n  const normalizedRequest: QuoteRequest = {\n    walletAddress: formatAddressToCaipReference(request.walletAddress),\n    destWalletAddress: formatAddressToCaipReference(destWalletAddress),\n    srcChainId: formatChainIdToDec(request.srcChainId),\n    destChainId: formatChainIdToDec(request.destChainId),\n    srcTokenAddress: formatAddressToCaipReference(request.srcTokenAddress),\n    destTokenAddress: formatAddressToCaipReference(request.destTokenAddress),\n    srcTokenAmount: request.srcTokenAmount,\n    insufficientBal: Boolean(request.insufficientBal),\n    resetApproval: Boolean(request.resetApproval),\n    gasIncluded: Boolean(request.gasIncluded),\n    gasIncluded7702: Boolean(request.gasIncluded7702),\n  };\n  if (request.slippage !== undefined) {\n    normalizedRequest.slippage = request.slippage;\n  }\n  if (request.fee !== undefined) {\n    normalizedRequest.fee = request.fee;\n  }\n  if (request.aggIds && request.aggIds.length > 0) {\n    normalizedRequest.aggIds = request.aggIds;\n  }\n  if (request.bridgeIds && request.bridgeIds.length > 0) {\n    normalizedRequest.bridgeIds = request.bridgeIds;\n  }\n\n  const queryParams = new URLSearchParams();\n  Object.entries(normalizedRequest).forEach(([key, value]) => {\n    queryParams.append(key, value.toString());\n  });\n  return queryParams;\n};\n\n/**\n * Fetches quotes from the bridge-api's getQuote endpoint\n *\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param jwt - The JWT token for authentication\n * @param fetchFn - The fetch function to use\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param featureId - The feature ID to append to each quote\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quotes\n */\nexport async function fetchBridgeQuotes(\n  request: GenericQuoteRequest,\n  signal: AbortSignal | null,\n  clientId: string,\n  jwt: string | undefined,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n  featureId: FeatureId | null,\n  clientVersion?: string,\n): Promise<{\n  quotes: QuoteResponse[];\n  validationFailures: string[];\n}> {\n  const queryParams = formatQueryParams(request);\n\n  const url = `${bridgeApiBaseUrl}/getQuote?${queryParams}`;\n  const quotes: unknown[] = await fetchFn(url, {\n    headers: getClientHeaders({ clientId, clientVersion, jwt }),\n    signal,\n  });\n\n  const uniqueValidationFailures: Set<string> = new Set<string>([]);\n  const filteredQuotes = quotes\n    .filter((quoteResponse: unknown): quoteResponse is QuoteResponse => {\n      try {\n        return validateQuoteResponse(quoteResponse);\n      } catch (error) {\n        if (error instanceof StructError) {\n          error.failures().forEach(({ branch, path }) => {\n            const aggregatorId =\n              branch?.[0]?.quote?.bridgeId ??\n              branch?.[0]?.quote?.bridges?.[0] ??\n              (quoteResponse as QuoteResponse)?.quote?.bridgeId ??\n              (quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ??\n              'unknown';\n            const pathString = path?.join('.') || 'unknown';\n            uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n          });\n        }\n        return false;\n      }\n    })\n    .map((quote) => ({\n      ...quote,\n      featureId: featureId ?? undefined,\n      // Append the reset approval data to the quote response if the request\n      // has resetApproval set to true and the quote has an approval\n      resetApproval:\n        request.resetApproval && quote.approval && isEvmTxData(quote.approval)\n          ? {\n              ...quote.approval,\n              data: getEthUsdtResetData(request.destChainId),\n            }\n          : undefined,\n    }));\n\n  const validationFailures = Array.from(uniqueValidationFailures);\n  if (uniqueValidationFailures.size > 0) {\n    console.warn('Quote validation failed', validationFailures);\n  }\n\n  return {\n    quotes: filteredQuotes,\n    validationFailures,\n  };\n}\n\nconst fetchAssetPricesForCurrency = async (request: {\n  currency: string;\n  assetIds: Set<CaipAssetType>;\n  clientId: string;\n  clientVersion?: string;\n  fetchFn: FetchFunction;\n  signal?: AbortSignal;\n}): Promise<Record<CaipAssetType, { [currency: string]: string }>> => {\n  const { currency, assetIds, clientId, clientVersion, fetchFn, signal } =\n    request;\n  const validAssetIds = Array.from(assetIds).filter(Boolean);\n  if (validAssetIds.length === 0) {\n    return {};\n  }\n\n  const queryParams = new URLSearchParams({\n    assetIds: validAssetIds.filter(Boolean).join(','),\n    vsCurrency: currency,\n  });\n  const url = `https://price.api.cx.metamask.io/v3/spot-prices?${queryParams}`;\n  const priceApiResponse = (await fetchFn(url, {\n    headers: getClientHeaders({ clientId, clientVersion }),\n    signal,\n  })) as Record<CaipAssetType, { [currency: string]: number }>;\n  if (!priceApiResponse || typeof priceApiResponse !== 'object') {\n    return {};\n  }\n\n  return Object.entries(priceApiResponse).reduce<\n    Record<CaipAssetType, { [currency: string]: string }>\n  >((acc, [assetId, currencyToPrice]) => {\n    if (!currencyToPrice) {\n      return acc;\n    }\n    if (!acc[assetId as CaipAssetType]) {\n      acc[assetId as CaipAssetType] = {};\n    }\n    if (currencyToPrice[currency]) {\n      acc[assetId as CaipAssetType][currency] =\n        currencyToPrice[currency].toString();\n    }\n    return acc;\n  }, {});\n};\n\n/**\n * Fetches the asset prices from the price API for multiple currencies\n *\n * @param request - The request object\n * @returns The asset prices by assetId\n */\nexport const fetchAssetPrices = async (\n  request: {\n    currencies: Set<string>;\n  } & Omit<Parameters<typeof fetchAssetPricesForCurrency>[0], 'currency'>,\n): Promise<\n  Record<CaipAssetType, { [currency: string]: string } | undefined>\n> => {\n  const { currencies, ...args } = request;\n\n  const combinedPrices = await Promise.allSettled(\n    Array.from(currencies).map(\n      async (currency) =>\n        await fetchAssetPricesForCurrency({ ...args, currency }),\n    ),\n  ).then((priceApiResponse) => {\n    return priceApiResponse.reduce<\n      Record<CaipAssetType, { [currency: string]: string }>\n    >((acc, result) => {\n      if (result.status === 'fulfilled') {\n        Object.entries(result.value).forEach(([assetId, currencyToPrice]) => {\n          const existingPrices = acc[assetId as CaipAssetType];\n          if (!existingPrices) {\n            acc[assetId as CaipAssetType] = {};\n          }\n          Object.entries(currencyToPrice).forEach(([currency, price]) => {\n            acc[assetId as CaipAssetType][currency] = price;\n          });\n        });\n      }\n      return acc;\n    }, {});\n  });\n\n  return combinedPrices;\n};\n\n/**\n * Converts the generic quote request to the type that the bridge-api expects\n * then fetches quotes from the bridge-api\n *\n * @param fetchFn - The fetch function to use\n * @param request - The quote request\n * @param signal - The abort signal\n * @param clientId - The client ID for metrics\n * @param jwt - The JWT token for authentication\n * @param bridgeApiBaseUrl - The base URL for the bridge API\n * @param serverEventHandlers - The server event handlers\n * @param serverEventHandlers.onValidationFailure - The function to handle validation failures\n * @param serverEventHandlers.onValidQuoteReceived - The function to handle valid quotes\n * @param serverEventHandlers.onClose - The function to run when the stream is closed and there are no thrown errors\n * @param clientVersion - The client version for metrics (optional)\n * @returns A list of bridge tx quote promises\n */\nexport async function fetchBridgeQuoteStream(\n  fetchFn: FetchFunction,\n  request: GenericQuoteRequest,\n  signal: AbortSignal | undefined,\n  clientId: string,\n  jwt: string | undefined,\n  bridgeApiBaseUrl: string,\n  serverEventHandlers: {\n    onClose: () => void | Promise<void>;\n    onValidationFailure: (validationFailures: string[]) => void;\n    onValidQuoteReceived: (quotes: QuoteResponse) => Promise<void>;\n  },\n  clientVersion?: string,\n): Promise<void> {\n  const queryParams = formatQueryParams(request);\n\n  const onMessage = async (quoteResponse: unknown): Promise<void> => {\n    const uniqueValidationFailures: Set<string> = new Set<string>([]);\n\n    try {\n      if (validateQuoteResponse(quoteResponse)) {\n        return await serverEventHandlers.onValidQuoteReceived({\n          ...quoteResponse,\n          // Append the reset approval data to the quote response if the request has resetApproval set to true and the quote has an approval\n          resetApproval:\n            request.resetApproval &&\n            quoteResponse.approval &&\n            isEvmTxData(quoteResponse.approval)\n              ? {\n                  ...quoteResponse.approval,\n                  data: getEthUsdtResetData(request.destChainId),\n                }\n              : undefined,\n        });\n      }\n    } catch (error) {\n      if (error instanceof StructError) {\n        error.failures().forEach(({ branch, path }) => {\n          const aggregatorId =\n            branch?.[0]?.quote?.bridgeId ??\n            branch?.[0]?.quote?.bridges?.[0] ??\n            (quoteResponse as QuoteResponse)?.quote?.bridgeId ??\n            ((quoteResponse as QuoteResponse)?.quote?.bridges?.[0] ||\n              ('unknown' as string));\n          const pathString = path?.join('.') || 'unknown';\n          uniqueValidationFailures.add([aggregatorId, pathString].join('|'));\n        });\n      }\n      const validationFailures = Array.from(uniqueValidationFailures);\n      if (uniqueValidationFailures.size > 0) {\n        console.warn('Quote validation failed', validationFailures);\n        return serverEventHandlers.onValidationFailure(validationFailures);\n      }\n      // Rethrow any unexpected errors\n      throw error;\n    }\n    return undefined;\n  };\n\n  const urlStream = `${bridgeApiBaseUrl}/getQuoteStream?${queryParams}`;\n  await fetchServerEvents(urlStream, {\n    headers: {\n      ...getClientHeaders({ clientId, clientVersion, jwt }),\n      'Content-Type': 'text/event-stream',\n    },\n    signal,\n    onMessage,\n    onError: (error) => {\n      // Rethrow error to prevent silent fetch failures\n      throw error;\n    },\n    onClose: async () => {\n      await serverEventHandlers.onClose();\n    },\n    fetchFn,\n  });\n}\n"]}
\ No newline at end of file
diff --git a/dist/utils/metrics/constants.cjs b/dist/utils/metrics/constants.cjs
index 441e1f4b1ced7da98f10d8ba9e702228ce24c1ce..c9a0b32b5e8a440deb0ea29ce57cacc1ae96c4a0 100644
--- a/dist/utils/metrics/constants.cjs
+++ b/dist/utils/metrics/constants.cjs
@@ -1,6 +1,6 @@
 "use strict";
 Object.defineProperty(exports, "__esModule", { value: true });
-exports.MetricsSwapType = exports.MetricsActionType = exports.MetaMetricsSwapsEventSource = exports.AbortReason = exports.PollingStatus = exports.UnifiedSwapBridgeEventName = exports.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = void 0;
+exports.MetricsSwapType = exports.MetricsActionType = exports.InputAmountPreset = exports.MetaMetricsSwapsEventSource = exports.AbortReason = exports.PollingStatus = exports.UnifiedSwapBridgeEventName = exports.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = void 0;
 /* eslint-disable @typescript-eslint/naming-convention */
 exports.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = 'Unified SwapBridge';
 /**
@@ -50,6 +50,14 @@ var MetaMetricsSwapsEventSource;
     MetaMetricsSwapsEventSource["TrendingExplore"] = "Trending Explore";
     MetaMetricsSwapsEventSource["Rewards"] = "Rewards";
 })(MetaMetricsSwapsEventSource || (exports.MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource = {}));
+var InputAmountPreset;
+(function (InputAmountPreset) {
+    InputAmountPreset["PERCENT_25"] = "25%";
+    InputAmountPreset["PERCENT_50"] = "50%";
+    InputAmountPreset["PERCENT_75"] = "75%";
+    // "Max" may not equal 100% of balance (e.g. gas reserves are withheld)
+    InputAmountPreset["MAX"] = "MAX";
+})(InputAmountPreset || (exports.InputAmountPreset = InputAmountPreset = {}));
 var MetricsActionType;
 (function (MetricsActionType) {
     /**
diff --git a/dist/utils/metrics/constants.cjs.map b/dist/utils/metrics/constants.cjs.map
index 87fcd428df72702fedde16eb1483671f1d1b494d..7eeef6adf55a0a4ca2bb29a0ee7ef4ad0263e712 100644
--- a/dist/utils/metrics/constants.cjs.map
+++ b/dist/utils/metrics/constants.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"constants.cjs","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":";;;AAAA,yDAAyD;AAC5C,QAAA,kCAAkC,GAAG,oBAAoB,CAAC;AAEvE;;GAEG;AACH,IAAY,0BAkBX;AAlBD,WAAY,0BAA0B;IACpC,iFAAsE,CAAA;IACtE,2EAAgE,CAAA;IAChE,+EAAoE,CAAA;IACpE,+GAAoG,CAAA;IACpG,qFAA0E,CAAA;IAC1E,mFAAwE,CAAA;IACxE,6EAAkE,CAAA;IAClE,wEAA6D,CAAA;IAC7D,wEAA6D,CAAA;IAC7D,kEAAuD,CAAA;IACvD,sFAA2E,CAAA;IAC3E,sFAA2E,CAAA;IAC3E,iFAAsE,CAAA;IACtE,2GAAgG,CAAA;IAChG,oGAAyF,CAAA;IACzF,oGAAyF,CAAA;IACzF,gGAAqF,CAAA;AACvF,CAAC,EAlBW,0BAA0B,0CAA1B,0BAA0B,QAkBrC;AAED,IAAY,aAGX;AAHD,WAAY,aAAa;IACvB,0DAAyC,CAAA;IACzC,yDAAwC,CAAA;AAC1C,CAAC,EAHW,aAAa,6BAAb,aAAa,QAGxB;AAED,IAAY,WAKX;AALD,WAAY,WAAW;IACrB,oDAAqC,CAAA;IACrC,4DAA6C,CAAA;IAC7C,oDAAqC,CAAA;IACrC,6DAA8C,CAAA;AAChD,CAAC,EALW,WAAW,2BAAX,WAAW,QAKtB;AAED;;;;GAIG;AACH,IAAY,2BAKX;AALD,WAAY,2BAA2B;IACrC,qDAAsB,CAAA;IACtB,uDAAwB,CAAA;IACxB,mEAAoC,CAAA;IACpC,kDAAmB,CAAA;AACrB,CAAC,EALW,2BAA2B,2CAA3B,2BAA2B,QAKtC;AAED,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC3B;;OAEG;IACH,oDAA+B,CAAA;IAC/B,oDAA+B,CAAA;AACjC,CAAC,EANW,iBAAiB,iCAAjB,iBAAiB,QAM5B;AAED,IAAY,eAGX;AAHD,WAAY,eAAe;IACzB,0CAAuB,CAAA;IACvB,4CAAyB,CAAA;AAC3B,CAAC,EAHW,eAAe,+BAAf,eAAe,QAG1B","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nexport const UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = 'Unified SwapBridge';\n\n/**\n * These event names map to events defined in the segment-schema: https://github.com/Consensys/segment-schema/tree/main/libraries/events/metamask-cross-chain-swaps\n */\nexport enum UnifiedSwapBridgeEventName {\n  ButtonClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Button Clicked`,\n  PageViewed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Page Viewed`,\n  InputChanged = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Input Changed`,\n  InputSourceDestinationSwitched = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Source Destination Switched`,\n  QuotesRequested = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Requested`,\n  QuotesReceived = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Received`,\n  QuotesError = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Error`,\n  Submitted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Submitted`,\n  Completed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Completed`,\n  Failed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Failed`,\n  AllQuotesOpened = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Opened`,\n  AllQuotesSorted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Sorted`,\n  QuoteSelected = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quote Selected`,\n  AssetDetailTooltipClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Asset Detail Tooltip Clicked`,\n  QuotesValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Failed Validation`,\n  StatusValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Status Failed Validation`,\n  PollingStatusUpdated = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Polling Status Updated`,\n}\n\nexport enum PollingStatus {\n  MaxPollingReached = 'max_polling_reached',\n  ManuallyRestarted = 'manually_restarted',\n}\n\nexport enum AbortReason {\n  NewQuoteRequest = 'New Quote Request',\n  QuoteRequestUpdated = 'Quote Request Updated',\n  ResetState = 'Reset controller state',\n  TransactionSubmitted = 'Transaction submitted',\n}\n\n/**\n * Identifies the entry point from which the user initiated a swap or bridge flow.\n * Included as the `location` property on every Unified SwapBridge event so\n * analytics can trace the user's origin regardless of where they are in the flow.\n */\nexport enum MetaMetricsSwapsEventSource {\n  MainView = 'Main View',\n  TokenView = 'Token View',\n  TrendingExplore = 'Trending Explore',\n  Rewards = 'Rewards',\n}\n\nexport enum MetricsActionType {\n  /**\n   * @deprecated new events should use SWAPBRIDGE_V1 instead\n   */\n  CROSSCHAIN_V1 = 'crosschain-v1',\n  SWAPBRIDGE_V1 = 'swapbridge-v1',\n}\n\nexport enum MetricsSwapType {\n  SINGLE = 'single_chain',\n  CROSSCHAIN = 'crosschain',\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"constants.cjs","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":";;;AAAA,yDAAyD;AAC5C,QAAA,kCAAkC,GAAG,oBAAoB,CAAC;AAEvE;;GAEG;AACH,IAAY,0BAkBX;AAlBD,WAAY,0BAA0B;IACpC,iFAAsE,CAAA;IACtE,2EAAgE,CAAA;IAChE,+EAAoE,CAAA;IACpE,+GAAoG,CAAA;IACpG,qFAA0E,CAAA;IAC1E,mFAAwE,CAAA;IACxE,6EAAkE,CAAA;IAClE,wEAA6D,CAAA;IAC7D,wEAA6D,CAAA;IAC7D,kEAAuD,CAAA;IACvD,sFAA2E,CAAA;IAC3E,sFAA2E,CAAA;IAC3E,iFAAsE,CAAA;IACtE,2GAAgG,CAAA;IAChG,oGAAyF,CAAA;IACzF,oGAAyF,CAAA;IACzF,gGAAqF,CAAA;AACvF,CAAC,EAlBW,0BAA0B,0CAA1B,0BAA0B,QAkBrC;AAED,IAAY,aAGX;AAHD,WAAY,aAAa;IACvB,0DAAyC,CAAA;IACzC,yDAAwC,CAAA;AAC1C,CAAC,EAHW,aAAa,6BAAb,aAAa,QAGxB;AAED,IAAY,WAKX;AALD,WAAY,WAAW;IACrB,oDAAqC,CAAA;IACrC,4DAA6C,CAAA;IAC7C,oDAAqC,CAAA;IACrC,6DAA8C,CAAA;AAChD,CAAC,EALW,WAAW,2BAAX,WAAW,QAKtB;AAED;;;;GAIG;AACH,IAAY,2BAKX;AALD,WAAY,2BAA2B;IACrC,qDAAsB,CAAA;IACtB,uDAAwB,CAAA;IACxB,mEAAoC,CAAA;IACpC,kDAAmB,CAAA;AACrB,CAAC,EALW,2BAA2B,2CAA3B,2BAA2B,QAKtC;AAED,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC3B,uCAAkB,CAAA;IAClB,uCAAkB,CAAA;IAClB,uCAAkB,CAAA;IAClB,uEAAuE;IACvE,gCAAW,CAAA;AACb,CAAC,EANW,iBAAiB,iCAAjB,iBAAiB,QAM5B;AAED,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC3B;;OAEG;IACH,oDAA+B,CAAA;IAC/B,oDAA+B,CAAA;AACjC,CAAC,EANW,iBAAiB,iCAAjB,iBAAiB,QAM5B;AAED,IAAY,eAGX;AAHD,WAAY,eAAe;IACzB,0CAAuB,CAAA;IACvB,4CAAyB,CAAA;AAC3B,CAAC,EAHW,eAAe,+BAAf,eAAe,QAG1B","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nexport const UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = 'Unified SwapBridge';\n\n/**\n * These event names map to events defined in the segment-schema: https://github.com/Consensys/segment-schema/tree/main/libraries/events/metamask-cross-chain-swaps\n */\nexport enum UnifiedSwapBridgeEventName {\n  ButtonClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Button Clicked`,\n  PageViewed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Page Viewed`,\n  InputChanged = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Input Changed`,\n  InputSourceDestinationSwitched = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Source Destination Switched`,\n  QuotesRequested = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Requested`,\n  QuotesReceived = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Received`,\n  QuotesError = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Error`,\n  Submitted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Submitted`,\n  Completed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Completed`,\n  Failed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Failed`,\n  AllQuotesOpened = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Opened`,\n  AllQuotesSorted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Sorted`,\n  QuoteSelected = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quote Selected`,\n  AssetDetailTooltipClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Asset Detail Tooltip Clicked`,\n  QuotesValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Failed Validation`,\n  StatusValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Status Failed Validation`,\n  PollingStatusUpdated = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Polling Status Updated`,\n}\n\nexport enum PollingStatus {\n  MaxPollingReached = 'max_polling_reached',\n  ManuallyRestarted = 'manually_restarted',\n}\n\nexport enum AbortReason {\n  NewQuoteRequest = 'New Quote Request',\n  QuoteRequestUpdated = 'Quote Request Updated',\n  ResetState = 'Reset controller state',\n  TransactionSubmitted = 'Transaction submitted',\n}\n\n/**\n * Identifies the entry point from which the user initiated a swap or bridge flow.\n * Included as the `location` property on every Unified SwapBridge event so\n * analytics can trace the user's origin regardless of where they are in the flow.\n */\nexport enum MetaMetricsSwapsEventSource {\n  MainView = 'Main View',\n  TokenView = 'Token View',\n  TrendingExplore = 'Trending Explore',\n  Rewards = 'Rewards',\n}\n\nexport enum InputAmountPreset {\n  PERCENT_25 = '25%',\n  PERCENT_50 = '50%',\n  PERCENT_75 = '75%',\n  // \"Max\" may not equal 100% of balance (e.g. gas reserves are withheld)\n  MAX = 'MAX',\n}\n\nexport enum MetricsActionType {\n  /**\n   * @deprecated new events should use SWAPBRIDGE_V1 instead\n   */\n  CROSSCHAIN_V1 = 'crosschain-v1',\n  SWAPBRIDGE_V1 = 'swapbridge-v1',\n}\n\nexport enum MetricsSwapType {\n  SINGLE = 'single_chain',\n  CROSSCHAIN = 'crosschain',\n}\n"]}
\ No newline at end of file
diff --git a/dist/utils/metrics/constants.d.cts b/dist/utils/metrics/constants.d.cts
index 4f0f42dadfaeed5cd2dd31713231cd1ba00ebe31..d86b14e1e77bf8d5369d0a198fb50722c8b2988d 100644
--- a/dist/utils/metrics/constants.d.cts
+++ b/dist/utils/metrics/constants.d.cts
@@ -42,6 +42,12 @@ export declare enum MetaMetricsSwapsEventSource {
     TrendingExplore = "Trending Explore",
     Rewards = "Rewards"
 }
+export declare enum InputAmountPreset {
+    PERCENT_25 = "25%",
+    PERCENT_50 = "50%",
+    PERCENT_75 = "75%",
+    MAX = "MAX"
+}
 export declare enum MetricsActionType {
     /**
      * @deprecated new events should use SWAPBRIDGE_V1 instead
diff --git a/dist/utils/metrics/constants.d.cts.map b/dist/utils/metrics/constants.d.cts.map
index 51d0893139492af9358328842e3e78ada849c49a..2d2a561a48405ba4535b1cc012dda1ce01813931 100644
--- a/dist/utils/metrics/constants.d.cts.map
+++ b/dist/utils/metrics/constants.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"constants.d.cts","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":"AACA,eAAO,MAAM,kCAAkC,uBAAuB,CAAC;AAEvE;;GAEG;AACH,oBAAY,0BAA0B;IACpC,aAAa,sCAAyD;IACtE,UAAU,mCAAsD;IAChE,YAAY,qCAAwD;IACpE,8BAA8B,mDAAsE;IACpG,eAAe,wCAA2D;IAC1E,cAAc,uCAA0D;IACxE,WAAW,oCAAuD;IAClE,SAAS,iCAAoD;IAC7D,SAAS,iCAAoD;IAC7D,MAAM,8BAAiD;IACvD,eAAe,yCAA4D;IAC3E,eAAe,yCAA4D;IAC3E,aAAa,sCAAyD;IACtE,yBAAyB,oDAAuE;IAChG,sBAAsB,gDAAmE;IACzF,sBAAsB,gDAAmE;IACzF,oBAAoB,8CAAiE;CACtF;AAED,oBAAY,aAAa;IACvB,iBAAiB,wBAAwB;IACzC,iBAAiB,uBAAuB;CACzC;AAED,oBAAY,WAAW;IACrB,eAAe,sBAAsB;IACrC,mBAAmB,0BAA0B;IAC7C,UAAU,2BAA2B;IACrC,oBAAoB,0BAA0B;CAC/C;AAED;;;;GAIG;AACH,oBAAY,2BAA2B;IACrC,QAAQ,cAAc;IACtB,SAAS,eAAe;IACxB,eAAe,qBAAqB;IACpC,OAAO,YAAY;CACpB;AAED,oBAAY,iBAAiB;IAC3B;;OAEG;IACH,aAAa,kBAAkB;IAC/B,aAAa,kBAAkB;CAChC;AAED,oBAAY,eAAe;IACzB,MAAM,iBAAiB;IACvB,UAAU,eAAe;CAC1B"}
\ No newline at end of file
+{"version":3,"file":"constants.d.cts","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":"AACA,eAAO,MAAM,kCAAkC,uBAAuB,CAAC;AAEvE;;GAEG;AACH,oBAAY,0BAA0B;IACpC,aAAa,sCAAyD;IACtE,UAAU,mCAAsD;IAChE,YAAY,qCAAwD;IACpE,8BAA8B,mDAAsE;IACpG,eAAe,wCAA2D;IAC1E,cAAc,uCAA0D;IACxE,WAAW,oCAAuD;IAClE,SAAS,iCAAoD;IAC7D,SAAS,iCAAoD;IAC7D,MAAM,8BAAiD;IACvD,eAAe,yCAA4D;IAC3E,eAAe,yCAA4D;IAC3E,aAAa,sCAAyD;IACtE,yBAAyB,oDAAuE;IAChG,sBAAsB,gDAAmE;IACzF,sBAAsB,gDAAmE;IACzF,oBAAoB,8CAAiE;CACtF;AAED,oBAAY,aAAa;IACvB,iBAAiB,wBAAwB;IACzC,iBAAiB,uBAAuB;CACzC;AAED,oBAAY,WAAW;IACrB,eAAe,sBAAsB;IACrC,mBAAmB,0BAA0B;IAC7C,UAAU,2BAA2B;IACrC,oBAAoB,0BAA0B;CAC/C;AAED;;;;GAIG;AACH,oBAAY,2BAA2B;IACrC,QAAQ,cAAc;IACtB,SAAS,eAAe;IACxB,eAAe,qBAAqB;IACpC,OAAO,YAAY;CACpB;AAED,oBAAY,iBAAiB;IAC3B,UAAU,QAAQ;IAClB,UAAU,QAAQ;IAClB,UAAU,QAAQ;IAElB,GAAG,QAAQ;CACZ;AAED,oBAAY,iBAAiB;IAC3B;;OAEG;IACH,aAAa,kBAAkB;IAC/B,aAAa,kBAAkB;CAChC;AAED,oBAAY,eAAe;IACzB,MAAM,iBAAiB;IACvB,UAAU,eAAe;CAC1B"}
\ No newline at end of file
diff --git a/dist/utils/metrics/constants.d.mts b/dist/utils/metrics/constants.d.mts
index cb95347aa0966a576887a608bc47279d94701ad3..df78444832e1d5cfc495676995267966b55bbffb 100644
--- a/dist/utils/metrics/constants.d.mts
+++ b/dist/utils/metrics/constants.d.mts
@@ -42,6 +42,12 @@ export declare enum MetaMetricsSwapsEventSource {
     TrendingExplore = "Trending Explore",
     Rewards = "Rewards"
 }
+export declare enum InputAmountPreset {
+    PERCENT_25 = "25%",
+    PERCENT_50 = "50%",
+    PERCENT_75 = "75%",
+    MAX = "MAX"
+}
 export declare enum MetricsActionType {
     /**
      * @deprecated new events should use SWAPBRIDGE_V1 instead
diff --git a/dist/utils/metrics/constants.d.mts.map b/dist/utils/metrics/constants.d.mts.map
index b5bbd430bf3a89833d494e6ce242da7b6bbe3c2b..c36a5c0d2c6718a92a2240411734fe68e893f38e 100644
--- a/dist/utils/metrics/constants.d.mts.map
+++ b/dist/utils/metrics/constants.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"constants.d.mts","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":"AACA,eAAO,MAAM,kCAAkC,uBAAuB,CAAC;AAEvE;;GAEG;AACH,oBAAY,0BAA0B;IACpC,aAAa,sCAAyD;IACtE,UAAU,mCAAsD;IAChE,YAAY,qCAAwD;IACpE,8BAA8B,mDAAsE;IACpG,eAAe,wCAA2D;IAC1E,cAAc,uCAA0D;IACxE,WAAW,oCAAuD;IAClE,SAAS,iCAAoD;IAC7D,SAAS,iCAAoD;IAC7D,MAAM,8BAAiD;IACvD,eAAe,yCAA4D;IAC3E,eAAe,yCAA4D;IAC3E,aAAa,sCAAyD;IACtE,yBAAyB,oDAAuE;IAChG,sBAAsB,gDAAmE;IACzF,sBAAsB,gDAAmE;IACzF,oBAAoB,8CAAiE;CACtF;AAED,oBAAY,aAAa;IACvB,iBAAiB,wBAAwB;IACzC,iBAAiB,uBAAuB;CACzC;AAED,oBAAY,WAAW;IACrB,eAAe,sBAAsB;IACrC,mBAAmB,0BAA0B;IAC7C,UAAU,2BAA2B;IACrC,oBAAoB,0BAA0B;CAC/C;AAED;;;;GAIG;AACH,oBAAY,2BAA2B;IACrC,QAAQ,cAAc;IACtB,SAAS,eAAe;IACxB,eAAe,qBAAqB;IACpC,OAAO,YAAY;CACpB;AAED,oBAAY,iBAAiB;IAC3B;;OAEG;IACH,aAAa,kBAAkB;IAC/B,aAAa,kBAAkB;CAChC;AAED,oBAAY,eAAe;IACzB,MAAM,iBAAiB;IACvB,UAAU,eAAe;CAC1B"}
\ No newline at end of file
+{"version":3,"file":"constants.d.mts","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":"AACA,eAAO,MAAM,kCAAkC,uBAAuB,CAAC;AAEvE;;GAEG;AACH,oBAAY,0BAA0B;IACpC,aAAa,sCAAyD;IACtE,UAAU,mCAAsD;IAChE,YAAY,qCAAwD;IACpE,8BAA8B,mDAAsE;IACpG,eAAe,wCAA2D;IAC1E,cAAc,uCAA0D;IACxE,WAAW,oCAAuD;IAClE,SAAS,iCAAoD;IAC7D,SAAS,iCAAoD;IAC7D,MAAM,8BAAiD;IACvD,eAAe,yCAA4D;IAC3E,eAAe,yCAA4D;IAC3E,aAAa,sCAAyD;IACtE,yBAAyB,oDAAuE;IAChG,sBAAsB,gDAAmE;IACzF,sBAAsB,gDAAmE;IACzF,oBAAoB,8CAAiE;CACtF;AAED,oBAAY,aAAa;IACvB,iBAAiB,wBAAwB;IACzC,iBAAiB,uBAAuB;CACzC;AAED,oBAAY,WAAW;IACrB,eAAe,sBAAsB;IACrC,mBAAmB,0BAA0B;IAC7C,UAAU,2BAA2B;IACrC,oBAAoB,0BAA0B;CAC/C;AAED;;;;GAIG;AACH,oBAAY,2BAA2B;IACrC,QAAQ,cAAc;IACtB,SAAS,eAAe;IACxB,eAAe,qBAAqB;IACpC,OAAO,YAAY;CACpB;AAED,oBAAY,iBAAiB;IAC3B,UAAU,QAAQ;IAClB,UAAU,QAAQ;IAClB,UAAU,QAAQ;IAElB,GAAG,QAAQ;CACZ;AAED,oBAAY,iBAAiB;IAC3B;;OAEG;IACH,aAAa,kBAAkB;IAC/B,aAAa,kBAAkB;CAChC;AAED,oBAAY,eAAe;IACzB,MAAM,iBAAiB;IACvB,UAAU,eAAe;CAC1B"}
\ No newline at end of file
diff --git a/dist/utils/metrics/constants.mjs b/dist/utils/metrics/constants.mjs
index 661f170f0fa14d1333b9be5d117f445dad533e64..a0ce21c3255898f8c4e3347b16c5f101d0d45117 100644
--- a/dist/utils/metrics/constants.mjs
+++ b/dist/utils/metrics/constants.mjs
@@ -47,6 +47,14 @@ export var MetaMetricsSwapsEventSource;
     MetaMetricsSwapsEventSource["TrendingExplore"] = "Trending Explore";
     MetaMetricsSwapsEventSource["Rewards"] = "Rewards";
 })(MetaMetricsSwapsEventSource || (MetaMetricsSwapsEventSource = {}));
+export var InputAmountPreset;
+(function (InputAmountPreset) {
+    InputAmountPreset["PERCENT_25"] = "25%";
+    InputAmountPreset["PERCENT_50"] = "50%";
+    InputAmountPreset["PERCENT_75"] = "75%";
+    // "Max" may not equal 100% of balance (e.g. gas reserves are withheld)
+    InputAmountPreset["MAX"] = "MAX";
+})(InputAmountPreset || (InputAmountPreset = {}));
 export var MetricsActionType;
 (function (MetricsActionType) {
     /**
diff --git a/dist/utils/metrics/constants.mjs.map b/dist/utils/metrics/constants.mjs.map
index ef4e0da27d359a96fbc72adafc94e8179ca86b5f..1cb4b41d5570933c90260c2fc7addeb3d11a5752 100644
--- a/dist/utils/metrics/constants.mjs.map
+++ b/dist/utils/metrics/constants.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"constants.mjs","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":"AAAA,yDAAyD;AACzD,MAAM,CAAC,MAAM,kCAAkC,GAAG,oBAAoB,CAAC;AAEvE;;GAEG;AACH,MAAM,CAAN,IAAY,0BAkBX;AAlBD,WAAY,0BAA0B;IACpC,iFAAsE,CAAA;IACtE,2EAAgE,CAAA;IAChE,+EAAoE,CAAA;IACpE,+GAAoG,CAAA;IACpG,qFAA0E,CAAA;IAC1E,mFAAwE,CAAA;IACxE,6EAAkE,CAAA;IAClE,wEAA6D,CAAA;IAC7D,wEAA6D,CAAA;IAC7D,kEAAuD,CAAA;IACvD,sFAA2E,CAAA;IAC3E,sFAA2E,CAAA;IAC3E,iFAAsE,CAAA;IACtE,2GAAgG,CAAA;IAChG,oGAAyF,CAAA;IACzF,oGAAyF,CAAA;IACzF,gGAAqF,CAAA;AACvF,CAAC,EAlBW,0BAA0B,KAA1B,0BAA0B,QAkBrC;AAED,MAAM,CAAN,IAAY,aAGX;AAHD,WAAY,aAAa;IACvB,0DAAyC,CAAA;IACzC,yDAAwC,CAAA;AAC1C,CAAC,EAHW,aAAa,KAAb,aAAa,QAGxB;AAED,MAAM,CAAN,IAAY,WAKX;AALD,WAAY,WAAW;IACrB,oDAAqC,CAAA;IACrC,4DAA6C,CAAA;IAC7C,oDAAqC,CAAA;IACrC,6DAA8C,CAAA;AAChD,CAAC,EALW,WAAW,KAAX,WAAW,QAKtB;AAED;;;;GAIG;AACH,MAAM,CAAN,IAAY,2BAKX;AALD,WAAY,2BAA2B;IACrC,qDAAsB,CAAA;IACtB,uDAAwB,CAAA;IACxB,mEAAoC,CAAA;IACpC,kDAAmB,CAAA;AACrB,CAAC,EALW,2BAA2B,KAA3B,2BAA2B,QAKtC;AAED,MAAM,CAAN,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC3B;;OAEG;IACH,oDAA+B,CAAA;IAC/B,oDAA+B,CAAA;AACjC,CAAC,EANW,iBAAiB,KAAjB,iBAAiB,QAM5B;AAED,MAAM,CAAN,IAAY,eAGX;AAHD,WAAY,eAAe;IACzB,0CAAuB,CAAA;IACvB,4CAAyB,CAAA;AAC3B,CAAC,EAHW,eAAe,KAAf,eAAe,QAG1B","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nexport const UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = 'Unified SwapBridge';\n\n/**\n * These event names map to events defined in the segment-schema: https://github.com/Consensys/segment-schema/tree/main/libraries/events/metamask-cross-chain-swaps\n */\nexport enum UnifiedSwapBridgeEventName {\n  ButtonClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Button Clicked`,\n  PageViewed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Page Viewed`,\n  InputChanged = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Input Changed`,\n  InputSourceDestinationSwitched = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Source Destination Switched`,\n  QuotesRequested = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Requested`,\n  QuotesReceived = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Received`,\n  QuotesError = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Error`,\n  Submitted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Submitted`,\n  Completed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Completed`,\n  Failed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Failed`,\n  AllQuotesOpened = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Opened`,\n  AllQuotesSorted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Sorted`,\n  QuoteSelected = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quote Selected`,\n  AssetDetailTooltipClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Asset Detail Tooltip Clicked`,\n  QuotesValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Failed Validation`,\n  StatusValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Status Failed Validation`,\n  PollingStatusUpdated = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Polling Status Updated`,\n}\n\nexport enum PollingStatus {\n  MaxPollingReached = 'max_polling_reached',\n  ManuallyRestarted = 'manually_restarted',\n}\n\nexport enum AbortReason {\n  NewQuoteRequest = 'New Quote Request',\n  QuoteRequestUpdated = 'Quote Request Updated',\n  ResetState = 'Reset controller state',\n  TransactionSubmitted = 'Transaction submitted',\n}\n\n/**\n * Identifies the entry point from which the user initiated a swap or bridge flow.\n * Included as the `location` property on every Unified SwapBridge event so\n * analytics can trace the user's origin regardless of where they are in the flow.\n */\nexport enum MetaMetricsSwapsEventSource {\n  MainView = 'Main View',\n  TokenView = 'Token View',\n  TrendingExplore = 'Trending Explore',\n  Rewards = 'Rewards',\n}\n\nexport enum MetricsActionType {\n  /**\n   * @deprecated new events should use SWAPBRIDGE_V1 instead\n   */\n  CROSSCHAIN_V1 = 'crosschain-v1',\n  SWAPBRIDGE_V1 = 'swapbridge-v1',\n}\n\nexport enum MetricsSwapType {\n  SINGLE = 'single_chain',\n  CROSSCHAIN = 'crosschain',\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"constants.mjs","sourceRoot":"","sources":["../../../src/utils/metrics/constants.ts"],"names":[],"mappings":"AAAA,yDAAyD;AACzD,MAAM,CAAC,MAAM,kCAAkC,GAAG,oBAAoB,CAAC;AAEvE;;GAEG;AACH,MAAM,CAAN,IAAY,0BAkBX;AAlBD,WAAY,0BAA0B;IACpC,iFAAsE,CAAA;IACtE,2EAAgE,CAAA;IAChE,+EAAoE,CAAA;IACpE,+GAAoG,CAAA;IACpG,qFAA0E,CAAA;IAC1E,mFAAwE,CAAA;IACxE,6EAAkE,CAAA;IAClE,wEAA6D,CAAA;IAC7D,wEAA6D,CAAA;IAC7D,kEAAuD,CAAA;IACvD,sFAA2E,CAAA;IAC3E,sFAA2E,CAAA;IAC3E,iFAAsE,CAAA;IACtE,2GAAgG,CAAA;IAChG,oGAAyF,CAAA;IACzF,oGAAyF,CAAA;IACzF,gGAAqF,CAAA;AACvF,CAAC,EAlBW,0BAA0B,KAA1B,0BAA0B,QAkBrC;AAED,MAAM,CAAN,IAAY,aAGX;AAHD,WAAY,aAAa;IACvB,0DAAyC,CAAA;IACzC,yDAAwC,CAAA;AAC1C,CAAC,EAHW,aAAa,KAAb,aAAa,QAGxB;AAED,MAAM,CAAN,IAAY,WAKX;AALD,WAAY,WAAW;IACrB,oDAAqC,CAAA;IACrC,4DAA6C,CAAA;IAC7C,oDAAqC,CAAA;IACrC,6DAA8C,CAAA;AAChD,CAAC,EALW,WAAW,KAAX,WAAW,QAKtB;AAED;;;;GAIG;AACH,MAAM,CAAN,IAAY,2BAKX;AALD,WAAY,2BAA2B;IACrC,qDAAsB,CAAA;IACtB,uDAAwB,CAAA;IACxB,mEAAoC,CAAA;IACpC,kDAAmB,CAAA;AACrB,CAAC,EALW,2BAA2B,KAA3B,2BAA2B,QAKtC;AAED,MAAM,CAAN,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC3B,uCAAkB,CAAA;IAClB,uCAAkB,CAAA;IAClB,uCAAkB,CAAA;IAClB,uEAAuE;IACvE,gCAAW,CAAA;AACb,CAAC,EANW,iBAAiB,KAAjB,iBAAiB,QAM5B;AAED,MAAM,CAAN,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC3B;;OAEG;IACH,oDAA+B,CAAA;IAC/B,oDAA+B,CAAA;AACjC,CAAC,EANW,iBAAiB,KAAjB,iBAAiB,QAM5B;AAED,MAAM,CAAN,IAAY,eAGX;AAHD,WAAY,eAAe;IACzB,0CAAuB,CAAA;IACvB,4CAAyB,CAAA;AAC3B,CAAC,EAHW,eAAe,KAAf,eAAe,QAG1B","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nexport const UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY = 'Unified SwapBridge';\n\n/**\n * These event names map to events defined in the segment-schema: https://github.com/Consensys/segment-schema/tree/main/libraries/events/metamask-cross-chain-swaps\n */\nexport enum UnifiedSwapBridgeEventName {\n  ButtonClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Button Clicked`,\n  PageViewed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Page Viewed`,\n  InputChanged = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Input Changed`,\n  InputSourceDestinationSwitched = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Source Destination Switched`,\n  QuotesRequested = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Requested`,\n  QuotesReceived = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Received`,\n  QuotesError = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Error`,\n  Submitted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Submitted`,\n  Completed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Completed`,\n  Failed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Failed`,\n  AllQuotesOpened = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Opened`,\n  AllQuotesSorted = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} All Quotes Sorted`,\n  QuoteSelected = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quote Selected`,\n  AssetDetailTooltipClicked = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Asset Detail Tooltip Clicked`,\n  QuotesValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Quotes Failed Validation`,\n  StatusValidationFailed = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Status Failed Validation`,\n  PollingStatusUpdated = `${UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY} Polling Status Updated`,\n}\n\nexport enum PollingStatus {\n  MaxPollingReached = 'max_polling_reached',\n  ManuallyRestarted = 'manually_restarted',\n}\n\nexport enum AbortReason {\n  NewQuoteRequest = 'New Quote Request',\n  QuoteRequestUpdated = 'Quote Request Updated',\n  ResetState = 'Reset controller state',\n  TransactionSubmitted = 'Transaction submitted',\n}\n\n/**\n * Identifies the entry point from which the user initiated a swap or bridge flow.\n * Included as the `location` property on every Unified SwapBridge event so\n * analytics can trace the user's origin regardless of where they are in the flow.\n */\nexport enum MetaMetricsSwapsEventSource {\n  MainView = 'Main View',\n  TokenView = 'Token View',\n  TrendingExplore = 'Trending Explore',\n  Rewards = 'Rewards',\n}\n\nexport enum InputAmountPreset {\n  PERCENT_25 = '25%',\n  PERCENT_50 = '50%',\n  PERCENT_75 = '75%',\n  // \"Max\" may not equal 100% of balance (e.g. gas reserves are withheld)\n  MAX = 'MAX',\n}\n\nexport enum MetricsActionType {\n  /**\n   * @deprecated new events should use SWAPBRIDGE_V1 instead\n   */\n  CROSSCHAIN_V1 = 'crosschain-v1',\n  SWAPBRIDGE_V1 = 'swapbridge-v1',\n}\n\nexport enum MetricsSwapType {\n  SINGLE = 'single_chain',\n  CROSSCHAIN = 'crosschain',\n}\n"]}
\ No newline at end of file
diff --git a/dist/utils/metrics/types.cjs.map b/dist/utils/metrics/types.cjs.map
index 54a08e1f5792f78ae0b5e34522356e69ef036d43..899f9718c29f386ecf1957fe4ddd034a4dd630df 100644
--- a/dist/utils/metrics/types.cjs.map
+++ b/dist/utils/metrics/types.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"types.cjs","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nimport type { CaipAssetType, CaipChainId } from '@metamask/utils';\n\nimport type {\n  UnifiedSwapBridgeEventName,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  MetricsSwapType,\n  PollingStatus,\n} from './constants';\nimport type { SortOrder, StatusTypes } from '../../types';\n\n/**\n * These properties map to properties required by the segment-schema. For example: https://github.com/Consensys/segment-schema/blob/main/libraries/properties/cross-chain-swaps-action.yaml\n */\nexport type RequestParams = {\n  chain_id_source: CaipChainId;\n  chain_id_destination: CaipChainId | null;\n  token_symbol_source: string;\n  token_symbol_destination: string | null;\n  token_address_source: CaipAssetType;\n  token_address_destination: CaipAssetType | null;\n};\n\nexport type RequestMetadata = {\n  slippage_limit?: number; // undefined === auto\n  custom_slippage: boolean;\n  usd_amount_source: number; // Use quoteResponse when available\n  stx_enabled: boolean;\n  is_hardware_wallet: boolean;\n  swap_type: MetricsSwapType;\n  security_warnings: string[];\n};\n\nexport type QuoteFetchData = {\n  can_submit: boolean;\n  best_quote_provider?: `${string}_${string}`;\n  quotes_count: number;\n  quotes_list: `${string}_${string}`[];\n  initial_load_time_all_quotes: number;\n  price_impact: number;\n  has_gas_included_quote: boolean;\n};\n\nexport type TradeData = {\n  usd_quoted_gas: number;\n  gas_included: boolean;\n  gas_included_7702: boolean;\n  quoted_time_minutes: number;\n  usd_quoted_return: number;\n  provider: `${string}_${string}`;\n};\n\nexport type TxStatusData = {\n  allowance_reset_transaction?: StatusTypes;\n  approval_transaction?: StatusTypes;\n  source_transaction?: StatusTypes;\n  destination_transaction?: StatusTypes;\n};\n\nexport type InputKeys =\n  | 'token_source'\n  | 'token_destination'\n  | 'chain_source'\n  | 'chain_destination'\n  | 'slippage';\n\nexport type InputValues = {\n  token_source: CaipAssetType;\n  token_destination: CaipAssetType;\n  chain_source: CaipChainId;\n  chain_destination: CaipChainId;\n  slippage: number;\n};\n\nexport type QuoteWarning =\n  | 'low_return'\n  | 'no_quotes'\n  | 'insufficient_gas_balance'\n  | 'insufficient_gas_for_selected_quote'\n  | 'insufficient_balance'\n  | 'price_impact'\n  | 'tx_alert';\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This is the base type without the `location` property which is added to all events\n * via the RequiredEventContextFromClient mapped type.\n */\ntype RequiredEventContextFromClientBase = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: Pick<\n    RequestParams,\n    'token_symbol_source' | 'token_symbol_destination'\n  >;\n  // When type is object, the payload can be anything\n  [UnifiedSwapBridgeEventName.PageViewed]: object;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input:\n      | 'token_source'\n      | 'token_destination'\n      | 'chain_source'\n      | 'chain_destination'\n      | 'slippage';\n    input_value: InputValues[keyof InputValues];\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n    token_address_source: RequestParams['token_address_source'];\n    token_address_destination: RequestParams['token_address_destination'];\n    chain_id_source: RequestParams['chain_id_source'];\n    chain_id_destination: RequestParams['chain_id_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: Pick<\n    RequestMetadata,\n    'stx_enabled' | 'usd_amount_source'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: TradeData & {\n    warnings: QuoteWarning[];\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n    usd_balance_source?: number;\n  };\n  [UnifiedSwapBridgeEventName.QuotesError]: Pick<\n    RequestMetadata,\n    'stx_enabled'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  // Emitted by BridgeStatusController\n  [UnifiedSwapBridgeEventName.Submitted]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Completed]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    TxStatusData &\n    RequestParams & {\n      actual_time_minutes: number;\n      usd_actual_return: number;\n      usd_actual_gas: number;\n      quote_vs_execution_ratio: number;\n      quoted_vs_used_gas_ratio: number;\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Failed]:\n    | // Tx failed before confirmation\n    (TradeData &\n        Pick<QuoteFetchData, 'price_impact'> &\n        Pick<\n          RequestMetadata,\n          'stx_enabled' | 'usd_amount_source' | 'is_hardware_wallet'\n        > &\n        Pick<\n          RequestParams,\n          'token_symbol_source' | 'token_symbol_destination'\n        > & { error_message: string }) // Tx failed after confirmation\n    | (RequestParams &\n        RequestMetadata &\n        Pick<QuoteFetchData, 'price_impact'> &\n        TxStatusData &\n        TradeData & {\n          actual_time_minutes: number;\n          error_message?: string;\n        });\n  // Emitted by clients\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      sort_order: SortOrder;\n      best_quote_provider: QuoteFetchData['best_quote_provider'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.QuoteSelected]: TradeData & {\n    is_best_quote: boolean;\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n  };\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: {\n    token_name: string;\n    token_symbol: string;\n    token_contract: string;\n    chain_name: string;\n    chain_id: string;\n  };\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: {\n    failures: string[];\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: {\n    failures: string[];\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n      polling_status: PollingStatus;\n      retry_attempts: number;\n    };\n};\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This combines the event-specific properties from RequiredEventContextFromClientBase\n * with an optional `location` property. When `location` is omitted, the controller\n * falls back to the value stored via `setLocation()` (defaults to MainView).\n */\nexport type RequiredEventContextFromClient = {\n  [K in keyof RequiredEventContextFromClientBase]: RequiredEventContextFromClientBase[K] & {\n    location?: MetaMetricsSwapsEventSource;\n  };\n};\n\n/**\n * Properties that can be derived from the bridge controller state\n */\nexport type EventPropertiesFromControllerState = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: RequestParams;\n  [UnifiedSwapBridgeEventName.PageViewed]: RequestParams;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input: InputKeys;\n    input_value: string;\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: RequestParams;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n    };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData & {\n      refresh_count: number; // starts from 0\n    };\n  [UnifiedSwapBridgeEventName.QuotesError]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n      error_message: string;\n    };\n  [UnifiedSwapBridgeEventName.Submitted]: null;\n  [UnifiedSwapBridgeEventName.Completed]: null;\n  [UnifiedSwapBridgeEventName.Failed]: RequestParams &\n    RequestMetadata &\n    TxStatusData &\n    TradeData &\n    Pick<QuoteFetchData, 'price_impact'> & {\n      actual_time_minutes: number;\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.QuoteSelected]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData;\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: null;\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: RequestParams & {\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: RequestParams;\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: null;\n};\n\n/**\n * trackUnifiedSwapBridgeEvent payload properties consist of required properties from the client\n * and properties from the bridge controller\n */\nexport type CrossChainSwapsEventProperties<\n  T extends UnifiedSwapBridgeEventName,\n> =\n  | {\n      action_type: MetricsActionType;\n      location: MetaMetricsSwapsEventSource;\n    }\n  | Pick<EventPropertiesFromControllerState, T>[T]\n  | Pick<RequiredEventContextFromClient, T>[T];\n"]}
\ No newline at end of file
+{"version":3,"file":"types.cjs","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nimport type { CaipAssetType, CaipChainId } from '@metamask/utils';\n\nimport type {\n  UnifiedSwapBridgeEventName,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  MetricsSwapType,\n  PollingStatus,\n} from './constants';\nimport type { SortOrder, StatusTypes } from '../../types';\n\n/**\n * These properties map to properties required by the segment-schema. For example: https://github.com/Consensys/segment-schema/blob/main/libraries/properties/cross-chain-swaps-action.yaml\n */\nexport type RequestParams = {\n  chain_id_source: CaipChainId;\n  chain_id_destination: CaipChainId | null;\n  token_symbol_source: string;\n  token_symbol_destination: string | null;\n  token_address_source: CaipAssetType;\n  token_address_destination: CaipAssetType | null;\n};\n\nexport type RequestMetadata = {\n  slippage_limit?: number; // undefined === auto\n  custom_slippage: boolean;\n  usd_amount_source: number; // Use quoteResponse when available\n  stx_enabled: boolean;\n  is_hardware_wallet: boolean;\n  swap_type: MetricsSwapType;\n  security_warnings: string[];\n};\n\nexport type QuoteFetchData = {\n  can_submit: boolean;\n  best_quote_provider?: `${string}_${string}`;\n  quotes_count: number;\n  quotes_list: `${string}_${string}`[];\n  initial_load_time_all_quotes: number;\n  price_impact: number;\n  has_gas_included_quote: boolean;\n};\n\nexport type TradeData = {\n  usd_quoted_gas: number;\n  gas_included: boolean;\n  gas_included_7702: boolean;\n  quoted_time_minutes: number;\n  usd_quoted_return: number;\n  provider: `${string}_${string}`;\n};\n\nexport type TxStatusData = {\n  allowance_reset_transaction?: StatusTypes;\n  approval_transaction?: StatusTypes;\n  source_transaction?: StatusTypes;\n  destination_transaction?: StatusTypes;\n};\n\nexport type InputKeys =\n  | 'token_source'\n  | 'token_destination'\n  | 'chain_source'\n  | 'chain_destination'\n  | 'slippage';\n\nexport type InputValues = {\n  token_source: CaipAssetType;\n  token_destination: CaipAssetType;\n  chain_source: CaipChainId;\n  chain_destination: CaipChainId;\n  slippage: number;\n};\n\nexport type QuoteWarning =\n  | 'low_return'\n  | 'no_quotes'\n  | 'insufficient_gas_balance'\n  | 'insufficient_gas_for_selected_quote'\n  | 'insufficient_balance'\n  | 'price_impact'\n  | 'tx_alert';\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This is the base type without the `location` property which is added to all events\n * via the RequiredEventContextFromClient mapped type.\n */\ntype RequiredEventContextFromClientBase = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: Pick<\n    RequestParams,\n    'token_symbol_source' | 'token_symbol_destination'\n  >;\n  // When type is object, the payload can be anything\n  [UnifiedSwapBridgeEventName.PageViewed]: object;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input:\n      | 'token_source'\n      | 'token_destination'\n      | 'chain_source'\n      | 'chain_destination'\n      | 'slippage';\n    input_value: InputValues[keyof InputValues];\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n    token_address_source: RequestParams['token_address_source'];\n    token_address_destination: RequestParams['token_address_destination'];\n    chain_id_source: RequestParams['chain_id_source'];\n    chain_id_destination: RequestParams['chain_id_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: Pick<\n    RequestMetadata,\n    'stx_enabled' | 'usd_amount_source'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: TradeData & {\n    warnings: QuoteWarning[];\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n    usd_balance_source?: number;\n  };\n  [UnifiedSwapBridgeEventName.QuotesError]: Pick<\n    RequestMetadata,\n    'stx_enabled'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  // Emitted by BridgeStatusController\n  [UnifiedSwapBridgeEventName.Submitted]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Completed]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    TxStatusData &\n    RequestParams & {\n      actual_time_minutes: number;\n      usd_actual_return: number;\n      usd_actual_gas: number;\n      quote_vs_execution_ratio: number;\n      quoted_vs_used_gas_ratio: number;\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Failed]:\n    | // Tx failed before confirmation\n    (TradeData &\n        Pick<QuoteFetchData, 'price_impact'> &\n        Pick<\n          RequestMetadata,\n          'stx_enabled' | 'usd_amount_source' | 'is_hardware_wallet'\n        > &\n        Pick<\n          RequestParams,\n          'token_symbol_source' | 'token_symbol_destination'\n        > & { error_message: string }) // Tx failed after confirmation\n    | (RequestParams &\n        RequestMetadata &\n        Pick<QuoteFetchData, 'price_impact'> &\n        TxStatusData &\n        TradeData & {\n          actual_time_minutes: number;\n          error_message?: string;\n        });\n  // Emitted by clients\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      sort_order: SortOrder;\n      best_quote_provider: QuoteFetchData['best_quote_provider'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.QuoteSelected]: TradeData & {\n    is_best_quote: boolean;\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n  };\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: {\n    token_name: string;\n    token_symbol: string;\n    token_contract: string;\n    chain_name: string;\n    chain_id: string;\n  };\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: {\n    failures: string[];\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: {\n    failures: string[];\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n      polling_status: PollingStatus;\n      retry_attempts: number;\n    };\n};\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This combines the event-specific properties from RequiredEventContextFromClientBase\n * with an optional `location` property. When `location` is omitted, the controller\n * falls back to the value stored via `setLocation()` (defaults to MainView).\n */\nexport type RequiredEventContextFromClient = {\n  [K in keyof RequiredEventContextFromClientBase]: RequiredEventContextFromClientBase[K] & {\n    location?: MetaMetricsSwapsEventSource;\n    ab_tests?: Record<string, string>;\n  };\n};\n\n/**\n * Properties that can be derived from the bridge controller state\n */\nexport type EventPropertiesFromControllerState = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: RequestParams;\n  [UnifiedSwapBridgeEventName.PageViewed]: RequestParams;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input: InputKeys;\n    input_value: string;\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: RequestParams;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n    };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData & {\n      refresh_count: number; // starts from 0\n    };\n  [UnifiedSwapBridgeEventName.QuotesError]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n      error_message: string;\n    };\n  [UnifiedSwapBridgeEventName.Submitted]: null;\n  [UnifiedSwapBridgeEventName.Completed]: null;\n  [UnifiedSwapBridgeEventName.Failed]: RequestParams &\n    RequestMetadata &\n    TxStatusData &\n    TradeData &\n    Pick<QuoteFetchData, 'price_impact'> & {\n      actual_time_minutes: number;\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.QuoteSelected]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData;\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: null;\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: RequestParams & {\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: RequestParams;\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: null;\n};\n\n/**\n * trackUnifiedSwapBridgeEvent payload properties consist of required properties from the client\n * and properties from the bridge controller\n */\nexport type CrossChainSwapsEventProperties<\n  T extends UnifiedSwapBridgeEventName,\n> =\n  | {\n      action_type: MetricsActionType;\n      location: MetaMetricsSwapsEventSource;\n      ab_tests?: Record<string, string>;\n    }\n  | Pick<EventPropertiesFromControllerState, T>[T]\n  | Pick<RequiredEventContextFromClient, T>[T];\n"]}
\ No newline at end of file
diff --git a/dist/utils/metrics/types.d.cts b/dist/utils/metrics/types.d.cts
index 7710230d39c86041c7e0fecd7caa3e27a8130b16..9e1e6978d432b9703aaafdd5b8f238cd5f302d2c 100644
--- a/dist/utils/metrics/types.d.cts
+++ b/dist/utils/metrics/types.d.cts
@@ -151,6 +151,7 @@ type RequiredEventContextFromClientBase = {
 export type RequiredEventContextFromClient = {
     [K in keyof RequiredEventContextFromClientBase]: RequiredEventContextFromClientBase[K] & {
         location?: MetaMetricsSwapsEventSource;
+        ab_tests?: Record<string, string>;
     };
 };
 /**
@@ -196,6 +197,7 @@ export type EventPropertiesFromControllerState = {
 export type CrossChainSwapsEventProperties<T extends UnifiedSwapBridgeEventName> = {
     action_type: MetricsActionType;
     location: MetaMetricsSwapsEventSource;
+    ab_tests?: Record<string, string>;
 } | Pick<EventPropertiesFromControllerState, T>[T] | Pick<RequiredEventContextFromClient, T>[T];
 export {};
 //# sourceMappingURL=types.d.cts.map
\ No newline at end of file
diff --git a/dist/utils/metrics/types.d.cts.map b/dist/utils/metrics/types.d.cts.map
index fe548ee66150406cb054c49309713a424df4c243..1899b6e0b462e42994df2945c7c8ef8792926e56 100644
--- a/dist/utils/metrics/types.d.cts.map
+++ b/dist/utils/metrics/types.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"types.d.cts","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"types.d.cts","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/utils/metrics/types.d.mts b/dist/utils/metrics/types.d.mts
index 40d1986b36f8f13cdc6e279d2793a3dc94b42db6..05fcbedefbe22c35e676ceb96a8095fb7148ca10 100644
--- a/dist/utils/metrics/types.d.mts
+++ b/dist/utils/metrics/types.d.mts
@@ -151,6 +151,7 @@ type RequiredEventContextFromClientBase = {
 export type RequiredEventContextFromClient = {
     [K in keyof RequiredEventContextFromClientBase]: RequiredEventContextFromClientBase[K] & {
         location?: MetaMetricsSwapsEventSource;
+        ab_tests?: Record<string, string>;
     };
 };
 /**
@@ -196,6 +197,7 @@ export type EventPropertiesFromControllerState = {
 export type CrossChainSwapsEventProperties<T extends UnifiedSwapBridgeEventName> = {
     action_type: MetricsActionType;
     location: MetaMetricsSwapsEventSource;
+    ab_tests?: Record<string, string>;
 } | Pick<EventPropertiesFromControllerState, T>[T] | Pick<RequiredEventContextFromClient, T>[T];
 export {};
 //# sourceMappingURL=types.d.mts.map
\ No newline at end of file
diff --git a/dist/utils/metrics/types.d.mts.map b/dist/utils/metrics/types.d.mts.map
index f1ebd3aa1a6dd7aab16e7f1d4a7723977d180c18..2e441504ceafe22d6b3f8d062848d6420f71c40e 100644
--- a/dist/utils/metrics/types.d.mts.map
+++ b/dist/utils/metrics/types.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"types.d.mts","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"types.d.mts","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/utils/metrics/types.mjs.map b/dist/utils/metrics/types.mjs.map
index a6f3e742975c0b4d7b1b183b9a5093693cb55fec..827893b13dbfec6123444cdbaf6988aa4f2d67f8 100644
--- a/dist/utils/metrics/types.mjs.map
+++ b/dist/utils/metrics/types.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"types.mjs","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nimport type { CaipAssetType, CaipChainId } from '@metamask/utils';\n\nimport type {\n  UnifiedSwapBridgeEventName,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  MetricsSwapType,\n  PollingStatus,\n} from './constants';\nimport type { SortOrder, StatusTypes } from '../../types';\n\n/**\n * These properties map to properties required by the segment-schema. For example: https://github.com/Consensys/segment-schema/blob/main/libraries/properties/cross-chain-swaps-action.yaml\n */\nexport type RequestParams = {\n  chain_id_source: CaipChainId;\n  chain_id_destination: CaipChainId | null;\n  token_symbol_source: string;\n  token_symbol_destination: string | null;\n  token_address_source: CaipAssetType;\n  token_address_destination: CaipAssetType | null;\n};\n\nexport type RequestMetadata = {\n  slippage_limit?: number; // undefined === auto\n  custom_slippage: boolean;\n  usd_amount_source: number; // Use quoteResponse when available\n  stx_enabled: boolean;\n  is_hardware_wallet: boolean;\n  swap_type: MetricsSwapType;\n  security_warnings: string[];\n};\n\nexport type QuoteFetchData = {\n  can_submit: boolean;\n  best_quote_provider?: `${string}_${string}`;\n  quotes_count: number;\n  quotes_list: `${string}_${string}`[];\n  initial_load_time_all_quotes: number;\n  price_impact: number;\n  has_gas_included_quote: boolean;\n};\n\nexport type TradeData = {\n  usd_quoted_gas: number;\n  gas_included: boolean;\n  gas_included_7702: boolean;\n  quoted_time_minutes: number;\n  usd_quoted_return: number;\n  provider: `${string}_${string}`;\n};\n\nexport type TxStatusData = {\n  allowance_reset_transaction?: StatusTypes;\n  approval_transaction?: StatusTypes;\n  source_transaction?: StatusTypes;\n  destination_transaction?: StatusTypes;\n};\n\nexport type InputKeys =\n  | 'token_source'\n  | 'token_destination'\n  | 'chain_source'\n  | 'chain_destination'\n  | 'slippage';\n\nexport type InputValues = {\n  token_source: CaipAssetType;\n  token_destination: CaipAssetType;\n  chain_source: CaipChainId;\n  chain_destination: CaipChainId;\n  slippage: number;\n};\n\nexport type QuoteWarning =\n  | 'low_return'\n  | 'no_quotes'\n  | 'insufficient_gas_balance'\n  | 'insufficient_gas_for_selected_quote'\n  | 'insufficient_balance'\n  | 'price_impact'\n  | 'tx_alert';\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This is the base type without the `location` property which is added to all events\n * via the RequiredEventContextFromClient mapped type.\n */\ntype RequiredEventContextFromClientBase = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: Pick<\n    RequestParams,\n    'token_symbol_source' | 'token_symbol_destination'\n  >;\n  // When type is object, the payload can be anything\n  [UnifiedSwapBridgeEventName.PageViewed]: object;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input:\n      | 'token_source'\n      | 'token_destination'\n      | 'chain_source'\n      | 'chain_destination'\n      | 'slippage';\n    input_value: InputValues[keyof InputValues];\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n    token_address_source: RequestParams['token_address_source'];\n    token_address_destination: RequestParams['token_address_destination'];\n    chain_id_source: RequestParams['chain_id_source'];\n    chain_id_destination: RequestParams['chain_id_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: Pick<\n    RequestMetadata,\n    'stx_enabled' | 'usd_amount_source'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: TradeData & {\n    warnings: QuoteWarning[];\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n    usd_balance_source?: number;\n  };\n  [UnifiedSwapBridgeEventName.QuotesError]: Pick<\n    RequestMetadata,\n    'stx_enabled'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  // Emitted by BridgeStatusController\n  [UnifiedSwapBridgeEventName.Submitted]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Completed]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    TxStatusData &\n    RequestParams & {\n      actual_time_minutes: number;\n      usd_actual_return: number;\n      usd_actual_gas: number;\n      quote_vs_execution_ratio: number;\n      quoted_vs_used_gas_ratio: number;\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Failed]:\n    | // Tx failed before confirmation\n    (TradeData &\n        Pick<QuoteFetchData, 'price_impact'> &\n        Pick<\n          RequestMetadata,\n          'stx_enabled' | 'usd_amount_source' | 'is_hardware_wallet'\n        > &\n        Pick<\n          RequestParams,\n          'token_symbol_source' | 'token_symbol_destination'\n        > & { error_message: string }) // Tx failed after confirmation\n    | (RequestParams &\n        RequestMetadata &\n        Pick<QuoteFetchData, 'price_impact'> &\n        TxStatusData &\n        TradeData & {\n          actual_time_minutes: number;\n          error_message?: string;\n        });\n  // Emitted by clients\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      sort_order: SortOrder;\n      best_quote_provider: QuoteFetchData['best_quote_provider'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.QuoteSelected]: TradeData & {\n    is_best_quote: boolean;\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n  };\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: {\n    token_name: string;\n    token_symbol: string;\n    token_contract: string;\n    chain_name: string;\n    chain_id: string;\n  };\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: {\n    failures: string[];\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: {\n    failures: string[];\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n      polling_status: PollingStatus;\n      retry_attempts: number;\n    };\n};\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This combines the event-specific properties from RequiredEventContextFromClientBase\n * with an optional `location` property. When `location` is omitted, the controller\n * falls back to the value stored via `setLocation()` (defaults to MainView).\n */\nexport type RequiredEventContextFromClient = {\n  [K in keyof RequiredEventContextFromClientBase]: RequiredEventContextFromClientBase[K] & {\n    location?: MetaMetricsSwapsEventSource;\n  };\n};\n\n/**\n * Properties that can be derived from the bridge controller state\n */\nexport type EventPropertiesFromControllerState = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: RequestParams;\n  [UnifiedSwapBridgeEventName.PageViewed]: RequestParams;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input: InputKeys;\n    input_value: string;\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: RequestParams;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n    };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData & {\n      refresh_count: number; // starts from 0\n    };\n  [UnifiedSwapBridgeEventName.QuotesError]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n      error_message: string;\n    };\n  [UnifiedSwapBridgeEventName.Submitted]: null;\n  [UnifiedSwapBridgeEventName.Completed]: null;\n  [UnifiedSwapBridgeEventName.Failed]: RequestParams &\n    RequestMetadata &\n    TxStatusData &\n    TradeData &\n    Pick<QuoteFetchData, 'price_impact'> & {\n      actual_time_minutes: number;\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.QuoteSelected]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData;\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: null;\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: RequestParams & {\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: RequestParams;\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: null;\n};\n\n/**\n * trackUnifiedSwapBridgeEvent payload properties consist of required properties from the client\n * and properties from the bridge controller\n */\nexport type CrossChainSwapsEventProperties<\n  T extends UnifiedSwapBridgeEventName,\n> =\n  | {\n      action_type: MetricsActionType;\n      location: MetaMetricsSwapsEventSource;\n    }\n  | Pick<EventPropertiesFromControllerState, T>[T]\n  | Pick<RequiredEventContextFromClient, T>[T];\n"]}
\ No newline at end of file
+{"version":3,"file":"types.mjs","sourceRoot":"","sources":["../../../src/utils/metrics/types.ts"],"names":[],"mappings":"","sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\nimport type { CaipAssetType, CaipChainId } from '@metamask/utils';\n\nimport type {\n  UnifiedSwapBridgeEventName,\n  MetaMetricsSwapsEventSource,\n  MetricsActionType,\n  MetricsSwapType,\n  PollingStatus,\n} from './constants';\nimport type { SortOrder, StatusTypes } from '../../types';\n\n/**\n * These properties map to properties required by the segment-schema. For example: https://github.com/Consensys/segment-schema/blob/main/libraries/properties/cross-chain-swaps-action.yaml\n */\nexport type RequestParams = {\n  chain_id_source: CaipChainId;\n  chain_id_destination: CaipChainId | null;\n  token_symbol_source: string;\n  token_symbol_destination: string | null;\n  token_address_source: CaipAssetType;\n  token_address_destination: CaipAssetType | null;\n};\n\nexport type RequestMetadata = {\n  slippage_limit?: number; // undefined === auto\n  custom_slippage: boolean;\n  usd_amount_source: number; // Use quoteResponse when available\n  stx_enabled: boolean;\n  is_hardware_wallet: boolean;\n  swap_type: MetricsSwapType;\n  security_warnings: string[];\n};\n\nexport type QuoteFetchData = {\n  can_submit: boolean;\n  best_quote_provider?: `${string}_${string}`;\n  quotes_count: number;\n  quotes_list: `${string}_${string}`[];\n  initial_load_time_all_quotes: number;\n  price_impact: number;\n  has_gas_included_quote: boolean;\n};\n\nexport type TradeData = {\n  usd_quoted_gas: number;\n  gas_included: boolean;\n  gas_included_7702: boolean;\n  quoted_time_minutes: number;\n  usd_quoted_return: number;\n  provider: `${string}_${string}`;\n};\n\nexport type TxStatusData = {\n  allowance_reset_transaction?: StatusTypes;\n  approval_transaction?: StatusTypes;\n  source_transaction?: StatusTypes;\n  destination_transaction?: StatusTypes;\n};\n\nexport type InputKeys =\n  | 'token_source'\n  | 'token_destination'\n  | 'chain_source'\n  | 'chain_destination'\n  | 'slippage';\n\nexport type InputValues = {\n  token_source: CaipAssetType;\n  token_destination: CaipAssetType;\n  chain_source: CaipChainId;\n  chain_destination: CaipChainId;\n  slippage: number;\n};\n\nexport type QuoteWarning =\n  | 'low_return'\n  | 'no_quotes'\n  | 'insufficient_gas_balance'\n  | 'insufficient_gas_for_selected_quote'\n  | 'insufficient_balance'\n  | 'price_impact'\n  | 'tx_alert';\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This is the base type without the `location` property which is added to all events\n * via the RequiredEventContextFromClient mapped type.\n */\ntype RequiredEventContextFromClientBase = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: Pick<\n    RequestParams,\n    'token_symbol_source' | 'token_symbol_destination'\n  >;\n  // When type is object, the payload can be anything\n  [UnifiedSwapBridgeEventName.PageViewed]: object;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input:\n      | 'token_source'\n      | 'token_destination'\n      | 'chain_source'\n      | 'chain_destination'\n      | 'slippage';\n    input_value: InputValues[keyof InputValues];\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n    token_address_source: RequestParams['token_address_source'];\n    token_address_destination: RequestParams['token_address_destination'];\n    chain_id_source: RequestParams['chain_id_source'];\n    chain_id_destination: RequestParams['chain_id_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: Pick<\n    RequestMetadata,\n    'stx_enabled' | 'usd_amount_source'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: TradeData & {\n    warnings: QuoteWarning[];\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n    usd_balance_source?: number;\n  };\n  [UnifiedSwapBridgeEventName.QuotesError]: Pick<\n    RequestMetadata,\n    'stx_enabled'\n  > & {\n    token_symbol_source: RequestParams['token_symbol_source'];\n    token_symbol_destination: RequestParams['token_symbol_destination'];\n  } & Pick<RequestMetadata, 'security_warnings'>;\n  // Emitted by BridgeStatusController\n  [UnifiedSwapBridgeEventName.Submitted]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Completed]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    TxStatusData &\n    RequestParams & {\n      actual_time_minutes: number;\n      usd_actual_return: number;\n      usd_actual_gas: number;\n      quote_vs_execution_ratio: number;\n      quoted_vs_used_gas_ratio: number;\n      action_type: MetricsActionType;\n    };\n  [UnifiedSwapBridgeEventName.Failed]:\n    | // Tx failed before confirmation\n    (TradeData &\n        Pick<QuoteFetchData, 'price_impact'> &\n        Pick<\n          RequestMetadata,\n          'stx_enabled' | 'usd_amount_source' | 'is_hardware_wallet'\n        > &\n        Pick<\n          RequestParams,\n          'token_symbol_source' | 'token_symbol_destination'\n        > & { error_message: string }) // Tx failed after confirmation\n    | (RequestParams &\n        RequestMetadata &\n        Pick<QuoteFetchData, 'price_impact'> &\n        TxStatusData &\n        TradeData & {\n          actual_time_minutes: number;\n          error_message?: string;\n        });\n  // Emitted by clients\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: Pick<\n    TradeData,\n    'gas_included'\n  > &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Pick<RequestParams, 'token_symbol_source' | 'token_symbol_destination'> & {\n      stx_enabled: RequestMetadata['stx_enabled'];\n      sort_order: SortOrder;\n      best_quote_provider: QuoteFetchData['best_quote_provider'];\n      can_submit: QuoteFetchData['can_submit'];\n    };\n  [UnifiedSwapBridgeEventName.QuoteSelected]: TradeData & {\n    is_best_quote: boolean;\n    best_quote_provider: QuoteFetchData['best_quote_provider'];\n    price_impact: QuoteFetchData['price_impact'];\n    can_submit: QuoteFetchData['can_submit'];\n  };\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: {\n    token_name: string;\n    token_symbol: string;\n    token_contract: string;\n    chain_name: string;\n    chain_id: string;\n  };\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: {\n    failures: string[];\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: {\n    failures: string[];\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: TradeData &\n    Pick<QuoteFetchData, 'price_impact'> &\n    Omit<RequestMetadata, 'security_warnings'> &\n    Pick<\n      RequestParams,\n      | 'token_symbol_source'\n      | 'token_symbol_destination'\n      | 'chain_id_source'\n      | 'chain_id_destination'\n    > & {\n      action_type: MetricsActionType;\n      polling_status: PollingStatus;\n      retry_attempts: number;\n    };\n};\n\n/**\n * Properties that are required to be provided when trackUnifiedSwapBridgeEvent is called.\n * This combines the event-specific properties from RequiredEventContextFromClientBase\n * with an optional `location` property. When `location` is omitted, the controller\n * falls back to the value stored via `setLocation()` (defaults to MainView).\n */\nexport type RequiredEventContextFromClient = {\n  [K in keyof RequiredEventContextFromClientBase]: RequiredEventContextFromClientBase[K] & {\n    location?: MetaMetricsSwapsEventSource;\n    ab_tests?: Record<string, string>;\n  };\n};\n\n/**\n * Properties that can be derived from the bridge controller state\n */\nexport type EventPropertiesFromControllerState = {\n  [UnifiedSwapBridgeEventName.ButtonClicked]: RequestParams;\n  [UnifiedSwapBridgeEventName.PageViewed]: RequestParams;\n  [UnifiedSwapBridgeEventName.InputChanged]: {\n    input: InputKeys;\n    input_value: string;\n  };\n  [UnifiedSwapBridgeEventName.InputSourceDestinationSwitched]: RequestParams;\n  [UnifiedSwapBridgeEventName.QuotesRequested]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n    };\n  [UnifiedSwapBridgeEventName.QuotesReceived]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData & {\n      refresh_count: number; // starts from 0\n    };\n  [UnifiedSwapBridgeEventName.QuotesError]: RequestParams &\n    RequestMetadata & {\n      has_sufficient_funds: boolean;\n      error_message: string;\n    };\n  [UnifiedSwapBridgeEventName.Submitted]: null;\n  [UnifiedSwapBridgeEventName.Completed]: null;\n  [UnifiedSwapBridgeEventName.Failed]: RequestParams &\n    RequestMetadata &\n    TxStatusData &\n    TradeData &\n    Pick<QuoteFetchData, 'price_impact'> & {\n      actual_time_minutes: number;\n    };\n  [UnifiedSwapBridgeEventName.AllQuotesOpened]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.AllQuotesSorted]: RequestParams &\n    RequestMetadata &\n    TradeData &\n    QuoteFetchData;\n  [UnifiedSwapBridgeEventName.QuoteSelected]: RequestParams &\n    RequestMetadata &\n    QuoteFetchData &\n    TradeData;\n  [UnifiedSwapBridgeEventName.AssetDetailTooltipClicked]: null;\n  [UnifiedSwapBridgeEventName.QuotesValidationFailed]: RequestParams & {\n    refresh_count: number;\n  };\n  [UnifiedSwapBridgeEventName.StatusValidationFailed]: RequestParams;\n  [UnifiedSwapBridgeEventName.PollingStatusUpdated]: null;\n};\n\n/**\n * trackUnifiedSwapBridgeEvent payload properties consist of required properties from the client\n * and properties from the bridge controller\n */\nexport type CrossChainSwapsEventProperties<\n  T extends UnifiedSwapBridgeEventName,\n> =\n  | {\n      action_type: MetricsActionType;\n      location: MetaMetricsSwapsEventSource;\n      ab_tests?: Record<string, string>;\n    }\n  | Pick<EventPropertiesFromControllerState, T>[T]\n  | Pick<RequiredEventContextFromClient, T>[T];\n"]}
\ No newline at end of file
