diff --git a/CHANGELOG.md b/CHANGELOG.md
index 5817ea03e03416b25814842877207be4af478b48..043428e4bc44eff8880b413c75a0221c8aff84a6 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -7,6 +7,23 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0
 
 ## [Unreleased]
 
+## [29.0.0]
+
+### Added
+
+- Add dependency `@metamask/connectivity-controller` `^0.1.0` ([#7642](https://github.com/MetaMask/core/pull/7642))
+
+### Changed
+
+- Bump `@metamask/eth-block-tracker` from `^15.0.0` to `^15.0.1` ([#7642](https://github.com/MetaMask/core/pull/7642))
+- Bump `@metamask/json-rpc-engine` from `^10.2.0` to `^10.2.1` ([#7642](https://github.com/MetaMask/core/pull/7642))
+- Bump `@metamask/eth-json-rpc-middleware` from `^22.0.1` to `^23.0.0` ([#7634](https://github.com/MetaMask/core/pull/7634))
+- **BREAKING:** NetworkController now requires `ConnectivityController:getState` action handler to be registered on the messenger ([#7627](https://github.com/MetaMask/core/pull/7627))
+  - The `NetworkController` now depends on the `ConnectivityController` to prevent retries and suppress events when the user is offline.
+  - When offline, `NetworkController:rpcEndpointUnavailable` and `NetworkController:rpcEndpointDegraded` events are suppressed since retries don't occur and circuit breakers don't trigger.
+  - You must register a `ConnectivityController:getState` action handler on your root messenger that returns an object with a `connectivityStatus` property (`'online'` or `'offline'`).
+  - You must delegate the `ConnectivityController:getState` action from your root messenger to the `NetworkControllerMessenger` using `rootMessenger.delegate({ messenger: networkControllerMessenger, actions: ['ConnectivityController:getState'] })`.
+
 ## [28.0.0]
 
 ### Changed
@@ -1080,7 +1097,8 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0
 
     All changes listed after this point were applied to this package following the monorepo conversion.
 
-[Unreleased]: https://github.com/MetaMask/core/compare/@metamask/network-controller@28.0.0...HEAD
+[Unreleased]: https://github.com/MetaMask/core/compare/@metamask/network-controller@29.0.0...HEAD
+[29.0.0]: https://github.com/MetaMask/core/compare/@metamask/network-controller@28.0.0...@metamask/network-controller@29.0.0
 [28.0.0]: https://github.com/MetaMask/core/compare/@metamask/network-controller@27.2.0...@metamask/network-controller@28.0.0
 [27.2.0]: https://github.com/MetaMask/core/compare/@metamask/network-controller@27.1.0...@metamask/network-controller@27.2.0
 [27.1.0]: https://github.com/MetaMask/core/compare/@metamask/network-controller@27.0.0...@metamask/network-controller@27.1.0
diff --git a/coverage/base.css b/coverage/base.css
new file mode 100644
index 0000000000000000000000000000000000000000..f418035b469aff23689a74c912849662f442aed4
--- /dev/null
+++ b/coverage/base.css
@@ -0,0 +1,224 @@
+body, html {
+  margin:0; padding: 0;
+  height: 100%;
+}
+body {
+    font-family: Helvetica Neue, Helvetica, Arial;
+    font-size: 14px;
+    color:#333;
+}
+.small { font-size: 12px; }
+*, *:after, *:before {
+  -webkit-box-sizing:border-box;
+     -moz-box-sizing:border-box;
+          box-sizing:border-box;
+  }
+h1 { font-size: 20px; margin: 0;}
+h2 { font-size: 14px; }
+pre {
+    font: 12px/1.4 Consolas, "Liberation Mono", Menlo, Courier, monospace;
+    margin: 0;
+    padding: 0;
+    -moz-tab-size: 2;
+    -o-tab-size:  2;
+    tab-size: 2;
+}
+a { color:#0074D9; text-decoration:none; }
+a:hover { text-decoration:underline; }
+.strong { font-weight: bold; }
+.space-top1 { padding: 10px 0 0 0; }
+.pad2y { padding: 20px 0; }
+.pad1y { padding: 10px 0; }
+.pad2x { padding: 0 20px; }
+.pad2 { padding: 20px; }
+.pad1 { padding: 10px; }
+.space-left2 { padding-left:55px; }
+.space-right2 { padding-right:20px; }
+.center { text-align:center; }
+.clearfix { display:block; }
+.clearfix:after {
+  content:'';
+  display:block;
+  height:0;
+  clear:both;
+  visibility:hidden;
+  }
+.fl { float: left; }
+@media only screen and (max-width:640px) {
+  .col3 { width:100%; max-width:100%; }
+  .hide-mobile { display:none!important; }
+}
+
+.quiet {
+  color: #7f7f7f;
+  color: rgba(0,0,0,0.5);
+}
+.quiet a { opacity: 0.7; }
+
+.fraction {
+  font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
+  font-size: 10px;
+  color: #555;
+  background: #E8E8E8;
+  padding: 4px 5px;
+  border-radius: 3px;
+  vertical-align: middle;
+}
+
+div.path a:link, div.path a:visited { color: #333; }
+table.coverage {
+  border-collapse: collapse;
+  margin: 10px 0 0 0;
+  padding: 0;
+}
+
+table.coverage td {
+  margin: 0;
+  padding: 0;
+  vertical-align: top;
+}
+table.coverage td.line-count {
+    text-align: right;
+    padding: 0 5px 0 20px;
+}
+table.coverage td.line-coverage {
+    text-align: right;
+    padding-right: 10px;
+    min-width:20px;
+}
+
+table.coverage td span.cline-any {
+    display: inline-block;
+    padding: 0 5px;
+    width: 100%;
+}
+.missing-if-branch {
+    display: inline-block;
+    margin-right: 5px;
+    border-radius: 3px;
+    position: relative;
+    padding: 0 4px;
+    background: #333;
+    color: yellow;
+}
+
+.skip-if-branch {
+    display: none;
+    margin-right: 10px;
+    position: relative;
+    padding: 0 4px;
+    background: #ccc;
+    color: white;
+}
+.missing-if-branch .typ, .skip-if-branch .typ {
+    color: inherit !important;
+}
+.coverage-summary {
+  border-collapse: collapse;
+  width: 100%;
+}
+.coverage-summary tr { border-bottom: 1px solid #bbb; }
+.keyline-all { border: 1px solid #ddd; }
+.coverage-summary td, .coverage-summary th { padding: 10px; }
+.coverage-summary tbody { border: 1px solid #bbb; }
+.coverage-summary td { border-right: 1px solid #bbb; }
+.coverage-summary td:last-child { border-right: none; }
+.coverage-summary th {
+  text-align: left;
+  font-weight: normal;
+  white-space: nowrap;
+}
+.coverage-summary th.file { border-right: none !important; }
+.coverage-summary th.pct { }
+.coverage-summary th.pic,
+.coverage-summary th.abs,
+.coverage-summary td.pct,
+.coverage-summary td.abs { text-align: right; }
+.coverage-summary td.file { white-space: nowrap;  }
+.coverage-summary td.pic { min-width: 120px !important;  }
+.coverage-summary tfoot td { }
+
+.coverage-summary .sorter {
+    height: 10px;
+    width: 7px;
+    display: inline-block;
+    margin-left: 0.5em;
+    background: url(sort-arrow-sprite.png) no-repeat scroll 0 0 transparent;
+}
+.coverage-summary .sorted .sorter {
+    background-position: 0 -20px;
+}
+.coverage-summary .sorted-desc .sorter {
+    background-position: 0 -10px;
+}
+.status-line {  height: 10px; }
+/* yellow */
+.cbranch-no { background: yellow !important; color: #111; }
+/* dark red */
+.red.solid, .status-line.low, .low .cover-fill { background:#C21F39 }
+.low .chart { border:1px solid #C21F39 }
+.highlighted,
+.highlighted .cstat-no, .highlighted .fstat-no, .highlighted .cbranch-no{
+  background: #C21F39 !important;
+}
+/* medium red */
+.cstat-no, .fstat-no, .cbranch-no, .cbranch-no { background:#F6C6CE }
+/* light red */
+.low, .cline-no { background:#FCE1E5 }
+/* light green */
+.high, .cline-yes { background:rgb(230,245,208) }
+/* medium green */
+.cstat-yes { background:rgb(161,215,106) }
+/* dark green */
+.status-line.high, .high .cover-fill { background:rgb(77,146,33) }
+.high .chart { border:1px solid rgb(77,146,33) }
+/* dark yellow (gold) */
+.status-line.medium, .medium .cover-fill { background: #f9cd0b; }
+.medium .chart { border:1px solid #f9cd0b; }
+/* light yellow */
+.medium { background: #fff4c2; }
+
+.cstat-skip { background: #ddd; color: #111; }
+.fstat-skip { background: #ddd; color: #111 !important; }
+.cbranch-skip { background: #ddd !important; color: #111; }
+
+span.cline-neutral { background: #eaeaea; }
+
+.coverage-summary td.empty {
+    opacity: .5;
+    padding-top: 4px;
+    padding-bottom: 4px;
+    line-height: 1;
+    color: #888;
+}
+
+.cover-fill, .cover-empty {
+  display:inline-block;
+  height: 12px;
+}
+.chart {
+  line-height: 0;
+}
+.cover-empty {
+    background: white;
+}
+.cover-full {
+    border-right: none !important;
+}
+pre.prettyprint {
+    border: none !important;
+    padding: 0 !important;
+    margin: 0 !important;
+}
+.com { color: #999 !important; }
+.ignore-none { color: #999; font-weight: normal; }
+
+.wrapper {
+  min-height: 100%;
+  height: auto !important;
+  height: 100%;
+  margin: 0 auto -48px;
+}
+.footer, .push {
+  height: 48px;
+}
diff --git a/coverage/block-navigation.js b/coverage/block-navigation.js
new file mode 100644
index 0000000000000000000000000000000000000000..cc121302316c8faaaebfd6a15f4212d99e563199
--- /dev/null
+++ b/coverage/block-navigation.js
@@ -0,0 +1,87 @@
+/* eslint-disable */
+var jumpToCode = (function init() {
+    // Classes of code we would like to highlight in the file view
+    var missingCoverageClasses = ['.cbranch-no', '.cstat-no', '.fstat-no'];
+
+    // Elements to highlight in the file listing view
+    var fileListingElements = ['td.pct.low'];
+
+    // We don't want to select elements that are direct descendants of another match
+    var notSelector = ':not(' + missingCoverageClasses.join('):not(') + ') > '; // becomes `:not(a):not(b) > `
+
+    // Selecter that finds elements on the page to which we can jump
+    var selector =
+        fileListingElements.join(', ') +
+        ', ' +
+        notSelector +
+        missingCoverageClasses.join(', ' + notSelector); // becomes `:not(a):not(b) > a, :not(a):not(b) > b`
+
+    // The NodeList of matching elements
+    var missingCoverageElements = document.querySelectorAll(selector);
+
+    var currentIndex;
+
+    function toggleClass(index) {
+        missingCoverageElements
+            .item(currentIndex)
+            .classList.remove('highlighted');
+        missingCoverageElements.item(index).classList.add('highlighted');
+    }
+
+    function makeCurrent(index) {
+        toggleClass(index);
+        currentIndex = index;
+        missingCoverageElements.item(index).scrollIntoView({
+            behavior: 'smooth',
+            block: 'center',
+            inline: 'center'
+        });
+    }
+
+    function goToPrevious() {
+        var nextIndex = 0;
+        if (typeof currentIndex !== 'number' || currentIndex === 0) {
+            nextIndex = missingCoverageElements.length - 1;
+        } else if (missingCoverageElements.length > 1) {
+            nextIndex = currentIndex - 1;
+        }
+
+        makeCurrent(nextIndex);
+    }
+
+    function goToNext() {
+        var nextIndex = 0;
+
+        if (
+            typeof currentIndex === 'number' &&
+            currentIndex < missingCoverageElements.length - 1
+        ) {
+            nextIndex = currentIndex + 1;
+        }
+
+        makeCurrent(nextIndex);
+    }
+
+    return function jump(event) {
+        if (
+            document.getElementById('fileSearch') === document.activeElement &&
+            document.activeElement != null
+        ) {
+            // if we're currently focused on the search input, we don't want to navigate
+            return;
+        }
+
+        switch (event.which) {
+            case 78: // n
+            case 74: // j
+                goToNext();
+                break;
+            case 66: // b
+            case 75: // k
+            case 80: // p
+                goToPrevious();
+                break;
+        }
+    };
+})();
+window.addEventListener('keydown', jumpToCode);
diff --git a/coverage/coverage-summary.json b/coverage/coverage-summary.json
new file mode 100644
index 0000000000000000000000000000000000000000..d8d65cedb0060993487f8db09c56c4964a7380eb
--- /dev/null
+++ b/coverage/coverage-summary.json
@@ -0,0 +1,11 @@
+{"total": {"lines":{"total":825,"covered":14,"skipped":0,"pct":1.69},"statements":{"total":830,"covered":15,"skipped":0,"pct":1.8},"functions":{"total":201,"covered":4,"skipped":0,"pct":1.99},"branches":{"total":329,"covered":5,"skipped":0,"pct":1.51},"branchesTrue":{"total":0,"covered":0,"skipped":0,"pct":100}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/NetworkController.ts": {"lines":{"total":496,"covered":0,"skipped":0,"pct":0},"functions":{"total":114,"covered":0,"skipped":0,"pct":0},"statements":{"total":496,"covered":0,"skipped":0,"pct":0},"branches":{"total":219,"covered":0,"skipped":0,"pct":0}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/constants.ts": {"lines":{"total":8,"covered":0,"skipped":0,"pct":0},"functions":{"total":1,"covered":0,"skipped":0,"pct":0},"statements":{"total":8,"covered":0,"skipped":0,"pct":0},"branches":{"total":2,"covered":0,"skipped":0,"pct":0}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/create-auto-managed-network-client.ts": {"lines":{"total":52,"covered":0,"skipped":0,"pct":0},"functions":{"total":12,"covered":0,"skipped":0,"pct":0},"statements":{"total":52,"covered":0,"skipped":0,"pct":0},"branches":{"total":16,"covered":0,"skipped":0,"pct":0}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/create-network-client.ts": {"lines":{"total":73,"covered":0,"skipped":0,"pct":0},"functions":{"total":20,"covered":0,"skipped":0,"pct":0},"statements":{"total":74,"covered":0,"skipped":0,"pct":0},"branches":{"total":23,"covered":0,"skipped":0,"pct":0}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/logger.ts": {"lines":{"total":3,"covered":0,"skipped":0,"pct":0},"functions":{"total":1,"covered":0,"skipped":0,"pct":0},"statements":{"total":3,"covered":0,"skipped":0,"pct":0},"branches":{"total":0,"covered":0,"skipped":0,"pct":100}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/throttled-fetch.ts": {"lines":{"total":21,"covered":14,"skipped":0,"pct":66.66},"functions":{"total":6,"covered":4,"skipped":0,"pct":66.66},"statements":{"total":22,"covered":15,"skipped":0,"pct":68.18},"branches":{"total":7,"covered":5,"skipped":0,"pct":71.42}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/types.ts": {"lines":{"total":3,"covered":0,"skipped":0,"pct":0},"functions":{"total":1,"covered":0,"skipped":0,"pct":0},"statements":{"total":3,"covered":0,"skipped":0,"pct":0},"branches":{"total":2,"covered":0,"skipped":0,"pct":0}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/rpc-service/rpc-service-chain.ts": {"lines":{"total":79,"covered":0,"skipped":0,"pct":0},"functions":{"total":23,"covered":0,"skipped":0,"pct":0},"statements":{"total":82,"covered":0,"skipped":0,"pct":0},"branches":{"total":13,"covered":0,"skipped":0,"pct":0}}
+,"/Users/vincenthoward/Projects/Development/core/packages/network-controller/src/rpc-service/rpc-service.ts": {"lines":{"total":90,"covered":0,"skipped":0,"pct":0},"functions":{"total":23,"covered":0,"skipped":0,"pct":0},"statements":{"total":90,"covered":0,"skipped":0,"pct":0},"branches":{"total":47,"covered":0,"skipped":0,"pct":0}}
+}
diff --git a/coverage/favicon.png b/coverage/favicon.png
new file mode 100644
index 0000000000000000000000000000000000000000..c1525b811a167671e9de1fa78aab9f5c0b61cef7
--- /dev/null
+++ b/coverage/favicon.png
@@ -0,0 +1,3 @@
+ï¿½PNG
+
+   IHDR         ï¿½ï¿½h6  ï¿½IDATxï¿½ï¿½ï¿½Aï¿½pfTï¿½6ï¿½ï¿½vï¿½ï¿½qï¿½8Uï¿½ï¿½ï¿½F\Û¶m[ï¿½ï¿½ï¿½:ï¿½C\ï¿½ï¿½Dï¿½,ï¿½yï¿½ï¿½ï¿½/ bï¿½LIï¿½B>s1ï¿½/8z: oï¿½K.\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½I>|Ê¯ï¿½ï¿½Oï¿½bï¿½'ï¿½ï¿½ï¿½+ï¿½ï¿½ .W"!~ï¿½ï¿½Pï¿½ï¿½ï¿½ï¿½ï¿½ï¿½J	ï¿½ï¿½Iï¿½ï¿½Iï¿½ï¿½hï¿½ï¿½3ï¿½^ï¿½rsï¿½{ï¿½3pï¿½3ï¿½ï¿½ï¿½Ö½ï¿½ï¿½-ï¿½ï¿½ï¿½>!ï¿½ï¿½+ï¿½rï¿½Ãï¿½Mï¿½ï¿½-\ï¿½ï¿½t=ï¿½w4Þ¾&ï¿½DÍï¿½aï¿½ï¿½ï¿½ï¿½ï¿½ï¿½%ë¼šUÕ¼ï¿½*;Jï¿½ï¿½gï¿½ï¿½ï¿½fzï¿½ï¿½kï¿½ Kï¿½JMZï¿½ï¿½ï¿½ï¿½}ï¿½%2ï¿½Qï¿½ï¿½ï¿½ï¿½Uï¿½Xï¿½liEï¿½!ï¿½ï¿½dï¿½Pï¿½ï¿½h\Oï¿½Iï¿½ï¿½ï¿½>ï¿½ï¿½fJï¿½ï¿½Oiï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½( B|uï¿½`iï¿½zï¿½ï¿½|ï¿½ï¿½ï¿½ï¿½!fDï¿½PVï¿½ï¿½"%ï¿½ï¿½ï¿½ï¿½kI"ï¿½ï¿½gï¿½ï¿½%ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½hï¿½Hï¿½cï¿½Q`Fï¿½ï¿½ï¿½;ï¿½ï¿½ ?ï¿½ï¿½E    IENDï¿½B`ï¿½
\ No newline at end of file
diff --git a/coverage/index.html b/coverage/index.html
new file mode 100644
index 0000000000000000000000000000000000000000..c0d4401413559349848c4ba8a3420a4c1e3750dd
--- /dev/null
+++ b/coverage/index.html
@@ -0,0 +1,131 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for All files</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1>All files</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.8% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>15/830</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.51% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>5/329</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.99% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/201</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.69% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>14/825</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file low" data-value="src"><a href="src/index.html">src</a></td>
+	<td data-value="2.27" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 2%"></div><div class="cover-empty" style="width: 98%"></div></div>
+	</td>
+	<td data-value="2.27" class="pct low">2.27%</td>
+	<td data-value="658" class="abs low">15/658</td>
+	<td data-value="1.85" class="pct low">1.85%</td>
+	<td data-value="269" class="abs low">5/269</td>
+	<td data-value="2.58" class="pct low">2.58%</td>
+	<td data-value="155" class="abs low">4/155</td>
+	<td data-value="2.13" class="pct low">2.13%</td>
+	<td data-value="656" class="abs low">14/656</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="src/rpc-service"><a href="src/rpc-service/index.html">src/rpc-service</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="172" class="abs low">0/172</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="60" class="abs low">0/60</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="46" class="abs low">0/46</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="169" class="abs low">0/169</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/base.css b/coverage/lcov-report/base.css
new file mode 100644
index 0000000000000000000000000000000000000000..f418035b469aff23689a74c912849662f442aed4
--- /dev/null
+++ b/coverage/lcov-report/base.css
@@ -0,0 +1,224 @@
+body, html {
+  margin:0; padding: 0;
+  height: 100%;
+}
+body {
+    font-family: Helvetica Neue, Helvetica, Arial;
+    font-size: 14px;
+    color:#333;
+}
+.small { font-size: 12px; }
+*, *:after, *:before {
+  -webkit-box-sizing:border-box;
+     -moz-box-sizing:border-box;
+          box-sizing:border-box;
+  }
+h1 { font-size: 20px; margin: 0;}
+h2 { font-size: 14px; }
+pre {
+    font: 12px/1.4 Consolas, "Liberation Mono", Menlo, Courier, monospace;
+    margin: 0;
+    padding: 0;
+    -moz-tab-size: 2;
+    -o-tab-size:  2;
+    tab-size: 2;
+}
+a { color:#0074D9; text-decoration:none; }
+a:hover { text-decoration:underline; }
+.strong { font-weight: bold; }
+.space-top1 { padding: 10px 0 0 0; }
+.pad2y { padding: 20px 0; }
+.pad1y { padding: 10px 0; }
+.pad2x { padding: 0 20px; }
+.pad2 { padding: 20px; }
+.pad1 { padding: 10px; }
+.space-left2 { padding-left:55px; }
+.space-right2 { padding-right:20px; }
+.center { text-align:center; }
+.clearfix { display:block; }
+.clearfix:after {
+  content:'';
+  display:block;
+  height:0;
+  clear:both;
+  visibility:hidden;
+  }
+.fl { float: left; }
+@media only screen and (max-width:640px) {
+  .col3 { width:100%; max-width:100%; }
+  .hide-mobile { display:none!important; }
+}
+
+.quiet {
+  color: #7f7f7f;
+  color: rgba(0,0,0,0.5);
+}
+.quiet a { opacity: 0.7; }
+
+.fraction {
+  font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
+  font-size: 10px;
+  color: #555;
+  background: #E8E8E8;
+  padding: 4px 5px;
+  border-radius: 3px;
+  vertical-align: middle;
+}
+
+div.path a:link, div.path a:visited { color: #333; }
+table.coverage {
+  border-collapse: collapse;
+  margin: 10px 0 0 0;
+  padding: 0;
+}
+
+table.coverage td {
+  margin: 0;
+  padding: 0;
+  vertical-align: top;
+}
+table.coverage td.line-count {
+    text-align: right;
+    padding: 0 5px 0 20px;
+}
+table.coverage td.line-coverage {
+    text-align: right;
+    padding-right: 10px;
+    min-width:20px;
+}
+
+table.coverage td span.cline-any {
+    display: inline-block;
+    padding: 0 5px;
+    width: 100%;
+}
+.missing-if-branch {
+    display: inline-block;
+    margin-right: 5px;
+    border-radius: 3px;
+    position: relative;
+    padding: 0 4px;
+    background: #333;
+    color: yellow;
+}
+
+.skip-if-branch {
+    display: none;
+    margin-right: 10px;
+    position: relative;
+    padding: 0 4px;
+    background: #ccc;
+    color: white;
+}
+.missing-if-branch .typ, .skip-if-branch .typ {
+    color: inherit !important;
+}
+.coverage-summary {
+  border-collapse: collapse;
+  width: 100%;
+}
+.coverage-summary tr { border-bottom: 1px solid #bbb; }
+.keyline-all { border: 1px solid #ddd; }
+.coverage-summary td, .coverage-summary th { padding: 10px; }
+.coverage-summary tbody { border: 1px solid #bbb; }
+.coverage-summary td { border-right: 1px solid #bbb; }
+.coverage-summary td:last-child { border-right: none; }
+.coverage-summary th {
+  text-align: left;
+  font-weight: normal;
+  white-space: nowrap;
+}
+.coverage-summary th.file { border-right: none !important; }
+.coverage-summary th.pct { }
+.coverage-summary th.pic,
+.coverage-summary th.abs,
+.coverage-summary td.pct,
+.coverage-summary td.abs { text-align: right; }
+.coverage-summary td.file { white-space: nowrap;  }
+.coverage-summary td.pic { min-width: 120px !important;  }
+.coverage-summary tfoot td { }
+
+.coverage-summary .sorter {
+    height: 10px;
+    width: 7px;
+    display: inline-block;
+    margin-left: 0.5em;
+    background: url(sort-arrow-sprite.png) no-repeat scroll 0 0 transparent;
+}
+.coverage-summary .sorted .sorter {
+    background-position: 0 -20px;
+}
+.coverage-summary .sorted-desc .sorter {
+    background-position: 0 -10px;
+}
+.status-line {  height: 10px; }
+/* yellow */
+.cbranch-no { background: yellow !important; color: #111; }
+/* dark red */
+.red.solid, .status-line.low, .low .cover-fill { background:#C21F39 }
+.low .chart { border:1px solid #C21F39 }
+.highlighted,
+.highlighted .cstat-no, .highlighted .fstat-no, .highlighted .cbranch-no{
+  background: #C21F39 !important;
+}
+/* medium red */
+.cstat-no, .fstat-no, .cbranch-no, .cbranch-no { background:#F6C6CE }
+/* light red */
+.low, .cline-no { background:#FCE1E5 }
+/* light green */
+.high, .cline-yes { background:rgb(230,245,208) }
+/* medium green */
+.cstat-yes { background:rgb(161,215,106) }
+/* dark green */
+.status-line.high, .high .cover-fill { background:rgb(77,146,33) }
+.high .chart { border:1px solid rgb(77,146,33) }
+/* dark yellow (gold) */
+.status-line.medium, .medium .cover-fill { background: #f9cd0b; }
+.medium .chart { border:1px solid #f9cd0b; }
+/* light yellow */
+.medium { background: #fff4c2; }
+
+.cstat-skip { background: #ddd; color: #111; }
+.fstat-skip { background: #ddd; color: #111 !important; }
+.cbranch-skip { background: #ddd !important; color: #111; }
+
+span.cline-neutral { background: #eaeaea; }
+
+.coverage-summary td.empty {
+    opacity: .5;
+    padding-top: 4px;
+    padding-bottom: 4px;
+    line-height: 1;
+    color: #888;
+}
+
+.cover-fill, .cover-empty {
+  display:inline-block;
+  height: 12px;
+}
+.chart {
+  line-height: 0;
+}
+.cover-empty {
+    background: white;
+}
+.cover-full {
+    border-right: none !important;
+}
+pre.prettyprint {
+    border: none !important;
+    padding: 0 !important;
+    margin: 0 !important;
+}
+.com { color: #999 !important; }
+.ignore-none { color: #999; font-weight: normal; }
+
+.wrapper {
+  min-height: 100%;
+  height: auto !important;
+  height: 100%;
+  margin: 0 auto -48px;
+}
+.footer, .push {
+  height: 48px;
+}
diff --git a/coverage/lcov-report/block-navigation.js b/coverage/lcov-report/block-navigation.js
new file mode 100644
index 0000000000000000000000000000000000000000..cc121302316c8faaaebfd6a15f4212d99e563199
--- /dev/null
+++ b/coverage/lcov-report/block-navigation.js
@@ -0,0 +1,87 @@
+/* eslint-disable */
+var jumpToCode = (function init() {
+    // Classes of code we would like to highlight in the file view
+    var missingCoverageClasses = ['.cbranch-no', '.cstat-no', '.fstat-no'];
+
+    // Elements to highlight in the file listing view
+    var fileListingElements = ['td.pct.low'];
+
+    // We don't want to select elements that are direct descendants of another match
+    var notSelector = ':not(' + missingCoverageClasses.join('):not(') + ') > '; // becomes `:not(a):not(b) > `
+
+    // Selecter that finds elements on the page to which we can jump
+    var selector =
+        fileListingElements.join(', ') +
+        ', ' +
+        notSelector +
+        missingCoverageClasses.join(', ' + notSelector); // becomes `:not(a):not(b) > a, :not(a):not(b) > b`
+
+    // The NodeList of matching elements
+    var missingCoverageElements = document.querySelectorAll(selector);
+
+    var currentIndex;
+
+    function toggleClass(index) {
+        missingCoverageElements
+            .item(currentIndex)
+            .classList.remove('highlighted');
+        missingCoverageElements.item(index).classList.add('highlighted');
+    }
+
+    function makeCurrent(index) {
+        toggleClass(index);
+        currentIndex = index;
+        missingCoverageElements.item(index).scrollIntoView({
+            behavior: 'smooth',
+            block: 'center',
+            inline: 'center'
+        });
+    }
+
+    function goToPrevious() {
+        var nextIndex = 0;
+        if (typeof currentIndex !== 'number' || currentIndex === 0) {
+            nextIndex = missingCoverageElements.length - 1;
+        } else if (missingCoverageElements.length > 1) {
+            nextIndex = currentIndex - 1;
+        }
+
+        makeCurrent(nextIndex);
+    }
+
+    function goToNext() {
+        var nextIndex = 0;
+
+        if (
+            typeof currentIndex === 'number' &&
+            currentIndex < missingCoverageElements.length - 1
+        ) {
+            nextIndex = currentIndex + 1;
+        }
+
+        makeCurrent(nextIndex);
+    }
+
+    return function jump(event) {
+        if (
+            document.getElementById('fileSearch') === document.activeElement &&
+            document.activeElement != null
+        ) {
+            // if we're currently focused on the search input, we don't want to navigate
+            return;
+        }
+
+        switch (event.which) {
+            case 78: // n
+            case 74: // j
+                goToNext();
+                break;
+            case 66: // b
+            case 75: // k
+            case 80: // p
+                goToPrevious();
+                break;
+        }
+    };
+})();
+window.addEventListener('keydown', jumpToCode);
diff --git a/coverage/lcov-report/favicon.png b/coverage/lcov-report/favicon.png
new file mode 100644
index 0000000000000000000000000000000000000000..c1525b811a167671e9de1fa78aab9f5c0b61cef7
--- /dev/null
+++ b/coverage/lcov-report/favicon.png
@@ -0,0 +1,3 @@
+ï¿½PNG
+
+   IHDR         ï¿½ï¿½h6  ï¿½IDATxï¿½ï¿½ï¿½Aï¿½pfTï¿½6ï¿½ï¿½vï¿½ï¿½qï¿½8Uï¿½ï¿½ï¿½F\Û¶m[ï¿½ï¿½ï¿½:ï¿½C\ï¿½ï¿½Dï¿½,ï¿½yï¿½ï¿½ï¿½/ bï¿½LIï¿½B>s1ï¿½/8z: oï¿½K.\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½I>|Ê¯ï¿½ï¿½Oï¿½bï¿½'ï¿½ï¿½ï¿½+ï¿½ï¿½ .W"!~ï¿½ï¿½Pï¿½ï¿½ï¿½ï¿½ï¿½ï¿½J	ï¿½ï¿½Iï¿½ï¿½Iï¿½ï¿½hï¿½ï¿½3ï¿½^ï¿½rsï¿½{ï¿½3pï¿½3ï¿½ï¿½ï¿½Ö½ï¿½ï¿½-ï¿½ï¿½ï¿½>!ï¿½ï¿½+ï¿½rï¿½Ãï¿½Mï¿½ï¿½-\ï¿½ï¿½t=ï¿½w4Þ¾&ï¿½DÍï¿½aï¿½ï¿½ï¿½ï¿½ï¿½ï¿½%ë¼šUÕ¼ï¿½*;Jï¿½ï¿½gï¿½ï¿½ï¿½fzï¿½ï¿½kï¿½ Kï¿½JMZï¿½ï¿½ï¿½ï¿½}ï¿½%2ï¿½Qï¿½ï¿½ï¿½ï¿½Uï¿½Xï¿½liEï¿½!ï¿½ï¿½dï¿½Pï¿½ï¿½h\Oï¿½Iï¿½ï¿½ï¿½>ï¿½ï¿½fJï¿½ï¿½Oiï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½( B|uï¿½`iï¿½zï¿½ï¿½|ï¿½ï¿½ï¿½ï¿½!fDï¿½PVï¿½ï¿½"%ï¿½ï¿½ï¿½ï¿½kI"ï¿½ï¿½gï¿½ï¿½%ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½hï¿½Hï¿½cï¿½Q`Fï¿½ï¿½ï¿½;ï¿½ï¿½ ?ï¿½ï¿½E    IENDï¿½B`ï¿½
\ No newline at end of file
diff --git a/coverage/lcov-report/index.html b/coverage/lcov-report/index.html
new file mode 100644
index 0000000000000000000000000000000000000000..ae74468137b08edd46a66df455e325955df13d7b
--- /dev/null
+++ b/coverage/lcov-report/index.html
@@ -0,0 +1,131 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for All files</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="prettify.css" />
+    <link rel="stylesheet" href="base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1>All files</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.8% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>15/830</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.51% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>5/329</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.99% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/201</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.69% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>14/825</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file low" data-value="src"><a href="src/index.html">src</a></td>
+	<td data-value="2.27" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 2%"></div><div class="cover-empty" style="width: 98%"></div></div>
+	</td>
+	<td data-value="2.27" class="pct low">2.27%</td>
+	<td data-value="658" class="abs low">15/658</td>
+	<td data-value="1.85" class="pct low">1.85%</td>
+	<td data-value="269" class="abs low">5/269</td>
+	<td data-value="2.58" class="pct low">2.58%</td>
+	<td data-value="155" class="abs low">4/155</td>
+	<td data-value="2.13" class="pct low">2.13%</td>
+	<td data-value="656" class="abs low">14/656</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="src/rpc-service"><a href="src/rpc-service/index.html">src/rpc-service</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="172" class="abs low">0/172</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="60" class="abs low">0/60</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="46" class="abs low">0/46</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="169" class="abs low">0/169</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="sorter.js"></script>
+        <script src="block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/prettify.css b/coverage/lcov-report/prettify.css
new file mode 100644
index 0000000000000000000000000000000000000000..b317a7cda31a440fbd47540297ee3c68d51f343e
--- /dev/null
+++ b/coverage/lcov-report/prettify.css
@@ -0,0 +1 @@
+.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}pre.prettyprint{padding:2px;border:1px solid #888}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
diff --git a/coverage/lcov-report/prettify.js b/coverage/lcov-report/prettify.js
new file mode 100644
index 0000000000000000000000000000000000000000..b3225238f26e3ab49a5e41e9cb287a73c82740b7
--- /dev/null
+++ b/coverage/lcov-report/prettify.js
@@ -0,0 +1,2 @@
+/* eslint-disable */
+window.PR_SHOULD_USE_CONTINUATION=true;(function(){var h=["break,continue,do,else,for,if,return,while"];var u=[h,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"];var p=[u,"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"];var l=[p,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"];var x=[p,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"];var R=[x,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"];var r="all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes";var w=[p,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"];var s="caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END";var I=[h,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"];var f=[h,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"];var H=[h,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"];var A=[l,R,w,s+I,f,H];var e=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/;var C="str";var z="kwd";var j="com";var O="typ";var G="lit";var L="pun";var F="pln";var m="tag";var E="dec";var J="src";var P="atn";var n="atv";var N="nocode";var M="(?:^^\\.?|[+-]|\\!|\\!=|\\!==|\\#|\\%|\\%=|&|&&|&&=|&=|\\(|\\*|\\*=|\\+=|\\,|\\-=|\\->|\\/|\\/=|:|::|\\;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\@|\\[|\\^|\\^=|\\^\\^|\\^\\^=|\\{|\\||\\|=|\\|\\||\\|\\|=|\\~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*";function k(Z){var ad=0;var S=false;var ac=false;for(var V=0,U=Z.length;V<U;++V){var ae=Z[V];if(ae.ignoreCase){ac=true}else{if(/[a-z]/i.test(ae.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,""))){S=true;ac=false;break}}}var Y={b:8,t:9,n:10,v:11,f:12,r:13};function ab(ah){var ag=ah.charCodeAt(0);if(ag!==92){return ag}var af=ah.charAt(1);ag=Y[af];if(ag){return ag}else{if("0"<=af&&af<="7"){return parseInt(ah.substring(1),8)}else{if(af==="u"||af==="x"){return parseInt(ah.substring(2),16)}else{return ah.charCodeAt(1)}}}}function T(af){if(af<32){return(af<16?"\\x0":"\\x")+af.toString(16)}var ag=String.fromCharCode(af);if(ag==="\\"||ag==="-"||ag==="["||ag==="]"){ag="\\"+ag}return ag}function X(am){var aq=am.substring(1,am.length-1).match(new RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\[0-3][0-7]{0,2}|\\\\[0-7]{1,2}|\\\\[\\s\\S]|-|[^-\\\\]","g"));var ak=[];var af=[];var ao=aq[0]==="^";for(var ar=ao?1:0,aj=aq.length;ar<aj;++ar){var ah=aq[ar];if(/\\[bdsw]/i.test(ah)){ak.push(ah)}else{var ag=ab(ah);var al;if(ar+2<aj&&"-"===aq[ar+1]){al=ab(aq[ar+2]);ar+=2}else{al=ag}af.push([ag,al]);if(!(al<65||ag>122)){if(!(al<65||ag>90)){af.push([Math.max(65,ag)|32,Math.min(al,90)|32])}if(!(al<97||ag>122)){af.push([Math.max(97,ag)&~32,Math.min(al,122)&~32])}}}}af.sort(function(av,au){return(av[0]-au[0])||(au[1]-av[1])});var ai=[];var ap=[NaN,NaN];for(var ar=0;ar<af.length;++ar){var at=af[ar];if(at[0]<=ap[1]+1){ap[1]=Math.max(ap[1],at[1])}else{ai.push(ap=at)}}var an=["["];if(ao){an.push("^")}an.push.apply(an,ak);for(var ar=0;ar<ai.length;++ar){var at=ai[ar];an.push(T(at[0]));if(at[1]>at[0]){if(at[1]+1>at[0]){an.push("-")}an.push(T(at[1]))}}an.push("]");return an.join("")}function W(al){var aj=al.source.match(new RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!=]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g"));var ah=aj.length;var an=[];for(var ak=0,am=0;ak<ah;++ak){var ag=aj[ak];if(ag==="("){++am}else{if("\\"===ag.charAt(0)){var af=+ag.substring(1);if(af&&af<=am){an[af]=-1}}}}for(var ak=1;ak<an.length;++ak){if(-1===an[ak]){an[ak]=++ad}}for(var ak=0,am=0;ak<ah;++ak){var ag=aj[ak];if(ag==="("){++am;if(an[am]===undefined){aj[ak]="(?:"}}else{if("\\"===ag.charAt(0)){var af=+ag.substring(1);if(af&&af<=am){aj[ak]="\\"+an[am]}}}}for(var ak=0,am=0;ak<ah;++ak){if("^"===aj[ak]&&"^"!==aj[ak+1]){aj[ak]=""}}if(al.ignoreCase&&S){for(var ak=0;ak<ah;++ak){var ag=aj[ak];var ai=ag.charAt(0);if(ag.length>=2&&ai==="["){aj[ak]=X(ag)}else{if(ai!=="\\"){aj[ak]=ag.replace(/[a-zA-Z]/g,function(ao){var ap=ao.charCodeAt(0);return"["+String.fromCharCode(ap&~32,ap|32)+"]"})}}}}return aj.join("")}var aa=[];for(var V=0,U=Z.length;V<U;++V){var ae=Z[V];if(ae.global||ae.multiline){throw new Error(""+ae)}aa.push("(?:"+W(ae)+")")}return new RegExp(aa.join("|"),ac?"gi":"g")}function a(V){var U=/(?:^|\s)nocode(?:\s|$)/;var X=[];var T=0;var Z=[];var W=0;var S;if(V.currentStyle){S=V.currentStyle.whiteSpace}else{if(window.getComputedStyle){S=document.defaultView.getComputedStyle(V,null).getPropertyValue("white-space")}}var Y=S&&"pre"===S.substring(0,3);function aa(ab){switch(ab.nodeType){case 1:if(U.test(ab.className)){return}for(var ae=ab.firstChild;ae;ae=ae.nextSibling){aa(ae)}var ad=ab.nodeName;if("BR"===ad||"LI"===ad){X[W]="\n";Z[W<<1]=T++;Z[(W++<<1)|1]=ab}break;case 3:case 4:var ac=ab.nodeValue;if(ac.length){if(!Y){ac=ac.replace(/[ \t\r\n]+/g," ")}else{ac=ac.replace(/\r\n?/g,"\n")}X[W]=ac;Z[W<<1]=T;T+=ac.length;Z[(W++<<1)|1]=ab}break}}aa(V);return{sourceCode:X.join("").replace(/\n$/,""),spans:Z}}function B(S,U,W,T){if(!U){return}var V={sourceCode:U,basePos:S};W(V);T.push.apply(T,V.decorations)}var v=/\S/;function o(S){var V=undefined;for(var U=S.firstChild;U;U=U.nextSibling){var T=U.nodeType;V=(T===1)?(V?S:U):(T===3)?(v.test(U.nodeValue)?S:V):V}return V===S?undefined:V}function g(U,T){var S={};var V;(function(){var ad=U.concat(T);var ah=[];var ag={};for(var ab=0,Z=ad.length;ab<Z;++ab){var Y=ad[ab];var ac=Y[3];if(ac){for(var ae=ac.length;--ae>=0;){S[ac.charAt(ae)]=Y}}var af=Y[1];var aa=""+af;if(!ag.hasOwnProperty(aa)){ah.push(af);ag[aa]=null}}ah.push(/[\0-\uffff]/);V=k(ah)})();var X=T.length;var W=function(ah){var Z=ah.sourceCode,Y=ah.basePos;var ad=[Y,F];var af=0;var an=Z.match(V)||[];var aj={};for(var ae=0,aq=an.length;ae<aq;++ae){var ag=an[ae];var ap=aj[ag];var ai=void 0;var am;if(typeof ap==="string"){am=false}else{var aa=S[ag.charAt(0)];if(aa){ai=ag.match(aa[1]);ap=aa[0]}else{for(var ao=0;ao<X;++ao){aa=T[ao];ai=ag.match(aa[1]);if(ai){ap=aa[0];break}}if(!ai){ap=F}}am=ap.length>=5&&"lang-"===ap.substring(0,5);if(am&&!(ai&&typeof ai[1]==="string")){am=false;ap=J}if(!am){aj[ag]=ap}}var ab=af;af+=ag.length;if(!am){ad.push(Y+ab,ap)}else{var al=ai[1];var ak=ag.indexOf(al);var ac=ak+al.length;if(ai[2]){ac=ag.length-ai[2].length;ak=ac-al.length}var ar=ap.substring(5);B(Y+ab,ag.substring(0,ak),W,ad);B(Y+ab+ak,al,q(ar,al),ad);B(Y+ab+ac,ag.substring(ac),W,ad)}}ah.decorations=ad};return W}function i(T){var W=[],S=[];if(T.tripleQuotedStrings){W.push([C,/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,null,"'\""])}else{if(T.multiLineStrings){W.push([C,/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"])}else{W.push([C,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"])}}if(T.verbatimStrings){S.push([C,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null])}var Y=T.hashComments;if(Y){if(T.cStyleComments){if(Y>1){W.push([j,/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,null,"#"])}else{W.push([j,/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"])}S.push([C,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,null])}else{W.push([j,/^#[^\r\n]*/,null,"#"])}}if(T.cStyleComments){S.push([j,/^\/\/[^\r\n]*/,null]);S.push([j,/^\/\*[\s\S]*?(?:\*\/|$)/,null])}if(T.regexLiterals){var X=("/(?=[^/*])(?:[^/\\x5B\\x5C]|\\x5C[\\s\\S]|\\x5B(?:[^\\x5C\\x5D]|\\x5C[\\s\\S])*(?:\\x5D|$))+/");S.push(["lang-regex",new RegExp("^"+M+"("+X+")")])}var V=T.types;if(V){S.push([O,V])}var U=(""+T.keywords).replace(/^ | $/g,"");if(U.length){S.push([z,new RegExp("^(?:"+U.replace(/[\s,]+/g,"|")+")\\b"),null])}W.push([F,/^\s+/,null," \r\n\t\xA0"]);S.push([G,/^@[a-z_$][a-z_$@0-9]*/i,null],[O,/^(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null],[F,/^[a-z_$][a-z_$@0-9]*/i,null],[G,new RegExp("^(?:0x[a-f0-9]+|(?:\\d(?:_\\d+)*\\d*(?:\\.\\d*)?|\\.\\d\\+)(?:e[+\\-]?\\d+)?)[a-z]*","i"),null,"0123456789"],[F,/^\\[\s\S]?/,null],[L,/^.[^\s\w\.$@\'\"\`\/\#\\]*/,null]);return g(W,S)}var K=i({keywords:A,hashComments:true,cStyleComments:true,multiLineStrings:true,regexLiterals:true});function Q(V,ag){var U=/(?:^|\s)nocode(?:\s|$)/;var ab=/\r\n?|\n/;var ac=V.ownerDocument;var S;if(V.currentStyle){S=V.currentStyle.whiteSpace}else{if(window.getComputedStyle){S=ac.defaultView.getComputedStyle(V,null).getPropertyValue("white-space")}}var Z=S&&"pre"===S.substring(0,3);var af=ac.createElement("LI");while(V.firstChild){af.appendChild(V.firstChild)}var W=[af];function ae(al){switch(al.nodeType){case 1:if(U.test(al.className)){break}if("BR"===al.nodeName){ad(al);if(al.parentNode){al.parentNode.removeChild(al)}}else{for(var an=al.firstChild;an;an=an.nextSibling){ae(an)}}break;case 3:case 4:if(Z){var am=al.nodeValue;var aj=am.match(ab);if(aj){var ai=am.substring(0,aj.index);al.nodeValue=ai;var ah=am.substring(aj.index+aj[0].length);if(ah){var ak=al.parentNode;ak.insertBefore(ac.createTextNode(ah),al.nextSibling)}ad(al);if(!ai){al.parentNode.removeChild(al)}}}break}}function ad(ak){while(!ak.nextSibling){ak=ak.parentNode;if(!ak){return}}function ai(al,ar){var aq=ar?al.cloneNode(false):al;var ao=al.parentNode;if(ao){var ap=ai(ao,1);var an=al.nextSibling;ap.appendChild(aq);for(var am=an;am;am=an){an=am.nextSibling;ap.appendChild(am)}}return aq}var ah=ai(ak.nextSibling,0);for(var aj;(aj=ah.parentNode)&&aj.nodeType===1;){ah=aj}W.push(ah)}for(var Y=0;Y<W.length;++Y){ae(W[Y])}if(ag===(ag|0)){W[0].setAttribute("value",ag)}var aa=ac.createElement("OL");aa.className="linenums";var X=Math.max(0,((ag-1))|0)||0;for(var Y=0,T=W.length;Y<T;++Y){af=W[Y];af.className="L"+((Y+X)%10);if(!af.firstChild){af.appendChild(ac.createTextNode("\xA0"))}aa.appendChild(af)}V.appendChild(aa)}function D(ac){var aj=/\bMSIE\b/.test(navigator.userAgent);var am=/\n/g;var al=ac.sourceCode;var an=al.length;var V=0;var aa=ac.spans;var T=aa.length;var ah=0;var X=ac.decorations;var Y=X.length;var Z=0;X[Y]=an;var ar,aq;for(aq=ar=0;aq<Y;){if(X[aq]!==X[aq+2]){X[ar++]=X[aq++];X[ar++]=X[aq++]}else{aq+=2}}Y=ar;for(aq=ar=0;aq<Y;){var at=X[aq];var ab=X[aq+1];var W=aq+2;while(W+2<=Y&&X[W+1]===ab){W+=2}X[ar++]=at;X[ar++]=ab;aq=W}Y=X.length=ar;var ae=null;while(ah<T){var af=aa[ah];var S=aa[ah+2]||an;var ag=X[Z];var ap=X[Z+2]||an;var W=Math.min(S,ap);var ak=aa[ah+1];var U;if(ak.nodeType!==1&&(U=al.substring(V,W))){if(aj){U=U.replace(am,"\r")}ak.nodeValue=U;var ai=ak.ownerDocument;var ao=ai.createElement("SPAN");ao.className=X[Z+1];var ad=ak.parentNode;ad.replaceChild(ao,ak);ao.appendChild(ak);if(V<S){aa[ah+1]=ak=ai.createTextNode(al.substring(W,S));ad.insertBefore(ak,ao.nextSibling)}}V=W;if(V>=S){ah+=2}if(V>=ap){Z+=2}}}var t={};function c(U,V){for(var S=V.length;--S>=0;){var T=V[S];if(!t.hasOwnProperty(T)){t[T]=U}else{if(window.console){console.warn("cannot override language handler %s",T)}}}}function q(T,S){if(!(T&&t.hasOwnProperty(T))){T=/^\s*</.test(S)?"default-markup":"default-code"}return t[T]}c(K,["default-code"]);c(g([],[[F,/^[^<?]+/],[E,/^<!\w[^>]*(?:>|$)/],[j,/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],[L,/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]);c(g([[F,/^[\s]+/,null," \t\r\n"],[n,/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[[m,/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],[P,/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],[L,/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]);c(g([],[[n,/^[\s\S]+/]]),["uq.val"]);c(i({keywords:l,hashComments:true,cStyleComments:true,types:e}),["c","cc","cpp","cxx","cyc","m"]);c(i({keywords:"null,true,false"}),["json"]);c(i({keywords:R,hashComments:true,cStyleComments:true,verbatimStrings:true,types:e}),["cs"]);c(i({keywords:x,cStyleComments:true}),["java"]);c(i({keywords:H,hashComments:true,multiLineStrings:true}),["bsh","csh","sh"]);c(i({keywords:I,hashComments:true,multiLineStrings:true,tripleQuotedStrings:true}),["cv","py"]);c(i({keywords:s,hashComments:true,multiLineStrings:true,regexLiterals:true}),["perl","pl","pm"]);c(i({keywords:f,hashComments:true,multiLineStrings:true,regexLiterals:true}),["rb"]);c(i({keywords:w,cStyleComments:true,regexLiterals:true}),["js"]);c(i({keywords:r,hashComments:3,cStyleComments:true,multilineStrings:true,tripleQuotedStrings:true,regexLiterals:true}),["coffee"]);c(g([],[[C,/^[\s\S]+/]]),["regex"]);function d(V){var U=V.langExtension;try{var S=a(V.sourceNode);var T=S.sourceCode;V.sourceCode=T;V.spans=S.spans;V.basePos=0;q(U,T)(V);D(V)}catch(W){if("console" in window){console.log(W&&W.stack?W.stack:W)}}}function y(W,V,U){var S=document.createElement("PRE");S.innerHTML=W;if(U){Q(S,U)}var T={langExtension:V,numberLines:U,sourceNode:S};d(T);return S.innerHTML}function b(ad){function Y(af){return document.getElementsByTagName(af)}var ac=[Y("pre"),Y("code"),Y("xmp")];var T=[];for(var aa=0;aa<ac.length;++aa){for(var Z=0,V=ac[aa].length;Z<V;++Z){T.push(ac[aa][Z])}}ac=null;var W=Date;if(!W.now){W={now:function(){return +(new Date)}}}var X=0;var S;var ab=/\blang(?:uage)?-([\w.]+)(?!\S)/;var ae=/\bprettyprint\b/;function U(){var ag=(window.PR_SHOULD_USE_CONTINUATION?W.now()+250:Infinity);for(;X<T.length&&W.now()<ag;X++){var aj=T[X];var ai=aj.className;if(ai.indexOf("prettyprint")>=0){var ah=ai.match(ab);var am;if(!ah&&(am=o(aj))&&"CODE"===am.tagName){ah=am.className.match(ab)}if(ah){ah=ah[1]}var al=false;for(var ak=aj.parentNode;ak;ak=ak.parentNode){if((ak.tagName==="pre"||ak.tagName==="code"||ak.tagName==="xmp")&&ak.className&&ak.className.indexOf("prettyprint")>=0){al=true;break}}if(!al){var af=aj.className.match(/\blinenums\b(?::(\d+))?/);af=af?af[1]&&af[1].length?+af[1]:true:false;if(af){Q(aj,af)}S={langExtension:ah,sourceNode:aj,numberLines:af};d(S)}}}if(X<T.length){setTimeout(U,250)}else{if(ad){ad()}}}U()}window.prettyPrintOne=y;window.prettyPrint=b;window.PR={createSimpleLexer:g,registerLangHandler:c,sourceDecorator:i,PR_ATTRIB_NAME:P,PR_ATTRIB_VALUE:n,PR_COMMENT:j,PR_DECLARATION:E,PR_KEYWORD:z,PR_LITERAL:G,PR_NOCODE:N,PR_PLAIN:F,PR_PUNCTUATION:L,PR_SOURCE:J,PR_STRING:C,PR_TAG:m,PR_TYPE:O}})();PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_DECLARATION,/^<!\w[^>]*(?:>|$)/],[PR.PR_COMMENT,/^<\!--[\s\S]*?(?:-\->|$)/],[PR.PR_PUNCTUATION,/^(?:<[%?]|[%?]>)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-handlebars",/^<script\b[^>]*type\s*=\s*['"]?text\/x-handlebars-template['"]?\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i],[PR.PR_DECLARATION,/^{{[#^>/]?\s*[\w.][^}]*}}/],[PR.PR_DECLARATION,/^{{&?\s*[\w.][^}]*}}/],[PR.PR_DECLARATION,/^{{{>?\s*[\w.][^}]*}}}/],[PR.PR_COMMENT,/^{{![^}]*}}/]]),["handlebars","hbs"]);PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[ \t\r\n\f]+/,null," \t\r\n\f"]],[[PR.PR_STRING,/^\"(?:[^\n\r\f\\\"]|\\(?:\r\n?|\n|\f)|\\[\s\S])*\"/,null],[PR.PR_STRING,/^\'(?:[^\n\r\f\\\']|\\(?:\r\n?|\n|\f)|\\[\s\S])*\'/,null],["lang-css-str",/^url\(([^\)\"\']*)\)/i],[PR.PR_KEYWORD,/^(?:url|rgb|\!important|@import|@page|@media|@charset|inherit)(?=[^\-\w]|$)/i,null],["lang-css-kw",/^(-?(?:[_a-z]|(?:\\[0-9a-f]+ ?))(?:[_a-z0-9\-]|\\(?:\\[0-9a-f]+ ?))*)\s*:/i],[PR.PR_COMMENT,/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],[PR.PR_COMMENT,/^(?:<!--|-->)/],[PR.PR_LITERAL,/^(?:\d+|\d*\.\d+)(?:%|[a-z]+)?/i],[PR.PR_LITERAL,/^#(?:[0-9a-f]{3}){1,2}/i],[PR.PR_PLAIN,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i],[PR.PR_PUNCTUATION,/^[^\s\w\'\"]+/]]),["css"]);PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_KEYWORD,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i]]),["css-kw"]);PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_STRING,/^[^\)\"\']+/]]),["css-str"]);
diff --git a/coverage/lcov-report/sort-arrow-sprite.png b/coverage/lcov-report/sort-arrow-sprite.png
new file mode 100644
index 0000000000000000000000000000000000000000..6ed68316eb3f65dec9063332d2f69bf3093bbfab
--- /dev/null
+++ b/coverage/lcov-report/sort-arrow-sprite.png
@@ -0,0 +1,3 @@
+ï¿½PNG
+
+   IHDR         ï¿½Fï¿½3   QIDATxcp/ï¿½ï¿½c 0Fï¿½Hï¿½0LE]Xï¿½Ä‰ï¿½J6ï¿½Aï¿½ï¿½ï¿½2ï¿½ï¿½Ç…ï¿½*0%`ï¿½b(ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½B0pï¿½ï¿½ Nã¤¸ï¿½ï¿½xï¿½    IENDï¿½B`ï¿½
\ No newline at end of file
diff --git a/coverage/lcov-report/sorter.js b/coverage/lcov-report/sorter.js
new file mode 100644
index 0000000000000000000000000000000000000000..2bb296a8ca8e48e468f22b92250b9fe2518b8cfc
--- /dev/null
+++ b/coverage/lcov-report/sorter.js
@@ -0,0 +1,196 @@
+/* eslint-disable */
+var addSorting = (function() {
+    'use strict';
+    var cols,
+        currentSort = {
+            index: 0,
+            desc: false
+        };
+
+    // returns the summary table element
+    function getTable() {
+        return document.querySelector('.coverage-summary');
+    }
+    // returns the thead element of the summary table
+    function getTableHeader() {
+        return getTable().querySelector('thead tr');
+    }
+    // returns the tbody element of the summary table
+    function getTableBody() {
+        return getTable().querySelector('tbody');
+    }
+    // returns the th element for nth column
+    function getNthColumn(n) {
+        return getTableHeader().querySelectorAll('th')[n];
+    }
+
+    function onFilterInput() {
+        const searchValue = document.getElementById('fileSearch').value;
+        const rows = document.getElementsByTagName('tbody')[0].children;
+        for (let i = 0; i < rows.length; i++) {
+            const row = rows[i];
+            if (
+                row.textContent
+                    .toLowerCase()
+                    .includes(searchValue.toLowerCase())
+            ) {
+                row.style.display = '';
+            } else {
+                row.style.display = 'none';
+            }
+        }
+    }
+
+    // loads the search box
+    function addSearchBox() {
+        var template = document.getElementById('filterTemplate');
+        var templateClone = template.content.cloneNode(true);
+        templateClone.getElementById('fileSearch').oninput = onFilterInput;
+        template.parentElement.appendChild(templateClone);
+    }
+
+    // loads all columns
+    function loadColumns() {
+        var colNodes = getTableHeader().querySelectorAll('th'),
+            colNode,
+            cols = [],
+            col,
+            i;
+
+        for (i = 0; i < colNodes.length; i += 1) {
+            colNode = colNodes[i];
+            col = {
+                key: colNode.getAttribute('data-col'),
+                sortable: !colNode.getAttribute('data-nosort'),
+                type: colNode.getAttribute('data-type') || 'string'
+            };
+            cols.push(col);
+            if (col.sortable) {
+                col.defaultDescSort = col.type === 'number';
+                colNode.innerHTML =
+                    colNode.innerHTML + '<span class="sorter"></span>';
+            }
+        }
+        return cols;
+    }
+    // attaches a data attribute to every tr element with an object
+    // of data values keyed by column name
+    function loadRowData(tableRow) {
+        var tableCols = tableRow.querySelectorAll('td'),
+            colNode,
+            col,
+            data = {},
+            i,
+            val;
+        for (i = 0; i < tableCols.length; i += 1) {
+            colNode = tableCols[i];
+            col = cols[i];
+            val = colNode.getAttribute('data-value');
+            if (col.type === 'number') {
+                val = Number(val);
+            }
+            data[col.key] = val;
+        }
+        return data;
+    }
+    // loads all row data
+    function loadData() {
+        var rows = getTableBody().querySelectorAll('tr'),
+            i;
+
+        for (i = 0; i < rows.length; i += 1) {
+            rows[i].data = loadRowData(rows[i]);
+        }
+    }
+    // sorts the table using the data for the ith column
+    function sortByIndex(index, desc) {
+        var key = cols[index].key,
+            sorter = function(a, b) {
+                a = a.data[key];
+                b = b.data[key];
+                return a < b ? -1 : a > b ? 1 : 0;
+            },
+            finalSorter = sorter,
+            tableBody = document.querySelector('.coverage-summary tbody'),
+            rowNodes = tableBody.querySelectorAll('tr'),
+            rows = [],
+            i;
+
+        if (desc) {
+            finalSorter = function(a, b) {
+                return -1 * sorter(a, b);
+            };
+        }
+
+        for (i = 0; i < rowNodes.length; i += 1) {
+            rows.push(rowNodes[i]);
+            tableBody.removeChild(rowNodes[i]);
+        }
+
+        rows.sort(finalSorter);
+
+        for (i = 0; i < rows.length; i += 1) {
+            tableBody.appendChild(rows[i]);
+        }
+    }
+    // removes sort indicators for current column being sorted
+    function removeSortIndicators() {
+        var col = getNthColumn(currentSort.index),
+            cls = col.className;
+
+        cls = cls.replace(/ sorted$/, '').replace(/ sorted-desc$/, '');
+        col.className = cls;
+    }
+    // adds sort indicators for current column being sorted
+    function addSortIndicators() {
+        getNthColumn(currentSort.index).className += currentSort.desc
+            ? ' sorted-desc'
+            : ' sorted';
+    }
+    // adds event listeners for all sorter widgets
+    function enableUI() {
+        var i,
+            el,
+            ithSorter = function ithSorter(i) {
+                var col = cols[i];
+
+                return function() {
+                    var desc = col.defaultDescSort;
+
+                    if (currentSort.index === i) {
+                        desc = !currentSort.desc;
+                    }
+                    sortByIndex(i, desc);
+                    removeSortIndicators();
+                    currentSort.index = i;
+                    currentSort.desc = desc;
+                    addSortIndicators();
+                };
+            };
+        for (i = 0; i < cols.length; i += 1) {
+            if (cols[i].sortable) {
+                // add the click event handler on the th so users
+                // dont have to click on those tiny arrows
+                el = getNthColumn(i).querySelector('.sorter').parentElement;
+                if (el.addEventListener) {
+                    el.addEventListener('click', ithSorter(i));
+                } else {
+                    el.attachEvent('onclick', ithSorter(i));
+                }
+            }
+        }
+    }
+    // adds sorting functionality to the UI
+    return function() {
+        if (!getTable()) {
+            return;
+        }
+        cols = loadColumns();
+        loadData();
+        addSearchBox();
+        addSortIndicators();
+        enableUI();
+    };
+})();
+
+window.addEventListener('load', addSorting);
diff --git a/coverage/lcov-report/src/NetworkController.ts.html b/coverage/lcov-report/src/NetworkController.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..1f2422228a940b887eb7db0a58279be5f9c6b52e
--- /dev/null
+++ b/coverage/lcov-report/src/NetworkController.ts.html
@@ -0,0 +1,10153 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/NetworkController.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> NetworkController.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/496</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/219</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/114</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/496</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a>
+<a name='L483'></a><a href='#L483'>483</a>
+<a name='L484'></a><a href='#L484'>484</a>
+<a name='L485'></a><a href='#L485'>485</a>
+<a name='L486'></a><a href='#L486'>486</a>
+<a name='L487'></a><a href='#L487'>487</a>
+<a name='L488'></a><a href='#L488'>488</a>
+<a name='L489'></a><a href='#L489'>489</a>
+<a name='L490'></a><a href='#L490'>490</a>
+<a name='L491'></a><a href='#L491'>491</a>
+<a name='L492'></a><a href='#L492'>492</a>
+<a name='L493'></a><a href='#L493'>493</a>
+<a name='L494'></a><a href='#L494'>494</a>
+<a name='L495'></a><a href='#L495'>495</a>
+<a name='L496'></a><a href='#L496'>496</a>
+<a name='L497'></a><a href='#L497'>497</a>
+<a name='L498'></a><a href='#L498'>498</a>
+<a name='L499'></a><a href='#L499'>499</a>
+<a name='L500'></a><a href='#L500'>500</a>
+<a name='L501'></a><a href='#L501'>501</a>
+<a name='L502'></a><a href='#L502'>502</a>
+<a name='L503'></a><a href='#L503'>503</a>
+<a name='L504'></a><a href='#L504'>504</a>
+<a name='L505'></a><a href='#L505'>505</a>
+<a name='L506'></a><a href='#L506'>506</a>
+<a name='L507'></a><a href='#L507'>507</a>
+<a name='L508'></a><a href='#L508'>508</a>
+<a name='L509'></a><a href='#L509'>509</a>
+<a name='L510'></a><a href='#L510'>510</a>
+<a name='L511'></a><a href='#L511'>511</a>
+<a name='L512'></a><a href='#L512'>512</a>
+<a name='L513'></a><a href='#L513'>513</a>
+<a name='L514'></a><a href='#L514'>514</a>
+<a name='L515'></a><a href='#L515'>515</a>
+<a name='L516'></a><a href='#L516'>516</a>
+<a name='L517'></a><a href='#L517'>517</a>
+<a name='L518'></a><a href='#L518'>518</a>
+<a name='L519'></a><a href='#L519'>519</a>
+<a name='L520'></a><a href='#L520'>520</a>
+<a name='L521'></a><a href='#L521'>521</a>
+<a name='L522'></a><a href='#L522'>522</a>
+<a name='L523'></a><a href='#L523'>523</a>
+<a name='L524'></a><a href='#L524'>524</a>
+<a name='L525'></a><a href='#L525'>525</a>
+<a name='L526'></a><a href='#L526'>526</a>
+<a name='L527'></a><a href='#L527'>527</a>
+<a name='L528'></a><a href='#L528'>528</a>
+<a name='L529'></a><a href='#L529'>529</a>
+<a name='L530'></a><a href='#L530'>530</a>
+<a name='L531'></a><a href='#L531'>531</a>
+<a name='L532'></a><a href='#L532'>532</a>
+<a name='L533'></a><a href='#L533'>533</a>
+<a name='L534'></a><a href='#L534'>534</a>
+<a name='L535'></a><a href='#L535'>535</a>
+<a name='L536'></a><a href='#L536'>536</a>
+<a name='L537'></a><a href='#L537'>537</a>
+<a name='L538'></a><a href='#L538'>538</a>
+<a name='L539'></a><a href='#L539'>539</a>
+<a name='L540'></a><a href='#L540'>540</a>
+<a name='L541'></a><a href='#L541'>541</a>
+<a name='L542'></a><a href='#L542'>542</a>
+<a name='L543'></a><a href='#L543'>543</a>
+<a name='L544'></a><a href='#L544'>544</a>
+<a name='L545'></a><a href='#L545'>545</a>
+<a name='L546'></a><a href='#L546'>546</a>
+<a name='L547'></a><a href='#L547'>547</a>
+<a name='L548'></a><a href='#L548'>548</a>
+<a name='L549'></a><a href='#L549'>549</a>
+<a name='L550'></a><a href='#L550'>550</a>
+<a name='L551'></a><a href='#L551'>551</a>
+<a name='L552'></a><a href='#L552'>552</a>
+<a name='L553'></a><a href='#L553'>553</a>
+<a name='L554'></a><a href='#L554'>554</a>
+<a name='L555'></a><a href='#L555'>555</a>
+<a name='L556'></a><a href='#L556'>556</a>
+<a name='L557'></a><a href='#L557'>557</a>
+<a name='L558'></a><a href='#L558'>558</a>
+<a name='L559'></a><a href='#L559'>559</a>
+<a name='L560'></a><a href='#L560'>560</a>
+<a name='L561'></a><a href='#L561'>561</a>
+<a name='L562'></a><a href='#L562'>562</a>
+<a name='L563'></a><a href='#L563'>563</a>
+<a name='L564'></a><a href='#L564'>564</a>
+<a name='L565'></a><a href='#L565'>565</a>
+<a name='L566'></a><a href='#L566'>566</a>
+<a name='L567'></a><a href='#L567'>567</a>
+<a name='L568'></a><a href='#L568'>568</a>
+<a name='L569'></a><a href='#L569'>569</a>
+<a name='L570'></a><a href='#L570'>570</a>
+<a name='L571'></a><a href='#L571'>571</a>
+<a name='L572'></a><a href='#L572'>572</a>
+<a name='L573'></a><a href='#L573'>573</a>
+<a name='L574'></a><a href='#L574'>574</a>
+<a name='L575'></a><a href='#L575'>575</a>
+<a name='L576'></a><a href='#L576'>576</a>
+<a name='L577'></a><a href='#L577'>577</a>
+<a name='L578'></a><a href='#L578'>578</a>
+<a name='L579'></a><a href='#L579'>579</a>
+<a name='L580'></a><a href='#L580'>580</a>
+<a name='L581'></a><a href='#L581'>581</a>
+<a name='L582'></a><a href='#L582'>582</a>
+<a name='L583'></a><a href='#L583'>583</a>
+<a name='L584'></a><a href='#L584'>584</a>
+<a name='L585'></a><a href='#L585'>585</a>
+<a name='L586'></a><a href='#L586'>586</a>
+<a name='L587'></a><a href='#L587'>587</a>
+<a name='L588'></a><a href='#L588'>588</a>
+<a name='L589'></a><a href='#L589'>589</a>
+<a name='L590'></a><a href='#L590'>590</a>
+<a name='L591'></a><a href='#L591'>591</a>
+<a name='L592'></a><a href='#L592'>592</a>
+<a name='L593'></a><a href='#L593'>593</a>
+<a name='L594'></a><a href='#L594'>594</a>
+<a name='L595'></a><a href='#L595'>595</a>
+<a name='L596'></a><a href='#L596'>596</a>
+<a name='L597'></a><a href='#L597'>597</a>
+<a name='L598'></a><a href='#L598'>598</a>
+<a name='L599'></a><a href='#L599'>599</a>
+<a name='L600'></a><a href='#L600'>600</a>
+<a name='L601'></a><a href='#L601'>601</a>
+<a name='L602'></a><a href='#L602'>602</a>
+<a name='L603'></a><a href='#L603'>603</a>
+<a name='L604'></a><a href='#L604'>604</a>
+<a name='L605'></a><a href='#L605'>605</a>
+<a name='L606'></a><a href='#L606'>606</a>
+<a name='L607'></a><a href='#L607'>607</a>
+<a name='L608'></a><a href='#L608'>608</a>
+<a name='L609'></a><a href='#L609'>609</a>
+<a name='L610'></a><a href='#L610'>610</a>
+<a name='L611'></a><a href='#L611'>611</a>
+<a name='L612'></a><a href='#L612'>612</a>
+<a name='L613'></a><a href='#L613'>613</a>
+<a name='L614'></a><a href='#L614'>614</a>
+<a name='L615'></a><a href='#L615'>615</a>
+<a name='L616'></a><a href='#L616'>616</a>
+<a name='L617'></a><a href='#L617'>617</a>
+<a name='L618'></a><a href='#L618'>618</a>
+<a name='L619'></a><a href='#L619'>619</a>
+<a name='L620'></a><a href='#L620'>620</a>
+<a name='L621'></a><a href='#L621'>621</a>
+<a name='L622'></a><a href='#L622'>622</a>
+<a name='L623'></a><a href='#L623'>623</a>
+<a name='L624'></a><a href='#L624'>624</a>
+<a name='L625'></a><a href='#L625'>625</a>
+<a name='L626'></a><a href='#L626'>626</a>
+<a name='L627'></a><a href='#L627'>627</a>
+<a name='L628'></a><a href='#L628'>628</a>
+<a name='L629'></a><a href='#L629'>629</a>
+<a name='L630'></a><a href='#L630'>630</a>
+<a name='L631'></a><a href='#L631'>631</a>
+<a name='L632'></a><a href='#L632'>632</a>
+<a name='L633'></a><a href='#L633'>633</a>
+<a name='L634'></a><a href='#L634'>634</a>
+<a name='L635'></a><a href='#L635'>635</a>
+<a name='L636'></a><a href='#L636'>636</a>
+<a name='L637'></a><a href='#L637'>637</a>
+<a name='L638'></a><a href='#L638'>638</a>
+<a name='L639'></a><a href='#L639'>639</a>
+<a name='L640'></a><a href='#L640'>640</a>
+<a name='L641'></a><a href='#L641'>641</a>
+<a name='L642'></a><a href='#L642'>642</a>
+<a name='L643'></a><a href='#L643'>643</a>
+<a name='L644'></a><a href='#L644'>644</a>
+<a name='L645'></a><a href='#L645'>645</a>
+<a name='L646'></a><a href='#L646'>646</a>
+<a name='L647'></a><a href='#L647'>647</a>
+<a name='L648'></a><a href='#L648'>648</a>
+<a name='L649'></a><a href='#L649'>649</a>
+<a name='L650'></a><a href='#L650'>650</a>
+<a name='L651'></a><a href='#L651'>651</a>
+<a name='L652'></a><a href='#L652'>652</a>
+<a name='L653'></a><a href='#L653'>653</a>
+<a name='L654'></a><a href='#L654'>654</a>
+<a name='L655'></a><a href='#L655'>655</a>
+<a name='L656'></a><a href='#L656'>656</a>
+<a name='L657'></a><a href='#L657'>657</a>
+<a name='L658'></a><a href='#L658'>658</a>
+<a name='L659'></a><a href='#L659'>659</a>
+<a name='L660'></a><a href='#L660'>660</a>
+<a name='L661'></a><a href='#L661'>661</a>
+<a name='L662'></a><a href='#L662'>662</a>
+<a name='L663'></a><a href='#L663'>663</a>
+<a name='L664'></a><a href='#L664'>664</a>
+<a name='L665'></a><a href='#L665'>665</a>
+<a name='L666'></a><a href='#L666'>666</a>
+<a name='L667'></a><a href='#L667'>667</a>
+<a name='L668'></a><a href='#L668'>668</a>
+<a name='L669'></a><a href='#L669'>669</a>
+<a name='L670'></a><a href='#L670'>670</a>
+<a name='L671'></a><a href='#L671'>671</a>
+<a name='L672'></a><a href='#L672'>672</a>
+<a name='L673'></a><a href='#L673'>673</a>
+<a name='L674'></a><a href='#L674'>674</a>
+<a name='L675'></a><a href='#L675'>675</a>
+<a name='L676'></a><a href='#L676'>676</a>
+<a name='L677'></a><a href='#L677'>677</a>
+<a name='L678'></a><a href='#L678'>678</a>
+<a name='L679'></a><a href='#L679'>679</a>
+<a name='L680'></a><a href='#L680'>680</a>
+<a name='L681'></a><a href='#L681'>681</a>
+<a name='L682'></a><a href='#L682'>682</a>
+<a name='L683'></a><a href='#L683'>683</a>
+<a name='L684'></a><a href='#L684'>684</a>
+<a name='L685'></a><a href='#L685'>685</a>
+<a name='L686'></a><a href='#L686'>686</a>
+<a name='L687'></a><a href='#L687'>687</a>
+<a name='L688'></a><a href='#L688'>688</a>
+<a name='L689'></a><a href='#L689'>689</a>
+<a name='L690'></a><a href='#L690'>690</a>
+<a name='L691'></a><a href='#L691'>691</a>
+<a name='L692'></a><a href='#L692'>692</a>
+<a name='L693'></a><a href='#L693'>693</a>
+<a name='L694'></a><a href='#L694'>694</a>
+<a name='L695'></a><a href='#L695'>695</a>
+<a name='L696'></a><a href='#L696'>696</a>
+<a name='L697'></a><a href='#L697'>697</a>
+<a name='L698'></a><a href='#L698'>698</a>
+<a name='L699'></a><a href='#L699'>699</a>
+<a name='L700'></a><a href='#L700'>700</a>
+<a name='L701'></a><a href='#L701'>701</a>
+<a name='L702'></a><a href='#L702'>702</a>
+<a name='L703'></a><a href='#L703'>703</a>
+<a name='L704'></a><a href='#L704'>704</a>
+<a name='L705'></a><a href='#L705'>705</a>
+<a name='L706'></a><a href='#L706'>706</a>
+<a name='L707'></a><a href='#L707'>707</a>
+<a name='L708'></a><a href='#L708'>708</a>
+<a name='L709'></a><a href='#L709'>709</a>
+<a name='L710'></a><a href='#L710'>710</a>
+<a name='L711'></a><a href='#L711'>711</a>
+<a name='L712'></a><a href='#L712'>712</a>
+<a name='L713'></a><a href='#L713'>713</a>
+<a name='L714'></a><a href='#L714'>714</a>
+<a name='L715'></a><a href='#L715'>715</a>
+<a name='L716'></a><a href='#L716'>716</a>
+<a name='L717'></a><a href='#L717'>717</a>
+<a name='L718'></a><a href='#L718'>718</a>
+<a name='L719'></a><a href='#L719'>719</a>
+<a name='L720'></a><a href='#L720'>720</a>
+<a name='L721'></a><a href='#L721'>721</a>
+<a name='L722'></a><a href='#L722'>722</a>
+<a name='L723'></a><a href='#L723'>723</a>
+<a name='L724'></a><a href='#L724'>724</a>
+<a name='L725'></a><a href='#L725'>725</a>
+<a name='L726'></a><a href='#L726'>726</a>
+<a name='L727'></a><a href='#L727'>727</a>
+<a name='L728'></a><a href='#L728'>728</a>
+<a name='L729'></a><a href='#L729'>729</a>
+<a name='L730'></a><a href='#L730'>730</a>
+<a name='L731'></a><a href='#L731'>731</a>
+<a name='L732'></a><a href='#L732'>732</a>
+<a name='L733'></a><a href='#L733'>733</a>
+<a name='L734'></a><a href='#L734'>734</a>
+<a name='L735'></a><a href='#L735'>735</a>
+<a name='L736'></a><a href='#L736'>736</a>
+<a name='L737'></a><a href='#L737'>737</a>
+<a name='L738'></a><a href='#L738'>738</a>
+<a name='L739'></a><a href='#L739'>739</a>
+<a name='L740'></a><a href='#L740'>740</a>
+<a name='L741'></a><a href='#L741'>741</a>
+<a name='L742'></a><a href='#L742'>742</a>
+<a name='L743'></a><a href='#L743'>743</a>
+<a name='L744'></a><a href='#L744'>744</a>
+<a name='L745'></a><a href='#L745'>745</a>
+<a name='L746'></a><a href='#L746'>746</a>
+<a name='L747'></a><a href='#L747'>747</a>
+<a name='L748'></a><a href='#L748'>748</a>
+<a name='L749'></a><a href='#L749'>749</a>
+<a name='L750'></a><a href='#L750'>750</a>
+<a name='L751'></a><a href='#L751'>751</a>
+<a name='L752'></a><a href='#L752'>752</a>
+<a name='L753'></a><a href='#L753'>753</a>
+<a name='L754'></a><a href='#L754'>754</a>
+<a name='L755'></a><a href='#L755'>755</a>
+<a name='L756'></a><a href='#L756'>756</a>
+<a name='L757'></a><a href='#L757'>757</a>
+<a name='L758'></a><a href='#L758'>758</a>
+<a name='L759'></a><a href='#L759'>759</a>
+<a name='L760'></a><a href='#L760'>760</a>
+<a name='L761'></a><a href='#L761'>761</a>
+<a name='L762'></a><a href='#L762'>762</a>
+<a name='L763'></a><a href='#L763'>763</a>
+<a name='L764'></a><a href='#L764'>764</a>
+<a name='L765'></a><a href='#L765'>765</a>
+<a name='L766'></a><a href='#L766'>766</a>
+<a name='L767'></a><a href='#L767'>767</a>
+<a name='L768'></a><a href='#L768'>768</a>
+<a name='L769'></a><a href='#L769'>769</a>
+<a name='L770'></a><a href='#L770'>770</a>
+<a name='L771'></a><a href='#L771'>771</a>
+<a name='L772'></a><a href='#L772'>772</a>
+<a name='L773'></a><a href='#L773'>773</a>
+<a name='L774'></a><a href='#L774'>774</a>
+<a name='L775'></a><a href='#L775'>775</a>
+<a name='L776'></a><a href='#L776'>776</a>
+<a name='L777'></a><a href='#L777'>777</a>
+<a name='L778'></a><a href='#L778'>778</a>
+<a name='L779'></a><a href='#L779'>779</a>
+<a name='L780'></a><a href='#L780'>780</a>
+<a name='L781'></a><a href='#L781'>781</a>
+<a name='L782'></a><a href='#L782'>782</a>
+<a name='L783'></a><a href='#L783'>783</a>
+<a name='L784'></a><a href='#L784'>784</a>
+<a name='L785'></a><a href='#L785'>785</a>
+<a name='L786'></a><a href='#L786'>786</a>
+<a name='L787'></a><a href='#L787'>787</a>
+<a name='L788'></a><a href='#L788'>788</a>
+<a name='L789'></a><a href='#L789'>789</a>
+<a name='L790'></a><a href='#L790'>790</a>
+<a name='L791'></a><a href='#L791'>791</a>
+<a name='L792'></a><a href='#L792'>792</a>
+<a name='L793'></a><a href='#L793'>793</a>
+<a name='L794'></a><a href='#L794'>794</a>
+<a name='L795'></a><a href='#L795'>795</a>
+<a name='L796'></a><a href='#L796'>796</a>
+<a name='L797'></a><a href='#L797'>797</a>
+<a name='L798'></a><a href='#L798'>798</a>
+<a name='L799'></a><a href='#L799'>799</a>
+<a name='L800'></a><a href='#L800'>800</a>
+<a name='L801'></a><a href='#L801'>801</a>
+<a name='L802'></a><a href='#L802'>802</a>
+<a name='L803'></a><a href='#L803'>803</a>
+<a name='L804'></a><a href='#L804'>804</a>
+<a name='L805'></a><a href='#L805'>805</a>
+<a name='L806'></a><a href='#L806'>806</a>
+<a name='L807'></a><a href='#L807'>807</a>
+<a name='L808'></a><a href='#L808'>808</a>
+<a name='L809'></a><a href='#L809'>809</a>
+<a name='L810'></a><a href='#L810'>810</a>
+<a name='L811'></a><a href='#L811'>811</a>
+<a name='L812'></a><a href='#L812'>812</a>
+<a name='L813'></a><a href='#L813'>813</a>
+<a name='L814'></a><a href='#L814'>814</a>
+<a name='L815'></a><a href='#L815'>815</a>
+<a name='L816'></a><a href='#L816'>816</a>
+<a name='L817'></a><a href='#L817'>817</a>
+<a name='L818'></a><a href='#L818'>818</a>
+<a name='L819'></a><a href='#L819'>819</a>
+<a name='L820'></a><a href='#L820'>820</a>
+<a name='L821'></a><a href='#L821'>821</a>
+<a name='L822'></a><a href='#L822'>822</a>
+<a name='L823'></a><a href='#L823'>823</a>
+<a name='L824'></a><a href='#L824'>824</a>
+<a name='L825'></a><a href='#L825'>825</a>
+<a name='L826'></a><a href='#L826'>826</a>
+<a name='L827'></a><a href='#L827'>827</a>
+<a name='L828'></a><a href='#L828'>828</a>
+<a name='L829'></a><a href='#L829'>829</a>
+<a name='L830'></a><a href='#L830'>830</a>
+<a name='L831'></a><a href='#L831'>831</a>
+<a name='L832'></a><a href='#L832'>832</a>
+<a name='L833'></a><a href='#L833'>833</a>
+<a name='L834'></a><a href='#L834'>834</a>
+<a name='L835'></a><a href='#L835'>835</a>
+<a name='L836'></a><a href='#L836'>836</a>
+<a name='L837'></a><a href='#L837'>837</a>
+<a name='L838'></a><a href='#L838'>838</a>
+<a name='L839'></a><a href='#L839'>839</a>
+<a name='L840'></a><a href='#L840'>840</a>
+<a name='L841'></a><a href='#L841'>841</a>
+<a name='L842'></a><a href='#L842'>842</a>
+<a name='L843'></a><a href='#L843'>843</a>
+<a name='L844'></a><a href='#L844'>844</a>
+<a name='L845'></a><a href='#L845'>845</a>
+<a name='L846'></a><a href='#L846'>846</a>
+<a name='L847'></a><a href='#L847'>847</a>
+<a name='L848'></a><a href='#L848'>848</a>
+<a name='L849'></a><a href='#L849'>849</a>
+<a name='L850'></a><a href='#L850'>850</a>
+<a name='L851'></a><a href='#L851'>851</a>
+<a name='L852'></a><a href='#L852'>852</a>
+<a name='L853'></a><a href='#L853'>853</a>
+<a name='L854'></a><a href='#L854'>854</a>
+<a name='L855'></a><a href='#L855'>855</a>
+<a name='L856'></a><a href='#L856'>856</a>
+<a name='L857'></a><a href='#L857'>857</a>
+<a name='L858'></a><a href='#L858'>858</a>
+<a name='L859'></a><a href='#L859'>859</a>
+<a name='L860'></a><a href='#L860'>860</a>
+<a name='L861'></a><a href='#L861'>861</a>
+<a name='L862'></a><a href='#L862'>862</a>
+<a name='L863'></a><a href='#L863'>863</a>
+<a name='L864'></a><a href='#L864'>864</a>
+<a name='L865'></a><a href='#L865'>865</a>
+<a name='L866'></a><a href='#L866'>866</a>
+<a name='L867'></a><a href='#L867'>867</a>
+<a name='L868'></a><a href='#L868'>868</a>
+<a name='L869'></a><a href='#L869'>869</a>
+<a name='L870'></a><a href='#L870'>870</a>
+<a name='L871'></a><a href='#L871'>871</a>
+<a name='L872'></a><a href='#L872'>872</a>
+<a name='L873'></a><a href='#L873'>873</a>
+<a name='L874'></a><a href='#L874'>874</a>
+<a name='L875'></a><a href='#L875'>875</a>
+<a name='L876'></a><a href='#L876'>876</a>
+<a name='L877'></a><a href='#L877'>877</a>
+<a name='L878'></a><a href='#L878'>878</a>
+<a name='L879'></a><a href='#L879'>879</a>
+<a name='L880'></a><a href='#L880'>880</a>
+<a name='L881'></a><a href='#L881'>881</a>
+<a name='L882'></a><a href='#L882'>882</a>
+<a name='L883'></a><a href='#L883'>883</a>
+<a name='L884'></a><a href='#L884'>884</a>
+<a name='L885'></a><a href='#L885'>885</a>
+<a name='L886'></a><a href='#L886'>886</a>
+<a name='L887'></a><a href='#L887'>887</a>
+<a name='L888'></a><a href='#L888'>888</a>
+<a name='L889'></a><a href='#L889'>889</a>
+<a name='L890'></a><a href='#L890'>890</a>
+<a name='L891'></a><a href='#L891'>891</a>
+<a name='L892'></a><a href='#L892'>892</a>
+<a name='L893'></a><a href='#L893'>893</a>
+<a name='L894'></a><a href='#L894'>894</a>
+<a name='L895'></a><a href='#L895'>895</a>
+<a name='L896'></a><a href='#L896'>896</a>
+<a name='L897'></a><a href='#L897'>897</a>
+<a name='L898'></a><a href='#L898'>898</a>
+<a name='L899'></a><a href='#L899'>899</a>
+<a name='L900'></a><a href='#L900'>900</a>
+<a name='L901'></a><a href='#L901'>901</a>
+<a name='L902'></a><a href='#L902'>902</a>
+<a name='L903'></a><a href='#L903'>903</a>
+<a name='L904'></a><a href='#L904'>904</a>
+<a name='L905'></a><a href='#L905'>905</a>
+<a name='L906'></a><a href='#L906'>906</a>
+<a name='L907'></a><a href='#L907'>907</a>
+<a name='L908'></a><a href='#L908'>908</a>
+<a name='L909'></a><a href='#L909'>909</a>
+<a name='L910'></a><a href='#L910'>910</a>
+<a name='L911'></a><a href='#L911'>911</a>
+<a name='L912'></a><a href='#L912'>912</a>
+<a name='L913'></a><a href='#L913'>913</a>
+<a name='L914'></a><a href='#L914'>914</a>
+<a name='L915'></a><a href='#L915'>915</a>
+<a name='L916'></a><a href='#L916'>916</a>
+<a name='L917'></a><a href='#L917'>917</a>
+<a name='L918'></a><a href='#L918'>918</a>
+<a name='L919'></a><a href='#L919'>919</a>
+<a name='L920'></a><a href='#L920'>920</a>
+<a name='L921'></a><a href='#L921'>921</a>
+<a name='L922'></a><a href='#L922'>922</a>
+<a name='L923'></a><a href='#L923'>923</a>
+<a name='L924'></a><a href='#L924'>924</a>
+<a name='L925'></a><a href='#L925'>925</a>
+<a name='L926'></a><a href='#L926'>926</a>
+<a name='L927'></a><a href='#L927'>927</a>
+<a name='L928'></a><a href='#L928'>928</a>
+<a name='L929'></a><a href='#L929'>929</a>
+<a name='L930'></a><a href='#L930'>930</a>
+<a name='L931'></a><a href='#L931'>931</a>
+<a name='L932'></a><a href='#L932'>932</a>
+<a name='L933'></a><a href='#L933'>933</a>
+<a name='L934'></a><a href='#L934'>934</a>
+<a name='L935'></a><a href='#L935'>935</a>
+<a name='L936'></a><a href='#L936'>936</a>
+<a name='L937'></a><a href='#L937'>937</a>
+<a name='L938'></a><a href='#L938'>938</a>
+<a name='L939'></a><a href='#L939'>939</a>
+<a name='L940'></a><a href='#L940'>940</a>
+<a name='L941'></a><a href='#L941'>941</a>
+<a name='L942'></a><a href='#L942'>942</a>
+<a name='L943'></a><a href='#L943'>943</a>
+<a name='L944'></a><a href='#L944'>944</a>
+<a name='L945'></a><a href='#L945'>945</a>
+<a name='L946'></a><a href='#L946'>946</a>
+<a name='L947'></a><a href='#L947'>947</a>
+<a name='L948'></a><a href='#L948'>948</a>
+<a name='L949'></a><a href='#L949'>949</a>
+<a name='L950'></a><a href='#L950'>950</a>
+<a name='L951'></a><a href='#L951'>951</a>
+<a name='L952'></a><a href='#L952'>952</a>
+<a name='L953'></a><a href='#L953'>953</a>
+<a name='L954'></a><a href='#L954'>954</a>
+<a name='L955'></a><a href='#L955'>955</a>
+<a name='L956'></a><a href='#L956'>956</a>
+<a name='L957'></a><a href='#L957'>957</a>
+<a name='L958'></a><a href='#L958'>958</a>
+<a name='L959'></a><a href='#L959'>959</a>
+<a name='L960'></a><a href='#L960'>960</a>
+<a name='L961'></a><a href='#L961'>961</a>
+<a name='L962'></a><a href='#L962'>962</a>
+<a name='L963'></a><a href='#L963'>963</a>
+<a name='L964'></a><a href='#L964'>964</a>
+<a name='L965'></a><a href='#L965'>965</a>
+<a name='L966'></a><a href='#L966'>966</a>
+<a name='L967'></a><a href='#L967'>967</a>
+<a name='L968'></a><a href='#L968'>968</a>
+<a name='L969'></a><a href='#L969'>969</a>
+<a name='L970'></a><a href='#L970'>970</a>
+<a name='L971'></a><a href='#L971'>971</a>
+<a name='L972'></a><a href='#L972'>972</a>
+<a name='L973'></a><a href='#L973'>973</a>
+<a name='L974'></a><a href='#L974'>974</a>
+<a name='L975'></a><a href='#L975'>975</a>
+<a name='L976'></a><a href='#L976'>976</a>
+<a name='L977'></a><a href='#L977'>977</a>
+<a name='L978'></a><a href='#L978'>978</a>
+<a name='L979'></a><a href='#L979'>979</a>
+<a name='L980'></a><a href='#L980'>980</a>
+<a name='L981'></a><a href='#L981'>981</a>
+<a name='L982'></a><a href='#L982'>982</a>
+<a name='L983'></a><a href='#L983'>983</a>
+<a name='L984'></a><a href='#L984'>984</a>
+<a name='L985'></a><a href='#L985'>985</a>
+<a name='L986'></a><a href='#L986'>986</a>
+<a name='L987'></a><a href='#L987'>987</a>
+<a name='L988'></a><a href='#L988'>988</a>
+<a name='L989'></a><a href='#L989'>989</a>
+<a name='L990'></a><a href='#L990'>990</a>
+<a name='L991'></a><a href='#L991'>991</a>
+<a name='L992'></a><a href='#L992'>992</a>
+<a name='L993'></a><a href='#L993'>993</a>
+<a name='L994'></a><a href='#L994'>994</a>
+<a name='L995'></a><a href='#L995'>995</a>
+<a name='L996'></a><a href='#L996'>996</a>
+<a name='L997'></a><a href='#L997'>997</a>
+<a name='L998'></a><a href='#L998'>998</a>
+<a name='L999'></a><a href='#L999'>999</a>
+<a name='L1000'></a><a href='#L1000'>1000</a>
+<a name='L1001'></a><a href='#L1001'>1001</a>
+<a name='L1002'></a><a href='#L1002'>1002</a>
+<a name='L1003'></a><a href='#L1003'>1003</a>
+<a name='L1004'></a><a href='#L1004'>1004</a>
+<a name='L1005'></a><a href='#L1005'>1005</a>
+<a name='L1006'></a><a href='#L1006'>1006</a>
+<a name='L1007'></a><a href='#L1007'>1007</a>
+<a name='L1008'></a><a href='#L1008'>1008</a>
+<a name='L1009'></a><a href='#L1009'>1009</a>
+<a name='L1010'></a><a href='#L1010'>1010</a>
+<a name='L1011'></a><a href='#L1011'>1011</a>
+<a name='L1012'></a><a href='#L1012'>1012</a>
+<a name='L1013'></a><a href='#L1013'>1013</a>
+<a name='L1014'></a><a href='#L1014'>1014</a>
+<a name='L1015'></a><a href='#L1015'>1015</a>
+<a name='L1016'></a><a href='#L1016'>1016</a>
+<a name='L1017'></a><a href='#L1017'>1017</a>
+<a name='L1018'></a><a href='#L1018'>1018</a>
+<a name='L1019'></a><a href='#L1019'>1019</a>
+<a name='L1020'></a><a href='#L1020'>1020</a>
+<a name='L1021'></a><a href='#L1021'>1021</a>
+<a name='L1022'></a><a href='#L1022'>1022</a>
+<a name='L1023'></a><a href='#L1023'>1023</a>
+<a name='L1024'></a><a href='#L1024'>1024</a>
+<a name='L1025'></a><a href='#L1025'>1025</a>
+<a name='L1026'></a><a href='#L1026'>1026</a>
+<a name='L1027'></a><a href='#L1027'>1027</a>
+<a name='L1028'></a><a href='#L1028'>1028</a>
+<a name='L1029'></a><a href='#L1029'>1029</a>
+<a name='L1030'></a><a href='#L1030'>1030</a>
+<a name='L1031'></a><a href='#L1031'>1031</a>
+<a name='L1032'></a><a href='#L1032'>1032</a>
+<a name='L1033'></a><a href='#L1033'>1033</a>
+<a name='L1034'></a><a href='#L1034'>1034</a>
+<a name='L1035'></a><a href='#L1035'>1035</a>
+<a name='L1036'></a><a href='#L1036'>1036</a>
+<a name='L1037'></a><a href='#L1037'>1037</a>
+<a name='L1038'></a><a href='#L1038'>1038</a>
+<a name='L1039'></a><a href='#L1039'>1039</a>
+<a name='L1040'></a><a href='#L1040'>1040</a>
+<a name='L1041'></a><a href='#L1041'>1041</a>
+<a name='L1042'></a><a href='#L1042'>1042</a>
+<a name='L1043'></a><a href='#L1043'>1043</a>
+<a name='L1044'></a><a href='#L1044'>1044</a>
+<a name='L1045'></a><a href='#L1045'>1045</a>
+<a name='L1046'></a><a href='#L1046'>1046</a>
+<a name='L1047'></a><a href='#L1047'>1047</a>
+<a name='L1048'></a><a href='#L1048'>1048</a>
+<a name='L1049'></a><a href='#L1049'>1049</a>
+<a name='L1050'></a><a href='#L1050'>1050</a>
+<a name='L1051'></a><a href='#L1051'>1051</a>
+<a name='L1052'></a><a href='#L1052'>1052</a>
+<a name='L1053'></a><a href='#L1053'>1053</a>
+<a name='L1054'></a><a href='#L1054'>1054</a>
+<a name='L1055'></a><a href='#L1055'>1055</a>
+<a name='L1056'></a><a href='#L1056'>1056</a>
+<a name='L1057'></a><a href='#L1057'>1057</a>
+<a name='L1058'></a><a href='#L1058'>1058</a>
+<a name='L1059'></a><a href='#L1059'>1059</a>
+<a name='L1060'></a><a href='#L1060'>1060</a>
+<a name='L1061'></a><a href='#L1061'>1061</a>
+<a name='L1062'></a><a href='#L1062'>1062</a>
+<a name='L1063'></a><a href='#L1063'>1063</a>
+<a name='L1064'></a><a href='#L1064'>1064</a>
+<a name='L1065'></a><a href='#L1065'>1065</a>
+<a name='L1066'></a><a href='#L1066'>1066</a>
+<a name='L1067'></a><a href='#L1067'>1067</a>
+<a name='L1068'></a><a href='#L1068'>1068</a>
+<a name='L1069'></a><a href='#L1069'>1069</a>
+<a name='L1070'></a><a href='#L1070'>1070</a>
+<a name='L1071'></a><a href='#L1071'>1071</a>
+<a name='L1072'></a><a href='#L1072'>1072</a>
+<a name='L1073'></a><a href='#L1073'>1073</a>
+<a name='L1074'></a><a href='#L1074'>1074</a>
+<a name='L1075'></a><a href='#L1075'>1075</a>
+<a name='L1076'></a><a href='#L1076'>1076</a>
+<a name='L1077'></a><a href='#L1077'>1077</a>
+<a name='L1078'></a><a href='#L1078'>1078</a>
+<a name='L1079'></a><a href='#L1079'>1079</a>
+<a name='L1080'></a><a href='#L1080'>1080</a>
+<a name='L1081'></a><a href='#L1081'>1081</a>
+<a name='L1082'></a><a href='#L1082'>1082</a>
+<a name='L1083'></a><a href='#L1083'>1083</a>
+<a name='L1084'></a><a href='#L1084'>1084</a>
+<a name='L1085'></a><a href='#L1085'>1085</a>
+<a name='L1086'></a><a href='#L1086'>1086</a>
+<a name='L1087'></a><a href='#L1087'>1087</a>
+<a name='L1088'></a><a href='#L1088'>1088</a>
+<a name='L1089'></a><a href='#L1089'>1089</a>
+<a name='L1090'></a><a href='#L1090'>1090</a>
+<a name='L1091'></a><a href='#L1091'>1091</a>
+<a name='L1092'></a><a href='#L1092'>1092</a>
+<a name='L1093'></a><a href='#L1093'>1093</a>
+<a name='L1094'></a><a href='#L1094'>1094</a>
+<a name='L1095'></a><a href='#L1095'>1095</a>
+<a name='L1096'></a><a href='#L1096'>1096</a>
+<a name='L1097'></a><a href='#L1097'>1097</a>
+<a name='L1098'></a><a href='#L1098'>1098</a>
+<a name='L1099'></a><a href='#L1099'>1099</a>
+<a name='L1100'></a><a href='#L1100'>1100</a>
+<a name='L1101'></a><a href='#L1101'>1101</a>
+<a name='L1102'></a><a href='#L1102'>1102</a>
+<a name='L1103'></a><a href='#L1103'>1103</a>
+<a name='L1104'></a><a href='#L1104'>1104</a>
+<a name='L1105'></a><a href='#L1105'>1105</a>
+<a name='L1106'></a><a href='#L1106'>1106</a>
+<a name='L1107'></a><a href='#L1107'>1107</a>
+<a name='L1108'></a><a href='#L1108'>1108</a>
+<a name='L1109'></a><a href='#L1109'>1109</a>
+<a name='L1110'></a><a href='#L1110'>1110</a>
+<a name='L1111'></a><a href='#L1111'>1111</a>
+<a name='L1112'></a><a href='#L1112'>1112</a>
+<a name='L1113'></a><a href='#L1113'>1113</a>
+<a name='L1114'></a><a href='#L1114'>1114</a>
+<a name='L1115'></a><a href='#L1115'>1115</a>
+<a name='L1116'></a><a href='#L1116'>1116</a>
+<a name='L1117'></a><a href='#L1117'>1117</a>
+<a name='L1118'></a><a href='#L1118'>1118</a>
+<a name='L1119'></a><a href='#L1119'>1119</a>
+<a name='L1120'></a><a href='#L1120'>1120</a>
+<a name='L1121'></a><a href='#L1121'>1121</a>
+<a name='L1122'></a><a href='#L1122'>1122</a>
+<a name='L1123'></a><a href='#L1123'>1123</a>
+<a name='L1124'></a><a href='#L1124'>1124</a>
+<a name='L1125'></a><a href='#L1125'>1125</a>
+<a name='L1126'></a><a href='#L1126'>1126</a>
+<a name='L1127'></a><a href='#L1127'>1127</a>
+<a name='L1128'></a><a href='#L1128'>1128</a>
+<a name='L1129'></a><a href='#L1129'>1129</a>
+<a name='L1130'></a><a href='#L1130'>1130</a>
+<a name='L1131'></a><a href='#L1131'>1131</a>
+<a name='L1132'></a><a href='#L1132'>1132</a>
+<a name='L1133'></a><a href='#L1133'>1133</a>
+<a name='L1134'></a><a href='#L1134'>1134</a>
+<a name='L1135'></a><a href='#L1135'>1135</a>
+<a name='L1136'></a><a href='#L1136'>1136</a>
+<a name='L1137'></a><a href='#L1137'>1137</a>
+<a name='L1138'></a><a href='#L1138'>1138</a>
+<a name='L1139'></a><a href='#L1139'>1139</a>
+<a name='L1140'></a><a href='#L1140'>1140</a>
+<a name='L1141'></a><a href='#L1141'>1141</a>
+<a name='L1142'></a><a href='#L1142'>1142</a>
+<a name='L1143'></a><a href='#L1143'>1143</a>
+<a name='L1144'></a><a href='#L1144'>1144</a>
+<a name='L1145'></a><a href='#L1145'>1145</a>
+<a name='L1146'></a><a href='#L1146'>1146</a>
+<a name='L1147'></a><a href='#L1147'>1147</a>
+<a name='L1148'></a><a href='#L1148'>1148</a>
+<a name='L1149'></a><a href='#L1149'>1149</a>
+<a name='L1150'></a><a href='#L1150'>1150</a>
+<a name='L1151'></a><a href='#L1151'>1151</a>
+<a name='L1152'></a><a href='#L1152'>1152</a>
+<a name='L1153'></a><a href='#L1153'>1153</a>
+<a name='L1154'></a><a href='#L1154'>1154</a>
+<a name='L1155'></a><a href='#L1155'>1155</a>
+<a name='L1156'></a><a href='#L1156'>1156</a>
+<a name='L1157'></a><a href='#L1157'>1157</a>
+<a name='L1158'></a><a href='#L1158'>1158</a>
+<a name='L1159'></a><a href='#L1159'>1159</a>
+<a name='L1160'></a><a href='#L1160'>1160</a>
+<a name='L1161'></a><a href='#L1161'>1161</a>
+<a name='L1162'></a><a href='#L1162'>1162</a>
+<a name='L1163'></a><a href='#L1163'>1163</a>
+<a name='L1164'></a><a href='#L1164'>1164</a>
+<a name='L1165'></a><a href='#L1165'>1165</a>
+<a name='L1166'></a><a href='#L1166'>1166</a>
+<a name='L1167'></a><a href='#L1167'>1167</a>
+<a name='L1168'></a><a href='#L1168'>1168</a>
+<a name='L1169'></a><a href='#L1169'>1169</a>
+<a name='L1170'></a><a href='#L1170'>1170</a>
+<a name='L1171'></a><a href='#L1171'>1171</a>
+<a name='L1172'></a><a href='#L1172'>1172</a>
+<a name='L1173'></a><a href='#L1173'>1173</a>
+<a name='L1174'></a><a href='#L1174'>1174</a>
+<a name='L1175'></a><a href='#L1175'>1175</a>
+<a name='L1176'></a><a href='#L1176'>1176</a>
+<a name='L1177'></a><a href='#L1177'>1177</a>
+<a name='L1178'></a><a href='#L1178'>1178</a>
+<a name='L1179'></a><a href='#L1179'>1179</a>
+<a name='L1180'></a><a href='#L1180'>1180</a>
+<a name='L1181'></a><a href='#L1181'>1181</a>
+<a name='L1182'></a><a href='#L1182'>1182</a>
+<a name='L1183'></a><a href='#L1183'>1183</a>
+<a name='L1184'></a><a href='#L1184'>1184</a>
+<a name='L1185'></a><a href='#L1185'>1185</a>
+<a name='L1186'></a><a href='#L1186'>1186</a>
+<a name='L1187'></a><a href='#L1187'>1187</a>
+<a name='L1188'></a><a href='#L1188'>1188</a>
+<a name='L1189'></a><a href='#L1189'>1189</a>
+<a name='L1190'></a><a href='#L1190'>1190</a>
+<a name='L1191'></a><a href='#L1191'>1191</a>
+<a name='L1192'></a><a href='#L1192'>1192</a>
+<a name='L1193'></a><a href='#L1193'>1193</a>
+<a name='L1194'></a><a href='#L1194'>1194</a>
+<a name='L1195'></a><a href='#L1195'>1195</a>
+<a name='L1196'></a><a href='#L1196'>1196</a>
+<a name='L1197'></a><a href='#L1197'>1197</a>
+<a name='L1198'></a><a href='#L1198'>1198</a>
+<a name='L1199'></a><a href='#L1199'>1199</a>
+<a name='L1200'></a><a href='#L1200'>1200</a>
+<a name='L1201'></a><a href='#L1201'>1201</a>
+<a name='L1202'></a><a href='#L1202'>1202</a>
+<a name='L1203'></a><a href='#L1203'>1203</a>
+<a name='L1204'></a><a href='#L1204'>1204</a>
+<a name='L1205'></a><a href='#L1205'>1205</a>
+<a name='L1206'></a><a href='#L1206'>1206</a>
+<a name='L1207'></a><a href='#L1207'>1207</a>
+<a name='L1208'></a><a href='#L1208'>1208</a>
+<a name='L1209'></a><a href='#L1209'>1209</a>
+<a name='L1210'></a><a href='#L1210'>1210</a>
+<a name='L1211'></a><a href='#L1211'>1211</a>
+<a name='L1212'></a><a href='#L1212'>1212</a>
+<a name='L1213'></a><a href='#L1213'>1213</a>
+<a name='L1214'></a><a href='#L1214'>1214</a>
+<a name='L1215'></a><a href='#L1215'>1215</a>
+<a name='L1216'></a><a href='#L1216'>1216</a>
+<a name='L1217'></a><a href='#L1217'>1217</a>
+<a name='L1218'></a><a href='#L1218'>1218</a>
+<a name='L1219'></a><a href='#L1219'>1219</a>
+<a name='L1220'></a><a href='#L1220'>1220</a>
+<a name='L1221'></a><a href='#L1221'>1221</a>
+<a name='L1222'></a><a href='#L1222'>1222</a>
+<a name='L1223'></a><a href='#L1223'>1223</a>
+<a name='L1224'></a><a href='#L1224'>1224</a>
+<a name='L1225'></a><a href='#L1225'>1225</a>
+<a name='L1226'></a><a href='#L1226'>1226</a>
+<a name='L1227'></a><a href='#L1227'>1227</a>
+<a name='L1228'></a><a href='#L1228'>1228</a>
+<a name='L1229'></a><a href='#L1229'>1229</a>
+<a name='L1230'></a><a href='#L1230'>1230</a>
+<a name='L1231'></a><a href='#L1231'>1231</a>
+<a name='L1232'></a><a href='#L1232'>1232</a>
+<a name='L1233'></a><a href='#L1233'>1233</a>
+<a name='L1234'></a><a href='#L1234'>1234</a>
+<a name='L1235'></a><a href='#L1235'>1235</a>
+<a name='L1236'></a><a href='#L1236'>1236</a>
+<a name='L1237'></a><a href='#L1237'>1237</a>
+<a name='L1238'></a><a href='#L1238'>1238</a>
+<a name='L1239'></a><a href='#L1239'>1239</a>
+<a name='L1240'></a><a href='#L1240'>1240</a>
+<a name='L1241'></a><a href='#L1241'>1241</a>
+<a name='L1242'></a><a href='#L1242'>1242</a>
+<a name='L1243'></a><a href='#L1243'>1243</a>
+<a name='L1244'></a><a href='#L1244'>1244</a>
+<a name='L1245'></a><a href='#L1245'>1245</a>
+<a name='L1246'></a><a href='#L1246'>1246</a>
+<a name='L1247'></a><a href='#L1247'>1247</a>
+<a name='L1248'></a><a href='#L1248'>1248</a>
+<a name='L1249'></a><a href='#L1249'>1249</a>
+<a name='L1250'></a><a href='#L1250'>1250</a>
+<a name='L1251'></a><a href='#L1251'>1251</a>
+<a name='L1252'></a><a href='#L1252'>1252</a>
+<a name='L1253'></a><a href='#L1253'>1253</a>
+<a name='L1254'></a><a href='#L1254'>1254</a>
+<a name='L1255'></a><a href='#L1255'>1255</a>
+<a name='L1256'></a><a href='#L1256'>1256</a>
+<a name='L1257'></a><a href='#L1257'>1257</a>
+<a name='L1258'></a><a href='#L1258'>1258</a>
+<a name='L1259'></a><a href='#L1259'>1259</a>
+<a name='L1260'></a><a href='#L1260'>1260</a>
+<a name='L1261'></a><a href='#L1261'>1261</a>
+<a name='L1262'></a><a href='#L1262'>1262</a>
+<a name='L1263'></a><a href='#L1263'>1263</a>
+<a name='L1264'></a><a href='#L1264'>1264</a>
+<a name='L1265'></a><a href='#L1265'>1265</a>
+<a name='L1266'></a><a href='#L1266'>1266</a>
+<a name='L1267'></a><a href='#L1267'>1267</a>
+<a name='L1268'></a><a href='#L1268'>1268</a>
+<a name='L1269'></a><a href='#L1269'>1269</a>
+<a name='L1270'></a><a href='#L1270'>1270</a>
+<a name='L1271'></a><a href='#L1271'>1271</a>
+<a name='L1272'></a><a href='#L1272'>1272</a>
+<a name='L1273'></a><a href='#L1273'>1273</a>
+<a name='L1274'></a><a href='#L1274'>1274</a>
+<a name='L1275'></a><a href='#L1275'>1275</a>
+<a name='L1276'></a><a href='#L1276'>1276</a>
+<a name='L1277'></a><a href='#L1277'>1277</a>
+<a name='L1278'></a><a href='#L1278'>1278</a>
+<a name='L1279'></a><a href='#L1279'>1279</a>
+<a name='L1280'></a><a href='#L1280'>1280</a>
+<a name='L1281'></a><a href='#L1281'>1281</a>
+<a name='L1282'></a><a href='#L1282'>1282</a>
+<a name='L1283'></a><a href='#L1283'>1283</a>
+<a name='L1284'></a><a href='#L1284'>1284</a>
+<a name='L1285'></a><a href='#L1285'>1285</a>
+<a name='L1286'></a><a href='#L1286'>1286</a>
+<a name='L1287'></a><a href='#L1287'>1287</a>
+<a name='L1288'></a><a href='#L1288'>1288</a>
+<a name='L1289'></a><a href='#L1289'>1289</a>
+<a name='L1290'></a><a href='#L1290'>1290</a>
+<a name='L1291'></a><a href='#L1291'>1291</a>
+<a name='L1292'></a><a href='#L1292'>1292</a>
+<a name='L1293'></a><a href='#L1293'>1293</a>
+<a name='L1294'></a><a href='#L1294'>1294</a>
+<a name='L1295'></a><a href='#L1295'>1295</a>
+<a name='L1296'></a><a href='#L1296'>1296</a>
+<a name='L1297'></a><a href='#L1297'>1297</a>
+<a name='L1298'></a><a href='#L1298'>1298</a>
+<a name='L1299'></a><a href='#L1299'>1299</a>
+<a name='L1300'></a><a href='#L1300'>1300</a>
+<a name='L1301'></a><a href='#L1301'>1301</a>
+<a name='L1302'></a><a href='#L1302'>1302</a>
+<a name='L1303'></a><a href='#L1303'>1303</a>
+<a name='L1304'></a><a href='#L1304'>1304</a>
+<a name='L1305'></a><a href='#L1305'>1305</a>
+<a name='L1306'></a><a href='#L1306'>1306</a>
+<a name='L1307'></a><a href='#L1307'>1307</a>
+<a name='L1308'></a><a href='#L1308'>1308</a>
+<a name='L1309'></a><a href='#L1309'>1309</a>
+<a name='L1310'></a><a href='#L1310'>1310</a>
+<a name='L1311'></a><a href='#L1311'>1311</a>
+<a name='L1312'></a><a href='#L1312'>1312</a>
+<a name='L1313'></a><a href='#L1313'>1313</a>
+<a name='L1314'></a><a href='#L1314'>1314</a>
+<a name='L1315'></a><a href='#L1315'>1315</a>
+<a name='L1316'></a><a href='#L1316'>1316</a>
+<a name='L1317'></a><a href='#L1317'>1317</a>
+<a name='L1318'></a><a href='#L1318'>1318</a>
+<a name='L1319'></a><a href='#L1319'>1319</a>
+<a name='L1320'></a><a href='#L1320'>1320</a>
+<a name='L1321'></a><a href='#L1321'>1321</a>
+<a name='L1322'></a><a href='#L1322'>1322</a>
+<a name='L1323'></a><a href='#L1323'>1323</a>
+<a name='L1324'></a><a href='#L1324'>1324</a>
+<a name='L1325'></a><a href='#L1325'>1325</a>
+<a name='L1326'></a><a href='#L1326'>1326</a>
+<a name='L1327'></a><a href='#L1327'>1327</a>
+<a name='L1328'></a><a href='#L1328'>1328</a>
+<a name='L1329'></a><a href='#L1329'>1329</a>
+<a name='L1330'></a><a href='#L1330'>1330</a>
+<a name='L1331'></a><a href='#L1331'>1331</a>
+<a name='L1332'></a><a href='#L1332'>1332</a>
+<a name='L1333'></a><a href='#L1333'>1333</a>
+<a name='L1334'></a><a href='#L1334'>1334</a>
+<a name='L1335'></a><a href='#L1335'>1335</a>
+<a name='L1336'></a><a href='#L1336'>1336</a>
+<a name='L1337'></a><a href='#L1337'>1337</a>
+<a name='L1338'></a><a href='#L1338'>1338</a>
+<a name='L1339'></a><a href='#L1339'>1339</a>
+<a name='L1340'></a><a href='#L1340'>1340</a>
+<a name='L1341'></a><a href='#L1341'>1341</a>
+<a name='L1342'></a><a href='#L1342'>1342</a>
+<a name='L1343'></a><a href='#L1343'>1343</a>
+<a name='L1344'></a><a href='#L1344'>1344</a>
+<a name='L1345'></a><a href='#L1345'>1345</a>
+<a name='L1346'></a><a href='#L1346'>1346</a>
+<a name='L1347'></a><a href='#L1347'>1347</a>
+<a name='L1348'></a><a href='#L1348'>1348</a>
+<a name='L1349'></a><a href='#L1349'>1349</a>
+<a name='L1350'></a><a href='#L1350'>1350</a>
+<a name='L1351'></a><a href='#L1351'>1351</a>
+<a name='L1352'></a><a href='#L1352'>1352</a>
+<a name='L1353'></a><a href='#L1353'>1353</a>
+<a name='L1354'></a><a href='#L1354'>1354</a>
+<a name='L1355'></a><a href='#L1355'>1355</a>
+<a name='L1356'></a><a href='#L1356'>1356</a>
+<a name='L1357'></a><a href='#L1357'>1357</a>
+<a name='L1358'></a><a href='#L1358'>1358</a>
+<a name='L1359'></a><a href='#L1359'>1359</a>
+<a name='L1360'></a><a href='#L1360'>1360</a>
+<a name='L1361'></a><a href='#L1361'>1361</a>
+<a name='L1362'></a><a href='#L1362'>1362</a>
+<a name='L1363'></a><a href='#L1363'>1363</a>
+<a name='L1364'></a><a href='#L1364'>1364</a>
+<a name='L1365'></a><a href='#L1365'>1365</a>
+<a name='L1366'></a><a href='#L1366'>1366</a>
+<a name='L1367'></a><a href='#L1367'>1367</a>
+<a name='L1368'></a><a href='#L1368'>1368</a>
+<a name='L1369'></a><a href='#L1369'>1369</a>
+<a name='L1370'></a><a href='#L1370'>1370</a>
+<a name='L1371'></a><a href='#L1371'>1371</a>
+<a name='L1372'></a><a href='#L1372'>1372</a>
+<a name='L1373'></a><a href='#L1373'>1373</a>
+<a name='L1374'></a><a href='#L1374'>1374</a>
+<a name='L1375'></a><a href='#L1375'>1375</a>
+<a name='L1376'></a><a href='#L1376'>1376</a>
+<a name='L1377'></a><a href='#L1377'>1377</a>
+<a name='L1378'></a><a href='#L1378'>1378</a>
+<a name='L1379'></a><a href='#L1379'>1379</a>
+<a name='L1380'></a><a href='#L1380'>1380</a>
+<a name='L1381'></a><a href='#L1381'>1381</a>
+<a name='L1382'></a><a href='#L1382'>1382</a>
+<a name='L1383'></a><a href='#L1383'>1383</a>
+<a name='L1384'></a><a href='#L1384'>1384</a>
+<a name='L1385'></a><a href='#L1385'>1385</a>
+<a name='L1386'></a><a href='#L1386'>1386</a>
+<a name='L1387'></a><a href='#L1387'>1387</a>
+<a name='L1388'></a><a href='#L1388'>1388</a>
+<a name='L1389'></a><a href='#L1389'>1389</a>
+<a name='L1390'></a><a href='#L1390'>1390</a>
+<a name='L1391'></a><a href='#L1391'>1391</a>
+<a name='L1392'></a><a href='#L1392'>1392</a>
+<a name='L1393'></a><a href='#L1393'>1393</a>
+<a name='L1394'></a><a href='#L1394'>1394</a>
+<a name='L1395'></a><a href='#L1395'>1395</a>
+<a name='L1396'></a><a href='#L1396'>1396</a>
+<a name='L1397'></a><a href='#L1397'>1397</a>
+<a name='L1398'></a><a href='#L1398'>1398</a>
+<a name='L1399'></a><a href='#L1399'>1399</a>
+<a name='L1400'></a><a href='#L1400'>1400</a>
+<a name='L1401'></a><a href='#L1401'>1401</a>
+<a name='L1402'></a><a href='#L1402'>1402</a>
+<a name='L1403'></a><a href='#L1403'>1403</a>
+<a name='L1404'></a><a href='#L1404'>1404</a>
+<a name='L1405'></a><a href='#L1405'>1405</a>
+<a name='L1406'></a><a href='#L1406'>1406</a>
+<a name='L1407'></a><a href='#L1407'>1407</a>
+<a name='L1408'></a><a href='#L1408'>1408</a>
+<a name='L1409'></a><a href='#L1409'>1409</a>
+<a name='L1410'></a><a href='#L1410'>1410</a>
+<a name='L1411'></a><a href='#L1411'>1411</a>
+<a name='L1412'></a><a href='#L1412'>1412</a>
+<a name='L1413'></a><a href='#L1413'>1413</a>
+<a name='L1414'></a><a href='#L1414'>1414</a>
+<a name='L1415'></a><a href='#L1415'>1415</a>
+<a name='L1416'></a><a href='#L1416'>1416</a>
+<a name='L1417'></a><a href='#L1417'>1417</a>
+<a name='L1418'></a><a href='#L1418'>1418</a>
+<a name='L1419'></a><a href='#L1419'>1419</a>
+<a name='L1420'></a><a href='#L1420'>1420</a>
+<a name='L1421'></a><a href='#L1421'>1421</a>
+<a name='L1422'></a><a href='#L1422'>1422</a>
+<a name='L1423'></a><a href='#L1423'>1423</a>
+<a name='L1424'></a><a href='#L1424'>1424</a>
+<a name='L1425'></a><a href='#L1425'>1425</a>
+<a name='L1426'></a><a href='#L1426'>1426</a>
+<a name='L1427'></a><a href='#L1427'>1427</a>
+<a name='L1428'></a><a href='#L1428'>1428</a>
+<a name='L1429'></a><a href='#L1429'>1429</a>
+<a name='L1430'></a><a href='#L1430'>1430</a>
+<a name='L1431'></a><a href='#L1431'>1431</a>
+<a name='L1432'></a><a href='#L1432'>1432</a>
+<a name='L1433'></a><a href='#L1433'>1433</a>
+<a name='L1434'></a><a href='#L1434'>1434</a>
+<a name='L1435'></a><a href='#L1435'>1435</a>
+<a name='L1436'></a><a href='#L1436'>1436</a>
+<a name='L1437'></a><a href='#L1437'>1437</a>
+<a name='L1438'></a><a href='#L1438'>1438</a>
+<a name='L1439'></a><a href='#L1439'>1439</a>
+<a name='L1440'></a><a href='#L1440'>1440</a>
+<a name='L1441'></a><a href='#L1441'>1441</a>
+<a name='L1442'></a><a href='#L1442'>1442</a>
+<a name='L1443'></a><a href='#L1443'>1443</a>
+<a name='L1444'></a><a href='#L1444'>1444</a>
+<a name='L1445'></a><a href='#L1445'>1445</a>
+<a name='L1446'></a><a href='#L1446'>1446</a>
+<a name='L1447'></a><a href='#L1447'>1447</a>
+<a name='L1448'></a><a href='#L1448'>1448</a>
+<a name='L1449'></a><a href='#L1449'>1449</a>
+<a name='L1450'></a><a href='#L1450'>1450</a>
+<a name='L1451'></a><a href='#L1451'>1451</a>
+<a name='L1452'></a><a href='#L1452'>1452</a>
+<a name='L1453'></a><a href='#L1453'>1453</a>
+<a name='L1454'></a><a href='#L1454'>1454</a>
+<a name='L1455'></a><a href='#L1455'>1455</a>
+<a name='L1456'></a><a href='#L1456'>1456</a>
+<a name='L1457'></a><a href='#L1457'>1457</a>
+<a name='L1458'></a><a href='#L1458'>1458</a>
+<a name='L1459'></a><a href='#L1459'>1459</a>
+<a name='L1460'></a><a href='#L1460'>1460</a>
+<a name='L1461'></a><a href='#L1461'>1461</a>
+<a name='L1462'></a><a href='#L1462'>1462</a>
+<a name='L1463'></a><a href='#L1463'>1463</a>
+<a name='L1464'></a><a href='#L1464'>1464</a>
+<a name='L1465'></a><a href='#L1465'>1465</a>
+<a name='L1466'></a><a href='#L1466'>1466</a>
+<a name='L1467'></a><a href='#L1467'>1467</a>
+<a name='L1468'></a><a href='#L1468'>1468</a>
+<a name='L1469'></a><a href='#L1469'>1469</a>
+<a name='L1470'></a><a href='#L1470'>1470</a>
+<a name='L1471'></a><a href='#L1471'>1471</a>
+<a name='L1472'></a><a href='#L1472'>1472</a>
+<a name='L1473'></a><a href='#L1473'>1473</a>
+<a name='L1474'></a><a href='#L1474'>1474</a>
+<a name='L1475'></a><a href='#L1475'>1475</a>
+<a name='L1476'></a><a href='#L1476'>1476</a>
+<a name='L1477'></a><a href='#L1477'>1477</a>
+<a name='L1478'></a><a href='#L1478'>1478</a>
+<a name='L1479'></a><a href='#L1479'>1479</a>
+<a name='L1480'></a><a href='#L1480'>1480</a>
+<a name='L1481'></a><a href='#L1481'>1481</a>
+<a name='L1482'></a><a href='#L1482'>1482</a>
+<a name='L1483'></a><a href='#L1483'>1483</a>
+<a name='L1484'></a><a href='#L1484'>1484</a>
+<a name='L1485'></a><a href='#L1485'>1485</a>
+<a name='L1486'></a><a href='#L1486'>1486</a>
+<a name='L1487'></a><a href='#L1487'>1487</a>
+<a name='L1488'></a><a href='#L1488'>1488</a>
+<a name='L1489'></a><a href='#L1489'>1489</a>
+<a name='L1490'></a><a href='#L1490'>1490</a>
+<a name='L1491'></a><a href='#L1491'>1491</a>
+<a name='L1492'></a><a href='#L1492'>1492</a>
+<a name='L1493'></a><a href='#L1493'>1493</a>
+<a name='L1494'></a><a href='#L1494'>1494</a>
+<a name='L1495'></a><a href='#L1495'>1495</a>
+<a name='L1496'></a><a href='#L1496'>1496</a>
+<a name='L1497'></a><a href='#L1497'>1497</a>
+<a name='L1498'></a><a href='#L1498'>1498</a>
+<a name='L1499'></a><a href='#L1499'>1499</a>
+<a name='L1500'></a><a href='#L1500'>1500</a>
+<a name='L1501'></a><a href='#L1501'>1501</a>
+<a name='L1502'></a><a href='#L1502'>1502</a>
+<a name='L1503'></a><a href='#L1503'>1503</a>
+<a name='L1504'></a><a href='#L1504'>1504</a>
+<a name='L1505'></a><a href='#L1505'>1505</a>
+<a name='L1506'></a><a href='#L1506'>1506</a>
+<a name='L1507'></a><a href='#L1507'>1507</a>
+<a name='L1508'></a><a href='#L1508'>1508</a>
+<a name='L1509'></a><a href='#L1509'>1509</a>
+<a name='L1510'></a><a href='#L1510'>1510</a>
+<a name='L1511'></a><a href='#L1511'>1511</a>
+<a name='L1512'></a><a href='#L1512'>1512</a>
+<a name='L1513'></a><a href='#L1513'>1513</a>
+<a name='L1514'></a><a href='#L1514'>1514</a>
+<a name='L1515'></a><a href='#L1515'>1515</a>
+<a name='L1516'></a><a href='#L1516'>1516</a>
+<a name='L1517'></a><a href='#L1517'>1517</a>
+<a name='L1518'></a><a href='#L1518'>1518</a>
+<a name='L1519'></a><a href='#L1519'>1519</a>
+<a name='L1520'></a><a href='#L1520'>1520</a>
+<a name='L1521'></a><a href='#L1521'>1521</a>
+<a name='L1522'></a><a href='#L1522'>1522</a>
+<a name='L1523'></a><a href='#L1523'>1523</a>
+<a name='L1524'></a><a href='#L1524'>1524</a>
+<a name='L1525'></a><a href='#L1525'>1525</a>
+<a name='L1526'></a><a href='#L1526'>1526</a>
+<a name='L1527'></a><a href='#L1527'>1527</a>
+<a name='L1528'></a><a href='#L1528'>1528</a>
+<a name='L1529'></a><a href='#L1529'>1529</a>
+<a name='L1530'></a><a href='#L1530'>1530</a>
+<a name='L1531'></a><a href='#L1531'>1531</a>
+<a name='L1532'></a><a href='#L1532'>1532</a>
+<a name='L1533'></a><a href='#L1533'>1533</a>
+<a name='L1534'></a><a href='#L1534'>1534</a>
+<a name='L1535'></a><a href='#L1535'>1535</a>
+<a name='L1536'></a><a href='#L1536'>1536</a>
+<a name='L1537'></a><a href='#L1537'>1537</a>
+<a name='L1538'></a><a href='#L1538'>1538</a>
+<a name='L1539'></a><a href='#L1539'>1539</a>
+<a name='L1540'></a><a href='#L1540'>1540</a>
+<a name='L1541'></a><a href='#L1541'>1541</a>
+<a name='L1542'></a><a href='#L1542'>1542</a>
+<a name='L1543'></a><a href='#L1543'>1543</a>
+<a name='L1544'></a><a href='#L1544'>1544</a>
+<a name='L1545'></a><a href='#L1545'>1545</a>
+<a name='L1546'></a><a href='#L1546'>1546</a>
+<a name='L1547'></a><a href='#L1547'>1547</a>
+<a name='L1548'></a><a href='#L1548'>1548</a>
+<a name='L1549'></a><a href='#L1549'>1549</a>
+<a name='L1550'></a><a href='#L1550'>1550</a>
+<a name='L1551'></a><a href='#L1551'>1551</a>
+<a name='L1552'></a><a href='#L1552'>1552</a>
+<a name='L1553'></a><a href='#L1553'>1553</a>
+<a name='L1554'></a><a href='#L1554'>1554</a>
+<a name='L1555'></a><a href='#L1555'>1555</a>
+<a name='L1556'></a><a href='#L1556'>1556</a>
+<a name='L1557'></a><a href='#L1557'>1557</a>
+<a name='L1558'></a><a href='#L1558'>1558</a>
+<a name='L1559'></a><a href='#L1559'>1559</a>
+<a name='L1560'></a><a href='#L1560'>1560</a>
+<a name='L1561'></a><a href='#L1561'>1561</a>
+<a name='L1562'></a><a href='#L1562'>1562</a>
+<a name='L1563'></a><a href='#L1563'>1563</a>
+<a name='L1564'></a><a href='#L1564'>1564</a>
+<a name='L1565'></a><a href='#L1565'>1565</a>
+<a name='L1566'></a><a href='#L1566'>1566</a>
+<a name='L1567'></a><a href='#L1567'>1567</a>
+<a name='L1568'></a><a href='#L1568'>1568</a>
+<a name='L1569'></a><a href='#L1569'>1569</a>
+<a name='L1570'></a><a href='#L1570'>1570</a>
+<a name='L1571'></a><a href='#L1571'>1571</a>
+<a name='L1572'></a><a href='#L1572'>1572</a>
+<a name='L1573'></a><a href='#L1573'>1573</a>
+<a name='L1574'></a><a href='#L1574'>1574</a>
+<a name='L1575'></a><a href='#L1575'>1575</a>
+<a name='L1576'></a><a href='#L1576'>1576</a>
+<a name='L1577'></a><a href='#L1577'>1577</a>
+<a name='L1578'></a><a href='#L1578'>1578</a>
+<a name='L1579'></a><a href='#L1579'>1579</a>
+<a name='L1580'></a><a href='#L1580'>1580</a>
+<a name='L1581'></a><a href='#L1581'>1581</a>
+<a name='L1582'></a><a href='#L1582'>1582</a>
+<a name='L1583'></a><a href='#L1583'>1583</a>
+<a name='L1584'></a><a href='#L1584'>1584</a>
+<a name='L1585'></a><a href='#L1585'>1585</a>
+<a name='L1586'></a><a href='#L1586'>1586</a>
+<a name='L1587'></a><a href='#L1587'>1587</a>
+<a name='L1588'></a><a href='#L1588'>1588</a>
+<a name='L1589'></a><a href='#L1589'>1589</a>
+<a name='L1590'></a><a href='#L1590'>1590</a>
+<a name='L1591'></a><a href='#L1591'>1591</a>
+<a name='L1592'></a><a href='#L1592'>1592</a>
+<a name='L1593'></a><a href='#L1593'>1593</a>
+<a name='L1594'></a><a href='#L1594'>1594</a>
+<a name='L1595'></a><a href='#L1595'>1595</a>
+<a name='L1596'></a><a href='#L1596'>1596</a>
+<a name='L1597'></a><a href='#L1597'>1597</a>
+<a name='L1598'></a><a href='#L1598'>1598</a>
+<a name='L1599'></a><a href='#L1599'>1599</a>
+<a name='L1600'></a><a href='#L1600'>1600</a>
+<a name='L1601'></a><a href='#L1601'>1601</a>
+<a name='L1602'></a><a href='#L1602'>1602</a>
+<a name='L1603'></a><a href='#L1603'>1603</a>
+<a name='L1604'></a><a href='#L1604'>1604</a>
+<a name='L1605'></a><a href='#L1605'>1605</a>
+<a name='L1606'></a><a href='#L1606'>1606</a>
+<a name='L1607'></a><a href='#L1607'>1607</a>
+<a name='L1608'></a><a href='#L1608'>1608</a>
+<a name='L1609'></a><a href='#L1609'>1609</a>
+<a name='L1610'></a><a href='#L1610'>1610</a>
+<a name='L1611'></a><a href='#L1611'>1611</a>
+<a name='L1612'></a><a href='#L1612'>1612</a>
+<a name='L1613'></a><a href='#L1613'>1613</a>
+<a name='L1614'></a><a href='#L1614'>1614</a>
+<a name='L1615'></a><a href='#L1615'>1615</a>
+<a name='L1616'></a><a href='#L1616'>1616</a>
+<a name='L1617'></a><a href='#L1617'>1617</a>
+<a name='L1618'></a><a href='#L1618'>1618</a>
+<a name='L1619'></a><a href='#L1619'>1619</a>
+<a name='L1620'></a><a href='#L1620'>1620</a>
+<a name='L1621'></a><a href='#L1621'>1621</a>
+<a name='L1622'></a><a href='#L1622'>1622</a>
+<a name='L1623'></a><a href='#L1623'>1623</a>
+<a name='L1624'></a><a href='#L1624'>1624</a>
+<a name='L1625'></a><a href='#L1625'>1625</a>
+<a name='L1626'></a><a href='#L1626'>1626</a>
+<a name='L1627'></a><a href='#L1627'>1627</a>
+<a name='L1628'></a><a href='#L1628'>1628</a>
+<a name='L1629'></a><a href='#L1629'>1629</a>
+<a name='L1630'></a><a href='#L1630'>1630</a>
+<a name='L1631'></a><a href='#L1631'>1631</a>
+<a name='L1632'></a><a href='#L1632'>1632</a>
+<a name='L1633'></a><a href='#L1633'>1633</a>
+<a name='L1634'></a><a href='#L1634'>1634</a>
+<a name='L1635'></a><a href='#L1635'>1635</a>
+<a name='L1636'></a><a href='#L1636'>1636</a>
+<a name='L1637'></a><a href='#L1637'>1637</a>
+<a name='L1638'></a><a href='#L1638'>1638</a>
+<a name='L1639'></a><a href='#L1639'>1639</a>
+<a name='L1640'></a><a href='#L1640'>1640</a>
+<a name='L1641'></a><a href='#L1641'>1641</a>
+<a name='L1642'></a><a href='#L1642'>1642</a>
+<a name='L1643'></a><a href='#L1643'>1643</a>
+<a name='L1644'></a><a href='#L1644'>1644</a>
+<a name='L1645'></a><a href='#L1645'>1645</a>
+<a name='L1646'></a><a href='#L1646'>1646</a>
+<a name='L1647'></a><a href='#L1647'>1647</a>
+<a name='L1648'></a><a href='#L1648'>1648</a>
+<a name='L1649'></a><a href='#L1649'>1649</a>
+<a name='L1650'></a><a href='#L1650'>1650</a>
+<a name='L1651'></a><a href='#L1651'>1651</a>
+<a name='L1652'></a><a href='#L1652'>1652</a>
+<a name='L1653'></a><a href='#L1653'>1653</a>
+<a name='L1654'></a><a href='#L1654'>1654</a>
+<a name='L1655'></a><a href='#L1655'>1655</a>
+<a name='L1656'></a><a href='#L1656'>1656</a>
+<a name='L1657'></a><a href='#L1657'>1657</a>
+<a name='L1658'></a><a href='#L1658'>1658</a>
+<a name='L1659'></a><a href='#L1659'>1659</a>
+<a name='L1660'></a><a href='#L1660'>1660</a>
+<a name='L1661'></a><a href='#L1661'>1661</a>
+<a name='L1662'></a><a href='#L1662'>1662</a>
+<a name='L1663'></a><a href='#L1663'>1663</a>
+<a name='L1664'></a><a href='#L1664'>1664</a>
+<a name='L1665'></a><a href='#L1665'>1665</a>
+<a name='L1666'></a><a href='#L1666'>1666</a>
+<a name='L1667'></a><a href='#L1667'>1667</a>
+<a name='L1668'></a><a href='#L1668'>1668</a>
+<a name='L1669'></a><a href='#L1669'>1669</a>
+<a name='L1670'></a><a href='#L1670'>1670</a>
+<a name='L1671'></a><a href='#L1671'>1671</a>
+<a name='L1672'></a><a href='#L1672'>1672</a>
+<a name='L1673'></a><a href='#L1673'>1673</a>
+<a name='L1674'></a><a href='#L1674'>1674</a>
+<a name='L1675'></a><a href='#L1675'>1675</a>
+<a name='L1676'></a><a href='#L1676'>1676</a>
+<a name='L1677'></a><a href='#L1677'>1677</a>
+<a name='L1678'></a><a href='#L1678'>1678</a>
+<a name='L1679'></a><a href='#L1679'>1679</a>
+<a name='L1680'></a><a href='#L1680'>1680</a>
+<a name='L1681'></a><a href='#L1681'>1681</a>
+<a name='L1682'></a><a href='#L1682'>1682</a>
+<a name='L1683'></a><a href='#L1683'>1683</a>
+<a name='L1684'></a><a href='#L1684'>1684</a>
+<a name='L1685'></a><a href='#L1685'>1685</a>
+<a name='L1686'></a><a href='#L1686'>1686</a>
+<a name='L1687'></a><a href='#L1687'>1687</a>
+<a name='L1688'></a><a href='#L1688'>1688</a>
+<a name='L1689'></a><a href='#L1689'>1689</a>
+<a name='L1690'></a><a href='#L1690'>1690</a>
+<a name='L1691'></a><a href='#L1691'>1691</a>
+<a name='L1692'></a><a href='#L1692'>1692</a>
+<a name='L1693'></a><a href='#L1693'>1693</a>
+<a name='L1694'></a><a href='#L1694'>1694</a>
+<a name='L1695'></a><a href='#L1695'>1695</a>
+<a name='L1696'></a><a href='#L1696'>1696</a>
+<a name='L1697'></a><a href='#L1697'>1697</a>
+<a name='L1698'></a><a href='#L1698'>1698</a>
+<a name='L1699'></a><a href='#L1699'>1699</a>
+<a name='L1700'></a><a href='#L1700'>1700</a>
+<a name='L1701'></a><a href='#L1701'>1701</a>
+<a name='L1702'></a><a href='#L1702'>1702</a>
+<a name='L1703'></a><a href='#L1703'>1703</a>
+<a name='L1704'></a><a href='#L1704'>1704</a>
+<a name='L1705'></a><a href='#L1705'>1705</a>
+<a name='L1706'></a><a href='#L1706'>1706</a>
+<a name='L1707'></a><a href='#L1707'>1707</a>
+<a name='L1708'></a><a href='#L1708'>1708</a>
+<a name='L1709'></a><a href='#L1709'>1709</a>
+<a name='L1710'></a><a href='#L1710'>1710</a>
+<a name='L1711'></a><a href='#L1711'>1711</a>
+<a name='L1712'></a><a href='#L1712'>1712</a>
+<a name='L1713'></a><a href='#L1713'>1713</a>
+<a name='L1714'></a><a href='#L1714'>1714</a>
+<a name='L1715'></a><a href='#L1715'>1715</a>
+<a name='L1716'></a><a href='#L1716'>1716</a>
+<a name='L1717'></a><a href='#L1717'>1717</a>
+<a name='L1718'></a><a href='#L1718'>1718</a>
+<a name='L1719'></a><a href='#L1719'>1719</a>
+<a name='L1720'></a><a href='#L1720'>1720</a>
+<a name='L1721'></a><a href='#L1721'>1721</a>
+<a name='L1722'></a><a href='#L1722'>1722</a>
+<a name='L1723'></a><a href='#L1723'>1723</a>
+<a name='L1724'></a><a href='#L1724'>1724</a>
+<a name='L1725'></a><a href='#L1725'>1725</a>
+<a name='L1726'></a><a href='#L1726'>1726</a>
+<a name='L1727'></a><a href='#L1727'>1727</a>
+<a name='L1728'></a><a href='#L1728'>1728</a>
+<a name='L1729'></a><a href='#L1729'>1729</a>
+<a name='L1730'></a><a href='#L1730'>1730</a>
+<a name='L1731'></a><a href='#L1731'>1731</a>
+<a name='L1732'></a><a href='#L1732'>1732</a>
+<a name='L1733'></a><a href='#L1733'>1733</a>
+<a name='L1734'></a><a href='#L1734'>1734</a>
+<a name='L1735'></a><a href='#L1735'>1735</a>
+<a name='L1736'></a><a href='#L1736'>1736</a>
+<a name='L1737'></a><a href='#L1737'>1737</a>
+<a name='L1738'></a><a href='#L1738'>1738</a>
+<a name='L1739'></a><a href='#L1739'>1739</a>
+<a name='L1740'></a><a href='#L1740'>1740</a>
+<a name='L1741'></a><a href='#L1741'>1741</a>
+<a name='L1742'></a><a href='#L1742'>1742</a>
+<a name='L1743'></a><a href='#L1743'>1743</a>
+<a name='L1744'></a><a href='#L1744'>1744</a>
+<a name='L1745'></a><a href='#L1745'>1745</a>
+<a name='L1746'></a><a href='#L1746'>1746</a>
+<a name='L1747'></a><a href='#L1747'>1747</a>
+<a name='L1748'></a><a href='#L1748'>1748</a>
+<a name='L1749'></a><a href='#L1749'>1749</a>
+<a name='L1750'></a><a href='#L1750'>1750</a>
+<a name='L1751'></a><a href='#L1751'>1751</a>
+<a name='L1752'></a><a href='#L1752'>1752</a>
+<a name='L1753'></a><a href='#L1753'>1753</a>
+<a name='L1754'></a><a href='#L1754'>1754</a>
+<a name='L1755'></a><a href='#L1755'>1755</a>
+<a name='L1756'></a><a href='#L1756'>1756</a>
+<a name='L1757'></a><a href='#L1757'>1757</a>
+<a name='L1758'></a><a href='#L1758'>1758</a>
+<a name='L1759'></a><a href='#L1759'>1759</a>
+<a name='L1760'></a><a href='#L1760'>1760</a>
+<a name='L1761'></a><a href='#L1761'>1761</a>
+<a name='L1762'></a><a href='#L1762'>1762</a>
+<a name='L1763'></a><a href='#L1763'>1763</a>
+<a name='L1764'></a><a href='#L1764'>1764</a>
+<a name='L1765'></a><a href='#L1765'>1765</a>
+<a name='L1766'></a><a href='#L1766'>1766</a>
+<a name='L1767'></a><a href='#L1767'>1767</a>
+<a name='L1768'></a><a href='#L1768'>1768</a>
+<a name='L1769'></a><a href='#L1769'>1769</a>
+<a name='L1770'></a><a href='#L1770'>1770</a>
+<a name='L1771'></a><a href='#L1771'>1771</a>
+<a name='L1772'></a><a href='#L1772'>1772</a>
+<a name='L1773'></a><a href='#L1773'>1773</a>
+<a name='L1774'></a><a href='#L1774'>1774</a>
+<a name='L1775'></a><a href='#L1775'>1775</a>
+<a name='L1776'></a><a href='#L1776'>1776</a>
+<a name='L1777'></a><a href='#L1777'>1777</a>
+<a name='L1778'></a><a href='#L1778'>1778</a>
+<a name='L1779'></a><a href='#L1779'>1779</a>
+<a name='L1780'></a><a href='#L1780'>1780</a>
+<a name='L1781'></a><a href='#L1781'>1781</a>
+<a name='L1782'></a><a href='#L1782'>1782</a>
+<a name='L1783'></a><a href='#L1783'>1783</a>
+<a name='L1784'></a><a href='#L1784'>1784</a>
+<a name='L1785'></a><a href='#L1785'>1785</a>
+<a name='L1786'></a><a href='#L1786'>1786</a>
+<a name='L1787'></a><a href='#L1787'>1787</a>
+<a name='L1788'></a><a href='#L1788'>1788</a>
+<a name='L1789'></a><a href='#L1789'>1789</a>
+<a name='L1790'></a><a href='#L1790'>1790</a>
+<a name='L1791'></a><a href='#L1791'>1791</a>
+<a name='L1792'></a><a href='#L1792'>1792</a>
+<a name='L1793'></a><a href='#L1793'>1793</a>
+<a name='L1794'></a><a href='#L1794'>1794</a>
+<a name='L1795'></a><a href='#L1795'>1795</a>
+<a name='L1796'></a><a href='#L1796'>1796</a>
+<a name='L1797'></a><a href='#L1797'>1797</a>
+<a name='L1798'></a><a href='#L1798'>1798</a>
+<a name='L1799'></a><a href='#L1799'>1799</a>
+<a name='L1800'></a><a href='#L1800'>1800</a>
+<a name='L1801'></a><a href='#L1801'>1801</a>
+<a name='L1802'></a><a href='#L1802'>1802</a>
+<a name='L1803'></a><a href='#L1803'>1803</a>
+<a name='L1804'></a><a href='#L1804'>1804</a>
+<a name='L1805'></a><a href='#L1805'>1805</a>
+<a name='L1806'></a><a href='#L1806'>1806</a>
+<a name='L1807'></a><a href='#L1807'>1807</a>
+<a name='L1808'></a><a href='#L1808'>1808</a>
+<a name='L1809'></a><a href='#L1809'>1809</a>
+<a name='L1810'></a><a href='#L1810'>1810</a>
+<a name='L1811'></a><a href='#L1811'>1811</a>
+<a name='L1812'></a><a href='#L1812'>1812</a>
+<a name='L1813'></a><a href='#L1813'>1813</a>
+<a name='L1814'></a><a href='#L1814'>1814</a>
+<a name='L1815'></a><a href='#L1815'>1815</a>
+<a name='L1816'></a><a href='#L1816'>1816</a>
+<a name='L1817'></a><a href='#L1817'>1817</a>
+<a name='L1818'></a><a href='#L1818'>1818</a>
+<a name='L1819'></a><a href='#L1819'>1819</a>
+<a name='L1820'></a><a href='#L1820'>1820</a>
+<a name='L1821'></a><a href='#L1821'>1821</a>
+<a name='L1822'></a><a href='#L1822'>1822</a>
+<a name='L1823'></a><a href='#L1823'>1823</a>
+<a name='L1824'></a><a href='#L1824'>1824</a>
+<a name='L1825'></a><a href='#L1825'>1825</a>
+<a name='L1826'></a><a href='#L1826'>1826</a>
+<a name='L1827'></a><a href='#L1827'>1827</a>
+<a name='L1828'></a><a href='#L1828'>1828</a>
+<a name='L1829'></a><a href='#L1829'>1829</a>
+<a name='L1830'></a><a href='#L1830'>1830</a>
+<a name='L1831'></a><a href='#L1831'>1831</a>
+<a name='L1832'></a><a href='#L1832'>1832</a>
+<a name='L1833'></a><a href='#L1833'>1833</a>
+<a name='L1834'></a><a href='#L1834'>1834</a>
+<a name='L1835'></a><a href='#L1835'>1835</a>
+<a name='L1836'></a><a href='#L1836'>1836</a>
+<a name='L1837'></a><a href='#L1837'>1837</a>
+<a name='L1838'></a><a href='#L1838'>1838</a>
+<a name='L1839'></a><a href='#L1839'>1839</a>
+<a name='L1840'></a><a href='#L1840'>1840</a>
+<a name='L1841'></a><a href='#L1841'>1841</a>
+<a name='L1842'></a><a href='#L1842'>1842</a>
+<a name='L1843'></a><a href='#L1843'>1843</a>
+<a name='L1844'></a><a href='#L1844'>1844</a>
+<a name='L1845'></a><a href='#L1845'>1845</a>
+<a name='L1846'></a><a href='#L1846'>1846</a>
+<a name='L1847'></a><a href='#L1847'>1847</a>
+<a name='L1848'></a><a href='#L1848'>1848</a>
+<a name='L1849'></a><a href='#L1849'>1849</a>
+<a name='L1850'></a><a href='#L1850'>1850</a>
+<a name='L1851'></a><a href='#L1851'>1851</a>
+<a name='L1852'></a><a href='#L1852'>1852</a>
+<a name='L1853'></a><a href='#L1853'>1853</a>
+<a name='L1854'></a><a href='#L1854'>1854</a>
+<a name='L1855'></a><a href='#L1855'>1855</a>
+<a name='L1856'></a><a href='#L1856'>1856</a>
+<a name='L1857'></a><a href='#L1857'>1857</a>
+<a name='L1858'></a><a href='#L1858'>1858</a>
+<a name='L1859'></a><a href='#L1859'>1859</a>
+<a name='L1860'></a><a href='#L1860'>1860</a>
+<a name='L1861'></a><a href='#L1861'>1861</a>
+<a name='L1862'></a><a href='#L1862'>1862</a>
+<a name='L1863'></a><a href='#L1863'>1863</a>
+<a name='L1864'></a><a href='#L1864'>1864</a>
+<a name='L1865'></a><a href='#L1865'>1865</a>
+<a name='L1866'></a><a href='#L1866'>1866</a>
+<a name='L1867'></a><a href='#L1867'>1867</a>
+<a name='L1868'></a><a href='#L1868'>1868</a>
+<a name='L1869'></a><a href='#L1869'>1869</a>
+<a name='L1870'></a><a href='#L1870'>1870</a>
+<a name='L1871'></a><a href='#L1871'>1871</a>
+<a name='L1872'></a><a href='#L1872'>1872</a>
+<a name='L1873'></a><a href='#L1873'>1873</a>
+<a name='L1874'></a><a href='#L1874'>1874</a>
+<a name='L1875'></a><a href='#L1875'>1875</a>
+<a name='L1876'></a><a href='#L1876'>1876</a>
+<a name='L1877'></a><a href='#L1877'>1877</a>
+<a name='L1878'></a><a href='#L1878'>1878</a>
+<a name='L1879'></a><a href='#L1879'>1879</a>
+<a name='L1880'></a><a href='#L1880'>1880</a>
+<a name='L1881'></a><a href='#L1881'>1881</a>
+<a name='L1882'></a><a href='#L1882'>1882</a>
+<a name='L1883'></a><a href='#L1883'>1883</a>
+<a name='L1884'></a><a href='#L1884'>1884</a>
+<a name='L1885'></a><a href='#L1885'>1885</a>
+<a name='L1886'></a><a href='#L1886'>1886</a>
+<a name='L1887'></a><a href='#L1887'>1887</a>
+<a name='L1888'></a><a href='#L1888'>1888</a>
+<a name='L1889'></a><a href='#L1889'>1889</a>
+<a name='L1890'></a><a href='#L1890'>1890</a>
+<a name='L1891'></a><a href='#L1891'>1891</a>
+<a name='L1892'></a><a href='#L1892'>1892</a>
+<a name='L1893'></a><a href='#L1893'>1893</a>
+<a name='L1894'></a><a href='#L1894'>1894</a>
+<a name='L1895'></a><a href='#L1895'>1895</a>
+<a name='L1896'></a><a href='#L1896'>1896</a>
+<a name='L1897'></a><a href='#L1897'>1897</a>
+<a name='L1898'></a><a href='#L1898'>1898</a>
+<a name='L1899'></a><a href='#L1899'>1899</a>
+<a name='L1900'></a><a href='#L1900'>1900</a>
+<a name='L1901'></a><a href='#L1901'>1901</a>
+<a name='L1902'></a><a href='#L1902'>1902</a>
+<a name='L1903'></a><a href='#L1903'>1903</a>
+<a name='L1904'></a><a href='#L1904'>1904</a>
+<a name='L1905'></a><a href='#L1905'>1905</a>
+<a name='L1906'></a><a href='#L1906'>1906</a>
+<a name='L1907'></a><a href='#L1907'>1907</a>
+<a name='L1908'></a><a href='#L1908'>1908</a>
+<a name='L1909'></a><a href='#L1909'>1909</a>
+<a name='L1910'></a><a href='#L1910'>1910</a>
+<a name='L1911'></a><a href='#L1911'>1911</a>
+<a name='L1912'></a><a href='#L1912'>1912</a>
+<a name='L1913'></a><a href='#L1913'>1913</a>
+<a name='L1914'></a><a href='#L1914'>1914</a>
+<a name='L1915'></a><a href='#L1915'>1915</a>
+<a name='L1916'></a><a href='#L1916'>1916</a>
+<a name='L1917'></a><a href='#L1917'>1917</a>
+<a name='L1918'></a><a href='#L1918'>1918</a>
+<a name='L1919'></a><a href='#L1919'>1919</a>
+<a name='L1920'></a><a href='#L1920'>1920</a>
+<a name='L1921'></a><a href='#L1921'>1921</a>
+<a name='L1922'></a><a href='#L1922'>1922</a>
+<a name='L1923'></a><a href='#L1923'>1923</a>
+<a name='L1924'></a><a href='#L1924'>1924</a>
+<a name='L1925'></a><a href='#L1925'>1925</a>
+<a name='L1926'></a><a href='#L1926'>1926</a>
+<a name='L1927'></a><a href='#L1927'>1927</a>
+<a name='L1928'></a><a href='#L1928'>1928</a>
+<a name='L1929'></a><a href='#L1929'>1929</a>
+<a name='L1930'></a><a href='#L1930'>1930</a>
+<a name='L1931'></a><a href='#L1931'>1931</a>
+<a name='L1932'></a><a href='#L1932'>1932</a>
+<a name='L1933'></a><a href='#L1933'>1933</a>
+<a name='L1934'></a><a href='#L1934'>1934</a>
+<a name='L1935'></a><a href='#L1935'>1935</a>
+<a name='L1936'></a><a href='#L1936'>1936</a>
+<a name='L1937'></a><a href='#L1937'>1937</a>
+<a name='L1938'></a><a href='#L1938'>1938</a>
+<a name='L1939'></a><a href='#L1939'>1939</a>
+<a name='L1940'></a><a href='#L1940'>1940</a>
+<a name='L1941'></a><a href='#L1941'>1941</a>
+<a name='L1942'></a><a href='#L1942'>1942</a>
+<a name='L1943'></a><a href='#L1943'>1943</a>
+<a name='L1944'></a><a href='#L1944'>1944</a>
+<a name='L1945'></a><a href='#L1945'>1945</a>
+<a name='L1946'></a><a href='#L1946'>1946</a>
+<a name='L1947'></a><a href='#L1947'>1947</a>
+<a name='L1948'></a><a href='#L1948'>1948</a>
+<a name='L1949'></a><a href='#L1949'>1949</a>
+<a name='L1950'></a><a href='#L1950'>1950</a>
+<a name='L1951'></a><a href='#L1951'>1951</a>
+<a name='L1952'></a><a href='#L1952'>1952</a>
+<a name='L1953'></a><a href='#L1953'>1953</a>
+<a name='L1954'></a><a href='#L1954'>1954</a>
+<a name='L1955'></a><a href='#L1955'>1955</a>
+<a name='L1956'></a><a href='#L1956'>1956</a>
+<a name='L1957'></a><a href='#L1957'>1957</a>
+<a name='L1958'></a><a href='#L1958'>1958</a>
+<a name='L1959'></a><a href='#L1959'>1959</a>
+<a name='L1960'></a><a href='#L1960'>1960</a>
+<a name='L1961'></a><a href='#L1961'>1961</a>
+<a name='L1962'></a><a href='#L1962'>1962</a>
+<a name='L1963'></a><a href='#L1963'>1963</a>
+<a name='L1964'></a><a href='#L1964'>1964</a>
+<a name='L1965'></a><a href='#L1965'>1965</a>
+<a name='L1966'></a><a href='#L1966'>1966</a>
+<a name='L1967'></a><a href='#L1967'>1967</a>
+<a name='L1968'></a><a href='#L1968'>1968</a>
+<a name='L1969'></a><a href='#L1969'>1969</a>
+<a name='L1970'></a><a href='#L1970'>1970</a>
+<a name='L1971'></a><a href='#L1971'>1971</a>
+<a name='L1972'></a><a href='#L1972'>1972</a>
+<a name='L1973'></a><a href='#L1973'>1973</a>
+<a name='L1974'></a><a href='#L1974'>1974</a>
+<a name='L1975'></a><a href='#L1975'>1975</a>
+<a name='L1976'></a><a href='#L1976'>1976</a>
+<a name='L1977'></a><a href='#L1977'>1977</a>
+<a name='L1978'></a><a href='#L1978'>1978</a>
+<a name='L1979'></a><a href='#L1979'>1979</a>
+<a name='L1980'></a><a href='#L1980'>1980</a>
+<a name='L1981'></a><a href='#L1981'>1981</a>
+<a name='L1982'></a><a href='#L1982'>1982</a>
+<a name='L1983'></a><a href='#L1983'>1983</a>
+<a name='L1984'></a><a href='#L1984'>1984</a>
+<a name='L1985'></a><a href='#L1985'>1985</a>
+<a name='L1986'></a><a href='#L1986'>1986</a>
+<a name='L1987'></a><a href='#L1987'>1987</a>
+<a name='L1988'></a><a href='#L1988'>1988</a>
+<a name='L1989'></a><a href='#L1989'>1989</a>
+<a name='L1990'></a><a href='#L1990'>1990</a>
+<a name='L1991'></a><a href='#L1991'>1991</a>
+<a name='L1992'></a><a href='#L1992'>1992</a>
+<a name='L1993'></a><a href='#L1993'>1993</a>
+<a name='L1994'></a><a href='#L1994'>1994</a>
+<a name='L1995'></a><a href='#L1995'>1995</a>
+<a name='L1996'></a><a href='#L1996'>1996</a>
+<a name='L1997'></a><a href='#L1997'>1997</a>
+<a name='L1998'></a><a href='#L1998'>1998</a>
+<a name='L1999'></a><a href='#L1999'>1999</a>
+<a name='L2000'></a><a href='#L2000'>2000</a>
+<a name='L2001'></a><a href='#L2001'>2001</a>
+<a name='L2002'></a><a href='#L2002'>2002</a>
+<a name='L2003'></a><a href='#L2003'>2003</a>
+<a name='L2004'></a><a href='#L2004'>2004</a>
+<a name='L2005'></a><a href='#L2005'>2005</a>
+<a name='L2006'></a><a href='#L2006'>2006</a>
+<a name='L2007'></a><a href='#L2007'>2007</a>
+<a name='L2008'></a><a href='#L2008'>2008</a>
+<a name='L2009'></a><a href='#L2009'>2009</a>
+<a name='L2010'></a><a href='#L2010'>2010</a>
+<a name='L2011'></a><a href='#L2011'>2011</a>
+<a name='L2012'></a><a href='#L2012'>2012</a>
+<a name='L2013'></a><a href='#L2013'>2013</a>
+<a name='L2014'></a><a href='#L2014'>2014</a>
+<a name='L2015'></a><a href='#L2015'>2015</a>
+<a name='L2016'></a><a href='#L2016'>2016</a>
+<a name='L2017'></a><a href='#L2017'>2017</a>
+<a name='L2018'></a><a href='#L2018'>2018</a>
+<a name='L2019'></a><a href='#L2019'>2019</a>
+<a name='L2020'></a><a href='#L2020'>2020</a>
+<a name='L2021'></a><a href='#L2021'>2021</a>
+<a name='L2022'></a><a href='#L2022'>2022</a>
+<a name='L2023'></a><a href='#L2023'>2023</a>
+<a name='L2024'></a><a href='#L2024'>2024</a>
+<a name='L2025'></a><a href='#L2025'>2025</a>
+<a name='L2026'></a><a href='#L2026'>2026</a>
+<a name='L2027'></a><a href='#L2027'>2027</a>
+<a name='L2028'></a><a href='#L2028'>2028</a>
+<a name='L2029'></a><a href='#L2029'>2029</a>
+<a name='L2030'></a><a href='#L2030'>2030</a>
+<a name='L2031'></a><a href='#L2031'>2031</a>
+<a name='L2032'></a><a href='#L2032'>2032</a>
+<a name='L2033'></a><a href='#L2033'>2033</a>
+<a name='L2034'></a><a href='#L2034'>2034</a>
+<a name='L2035'></a><a href='#L2035'>2035</a>
+<a name='L2036'></a><a href='#L2036'>2036</a>
+<a name='L2037'></a><a href='#L2037'>2037</a>
+<a name='L2038'></a><a href='#L2038'>2038</a>
+<a name='L2039'></a><a href='#L2039'>2039</a>
+<a name='L2040'></a><a href='#L2040'>2040</a>
+<a name='L2041'></a><a href='#L2041'>2041</a>
+<a name='L2042'></a><a href='#L2042'>2042</a>
+<a name='L2043'></a><a href='#L2043'>2043</a>
+<a name='L2044'></a><a href='#L2044'>2044</a>
+<a name='L2045'></a><a href='#L2045'>2045</a>
+<a name='L2046'></a><a href='#L2046'>2046</a>
+<a name='L2047'></a><a href='#L2047'>2047</a>
+<a name='L2048'></a><a href='#L2048'>2048</a>
+<a name='L2049'></a><a href='#L2049'>2049</a>
+<a name='L2050'></a><a href='#L2050'>2050</a>
+<a name='L2051'></a><a href='#L2051'>2051</a>
+<a name='L2052'></a><a href='#L2052'>2052</a>
+<a name='L2053'></a><a href='#L2053'>2053</a>
+<a name='L2054'></a><a href='#L2054'>2054</a>
+<a name='L2055'></a><a href='#L2055'>2055</a>
+<a name='L2056'></a><a href='#L2056'>2056</a>
+<a name='L2057'></a><a href='#L2057'>2057</a>
+<a name='L2058'></a><a href='#L2058'>2058</a>
+<a name='L2059'></a><a href='#L2059'>2059</a>
+<a name='L2060'></a><a href='#L2060'>2060</a>
+<a name='L2061'></a><a href='#L2061'>2061</a>
+<a name='L2062'></a><a href='#L2062'>2062</a>
+<a name='L2063'></a><a href='#L2063'>2063</a>
+<a name='L2064'></a><a href='#L2064'>2064</a>
+<a name='L2065'></a><a href='#L2065'>2065</a>
+<a name='L2066'></a><a href='#L2066'>2066</a>
+<a name='L2067'></a><a href='#L2067'>2067</a>
+<a name='L2068'></a><a href='#L2068'>2068</a>
+<a name='L2069'></a><a href='#L2069'>2069</a>
+<a name='L2070'></a><a href='#L2070'>2070</a>
+<a name='L2071'></a><a href='#L2071'>2071</a>
+<a name='L2072'></a><a href='#L2072'>2072</a>
+<a name='L2073'></a><a href='#L2073'>2073</a>
+<a name='L2074'></a><a href='#L2074'>2074</a>
+<a name='L2075'></a><a href='#L2075'>2075</a>
+<a name='L2076'></a><a href='#L2076'>2076</a>
+<a name='L2077'></a><a href='#L2077'>2077</a>
+<a name='L2078'></a><a href='#L2078'>2078</a>
+<a name='L2079'></a><a href='#L2079'>2079</a>
+<a name='L2080'></a><a href='#L2080'>2080</a>
+<a name='L2081'></a><a href='#L2081'>2081</a>
+<a name='L2082'></a><a href='#L2082'>2082</a>
+<a name='L2083'></a><a href='#L2083'>2083</a>
+<a name='L2084'></a><a href='#L2084'>2084</a>
+<a name='L2085'></a><a href='#L2085'>2085</a>
+<a name='L2086'></a><a href='#L2086'>2086</a>
+<a name='L2087'></a><a href='#L2087'>2087</a>
+<a name='L2088'></a><a href='#L2088'>2088</a>
+<a name='L2089'></a><a href='#L2089'>2089</a>
+<a name='L2090'></a><a href='#L2090'>2090</a>
+<a name='L2091'></a><a href='#L2091'>2091</a>
+<a name='L2092'></a><a href='#L2092'>2092</a>
+<a name='L2093'></a><a href='#L2093'>2093</a>
+<a name='L2094'></a><a href='#L2094'>2094</a>
+<a name='L2095'></a><a href='#L2095'>2095</a>
+<a name='L2096'></a><a href='#L2096'>2096</a>
+<a name='L2097'></a><a href='#L2097'>2097</a>
+<a name='L2098'></a><a href='#L2098'>2098</a>
+<a name='L2099'></a><a href='#L2099'>2099</a>
+<a name='L2100'></a><a href='#L2100'>2100</a>
+<a name='L2101'></a><a href='#L2101'>2101</a>
+<a name='L2102'></a><a href='#L2102'>2102</a>
+<a name='L2103'></a><a href='#L2103'>2103</a>
+<a name='L2104'></a><a href='#L2104'>2104</a>
+<a name='L2105'></a><a href='#L2105'>2105</a>
+<a name='L2106'></a><a href='#L2106'>2106</a>
+<a name='L2107'></a><a href='#L2107'>2107</a>
+<a name='L2108'></a><a href='#L2108'>2108</a>
+<a name='L2109'></a><a href='#L2109'>2109</a>
+<a name='L2110'></a><a href='#L2110'>2110</a>
+<a name='L2111'></a><a href='#L2111'>2111</a>
+<a name='L2112'></a><a href='#L2112'>2112</a>
+<a name='L2113'></a><a href='#L2113'>2113</a>
+<a name='L2114'></a><a href='#L2114'>2114</a>
+<a name='L2115'></a><a href='#L2115'>2115</a>
+<a name='L2116'></a><a href='#L2116'>2116</a>
+<a name='L2117'></a><a href='#L2117'>2117</a>
+<a name='L2118'></a><a href='#L2118'>2118</a>
+<a name='L2119'></a><a href='#L2119'>2119</a>
+<a name='L2120'></a><a href='#L2120'>2120</a>
+<a name='L2121'></a><a href='#L2121'>2121</a>
+<a name='L2122'></a><a href='#L2122'>2122</a>
+<a name='L2123'></a><a href='#L2123'>2123</a>
+<a name='L2124'></a><a href='#L2124'>2124</a>
+<a name='L2125'></a><a href='#L2125'>2125</a>
+<a name='L2126'></a><a href='#L2126'>2126</a>
+<a name='L2127'></a><a href='#L2127'>2127</a>
+<a name='L2128'></a><a href='#L2128'>2128</a>
+<a name='L2129'></a><a href='#L2129'>2129</a>
+<a name='L2130'></a><a href='#L2130'>2130</a>
+<a name='L2131'></a><a href='#L2131'>2131</a>
+<a name='L2132'></a><a href='#L2132'>2132</a>
+<a name='L2133'></a><a href='#L2133'>2133</a>
+<a name='L2134'></a><a href='#L2134'>2134</a>
+<a name='L2135'></a><a href='#L2135'>2135</a>
+<a name='L2136'></a><a href='#L2136'>2136</a>
+<a name='L2137'></a><a href='#L2137'>2137</a>
+<a name='L2138'></a><a href='#L2138'>2138</a>
+<a name='L2139'></a><a href='#L2139'>2139</a>
+<a name='L2140'></a><a href='#L2140'>2140</a>
+<a name='L2141'></a><a href='#L2141'>2141</a>
+<a name='L2142'></a><a href='#L2142'>2142</a>
+<a name='L2143'></a><a href='#L2143'>2143</a>
+<a name='L2144'></a><a href='#L2144'>2144</a>
+<a name='L2145'></a><a href='#L2145'>2145</a>
+<a name='L2146'></a><a href='#L2146'>2146</a>
+<a name='L2147'></a><a href='#L2147'>2147</a>
+<a name='L2148'></a><a href='#L2148'>2148</a>
+<a name='L2149'></a><a href='#L2149'>2149</a>
+<a name='L2150'></a><a href='#L2150'>2150</a>
+<a name='L2151'></a><a href='#L2151'>2151</a>
+<a name='L2152'></a><a href='#L2152'>2152</a>
+<a name='L2153'></a><a href='#L2153'>2153</a>
+<a name='L2154'></a><a href='#L2154'>2154</a>
+<a name='L2155'></a><a href='#L2155'>2155</a>
+<a name='L2156'></a><a href='#L2156'>2156</a>
+<a name='L2157'></a><a href='#L2157'>2157</a>
+<a name='L2158'></a><a href='#L2158'>2158</a>
+<a name='L2159'></a><a href='#L2159'>2159</a>
+<a name='L2160'></a><a href='#L2160'>2160</a>
+<a name='L2161'></a><a href='#L2161'>2161</a>
+<a name='L2162'></a><a href='#L2162'>2162</a>
+<a name='L2163'></a><a href='#L2163'>2163</a>
+<a name='L2164'></a><a href='#L2164'>2164</a>
+<a name='L2165'></a><a href='#L2165'>2165</a>
+<a name='L2166'></a><a href='#L2166'>2166</a>
+<a name='L2167'></a><a href='#L2167'>2167</a>
+<a name='L2168'></a><a href='#L2168'>2168</a>
+<a name='L2169'></a><a href='#L2169'>2169</a>
+<a name='L2170'></a><a href='#L2170'>2170</a>
+<a name='L2171'></a><a href='#L2171'>2171</a>
+<a name='L2172'></a><a href='#L2172'>2172</a>
+<a name='L2173'></a><a href='#L2173'>2173</a>
+<a name='L2174'></a><a href='#L2174'>2174</a>
+<a name='L2175'></a><a href='#L2175'>2175</a>
+<a name='L2176'></a><a href='#L2176'>2176</a>
+<a name='L2177'></a><a href='#L2177'>2177</a>
+<a name='L2178'></a><a href='#L2178'>2178</a>
+<a name='L2179'></a><a href='#L2179'>2179</a>
+<a name='L2180'></a><a href='#L2180'>2180</a>
+<a name='L2181'></a><a href='#L2181'>2181</a>
+<a name='L2182'></a><a href='#L2182'>2182</a>
+<a name='L2183'></a><a href='#L2183'>2183</a>
+<a name='L2184'></a><a href='#L2184'>2184</a>
+<a name='L2185'></a><a href='#L2185'>2185</a>
+<a name='L2186'></a><a href='#L2186'>2186</a>
+<a name='L2187'></a><a href='#L2187'>2187</a>
+<a name='L2188'></a><a href='#L2188'>2188</a>
+<a name='L2189'></a><a href='#L2189'>2189</a>
+<a name='L2190'></a><a href='#L2190'>2190</a>
+<a name='L2191'></a><a href='#L2191'>2191</a>
+<a name='L2192'></a><a href='#L2192'>2192</a>
+<a name='L2193'></a><a href='#L2193'>2193</a>
+<a name='L2194'></a><a href='#L2194'>2194</a>
+<a name='L2195'></a><a href='#L2195'>2195</a>
+<a name='L2196'></a><a href='#L2196'>2196</a>
+<a name='L2197'></a><a href='#L2197'>2197</a>
+<a name='L2198'></a><a href='#L2198'>2198</a>
+<a name='L2199'></a><a href='#L2199'>2199</a>
+<a name='L2200'></a><a href='#L2200'>2200</a>
+<a name='L2201'></a><a href='#L2201'>2201</a>
+<a name='L2202'></a><a href='#L2202'>2202</a>
+<a name='L2203'></a><a href='#L2203'>2203</a>
+<a name='L2204'></a><a href='#L2204'>2204</a>
+<a name='L2205'></a><a href='#L2205'>2205</a>
+<a name='L2206'></a><a href='#L2206'>2206</a>
+<a name='L2207'></a><a href='#L2207'>2207</a>
+<a name='L2208'></a><a href='#L2208'>2208</a>
+<a name='L2209'></a><a href='#L2209'>2209</a>
+<a name='L2210'></a><a href='#L2210'>2210</a>
+<a name='L2211'></a><a href='#L2211'>2211</a>
+<a name='L2212'></a><a href='#L2212'>2212</a>
+<a name='L2213'></a><a href='#L2213'>2213</a>
+<a name='L2214'></a><a href='#L2214'>2214</a>
+<a name='L2215'></a><a href='#L2215'>2215</a>
+<a name='L2216'></a><a href='#L2216'>2216</a>
+<a name='L2217'></a><a href='#L2217'>2217</a>
+<a name='L2218'></a><a href='#L2218'>2218</a>
+<a name='L2219'></a><a href='#L2219'>2219</a>
+<a name='L2220'></a><a href='#L2220'>2220</a>
+<a name='L2221'></a><a href='#L2221'>2221</a>
+<a name='L2222'></a><a href='#L2222'>2222</a>
+<a name='L2223'></a><a href='#L2223'>2223</a>
+<a name='L2224'></a><a href='#L2224'>2224</a>
+<a name='L2225'></a><a href='#L2225'>2225</a>
+<a name='L2226'></a><a href='#L2226'>2226</a>
+<a name='L2227'></a><a href='#L2227'>2227</a>
+<a name='L2228'></a><a href='#L2228'>2228</a>
+<a name='L2229'></a><a href='#L2229'>2229</a>
+<a name='L2230'></a><a href='#L2230'>2230</a>
+<a name='L2231'></a><a href='#L2231'>2231</a>
+<a name='L2232'></a><a href='#L2232'>2232</a>
+<a name='L2233'></a><a href='#L2233'>2233</a>
+<a name='L2234'></a><a href='#L2234'>2234</a>
+<a name='L2235'></a><a href='#L2235'>2235</a>
+<a name='L2236'></a><a href='#L2236'>2236</a>
+<a name='L2237'></a><a href='#L2237'>2237</a>
+<a name='L2238'></a><a href='#L2238'>2238</a>
+<a name='L2239'></a><a href='#L2239'>2239</a>
+<a name='L2240'></a><a href='#L2240'>2240</a>
+<a name='L2241'></a><a href='#L2241'>2241</a>
+<a name='L2242'></a><a href='#L2242'>2242</a>
+<a name='L2243'></a><a href='#L2243'>2243</a>
+<a name='L2244'></a><a href='#L2244'>2244</a>
+<a name='L2245'></a><a href='#L2245'>2245</a>
+<a name='L2246'></a><a href='#L2246'>2246</a>
+<a name='L2247'></a><a href='#L2247'>2247</a>
+<a name='L2248'></a><a href='#L2248'>2248</a>
+<a name='L2249'></a><a href='#L2249'>2249</a>
+<a name='L2250'></a><a href='#L2250'>2250</a>
+<a name='L2251'></a><a href='#L2251'>2251</a>
+<a name='L2252'></a><a href='#L2252'>2252</a>
+<a name='L2253'></a><a href='#L2253'>2253</a>
+<a name='L2254'></a><a href='#L2254'>2254</a>
+<a name='L2255'></a><a href='#L2255'>2255</a>
+<a name='L2256'></a><a href='#L2256'>2256</a>
+<a name='L2257'></a><a href='#L2257'>2257</a>
+<a name='L2258'></a><a href='#L2258'>2258</a>
+<a name='L2259'></a><a href='#L2259'>2259</a>
+<a name='L2260'></a><a href='#L2260'>2260</a>
+<a name='L2261'></a><a href='#L2261'>2261</a>
+<a name='L2262'></a><a href='#L2262'>2262</a>
+<a name='L2263'></a><a href='#L2263'>2263</a>
+<a name='L2264'></a><a href='#L2264'>2264</a>
+<a name='L2265'></a><a href='#L2265'>2265</a>
+<a name='L2266'></a><a href='#L2266'>2266</a>
+<a name='L2267'></a><a href='#L2267'>2267</a>
+<a name='L2268'></a><a href='#L2268'>2268</a>
+<a name='L2269'></a><a href='#L2269'>2269</a>
+<a name='L2270'></a><a href='#L2270'>2270</a>
+<a name='L2271'></a><a href='#L2271'>2271</a>
+<a name='L2272'></a><a href='#L2272'>2272</a>
+<a name='L2273'></a><a href='#L2273'>2273</a>
+<a name='L2274'></a><a href='#L2274'>2274</a>
+<a name='L2275'></a><a href='#L2275'>2275</a>
+<a name='L2276'></a><a href='#L2276'>2276</a>
+<a name='L2277'></a><a href='#L2277'>2277</a>
+<a name='L2278'></a><a href='#L2278'>2278</a>
+<a name='L2279'></a><a href='#L2279'>2279</a>
+<a name='L2280'></a><a href='#L2280'>2280</a>
+<a name='L2281'></a><a href='#L2281'>2281</a>
+<a name='L2282'></a><a href='#L2282'>2282</a>
+<a name='L2283'></a><a href='#L2283'>2283</a>
+<a name='L2284'></a><a href='#L2284'>2284</a>
+<a name='L2285'></a><a href='#L2285'>2285</a>
+<a name='L2286'></a><a href='#L2286'>2286</a>
+<a name='L2287'></a><a href='#L2287'>2287</a>
+<a name='L2288'></a><a href='#L2288'>2288</a>
+<a name='L2289'></a><a href='#L2289'>2289</a>
+<a name='L2290'></a><a href='#L2290'>2290</a>
+<a name='L2291'></a><a href='#L2291'>2291</a>
+<a name='L2292'></a><a href='#L2292'>2292</a>
+<a name='L2293'></a><a href='#L2293'>2293</a>
+<a name='L2294'></a><a href='#L2294'>2294</a>
+<a name='L2295'></a><a href='#L2295'>2295</a>
+<a name='L2296'></a><a href='#L2296'>2296</a>
+<a name='L2297'></a><a href='#L2297'>2297</a>
+<a name='L2298'></a><a href='#L2298'>2298</a>
+<a name='L2299'></a><a href='#L2299'>2299</a>
+<a name='L2300'></a><a href='#L2300'>2300</a>
+<a name='L2301'></a><a href='#L2301'>2301</a>
+<a name='L2302'></a><a href='#L2302'>2302</a>
+<a name='L2303'></a><a href='#L2303'>2303</a>
+<a name='L2304'></a><a href='#L2304'>2304</a>
+<a name='L2305'></a><a href='#L2305'>2305</a>
+<a name='L2306'></a><a href='#L2306'>2306</a>
+<a name='L2307'></a><a href='#L2307'>2307</a>
+<a name='L2308'></a><a href='#L2308'>2308</a>
+<a name='L2309'></a><a href='#L2309'>2309</a>
+<a name='L2310'></a><a href='#L2310'>2310</a>
+<a name='L2311'></a><a href='#L2311'>2311</a>
+<a name='L2312'></a><a href='#L2312'>2312</a>
+<a name='L2313'></a><a href='#L2313'>2313</a>
+<a name='L2314'></a><a href='#L2314'>2314</a>
+<a name='L2315'></a><a href='#L2315'>2315</a>
+<a name='L2316'></a><a href='#L2316'>2316</a>
+<a name='L2317'></a><a href='#L2317'>2317</a>
+<a name='L2318'></a><a href='#L2318'>2318</a>
+<a name='L2319'></a><a href='#L2319'>2319</a>
+<a name='L2320'></a><a href='#L2320'>2320</a>
+<a name='L2321'></a><a href='#L2321'>2321</a>
+<a name='L2322'></a><a href='#L2322'>2322</a>
+<a name='L2323'></a><a href='#L2323'>2323</a>
+<a name='L2324'></a><a href='#L2324'>2324</a>
+<a name='L2325'></a><a href='#L2325'>2325</a>
+<a name='L2326'></a><a href='#L2326'>2326</a>
+<a name='L2327'></a><a href='#L2327'>2327</a>
+<a name='L2328'></a><a href='#L2328'>2328</a>
+<a name='L2329'></a><a href='#L2329'>2329</a>
+<a name='L2330'></a><a href='#L2330'>2330</a>
+<a name='L2331'></a><a href='#L2331'>2331</a>
+<a name='L2332'></a><a href='#L2332'>2332</a>
+<a name='L2333'></a><a href='#L2333'>2333</a>
+<a name='L2334'></a><a href='#L2334'>2334</a>
+<a name='L2335'></a><a href='#L2335'>2335</a>
+<a name='L2336'></a><a href='#L2336'>2336</a>
+<a name='L2337'></a><a href='#L2337'>2337</a>
+<a name='L2338'></a><a href='#L2338'>2338</a>
+<a name='L2339'></a><a href='#L2339'>2339</a>
+<a name='L2340'></a><a href='#L2340'>2340</a>
+<a name='L2341'></a><a href='#L2341'>2341</a>
+<a name='L2342'></a><a href='#L2342'>2342</a>
+<a name='L2343'></a><a href='#L2343'>2343</a>
+<a name='L2344'></a><a href='#L2344'>2344</a>
+<a name='L2345'></a><a href='#L2345'>2345</a>
+<a name='L2346'></a><a href='#L2346'>2346</a>
+<a name='L2347'></a><a href='#L2347'>2347</a>
+<a name='L2348'></a><a href='#L2348'>2348</a>
+<a name='L2349'></a><a href='#L2349'>2349</a>
+<a name='L2350'></a><a href='#L2350'>2350</a>
+<a name='L2351'></a><a href='#L2351'>2351</a>
+<a name='L2352'></a><a href='#L2352'>2352</a>
+<a name='L2353'></a><a href='#L2353'>2353</a>
+<a name='L2354'></a><a href='#L2354'>2354</a>
+<a name='L2355'></a><a href='#L2355'>2355</a>
+<a name='L2356'></a><a href='#L2356'>2356</a>
+<a name='L2357'></a><a href='#L2357'>2357</a>
+<a name='L2358'></a><a href='#L2358'>2358</a>
+<a name='L2359'></a><a href='#L2359'>2359</a>
+<a name='L2360'></a><a href='#L2360'>2360</a>
+<a name='L2361'></a><a href='#L2361'>2361</a>
+<a name='L2362'></a><a href='#L2362'>2362</a>
+<a name='L2363'></a><a href='#L2363'>2363</a>
+<a name='L2364'></a><a href='#L2364'>2364</a>
+<a name='L2365'></a><a href='#L2365'>2365</a>
+<a name='L2366'></a><a href='#L2366'>2366</a>
+<a name='L2367'></a><a href='#L2367'>2367</a>
+<a name='L2368'></a><a href='#L2368'>2368</a>
+<a name='L2369'></a><a href='#L2369'>2369</a>
+<a name='L2370'></a><a href='#L2370'>2370</a>
+<a name='L2371'></a><a href='#L2371'>2371</a>
+<a name='L2372'></a><a href='#L2372'>2372</a>
+<a name='L2373'></a><a href='#L2373'>2373</a>
+<a name='L2374'></a><a href='#L2374'>2374</a>
+<a name='L2375'></a><a href='#L2375'>2375</a>
+<a name='L2376'></a><a href='#L2376'>2376</a>
+<a name='L2377'></a><a href='#L2377'>2377</a>
+<a name='L2378'></a><a href='#L2378'>2378</a>
+<a name='L2379'></a><a href='#L2379'>2379</a>
+<a name='L2380'></a><a href='#L2380'>2380</a>
+<a name='L2381'></a><a href='#L2381'>2381</a>
+<a name='L2382'></a><a href='#L2382'>2382</a>
+<a name='L2383'></a><a href='#L2383'>2383</a>
+<a name='L2384'></a><a href='#L2384'>2384</a>
+<a name='L2385'></a><a href='#L2385'>2385</a>
+<a name='L2386'></a><a href='#L2386'>2386</a>
+<a name='L2387'></a><a href='#L2387'>2387</a>
+<a name='L2388'></a><a href='#L2388'>2388</a>
+<a name='L2389'></a><a href='#L2389'>2389</a>
+<a name='L2390'></a><a href='#L2390'>2390</a>
+<a name='L2391'></a><a href='#L2391'>2391</a>
+<a name='L2392'></a><a href='#L2392'>2392</a>
+<a name='L2393'></a><a href='#L2393'>2393</a>
+<a name='L2394'></a><a href='#L2394'>2394</a>
+<a name='L2395'></a><a href='#L2395'>2395</a>
+<a name='L2396'></a><a href='#L2396'>2396</a>
+<a name='L2397'></a><a href='#L2397'>2397</a>
+<a name='L2398'></a><a href='#L2398'>2398</a>
+<a name='L2399'></a><a href='#L2399'>2399</a>
+<a name='L2400'></a><a href='#L2400'>2400</a>
+<a name='L2401'></a><a href='#L2401'>2401</a>
+<a name='L2402'></a><a href='#L2402'>2402</a>
+<a name='L2403'></a><a href='#L2403'>2403</a>
+<a name='L2404'></a><a href='#L2404'>2404</a>
+<a name='L2405'></a><a href='#L2405'>2405</a>
+<a name='L2406'></a><a href='#L2406'>2406</a>
+<a name='L2407'></a><a href='#L2407'>2407</a>
+<a name='L2408'></a><a href='#L2408'>2408</a>
+<a name='L2409'></a><a href='#L2409'>2409</a>
+<a name='L2410'></a><a href='#L2410'>2410</a>
+<a name='L2411'></a><a href='#L2411'>2411</a>
+<a name='L2412'></a><a href='#L2412'>2412</a>
+<a name='L2413'></a><a href='#L2413'>2413</a>
+<a name='L2414'></a><a href='#L2414'>2414</a>
+<a name='L2415'></a><a href='#L2415'>2415</a>
+<a name='L2416'></a><a href='#L2416'>2416</a>
+<a name='L2417'></a><a href='#L2417'>2417</a>
+<a name='L2418'></a><a href='#L2418'>2418</a>
+<a name='L2419'></a><a href='#L2419'>2419</a>
+<a name='L2420'></a><a href='#L2420'>2420</a>
+<a name='L2421'></a><a href='#L2421'>2421</a>
+<a name='L2422'></a><a href='#L2422'>2422</a>
+<a name='L2423'></a><a href='#L2423'>2423</a>
+<a name='L2424'></a><a href='#L2424'>2424</a>
+<a name='L2425'></a><a href='#L2425'>2425</a>
+<a name='L2426'></a><a href='#L2426'>2426</a>
+<a name='L2427'></a><a href='#L2427'>2427</a>
+<a name='L2428'></a><a href='#L2428'>2428</a>
+<a name='L2429'></a><a href='#L2429'>2429</a>
+<a name='L2430'></a><a href='#L2430'>2430</a>
+<a name='L2431'></a><a href='#L2431'>2431</a>
+<a name='L2432'></a><a href='#L2432'>2432</a>
+<a name='L2433'></a><a href='#L2433'>2433</a>
+<a name='L2434'></a><a href='#L2434'>2434</a>
+<a name='L2435'></a><a href='#L2435'>2435</a>
+<a name='L2436'></a><a href='#L2436'>2436</a>
+<a name='L2437'></a><a href='#L2437'>2437</a>
+<a name='L2438'></a><a href='#L2438'>2438</a>
+<a name='L2439'></a><a href='#L2439'>2439</a>
+<a name='L2440'></a><a href='#L2440'>2440</a>
+<a name='L2441'></a><a href='#L2441'>2441</a>
+<a name='L2442'></a><a href='#L2442'>2442</a>
+<a name='L2443'></a><a href='#L2443'>2443</a>
+<a name='L2444'></a><a href='#L2444'>2444</a>
+<a name='L2445'></a><a href='#L2445'>2445</a>
+<a name='L2446'></a><a href='#L2446'>2446</a>
+<a name='L2447'></a><a href='#L2447'>2447</a>
+<a name='L2448'></a><a href='#L2448'>2448</a>
+<a name='L2449'></a><a href='#L2449'>2449</a>
+<a name='L2450'></a><a href='#L2450'>2450</a>
+<a name='L2451'></a><a href='#L2451'>2451</a>
+<a name='L2452'></a><a href='#L2452'>2452</a>
+<a name='L2453'></a><a href='#L2453'>2453</a>
+<a name='L2454'></a><a href='#L2454'>2454</a>
+<a name='L2455'></a><a href='#L2455'>2455</a>
+<a name='L2456'></a><a href='#L2456'>2456</a>
+<a name='L2457'></a><a href='#L2457'>2457</a>
+<a name='L2458'></a><a href='#L2458'>2458</a>
+<a name='L2459'></a><a href='#L2459'>2459</a>
+<a name='L2460'></a><a href='#L2460'>2460</a>
+<a name='L2461'></a><a href='#L2461'>2461</a>
+<a name='L2462'></a><a href='#L2462'>2462</a>
+<a name='L2463'></a><a href='#L2463'>2463</a>
+<a name='L2464'></a><a href='#L2464'>2464</a>
+<a name='L2465'></a><a href='#L2465'>2465</a>
+<a name='L2466'></a><a href='#L2466'>2466</a>
+<a name='L2467'></a><a href='#L2467'>2467</a>
+<a name='L2468'></a><a href='#L2468'>2468</a>
+<a name='L2469'></a><a href='#L2469'>2469</a>
+<a name='L2470'></a><a href='#L2470'>2470</a>
+<a name='L2471'></a><a href='#L2471'>2471</a>
+<a name='L2472'></a><a href='#L2472'>2472</a>
+<a name='L2473'></a><a href='#L2473'>2473</a>
+<a name='L2474'></a><a href='#L2474'>2474</a>
+<a name='L2475'></a><a href='#L2475'>2475</a>
+<a name='L2476'></a><a href='#L2476'>2476</a>
+<a name='L2477'></a><a href='#L2477'>2477</a>
+<a name='L2478'></a><a href='#L2478'>2478</a>
+<a name='L2479'></a><a href='#L2479'>2479</a>
+<a name='L2480'></a><a href='#L2480'>2480</a>
+<a name='L2481'></a><a href='#L2481'>2481</a>
+<a name='L2482'></a><a href='#L2482'>2482</a>
+<a name='L2483'></a><a href='#L2483'>2483</a>
+<a name='L2484'></a><a href='#L2484'>2484</a>
+<a name='L2485'></a><a href='#L2485'>2485</a>
+<a name='L2486'></a><a href='#L2486'>2486</a>
+<a name='L2487'></a><a href='#L2487'>2487</a>
+<a name='L2488'></a><a href='#L2488'>2488</a>
+<a name='L2489'></a><a href='#L2489'>2489</a>
+<a name='L2490'></a><a href='#L2490'>2490</a>
+<a name='L2491'></a><a href='#L2491'>2491</a>
+<a name='L2492'></a><a href='#L2492'>2492</a>
+<a name='L2493'></a><a href='#L2493'>2493</a>
+<a name='L2494'></a><a href='#L2494'>2494</a>
+<a name='L2495'></a><a href='#L2495'>2495</a>
+<a name='L2496'></a><a href='#L2496'>2496</a>
+<a name='L2497'></a><a href='#L2497'>2497</a>
+<a name='L2498'></a><a href='#L2498'>2498</a>
+<a name='L2499'></a><a href='#L2499'>2499</a>
+<a name='L2500'></a><a href='#L2500'>2500</a>
+<a name='L2501'></a><a href='#L2501'>2501</a>
+<a name='L2502'></a><a href='#L2502'>2502</a>
+<a name='L2503'></a><a href='#L2503'>2503</a>
+<a name='L2504'></a><a href='#L2504'>2504</a>
+<a name='L2505'></a><a href='#L2505'>2505</a>
+<a name='L2506'></a><a href='#L2506'>2506</a>
+<a name='L2507'></a><a href='#L2507'>2507</a>
+<a name='L2508'></a><a href='#L2508'>2508</a>
+<a name='L2509'></a><a href='#L2509'>2509</a>
+<a name='L2510'></a><a href='#L2510'>2510</a>
+<a name='L2511'></a><a href='#L2511'>2511</a>
+<a name='L2512'></a><a href='#L2512'>2512</a>
+<a name='L2513'></a><a href='#L2513'>2513</a>
+<a name='L2514'></a><a href='#L2514'>2514</a>
+<a name='L2515'></a><a href='#L2515'>2515</a>
+<a name='L2516'></a><a href='#L2516'>2516</a>
+<a name='L2517'></a><a href='#L2517'>2517</a>
+<a name='L2518'></a><a href='#L2518'>2518</a>
+<a name='L2519'></a><a href='#L2519'>2519</a>
+<a name='L2520'></a><a href='#L2520'>2520</a>
+<a name='L2521'></a><a href='#L2521'>2521</a>
+<a name='L2522'></a><a href='#L2522'>2522</a>
+<a name='L2523'></a><a href='#L2523'>2523</a>
+<a name='L2524'></a><a href='#L2524'>2524</a>
+<a name='L2525'></a><a href='#L2525'>2525</a>
+<a name='L2526'></a><a href='#L2526'>2526</a>
+<a name='L2527'></a><a href='#L2527'>2527</a>
+<a name='L2528'></a><a href='#L2528'>2528</a>
+<a name='L2529'></a><a href='#L2529'>2529</a>
+<a name='L2530'></a><a href='#L2530'>2530</a>
+<a name='L2531'></a><a href='#L2531'>2531</a>
+<a name='L2532'></a><a href='#L2532'>2532</a>
+<a name='L2533'></a><a href='#L2533'>2533</a>
+<a name='L2534'></a><a href='#L2534'>2534</a>
+<a name='L2535'></a><a href='#L2535'>2535</a>
+<a name='L2536'></a><a href='#L2536'>2536</a>
+<a name='L2537'></a><a href='#L2537'>2537</a>
+<a name='L2538'></a><a href='#L2538'>2538</a>
+<a name='L2539'></a><a href='#L2539'>2539</a>
+<a name='L2540'></a><a href='#L2540'>2540</a>
+<a name='L2541'></a><a href='#L2541'>2541</a>
+<a name='L2542'></a><a href='#L2542'>2542</a>
+<a name='L2543'></a><a href='#L2543'>2543</a>
+<a name='L2544'></a><a href='#L2544'>2544</a>
+<a name='L2545'></a><a href='#L2545'>2545</a>
+<a name='L2546'></a><a href='#L2546'>2546</a>
+<a name='L2547'></a><a href='#L2547'>2547</a>
+<a name='L2548'></a><a href='#L2548'>2548</a>
+<a name='L2549'></a><a href='#L2549'>2549</a>
+<a name='L2550'></a><a href='#L2550'>2550</a>
+<a name='L2551'></a><a href='#L2551'>2551</a>
+<a name='L2552'></a><a href='#L2552'>2552</a>
+<a name='L2553'></a><a href='#L2553'>2553</a>
+<a name='L2554'></a><a href='#L2554'>2554</a>
+<a name='L2555'></a><a href='#L2555'>2555</a>
+<a name='L2556'></a><a href='#L2556'>2556</a>
+<a name='L2557'></a><a href='#L2557'>2557</a>
+<a name='L2558'></a><a href='#L2558'>2558</a>
+<a name='L2559'></a><a href='#L2559'>2559</a>
+<a name='L2560'></a><a href='#L2560'>2560</a>
+<a name='L2561'></a><a href='#L2561'>2561</a>
+<a name='L2562'></a><a href='#L2562'>2562</a>
+<a name='L2563'></a><a href='#L2563'>2563</a>
+<a name='L2564'></a><a href='#L2564'>2564</a>
+<a name='L2565'></a><a href='#L2565'>2565</a>
+<a name='L2566'></a><a href='#L2566'>2566</a>
+<a name='L2567'></a><a href='#L2567'>2567</a>
+<a name='L2568'></a><a href='#L2568'>2568</a>
+<a name='L2569'></a><a href='#L2569'>2569</a>
+<a name='L2570'></a><a href='#L2570'>2570</a>
+<a name='L2571'></a><a href='#L2571'>2571</a>
+<a name='L2572'></a><a href='#L2572'>2572</a>
+<a name='L2573'></a><a href='#L2573'>2573</a>
+<a name='L2574'></a><a href='#L2574'>2574</a>
+<a name='L2575'></a><a href='#L2575'>2575</a>
+<a name='L2576'></a><a href='#L2576'>2576</a>
+<a name='L2577'></a><a href='#L2577'>2577</a>
+<a name='L2578'></a><a href='#L2578'>2578</a>
+<a name='L2579'></a><a href='#L2579'>2579</a>
+<a name='L2580'></a><a href='#L2580'>2580</a>
+<a name='L2581'></a><a href='#L2581'>2581</a>
+<a name='L2582'></a><a href='#L2582'>2582</a>
+<a name='L2583'></a><a href='#L2583'>2583</a>
+<a name='L2584'></a><a href='#L2584'>2584</a>
+<a name='L2585'></a><a href='#L2585'>2585</a>
+<a name='L2586'></a><a href='#L2586'>2586</a>
+<a name='L2587'></a><a href='#L2587'>2587</a>
+<a name='L2588'></a><a href='#L2588'>2588</a>
+<a name='L2589'></a><a href='#L2589'>2589</a>
+<a name='L2590'></a><a href='#L2590'>2590</a>
+<a name='L2591'></a><a href='#L2591'>2591</a>
+<a name='L2592'></a><a href='#L2592'>2592</a>
+<a name='L2593'></a><a href='#L2593'>2593</a>
+<a name='L2594'></a><a href='#L2594'>2594</a>
+<a name='L2595'></a><a href='#L2595'>2595</a>
+<a name='L2596'></a><a href='#L2596'>2596</a>
+<a name='L2597'></a><a href='#L2597'>2597</a>
+<a name='L2598'></a><a href='#L2598'>2598</a>
+<a name='L2599'></a><a href='#L2599'>2599</a>
+<a name='L2600'></a><a href='#L2600'>2600</a>
+<a name='L2601'></a><a href='#L2601'>2601</a>
+<a name='L2602'></a><a href='#L2602'>2602</a>
+<a name='L2603'></a><a href='#L2603'>2603</a>
+<a name='L2604'></a><a href='#L2604'>2604</a>
+<a name='L2605'></a><a href='#L2605'>2605</a>
+<a name='L2606'></a><a href='#L2606'>2606</a>
+<a name='L2607'></a><a href='#L2607'>2607</a>
+<a name='L2608'></a><a href='#L2608'>2608</a>
+<a name='L2609'></a><a href='#L2609'>2609</a>
+<a name='L2610'></a><a href='#L2610'>2610</a>
+<a name='L2611'></a><a href='#L2611'>2611</a>
+<a name='L2612'></a><a href='#L2612'>2612</a>
+<a name='L2613'></a><a href='#L2613'>2613</a>
+<a name='L2614'></a><a href='#L2614'>2614</a>
+<a name='L2615'></a><a href='#L2615'>2615</a>
+<a name='L2616'></a><a href='#L2616'>2616</a>
+<a name='L2617'></a><a href='#L2617'>2617</a>
+<a name='L2618'></a><a href='#L2618'>2618</a>
+<a name='L2619'></a><a href='#L2619'>2619</a>
+<a name='L2620'></a><a href='#L2620'>2620</a>
+<a name='L2621'></a><a href='#L2621'>2621</a>
+<a name='L2622'></a><a href='#L2622'>2622</a>
+<a name='L2623'></a><a href='#L2623'>2623</a>
+<a name='L2624'></a><a href='#L2624'>2624</a>
+<a name='L2625'></a><a href='#L2625'>2625</a>
+<a name='L2626'></a><a href='#L2626'>2626</a>
+<a name='L2627'></a><a href='#L2627'>2627</a>
+<a name='L2628'></a><a href='#L2628'>2628</a>
+<a name='L2629'></a><a href='#L2629'>2629</a>
+<a name='L2630'></a><a href='#L2630'>2630</a>
+<a name='L2631'></a><a href='#L2631'>2631</a>
+<a name='L2632'></a><a href='#L2632'>2632</a>
+<a name='L2633'></a><a href='#L2633'>2633</a>
+<a name='L2634'></a><a href='#L2634'>2634</a>
+<a name='L2635'></a><a href='#L2635'>2635</a>
+<a name='L2636'></a><a href='#L2636'>2636</a>
+<a name='L2637'></a><a href='#L2637'>2637</a>
+<a name='L2638'></a><a href='#L2638'>2638</a>
+<a name='L2639'></a><a href='#L2639'>2639</a>
+<a name='L2640'></a><a href='#L2640'>2640</a>
+<a name='L2641'></a><a href='#L2641'>2641</a>
+<a name='L2642'></a><a href='#L2642'>2642</a>
+<a name='L2643'></a><a href='#L2643'>2643</a>
+<a name='L2644'></a><a href='#L2644'>2644</a>
+<a name='L2645'></a><a href='#L2645'>2645</a>
+<a name='L2646'></a><a href='#L2646'>2646</a>
+<a name='L2647'></a><a href='#L2647'>2647</a>
+<a name='L2648'></a><a href='#L2648'>2648</a>
+<a name='L2649'></a><a href='#L2649'>2649</a>
+<a name='L2650'></a><a href='#L2650'>2650</a>
+<a name='L2651'></a><a href='#L2651'>2651</a>
+<a name='L2652'></a><a href='#L2652'>2652</a>
+<a name='L2653'></a><a href='#L2653'>2653</a>
+<a name='L2654'></a><a href='#L2654'>2654</a>
+<a name='L2655'></a><a href='#L2655'>2655</a>
+<a name='L2656'></a><a href='#L2656'>2656</a>
+<a name='L2657'></a><a href='#L2657'>2657</a>
+<a name='L2658'></a><a href='#L2658'>2658</a>
+<a name='L2659'></a><a href='#L2659'>2659</a>
+<a name='L2660'></a><a href='#L2660'>2660</a>
+<a name='L2661'></a><a href='#L2661'>2661</a>
+<a name='L2662'></a><a href='#L2662'>2662</a>
+<a name='L2663'></a><a href='#L2663'>2663</a>
+<a name='L2664'></a><a href='#L2664'>2664</a>
+<a name='L2665'></a><a href='#L2665'>2665</a>
+<a name='L2666'></a><a href='#L2666'>2666</a>
+<a name='L2667'></a><a href='#L2667'>2667</a>
+<a name='L2668'></a><a href='#L2668'>2668</a>
+<a name='L2669'></a><a href='#L2669'>2669</a>
+<a name='L2670'></a><a href='#L2670'>2670</a>
+<a name='L2671'></a><a href='#L2671'>2671</a>
+<a name='L2672'></a><a href='#L2672'>2672</a>
+<a name='L2673'></a><a href='#L2673'>2673</a>
+<a name='L2674'></a><a href='#L2674'>2674</a>
+<a name='L2675'></a><a href='#L2675'>2675</a>
+<a name='L2676'></a><a href='#L2676'>2676</a>
+<a name='L2677'></a><a href='#L2677'>2677</a>
+<a name='L2678'></a><a href='#L2678'>2678</a>
+<a name='L2679'></a><a href='#L2679'>2679</a>
+<a name='L2680'></a><a href='#L2680'>2680</a>
+<a name='L2681'></a><a href='#L2681'>2681</a>
+<a name='L2682'></a><a href='#L2682'>2682</a>
+<a name='L2683'></a><a href='#L2683'>2683</a>
+<a name='L2684'></a><a href='#L2684'>2684</a>
+<a name='L2685'></a><a href='#L2685'>2685</a>
+<a name='L2686'></a><a href='#L2686'>2686</a>
+<a name='L2687'></a><a href='#L2687'>2687</a>
+<a name='L2688'></a><a href='#L2688'>2688</a>
+<a name='L2689'></a><a href='#L2689'>2689</a>
+<a name='L2690'></a><a href='#L2690'>2690</a>
+<a name='L2691'></a><a href='#L2691'>2691</a>
+<a name='L2692'></a><a href='#L2692'>2692</a>
+<a name='L2693'></a><a href='#L2693'>2693</a>
+<a name='L2694'></a><a href='#L2694'>2694</a>
+<a name='L2695'></a><a href='#L2695'>2695</a>
+<a name='L2696'></a><a href='#L2696'>2696</a>
+<a name='L2697'></a><a href='#L2697'>2697</a>
+<a name='L2698'></a><a href='#L2698'>2698</a>
+<a name='L2699'></a><a href='#L2699'>2699</a>
+<a name='L2700'></a><a href='#L2700'>2700</a>
+<a name='L2701'></a><a href='#L2701'>2701</a>
+<a name='L2702'></a><a href='#L2702'>2702</a>
+<a name='L2703'></a><a href='#L2703'>2703</a>
+<a name='L2704'></a><a href='#L2704'>2704</a>
+<a name='L2705'></a><a href='#L2705'>2705</a>
+<a name='L2706'></a><a href='#L2706'>2706</a>
+<a name='L2707'></a><a href='#L2707'>2707</a>
+<a name='L2708'></a><a href='#L2708'>2708</a>
+<a name='L2709'></a><a href='#L2709'>2709</a>
+<a name='L2710'></a><a href='#L2710'>2710</a>
+<a name='L2711'></a><a href='#L2711'>2711</a>
+<a name='L2712'></a><a href='#L2712'>2712</a>
+<a name='L2713'></a><a href='#L2713'>2713</a>
+<a name='L2714'></a><a href='#L2714'>2714</a>
+<a name='L2715'></a><a href='#L2715'>2715</a>
+<a name='L2716'></a><a href='#L2716'>2716</a>
+<a name='L2717'></a><a href='#L2717'>2717</a>
+<a name='L2718'></a><a href='#L2718'>2718</a>
+<a name='L2719'></a><a href='#L2719'>2719</a>
+<a name='L2720'></a><a href='#L2720'>2720</a>
+<a name='L2721'></a><a href='#L2721'>2721</a>
+<a name='L2722'></a><a href='#L2722'>2722</a>
+<a name='L2723'></a><a href='#L2723'>2723</a>
+<a name='L2724'></a><a href='#L2724'>2724</a>
+<a name='L2725'></a><a href='#L2725'>2725</a>
+<a name='L2726'></a><a href='#L2726'>2726</a>
+<a name='L2727'></a><a href='#L2727'>2727</a>
+<a name='L2728'></a><a href='#L2728'>2728</a>
+<a name='L2729'></a><a href='#L2729'>2729</a>
+<a name='L2730'></a><a href='#L2730'>2730</a>
+<a name='L2731'></a><a href='#L2731'>2731</a>
+<a name='L2732'></a><a href='#L2732'>2732</a>
+<a name='L2733'></a><a href='#L2733'>2733</a>
+<a name='L2734'></a><a href='#L2734'>2734</a>
+<a name='L2735'></a><a href='#L2735'>2735</a>
+<a name='L2736'></a><a href='#L2736'>2736</a>
+<a name='L2737'></a><a href='#L2737'>2737</a>
+<a name='L2738'></a><a href='#L2738'>2738</a>
+<a name='L2739'></a><a href='#L2739'>2739</a>
+<a name='L2740'></a><a href='#L2740'>2740</a>
+<a name='L2741'></a><a href='#L2741'>2741</a>
+<a name='L2742'></a><a href='#L2742'>2742</a>
+<a name='L2743'></a><a href='#L2743'>2743</a>
+<a name='L2744'></a><a href='#L2744'>2744</a>
+<a name='L2745'></a><a href='#L2745'>2745</a>
+<a name='L2746'></a><a href='#L2746'>2746</a>
+<a name='L2747'></a><a href='#L2747'>2747</a>
+<a name='L2748'></a><a href='#L2748'>2748</a>
+<a name='L2749'></a><a href='#L2749'>2749</a>
+<a name='L2750'></a><a href='#L2750'>2750</a>
+<a name='L2751'></a><a href='#L2751'>2751</a>
+<a name='L2752'></a><a href='#L2752'>2752</a>
+<a name='L2753'></a><a href='#L2753'>2753</a>
+<a name='L2754'></a><a href='#L2754'>2754</a>
+<a name='L2755'></a><a href='#L2755'>2755</a>
+<a name='L2756'></a><a href='#L2756'>2756</a>
+<a name='L2757'></a><a href='#L2757'>2757</a>
+<a name='L2758'></a><a href='#L2758'>2758</a>
+<a name='L2759'></a><a href='#L2759'>2759</a>
+<a name='L2760'></a><a href='#L2760'>2760</a>
+<a name='L2761'></a><a href='#L2761'>2761</a>
+<a name='L2762'></a><a href='#L2762'>2762</a>
+<a name='L2763'></a><a href='#L2763'>2763</a>
+<a name='L2764'></a><a href='#L2764'>2764</a>
+<a name='L2765'></a><a href='#L2765'>2765</a>
+<a name='L2766'></a><a href='#L2766'>2766</a>
+<a name='L2767'></a><a href='#L2767'>2767</a>
+<a name='L2768'></a><a href='#L2768'>2768</a>
+<a name='L2769'></a><a href='#L2769'>2769</a>
+<a name='L2770'></a><a href='#L2770'>2770</a>
+<a name='L2771'></a><a href='#L2771'>2771</a>
+<a name='L2772'></a><a href='#L2772'>2772</a>
+<a name='L2773'></a><a href='#L2773'>2773</a>
+<a name='L2774'></a><a href='#L2774'>2774</a>
+<a name='L2775'></a><a href='#L2775'>2775</a>
+<a name='L2776'></a><a href='#L2776'>2776</a>
+<a name='L2777'></a><a href='#L2777'>2777</a>
+<a name='L2778'></a><a href='#L2778'>2778</a>
+<a name='L2779'></a><a href='#L2779'>2779</a>
+<a name='L2780'></a><a href='#L2780'>2780</a>
+<a name='L2781'></a><a href='#L2781'>2781</a>
+<a name='L2782'></a><a href='#L2782'>2782</a>
+<a name='L2783'></a><a href='#L2783'>2783</a>
+<a name='L2784'></a><a href='#L2784'>2784</a>
+<a name='L2785'></a><a href='#L2785'>2785</a>
+<a name='L2786'></a><a href='#L2786'>2786</a>
+<a name='L2787'></a><a href='#L2787'>2787</a>
+<a name='L2788'></a><a href='#L2788'>2788</a>
+<a name='L2789'></a><a href='#L2789'>2789</a>
+<a name='L2790'></a><a href='#L2790'>2790</a>
+<a name='L2791'></a><a href='#L2791'>2791</a>
+<a name='L2792'></a><a href='#L2792'>2792</a>
+<a name='L2793'></a><a href='#L2793'>2793</a>
+<a name='L2794'></a><a href='#L2794'>2794</a>
+<a name='L2795'></a><a href='#L2795'>2795</a>
+<a name='L2796'></a><a href='#L2796'>2796</a>
+<a name='L2797'></a><a href='#L2797'>2797</a>
+<a name='L2798'></a><a href='#L2798'>2798</a>
+<a name='L2799'></a><a href='#L2799'>2799</a>
+<a name='L2800'></a><a href='#L2800'>2800</a>
+<a name='L2801'></a><a href='#L2801'>2801</a>
+<a name='L2802'></a><a href='#L2802'>2802</a>
+<a name='L2803'></a><a href='#L2803'>2803</a>
+<a name='L2804'></a><a href='#L2804'>2804</a>
+<a name='L2805'></a><a href='#L2805'>2805</a>
+<a name='L2806'></a><a href='#L2806'>2806</a>
+<a name='L2807'></a><a href='#L2807'>2807</a>
+<a name='L2808'></a><a href='#L2808'>2808</a>
+<a name='L2809'></a><a href='#L2809'>2809</a>
+<a name='L2810'></a><a href='#L2810'>2810</a>
+<a name='L2811'></a><a href='#L2811'>2811</a>
+<a name='L2812'></a><a href='#L2812'>2812</a>
+<a name='L2813'></a><a href='#L2813'>2813</a>
+<a name='L2814'></a><a href='#L2814'>2814</a>
+<a name='L2815'></a><a href='#L2815'>2815</a>
+<a name='L2816'></a><a href='#L2816'>2816</a>
+<a name='L2817'></a><a href='#L2817'>2817</a>
+<a name='L2818'></a><a href='#L2818'>2818</a>
+<a name='L2819'></a><a href='#L2819'>2819</a>
+<a name='L2820'></a><a href='#L2820'>2820</a>
+<a name='L2821'></a><a href='#L2821'>2821</a>
+<a name='L2822'></a><a href='#L2822'>2822</a>
+<a name='L2823'></a><a href='#L2823'>2823</a>
+<a name='L2824'></a><a href='#L2824'>2824</a>
+<a name='L2825'></a><a href='#L2825'>2825</a>
+<a name='L2826'></a><a href='#L2826'>2826</a>
+<a name='L2827'></a><a href='#L2827'>2827</a>
+<a name='L2828'></a><a href='#L2828'>2828</a>
+<a name='L2829'></a><a href='#L2829'>2829</a>
+<a name='L2830'></a><a href='#L2830'>2830</a>
+<a name='L2831'></a><a href='#L2831'>2831</a>
+<a name='L2832'></a><a href='#L2832'>2832</a>
+<a name='L2833'></a><a href='#L2833'>2833</a>
+<a name='L2834'></a><a href='#L2834'>2834</a>
+<a name='L2835'></a><a href='#L2835'>2835</a>
+<a name='L2836'></a><a href='#L2836'>2836</a>
+<a name='L2837'></a><a href='#L2837'>2837</a>
+<a name='L2838'></a><a href='#L2838'>2838</a>
+<a name='L2839'></a><a href='#L2839'>2839</a>
+<a name='L2840'></a><a href='#L2840'>2840</a>
+<a name='L2841'></a><a href='#L2841'>2841</a>
+<a name='L2842'></a><a href='#L2842'>2842</a>
+<a name='L2843'></a><a href='#L2843'>2843</a>
+<a name='L2844'></a><a href='#L2844'>2844</a>
+<a name='L2845'></a><a href='#L2845'>2845</a>
+<a name='L2846'></a><a href='#L2846'>2846</a>
+<a name='L2847'></a><a href='#L2847'>2847</a>
+<a name='L2848'></a><a href='#L2848'>2848</a>
+<a name='L2849'></a><a href='#L2849'>2849</a>
+<a name='L2850'></a><a href='#L2850'>2850</a>
+<a name='L2851'></a><a href='#L2851'>2851</a>
+<a name='L2852'></a><a href='#L2852'>2852</a>
+<a name='L2853'></a><a href='#L2853'>2853</a>
+<a name='L2854'></a><a href='#L2854'>2854</a>
+<a name='L2855'></a><a href='#L2855'>2855</a>
+<a name='L2856'></a><a href='#L2856'>2856</a>
+<a name='L2857'></a><a href='#L2857'>2857</a>
+<a name='L2858'></a><a href='#L2858'>2858</a>
+<a name='L2859'></a><a href='#L2859'>2859</a>
+<a name='L2860'></a><a href='#L2860'>2860</a>
+<a name='L2861'></a><a href='#L2861'>2861</a>
+<a name='L2862'></a><a href='#L2862'>2862</a>
+<a name='L2863'></a><a href='#L2863'>2863</a>
+<a name='L2864'></a><a href='#L2864'>2864</a>
+<a name='L2865'></a><a href='#L2865'>2865</a>
+<a name='L2866'></a><a href='#L2866'>2866</a>
+<a name='L2867'></a><a href='#L2867'>2867</a>
+<a name='L2868'></a><a href='#L2868'>2868</a>
+<a name='L2869'></a><a href='#L2869'>2869</a>
+<a name='L2870'></a><a href='#L2870'>2870</a>
+<a name='L2871'></a><a href='#L2871'>2871</a>
+<a name='L2872'></a><a href='#L2872'>2872</a>
+<a name='L2873'></a><a href='#L2873'>2873</a>
+<a name='L2874'></a><a href='#L2874'>2874</a>
+<a name='L2875'></a><a href='#L2875'>2875</a>
+<a name='L2876'></a><a href='#L2876'>2876</a>
+<a name='L2877'></a><a href='#L2877'>2877</a>
+<a name='L2878'></a><a href='#L2878'>2878</a>
+<a name='L2879'></a><a href='#L2879'>2879</a>
+<a name='L2880'></a><a href='#L2880'>2880</a>
+<a name='L2881'></a><a href='#L2881'>2881</a>
+<a name='L2882'></a><a href='#L2882'>2882</a>
+<a name='L2883'></a><a href='#L2883'>2883</a>
+<a name='L2884'></a><a href='#L2884'>2884</a>
+<a name='L2885'></a><a href='#L2885'>2885</a>
+<a name='L2886'></a><a href='#L2886'>2886</a>
+<a name='L2887'></a><a href='#L2887'>2887</a>
+<a name='L2888'></a><a href='#L2888'>2888</a>
+<a name='L2889'></a><a href='#L2889'>2889</a>
+<a name='L2890'></a><a href='#L2890'>2890</a>
+<a name='L2891'></a><a href='#L2891'>2891</a>
+<a name='L2892'></a><a href='#L2892'>2892</a>
+<a name='L2893'></a><a href='#L2893'>2893</a>
+<a name='L2894'></a><a href='#L2894'>2894</a>
+<a name='L2895'></a><a href='#L2895'>2895</a>
+<a name='L2896'></a><a href='#L2896'>2896</a>
+<a name='L2897'></a><a href='#L2897'>2897</a>
+<a name='L2898'></a><a href='#L2898'>2898</a>
+<a name='L2899'></a><a href='#L2899'>2899</a>
+<a name='L2900'></a><a href='#L2900'>2900</a>
+<a name='L2901'></a><a href='#L2901'>2901</a>
+<a name='L2902'></a><a href='#L2902'>2902</a>
+<a name='L2903'></a><a href='#L2903'>2903</a>
+<a name='L2904'></a><a href='#L2904'>2904</a>
+<a name='L2905'></a><a href='#L2905'>2905</a>
+<a name='L2906'></a><a href='#L2906'>2906</a>
+<a name='L2907'></a><a href='#L2907'>2907</a>
+<a name='L2908'></a><a href='#L2908'>2908</a>
+<a name='L2909'></a><a href='#L2909'>2909</a>
+<a name='L2910'></a><a href='#L2910'>2910</a>
+<a name='L2911'></a><a href='#L2911'>2911</a>
+<a name='L2912'></a><a href='#L2912'>2912</a>
+<a name='L2913'></a><a href='#L2913'>2913</a>
+<a name='L2914'></a><a href='#L2914'>2914</a>
+<a name='L2915'></a><a href='#L2915'>2915</a>
+<a name='L2916'></a><a href='#L2916'>2916</a>
+<a name='L2917'></a><a href='#L2917'>2917</a>
+<a name='L2918'></a><a href='#L2918'>2918</a>
+<a name='L2919'></a><a href='#L2919'>2919</a>
+<a name='L2920'></a><a href='#L2920'>2920</a>
+<a name='L2921'></a><a href='#L2921'>2921</a>
+<a name='L2922'></a><a href='#L2922'>2922</a>
+<a name='L2923'></a><a href='#L2923'>2923</a>
+<a name='L2924'></a><a href='#L2924'>2924</a>
+<a name='L2925'></a><a href='#L2925'>2925</a>
+<a name='L2926'></a><a href='#L2926'>2926</a>
+<a name='L2927'></a><a href='#L2927'>2927</a>
+<a name='L2928'></a><a href='#L2928'>2928</a>
+<a name='L2929'></a><a href='#L2929'>2929</a>
+<a name='L2930'></a><a href='#L2930'>2930</a>
+<a name='L2931'></a><a href='#L2931'>2931</a>
+<a name='L2932'></a><a href='#L2932'>2932</a>
+<a name='L2933'></a><a href='#L2933'>2933</a>
+<a name='L2934'></a><a href='#L2934'>2934</a>
+<a name='L2935'></a><a href='#L2935'>2935</a>
+<a name='L2936'></a><a href='#L2936'>2936</a>
+<a name='L2937'></a><a href='#L2937'>2937</a>
+<a name='L2938'></a><a href='#L2938'>2938</a>
+<a name='L2939'></a><a href='#L2939'>2939</a>
+<a name='L2940'></a><a href='#L2940'>2940</a>
+<a name='L2941'></a><a href='#L2941'>2941</a>
+<a name='L2942'></a><a href='#L2942'>2942</a>
+<a name='L2943'></a><a href='#L2943'>2943</a>
+<a name='L2944'></a><a href='#L2944'>2944</a>
+<a name='L2945'></a><a href='#L2945'>2945</a>
+<a name='L2946'></a><a href='#L2946'>2946</a>
+<a name='L2947'></a><a href='#L2947'>2947</a>
+<a name='L2948'></a><a href='#L2948'>2948</a>
+<a name='L2949'></a><a href='#L2949'>2949</a>
+<a name='L2950'></a><a href='#L2950'>2950</a>
+<a name='L2951'></a><a href='#L2951'>2951</a>
+<a name='L2952'></a><a href='#L2952'>2952</a>
+<a name='L2953'></a><a href='#L2953'>2953</a>
+<a name='L2954'></a><a href='#L2954'>2954</a>
+<a name='L2955'></a><a href='#L2955'>2955</a>
+<a name='L2956'></a><a href='#L2956'>2956</a>
+<a name='L2957'></a><a href='#L2957'>2957</a>
+<a name='L2958'></a><a href='#L2958'>2958</a>
+<a name='L2959'></a><a href='#L2959'>2959</a>
+<a name='L2960'></a><a href='#L2960'>2960</a>
+<a name='L2961'></a><a href='#L2961'>2961</a>
+<a name='L2962'></a><a href='#L2962'>2962</a>
+<a name='L2963'></a><a href='#L2963'>2963</a>
+<a name='L2964'></a><a href='#L2964'>2964</a>
+<a name='L2965'></a><a href='#L2965'>2965</a>
+<a name='L2966'></a><a href='#L2966'>2966</a>
+<a name='L2967'></a><a href='#L2967'>2967</a>
+<a name='L2968'></a><a href='#L2968'>2968</a>
+<a name='L2969'></a><a href='#L2969'>2969</a>
+<a name='L2970'></a><a href='#L2970'>2970</a>
+<a name='L2971'></a><a href='#L2971'>2971</a>
+<a name='L2972'></a><a href='#L2972'>2972</a>
+<a name='L2973'></a><a href='#L2973'>2973</a>
+<a name='L2974'></a><a href='#L2974'>2974</a>
+<a name='L2975'></a><a href='#L2975'>2975</a>
+<a name='L2976'></a><a href='#L2976'>2976</a>
+<a name='L2977'></a><a href='#L2977'>2977</a>
+<a name='L2978'></a><a href='#L2978'>2978</a>
+<a name='L2979'></a><a href='#L2979'>2979</a>
+<a name='L2980'></a><a href='#L2980'>2980</a>
+<a name='L2981'></a><a href='#L2981'>2981</a>
+<a name='L2982'></a><a href='#L2982'>2982</a>
+<a name='L2983'></a><a href='#L2983'>2983</a>
+<a name='L2984'></a><a href='#L2984'>2984</a>
+<a name='L2985'></a><a href='#L2985'>2985</a>
+<a name='L2986'></a><a href='#L2986'>2986</a>
+<a name='L2987'></a><a href='#L2987'>2987</a>
+<a name='L2988'></a><a href='#L2988'>2988</a>
+<a name='L2989'></a><a href='#L2989'>2989</a>
+<a name='L2990'></a><a href='#L2990'>2990</a>
+<a name='L2991'></a><a href='#L2991'>2991</a>
+<a name='L2992'></a><a href='#L2992'>2992</a>
+<a name='L2993'></a><a href='#L2993'>2993</a>
+<a name='L2994'></a><a href='#L2994'>2994</a>
+<a name='L2995'></a><a href='#L2995'>2995</a>
+<a name='L2996'></a><a href='#L2996'>2996</a>
+<a name='L2997'></a><a href='#L2997'>2997</a>
+<a name='L2998'></a><a href='#L2998'>2998</a>
+<a name='L2999'></a><a href='#L2999'>2999</a>
+<a name='L3000'></a><a href='#L3000'>3000</a>
+<a name='L3001'></a><a href='#L3001'>3001</a>
+<a name='L3002'></a><a href='#L3002'>3002</a>
+<a name='L3003'></a><a href='#L3003'>3003</a>
+<a name='L3004'></a><a href='#L3004'>3004</a>
+<a name='L3005'></a><a href='#L3005'>3005</a>
+<a name='L3006'></a><a href='#L3006'>3006</a>
+<a name='L3007'></a><a href='#L3007'>3007</a>
+<a name='L3008'></a><a href='#L3008'>3008</a>
+<a name='L3009'></a><a href='#L3009'>3009</a>
+<a name='L3010'></a><a href='#L3010'>3010</a>
+<a name='L3011'></a><a href='#L3011'>3011</a>
+<a name='L3012'></a><a href='#L3012'>3012</a>
+<a name='L3013'></a><a href='#L3013'>3013</a>
+<a name='L3014'></a><a href='#L3014'>3014</a>
+<a name='L3015'></a><a href='#L3015'>3015</a>
+<a name='L3016'></a><a href='#L3016'>3016</a>
+<a name='L3017'></a><a href='#L3017'>3017</a>
+<a name='L3018'></a><a href='#L3018'>3018</a>
+<a name='L3019'></a><a href='#L3019'>3019</a>
+<a name='L3020'></a><a href='#L3020'>3020</a>
+<a name='L3021'></a><a href='#L3021'>3021</a>
+<a name='L3022'></a><a href='#L3022'>3022</a>
+<a name='L3023'></a><a href='#L3023'>3023</a>
+<a name='L3024'></a><a href='#L3024'>3024</a>
+<a name='L3025'></a><a href='#L3025'>3025</a>
+<a name='L3026'></a><a href='#L3026'>3026</a>
+<a name='L3027'></a><a href='#L3027'>3027</a>
+<a name='L3028'></a><a href='#L3028'>3028</a>
+<a name='L3029'></a><a href='#L3029'>3029</a>
+<a name='L3030'></a><a href='#L3030'>3030</a>
+<a name='L3031'></a><a href='#L3031'>3031</a>
+<a name='L3032'></a><a href='#L3032'>3032</a>
+<a name='L3033'></a><a href='#L3033'>3033</a>
+<a name='L3034'></a><a href='#L3034'>3034</a>
+<a name='L3035'></a><a href='#L3035'>3035</a>
+<a name='L3036'></a><a href='#L3036'>3036</a>
+<a name='L3037'></a><a href='#L3037'>3037</a>
+<a name='L3038'></a><a href='#L3038'>3038</a>
+<a name='L3039'></a><a href='#L3039'>3039</a>
+<a name='L3040'></a><a href='#L3040'>3040</a>
+<a name='L3041'></a><a href='#L3041'>3041</a>
+<a name='L3042'></a><a href='#L3042'>3042</a>
+<a name='L3043'></a><a href='#L3043'>3043</a>
+<a name='L3044'></a><a href='#L3044'>3044</a>
+<a name='L3045'></a><a href='#L3045'>3045</a>
+<a name='L3046'></a><a href='#L3046'>3046</a>
+<a name='L3047'></a><a href='#L3047'>3047</a>
+<a name='L3048'></a><a href='#L3048'>3048</a>
+<a name='L3049'></a><a href='#L3049'>3049</a>
+<a name='L3050'></a><a href='#L3050'>3050</a>
+<a name='L3051'></a><a href='#L3051'>3051</a>
+<a name='L3052'></a><a href='#L3052'>3052</a>
+<a name='L3053'></a><a href='#L3053'>3053</a>
+<a name='L3054'></a><a href='#L3054'>3054</a>
+<a name='L3055'></a><a href='#L3055'>3055</a>
+<a name='L3056'></a><a href='#L3056'>3056</a>
+<a name='L3057'></a><a href='#L3057'>3057</a>
+<a name='L3058'></a><a href='#L3058'>3058</a>
+<a name='L3059'></a><a href='#L3059'>3059</a>
+<a name='L3060'></a><a href='#L3060'>3060</a>
+<a name='L3061'></a><a href='#L3061'>3061</a>
+<a name='L3062'></a><a href='#L3062'>3062</a>
+<a name='L3063'></a><a href='#L3063'>3063</a>
+<a name='L3064'></a><a href='#L3064'>3064</a>
+<a name='L3065'></a><a href='#L3065'>3065</a>
+<a name='L3066'></a><a href='#L3066'>3066</a>
+<a name='L3067'></a><a href='#L3067'>3067</a>
+<a name='L3068'></a><a href='#L3068'>3068</a>
+<a name='L3069'></a><a href='#L3069'>3069</a>
+<a name='L3070'></a><a href='#L3070'>3070</a>
+<a name='L3071'></a><a href='#L3071'>3071</a>
+<a name='L3072'></a><a href='#L3072'>3072</a>
+<a name='L3073'></a><a href='#L3073'>3073</a>
+<a name='L3074'></a><a href='#L3074'>3074</a>
+<a name='L3075'></a><a href='#L3075'>3075</a>
+<a name='L3076'></a><a href='#L3076'>3076</a>
+<a name='L3077'></a><a href='#L3077'>3077</a>
+<a name='L3078'></a><a href='#L3078'>3078</a>
+<a name='L3079'></a><a href='#L3079'>3079</a>
+<a name='L3080'></a><a href='#L3080'>3080</a>
+<a name='L3081'></a><a href='#L3081'>3081</a>
+<a name='L3082'></a><a href='#L3082'>3082</a>
+<a name='L3083'></a><a href='#L3083'>3083</a>
+<a name='L3084'></a><a href='#L3084'>3084</a>
+<a name='L3085'></a><a href='#L3085'>3085</a>
+<a name='L3086'></a><a href='#L3086'>3086</a>
+<a name='L3087'></a><a href='#L3087'>3087</a>
+<a name='L3088'></a><a href='#L3088'>3088</a>
+<a name='L3089'></a><a href='#L3089'>3089</a>
+<a name='L3090'></a><a href='#L3090'>3090</a>
+<a name='L3091'></a><a href='#L3091'>3091</a>
+<a name='L3092'></a><a href='#L3092'>3092</a>
+<a name='L3093'></a><a href='#L3093'>3093</a>
+<a name='L3094'></a><a href='#L3094'>3094</a>
+<a name='L3095'></a><a href='#L3095'>3095</a>
+<a name='L3096'></a><a href='#L3096'>3096</a>
+<a name='L3097'></a><a href='#L3097'>3097</a>
+<a name='L3098'></a><a href='#L3098'>3098</a>
+<a name='L3099'></a><a href='#L3099'>3099</a>
+<a name='L3100'></a><a href='#L3100'>3100</a>
+<a name='L3101'></a><a href='#L3101'>3101</a>
+<a name='L3102'></a><a href='#L3102'>3102</a>
+<a name='L3103'></a><a href='#L3103'>3103</a>
+<a name='L3104'></a><a href='#L3104'>3104</a>
+<a name='L3105'></a><a href='#L3105'>3105</a>
+<a name='L3106'></a><a href='#L3106'>3106</a>
+<a name='L3107'></a><a href='#L3107'>3107</a>
+<a name='L3108'></a><a href='#L3108'>3108</a>
+<a name='L3109'></a><a href='#L3109'>3109</a>
+<a name='L3110'></a><a href='#L3110'>3110</a>
+<a name='L3111'></a><a href='#L3111'>3111</a>
+<a name='L3112'></a><a href='#L3112'>3112</a>
+<a name='L3113'></a><a href='#L3113'>3113</a>
+<a name='L3114'></a><a href='#L3114'>3114</a>
+<a name='L3115'></a><a href='#L3115'>3115</a>
+<a name='L3116'></a><a href='#L3116'>3116</a>
+<a name='L3117'></a><a href='#L3117'>3117</a>
+<a name='L3118'></a><a href='#L3118'>3118</a>
+<a name='L3119'></a><a href='#L3119'>3119</a>
+<a name='L3120'></a><a href='#L3120'>3120</a>
+<a name='L3121'></a><a href='#L3121'>3121</a>
+<a name='L3122'></a><a href='#L3122'>3122</a>
+<a name='L3123'></a><a href='#L3123'>3123</a>
+<a name='L3124'></a><a href='#L3124'>3124</a>
+<a name='L3125'></a><a href='#L3125'>3125</a>
+<a name='L3126'></a><a href='#L3126'>3126</a>
+<a name='L3127'></a><a href='#L3127'>3127</a>
+<a name='L3128'></a><a href='#L3128'>3128</a>
+<a name='L3129'></a><a href='#L3129'>3129</a>
+<a name='L3130'></a><a href='#L3130'>3130</a>
+<a name='L3131'></a><a href='#L3131'>3131</a>
+<a name='L3132'></a><a href='#L3132'>3132</a>
+<a name='L3133'></a><a href='#L3133'>3133</a>
+<a name='L3134'></a><a href='#L3134'>3134</a>
+<a name='L3135'></a><a href='#L3135'>3135</a>
+<a name='L3136'></a><a href='#L3136'>3136</a>
+<a name='L3137'></a><a href='#L3137'>3137</a>
+<a name='L3138'></a><a href='#L3138'>3138</a>
+<a name='L3139'></a><a href='#L3139'>3139</a>
+<a name='L3140'></a><a href='#L3140'>3140</a>
+<a name='L3141'></a><a href='#L3141'>3141</a>
+<a name='L3142'></a><a href='#L3142'>3142</a>
+<a name='L3143'></a><a href='#L3143'>3143</a>
+<a name='L3144'></a><a href='#L3144'>3144</a>
+<a name='L3145'></a><a href='#L3145'>3145</a>
+<a name='L3146'></a><a href='#L3146'>3146</a>
+<a name='L3147'></a><a href='#L3147'>3147</a>
+<a name='L3148'></a><a href='#L3148'>3148</a>
+<a name='L3149'></a><a href='#L3149'>3149</a>
+<a name='L3150'></a><a href='#L3150'>3150</a>
+<a name='L3151'></a><a href='#L3151'>3151</a>
+<a name='L3152'></a><a href='#L3152'>3152</a>
+<a name='L3153'></a><a href='#L3153'>3153</a>
+<a name='L3154'></a><a href='#L3154'>3154</a>
+<a name='L3155'></a><a href='#L3155'>3155</a>
+<a name='L3156'></a><a href='#L3156'>3156</a>
+<a name='L3157'></a><a href='#L3157'>3157</a>
+<a name='L3158'></a><a href='#L3158'>3158</a>
+<a name='L3159'></a><a href='#L3159'>3159</a>
+<a name='L3160'></a><a href='#L3160'>3160</a>
+<a name='L3161'></a><a href='#L3161'>3161</a>
+<a name='L3162'></a><a href='#L3162'>3162</a>
+<a name='L3163'></a><a href='#L3163'>3163</a>
+<a name='L3164'></a><a href='#L3164'>3164</a>
+<a name='L3165'></a><a href='#L3165'>3165</a>
+<a name='L3166'></a><a href='#L3166'>3166</a>
+<a name='L3167'></a><a href='#L3167'>3167</a>
+<a name='L3168'></a><a href='#L3168'>3168</a>
+<a name='L3169'></a><a href='#L3169'>3169</a>
+<a name='L3170'></a><a href='#L3170'>3170</a>
+<a name='L3171'></a><a href='#L3171'>3171</a>
+<a name='L3172'></a><a href='#L3172'>3172</a>
+<a name='L3173'></a><a href='#L3173'>3173</a>
+<a name='L3174'></a><a href='#L3174'>3174</a>
+<a name='L3175'></a><a href='#L3175'>3175</a>
+<a name='L3176'></a><a href='#L3176'>3176</a>
+<a name='L3177'></a><a href='#L3177'>3177</a>
+<a name='L3178'></a><a href='#L3178'>3178</a>
+<a name='L3179'></a><a href='#L3179'>3179</a>
+<a name='L3180'></a><a href='#L3180'>3180</a>
+<a name='L3181'></a><a href='#L3181'>3181</a>
+<a name='L3182'></a><a href='#L3182'>3182</a>
+<a name='L3183'></a><a href='#L3183'>3183</a>
+<a name='L3184'></a><a href='#L3184'>3184</a>
+<a name='L3185'></a><a href='#L3185'>3185</a>
+<a name='L3186'></a><a href='#L3186'>3186</a>
+<a name='L3187'></a><a href='#L3187'>3187</a>
+<a name='L3188'></a><a href='#L3188'>3188</a>
+<a name='L3189'></a><a href='#L3189'>3189</a>
+<a name='L3190'></a><a href='#L3190'>3190</a>
+<a name='L3191'></a><a href='#L3191'>3191</a>
+<a name='L3192'></a><a href='#L3192'>3192</a>
+<a name='L3193'></a><a href='#L3193'>3193</a>
+<a name='L3194'></a><a href='#L3194'>3194</a>
+<a name='L3195'></a><a href='#L3195'>3195</a>
+<a name='L3196'></a><a href='#L3196'>3196</a>
+<a name='L3197'></a><a href='#L3197'>3197</a>
+<a name='L3198'></a><a href='#L3198'>3198</a>
+<a name='L3199'></a><a href='#L3199'>3199</a>
+<a name='L3200'></a><a href='#L3200'>3200</a>
+<a name='L3201'></a><a href='#L3201'>3201</a>
+<a name='L3202'></a><a href='#L3202'>3202</a>
+<a name='L3203'></a><a href='#L3203'>3203</a>
+<a name='L3204'></a><a href='#L3204'>3204</a>
+<a name='L3205'></a><a href='#L3205'>3205</a>
+<a name='L3206'></a><a href='#L3206'>3206</a>
+<a name='L3207'></a><a href='#L3207'>3207</a>
+<a name='L3208'></a><a href='#L3208'>3208</a>
+<a name='L3209'></a><a href='#L3209'>3209</a>
+<a name='L3210'></a><a href='#L3210'>3210</a>
+<a name='L3211'></a><a href='#L3211'>3211</a>
+<a name='L3212'></a><a href='#L3212'>3212</a>
+<a name='L3213'></a><a href='#L3213'>3213</a>
+<a name='L3214'></a><a href='#L3214'>3214</a>
+<a name='L3215'></a><a href='#L3215'>3215</a>
+<a name='L3216'></a><a href='#L3216'>3216</a>
+<a name='L3217'></a><a href='#L3217'>3217</a>
+<a name='L3218'></a><a href='#L3218'>3218</a>
+<a name='L3219'></a><a href='#L3219'>3219</a>
+<a name='L3220'></a><a href='#L3220'>3220</a>
+<a name='L3221'></a><a href='#L3221'>3221</a>
+<a name='L3222'></a><a href='#L3222'>3222</a>
+<a name='L3223'></a><a href='#L3223'>3223</a>
+<a name='L3224'></a><a href='#L3224'>3224</a>
+<a name='L3225'></a><a href='#L3225'>3225</a>
+<a name='L3226'></a><a href='#L3226'>3226</a>
+<a name='L3227'></a><a href='#L3227'>3227</a>
+<a name='L3228'></a><a href='#L3228'>3228</a>
+<a name='L3229'></a><a href='#L3229'>3229</a>
+<a name='L3230'></a><a href='#L3230'>3230</a>
+<a name='L3231'></a><a href='#L3231'>3231</a>
+<a name='L3232'></a><a href='#L3232'>3232</a>
+<a name='L3233'></a><a href='#L3233'>3233</a>
+<a name='L3234'></a><a href='#L3234'>3234</a>
+<a name='L3235'></a><a href='#L3235'>3235</a>
+<a name='L3236'></a><a href='#L3236'>3236</a>
+<a name='L3237'></a><a href='#L3237'>3237</a>
+<a name='L3238'></a><a href='#L3238'>3238</a>
+<a name='L3239'></a><a href='#L3239'>3239</a>
+<a name='L3240'></a><a href='#L3240'>3240</a>
+<a name='L3241'></a><a href='#L3241'>3241</a>
+<a name='L3242'></a><a href='#L3242'>3242</a>
+<a name='L3243'></a><a href='#L3243'>3243</a>
+<a name='L3244'></a><a href='#L3244'>3244</a>
+<a name='L3245'></a><a href='#L3245'>3245</a>
+<a name='L3246'></a><a href='#L3246'>3246</a>
+<a name='L3247'></a><a href='#L3247'>3247</a>
+<a name='L3248'></a><a href='#L3248'>3248</a>
+<a name='L3249'></a><a href='#L3249'>3249</a>
+<a name='L3250'></a><a href='#L3250'>3250</a>
+<a name='L3251'></a><a href='#L3251'>3251</a>
+<a name='L3252'></a><a href='#L3252'>3252</a>
+<a name='L3253'></a><a href='#L3253'>3253</a>
+<a name='L3254'></a><a href='#L3254'>3254</a>
+<a name='L3255'></a><a href='#L3255'>3255</a>
+<a name='L3256'></a><a href='#L3256'>3256</a>
+<a name='L3257'></a><a href='#L3257'>3257</a>
+<a name='L3258'></a><a href='#L3258'>3258</a>
+<a name='L3259'></a><a href='#L3259'>3259</a>
+<a name='L3260'></a><a href='#L3260'>3260</a>
+<a name='L3261'></a><a href='#L3261'>3261</a>
+<a name='L3262'></a><a href='#L3262'>3262</a>
+<a name='L3263'></a><a href='#L3263'>3263</a>
+<a name='L3264'></a><a href='#L3264'>3264</a>
+<a name='L3265'></a><a href='#L3265'>3265</a>
+<a name='L3266'></a><a href='#L3266'>3266</a>
+<a name='L3267'></a><a href='#L3267'>3267</a>
+<a name='L3268'></a><a href='#L3268'>3268</a>
+<a name='L3269'></a><a href='#L3269'>3269</a>
+<a name='L3270'></a><a href='#L3270'>3270</a>
+<a name='L3271'></a><a href='#L3271'>3271</a>
+<a name='L3272'></a><a href='#L3272'>3272</a>
+<a name='L3273'></a><a href='#L3273'>3273</a>
+<a name='L3274'></a><a href='#L3274'>3274</a>
+<a name='L3275'></a><a href='#L3275'>3275</a>
+<a name='L3276'></a><a href='#L3276'>3276</a>
+<a name='L3277'></a><a href='#L3277'>3277</a>
+<a name='L3278'></a><a href='#L3278'>3278</a>
+<a name='L3279'></a><a href='#L3279'>3279</a>
+<a name='L3280'></a><a href='#L3280'>3280</a>
+<a name='L3281'></a><a href='#L3281'>3281</a>
+<a name='L3282'></a><a href='#L3282'>3282</a>
+<a name='L3283'></a><a href='#L3283'>3283</a>
+<a name='L3284'></a><a href='#L3284'>3284</a>
+<a name='L3285'></a><a href='#L3285'>3285</a>
+<a name='L3286'></a><a href='#L3286'>3286</a>
+<a name='L3287'></a><a href='#L3287'>3287</a>
+<a name='L3288'></a><a href='#L3288'>3288</a>
+<a name='L3289'></a><a href='#L3289'>3289</a>
+<a name='L3290'></a><a href='#L3290'>3290</a>
+<a name='L3291'></a><a href='#L3291'>3291</a>
+<a name='L3292'></a><a href='#L3292'>3292</a>
+<a name='L3293'></a><a href='#L3293'>3293</a>
+<a name='L3294'></a><a href='#L3294'>3294</a>
+<a name='L3295'></a><a href='#L3295'>3295</a>
+<a name='L3296'></a><a href='#L3296'>3296</a>
+<a name='L3297'></a><a href='#L3297'>3297</a>
+<a name='L3298'></a><a href='#L3298'>3298</a>
+<a name='L3299'></a><a href='#L3299'>3299</a>
+<a name='L3300'></a><a href='#L3300'>3300</a>
+<a name='L3301'></a><a href='#L3301'>3301</a>
+<a name='L3302'></a><a href='#L3302'>3302</a>
+<a name='L3303'></a><a href='#L3303'>3303</a>
+<a name='L3304'></a><a href='#L3304'>3304</a>
+<a name='L3305'></a><a href='#L3305'>3305</a>
+<a name='L3306'></a><a href='#L3306'>3306</a>
+<a name='L3307'></a><a href='#L3307'>3307</a>
+<a name='L3308'></a><a href='#L3308'>3308</a>
+<a name='L3309'></a><a href='#L3309'>3309</a>
+<a name='L3310'></a><a href='#L3310'>3310</a>
+<a name='L3311'></a><a href='#L3311'>3311</a>
+<a name='L3312'></a><a href='#L3312'>3312</a>
+<a name='L3313'></a><a href='#L3313'>3313</a>
+<a name='L3314'></a><a href='#L3314'>3314</a>
+<a name='L3315'></a><a href='#L3315'>3315</a>
+<a name='L3316'></a><a href='#L3316'>3316</a>
+<a name='L3317'></a><a href='#L3317'>3317</a>
+<a name='L3318'></a><a href='#L3318'>3318</a>
+<a name='L3319'></a><a href='#L3319'>3319</a>
+<a name='L3320'></a><a href='#L3320'>3320</a>
+<a name='L3321'></a><a href='#L3321'>3321</a>
+<a name='L3322'></a><a href='#L3322'>3322</a>
+<a name='L3323'></a><a href='#L3323'>3323</a>
+<a name='L3324'></a><a href='#L3324'>3324</a>
+<a name='L3325'></a><a href='#L3325'>3325</a>
+<a name='L3326'></a><a href='#L3326'>3326</a>
+<a name='L3327'></a><a href='#L3327'>3327</a>
+<a name='L3328'></a><a href='#L3328'>3328</a>
+<a name='L3329'></a><a href='#L3329'>3329</a>
+<a name='L3330'></a><a href='#L3330'>3330</a>
+<a name='L3331'></a><a href='#L3331'>3331</a>
+<a name='L3332'></a><a href='#L3332'>3332</a>
+<a name='L3333'></a><a href='#L3333'>3333</a>
+<a name='L3334'></a><a href='#L3334'>3334</a>
+<a name='L3335'></a><a href='#L3335'>3335</a>
+<a name='L3336'></a><a href='#L3336'>3336</a>
+<a name='L3337'></a><a href='#L3337'>3337</a>
+<a name='L3338'></a><a href='#L3338'>3338</a>
+<a name='L3339'></a><a href='#L3339'>3339</a>
+<a name='L3340'></a><a href='#L3340'>3340</a>
+<a name='L3341'></a><a href='#L3341'>3341</a>
+<a name='L3342'></a><a href='#L3342'>3342</a>
+<a name='L3343'></a><a href='#L3343'>3343</a>
+<a name='L3344'></a><a href='#L3344'>3344</a>
+<a name='L3345'></a><a href='#L3345'>3345</a>
+<a name='L3346'></a><a href='#L3346'>3346</a>
+<a name='L3347'></a><a href='#L3347'>3347</a>
+<a name='L3348'></a><a href='#L3348'>3348</a>
+<a name='L3349'></a><a href='#L3349'>3349</a>
+<a name='L3350'></a><a href='#L3350'>3350</a>
+<a name='L3351'></a><a href='#L3351'>3351</a>
+<a name='L3352'></a><a href='#L3352'>3352</a>
+<a name='L3353'></a><a href='#L3353'>3353</a>
+<a name='L3354'></a><a href='#L3354'>3354</a>
+<a name='L3355'></a><a href='#L3355'>3355</a>
+<a name='L3356'></a><a href='#L3356'>3356</a>
+<a name='L3357'></a><a href='#L3357'>3357</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type {
+  ControllerGetStateAction,
+  ControllerStateChangeEvent,
+} from '@metamask/base-controller';
+<span class="cstat-no" title="statement not covered" >import { BaseController } from '@metamask/base-controller';</span>
+import type { Partialize } from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import {</span>
+  InfuraNetworkType,
+  CustomNetworkType,
+  NetworkType,
+  isSafeChainId,
+  isInfuraNetworkType,
+  ChainId,
+  NetworksTicker,
+  NetworkNickname,
+  BUILT_IN_CUSTOM_NETWORKS_RPC,
+  BUILT_IN_NETWORKS,
+  BuiltInNetworkName,
+} from '@metamask/controller-utils';
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+<span class="cstat-no" title="statement not covered" >import EthQuery from '@metamask/eth-query';</span>
+import type { Messenger } from '@metamask/messenger';
+<span class="cstat-no" title="statement not covered" >import { errorCodes } from '@metamask/rpc-errors';</span>
+<span class="cstat-no" title="statement not covered" >import {</span>
+  createEventEmitterProxy,
+  createSwappableProxy,
+} from '@metamask/swappable-obj-proxy';
+import type { SwappableProxy } from '@metamask/swappable-obj-proxy';
+import type { Hex } from '@metamask/utils';
+<span class="cstat-no" title="statement not covered" >import { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';</span>
+<span class="cstat-no" title="statement not covered" >import deepEqual from 'fast-deep-equal';</span>
+import type { Draft } from 'immer';
+<span class="cstat-no" title="statement not covered" >import { produce } from 'immer';</span>
+<span class="cstat-no" title="statement not covered" >import { cloneDeep } from 'lodash';</span>
+import type { Logger } from 'loglevel';
+<span class="cstat-no" title="statement not covered" >import { createSelector } from 'reselect';</span>
+<span class="cstat-no" title="statement not covered" >import * as URI from 'uri-js';</span>
+<span class="cstat-no" title="statement not covered" >import { v4 as uuidV4 } from 'uuid';</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >import {</span>
+  DEPRECATED_NETWORKS,
+  INFURA_BLOCKED_KEY,
+  NetworkStatus,
+} from './constants';
+import type {
+  AutoManagedNetworkClient,
+  ProxyWithAccessibleTarget,
+} from './create-auto-managed-network-client';
+<span class="cstat-no" title="statement not covered" >import { createAutoManagedNetworkClient } from './create-auto-managed-network-client';</span>
+<span class="cstat-no" title="statement not covered" >import { projectLogger, createModuleLogger } from './logger';</span>
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+<span class="cstat-no" title="statement not covered" >import { NetworkClientType } from './types';</span>
+import type {
+  BlockTracker,
+  Provider,
+  CustomNetworkClientConfiguration,
+  InfuraNetworkClientConfiguration,
+  NetworkClientConfiguration,
+  AdditionalDefaultNetwork,
+} from './types';
+&nbsp;
+const debugLog = <span class="cstat-no" title="statement not covered" >createModuleLogger(projectLogger, 'NetworkController');</span>
+&nbsp;
+const INFURA_URL_REGEX =
+<span class="cstat-no" title="statement not covered" >  /^https:\/\/(?&lt;networkName&gt;[^.]+)\.infura\.io\/v\d+\/(?&lt;apiKey&gt;.+)$/u;</span>
+&nbsp;
+export type Block = {
+  baseFeePerGas?: string;
+};
+&nbsp;
+/**
+ * Information about a network not held by any other part of state.
+ */
+export type NetworkMetadata = {
+  /**
+   * EIPs supported by the network.
+   */
+  // eslint-disable-next-line @typescript-eslint/naming-convention
+  EIPS: {
+    [eipNumber: number]: boolean;
+  };
+  /**
+   * Indicates the availability of the network
+   */
+  status: NetworkStatus;
+};
+&nbsp;
+/**
+ * The type of an RPC endpoint.
+ *
+ * @see {@link CustomRpcEndpoint}
+ * @see {@link InfuraRpcEndpoint}
+ */
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export enum R</span>pcEndpointType {</span>
+<span class="cstat-no" title="statement not covered" >  Custom = 'custom',</span>
+<span class="cstat-no" title="statement not covered" >  Infura = 'infura',</span>
+}
+&nbsp;
+/**
+ * An Infura RPC endpoint is a reference to a specific network that Infura
+ * supports as well as an Infura account we own that we allow users to make use
+ * of for free. We need to disambiguate these endpoints from custom RPC
+ * endpoints, because while the types for these kinds of object both have the
+ * same interface, the URL for an Infura endpoint contains the Infura project
+ * ID, and we don't want this to be present in state. We therefore hide it by
+ * representing it in the URL as `{infuraProjectId}`, which we replace this when
+ * create network clients. But we need to know somehow that we only need to do
+ * this replacement for Infura endpoints and not custom endpoints â€” hence the
+ * separate type.
+ */
+export type InfuraRpcEndpoint = {
+  /**
+   * Alternate RPC endpoints to use when this endpoint is down.
+   */
+  failoverUrls?: string[];
+  /**
+   * The optional user-facing nickname of the endpoint.
+   */
+  name?: string;
+  /**
+   * The identifier for the network client that has been created for this RPC
+   * endpoint. This is also used to uniquely identify the RPC endpoint in a
+   * set of RPC endpoints as well: once assigned, it is used to determine
+   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.
+   */
+  networkClientId: BuiltInNetworkClientId;
+  /**
+   * The type of this endpoint, always "default".
+   */
+  type: RpcEndpointType.Infura;
+  /**
+   * The URL of the endpoint. Expected to be a template with the string
+   * `{infuraProjectId}`, which will get replaced with the Infura project ID
+   * when the network client is created.
+   */
+  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;
+};
+&nbsp;
+/**
+ * A custom RPC endpoint is a reference to a user-defined server which fronts an
+ * EVM chain. It may refer to an Infura network, but only by coincidence.
+ */
+export type CustomRpcEndpoint = {
+  /**
+   * Alternate RPC endpoints to use when this endpoint is down.
+   */
+  failoverUrls?: string[];
+  /**
+   * The optional user-facing nickname of the endpoint.
+   */
+  name?: string;
+  /**
+   * The identifier for the network client that has been created for this RPC
+   * endpoint. This is also used to uniquely identify the RPC endpoint in a
+   * set of RPC endpoints as well: once assigned, it is used to determine
+   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.
+   */
+  networkClientId: CustomNetworkClientId;
+  /**
+   * The type of this endpoint, always "custom".
+   */
+  type: RpcEndpointType.Custom;
+  /**
+   * The URL of the endpoint.
+   */
+  url: string;
+};
+&nbsp;
+/**
+ * An RPC endpoint is a reference to a server which fronts an EVM chain. There
+ * are two varieties of RPC endpoints: Infura and custom.
+ *
+ * @see {@link CustomRpcEndpoint}
+ * @see {@link InfuraRpcEndpoint}
+ */
+export type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;
+&nbsp;
+/**
+ * From a user perspective, a network configuration holds information about a
+ * network that a user can select through the client. A "network" in this sense
+ * can explicitly refer to an EVM chain that the user explicitly adds or doesn't
+ * need to add (because it comes shipped with the client). The properties here
+ * therefore directly map to fields that a user sees and can edit for a network
+ * within the client.
+ *
+ * Internally, a network configuration represents a single conceptual EVM chain,
+ * which is represented tangibly via multiple RPC endpoints. A "network" is then
+ * something for which a network client object is created automatically or
+ * created on demand when it is added to the client.
+ */
+export type NetworkConfiguration = {
+  /**
+   * A set of URLs that allows the user to view activity that has occurred on
+   * the chain.
+   */
+  blockExplorerUrls: string[];
+  /**
+   * The ID of the chain. Represented in hexadecimal format with a leading "0x"
+   * instead of decimal format so that when viewed out of context it can be
+   * unambiguously interpreted.
+   */
+  chainId: Hex;
+  /**
+   * A reference to a URL that the client will use by default to allow the user
+   * to view activity that has occurred on the chain. This index must refer to
+   * an item in `blockExplorerUrls`.
+   */
+  defaultBlockExplorerUrlIndex?: number;
+  /**
+   * A reference to an RPC endpoint that all requests will use by default in order to
+   * interact with the chain. This index must refer to an item in
+   * `rpcEndpoints`.
+   */
+  defaultRpcEndpointIndex: number;
+  /**
+   * The user-facing nickname assigned to the chain.
+   */
+  name: string;
+  /**
+   * The name of the currency to use for the chain.
+   */
+  nativeCurrency: string;
+  /**
+   * The collection of possible RPC endpoints that the client can use to
+   * interact with the chain.
+   */
+  rpcEndpoints: RpcEndpoint[];
+  /**
+   * Profile Sync - Network Sync field.
+   * Allows comparison of local network state with state to sync.
+   */
+  lastUpdatedAt?: number;
+};
+&nbsp;
+/**
+ * A custom RPC endpoint in a new network configuration, meant to be used in
+ * conjunction with `AddNetworkFields`.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and therefore network clients
+ * do not exist for them yet (and hence IDs need to be generated).
+ */
+export type AddNetworkCustomRpcEndpointFields = Omit&lt;
+  CustomRpcEndpoint,
+  'networkClientId'
+&gt;;
+&nbsp;
+/**
+ * A new network configuration that `addNetwork` takes.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and are not represented by
+ * network clients yet.
+ */
+export type AddNetworkFields = Omit&lt;NetworkConfiguration, 'rpcEndpoints'&gt; &amp; {
+  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];
+};
+&nbsp;
+/**
+ * A custom RPC endpoint in an updated representation of a network
+ * configuration, meant to be used in conjunction with `UpdateNetworkFields`.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and therefore network clients
+ * do not exist for them yet (and hence IDs need to be generated).
+ */
+export type UpdateNetworkCustomRpcEndpointFields = Partialize&lt;
+  CustomRpcEndpoint,
+  'networkClientId'
+&gt;;
+&nbsp;
+/**
+ * An updated representation of an existing network configuration that
+ * `updateNetwork` takes.
+ *
+ * Custom RPC endpoints may or may not have a `networkClientId` property; if
+ * they do, then it is assumed that they already exist, and if not, then it is
+ * assumed that they are new and are not represented by network clients yet.
+ */
+export type UpdateNetworkFields = Omit&lt;NetworkConfiguration, 'rpcEndpoints'&gt; &amp; {
+  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];
+};
+&nbsp;
+/**
+ * `Object.keys()` is intentionally generic: it returns the keys of an object,
+ * but it cannot make guarantees about the contents of that object, so the type
+ * of the keys is merely `string[]`. While this is technically accurate, it is
+ * also unnecessary if we have an object that we own and whose contents are
+ * known exactly.
+ *
+ * TODO: Move to @metamask/utils.
+ *
+ * @param object - The object.
+ * @returns The keys of an object, typed according to the type of the object
+ * itself.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >k</span>nownKeysOf&lt;</span>Key extends PropertyKey&gt;(
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  object: Partial&lt;Record&lt;Key, any&gt;&gt;,
+): Key[] {
+<span class="cstat-no" title="statement not covered" >  return Object.keys(object) as Key[];</span>
+}
+&nbsp;
+/**
+ * Type guard for determining whether the given value is an error object with a
+ * `code` property, such as an instance of Error.
+ *
+ * TODO: Move this to @metamask/utils.
+ *
+ * @param error - The object to check.
+ * @returns True if `error` has a `code`, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isErrorWithCode(</span>error: unknown): error is { code: string | number } {
+<span class="cstat-no" title="statement not covered" >  return typeof error === 'object' &amp;&amp; error !== null &amp;&amp; 'code' in error;</span>
+}
+&nbsp;
+/**
+ * The string that uniquely identifies an Infura network client.
+ */
+export type BuiltInNetworkClientId = InfuraNetworkType;
+&nbsp;
+/**
+ * The string that uniquely identifies a custom network client.
+ */
+export type CustomNetworkClientId = string;
+&nbsp;
+/**
+ * The string that uniquely identifies a network client.
+ */
+export type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;
+&nbsp;
+/**
+ * Extra information about each network, such as whether it is accessible or
+ * blocked and whether it supports EIP-1559, keyed by network client ID.
+ */
+export type NetworksMetadata = Record&lt;NetworkClientId, NetworkMetadata&gt;;
+&nbsp;
+/**
+ * The state that NetworkController stores.
+ */
+export type NetworkState = {
+  /**
+   * The ID of the network client that the proxies returned by
+   * `getSelectedNetworkClient` currently point to.
+   */
+  selectedNetworkClientId: NetworkClientId;
+  /**
+   * The registry of networks and corresponding RPC endpoints that the
+   * controller can use to make requests for various chains.
+   *
+   * @see {@link NetworkConfiguration}
+   */
+  networkConfigurationsByChainId: Record&lt;Hex, NetworkConfiguration&gt;;
+  /**
+   * Extra information about each network, such as whether it is accessible or
+   * blocked and whether it supports EIP-1559, keyed by network client ID.
+   */
+  networksMetadata: NetworksMetadata;
+};
+&nbsp;
+const controllerName = <span class="cstat-no" title="statement not covered" >'NetworkController';</span>
+&nbsp;
+/**
+ * Represents the block tracker for the currently selected network. (Note that
+ * this is a proxy around a proxy: the inner one exists so that the block
+ * tracker doesn't have to exist until it's used, and the outer one exists so
+ * that the currently selected network can change without consumers needing to
+ * refresh the object reference to that network.)
+ */
+export type BlockTrackerProxy = SwappableProxy&lt;
+  ProxyWithAccessibleTarget&lt;BlockTracker&gt;
+&gt;;
+&nbsp;
+/**
+ * Represents the provider for the currently selected network. (Note that this
+ * is a proxy around a proxy: the inner one exists so that the provider doesn't
+ * have to exist until it's used, and the outer one exists so that the currently
+ * selected network can change without consumers needing to refresh the object
+ * reference to that network.)
+ */
+export type ProviderProxy = SwappableProxy&lt;ProxyWithAccessibleTarget&lt;Provider&gt;&gt;;
+&nbsp;
+export type NetworkControllerStateChangeEvent = ControllerStateChangeEvent&lt;
+  typeof controllerName,
+  NetworkState
+&gt;;
+&nbsp;
+/**
+ * `networkWillChange` is published when the current network is about to be
+ * switched, but the new provider has not been created and no state changes have
+ * occurred yet.
+ */
+export type NetworkControllerNetworkWillChangeEvent = {
+  type: 'NetworkController:networkWillChange';
+  payload: [NetworkState];
+};
+&nbsp;
+/**
+ * `networkDidChange` is published after a provider has been created for a newly
+ * switched network (but before the network has been confirmed to be available).
+ */
+export type NetworkControllerNetworkDidChangeEvent = {
+  type: 'NetworkController:networkDidChange';
+  payload: [NetworkState];
+};
+&nbsp;
+/**
+ * `infuraIsBlocked` is published after the network is switched to an Infura
+ * network, but when Infura returns an error blocking the user based on their
+ * location.
+ */
+export type NetworkControllerInfuraIsBlockedEvent = {
+  type: 'NetworkController:infuraIsBlocked';
+  payload: [];
+};
+&nbsp;
+/**
+ * `infuraIsBlocked` is published either after the network is switched to an
+ * Infura network and Infura does not return an error blocking the user based on
+ * their location, or the network is switched to a non-Infura network.
+ */
+export type NetworkControllerInfuraIsUnblockedEvent = {
+  type: 'NetworkController:infuraIsUnblocked';
+  payload: [];
+};
+&nbsp;
+/**
+ * `networkAdded` is published after a network configuration is added to the
+ * network configuration registry and network clients are created for it.
+ */
+export type NetworkControllerNetworkAddedEvent = {
+  type: 'NetworkController:networkAdded';
+  payload: [networkConfiguration: NetworkConfiguration];
+};
+&nbsp;
+/**
+ * `networkRemoved` is published after a network configuration is removed from the
+ * network configuration registry and once the network clients have been removed.
+ */
+export type NetworkControllerNetworkRemovedEvent = {
+  type: 'NetworkController:networkRemoved';
+  payload: [networkConfiguration: NetworkConfiguration];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointChainUnavailable` is published when, after
+ * trying all endpoints in an endpoint chain, the last failover reaches a
+ * maximum number of consecutive 5xx responses, breaking the underlying circuit.
+ *
+ * In other words, this event will not be published if a failover is available,
+ * even if the primary is not.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.error - The last error produced by the last failover in the
+ * endpoint chain.
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainUnavailableEvent = {
+  type: 'NetworkController:rpcEndpointChainUnavailable';
+  payload: [
+    {
+      chainId: Hex;
+      error: unknown;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointUnavailable` is published when any
+ * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx
+ * responses, breaking the underlying circuit.
+ *
+ * In other words, this event will be published if a primary is not available,
+ * even if a failover is.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint which reached the
+ * maximum number of consecutive 5xx responses. You can compare this to
+ * `primaryEndpointUrl` to know whether it was a failover or a primary.
+ * @param payload.error - The last error produced by the endpoint.
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ */
+export type NetworkControllerRpcEndpointUnavailableEvent = {
+  type: 'NetworkController:rpcEndpointUnavailable';
+  payload: [
+    {
+      chainId: Hex;
+      endpointUrl: string;
+      error: unknown;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointChainDegraded` is published for any of the
+ * endpoints in an endpoint chain when one of the following two conditions hold
+ * (and the chain is not already in a degraded state):
+ *
+ * 1. A successful (2xx) request, even after being retried, cannot be made to
+ * the endpoint.
+ * 2. A successful (2xx) request can be made to the endpoint, but it takes
+ * longer than expected to complete.
+ *
+ * Note that this event will be published even if there are local connectivity
+ * issues which prevent requests from being initiated. This is intentional.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.error - The last error produced by the endpoint (or
+ * `undefined` if the request was slow).
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainDegradedEvent = {
+  type: 'NetworkController:rpcEndpointChainDegraded';
+  payload: [
+    {
+      chainId: Hex;
+      error: unknown;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+&nbsp;
+/**
+ *
+ * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints
+ * in an endpoint chain when:
+ *
+ * 1. A successful (2xx) request, even after being retried, cannot be made to
+ * the endpoint.
+ * 2. A successful (2xx) request can be made to the endpoint, but it takes
+ * longer than expected to complete.
+ *
+ * Note that this event will be published even if there are local connectivity
+ * issues which prevent requests from being initiated. This is intentional.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint for which requests
+ * failed or were slow to complete. You can compare this to `primaryEndpointUrl`
+ * to know whether it was a failover or a primary.
+ * @param payload.error - The last error produced by the endpoint (or
+ * `undefined` if the request was slow).
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ */
+export type NetworkControllerRpcEndpointDegradedEvent = {
+  type: 'NetworkController:rpcEndpointDegraded';
+  payload: [
+    {
+      chainId: Hex;
+      endpointUrl: string;
+      error: unknown;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointChainAvailable` is published in one of two
+ * cases:
+ *
+ * 1. The first time that a 2xx request is made to any of the endpoints in an
+ * endpoint chain.
+ * 2. When requests to any of the endpoints previously failed (placing the
+ * endpoint in a degraded or unavailable status), but are now succeeding again.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainAvailableEvent = {
+  type: 'NetworkController:rpcEndpointChainAvailable';
+  payload: [
+    {
+      chainId: Hex;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointRetried` is published before a request to any
+ * endpoint in an endpoint chain is retried.
+ *
+ * This is mainly useful for tests.
+ *
+ * @param payload - The event payload.
+ * @param payload.attempt - The current attempt counter for the endpoint
+ * (starting from 0).
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint being retried.
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ * @see {@link RpcService} for the list of retriable errors.
+ */
+export type NetworkControllerRpcEndpointRetriedEvent = {
+  type: 'NetworkController:rpcEndpointRetried';
+  payload: [
+    {
+      attempt: number;
+      chainId: Hex;
+      endpointUrl: string;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+&nbsp;
+export type NetworkControllerEvents =
+  | NetworkControllerStateChangeEvent
+  | NetworkControllerNetworkWillChangeEvent
+  | NetworkControllerNetworkDidChangeEvent
+  | NetworkControllerInfuraIsBlockedEvent
+  | NetworkControllerInfuraIsUnblockedEvent
+  | NetworkControllerNetworkAddedEvent
+  | NetworkControllerNetworkRemovedEvent
+  | NetworkControllerRpcEndpointChainUnavailableEvent
+  | NetworkControllerRpcEndpointUnavailableEvent
+  | NetworkControllerRpcEndpointChainDegradedEvent
+  | NetworkControllerRpcEndpointDegradedEvent
+  | NetworkControllerRpcEndpointChainAvailableEvent
+  | NetworkControllerRpcEndpointRetriedEvent;
+&nbsp;
+/**
+ * All events that {@link NetworkController} calls internally.
+ */
+type AllowedEvents = never;
+&nbsp;
+export type NetworkControllerGetStateAction = ControllerGetStateAction&lt;
+  typeof controllerName,
+  NetworkState
+&gt;;
+&nbsp;
+export type NetworkControllerGetEthQueryAction = {
+  type: `NetworkController:getEthQuery`;
+  handler: () =&gt; EthQuery | undefined;
+};
+&nbsp;
+export type NetworkControllerGetNetworkClientByIdAction = {
+  type: `NetworkController:getNetworkClientById`;
+  handler: NetworkController['getNetworkClientById'];
+};
+&nbsp;
+export type NetworkControllerGetSelectedNetworkClientAction = {
+  type: `NetworkController:getSelectedNetworkClient`;
+  handler: NetworkController['getSelectedNetworkClient'];
+};
+&nbsp;
+export type NetworkControllerGetSelectedChainIdAction = {
+  type: 'NetworkController:getSelectedChainId';
+  handler: NetworkController['getSelectedChainId'];
+};
+&nbsp;
+export type NetworkControllerGetEIP1559CompatibilityAction = {
+  type: `NetworkController:getEIP1559Compatibility`;
+  handler: NetworkController['getEIP1559Compatibility'];
+};
+&nbsp;
+export type NetworkControllerFindNetworkClientIdByChainIdAction = {
+  type: `NetworkController:findNetworkClientIdByChainId`;
+  handler: NetworkController['findNetworkClientIdByChainId'];
+};
+&nbsp;
+/**
+ * Change the currently selected network to the given built-in network type.
+ *
+ * @deprecated This action has been replaced by `setActiveNetwork`, and will be
+ * removed in a future release.
+ */
+export type NetworkControllerSetProviderTypeAction = {
+  type: `NetworkController:setProviderType`;
+  handler: NetworkController['setProviderType'];
+};
+&nbsp;
+export type NetworkControllerSetActiveNetworkAction = {
+  type: `NetworkController:setActiveNetwork`;
+  handler: NetworkController['setActiveNetwork'];
+};
+&nbsp;
+export type NetworkControllerGetNetworkConfigurationByChainId = {
+  type: `NetworkController:getNetworkConfigurationByChainId`;
+  handler: NetworkController['getNetworkConfigurationByChainId'];
+};
+&nbsp;
+export type NetworkControllerGetNetworkConfigurationByNetworkClientId = {
+  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;
+  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];
+};
+&nbsp;
+export type NetworkControllerAddNetworkAction = {
+  type: 'NetworkController:addNetwork';
+  handler: NetworkController['addNetwork'];
+};
+&nbsp;
+export type NetworkControllerRemoveNetworkAction = {
+  type: 'NetworkController:removeNetwork';
+  handler: NetworkController['removeNetwork'];
+};
+&nbsp;
+export type NetworkControllerUpdateNetworkAction = {
+  type: 'NetworkController:updateNetwork';
+  handler: NetworkController['updateNetwork'];
+};
+&nbsp;
+export type NetworkControllerActions =
+  | NetworkControllerGetStateAction
+  | NetworkControllerGetEthQueryAction
+  | NetworkControllerGetNetworkClientByIdAction
+  | NetworkControllerGetSelectedNetworkClientAction
+  | NetworkControllerGetSelectedChainIdAction
+  | NetworkControllerGetEIP1559CompatibilityAction
+  | NetworkControllerFindNetworkClientIdByChainIdAction
+  | NetworkControllerSetActiveNetworkAction
+  | NetworkControllerSetProviderTypeAction
+  | NetworkControllerGetNetworkConfigurationByChainId
+  | NetworkControllerGetNetworkConfigurationByNetworkClientId
+  | NetworkControllerAddNetworkAction
+  | NetworkControllerRemoveNetworkAction
+  | NetworkControllerUpdateNetworkAction;
+&nbsp;
+/**
+ * All actions that {@link NetworkController} calls internally.
+ */
+type AllowedActions = never;
+&nbsp;
+export type NetworkControllerMessenger = Messenger&lt;
+  typeof controllerName,
+  NetworkControllerActions | AllowedActions,
+  NetworkControllerEvents | AllowedEvents
+&gt;;
+&nbsp;
+/**
+ * Options for the NetworkController constructor.
+ */
+export type NetworkControllerOptions = {
+  /**
+   * The messenger suited for this controller.
+   */
+  messenger: NetworkControllerMessenger;
+  /**
+   * The API key for Infura, used to make requests to Infura.
+   */
+  infuraProjectId: string;
+  /**
+   * The desired state with which to initialize this controller.
+   * Missing properties will be filled in with defaults. For instance, if not
+   * specified, `networkConfigurationsByChainId` will default to a basic set of
+   * network configurations (see {@link InfuraNetworkType} for the list).
+   */
+  state?: Partial&lt;NetworkState&gt;;
+  /**
+   * A `loglevel` logger object.
+   */
+  log?: Logger;
+  /**
+   * A function that can be used to customize a RPC service constructed for an
+   * RPC endpoint. The function takes the URL of the endpoint and should return
+   * an object with type {@link RpcServiceOptions}, minus `failoverService`
+   * and `endpointUrl` (as they are filled in automatically).
+   */
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  /**
+   * A function that can be used to customize a block tracker constructed for an
+   * RPC endpoint. The function takes the URL of the endpoint and should return
+   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as
+   * it is filled in automatically).
+   */
+  getBlockTrackerOptions?: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  /**
+   * An array of Hex Chain IDs representing the additional networks to be included as default.
+   */
+  additionalDefaultNetworks?: AdditionalDefaultNetwork[];
+  /**
+   * Whether or not requests sent to unavailable RPC endpoints should be
+   * automatically diverted to configured failover RPC endpoints.
+   */
+  isRpcFailoverEnabled?: boolean;
+};
+&nbsp;
+/**
+ * Constructs a value for the state property `networkConfigurationsByChainId`
+ * which will be used if it has not been provided to the constructor.
+ *
+ * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.
+ * @returns The default value for `networkConfigurationsByChainId`.
+ */
+function <span class="fstat-no" title="function not covered" >getDefaultNetworkConfigurationsByChainId(</span>
+  additionalDefaultNetworks: AdditionalDefaultNetwork[] = <span class="branch-0 cbranch-no" title="branch not covered" >[],</span>
+): Record&lt;Hex, NetworkConfiguration&gt; {
+  const infuraNetworks = <span class="cstat-no" title="statement not covered" >getDefaultInfuraNetworkConfigurationsByChainId();</span>
+  const customNetworks = <span class="cstat-no" title="statement not covered" >getDefaultCustomNetworkConfigurationsByChainId();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return additionalDefaultNetworks.reduce&lt;Record&lt;Hex, NetworkConfiguration&gt;&gt;(</span>
+<span class="fstat-no" title="function not covered" >    (o</span>bj, chainId) =&gt; {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (hasProperty(customNetworks, chainId)) {</span>
+<span class="cstat-no" title="statement not covered" >        obj[chainId] = customNetworks[chainId];</span>
+      }
+<span class="cstat-no" title="statement not covered" >      return obj;</span>
+    },
+    // Always include the infura networks in the default networks
+    infuraNetworks,
+  );
+}
+&nbsp;
+/**
+ * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.
+ *
+ * @returns The `networkConfigurationsByChainId` object of all Infura networks.
+ */
+function <span class="fstat-no" title="function not covered" >getDefaultInfuraNetworkConfigurationsByChainId(</span>): Record&lt;
+  Hex,
+  NetworkConfiguration
+&gt; {
+<span class="cstat-no" title="statement not covered" >  return Object.values(InfuraNetworkType).reduce&lt;</span>
+    Record&lt;Hex, NetworkConfiguration&gt;
+  &gt;(<span class="fstat-no" title="function not covered" >(o</span>bj, infuraNetworkType) =&gt; {
+    const chainId = <span class="cstat-no" title="statement not covered" >ChainId[infuraNetworkType];</span>
+&nbsp;
+    // Skip deprecated network as default network.
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (DEPRECATED_NETWORKS.has(chainId)) {</span>
+<span class="cstat-no" title="statement not covered" >      return obj;</span>
+    }
+&nbsp;
+    const rpcEndpointUrl =
+<span class="cstat-no" title="statement not covered" >      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;</span>
+&nbsp;
+    const networkConfiguration: NetworkConfiguration = <span class="cstat-no" title="statement not covered" >{</span>
+      blockExplorerUrls: [],
+      chainId,
+      defaultRpcEndpointIndex: 0,
+      name: NetworkNickname[infuraNetworkType],
+      nativeCurrency: NetworksTicker[infuraNetworkType],
+      rpcEndpoints: [
+        {
+          failoverUrls: [],
+          networkClientId: infuraNetworkType,
+          type: RpcEndpointType.Infura,
+          url: rpcEndpointUrl,
+        },
+      ],
+    };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { ...obj, [chainId]: networkConfiguration };</span>
+  }, {});
+}
+&nbsp;
+/**
+ * Constructs a `networkConfigurationsByChainId` object for all default custom networks.
+ *
+ * @returns The `networkConfigurationsByChainId` object of all custom networks.
+ */
+function <span class="fstat-no" title="function not covered" >getDefaultCustomNetworkConfigurationsByChainId(</span>): Record&lt;
+  Hex,
+  NetworkConfiguration
+&gt; {
+  // Create the `networkConfigurationsByChainId` objects explicitly,
+  // Because it is not always guaranteed that the custom networks are included in the
+  // default networks.
+  const configs = <span class="cstat-no" title="statement not covered" >{</span>
+    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['megaeth-testnet'],
+    ),
+    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(
+      CustomNetworkType['megaeth-testnet-v2'],
+    ),
+    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['monad-testnet'],
+    ),
+    // New additions for 20+ network performance testing
+    [ChainId[BuiltInNetworkName.FantomMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['fantom-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.GnosisMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['gnosis-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.CeloMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['celo-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.CronosMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['cronos-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.Aurora]]: getCustomNetworkConfiguration(
+      CustomNetworkType.aurora,
+    ),
+    [ChainId[BuiltInNetworkName.MoonbeamMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['moonbeam-mainnet']),
+    [ChainId[BuiltInNetworkName.MoonriverMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['moonriver-mainnet']),
+    [ChainId[BuiltInNetworkName.KlaytnMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['klaytn-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.AvalancheMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['avalanche-mainnet']),
+    [ChainId[BuiltInNetworkName.ZkSyncEraMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['zksync-era-mainnet']),
+    [ChainId[BuiltInNetworkName.PalmMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['palm-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.HyperEvmMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['hypervm-mainnet']),
+  };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  console.log(</span>
+    '[NetworkController] getDefaultCustomNetworkConfigurationsByChainId - returning',
+    Object.keys(configs).length,
+    'custom network configurations',
+  );
+<span class="cstat-no" title="statement not covered" >  console.log(</span>
+    '[NetworkController] Custom network chain IDs:',
+    Object.keys(configs),
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return configs;</span>
+}
+&nbsp;
+/**
+ * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.
+ *
+ * @param customNetworkType - The type of the custom network.
+ * @returns The `NetworkConfiguration` object.
+ */
+function <span class="fstat-no" title="function not covered" >getCustomNetworkConfiguration(</span>
+  customNetworkType: CustomNetworkType,
+): NetworkConfiguration {
+  const { ticker, rpcPrefs } = <span class="cstat-no" title="statement not covered" >BUILT_IN_NETWORKS[customNetworkType];</span>
+  const rpcEndpointUrl = <span class="cstat-no" title="statement not covered" >BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return {</span>
+    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],
+    chainId: ChainId[customNetworkType],
+    defaultRpcEndpointIndex: 0,
+    defaultBlockExplorerUrlIndex: 0,
+    name: NetworkNickname[customNetworkType],
+    nativeCurrency: ticker,
+    rpcEndpoints: [
+      {
+        failoverUrls: [],
+        networkClientId: customNetworkType,
+        type: RpcEndpointType.Custom,
+        url: rpcEndpointUrl,
+      },
+    ],
+  };
+}
+&nbsp;
+/**
+ * Constructs properties for the NetworkController state whose values will be
+ * used if not provided to the constructor.
+ *
+ * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.
+ * @returns The default NetworkController state.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >g</span>etDefaultNetworkControllerState(</span>
+  additionalDefaultNetworks?: AdditionalDefaultNetwork[],
+): NetworkState {
+  const networksMetadata = <span class="cstat-no" title="statement not covered" >{};</span>
+  const networkConfigurationsByChainId =
+<span class="cstat-no" title="statement not covered" >    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return {</span>
+    selectedNetworkClientId: InfuraNetworkType.mainnet,
+    networksMetadata,
+    networkConfigurationsByChainId,
+  };
+}
+&nbsp;
+/**
+ * Redux selector for getting all network configurations from NetworkController
+ * state, keyed by chain ID.
+ *
+ * @param state - NetworkController state
+ * @returns All registered network configurations, keyed by chain ID.
+ */
+const selectNetworkConfigurationsByChainId = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
+  state: NetworkState,
+): Record&lt;`0x${string}`, NetworkConfiguration&gt; =&gt;
+<span class="cstat-no" title="statement not covered" >  state.networkConfigurationsByChainId;</span>
+&nbsp;
+/**
+ * Get a list of all network configurations.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network configurations
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >g</span>etNetworkConfigurations(</span>
+  state: NetworkState,
+): NetworkConfiguration[] {
+<span class="cstat-no" title="statement not covered" >  return Object.values(state.networkConfigurationsByChainId);</span>
+}
+&nbsp;
+/**
+ * Redux selector for getting a list of all network configurations from
+ * NetworkController state.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network configurations
+ */
+export const <span class="cstat-no" title="statement not covered" >selectNetworkConfigurations = createSelector(</span>
+  selectNetworkConfigurationsByChainId,
+<span class="fstat-no" title="function not covered" >  (n</span>etworkConfigurationsByChainId) =&gt;
+<span class="cstat-no" title="statement not covered" >    Object.values(networkConfigurationsByChainId),</span>
+);
+&nbsp;
+/**
+ * Get a list of all available network client IDs from a list of network
+ * configurations.
+ *
+ * @param networkConfigurations - The array of network configurations
+ * @returns A list of all available client IDs
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >g</span>etAvailableNetworkClientIds(</span>
+  networkConfigurations: NetworkConfiguration[],
+): string[] {
+<span class="cstat-no" title="statement not covered" >  return networkConfigurations.flatMap(<span class="fstat-no" title="function not covered" >(n</span>etworkConfiguration) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >    networkConfiguration.rpcEndpoints.map(</span>
+<span class="fstat-no" title="function not covered" >      (r</span>pcEndpoint) =&gt; <span class="cstat-no" title="statement not covered" >rpcEndpoint.networkClientId,</span>
+    ),
+  );
+}
+&nbsp;
+/**
+ * Redux selector for getting a list of all available network client IDs
+ * from NetworkController state.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network client IDs.
+ */
+export const <span class="cstat-no" title="statement not covered" >selectAvailableNetworkClientIds = createSelector(</span>
+  selectNetworkConfigurations,
+  getAvailableNetworkClientIds,
+);
+&nbsp;
+/**
+ * The collection of auto-managed network clients that map to Infura networks.
+ */
+export type AutoManagedBuiltInNetworkClientRegistry = Record&lt;
+  BuiltInNetworkClientId,
+  AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;
+&gt;;
+&nbsp;
+/**
+ * The collection of auto-managed network clients that map to Infura networks.
+ */
+export type AutoManagedCustomNetworkClientRegistry = Record&lt;
+  CustomNetworkClientId,
+  AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;
+&gt;;
+&nbsp;
+/**
+ * The collection of auto-managed network clients that map to Infura networks
+ * as well as custom networks that users have added.
+ */
+export type AutoManagedNetworkClientRegistry = {
+  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;
+  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork` and `updateNetwork` to create a network client for an
+ * RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type AddNetworkClientOperation = {
+  type: 'add';
+  rpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `updateNetwork` and `removeNetwork` to remove a network client for
+ * an RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type RemoveNetworkClientOperation = {
+  type: 'remove';
+  rpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork` and `updateNetwork` to replace the network client for
+ * an RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type ReplaceNetworkClientOperation = {
+  type: 'replace';
+  oldRpcEndpoint: RpcEndpoint;
+  newRpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC
+ * endpoint, as far as the network client registry is concerned.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type NoopNetworkClientOperation = {
+  type: 'noop';
+  rpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to
+ * update the network client registry.
+ *
+ * - When `addNetwork` is called, represents a network client that should be
+ * created for a new RPC endpoint.
+ * - When `removeNetwork` is called, represents a network client that should be
+ * destroyed for a previously existing RPC endpoint.
+ * - When `updateNetwork` is called, represents either:
+ *   - a network client that should be added for a new RPC endpoint
+ *   - a network client that should be removed for a previously existing RPC
+ *   endpoint
+ *   - a network client that should be replaced for an RPC endpoint that was
+ *   changed in a non-major way, or
+ *   - a network client that should be unchanged for an RPC endpoint that was
+ *   also unchanged.
+ */
+type NetworkClientOperation =
+  | AddNetworkClientOperation
+  | RemoveNetworkClientOperation
+  | ReplaceNetworkClientOperation
+  | NoopNetworkClientOperation;
+&nbsp;
+/**
+ * Determines whether the given URL is valid by attempting to parse it.
+ *
+ * @param url - The URL to test.
+ * @returns True if the URL is valid, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isValidUrl(</span>url: string): boolean {
+  const uri = <span class="cstat-no" title="statement not covered" >URI.parse(url);</span>
+<span class="cstat-no" title="statement not covered" >  return (</span>
+    uri.error === undefined &amp;&amp; (uri.scheme === 'http' || uri.scheme === 'https')
+  );
+}
+&nbsp;
+/**
+ * Given an Infura API URL, extracts the subdomain that identifies the Infura
+ * network.
+ *
+ * @param rpcEndpointUrl - The URL to operate on.
+ * @returns The Infura network name that the URL references.
+ * @throws if the URL is not an Infura API URL, or if an Infura network is not
+ * present in the URL.
+ */
+function <span class="fstat-no" title="function not covered" >deriveInfuraNetworkNameFromRpcEndpointUrl(</span>
+  rpcEndpointUrl: string,
+): InfuraNetworkType {
+  const match = <span class="cstat-no" title="statement not covered" >INFURA_URL_REGEX.exec(rpcEndpointUrl);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if (match?.groups) {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInfuraNetworkType(match.groups.networkName)) {</span>
+<span class="cstat-no" title="statement not covered" >      return match.groups.networkName;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);</span>
+  }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  throw new Error('Could not derive Infura network from RPC endpoint URL');</span>
+}
+&nbsp;
+/**
+ * Performs a series of checks that the given NetworkController state is
+ * internally consistent â€” that all parts of state that are supposed to match in
+ * fact do â€” so that working with the state later on doesn't cause unexpected
+ * errors.
+ *
+ * In the case of NetworkController, there are several parts of state that need
+ * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry
+ * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC
+ * endpoint within a network configuration.
+ *
+ * @param state - The NetworkController state to verify.
+ * @throws if the state is invalid in some way.
+ */
+function <span class="fstat-no" title="function not covered" >validateInitialState(</span>state: NetworkState): void {
+  const networkConfigurationEntries = <span class="cstat-no" title="statement not covered" >Object.entries(</span>
+    state.networkConfigurationsByChainId,
+  );
+  const networkClientIds = <span class="cstat-no" title="statement not covered" >getAvailableNetworkClientIds(</span>
+    getNetworkConfigurations(state),
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if (networkConfigurationEntries.length === 0) {</span>
+<span class="cstat-no" title="statement not covered" >    throw new Error(</span>
+      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',
+    );
+  }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (chainId !== networkConfiguration.chainId) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \`chainId\` of '${networkConfiguration.chainId}'`,
+      );
+    }
+&nbsp;
+    const isInvalidDefaultBlockExplorerUrlIndex =
+<span class="cstat-no" title="statement not covered" >      networkConfiguration.blockExplorerUrls.length &gt; 0</span>
+        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||
+          networkConfiguration.blockExplorerUrls[
+            networkConfiguration.defaultBlockExplorerUrlIndex
+          ] === undefined
+        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInvalidDefaultBlockExplorerUrlIndex) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' has a \`defaultBlockExplorerUrlIndex\` that does not refer to an entry in \`blockExplorerUrls\``,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      networkConfiguration.rpcEndpoints[
+        networkConfiguration.defaultRpcEndpointIndex
+      ] === undefined
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' has a \`defaultRpcEndpointIndex\` that does not refer to an entry in \`rpcEndpoints\``,
+      );
+    }
+  }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if ([...new Set(networkClientIds)].length &lt; networkClientIds.length) {</span>
+<span class="cstat-no" title="statement not covered" >    throw new Error(</span>
+      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',
+    );
+  }
+}
+&nbsp;
+/**
+ * Checks that the given initial NetworkController state is internally
+ * consistent similar to `validateInitialState`, but if an anomaly is detected,
+ * it does its best to correct the state and logs an error to Sentry.
+ *
+ * @param state - The NetworkController state to verify.
+ * @param messenger - The NetworkController messenger.
+ * @returns The corrected state.
+ */
+function <span class="fstat-no" title="function not covered" >correctInitialState(</span>
+  state: NetworkState,
+  messenger: NetworkControllerMessenger,
+): NetworkState {
+  const networkConfigurationsSortedByChainId = <span class="cstat-no" title="statement not covered" >getNetworkConfigurations(</span>
+    state,
+  ).sort(<span class="fstat-no" title="function not covered" >(a</span>, b) =&gt; <span class="cstat-no" title="statement not covered" >a.chainId.localeCompare(b.chainId))</span>;
+  const availableNetworkClientIds = <span class="cstat-no" title="statement not covered" >getAvailableNetworkClientIds(</span>
+    networkConfigurationsSortedByChainId,
+  );
+  const invalidNetworkClientIdsWithMetadata = <span class="cstat-no" title="statement not covered" >Object.keys(</span>
+    state.networksMetadata,
+  ).filter(
+<span class="fstat-no" title="function not covered" >    (n</span>etworkClientId) =&gt; <span class="cstat-no" title="statement not covered" >!availableNetworkClientIds.includes(networkClientId),</span>
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return produce(state, <span class="fstat-no" title="function not covered" >(n</span>ewState) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {</span>
+      const firstNetworkConfiguration = <span class="cstat-no" title="statement not covered" >networkConfigurationsSortedByChainId[0];</span>
+      const newSelectedNetworkClientId =
+<span class="cstat-no" title="statement not covered" >        firstNetworkConfiguration.rpcEndpoints[</span>
+          firstNetworkConfiguration.defaultRpcEndpointIndex
+        ].networkClientId;
+<span class="cstat-no" title="statement not covered" >      messenger.captureException?.(</span>
+        new Error(
+          `\`selectedNetworkClientId\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,
+        ),
+      );
+<span class="cstat-no" title="statement not covered" >      newState.selectedNetworkClientId = newSelectedNetworkClientId;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (invalidNetworkClientIdsWithMetadata.length &gt; 0) {</span>
+<span class="cstat-no" title="statement not covered" >      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {</span>
+<span class="cstat-no" title="statement not covered" >        delete newState.networksMetadata[invalidNetworkClientId];</span>
+      }
+<span class="cstat-no" title="statement not covered" >      messenger.captureException?.(</span>
+        new Error(
+          '`networksMetadata` had invalid network client IDs, which have been removed',
+        ),
+      );
+    }
+  });
+}
+&nbsp;
+/**
+ * Transforms a map of chain ID to network configuration to a map of network
+ * client ID to network configuration.
+ *
+ * @param networkConfigurationsByChainId - The network configurations, keyed by
+ * chain ID.
+ * @returns The network configurations, keyed by network client ID.
+ */
+function <span class="fstat-no" title="function not covered" >buildNetworkConfigurationsByNetworkClientId(</span>
+  networkConfigurationsByChainId: Record&lt;Hex, NetworkConfiguration&gt;,
+): Map&lt;NetworkClientId, NetworkConfiguration&gt; {
+<span class="cstat-no" title="statement not covered" >  return new Map(</span>
+    Object.values(networkConfigurationsByChainId).flatMap(
+<span class="fstat-no" title="function not covered" >      (n</span>etworkConfiguration) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return networkConfiguration.rpcEndpoints.map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return [rpcEndpoint.networkClientId, networkConfiguration];</span>
+        });
+      },
+    ),
+  );
+}
+&nbsp;
+/**
+ * Controller that creates and manages an Ethereum network provider.
+ */
+<span class="cstat-no" title="statement not covered" >export class N</span>etworkController extends BaseController&lt;
+  typeof controllerName,
+  NetworkState,
+  NetworkControllerMessenger
+&gt; {
+<span class="cstat-no" title="statement not covered" >  #ethQuery?: EthQuery;</span>
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#infuraProjectId: string;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #previouslySelectedNetworkClientId: string;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #providerProxy: ProviderProxy | undefined;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #blockTrackerProxy: BlockTrackerProxy | undefined;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #autoManagedNetworkClient?:</span>
+    | AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;
+    | AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;;
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#log: Logger | undefined;</span>
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];</span>
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #networkConfigurationsByNetworkClientId: Map&lt;</span>
+    NetworkClientId,
+    NetworkConfiguration
+  &gt;;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #isRpcFailoverEnabled: Exclude&lt;</span>
+    NetworkControllerOptions['isRpcFailoverEnabled'],
+    undefined
+  &gt;;
+&nbsp;
+  /**
+   * Constructs a NetworkController.
+   *
+   * @param options - The options; see {@link NetworkControllerOptions}.
+   */
+<span class="fstat-no" title="function not covered" >  constructor(o</span>ptions: NetworkControllerOptions) {
+    const {
+      messenger,
+      state,
+      infuraProjectId,
+      log,
+      getRpcServiceOptions,
+      getBlockTrackerOptions,
+      additionalDefaultNetworks,
+      isRpcFailoverEnabled = <span class="branch-0 cbranch-no" title="branch not covered" >false,</span>
+    } = <span class="cstat-no" title="statement not covered" >options;</span>
+    const initialState = <span class="cstat-no" title="statement not covered" >{</span>
+      ...getDefaultNetworkControllerState(additionalDefaultNetworks),
+      ...state,
+    };
+<span class="cstat-no" title="statement not covered" >    validateInitialState(initialState);</span>
+    const correctedInitialState = <span class="cstat-no" title="statement not covered" >correctInitialState(initialState, messenger);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!infuraProjectId || typeof infuraProjectId !== 'string') {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error('Invalid Infura project ID');</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    super({</span>
+      name: controllerName,
+      metadata: {
+        selectedNetworkClientId: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+        networksMetadata: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+        networkConfigurationsByChainId: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+      },
+      messenger,
+      state: correctedInitialState,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#infuraProjectId = infuraProjectId;</span>
+<span class="cstat-no" title="statement not covered" >    this.#log = log;</span>
+<span class="cstat-no" title="statement not covered" >    this.#getRpcServiceOptions = getRpcServiceOptions;</span>
+<span class="cstat-no" title="statement not covered" >    this.#getBlockTrackerOptions = getBlockTrackerOptions;</span>
+<span class="cstat-no" title="statement not covered" >    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#previouslySelectedNetworkClientId =</span>
+      this.state.selectedNetworkClientId;
+<span class="cstat-no" title="statement not covered" >    this.#networkConfigurationsByNetworkClientId =</span>
+      buildNetworkConfigurationsByNetworkClientId(
+        this.state.networkConfigurationsByChainId,
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, <span class="fstat-no" title="function not covered" >() =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      return this.#ethQuery;</span>
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getNetworkClientById`,
+      this.getNetworkClientById.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getEIP1559Compatibility`,
+      this.getEIP1559Compatibility.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:setActiveNetwork`,
+      this.setActiveNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:setProviderType`,
+      this.setProviderType.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:findNetworkClientIdByChainId`,
+      this.findNetworkClientIdByChainId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getNetworkConfigurationByChainId`,
+      this.getNetworkConfigurationByChainId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getNetworkConfigurationByNetworkClientId`,
+      this.getNetworkConfigurationByNetworkClientId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getSelectedNetworkClient`,
+      this.getSelectedNetworkClient.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getSelectedChainId`,
+      this.getSelectedChainId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:addNetwork`,
+      this.addNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:removeNetwork`,
+      this.removeNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:updateNetwork`,
+      this.updateNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe(</span>
+      `${this.name}:rpcEndpointChainUnavailable`,
+<span class="fstat-no" title="function not covered" >      ({</span> networkClientId }) =&gt; {
+<span class="cstat-no" title="statement not covered" >        this.#updateMetadataForNetwork(networkClientId, {</span>
+          networkStatus: NetworkStatus.Unavailable,
+        });
+      },
+    );
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe(</span>
+      `${this.name}:rpcEndpointChainDegraded`,
+<span class="fstat-no" title="function not covered" >      ({</span> networkClientId }) =&gt; {
+<span class="cstat-no" title="statement not covered" >        this.#updateMetadataForNetwork(networkClientId, {</span>
+          networkStatus: NetworkStatus.Degraded,
+        });
+      },
+    );
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe(</span>
+      `${this.name}:rpcEndpointChainAvailable`,
+<span class="fstat-no" title="function not covered" >      ({</span> networkClientId }) =&gt; {
+<span class="cstat-no" title="statement not covered" >        this.#updateMetadataForNetwork(networkClientId, {</span>
+          networkStatus: NetworkStatus.Available,
+        });
+      },
+    );
+  }
+&nbsp;
+  /**
+   * Enables the RPC failover functionality. That is, if any RPC endpoints are
+   * configured with failover URLs, then traffic will automatically be diverted
+   * to them if those RPC endpoints are unavailable.
+   */
+<span class="fstat-no" title="function not covered" >  enableRpcFailover(</span>): void {
+<span class="cstat-no" title="statement not covered" >    this.#updateRpcFailoverEnabled(true);</span>
+  }
+&nbsp;
+  /**
+   * Disables the RPC failover functionality. That is, even if any RPC endpoints
+   * are configured with failover URLs, then traffic will not automatically be
+   * diverted to them if those RPC endpoints are unavailable.
+   */
+<span class="fstat-no" title="function not covered" >  disableRpcFailover(</span>): void {
+<span class="cstat-no" title="statement not covered" >    this.#updateRpcFailoverEnabled(false);</span>
+  }
+&nbsp;
+  /**
+   * Enables or disables the RPC failover functionality, depending on the
+   * boolean given. This is done by reconstructing all network clients that were
+   * originally configured with failover URLs so that those URLs are either
+   * honored or ignored. Network client IDs will be preserved so as not to
+   * invalidate state in other controllers.
+   *
+   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the
+   * RPC failover functionality.
+   */
+  #updateRpcFailoverEnabled(<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >newIsRpcFailoverEnabled: boolean)</span>: void {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {</span>
+<span class="cstat-no" title="statement not covered" >      return;</span>
+    }
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const networkClientsById of Object.values(</span>
+      autoManagedNetworkClientRegistry,
+    )) {
+<span class="cstat-no" title="statement not covered" >      for (const networkClientId of Object.keys(networkClientsById)) {</span>
+        // Type assertion: We can assume that `networkClientId` is valid here.
+        const networkClient =
+<span class="cstat-no" title="statement not covered" >          networkClientsById[</span>
+            networkClientId as keyof typeof networkClientsById
+          ];
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+          networkClient.configuration.failoverRpcUrls &amp;&amp;
+          networkClient.configuration.failoverRpcUrls.length &gt; 0
+        ) {
+<span class="cstat-no" title="statement not covered" >          newIsRpcFailoverEnabled</span>
+            ? networkClient.enableRpcFailover()
+            : networkClient.disableRpcFailover();
+        }
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;</span>
+  }
+&nbsp;
+  /**
+   * Accesses the provider and block tracker for the currently selected network.
+   *
+   * @returns The proxy and block tracker proxies.
+   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.
+   */
+<span class="fstat-no" title="function not covered" >  getProviderAndBlockTracker(</span>): {
+    provider: SwappableProxy&lt;ProxyWithAccessibleTarget&lt;Provider&gt;&gt; | undefined;
+    blockTracker:
+      | SwappableProxy&lt;ProxyWithAccessibleTarget&lt;BlockTracker&gt;&gt;
+      | undefined;
+  } {
+<span class="cstat-no" title="statement not covered" >    return {</span>
+      provider: this.#providerProxy,
+      blockTracker: this.#blockTrackerProxy,
+    };
+  }
+&nbsp;
+  /**
+   * Accesses the provider and block tracker for the currently selected network.
+   *
+   * @returns an object with the provider and block tracker proxies for the currently selected network.
+   */
+<span class="fstat-no" title="function not covered" >  getSelectedNetworkClient(</span>):
+    | {
+        provider: SwappableProxy&lt;ProxyWithAccessibleTarget&lt;Provider&gt;&gt;;
+        blockTracker: SwappableProxy&lt;ProxyWithAccessibleTarget&lt;BlockTracker&gt;&gt;;
+      }
+    | undefined {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#providerProxy &amp;&amp; this.#blockTrackerProxy) {</span>
+<span class="cstat-no" title="statement not covered" >      return {</span>
+        provider: this.#providerProxy,
+        blockTracker: this.#blockTrackerProxy,
+      };
+    }
+<span class="cstat-no" title="statement not covered" >    return undefined;</span>
+  }
+&nbsp;
+  /**
+   * Accesses the chain ID from the selected network client.
+   *
+   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.
+   */
+<span class="fstat-no" title="function not covered" >  getSelectedChainId(</span>): Hex | undefined {
+    const networkConfiguration = <span class="cstat-no" title="statement not covered" >this.getNetworkConfigurationByNetworkClientId(</span>
+      this.state.selectedNetworkClientId,
+    );
+<span class="cstat-no" title="statement not covered" >    return networkConfiguration?.chainId;</span>
+  }
+&nbsp;
+  /**
+   * Internally, the Infura and custom network clients are categorized by type
+   * so that when accessing either kind of network client, TypeScript knows
+   * which type to assign to the network client. For some cases it's more useful
+   * to be able to access network clients by ID instead of by type and then ID,
+   * so this function makes that possible.
+   *
+   * @returns The network clients registered so far, keyed by ID.
+   */
+<span class="fstat-no" title="function not covered" >  getNetworkClientRegistry(</span>): AutoManagedBuiltInNetworkClientRegistry &amp;
+    AutoManagedCustomNetworkClientRegistry {
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return Object.assign(</span>
+      {},
+      autoManagedNetworkClientRegistry[NetworkClientType.Infura],
+      autoManagedNetworkClientRegistry[NetworkClientType.Custom],
+    );
+  }
+&nbsp;
+  /**
+   * Returns the Infura network client with the given ID.
+   *
+   * @param infuraNetworkClientId - An Infura network client ID.
+   * @returns The Infura network client.
+   * @throws If an Infura network client does not exist with the given ID.
+   */
+  getNetworkClientById(
+    infuraNetworkClientId: BuiltInNetworkClientId,
+  ): AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;;
+&nbsp;
+  /**
+   * Returns the custom network client with the given ID.
+   *
+   * @param customNetworkClientId - A custom network client ID.
+   * @returns The custom network client.
+   * @throws If a custom network client does not exist with the given ID.
+   */
+  getNetworkClientById(
+    customNetworkClientId: CustomNetworkClientId,
+  ): AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  getNetworkClientById(</span>
+    networkClientId: NetworkClientId,
+  ): AutoManagedNetworkClient&lt;NetworkClientConfiguration&gt; {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!networkClientId) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error('No network client ID was provided.');</span>
+    }
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInfuraNetworkType(networkClientId)) {</span>
+      const infuraNetworkClient =
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Infura][</span>
+          networkClientId
+        ];
+      // This is impossible to reach
+      /* istanbul ignore if */
+<span class="cstat-no" title="statement not covered" >      if (!infuraNetworkClient) {</span>
+        throw new Error(
+          `No Infura network client was found with the ID "${networkClientId}".`,
+        );
+      }
+<span class="cstat-no" title="statement not covered" >      return infuraNetworkClient;</span>
+    }
+&nbsp;
+    const customNetworkClient =
+<span class="cstat-no" title="statement not covered" >      autoManagedNetworkClientRegistry[NetworkClientType.Custom][</span>
+        networkClientId
+      ];
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!customNetworkClient) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `No custom network client was found with the ID "${networkClientId}".`,
+      );
+    }
+<span class="cstat-no" title="statement not covered" >    return customNetworkClient;</span>
+  }
+&nbsp;
+  /**
+   * Executes a series of steps to switch the network:
+   *
+   * 1. Notifies subscribers via the messenger that the network is about to be
+   * switched (and, really, that the global provider and block tracker proxies
+   * will be re-pointed to a new network).
+   * 2. Looks up a known and preinitialized network client matching the given
+   * ID and uses it to re-point the aforementioned provider and block tracker
+   * proxies.
+   * 3. Notifies subscribers via the messenger that the network has switched.
+   * 4. Captures metadata for the newly switched network in state.
+   *
+   * @param networkClientId - The ID of a network client that requests will be
+   * routed through (either the name of an Infura network or the ID of a custom
+   * network configuration).
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   */
+  async<span class="fstat-no" title="function not covered" > #refreshNetwork(</span>
+    networkClientId: string,
+    options: {
+      updateState?: (state: Draft&lt;NetworkState&gt;) =&gt; void;
+    } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish('NetworkController:networkWillChange', this.state);</span>
+<span class="cstat-no" title="statement not covered" >    this.#applyNetworkSelection(networkClientId, options);</span>
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish('NetworkController:networkDidChange', this.state);</span>
+<span class="cstat-no" title="statement not covered" >    await this.lookupNetwork();</span>
+  }
+&nbsp;
+  /**
+   * Creates proxies for accessing the global network client and its block
+   * tracker. You must call this method in order to use
+   * `getProviderAndBlockTracker` (or its replacement,
+   * `getSelectedNetworkClient`).
+   *
+   * @param options - Optional arguments.
+   * @param options.lookupNetwork - Usually, metadata for the global network
+   * will be populated via a call to `lookupNetwork` after creating the provider
+   * and block tracker proxies. This allows for responding to the status of the
+   * global network after initializing this controller; however, it requires
+   * making a request to the network to do so. In the clients, where controllers
+   * are initialized before the UI is shown, this may be undesirable, as it
+   * means that if the user has just installed MetaMask, their IP address may be
+   * shared with a third party before they have a chance to finish onboarding.
+   * You can pass `false` if you'd like to disable this request and call
+   * `lookupNetwork` yourself.
+   */
+  initializeProvider(options: { lookupNetwork: false }): void;
+&nbsp;
+  /**
+   * Creates proxies for accessing the global network client and its block
+   * tracker. You must call this method in order to use
+   * `getProviderAndBlockTracker` (or its replacement,
+   * `getSelectedNetworkClient`).
+   *
+   * @param options - Optional arguments.
+   * @param options.lookupNetwork - Usually, metadata for the global network
+   * will be populated via a call to `lookupNetwork` after creating the provider
+   * and block tracker proxies. This allows for responding to the status of the
+   * global network after initializing this controller; however, it requires
+   * making a request to the network to do so. In the clients, where controllers
+   * are initialized before the UI is shown, this may be undesirable, as it
+   * means that if the user has just installed MetaMask, their IP address may be
+   * shared with a third party before they have a chance to finish onboarding.
+   * You can pass `false` if you'd like to disable this request and call
+   * `lookupNetwork` yourself.
+   * @returns A promise that resolves when the network lookup completes.
+   */
+  initializeProvider(options?: { lookupNetwork?: boolean }): Promise&lt;void&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  initializeProvider(</span>{
+    lookupNetwork = <span class="branch-0 cbranch-no" title="branch not covered" >true,</span>
+  }: {
+    lookupNetwork?: boolean;
+  } = <span class="branch-0 cbranch-no" title="branch not covered" >{})</span>: Promise&lt;void&gt; | undefined {
+<span class="cstat-no" title="statement not covered" >    this.#applyNetworkSelection(this.state.selectedNetworkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (lookupNetwork) {</span>
+<span class="cstat-no" title="statement not covered" >      return this.lookupNetwork();</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return undefined;</span>
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network:
+   *
+   * - The connectivity status: whether it is available, geo-blocked (Infura
+   * only), unavailable, or unknown
+   * - The capabilities status: whether it supports EIP-1559, whether it does
+   * not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * If no ID is provided, uses the currently selected network.
+   * @returns The resulting metadata for the network.
+   */
+  async<span class="fstat-no" title="function not covered" > #determineNetworkMetadata(n</span>etworkClientId: NetworkClientId): Promise&lt;{
+    isInfura: boolean;
+    networkStatus:
+      | NetworkStatus.Available
+      | NetworkStatus.Unknown
+      | NetworkStatus.Unavailable
+      | NetworkStatus.Blocked;
+    isEIP1559Compatible: undefined | boolean;
+  }&gt; {
+    // Force TypeScript to use one of the two overloads explicitly
+    const networkClient = <span class="cstat-no" title="statement not covered" >isInfuraNetworkType(networkClientId)</span>
+      ? this.getNetworkClientById(networkClientId)
+      : this.getNetworkClientById(networkClientId);
+&nbsp;
+    const isInfura =
+<span class="cstat-no" title="statement not covered" >      networkClient.configuration.type === NetworkClientType.Infura;</span>
+    let networkStatus: NetworkStatus;
+    let isEIP1559Compatible: boolean | undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    try {</span>
+<span class="cstat-no" title="statement not covered" >      isEIP1559Compatible =</span>
+        await this.#determineEIP1559Compatibility(networkClientId);
+<span class="cstat-no" title="statement not covered" >      networkStatus = NetworkStatus.Available;</span>
+    } catch (error) {
+<span class="cstat-no" title="statement not covered" >      debugLog('NetworkController: lookupNetwork: ', error);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      if (isErrorWithCode(error)) {</span>
+        let responseBody;
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+          isInfura &amp;&amp;
+          hasProperty(error, 'message') &amp;&amp;
+          typeof error.message === 'string'
+        ) {
+<span class="cstat-no" title="statement not covered" >          try {</span>
+<span class="cstat-no" title="statement not covered" >            responseBody = JSON.parse(error.message);</span>
+          } catch {
+            // error.message must not be JSON
+<span class="cstat-no" title="statement not covered" >            this.#log?.warn(</span>
+              'NetworkController: lookupNetwork: json parse error: ',
+              error,
+            );
+          }
+        }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        if (</span>
+          isPlainObject(responseBody) &amp;&amp;
+          responseBody.error === INFURA_BLOCKED_KEY
+        ) {
+<span class="cstat-no" title="statement not covered" >          networkStatus = NetworkStatus.Blocked;</span>
+        } else <span class="cstat-no" title="statement not covered" >if (error.code === errorCodes.rpc.internal) {</span>
+<span class="cstat-no" title="statement not covered" >          networkStatus = NetworkStatus.Unknown;</span>
+<span class="cstat-no" title="statement not covered" >          this.#log?.warn(</span>
+            'NetworkController: lookupNetwork: rpc internal error: ',
+            error,
+          );
+        } else {
+<span class="cstat-no" title="statement not covered" >          networkStatus = NetworkStatus.Unavailable;</span>
+<span class="cstat-no" title="statement not covered" >          this.#log?.warn('NetworkController: lookupNetwork: ', error);</span>
+        }
+      } else {
+<span class="cstat-no" title="statement not covered" >        debugLog(</span>
+          'NetworkController - could not determine network status',
+          error,
+        );
+<span class="cstat-no" title="statement not covered" >        networkStatus = NetworkStatus.Unknown;</span>
+<span class="cstat-no" title="statement not covered" >        this.#log?.warn('NetworkController: lookupNetwork: ', error);</span>
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { isInfura, networkStatus, isEIP1559Compatible };</span>
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given or selected network, persisting it to state:
+   *
+   * - The connectivity status: whether it is available, geo-blocked (Infura
+   * only), unavailable, or unknown
+   * - The capabilities status: whether it supports EIP-1559, whether it does
+   * not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * If no ID is provided, uses the currently selected network.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>lookupNetwork(networkClientId?: NetworkClientId): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    if (networkClientId) {</span>
+<span class="cstat-no" title="statement not covered" >      await this.#lookupGivenNetwork(networkClientId);</span>
+    } else {
+<span class="cstat-no" title="statement not covered" >      await this.#lookupSelectedNetwork();</span>
+    }
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * @deprecated Please use `lookupNetwork` and pass a network client ID
+   * instead. This method will be removed in a future major version.
+   */
+  // We are planning on removing this so we aren't interested in testing this
+  // right now.
+  /* istanbul ignore next */
+  async lookupNetworkByClientId(
+    networkClientId: NetworkClientId,
+  ): Promise&lt;void&gt; {
+    await this.#lookupGivenNetwork(networkClientId);
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   */
+  async<span class="fstat-no" title="function not covered" > #lookupGivenNetwork(n</span>etworkClientId: NetworkClientId): Promise&lt;void&gt; {
+    const { networkStatus, isEIP1559Compatible } =
+<span class="cstat-no" title="statement not covered" >      await this.#determineNetworkMetadata(networkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#updateMetadataForNetwork(networkClientId, {</span>
+      networkStatus,
+      isEIP1559Compatible,
+    });
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the currently selected network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * Note that it is possible for the current network to be switched while this
+   * method is running. If that is the case, it will exit early (as this method
+   * will also run for the new network).
+   */
+  async<span class="fstat-no" title="function not covered" > #lookupSelectedNetwork(): Promise&lt;void&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.#ethQuery) {</span>
+<span class="cstat-no" title="statement not covered" >      return;</span>
+    }
+&nbsp;
+    let networkChanged = <span class="cstat-no" title="statement not covered" >false;</span>
+    const listener = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      networkChanged = true;</span>
+<span class="cstat-no" title="statement not covered" >      try {</span>
+<span class="cstat-no" title="statement not covered" >        this.messenger.unsubscribe(</span>
+          'NetworkController:networkDidChange',
+          listener,
+        );
+      } catch (error) {
+        // In theory, this `catch` should not be necessary given that this error
+        // would occur "inside" of the call to `#determineEIP1559Compatibility`
+        // below and so it should be caught by the `try`/`catch` below (it is
+        // impossible to reproduce in tests for that reason). However, somehow
+        // it occurs within Mobile and so we have to add our own `try`/`catch`
+        // here.
+        /* istanbul ignore next */
+        if (
+          !(error instanceof Error) ||
+          error.message !==
+            'Subscription not found for event: NetworkController:networkDidChange'
+        ) {
+          // Again, this error should not happen and is impossible to reproduce
+          // in tests.
+          /* istanbul ignore next */
+          throw error;
+        }
+      }
+    };
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe('NetworkController:networkDidChange', listener);</span>
+&nbsp;
+    const { isInfura, networkStatus, isEIP1559Compatible } =
+<span class="cstat-no" title="statement not covered" >      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkChanged) {</span>
+      // If the network has changed, then `lookupNetwork` either has been or is
+      // in the process of being called, so we don't need to go further.
+<span class="cstat-no" title="statement not covered" >      return;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    try {</span>
+<span class="cstat-no" title="statement not covered" >      this.messenger.unsubscribe(</span>
+        'NetworkController:networkDidChange',
+        listener,
+      );
+    } catch (error) {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        !(error instanceof Error) ||
+        error.message !==
+          'Subscription not found for event: NetworkController:networkDidChange'
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw error;</span>
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {</span>
+      networkStatus,
+      isEIP1559Compatible,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (isInfura) {</span>
+<span class="cstat-no" title="statement not covered" >      if (networkStatus === NetworkStatus.Available) {</span>
+<span class="cstat-no" title="statement not covered" >        this.messenger.publish('NetworkController:infuraIsUnblocked');</span>
+      } else <span class="cstat-no" title="statement not covered" ><span class="missing-if-branch" title="if path not taken" >I</span>if (networkStatus === NetworkStatus.Blocked) {</span>
+<span class="cstat-no" title="statement not covered" >        this.messenger.publish('NetworkController:infuraIsBlocked');</span>
+      }
+    } else {
+      // Always publish infuraIsUnblocked regardless of network status to
+      // prevent consumers from being stuck in a blocked state if they were
+      // previously connected to an Infura network that was blocked
+<span class="cstat-no" title="statement not covered" >      this.messenger.publish('NetworkController:infuraIsUnblocked');</span>
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Updates the metadata for the given network in state.
+   *
+   * @param networkClientId - The associated network client ID.
+   * @param metadata - The metadata to store in state.
+   * @param metadata.networkStatus - The network status to store in state.
+   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to
+   * store in state.
+   */
+  #updateMetadataForNetwork(
+    networkClientId: NetworkClientId,
+    metadata: {
+      networkStatus: NetworkStatus;
+      isEIP1559Compatible?: boolean | undefined;
+    },
+  ): void {
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      state.networksMetadata[networkClientId] ??= {</span>
+        status: NetworkStatus.Unknown,
+        EIPS: {},
+      };
+&nbsp;
+      const newMetadata = <span class="cstat-no" title="statement not covered" >state.networksMetadata[networkClientId];</span>
+<span class="cstat-no" title="statement not covered" >      newMetadata.status = metadata.networkStatus;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if ('isEIP1559Compatible' in metadata) {</span>
+<span class="cstat-no" title="statement not covered" >        if (metadata.isEIP1559Compatible === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >          delete newMetadata.EIPS[1559];</span>
+        } else {
+<span class="cstat-no" title="statement not covered" >          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;</span>
+        }
+      }
+    });
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Convenience method to update provider network type settings.
+   *
+   * @param type - Human readable network name.
+   * @deprecated This has been replaced by `setActiveNetwork`, and will be
+   * removed in a future release
+   */
+<span class="fstat-no" title="function not covered" >  async </span>setProviderType(type: InfuraNetworkType): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if ((type as unknown) === NetworkType.rpc) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController - cannot call "setProviderType" with type "${NetworkType.rpc}". Use "setActiveNetwork"`,
+      );
+    }
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!isInfuraNetworkType(type)) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(`Unknown Infura provider type "${String(type)}".`);</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    await this.setActiveNetwork(type);</span>
+  }
+&nbsp;
+  /**
+   * Changes the selected network.
+   *
+   * @param networkClientId - The ID of a network client that will be used to
+   * make requests.
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   * @throws if no network client is associated with the given
+   * network client ID.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>setActiveNetwork(
+    networkClientId: string,
+    options: {
+      updateState?: (state: Draft&lt;NetworkState&gt;) =&gt; void;
+    } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    this.#previouslySelectedNetworkClientId =</span>
+      this.state.selectedNetworkClientId;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    await this.#refreshNetwork(networkClientId, options);</span>
+  }
+&nbsp;
+  /**
+   * Fetches the latest block for the network.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.
+   * @returns A promise that either resolves to the block header or null if
+   * there is no latest block, or rejects with an error.
+   */
+  #getLatestBlock(
+    networkClientId: NetworkClientId = <span class="branch-0 cbranch-no" title="branch not covered" >this.state.selectedNetworkClientId,</span>
+  ): Promise&lt;Block&gt; {
+    const networkClient = <span class="cstat-no" title="statement not covered" >this.getNetworkClientById(networkClientId);</span>
+    const ethQuery = <span class="cstat-no" title="statement not covered" >new EthQuery(networkClient.provider);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return new Promise(<span class="fstat-no" title="function not covered" >(r</span>esolve, reject) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      ethQuery.sendAsync(</span>
+        { method: 'eth_getBlockByNumber', params: ['latest', false] },
+<span class="fstat-no" title="function not covered" >        (e</span>rror: unknown, block?: unknown) =&gt; {
+<span class="cstat-no" title="statement not covered" >          if (error) {</span>
+            // This error comes from JsonRpcEngine, we don't control it.
+            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors
+<span class="cstat-no" title="statement not covered" >            reject(error);</span>
+          } else {
+            // TODO: Validate this type
+<span class="cstat-no" title="statement not covered" >            resolve(block as Block);</span>
+          }
+        },
+      );
+    });
+  }
+&nbsp;
+  /**
+   * Determines whether the network supports EIP-1559 by checking whether the
+   * latest block has a `baseFeePerGas` property, then updates state
+   * appropriately.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.
+   * @returns A promise that resolves to true if the network supports EIP-1559
+   * , false otherwise, or `undefined` if unable to determine the compatibility.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>getEIP1559Compatibility(
+    networkClientId?: NetworkClientId,
+  ): Promise&lt;undefined | boolean&gt; {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkClientId) {</span>
+<span class="cstat-no" title="statement not covered" >      return this.get1559CompatibilityWithNetworkClientId(networkClientId);</span>
+    }
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.#ethQuery) {</span>
+<span class="cstat-no" title="statement not covered" >      return false;</span>
+    }
+&nbsp;
+    const { EIPS } =
+<span class="cstat-no" title="statement not covered" >      this.state.networksMetadata[this.state.selectedNetworkClientId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (EIPS[1559] !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      return EIPS[1559];</span>
+    }
+&nbsp;
+    const isEIP1559Compatible = <span class="cstat-no" title="statement not covered" >await this.#determineEIP1559Compatibility(</span>
+      this.state.selectedNetworkClientId,
+    );
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (isEIP1559Compatible !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =</span>
+          isEIP1559Compatible;
+      }
+    });
+<span class="cstat-no" title="statement not covered" >    return isEIP1559Compatible;</span>
+  }
+&nbsp;
+<span class="fstat-no" title="function not covered" >  async </span>get1559CompatibilityWithNetworkClientId(
+    networkClientId: NetworkClientId,
+  ): Promise&lt;boolean&gt; {
+    let metadata = <span class="cstat-no" title="statement not covered" >this.state.networksMetadata[networkClientId];</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (metadata?.EIPS[1559] === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      await this.lookupNetwork(networkClientId);</span>
+<span class="cstat-no" title="statement not covered" >      metadata = this.state.networksMetadata[networkClientId];</span>
+    }
+    const { EIPS } = <span class="cstat-no" title="statement not covered" >metadata;</span>
+&nbsp;
+    // may want to include some 'freshness' value - something to make sure we refetch this from time to time
+<span class="cstat-no" title="statement not covered" >    return EIPS[1559];</span>
+  }
+&nbsp;
+  /**
+   * Retrieves and checks the latest block from the currently selected
+   * network; if the block has a `baseFeePerGas` property, then we know
+   * that the network supports EIP-1559; otherwise it doesn't.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility
+   * @returns A promise that resolves to `true` if the network supports EIP-1559,
+   * `false` otherwise, or `undefined` if unable to retrieve the last block.
+   */
+  async<span class="fstat-no" title="function not covered" > #determineEIP1559Compatibility(</span>
+    networkClientId: NetworkClientId,
+  ): Promise&lt;boolean | undefined&gt; {
+    const latestBlock = <span class="cstat-no" title="statement not covered" >await this.#getLatestBlock(networkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!latestBlock) {</span>
+<span class="cstat-no" title="statement not covered" >      return undefined;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return latestBlock.baseFeePerGas !== undefined;</span>
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Ensures that the provider and block tracker proxies are pointed to the
+   * currently selected network and refreshes the metadata for the
+   */
+<span class="fstat-no" title="function not covered" >  async </span>resetConnection(): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    await this.#refreshNetwork(this.state.selectedNetworkClientId);</span>
+  }
+&nbsp;
+  /**
+   * Returns the network configuration that has been filed under the given chain
+   * ID.
+   *
+   * @param chainId - The chain ID to use as a key.
+   * @returns The network configuration if one exists, or undefined.
+   */
+<span class="fstat-no" title="function not covered" >  getNetworkConfigurationByChainId(</span>
+    chainId: Hex,
+  ): NetworkConfiguration | undefined {
+<span class="cstat-no" title="statement not covered" >    return this.state.networkConfigurationsByChainId[chainId];</span>
+  }
+&nbsp;
+  /**
+   * Returns the network configuration that contains an RPC endpoint with the
+   * given network client ID.
+   *
+   * @param networkClientId - The network client ID to use as a key.
+   * @returns The network configuration if one exists, or undefined.
+   */
+<span class="fstat-no" title="function not covered" >  getNetworkConfigurationByNetworkClientId(</span>
+    networkClientId: NetworkClientId,
+  ): NetworkConfiguration | undefined {
+<span class="cstat-no" title="statement not covered" >    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);</span>
+  }
+&nbsp;
+  /**
+   * Creates and registers network clients for the collection of Infura and
+   * custom RPC endpoints that can be used to make requests for a particular
+   * chain, storing the given configuration object in state for later reference.
+   *
+   * @param fields - The object that describes the new network/chain and lists
+   * the RPC endpoints which front that chain.
+   * @returns The newly added network configuration.
+   * @throws if any part of `fields` would produce invalid state.
+   * @see {@link NetworkConfiguration}
+   */
+<span class="fstat-no" title="function not covered" >  addNetwork(</span>fields: AddNetworkFields): NetworkConfiguration {
+    const { rpcEndpoints: setOfRpcEndpointFields } = <span class="cstat-no" title="statement not covered" >fields;</span>
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#validateNetworkFields({</span>
+      mode: 'add',
+      networkFields: fields,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+    const networkClientOperations = <span class="cstat-no" title="statement not covered" >setOfRpcEndpointFields.map(</span>
+<span class="fstat-no" title="function not covered" >      (d</span>efaultOrCustomRpcEndpointFields) =&gt; {
+        const rpcEndpoint =
+<span class="cstat-no" title="statement not covered" >          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom</span>
+            ? {
+                ...defaultOrCustomRpcEndpointFields,
+                networkClientId: uuidV4(),
+              }
+            : defaultOrCustomRpcEndpointFields;
+<span class="cstat-no" title="statement not covered" >        return {</span>
+          type: 'add' as const,
+          rpcEndpoint,
+        };
+      },
+    );
+&nbsp;
+    const newNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.#determineNetworkConfigurationToPersist({</span>
+        networkFields: fields,
+        networkClientOperations,
+      });
+<span class="cstat-no" title="statement not covered" >    this.#registerNetworkClientsAsNeeded({</span>
+      networkFields: fields,
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      this.#updateNetworkConfigurations({</span>
+        state,
+        mode: 'add',
+        networkFields: fields,
+        networkConfigurationToPersist: newNetworkConfiguration,
+      });
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish(</span>
+      `${controllerName}:networkAdded`,
+      newNetworkConfiguration,
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return newNetworkConfiguration;</span>
+  }
+&nbsp;
+  /**
+   * Updates the configuration for a previously stored network filed under the
+   * given chain ID, creating + registering new network clients to represent RPC
+   * endpoints that have been added and destroying + unregistering existing
+   * network clients for RPC endpoints that have been removed.
+   *
+   * Note that if `chainId` is changed, then all network clients associated with
+   * that chain will be removed and re-added, even if none of the RPC endpoints
+   * have changed.
+   *
+   * @param chainId - The chain ID associated with an existing network.
+   * @param fields - The object that describes the updates to the network/chain,
+   * including the new set of RPC endpoints which should front that chain.
+   * @param options - Options to provide.
+   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot
+   * remove an RPC endpoint that is being represented by the currently selected
+   * network client. This option allows you to specify another RPC endpoint
+   * (either an existing one or a new one) that should be used to select a new
+   * network instead.
+   * @returns The updated network configuration.
+   * @throws if `chainId` does not refer to an existing network configuration,
+   * if any part of `fields` would produce invalid state, etc.
+   * @see {@link NetworkConfiguration}
+   */
+<span class="fstat-no" title="function not covered" >  async </span>updateNetwork(
+    chainId: Hex,
+    fields: UpdateNetworkFields,
+    {
+      replacementSelectedRpcEndpointIndex,
+    }: { replacementSelectedRpcEndpointIndex?: number } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;NetworkConfiguration&gt; {
+    const existingNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.state.networkConfigurationsByChainId[chainId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (existingNetworkConfiguration === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `Could not update network: Cannot find network configuration for chain '${chainId}'`,
+      );
+    }
+&nbsp;
+    const existingChainId = <span class="cstat-no" title="statement not covered" >chainId;</span>
+    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =
+<span class="cstat-no" title="statement not covered" >      fields;</span>
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#validateNetworkFields({</span>
+      mode: 'update',
+      networkFields: fields,
+      existingNetworkConfiguration,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+    const networkClientOperations: NetworkClientOperation[] = <span class="cstat-no" title="statement not covered" >[];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {</span>
+      const existingRpcEndpointForNoop =
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration.rpcEndpoints.find(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            rpcEndpoint.type === newRpcEndpointFields.type &amp;&amp;
+            rpcEndpoint.url === newRpcEndpointFields.url &amp;&amp;
+            (rpcEndpoint.networkClientId ===
+              newRpcEndpointFields.networkClientId ||
+              newRpcEndpointFields.networkClientId === undefined)
+          );
+        });
+      const existingRpcEndpointForReplaceWhenChainChanged =
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration.rpcEndpoints.find(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            (rpcEndpoint.type === RpcEndpointType.Infura &amp;&amp;
+              newRpcEndpointFields.type === RpcEndpointType.Infura) ||
+            (rpcEndpoint.type === newRpcEndpointFields.type &amp;&amp;
+              rpcEndpoint.networkClientId ===
+                newRpcEndpointFields.networkClientId &amp;&amp;
+              rpcEndpoint.url === newRpcEndpointFields.url)
+          );
+        });
+      const existingRpcEndpointForReplaceWhenChainNotChanged =
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration.rpcEndpoints.find(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            rpcEndpoint.type === newRpcEndpointFields.type &amp;&amp;
+            (rpcEndpoint.url === newRpcEndpointFields.url ||
+              rpcEndpoint.networkClientId ===
+                newRpcEndpointFields.networkClientId)
+          );
+        });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      if (</span>
+        newChainId !== existingChainId &amp;&amp;
+        existingRpcEndpointForReplaceWhenChainChanged !== undefined
+      ) {
+        const newRpcEndpoint =
+<span class="cstat-no" title="statement not covered" >          newRpcEndpointFields.type === RpcEndpointType.Infura</span>
+            ? newRpcEndpointFields
+            : { ...newRpcEndpointFields, networkClientId: uuidV4() };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push({</span>
+          type: 'replace' as const,
+          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,
+          newRpcEndpoint,
+        });
+      } else <span class="cstat-no" title="statement not covered" >if (existingRpcEndpointForNoop !== undefined) {</span>
+        let newRpcEndpoint;
+<span class="cstat-no" title="statement not covered" >        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {</span>
+<span class="cstat-no" title="statement not covered" >          newRpcEndpoint = existingRpcEndpointForNoop;</span>
+        } else {
+          // `networkClientId` shouldn't be missing at this point; if it is,
+          // that's a mistake, so fill it back in
+<span class="cstat-no" title="statement not covered" >          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {</span>
+            networkClientId: existingRpcEndpointForNoop.networkClientId,
+          });
+        }
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push({</span>
+          type: 'noop' as const,
+          rpcEndpoint: newRpcEndpoint,
+        });
+      } else <span class="cstat-no" title="statement not covered" >if (</span>
+        existingRpcEndpointForReplaceWhenChainNotChanged === undefined
+      ) {
+        const newRpcEndpoint =
+<span class="cstat-no" title="statement not covered" >          newRpcEndpointFields.type === RpcEndpointType.Infura</span>
+            ? newRpcEndpointFields
+            : { ...newRpcEndpointFields, networkClientId: uuidV4() };
+        const networkClientOperation = <span class="cstat-no" title="statement not covered" >{</span>
+          type: 'add' as const,
+          rpcEndpoint: newRpcEndpoint,
+        };
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push(networkClientOperation);</span>
+      } else {
+        let newRpcEndpoint;
+        /* istanbul ignore if */
+<span class="cstat-no" title="statement not covered" >        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {</span>
+          // This case can't actually happen. If we're here, it means that some
+          // part of the RPC endpoint changed. But there is no part of an Infura
+          // RPC endpoint that can be changed (as it would immediately make that
+          // RPC endpoint self-inconsistent). This is just here to appease
+          // TypeScript.
+          newRpcEndpoint = newRpcEndpointFields;
+        } else <span class="missing-if-branch" title="if path not taken" >I</span>{
+<span class="cstat-no" title="statement not covered" >          newRpcEndpoint = {</span>
+            ...newRpcEndpointFields,
+            networkClientId: uuidV4(),
+          };
+        }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push({</span>
+          type: 'replace' as const,
+          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,
+          newRpcEndpoint,
+        });
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        !networkClientOperations.some(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; {
+          const otherRpcEndpoint =
+<span class="cstat-no" title="statement not covered" >            networkClientOperation.type === 'replace'</span>
+              ? networkClientOperation.oldRpcEndpoint
+              : networkClientOperation.rpcEndpoint;
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            otherRpcEndpoint.type === existingRpcEndpoint.type &amp;&amp;
+            otherRpcEndpoint.networkClientId ===
+              existingRpcEndpoint.networkClientId &amp;&amp;
+            otherRpcEndpoint.url === existingRpcEndpoint.url
+          );
+        })
+      ) {
+        const networkClientOperation = <span class="cstat-no" title="statement not covered" >{</span>
+          type: 'remove' as const,
+          rpcEndpoint: existingRpcEndpoint,
+        };
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push(networkClientOperation);</span>
+      }
+    }
+&nbsp;
+    const updatedNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.#determineNetworkConfigurationToPersist({</span>
+        networkFields: fields,
+        networkClientOperations,
+      });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      replacementSelectedRpcEndpointIndex === undefined &amp;&amp;
+      networkClientOperations.some(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          networkClientOperation.type === 'remove' &amp;&amp;
+          networkClientOperation.rpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      }) &amp;&amp;
+      !networkClientOperations.some(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          networkClientOperation.type === 'replace' &amp;&amp;
+          networkClientOperation.oldRpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      })
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \`replacementSelectedRpcEndpointIndex\` option.`,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#registerNetworkClientsAsNeeded({</span>
+      networkFields: fields,
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+    const replacementSelectedRpcEndpointWithIndex = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .map(
+<span class="fstat-no" title="function not covered" >        (n</span>etworkClientOperation, index) =&gt;
+<span class="cstat-no" title="statement not covered" >          [networkClientOperation, index] as const,</span>
+      )
+      .find(<span class="fstat-no" title="function not covered" >([</span>networkClientOperation, _index]) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          networkClientOperation.type === 'replace' &amp;&amp;
+          networkClientOperation.oldRpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      });
+    const correctedReplacementSelectedRpcEndpointIndex =
+<span class="cstat-no" title="statement not covered" >      replacementSelectedRpcEndpointIndex ??</span>
+      replacementSelectedRpcEndpointWithIndex?.[1];
+&nbsp;
+    let rpcEndpointToSelect: RpcEndpoint | undefined;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      rpcEndpointToSelect =</span>
+        updatedNetworkConfiguration.rpcEndpoints[
+          correctedReplacementSelectedRpcEndpointIndex
+        ];
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (rpcEndpointToSelect === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `Could not update network: \`replacementSelectedRpcEndpointIndex\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \`rpcEndpoints\``,
+        );
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (</span>
+      rpcEndpointToSelect &amp;&amp;
+      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId
+    ) {
+<span class="cstat-no" title="statement not covered" >      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {</span>
+        updateState: <span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {
+<span class="cstat-no" title="statement not covered" >          this.#updateNetworkConfigurations({</span>
+            state,
+            mode: 'update',
+            networkFields: fields,
+            networkConfigurationToPersist: updatedNetworkConfiguration,
+            existingNetworkConfiguration,
+          });
+        },
+      });
+    } else {
+<span class="cstat-no" title="statement not covered" >      this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        this.#updateNetworkConfigurations({</span>
+          state,
+          mode: 'update',
+          networkFields: fields,
+          networkConfigurationToPersist: updatedNetworkConfiguration,
+          existingNetworkConfiguration,
+        });
+      });
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#unregisterNetworkClientsAsNeeded({</span>
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return updatedNetworkConfiguration;</span>
+  }
+&nbsp;
+  /**
+   * Destroys and unregisters the network identified by the given chain ID, also
+   * removing the associated network configuration from state.
+   *
+   * @param chainId - The chain ID associated with an existing network.
+   * @throws if `chainId` does not refer to an existing network configuration,
+   * or if the currently selected network is being removed.
+   * @see {@link NetworkConfiguration}
+   */
+<span class="fstat-no" title="function not covered" >  removeNetwork(</span>chainId: Hex): void {
+    const existingNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.state.networkConfigurationsByChainId[chainId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (existingNetworkConfiguration === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `Cannot find network configuration for chain '${chainId}'`,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      existingNetworkConfiguration.rpcEndpoints.some(
+<span class="fstat-no" title="function not covered" >        (r</span>pcEndpoint) =&gt;
+<span class="cstat-no" title="statement not covered" >          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,</span>
+      )
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(`Cannot remove the currently selected network`);</span>
+    }
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+    const networkClientOperations =
+<span class="cstat-no" title="statement not covered" >      existingNetworkConfiguration.rpcEndpoints.map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        return {</span>
+          type: 'remove' as const,
+          rpcEndpoint,
+        };
+      });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#unregisterNetworkClientsAsNeeded({</span>
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      this.#updateNetworkConfigurations({</span>
+        state,
+        mode: 'remove',
+        existingNetworkConfiguration,
+      });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >        delete state.networksMetadata[rpcEndpoint.networkClientId];</span>
+      }
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish(</span>
+      'NetworkController:networkRemoved',
+      existingNetworkConfiguration,
+    );
+  }
+&nbsp;
+  /**
+   * Assuming that the network has been previously switched, switches to this
+   * new network.
+   *
+   * If the network has not been previously switched, this method is equivalent
+   * to {@link resetConnection}.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>rollbackToPreviousProvider(): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);</span>
+  }
+&nbsp;
+  /**
+   * Deactivates the controller, stopping any ongoing polling.
+   *
+   * In-progress requests will not be aborted.
+   */
+  // We're intentionally changing the signature of an extended method.
+  // eslint-disable-next-line @typescript-eslint/no-misused-promises
+<span class="fstat-no" title="function not covered" >  async </span>destroy(): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    await this.#blockTrackerProxy?.destroy();</span>
+  }
+&nbsp;
+  /**
+   * Merges the given backup data into controller state.
+   *
+   * @param backup - The data that has been backed up.
+   * @param backup.networkConfigurationsByChainId - Network configurations,
+   * keyed by chain ID.
+   */
+<span class="fstat-no" title="function not covered" >  loadBackup(</span>{
+    networkConfigurationsByChainId,
+  }: Pick&lt;NetworkState, 'networkConfigurationsByChainId'&gt;): void {
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      state.networkConfigurationsByChainId = {</span>
+        ...state.networkConfigurationsByChainId,
+        ...networkConfigurationsByChainId,
+      };
+    });
+  }
+&nbsp;
+  /**
+   * Searches for the default RPC endpoint configured for the given chain and
+   * returns its network client ID. This can then be passed to
+   * {@link getNetworkClientById} to retrieve the network client.
+   *
+   * @param chainId - Chain ID to search for.
+   * @returns The ID of the network client created for the chain's default RPC
+   * endpoint.
+   */
+<span class="fstat-no" title="function not covered" >  findNetworkClientIdByChainId(</span>chainId: Hex): NetworkClientId {
+    const networkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.state.networkConfigurationsByChainId[chainId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!networkConfiguration) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(`Invalid chain ID "${chainId}"`);</span>
+    }
+&nbsp;
+    const { networkClientId } =
+<span class="cstat-no" title="statement not covered" >      networkConfiguration.rpcEndpoints[</span>
+        networkConfiguration.defaultRpcEndpointIndex
+      ];
+<span class="cstat-no" title="statement not covered" >    return networkClientId;</span>
+  }
+&nbsp;
+  /**
+   * Ensure that the given fields which will be used to either add or update a
+   * network are valid.
+   *
+   * @param args - The arguments.
+   */
+  #validateNetworkFields(
+    args: {
+      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+    } &amp; (
+      | {
+          mode: 'add';
+          networkFields: AddNetworkFields;
+        }
+      | {
+          mode: 'update';
+          existingNetworkConfiguration: NetworkConfiguration;
+          networkFields: UpdateNetworkFields;
+        }
+    ),
+  ): void {
+    const { mode, networkFields, autoManagedNetworkClientRegistry } = <span class="cstat-no" title="statement not covered" >args;</span>
+    const existingNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      'existingNetworkConfiguration' in args</span>
+        ? args.existingNetworkConfiguration
+        : null;
+&nbsp;
+    const errorMessagePrefix =
+<span class="cstat-no" title="statement not covered" >      mode === 'update' ? 'Could not update network' : 'Could not add network';</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      !isStrictHexString(networkFields.chainId) ||
+      !isSafeChainId(networkFields.chainId)
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: Invalid \`chainId\` '${networkFields.chainId}' (must start with "0x" and not exceed the maximum)`,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      existingNetworkConfiguration === null ||
+      networkFields.chainId !== existingNetworkConfiguration.chainId
+    ) {
+      const existingNetworkConfigurationViaChainId =
+<span class="cstat-no" title="statement not covered" >        this.state.networkConfigurationsByChainId[networkFields.chainId];</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (existingNetworkConfigurationViaChainId !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        if (existingNetworkConfiguration === null) {</span>
+<span class="cstat-no" title="statement not covered" >          throw new Error(</span>
+            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,
+          );
+        } else {
+<span class="cstat-no" title="statement not covered" >          throw new Error(</span>
+            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,
+          );
+        }
+      }
+    }
+&nbsp;
+    const isInvalidDefaultBlockExplorerUrlIndex =
+<span class="cstat-no" title="statement not covered" >      networkFields.blockExplorerUrls.length &gt; 0</span>
+        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||
+          networkFields.blockExplorerUrls[
+            networkFields.defaultBlockExplorerUrlIndex
+          ] === undefined
+        : networkFields.defaultBlockExplorerUrlIndex !== undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInvalidDefaultBlockExplorerUrlIndex) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: \`defaultBlockExplorerUrlIndex\` must refer to an entry in \`blockExplorerUrls\``,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkFields.rpcEndpoints.length === 0) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: \`rpcEndpoints\` must be a non-empty array`,
+      );
+    }
+<span class="cstat-no" title="statement not covered" >    for (const rpcEndpointFields of networkFields.rpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (!isValidUrl(rpcEndpointFields.url)) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: An entry in \`rpcEndpoints\` has invalid URL '${rpcEndpointFields.url}'`,
+        );
+      }
+      const networkClientId =
+<span class="cstat-no" title="statement not covered" >        'networkClientId' in rpcEndpointFields</span>
+          ? rpcEndpointFields.networkClientId
+          : undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        rpcEndpointFields.type === RpcEndpointType.Custom &amp;&amp;
+        networkClientId !== undefined &amp;&amp;
+        isInfuraNetworkType(networkClientId)
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,
+        );
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        mode === 'update' &amp;&amp;
+        networkClientId !== undefined &amp;&amp;
+        rpcEndpointFields.type === RpcEndpointType.Custom &amp;&amp;
+        !Object.values(autoManagedNetworkClientRegistry).some(
+<span class="fstat-no" title="function not covered" >          (n</span>etworkClientsById) =&gt; <span class="cstat-no" title="statement not covered" >networkClientId in networkClientsById,</span>
+        )
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,
+        );
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        networkFields.rpcEndpoints.some(
+<span class="fstat-no" title="function not covered" >          (o</span>therRpcEndpointFields) =&gt;
+<span class="cstat-no" title="statement not covered" >            otherRpcEndpointFields !== rpcEndpointFields &amp;&amp;</span>
+            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),
+        )
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,
+        );
+      }
+&nbsp;
+      const networkConfigurationsForOtherChains = <span class="cstat-no" title="statement not covered" >Object.values(</span>
+        this.state.networkConfigurationsByChainId,
+      ).filter(<span class="fstat-no" title="function not covered" >(n</span>etworkConfiguration) =&gt;
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration</span>
+          ? networkConfiguration.chainId !==
+            existingNetworkConfiguration.chainId
+          : true,
+      );
+<span class="cstat-no" title="statement not covered" >      for (const networkConfiguration of networkConfigurationsForOtherChains) {</span>
+        const rpcEndpoint = <span class="cstat-no" title="statement not covered" >networkConfiguration.rpcEndpoints.find(</span>
+<span class="fstat-no" title="function not covered" >          (e</span>xistingRpcEndpoint) =&gt;
+<span class="cstat-no" title="statement not covered" >            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),</span>
+        );
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (rpcEndpoint) {</span>
+<span class="cstat-no" title="statement not covered" >          if (mode === 'update') {</span>
+<span class="cstat-no" title="statement not covered" >            throw new Error(</span>
+              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,
+            );
+          } else {
+<span class="cstat-no" title="statement not covered" >            throw new Error(</span>
+              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,
+            );
+          }
+        }
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      [...new Set(networkFields.rpcEndpoints)].length &lt;
+      networkFields.rpcEndpoints.length
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,
+      );
+    }
+&nbsp;
+    const networkClientIds = <span class="cstat-no" title="statement not covered" >networkFields.rpcEndpoints</span>
+      .map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt;
+<span class="cstat-no" title="statement not covered" >        'networkClientId' in rpcEndpoint</span>
+          ? rpcEndpoint.networkClientId
+          : undefined,
+      )
+      .filter(
+<span class="fstat-no" title="function not covered" >        (n</span>etworkClientId): networkClientId is NetworkClientId =&gt;
+<span class="cstat-no" title="statement not covered" >          networkClientId !== undefined,</span>
+      );
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if ([...new Set(networkClientIds)].length &lt; networkClientIds.length) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,
+      );
+    }
+&nbsp;
+    const infuraRpcEndpoints = <span class="cstat-no" title="statement not covered" >networkFields.rpcEndpoints.filter(</span>
+<span class="fstat-no" title="function not covered" >      (r</span>pcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =&gt;
+<span class="cstat-no" title="statement not covered" >        rpcEndpointFields.type === RpcEndpointType.Infura,</span>
+    );
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (infuraRpcEndpoints.length &gt; 1) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,
+      );
+    }
+&nbsp;
+    const soleInfuraRpcEndpoint = <span class="cstat-no" title="statement not covered" >infuraRpcEndpoints[0];</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (soleInfuraRpcEndpoint) {</span>
+      const infuraNetworkName = <span class="cstat-no" title="statement not covered" >deriveInfuraNetworkNameFromRpcEndpointUrl(</span>
+        soleInfuraRpcEndpoint.url,
+      );
+      const infuraNetworkNickname = <span class="cstat-no" title="statement not covered" >NetworkNickname[infuraNetworkName];</span>
+      const infuraChainId = <span class="cstat-no" title="statement not covered" >ChainId[infuraNetworkName];</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (networkFields.chainId !== infuraChainId) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          mode === 'add'
+            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`
+            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,
+        );
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===
+      undefined
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: \`defaultRpcEndpointIndex\` must refer to an entry in \`rpcEndpoints\``,
+      );
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Constructs a network configuration that will be persisted to state when
+   * adding or updating a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkFields - The fields used to add or update a network.
+   * @param args.networkClientOperations - Operations which were calculated for
+   * updating the network client registry but which also map back to RPC
+   * endpoints (and so can be used to save those RPC endpoints).
+   * @returns The network configuration to persist.
+   */
+  #determineNetworkConfigurationToPersist({
+    networkFields,
+    networkClientOperations,
+  }: {
+    networkFields: AddNetworkFields | UpdateNetworkFields;
+    networkClientOperations: NetworkClientOperation[];
+  }): NetworkConfiguration {
+    const rpcEndpointsToPersist = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .filter(
+<span class="fstat-no" title="function not covered" >        (</span>
+          networkClientOperation,
+        ): networkClientOperation is
+          | AddNetworkClientOperation
+          | NoopNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            networkClientOperation.type === 'add' ||
+            networkClientOperation.type === 'noop'
+          );
+        },
+      )
+      .map(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.rpcEndpoint)</span>
+      .concat(
+        networkClientOperations
+          .filter(
+<span class="fstat-no" title="function not covered" >            (</span>
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >              return networkClientOperation.type === 'replace';</span>
+            },
+          )
+          .map(
+<span class="fstat-no" title="function not covered" >            (n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.newRpcEndpoint,</span>
+          ),
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };</span>
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Creates and registers network clients using the given operations calculated
+   * as a part of adding or updating a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkFields - The fields used to add or update a network.
+   * @param args.networkClientOperations - Dictate which network clients need to
+   * be created.
+   * @param args.autoManagedNetworkClientRegistry - The network client registry
+   * to update.
+   */
+  #registerNetworkClientsAsNeeded({
+    networkFields,
+    networkClientOperations,
+    autoManagedNetworkClientRegistry,
+  }: {
+    networkFields: AddNetworkFields | UpdateNetworkFields;
+    networkClientOperations: NetworkClientOperation[];
+    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+  }): void {
+    const addedRpcEndpoints = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .filter(
+<span class="fstat-no" title="function not covered" >        (</span>
+          networkClientOperation,
+        ): networkClientOperation is AddNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >          return networkClientOperation.type === 'add';</span>
+        },
+      )
+      .map(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.rpcEndpoint)</span>
+      .concat(
+        networkClientOperations
+          .filter(
+<span class="fstat-no" title="function not covered" >            (</span>
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >              return networkClientOperation.type === 'replace';</span>
+            },
+          )
+          .map(
+<span class="fstat-no" title="function not covered" >            (n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.newRpcEndpoint,</span>
+          ),
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const addedRpcEndpoint of addedRpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {</span>
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Infura][</span>
+          addedRpcEndpoint.networkClientId
+        ] = createAutoManagedNetworkClient({
+          networkClientId: addedRpcEndpoint.networkClientId,
+          networkClientConfiguration: {
+            type: NetworkClientType.Infura,
+            chainId: networkFields.chainId,
+            network: addedRpcEndpoint.networkClientId,
+            failoverRpcUrls: addedRpcEndpoint.failoverUrls,
+            infuraProjectId: this.#infuraProjectId,
+            ticker: networkFields.nativeCurrency,
+          },
+          getRpcServiceOptions: this.#getRpcServiceOptions,
+          getBlockTrackerOptions: this.#getBlockTrackerOptions,
+          messenger: this.messenger,
+          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+          logger: this.#log,
+        });
+      } else {
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Custom][</span>
+          addedRpcEndpoint.networkClientId
+        ] = createAutoManagedNetworkClient({
+          networkClientId: addedRpcEndpoint.networkClientId,
+          networkClientConfiguration: {
+            type: NetworkClientType.Custom,
+            chainId: networkFields.chainId,
+            failoverRpcUrls: addedRpcEndpoint.failoverUrls,
+            rpcUrl: addedRpcEndpoint.url,
+            ticker: networkFields.nativeCurrency,
+          },
+          getRpcServiceOptions: this.#getRpcServiceOptions,
+          getBlockTrackerOptions: this.#getBlockTrackerOptions,
+          messenger: this.messenger,
+          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+          logger: this.#log,
+        });
+      }
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Destroys and removes network clients using the given operations calculated
+   * as a part of updating or removing a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkClientOperations - Dictate which network clients to
+   * remove.
+   * @param args.autoManagedNetworkClientRegistry - The network client registry
+   * to update.
+   */
+  #unregisterNetworkClientsAsNeeded({
+    networkClientOperations,
+    autoManagedNetworkClientRegistry,
+  }: {
+    networkClientOperations: NetworkClientOperation[];
+    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+  }): void {
+    const removedRpcEndpoints = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .filter(
+<span class="fstat-no" title="function not covered" >        (</span>
+          networkClientOperation,
+        ): networkClientOperation is RemoveNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >          return networkClientOperation.type === 'remove';</span>
+        },
+      )
+      .map(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.rpcEndpoint)</span>
+      .concat(
+        networkClientOperations
+          .filter(
+<span class="fstat-no" title="function not covered" >            (</span>
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >              return networkClientOperation.type === 'replace';</span>
+            },
+          )
+          .map(
+<span class="fstat-no" title="function not covered" >            (n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.oldRpcEndpoint,</span>
+          ),
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const rpcEndpoint of removedRpcEndpoints) {</span>
+      const networkClient = <span class="cstat-no" title="statement not covered" >this.getNetworkClientById(</span>
+        rpcEndpoint.networkClientId,
+      );
+<span class="cstat-no" title="statement not covered" >      networkClient.destroy();</span>
+<span class="cstat-no" title="statement not covered" >      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][</span>
+        rpcEndpoint.networkClientId
+      ];
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Updates `networkConfigurationsByChainId` in state depending on whether a
+   * network is being added, updated, or removed.
+   *
+   * - The existing network configuration will be removed when a network is
+   * being filed under a different chain or removed.
+   * - A network configuration will be stored when a network is being added or
+   * when a network is being updated.
+   *
+   * @param args - The arguments to this function.
+   */
+  #updateNetworkConfigurations(
+    args: { state: Draft&lt;NetworkState&gt; } &amp; (
+      | {
+          mode: 'add';
+          networkFields: AddNetworkFields;
+          networkConfigurationToPersist: NetworkConfiguration;
+        }
+      | {
+          mode: 'update';
+          networkFields: UpdateNetworkFields;
+          networkConfigurationToPersist: NetworkConfiguration;
+          existingNetworkConfiguration: NetworkConfiguration;
+        }
+      | {
+          mode: 'remove';
+          existingNetworkConfiguration: NetworkConfiguration;
+        }
+    ),
+  ): void {
+    const { state, mode } = <span class="cstat-no" title="statement not covered" >args;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      mode === 'remove' ||
+      (mode === 'update' &amp;&amp;
+        args.networkFields.chainId !==
+          args.existingNetworkConfiguration.chainId)
+    ) {
+<span class="cstat-no" title="statement not covered" >      delete state.networkConfigurationsByChainId[</span>
+        args.existingNetworkConfiguration.chainId
+      ];
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (mode === 'add' || mode === 'update') {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        !deepEqual(
+          state.networkConfigurationsByChainId[args.networkFields.chainId],
+          args.networkConfigurationToPersist,
+        )
+      ) {
+<span class="cstat-no" title="statement not covered" >        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();</span>
+      }
+<span class="cstat-no" title="statement not covered" >      state.networkConfigurationsByChainId[args.networkFields.chainId] =</span>
+        args.networkConfigurationToPersist;
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#networkConfigurationsByNetworkClientId =</span>
+      buildNetworkConfigurationsByNetworkClientId(
+        cloneDeep(state.networkConfigurationsByChainId),
+      );
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Before accessing or switching the network, the registry of network clients
+   * needs to be populated. Otherwise, `#applyNetworkSelection` and
+   * `getNetworkClientRegistry` will throw an error. This method checks to see if the
+   * population step has happened yet, and if not, makes it happen.
+   *
+   * @returns The populated network client registry.
+   */
+  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {
+<span class="cstat-no" title="statement not covered" >    return (this.#autoManagedNetworkClientRegistry ??=</span>
+      this.#createAutoManagedNetworkClientRegistry());
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Constructs the registry of network clients based on the set of default
+   * and custom networks in state.
+   *
+   * @returns The network clients keyed by ID.
+   */
+  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {
+    const chainIds = <span class="cstat-no" title="statement not covered" >knownKeysOf(this.state.networkConfigurationsByChainId);</span>
+    const networkClientsWithIds = <span class="cstat-no" title="statement not covered" >chainIds.flatMap(<span class="fstat-no" title="function not covered" >(c</span>hainId) =&gt; {</span>
+      const networkConfiguration =
+<span class="cstat-no" title="statement not covered" >        this.state.networkConfigurationsByChainId[chainId];</span>
+<span class="cstat-no" title="statement not covered" >      return networkConfiguration.rpcEndpoints.map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (rpcEndpoint.type === RpcEndpointType.Infura) {</span>
+          const infuraNetworkName = <span class="cstat-no" title="statement not covered" >deriveInfuraNetworkNameFromRpcEndpointUrl(</span>
+            rpcEndpoint.url,
+          );
+<span class="cstat-no" title="statement not covered" >          return [</span>
+            rpcEndpoint.networkClientId,
+            createAutoManagedNetworkClient({
+              networkClientId: rpcEndpoint.networkClientId,
+              networkClientConfiguration: {
+                type: NetworkClientType.Infura,
+                network: infuraNetworkName,
+                failoverRpcUrls: rpcEndpoint.failoverUrls,
+                infuraProjectId: this.#infuraProjectId,
+                chainId: networkConfiguration.chainId,
+                ticker: networkConfiguration.nativeCurrency,
+              },
+              getRpcServiceOptions: this.#getRpcServiceOptions,
+              getBlockTrackerOptions: this.#getBlockTrackerOptions,
+              messenger: this.messenger,
+              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+              logger: this.#log,
+            }),
+          ] as const;
+        }
+<span class="cstat-no" title="statement not covered" >        return [</span>
+          rpcEndpoint.networkClientId,
+          createAutoManagedNetworkClient({
+            networkClientId: rpcEndpoint.networkClientId,
+            networkClientConfiguration: {
+              type: NetworkClientType.Custom,
+              chainId: networkConfiguration.chainId,
+              failoverRpcUrls: rpcEndpoint.failoverUrls,
+              rpcUrl: rpcEndpoint.url,
+              ticker: networkConfiguration.nativeCurrency,
+            },
+            getRpcServiceOptions: this.#getRpcServiceOptions,
+            getBlockTrackerOptions: this.#getBlockTrackerOptions,
+            messenger: this.messenger,
+            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+            logger: this.#log,
+          }),
+        ] as const;
+      });
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return networkClientsWithIds.reduce(</span>
+<span class="fstat-no" title="function not covered" >      (</span>
+        obj: {
+          [NetworkClientType.Custom]: Partial&lt;AutoManagedCustomNetworkClientRegistry&gt;;
+          [NetworkClientType.Infura]: Partial&lt;AutoManagedBuiltInNetworkClientRegistry&gt;;
+        },
+        [networkClientId, networkClient],
+      ) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return {</span>
+          ...obj,
+          [networkClient.configuration.type]: {
+            ...obj[networkClient.configuration.type],
+            [networkClientId]: networkClient,
+          },
+        };
+      },
+      {
+        [NetworkClientType.Custom]: {},
+        [NetworkClientType.Infura]: {},
+      },
+    ) as AutoManagedNetworkClientRegistry;
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Updates the global provider and block tracker proxies (accessible via
+   * {@link getSelectedNetworkClient}) to point to the same ones within the
+   * given network client, thereby magically switching any consumers using these
+   * proxies to use the new network.
+   *
+   * Also refreshes the EthQuery instance accessible via the `getEthQuery`
+   * action to wrap the provider from the new network client. Note that this is
+   * not a proxy, so consumers will need to call `getEthQuery` again after the
+   * network switch.
+   *
+   * @param networkClientId - The ID of a network client that requests will be
+   * routed through (either the name of an Infura network or the ID of a custom
+   * network configuration).
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   * @throws if no network client could be found matching the given ID.
+   */
+  #applyNetworkSelection(
+    networkClientId: string,
+    {
+      updateState,
+    }: {
+      updateState?: (state: Draft&lt;NetworkState&gt;) =&gt; void;
+    } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): void {
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+    let autoManagedNetworkClient:
+      | AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;
+      | AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (isInfuraNetworkType(networkClientId)) {</span>
+      const possibleAutoManagedNetworkClient =
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Infura][</span>
+          networkClientId
+        ];
+&nbsp;
+      // This is impossible to reach
+      /* istanbul ignore if */
+<span class="cstat-no" title="statement not covered" >      if (!possibleAutoManagedNetworkClient) {</span>
+        throw new Error(
+          `No Infura network client found with ID '${networkClientId}'`,
+        );
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      autoManagedNetworkClient = possibleAutoManagedNetworkClient;</span>
+    } else {
+      const possibleAutoManagedNetworkClient =
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Custom][</span>
+          networkClientId
+        ];
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (!possibleAutoManagedNetworkClient) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(`No network client found with ID '${networkClientId}'`);</span>
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      autoManagedNetworkClient = possibleAutoManagedNetworkClient;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#autoManagedNetworkClient = autoManagedNetworkClient;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      state.selectedNetworkClientId = networkClientId;</span>
+<span class="cstat-no" title="statement not covered" >      state.networksMetadata[networkClientId] ??= {</span>
+        status: NetworkStatus.Unknown,
+        EIPS: {},
+      };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      updateState?.(state);</span>
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (this.#providerProxy) {</span>
+<span class="cstat-no" title="statement not covered" >      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);</span>
+    } else {
+<span class="cstat-no" title="statement not covered" >      this.#providerProxy = createSwappableProxy(</span>
+        this.#autoManagedNetworkClient.provider,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (this.#blockTrackerProxy) {</span>
+<span class="cstat-no" title="statement not covered" >      this.#blockTrackerProxy.setTarget(</span>
+        this.#autoManagedNetworkClient.blockTracker,
+      );
+    } else {
+<span class="cstat-no" title="statement not covered" >      this.#blockTrackerProxy = createEventEmitterProxy(</span>
+        this.#autoManagedNetworkClient.blockTracker,
+        {
+          eventFilter: 'skipInternal',
+        },
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#ethQuery = new EthQuery(this.#providerProxy);</span>
+  }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/constants.ts.html b/coverage/lcov-report/src/constants.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..0cd47875d2e8395c2d47e395ca0c4c0fb5991214
--- /dev/null
+++ b/coverage/lcov-report/src/constants.ts.html
@@ -0,0 +1,214 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/constants.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> constants.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/8</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/2</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/1</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/8</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
+ * Represents the availability status of an RPC endpoint. (Regrettably, the
+ * name of this type is a misnomer.)
+ *
+ * The availability status is set both automatically (as requests are made) and
+ * manually (when `lookupNetwork` is called).
+ */
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export enum N</span>etworkStatus {</span>
+  /**
+   * Either the availability status of the RPC endpoint has not been determined,
+   * or request that `lookupNetwork` performed returned an unknown error.
+   */
+<span class="cstat-no" title="statement not covered" >  Unknown = 'unknown',</span>
+  /**
+   * The RPC endpoint is consistently returning successful (2xx) responses.
+   */
+<span class="cstat-no" title="statement not covered" >  Available = 'available',</span>
+  /**
+   * Either the last request to the RPC endpoint was either too slow, or the
+   * endpoint is consistently returning errors and the number of retries has
+   * been reached.
+   */
+<span class="cstat-no" title="statement not covered" >  Degraded = 'degraded',</span>
+  /**
+   * The RPC endpoint is consistently returning enough 5xx errors that requests
+   * have been paused.
+   */
+<span class="cstat-no" title="statement not covered" >  Unavailable = 'unavailable',</span>
+  /**
+   * The RPC endpoint is inaccessible for the user based on their location. This
+   * status only applies to Infura networks.
+   */
+<span class="cstat-no" title="statement not covered" >  Blocked = 'blocked',</span>
+}
+&nbsp;
+export const <span class="cstat-no" title="statement not covered" >INFURA_BLOCKED_KEY = 'countryBlocked';</span>
+&nbsp;
+/**
+ * A set of deprecated network ChainId.
+ * The network controller will exclude those the networks begin as default network,
+ * without the need to remove the network from constant list of controller-utils.
+ */
+export const <span class="cstat-no" title="statement not covered" >DEPRECATED_NETWORKS = new Set&lt;string&gt;(['0xe704', '0x5']);</span>
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/create-auto-managed-network-client.ts.html b/coverage/lcov-report/src/create-auto-managed-network-client.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..dbf71b98788a2ee09fd9b14c1f7299a0cc3c484e
--- /dev/null
+++ b/coverage/lcov-report/src/create-auto-managed-network-client.ts.html
@@ -0,0 +1,856 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/create-auto-managed-network-client.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> create-auto-managed-network-client.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/52</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/16</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/12</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/52</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+import { Json } from '@metamask/utils';
+import type { Logger } from 'loglevel';
+&nbsp;
+import type { NetworkClient } from './create-network-client';
+<span class="cstat-no" title="statement not covered" >import { createNetworkClient } from './create-network-client';</span>
+import type {
+  NetworkClientId,
+  NetworkControllerMessenger,
+} from './NetworkController';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+import type {
+  BlockTracker,
+  NetworkClientConfiguration,
+  Provider,
+} from './types';
+&nbsp;
+/**
+ * The name of the method on both the provider and block tracker proxy which can
+ * be used to get the underlying provider or block tracker from the network
+ * client, when it is initialized.
+ */
+const REFLECTIVE_PROPERTY_NAME = <span class="cstat-no" title="statement not covered" >'__target__';</span>
+&nbsp;
+/**
+ * Represents a proxy object which wraps a target object. As a proxy, it allows
+ * for accessing and setting all of the properties that the target object
+ * supports, but also supports an extra propertyName (`__target__`) to access
+ * the target itself.
+ *
+ * @template Type - The type of the target object. It is assumed that this type
+ * will be constant even when the target is swapped.
+ */
+export type ProxyWithAccessibleTarget&lt;TargetType&gt; = TargetType &amp; {
+  [REFLECTIVE_PROPERTY_NAME]: TargetType;
+};
+&nbsp;
+/**
+ * An object that provides the same interface as a network client but where the
+ * network client is not initialized until either the provider or block tracker
+ * is first accessed.
+ */
+export type AutoManagedNetworkClient&lt;
+  Configuration extends NetworkClientConfiguration,
+&gt; = {
+  configuration: Configuration;
+  provider: ProxyWithAccessibleTarget&lt;Provider&gt;;
+  blockTracker: ProxyWithAccessibleTarget&lt;BlockTracker&gt;;
+  destroy: () =&gt; void;
+  enableRpcFailover: () =&gt; void;
+  disableRpcFailover: () =&gt; void;
+};
+&nbsp;
+/**
+ * By default, the provider and block provider proxies will point to nothing.
+ * This is impossible when using the Proxy API, as the target object has to be
+ * something, so this object represents that "something".
+ */
+const UNINITIALIZED_TARGET = <span class="cstat-no" title="statement not covered" >{ __UNINITIALIZED__: true };</span>
+&nbsp;
+/**
+ * This function creates two proxies, one that wraps a provider and another that
+ * wraps a block tracker. These proxies are unique in that both will be "empty"
+ * at first; that is, neither will point to a functional provider or block
+ * tracker. Instead, as soon as a method or event is accessed on either object
+ * that requires a network request to function, a network client is created on
+ * the fly and the method or event in question is then forwarded to whichever
+ * part of the network client is serving as the receiver. The network client is
+ * then cached for subsequent usages.
+ *
+ * @param args - The arguments.
+ * @param args.networkClientId - The ID that will be assigned to the new network
+ * client in the registry.
+ * @param args.networkClientConfiguration - The configuration object that will be
+ * used to instantiate the network client when it is needed.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.getBlockTrackerOptions - Factory for constructing block tracker
+ * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The auto-managed network client.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >c</span>reateAutoManagedNetworkClient&lt;</span>
+  Configuration extends NetworkClientConfiguration,
+&gt;({
+  networkClientId,
+  networkClientConfiguration,
+  getRpcServiceOptions,
+  getBlockTrackerOptions = <span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >(): Omit&lt;</span></span>
+    PollingBlockTrackerOptions,
+    'provider'
+  &gt; =&gt; (<span class="cstat-no" title="statement not covered" >{})</span>,
+  messenger,
+  isRpcFailoverEnabled: givenIsRpcFailoverEnabled,
+  logger,
+}: {
+  networkClientId: NetworkClientId;
+  networkClientConfiguration: Configuration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  getBlockTrackerOptions?: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): AutoManagedNetworkClient&lt;Configuration&gt; {
+  let isRpcFailoverEnabled = <span class="cstat-no" title="statement not covered" >givenIsRpcFailoverEnabled;</span>
+  let networkClient: NetworkClient | undefined;
+&nbsp;
+  const ensureNetworkClientCreated = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): NetworkClient =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    networkClient ??= createNetworkClient({</span>
+      id: networkClientId,
+      configuration: networkClientConfiguration,
+      getRpcServiceOptions,
+      getBlockTrackerOptions,
+      messenger,
+      isRpcFailoverEnabled,
+      logger,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkClient === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        "It looks like `createNetworkClient` didn't return anything. Perhaps it's being mocked?",
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return networkClient;</span>
+  };
+&nbsp;
+  const providerProxy = <span class="cstat-no" title="statement not covered" >new Proxy(UNINITIALIZED_TARGET, {</span>
+<span class="fstat-no" title="function not covered" >    get(</span>
+      _target: unknown,
+      propertyName: PropertyKey,
+      receiver: unknown,
+    ):
+      | Provider
+      | ((this: unknown, ...args: unknown[]) =&gt; Promise&lt;Json&gt; | undefined)
+      | undefined {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >        return networkClient?.provider;</span>
+      }
+&nbsp;
+      const { provider } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName in provider) {</span>
+        // Typecast: We know that `[propertyName]` is a propertyName on
+        // `provider`.
+        const value = <span class="cstat-no" title="statement not covered" >provider[propertyName as keyof typeof provider];</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof value === 'function') {</span>
+          // Ensure that the method on the provider is called with `this` as
+          // the target, *not* the proxy (which happens by default) â€”
+          // this allows private properties to be accessed
+<span class="cstat-no" title="statement not covered" >          return <span class="fstat-no" title="function not covered" >function (this: unknown, .</span>..args: unknown[]): Promise&lt;Json&gt; {</span>
+            // @ts-expect-error We don't care that `this` may not be compatible
+            // with the signature of the method being called, as technically
+            // it can be anything.
+<span class="cstat-no" title="statement not covered" >            return value.apply(this === receiver ? provider : this, args);</span>
+          };
+        }
+<span class="cstat-no" title="statement not covered" >        return value;</span>
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      return undefined;</span>
+    },
+&nbsp;
+    // TODO: Replace `any` with type
+    // eslint-disable-next-line @typescript-eslint/no-explicit-any
+<span class="fstat-no" title="function not covered" >    has(</span>_target: any, propertyName: PropertyKey): boolean {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >        return true;</span>
+      }
+      const { provider } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+<span class="cstat-no" title="statement not covered" >      return propertyName in provider;</span>
+    },
+  });
+&nbsp;
+  const blockTrackerProxy: ProxyWithAccessibleTarget&lt;BlockTracker&gt; = <span class="cstat-no" title="statement not covered" >new Proxy(</span>
+    UNINITIALIZED_TARGET,
+    {
+<span class="fstat-no" title="function not covered" >      get(</span>
+        _target: unknown,
+        propertyName: PropertyKey,
+        receiver: unknown,
+      ):
+        | BlockTracker
+        | ((this: unknown, ...args: unknown[]) =&gt; unknown)
+        | undefined {
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >          return networkClient?.blockTracker;</span>
+        }
+&nbsp;
+        const { blockTracker } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName in blockTracker) {</span>
+          // Typecast: We know that `[propertyName]` is a propertyName on
+          // `provider`.
+          const value = <span class="cstat-no" title="statement not covered" >blockTracker[propertyName as keyof typeof blockTracker];</span>
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof value === 'function') {</span>
+            // Ensure that the method on the provider is called with `this` as
+            // the target, *not* the proxy (which happens by default) â€”
+            // this allows private properties to be accessed
+<span class="cstat-no" title="statement not covered" >            return <span class="fstat-no" title="function not covered" >function (this: unknown, .</span>..args: unknown[]) {</span>
+              // @ts-expect-error We don't care that `this` may not be
+              // compatible with the signature of the method being called, as
+              // technically it can be anything.
+<span class="cstat-no" title="statement not covered" >              return value.apply(this === receiver ? blockTracker : this, args);</span>
+            };
+          }
+<span class="cstat-no" title="statement not covered" >          return value;</span>
+        }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        return undefined;</span>
+      },
+&nbsp;
+      // TODO: Replace `any` with type
+      // eslint-disable-next-line @typescript-eslint/no-explicit-any
+<span class="fstat-no" title="function not covered" >      has(</span>_target: any, propertyName: PropertyKey): boolean {
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >          return true;</span>
+        }
+        const { blockTracker } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+<span class="cstat-no" title="statement not covered" >        return propertyName in blockTracker;</span>
+      },
+    },
+  );
+&nbsp;
+  const destroy = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    networkClient?.destroy();</span>
+  };
+&nbsp;
+  const enableRpcFailover = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    isRpcFailoverEnabled = true;</span>
+<span class="cstat-no" title="statement not covered" >    destroy();</span>
+<span class="cstat-no" title="statement not covered" >    networkClient = undefined;</span>
+  };
+&nbsp;
+  const disableRpcFailover = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    isRpcFailoverEnabled = false;</span>
+<span class="cstat-no" title="statement not covered" >    destroy();</span>
+<span class="cstat-no" title="statement not covered" >    networkClient = undefined;</span>
+  };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return {</span>
+    configuration: networkClientConfiguration,
+    provider: providerProxy,
+    blockTracker: blockTrackerProxy,
+    destroy,
+    enableRpcFailover,
+    disableRpcFailover,
+  };
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/create-network-client.ts.html b/coverage/lcov-report/src/create-network-client.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..125a0affbd0d49a20995a110e88ef47697af54be
--- /dev/null
+++ b/coverage/lcov-report/src/create-network-client.ts.html
@@ -0,0 +1,1648 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/create-network-client.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> create-network-client.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/74</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/23</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/20</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/73</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a>
+<a name='L483'></a><a href='#L483'>483</a>
+<a name='L484'></a><a href='#L484'>484</a>
+<a name='L485'></a><a href='#L485'>485</a>
+<a name='L486'></a><a href='#L486'>486</a>
+<a name='L487'></a><a href='#L487'>487</a>
+<a name='L488'></a><a href='#L488'>488</a>
+<a name='L489'></a><a href='#L489'>489</a>
+<a name='L490'></a><a href='#L490'>490</a>
+<a name='L491'></a><a href='#L491'>491</a>
+<a name='L492'></a><a href='#L492'>492</a>
+<a name='L493'></a><a href='#L493'>493</a>
+<a name='L494'></a><a href='#L494'>494</a>
+<a name='L495'></a><a href='#L495'>495</a>
+<a name='L496'></a><a href='#L496'>496</a>
+<a name='L497'></a><a href='#L497'>497</a>
+<a name='L498'></a><a href='#L498'>498</a>
+<a name='L499'></a><a href='#L499'>499</a>
+<a name='L500'></a><a href='#L500'>500</a>
+<a name='L501'></a><a href='#L501'>501</a>
+<a name='L502'></a><a href='#L502'>502</a>
+<a name='L503'></a><a href='#L503'>503</a>
+<a name='L504'></a><a href='#L504'>504</a>
+<a name='L505'></a><a href='#L505'>505</a>
+<a name='L506'></a><a href='#L506'>506</a>
+<a name='L507'></a><a href='#L507'>507</a>
+<a name='L508'></a><a href='#L508'>508</a>
+<a name='L509'></a><a href='#L509'>509</a>
+<a name='L510'></a><a href='#L510'>510</a>
+<a name='L511'></a><a href='#L511'>511</a>
+<a name='L512'></a><a href='#L512'>512</a>
+<a name='L513'></a><a href='#L513'>513</a>
+<a name='L514'></a><a href='#L514'>514</a>
+<a name='L515'></a><a href='#L515'>515</a>
+<a name='L516'></a><a href='#L516'>516</a>
+<a name='L517'></a><a href='#L517'>517</a>
+<a name='L518'></a><a href='#L518'>518</a>
+<a name='L519'></a><a href='#L519'>519</a>
+<a name='L520'></a><a href='#L520'>520</a>
+<a name='L521'></a><a href='#L521'>521</a>
+<a name='L522'></a><a href='#L522'>522</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type {
+  CockatielFailureReason,
+  InfuraNetworkType,
+} from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import { ChainId } from '@metamask/controller-utils';</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >import { createThrottledFetchForChainId } from './throttled-fetch';</span>
+&nbsp;
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+<span class="cstat-no" title="statement not covered" >import { PollingBlockTracker } from '@metamask/eth-block-tracker';</span>
+<span class="cstat-no" title="statement not covered" >import { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';</span>
+<span class="cstat-no" title="statement not covered" >import {</span>
+  createBlockCacheMiddleware,
+  createBlockRefMiddleware,
+  createBlockRefRewriteMiddleware,
+  createBlockTrackerInspectorMiddleware,
+  createInflightCacheMiddleware,
+  createFetchMiddleware,
+  createRetryOnEmptyMiddleware,
+} from '@metamask/eth-json-rpc-middleware';
+<span class="cstat-no" title="statement not covered" >import { InternalProvider } from '@metamask/eth-json-rpc-provider';</span>
+<span class="cstat-no" title="statement not covered" >import { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';</span>
+<span class="cstat-no" title="statement not covered" >import { asV2Middleware } from '@metamask/json-rpc-engine';</span>
+<span class="cstat-no" title="statement not covered" >import {</span>
+  createScaffoldMiddleware,
+  JsonRpcEngineV2,
+} from '@metamask/json-rpc-engine/v2';
+import type {
+  JsonRpcMiddleware,
+  MiddlewareContext,
+} from '@metamask/json-rpc-engine/v2';
+import type { Hex, Json, JsonRpcRequest } from '@metamask/utils';
+import type { Logger } from 'loglevel';
+&nbsp;
+import type {
+  NetworkClientId,
+  NetworkControllerMessenger,
+} from './NetworkController';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+<span class="cstat-no" title="statement not covered" >import { RpcServiceChain } from './rpc-service/rpc-service-chain';</span>
+import type {
+  BlockTracker,
+  NetworkClientConfiguration,
+  Provider,
+} from './types';
+<span class="cstat-no" title="statement not covered" >import { NetworkClientType } from './types';</span>
+&nbsp;
+const SECOND = <span class="cstat-no" title="statement not covered" >1000;</span>
+&nbsp;
+/**
+ * The pair of provider / block tracker that can be used to interface with the
+ * network and respond to new activity.
+ */
+export type NetworkClient = {
+  configuration: NetworkClientConfiguration;
+  provider: Provider;
+  blockTracker: BlockTracker;
+  destroy: () =&gt; void;
+};
+&nbsp;
+type RpcApiMiddleware = JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext&lt;{ origin: string }&gt;
+&gt;;
+&nbsp;
+/**
+ * Create a JSON RPC network client for a specific network.
+ *
+ * @param args - The arguments.
+ * @param args.id - The ID that will be assigned to the new network client in
+ * the registry.
+ * @param args.configuration - The network configuration.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.getBlockTrackerOptions - Factory for constructing block tracker
+ * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable. This effectively
+ * causes the `failoverRpcUrls` property of the network client configuration
+ * to be honored or ignored.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The network client.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >c</span>reateNetworkClient(</span>{
+  id,
+  configuration,
+  getRpcServiceOptions,
+  getBlockTrackerOptions,
+  messenger,
+  isRpcFailoverEnabled,
+  logger,
+}: {
+  id: NetworkClientId;
+  configuration: NetworkClientConfiguration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  getBlockTrackerOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): NetworkClient {
+  const primaryEndpointUrl =
+<span class="cstat-no" title="statement not covered" >    configuration.type === NetworkClientType.Infura</span>
+      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`
+      : configuration.rpcUrl;
+  const rpcServiceChain = <span class="cstat-no" title="statement not covered" >createRpcServiceChain({</span>
+    id,
+    primaryEndpointUrl,
+    configuration,
+    getRpcServiceOptions,
+    messenger,
+    isRpcFailoverEnabled,
+    logger,
+  });
+&nbsp;
+  let rpcApiMiddleware: RpcApiMiddleware;
+<span class="cstat-no" title="statement not covered" >  if (configuration.type === NetworkClientType.Infura) {</span>
+<span class="cstat-no" title="statement not covered" >    rpcApiMiddleware = asV2Middleware(</span>
+      createInfuraMiddleware({
+        rpcService: rpcServiceChain,
+        options: {
+          source: 'metamask',
+        },
+      }),
+    );
+  } else {
+<span class="cstat-no" title="statement not covered" >    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });</span>
+  }
+&nbsp;
+  const rpcProvider = <span class="cstat-no" title="statement not covered" >providerFromMiddlewareV2(rpcApiMiddleware);</span>
+&nbsp;
+  const blockTracker = <span class="cstat-no" title="statement not covered" >createBlockTracker({</span>
+    networkClientType: configuration.type,
+    endpointUrl: primaryEndpointUrl,
+    getOptions: getBlockTrackerOptions,
+    provider: rpcProvider,
+  });
+&nbsp;
+  const networkMiddleware =
+<span class="cstat-no" title="statement not covered" >    configuration.type === NetworkClientType.Infura</span>
+      ? createInfuraNetworkMiddleware({
+          blockTracker,
+          network: configuration.network,
+          rpcProvider,
+          rpcApiMiddleware,
+        })
+      : createCustomNetworkMiddleware({
+          blockTracker,
+          chainId: configuration.chainId,
+          rpcApiMiddleware,
+        });
+&nbsp;
+  const provider: Provider = <span class="cstat-no" title="statement not covered" >new InternalProvider({</span>
+    engine: JsonRpcEngineV2.create({
+      middleware: [networkMiddleware],
+    }),
+  });
+&nbsp;
+  const destroy = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+    // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+    // eslint-disable-next-line @typescript-eslint/no-floating-promises
+<span class="cstat-no" title="statement not covered" >    blockTracker.destroy();</span>
+  };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return { configuration, provider, blockTracker, destroy };</span>
+}
+&nbsp;
+/**
+ * Creates an RPC service chain, which represents the primary endpoint URL for
+ * the network as well as its failover URLs.
+ *
+ * @param args - The arguments.
+ * @param args.id - The ID that will be assigned to the new network client in
+ * the registry.
+ * @param args.primaryEndpointUrl - The primary endpoint URL.
+ * @param args.configuration - The network configuration.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable. This effectively
+ * causes the `failoverRpcUrls` property of the network client configuration
+ * to be honored or ignored.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The RPC service chain.
+ */
+function <span class="fstat-no" title="function not covered" >createRpcServiceChain(</span>{
+  id,
+  primaryEndpointUrl,
+  configuration,
+  getRpcServiceOptions,
+  messenger,
+  isRpcFailoverEnabled,
+  logger,
+}: {
+  id: NetworkClientId;
+  primaryEndpointUrl: string;
+  configuration: NetworkClientConfiguration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): RpcServiceChain {
+  const availableEndpointUrls: [string, ...string[]] = <span class="cstat-no" title="statement not covered" >isRpcFailoverEnabled</span>
+    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]
+    : [primaryEndpointUrl];
+  const rpcServiceConfigurations = <span class="cstat-no" title="statement not covered" >availableEndpointUrls.map(<span class="fstat-no" title="function not covered" >(e</span>ndpointUrl) =&gt; {</span>
+    const options = <span class="cstat-no" title="statement not covered" >getRpcServiceOptions(endpointUrl);</span>
+&nbsp;
+    // Apply network throttling based on chain ID if configured
+    const throttledFetch = <span class="cstat-no" title="statement not covered" >createThrottledFetchForChainId(</span>
+      endpointUrl,
+      configuration.chainId,
+      options.fetch,
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+      ...options,
+      fetch: throttledFetch,
+      endpointUrl,
+      logger,
+    };
+  });
+&nbsp;
+  /**
+   * Extracts the error from Cockatiel's `FailureReason` type received in
+   * circuit breaker event handlers.
+   *
+   * The `FailureReason` object can have two possible shapes:
+   * - `{ error: Error }` - When the RPC service throws an error (the common
+   * case for RPC failures).
+   * - `{ value: T }` - When the RPC service returns a value that the retry
+   * filter policy considers a failure.
+   *
+   * @param value - The event data object from the circuit breaker event
+   * listener (after destructuring known properties like `endpointUrl`). This
+   * represents Cockatiel's `FailureReason` type.
+   * @returns The error or failure value, or `undefined` if neither property
+   * exists (which shouldn't happen in practice unless the circuit breaker is
+   * manually isolated).
+   */
+  const getError = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
+    value: CockatielFailureReason&lt;unknown&gt; | Record&lt;never, never&gt;,
+  ): Error | unknown | undefined =&gt; {
+<span class="cstat-no" title="statement not covered" >    if ('error' in value) {</span>
+<span class="cstat-no" title="statement not covered" >      return value.error;</span>
+    } else <span class="cstat-no" title="statement not covered" ><span class="missing-if-branch" title="if path not taken" >I</span>if ('value' in value) {</span>
+<span class="cstat-no" title="statement not covered" >      return value.value;</span>
+    }
+<span class="cstat-no" title="statement not covered" >    return undefined;</span>
+  };
+&nbsp;
+  const rpcServiceChain = <span class="cstat-no" title="statement not covered" >new RpcServiceChain([</span>
+    rpcServiceConfigurations[0],
+    ...rpcServiceConfigurations.slice(1),
+  ]);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onBreak(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+    const error = <span class="cstat-no" title="statement not covered" >getError(data);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (error === undefined) {</span>
+      // This error shouldn't happen in practice because we never call `.isolate`
+      // on the circuit breaker policy, but we need to appease TypeScript.
+<span class="cstat-no" title="statement not covered" >      throw new Error('Could not make request to endpoint.');</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {</span>
+      chainId: configuration.chainId,
+      networkClientId: id,
+      error,
+    });
+  });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onServiceBreak(</span>
+<span class="fstat-no" title="function not covered" >    ({</span>
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+      ...rest
+    }) =&gt; {
+      const error = <span class="cstat-no" title="statement not covered" >getError(rest);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (error === undefined) {</span>
+        // This error shouldn't happen in practice because we never call `.isolate`
+        // on the circuit breaker policy, but we need to appease TypeScript.
+<span class="cstat-no" title="statement not covered" >        throw new Error('Could not make request to endpoint.');</span>
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      messenger.publish('NetworkController:rpcEndpointUnavailable', {</span>
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        error,
+      });
+    },
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+    const error = <span class="cstat-no" title="statement not covered" >getError(data);</span>
+<span class="cstat-no" title="statement not covered" >    messenger.publish('NetworkController:rpcEndpointChainDegraded', {</span>
+      chainId: configuration.chainId,
+      networkClientId: id,
+      error,
+    });
+  });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onServiceDegraded(</span>
+<span class="fstat-no" title="function not covered" >    ({</span>
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+      ...rest
+    }) =&gt; {
+      const error = <span class="cstat-no" title="statement not covered" >getError(rest);</span>
+<span class="cstat-no" title="statement not covered" >      messenger.publish('NetworkController:rpcEndpointDegraded', {</span>
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        error,
+      });
+    },
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onAvailable(<span class="fstat-no" title="function not covered" >() =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    messenger.publish('NetworkController:rpcEndpointChainAvailable', {</span>
+      chainId: configuration.chainId,
+      networkClientId: id,
+    });
+  });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onServiceRetry(</span>
+<span class="fstat-no" title="function not covered" >    ({</span>
+      attempt,
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+    }) =&gt; {
+<span class="cstat-no" title="statement not covered" >      messenger.publish('NetworkController:rpcEndpointRetried', {</span>
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        attempt,
+      });
+    },
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return rpcServiceChain;</span>
+}
+&nbsp;
+/**
+ * Create the block tracker for the network.
+ *
+ * @param args - The arguments.
+ * @param args.networkClientType - The type of the network client ("infura" or
+ * "custom").
+ * @param args.endpointUrl - The URL of the endpoint.
+ * @param args.getOptions - Factory for the block tracker options.
+ * @param args.provider - The EIP-1193 provider for the network's JSON-RPC
+ * middleware stack.
+ * @returns The created block tracker.
+ */
+function <span class="fstat-no" title="function not covered" >createBlockTracker(</span>{
+  networkClientType,
+  endpointUrl,
+  getOptions,
+  provider,
+}: {
+  networkClientType: NetworkClientType;
+  endpointUrl: string;
+  getOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  provider: InternalProvider;
+}): PollingBlockTracker {
+  const testOptions =
+    // Needed for testing.
+    // eslint-disable-next-line no-restricted-globals
+<span class="cstat-no" title="statement not covered" >    process.env.IN_TEST &amp;&amp; networkClientType === NetworkClientType.Custom</span>
+      ? { pollingInterval: SECOND }
+      : {};
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return new PollingBlockTracker({</span>
+    ...testOptions,
+    ...getOptions(endpointUrl),
+    provider,
+  });
+}
+&nbsp;
+/**
+ * Create middleware for infura.
+ *
+ * @param args - The arguments.
+ * @param args.blockTracker - The block tracker to use.
+ * @param args.network - The Infura network to use.
+ * @param args.rpcProvider - The RPC provider to use.
+ * @param args.rpcApiMiddleware - Additional middleware.
+ * @returns The collection of middleware that makes up the Infura client.
+ */
+function <span class="fstat-no" title="function not covered" >createInfuraNetworkMiddleware(</span>{
+  blockTracker,
+  network,
+  rpcProvider,
+  rpcApiMiddleware,
+}: {
+  blockTracker: PollingBlockTracker;
+  network: InfuraNetworkType;
+  rpcProvider: InternalProvider;
+  rpcApiMiddleware: RpcApiMiddleware;
+}): JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext&lt;{ origin: string; skipCache: boolean }&gt;
+&gt; {
+<span class="cstat-no" title="statement not covered" >  return JsonRpcEngineV2.create({</span>
+    middleware: [
+      createNetworkAndChainIdMiddleware({ network }),
+      createBlockCacheMiddleware({ blockTracker }),
+      createInflightCacheMiddleware(),
+      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),
+      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),
+      createBlockTrackerInspectorMiddleware({ blockTracker }),
+      rpcApiMiddleware,
+    ],
+  }).asMiddleware();
+}
+&nbsp;
+/**
+ * Creates static method middleware.
+ *
+ * @param args - The Arguments.
+ * @param args.network - The Infura network to use.
+ * @returns The middleware that implements the eth_chainId method.
+ */
+function <span class="fstat-no" title="function not covered" >createNetworkAndChainIdMiddleware(</span>{
+  network,
+}: {
+  network: InfuraNetworkType;
+}): JsonRpcMiddleware&lt;JsonRpcRequest&gt; {
+<span class="cstat-no" title="statement not covered" >  return createScaffoldMiddleware({</span>
+    eth_chainId: ChainId[network],
+  });
+}
+&nbsp;
+const createChainIdMiddleware = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
+  chainId: Hex,
+): JsonRpcMiddleware&lt;JsonRpcRequest, Json&gt; =&gt; {
+<span class="cstat-no" title="statement not covered" >  return <span class="fstat-no" title="function not covered" >({</span> request, next }) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (request.method === 'eth_chainId') {</span>
+<span class="cstat-no" title="statement not covered" >      return chainId;</span>
+    }
+<span class="cstat-no" title="statement not covered" >    return next();</span>
+  };
+};
+&nbsp;
+/**
+ * Creates custom middleware.
+ *
+ * @param args - The arguments.
+ * @param args.blockTracker - The block tracker to use.
+ * @param args.chainId - The chain id to use.
+ * @param args.rpcApiMiddleware - Additional middleware.
+ * @returns The collection of middleware that makes up the Infura client.
+ */
+function <span class="fstat-no" title="function not covered" >createCustomNetworkMiddleware(</span>{
+  blockTracker,
+  chainId,
+  rpcApiMiddleware,
+}: {
+  blockTracker: PollingBlockTracker;
+  chainId: Hex;
+  rpcApiMiddleware: RpcApiMiddleware;
+}): JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext&lt;{ origin: string; skipCache: boolean }&gt;
+&gt; {
+  // Needed for testing.
+  // eslint-disable-next-line no-restricted-globals
+  const testMiddlewares = <span class="cstat-no" title="statement not covered" >process.env.IN_TEST</span>
+    ? [createEstimateGasDelayTestMiddleware()]
+    : [];
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return JsonRpcEngineV2.create({</span>
+    middleware: [
+      ...testMiddlewares,
+      createChainIdMiddleware(chainId),
+      createBlockRefRewriteMiddleware({ blockTracker }),
+      createBlockCacheMiddleware({ blockTracker }),
+      createInflightCacheMiddleware(),
+      createBlockTrackerInspectorMiddleware({ blockTracker }),
+      rpcApiMiddleware,
+    ],
+  }).asMiddleware();
+}
+&nbsp;
+/**
+ * For use in tests only.
+ * Adds a delay to `eth_estimateGas` calls.
+ *
+ * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.
+ */
+function <span class="fstat-no" title="function not covered" >createEstimateGasDelayTestMiddleware(</span>): JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json
+&gt; {
+<span class="cstat-no" title="statement not covered" >  return <span class="fstat-no" title="function not covered" >async </span>({ request, next }) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (request.method === 'eth_estimateGas') {</span>
+<span class="cstat-no" title="statement not covered" >      await new Promise(<span class="fstat-no" title="function not covered" >(r</span>esolve) =&gt; <span class="cstat-no" title="statement not covered" >setTimeout(resolve, SECOND * 2))</span>;</span>
+    }
+<span class="cstat-no" title="statement not covered" >    return next();</span>
+  };
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/index.html b/coverage/lcov-report/src/index.html
new file mode 100644
index 0000000000000000000000000000000000000000..a4748b12e7f967785b305237a0f6c5db7f312129
--- /dev/null
+++ b/coverage/lcov-report/src/index.html
@@ -0,0 +1,206 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> src</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">2.27% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>15/658</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.85% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>5/269</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">2.58% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/155</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">2.13% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>14/656</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file low" data-value="NetworkController.ts"><a href="NetworkController.ts.html">NetworkController.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="496" class="abs low">0/496</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="219" class="abs low">0/219</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="114" class="abs low">0/114</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="496" class="abs low">0/496</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="constants.ts"><a href="constants.ts.html">constants.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="8" class="abs low">0/8</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="2" class="abs low">0/2</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="1" class="abs low">0/1</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="8" class="abs low">0/8</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="create-auto-managed-network-client.ts"><a href="create-auto-managed-network-client.ts.html">create-auto-managed-network-client.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="52" class="abs low">0/52</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="16" class="abs low">0/16</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="12" class="abs low">0/12</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="52" class="abs low">0/52</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="create-network-client.ts"><a href="create-network-client.ts.html">create-network-client.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="74" class="abs low">0/74</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="23" class="abs low">0/23</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="20" class="abs low">0/20</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="73" class="abs low">0/73</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="logger.ts"><a href="logger.ts.html">logger.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="0" class="abs high">0/0</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="1" class="abs low">0/1</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	</tr>
+
+<tr>
+	<td class="file medium" data-value="throttled-fetch.ts"><a href="throttled-fetch.ts.html">throttled-fetch.ts</a></td>
+	<td data-value="68.18" class="pic medium">
+	<div class="chart"><div class="cover-fill" style="width: 68%"></div><div class="cover-empty" style="width: 32%"></div></div>
+	</td>
+	<td data-value="68.18" class="pct medium">68.18%</td>
+	<td data-value="22" class="abs medium">15/22</td>
+	<td data-value="71.42" class="pct medium">71.42%</td>
+	<td data-value="7" class="abs medium">5/7</td>
+	<td data-value="66.66" class="pct medium">66.66%</td>
+	<td data-value="6" class="abs medium">4/6</td>
+	<td data-value="66.66" class="pct medium">66.66%</td>
+	<td data-value="21" class="abs medium">14/21</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="types.ts"><a href="types.ts.html">types.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="2" class="abs low">0/2</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="1" class="abs low">0/1</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/logger.ts.html b/coverage/lcov-report/src/logger.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..3bc05afede6dc12c609a91c8fb524adc9e7ee63f
--- /dev/null
+++ b/coverage/lcov-report/src/logger.ts.html
@@ -0,0 +1,100 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/logger.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> logger.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/0</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/1</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" >import { createProjectLogger, c</span>reateModuleLogger } from '@metamask/utils';
+&nbsp;
+export const <span class="cstat-no" title="statement not covered" >projectLogger = createProjectLogger('network-controller');</span>
+&nbsp;
+export { <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >createModuleLogger </span>};</span>
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/rpc-service/index.html b/coverage/lcov-report/src/rpc-service/index.html
new file mode 100644
index 0000000000000000000000000000000000000000..47d949310b92a43f943f3eb76ab123a25b1922ea
--- /dev/null
+++ b/coverage/lcov-report/src/rpc-service/index.html
@@ -0,0 +1,131 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/rpc-service</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../../prettify.css" />
+    <link rel="stylesheet" href="../../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../../index.html">All files</a> src/rpc-service</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/172</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/60</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/46</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/169</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file low" data-value="rpc-service-chain.ts"><a href="rpc-service-chain.ts.html">rpc-service-chain.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="82" class="abs low">0/82</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="13" class="abs low">0/13</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="23" class="abs low">0/23</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="79" class="abs low">0/79</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="rpc-service.ts"><a href="rpc-service.ts.html">rpc-service.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="90" class="abs low">0/90</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="47" class="abs low">0/47</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="23" class="abs low">0/23</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="90" class="abs low">0/90</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../../sorter.js"></script>
+        <script src="../../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/rpc-service/rpc-service-chain.ts.html b/coverage/lcov-report/src/rpc-service/rpc-service-chain.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..4fa76adcee41b8a988e6efe93b1997a28678550a
--- /dev/null
+++ b/coverage/lcov-report/src/rpc-service/rpc-service-chain.ts.html
@@ -0,0 +1,1528 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/rpc-service/rpc-service-chain.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../../prettify.css" />
+    <link rel="stylesheet" href="../../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/rpc-service</a> rpc-service-chain.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/82</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/13</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/23</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/79</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" >import {</span>
+  CircuitState,
+  CockatielEventEmitter,
+} from '@metamask/controller-utils';
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+import { IDisposable } from 'cockatiel';
+&nbsp;
+<span class="cstat-no" title="statement not covered" >import { RpcService } from './rpc-service';</span>
+import type { RpcServiceOptions } from './rpc-service';
+import type {
+  CockatielEventToEventListenerWithData,
+  ExcludeCockatielEventData,
+  ExtractCockatielEventData,
+  FetchOptions,
+} from './shared';
+<span class="cstat-no" title="statement not covered" >import { projectLogger, createModuleLogger } from '../logger';</span>
+&nbsp;
+const log = <span class="cstat-no" title="statement not covered" >createModuleLogger(projectLogger, 'RpcServiceChain');</span>
+&nbsp;
+/**
+ * Statuses that the RPC service chain can be in.
+ */
+const STATUSES = <span class="cstat-no" title="statement not covered" >{</span>
+  Available: 'available',
+  Degraded: 'degraded',
+  Unknown: 'unknown',
+  Unavailable: 'unavailable',
+} as const;
+&nbsp;
+/**
+ * Statuses that the RPC service chain can be in.
+ */
+type Status = (typeof STATUSES)[keyof typeof STATUSES];
+&nbsp;
+/**
+ * This class constructs and manages requests to a chain of RpcService objects
+ * which represent RPC endpoints with which to access a particular network. The
+ * first service in the chain is intended to be the primary way of hitting the
+ * network and the remaining services are used as failovers.
+ */
+<span class="cstat-no" title="statement not covered" >export class R</span>pcServiceChain {
+  /**
+   * The event emitter for the `onAvailable` event.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#onAvailableEventEmitter: CockatielEventEmitter&lt;</span>
+    ExcludeCockatielEventData&lt;
+      ExtractCockatielEventData&lt;RpcService['onAvailable']&gt;,
+      'endpointUrl'
+    &gt;
+  &gt;;
+&nbsp;
+  /**
+   * The event emitter for the `onBreak` event.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#onBreakEventEmitter: CockatielEventEmitter&lt;</span>
+    ExcludeCockatielEventData&lt;
+      ExtractCockatielEventData&lt;RpcService['onBreak']&gt;,
+      'endpointUrl'
+    &gt;
+  &gt;;
+&nbsp;
+  /**
+   * The event emitter for the `onDegraded` event.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#onDegradedEventEmitter: CockatielEventEmitter&lt;</span>
+    ExcludeCockatielEventData&lt;
+      ExtractCockatielEventData&lt;RpcService['onDegraded']&gt;,
+      'endpointUrl'
+    &gt;
+  &gt;;
+&nbsp;
+  /**
+   * The first RPC service that requests will be sent to.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#primaryService: RpcService;</span>
+&nbsp;
+  /**
+   * The RPC services in the chain.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#services: RpcService[];</span>
+&nbsp;
+  /**
+   * The status of the RPC service chain.
+   */
+<span class="cstat-no" title="statement not covered" >  #status: Status;</span>
+&nbsp;
+  /**
+   * Constructs a new RpcServiceChain object.
+   *
+   * @param rpcServiceConfigurations - The options for the RPC services
+   * that you want to construct. Each object in this array is the same as
+   * {@link RpcServiceOptions}.
+   */
+<span class="fstat-no" title="function not covered" >  constructor(</span>
+    rpcServiceConfigurations: [RpcServiceOptions, ...RpcServiceOptions[]],
+  ) {
+<span class="cstat-no" title="statement not covered" >    this.#services = rpcServiceConfigurations.map(</span>
+<span class="fstat-no" title="function not covered" >      (r</span>pcServiceConfiguration) =&gt; <span class="cstat-no" title="statement not covered" >new RpcService(rpcServiceConfiguration),</span>
+    );
+<span class="cstat-no" title="statement not covered" >    this.#primaryService = this.#services[0];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#status = STATUSES.Unknown;</span>
+<span class="cstat-no" title="statement not covered" >    this.#onBreakEventEmitter = new CockatielEventEmitter&lt;</span>
+      ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onBreak']&gt;,
+        'endpointUrl'
+      &gt;
+    &gt;();
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#onDegradedEventEmitter = new CockatielEventEmitter&lt;</span>
+      ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onDegraded']&gt;,
+        'endpointUrl'
+      &gt;
+    &gt;();
+<span class="cstat-no" title="statement not covered" >    for (const service of this.#services) {</span>
+<span class="cstat-no" title="statement not covered" >      service.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#status !== STATUSES.Degraded) {</span>
+<span class="cstat-no" title="statement not covered" >          log('Updating status to "degraded"', data);</span>
+<span class="cstat-no" title="statement not covered" >          this.#status = STATUSES.Degraded;</span>
+          const { endpointUrl, ...rest } = <span class="cstat-no" title="statement not covered" >data;</span>
+<span class="cstat-no" title="statement not covered" >          this.#onDegradedEventEmitter.emit(rest);</span>
+        }
+      });
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#onAvailableEventEmitter = new CockatielEventEmitter&lt;</span>
+      ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onAvailable']&gt;,
+        'endpointUrl'
+      &gt;
+    &gt;();
+<span class="cstat-no" title="statement not covered" >    for (const service of this.#services) {</span>
+<span class="cstat-no" title="statement not covered" >      service.onAvailable(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#status !== STATUSES.Available) {</span>
+<span class="cstat-no" title="statement not covered" >          log('Updating status to "available"', data);</span>
+<span class="cstat-no" title="statement not covered" >          this.#status = STATUSES.Available;</span>
+          const { endpointUrl, ...rest } = <span class="cstat-no" title="statement not covered" >data;</span>
+<span class="cstat-no" title="statement not covered" >          this.#onAvailableEventEmitter.emit(rest);</span>
+        }
+      });
+    }
+  }
+&nbsp;
+  /**
+   * Calls the provided callback when any of the RPC services is retried.
+   *
+   * This is mainly useful for tests.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the event listener.
+   */
+<span class="fstat-no" title="function not covered" >  onServiceRetry(</span>
+    listener: CockatielEventToEventListenerWithData&lt;
+      RpcService['onRetry'],
+      { primaryEndpointUrl: string }
+    &gt;,
+  ): { dispose(): void } {
+    const disposables = <span class="cstat-no" title="statement not covered" >this.#services.map(<span class="fstat-no" title="function not covered" >(s</span>ervice) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >      service.onRetry(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        listener({</span>
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+<span class="fstat-no" title="function not covered" >      dispose(</span>): void {
+<span class="cstat-no" title="statement not covered" >        disposables.forEach(<span class="fstat-no" title="function not covered" >(d</span>isposable) =&gt; <span class="cstat-no" title="statement not covered" >disposable.dispose())</span>;</span>
+      },
+    };
+  }
+&nbsp;
+  /**
+   * Calls the provided callback only when the maximum number of failed
+   * consecutive attempts to receive a 2xx response has been reached for all
+   * RPC services in the chain, and all services' underlying circuits have
+   * broken.
+   *
+   * The callback will not be called if a service's circuit breaks but its
+   * failover does not. Use `onServiceBreak` if you'd like a lower level of
+   * granularity.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onBreak(</span>
+    listener: (
+      data: ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onBreak']&gt;,
+        'endpointUrl'
+      &gt;,
+    ) =&gt; void,
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#onBreakEventEmitter.addListener(listener);</span>
+  }
+&nbsp;
+  /**
+   * Calls the provided callback each time when, for *any* of the RPC services
+   * in this chain, the maximum number of failed consecutive attempts to receive
+   * a 2xx response has been reached and the underlying circuit has broken. A
+   * more granular version of `onBreak`.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onServiceBreak(</span>
+    listener: CockatielEventToEventListenerWithData&lt;
+      RpcService['onBreak'],
+      { primaryEndpointUrl: string }
+    &gt;,
+  ): IDisposable {
+    const disposables = <span class="cstat-no" title="statement not covered" >this.#services.map(<span class="fstat-no" title="function not covered" >(s</span>ervice) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >      service.onBreak(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        listener({</span>
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+<span class="fstat-no" title="function not covered" >      dispose(</span>): void {
+<span class="cstat-no" title="statement not covered" >        disposables.forEach(<span class="fstat-no" title="function not covered" >(d</span>isposable) =&gt; <span class="cstat-no" title="statement not covered" >disposable.dispose())</span>;</span>
+      },
+    };
+  }
+&nbsp;
+  /**
+   * Calls the provided callback if no requests have been initiated yet or
+   * all requests to RPC services in this chain have responded successfully in a
+   * timely fashion, and then one of the two conditions apply:
+   *
+   * 1. When a retriable error is encountered making a request to an RPC
+   * service, and the request is retried until a set maximum is reached.
+   * 2. When a RPC service responds successfully, but the request takes longer
+   * than a set number of seconds to complete.
+   *
+   * Note that the callback will be called even if there are local connectivity
+   * issues which prevent requests from being initiated. This is intentional.
+   *
+   * Also note this callback will only be called if the RPC service chain as a
+   * whole is in a "degraded" state, and will then only be called once (e.g., it
+   * will not be called if a failover service falls into a degraded state, then
+   * the primary comes back online, but it is slow). Use `onServiceDegraded` if
+   * you'd like a lower level of granularity.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onDegraded(</span>
+    listener: (
+      data: ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onDegraded']&gt;,
+        'endpointUrl'
+      &gt;,
+    ) =&gt; void,
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#onDegradedEventEmitter.addListener(listener);</span>
+  }
+&nbsp;
+  /**
+   * Calls the provided callback each time one of the two conditions apply:
+   *
+   * 1. When a retriable error is encountered making a request to an RPC
+   * service, and the request is retried until a set maximum is reached.
+   * 2. When a RPC service responds successfully, but the request takes longer
+   * than a set number of seconds to complete.
+   *
+   * Note that the callback will be called even if there are local connectivity
+   * issues which prevent requests from being initiated. This is intentional.
+   *
+   * This is a more granular version of `onDegraded`. The callback will be
+   * called for each slow request to an RPC service. It may also be called again
+   * if a failover service falls into a degraded state, then the primary comes
+   * back online, but it is slow.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onServiceDegraded(</span>
+    listener: CockatielEventToEventListenerWithData&lt;
+      RpcService['onDegraded'],
+      { primaryEndpointUrl: string }
+    &gt;,
+  ): IDisposable {
+    const disposables = <span class="cstat-no" title="statement not covered" >this.#services.map(<span class="fstat-no" title="function not covered" >(s</span>ervice) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >      service.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        listener({</span>
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+<span class="fstat-no" title="function not covered" >      dispose(</span>): void {
+<span class="cstat-no" title="statement not covered" >        disposables.forEach(<span class="fstat-no" title="function not covered" >(d</span>isposable) =&gt; <span class="cstat-no" title="statement not covered" >disposable.dispose())</span>;</span>
+      },
+    };
+  }
+&nbsp;
+  /**
+   * Calls the provided callback in one of the following two conditions:
+   *
+   * 1. The first time that a 2xx request is made to any of the RPC services in
+   * this chain.
+   * 2. When requests to any the failover RPC services in this chain were
+   * failing such that they were degraded or their underyling circuits broke,
+   * but the first request to the primary succeeds again.
+   *
+   * Note this callback will only be called if the RPC service chain as a whole
+   * is in an "available" state.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onAvailable(</span>
+    listener: (
+      data: ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onAvailable']&gt;,
+        'endpointUrl'
+      &gt;,
+    ) =&gt; void,
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#onAvailableEventEmitter.addListener(listener);</span>
+  }
+&nbsp;
+  /**
+   * Uses the RPC services in the chain to make a request, using each service
+   * after the first as a fallback to the previous one as necessary.
+   *
+   * This overload is specifically designed for `eth_getBlockByNumber`, which
+   * can return a `result` of `null` despite an expected `Result` being
+   * provided.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws A 401 error if the response status is 401.
+   * @throws A "rate limiting" error if the response HTTP status is 429.
+   * @throws A "resource unavailable" error if the response status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client error (-32100) for any other 4xx status codes.
+   * @throws A "parse" error if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt; &amp; {
+      method: 'eth_getBlockByNumber';
+    },
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt; | JsonRpcResponse&lt;null&gt;&gt;;
+&nbsp;
+  /**
+   * Uses the RPC services in the chain to make a request, using each service
+   * after the first as a fallback to the previous one as necessary.
+   *
+   * This overload is designed for all RPC methods except for
+   * `eth_getBlockByNumber`, which are expected to return a `result` of the
+   * expected `Result`.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws A 401 error if the response status is 401.
+   * @throws A "rate limiting" error if the response HTTP status is 429.
+   * @throws A "resource unavailable" error if the response status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client error (-32100) for any other 4xx status codes.
+   * @throws A "parse" error if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt;&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  async </span>request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions: FetchOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;JsonRpcResponse&lt;Result | null&gt;&gt; {
+    // Start with the primary (first) service and switch to failovers as the
+    // need arises. This is a bit confusing, so keep reading for more on how
+    // this works.
+&nbsp;
+    let availableServiceIndex: number | undefined;
+    let response: JsonRpcResponse&lt;Result&gt; | undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const [i, service] of this.#services.entries()) {</span>
+<span class="cstat-no" title="statement not covered" >      log(`Trying service #${i + 1}...`);</span>
+      const previousCircuitState = <span class="cstat-no" title="statement not covered" >service.getCircuitState();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      try {</span>
+        // Try making the request through the service.
+<span class="cstat-no" title="statement not covered" >        response = await service.request&lt;Params, Result&gt;(</span>
+          jsonRpcRequest,
+          fetchOptions,
+        );
+<span class="cstat-no" title="statement not covered" >        log('Service successfully received request.');</span>
+<span class="cstat-no" title="statement not covered" >        availableServiceIndex = i;</span>
+<span class="cstat-no" title="statement not covered" >        break;</span>
+      } catch (error) {
+        // Oops, that didn't work.
+        // Capture this error so that we can handle it later.
+&nbsp;
+        const { lastError } = <span class="cstat-no" title="statement not covered" >service;</span>
+        const isCircuitOpen = <span class="cstat-no" title="statement not covered" >service.getCircuitState() === CircuitState.Open;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        log('Service failed! error =', error, 'lastError = ', lastError);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (isCircuitOpen) {</span>
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (i &lt; this.#services.length - 1) {</span>
+<span class="cstat-no" title="statement not covered" >            log(</span>
+              "This service's circuit is open. Proceeding to next service...",
+            );
+<span class="cstat-no" title="statement not covered" >            continue;</span>
+          }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+            previousCircuitState !== CircuitState.Open &amp;&amp;
+            this.#status !== STATUSES.Unavailable &amp;&amp;
+            lastError !== undefined
+          ) {
+            // If the service's circuit just broke and it's the last one in the
+            // chain, then trigger the onBreak event. (But if for some reason we
+            // have already done this, then don't do it.)
+<span class="cstat-no" title="statement not covered" >            log(</span>
+              'This service\'s circuit just opened and it is the last service. Updating status to "unavailable" and triggering onBreak.',
+            );
+<span class="cstat-no" title="statement not covered" >            this.#status = STATUSES.Unavailable;</span>
+<span class="cstat-no" title="statement not covered" >            this.#onBreakEventEmitter.emit({</span>
+              error: lastError,
+            });
+          }
+        }
+&nbsp;
+        // The service failed, and we throw whatever the error is. The calling
+        // code can try again if it so desires.
+<span class="cstat-no" title="statement not covered" >        log(</span>
+          `${isCircuitOpen ? '' : "This service's circuit is closed. "}Re-throwing error.`,
+        );
+<span class="cstat-no" title="statement not covered" >        throw error;</span>
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (response) {</span>
+      // If one of the services is available, reset all of the circuits of the
+      // following services. If we didn't do this and the service became
+      // unavailable in the future, and any of the failovers' circuits were
+      // open (due to previous failures), we would receive a "circuit broken"
+      // error when we attempted to divert traffic to the failovers again.
+      //
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (availableServiceIndex !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        for (const [i, service] of [...this.#services.entries()].slice(</span>
+          availableServiceIndex + 1,
+        )) {
+<span class="cstat-no" title="statement not covered" >          log(`Resetting policy for service #${i + 1}.`);</span>
+<span class="cstat-no" title="statement not covered" >          service.resetPolicy();</span>
+        }
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      return response;</span>
+    }
+&nbsp;
+    // The only way we can end up here is if there are no services to loop over.
+    // That is not possible due to the types on the constructor, but TypeScript
+    // doesn't know this, so we have to appease it.
+<span class="cstat-no" title="statement not covered" >    throw new Error('Nothing to return');</span>
+  }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../../sorter.js"></script>
+        <script src="../../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/rpc-service/rpc-service.ts.html b/coverage/lcov-report/src/rpc-service/rpc-service.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..0a804bceb77d9ac8e6b590e0efec295d309ff882
--- /dev/null
+++ b/coverage/lcov-report/src/rpc-service/rpc-service.ts.html
@@ -0,0 +1,1978 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/rpc-service/rpc-service.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../../prettify.css" />
+    <link rel="stylesheet" href="../../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/rpc-service</a> rpc-service.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/90</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/47</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/23</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/90</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a>
+<a name='L483'></a><a href='#L483'>483</a>
+<a name='L484'></a><a href='#L484'>484</a>
+<a name='L485'></a><a href='#L485'>485</a>
+<a name='L486'></a><a href='#L486'>486</a>
+<a name='L487'></a><a href='#L487'>487</a>
+<a name='L488'></a><a href='#L488'>488</a>
+<a name='L489'></a><a href='#L489'>489</a>
+<a name='L490'></a><a href='#L490'>490</a>
+<a name='L491'></a><a href='#L491'>491</a>
+<a name='L492'></a><a href='#L492'>492</a>
+<a name='L493'></a><a href='#L493'>493</a>
+<a name='L494'></a><a href='#L494'>494</a>
+<a name='L495'></a><a href='#L495'>495</a>
+<a name='L496'></a><a href='#L496'>496</a>
+<a name='L497'></a><a href='#L497'>497</a>
+<a name='L498'></a><a href='#L498'>498</a>
+<a name='L499'></a><a href='#L499'>499</a>
+<a name='L500'></a><a href='#L500'>500</a>
+<a name='L501'></a><a href='#L501'>501</a>
+<a name='L502'></a><a href='#L502'>502</a>
+<a name='L503'></a><a href='#L503'>503</a>
+<a name='L504'></a><a href='#L504'>504</a>
+<a name='L505'></a><a href='#L505'>505</a>
+<a name='L506'></a><a href='#L506'>506</a>
+<a name='L507'></a><a href='#L507'>507</a>
+<a name='L508'></a><a href='#L508'>508</a>
+<a name='L509'></a><a href='#L509'>509</a>
+<a name='L510'></a><a href='#L510'>510</a>
+<a name='L511'></a><a href='#L511'>511</a>
+<a name='L512'></a><a href='#L512'>512</a>
+<a name='L513'></a><a href='#L513'>513</a>
+<a name='L514'></a><a href='#L514'>514</a>
+<a name='L515'></a><a href='#L515'>515</a>
+<a name='L516'></a><a href='#L516'>516</a>
+<a name='L517'></a><a href='#L517'>517</a>
+<a name='L518'></a><a href='#L518'>518</a>
+<a name='L519'></a><a href='#L519'>519</a>
+<a name='L520'></a><a href='#L520'>520</a>
+<a name='L521'></a><a href='#L521'>521</a>
+<a name='L522'></a><a href='#L522'>522</a>
+<a name='L523'></a><a href='#L523'>523</a>
+<a name='L524'></a><a href='#L524'>524</a>
+<a name='L525'></a><a href='#L525'>525</a>
+<a name='L526'></a><a href='#L526'>526</a>
+<a name='L527'></a><a href='#L527'>527</a>
+<a name='L528'></a><a href='#L528'>528</a>
+<a name='L529'></a><a href='#L529'>529</a>
+<a name='L530'></a><a href='#L530'>530</a>
+<a name='L531'></a><a href='#L531'>531</a>
+<a name='L532'></a><a href='#L532'>532</a>
+<a name='L533'></a><a href='#L533'>533</a>
+<a name='L534'></a><a href='#L534'>534</a>
+<a name='L535'></a><a href='#L535'>535</a>
+<a name='L536'></a><a href='#L536'>536</a>
+<a name='L537'></a><a href='#L537'>537</a>
+<a name='L538'></a><a href='#L538'>538</a>
+<a name='L539'></a><a href='#L539'>539</a>
+<a name='L540'></a><a href='#L540'>540</a>
+<a name='L541'></a><a href='#L541'>541</a>
+<a name='L542'></a><a href='#L542'>542</a>
+<a name='L543'></a><a href='#L543'>543</a>
+<a name='L544'></a><a href='#L544'>544</a>
+<a name='L545'></a><a href='#L545'>545</a>
+<a name='L546'></a><a href='#L546'>546</a>
+<a name='L547'></a><a href='#L547'>547</a>
+<a name='L548'></a><a href='#L548'>548</a>
+<a name='L549'></a><a href='#L549'>549</a>
+<a name='L550'></a><a href='#L550'>550</a>
+<a name='L551'></a><a href='#L551'>551</a>
+<a name='L552'></a><a href='#L552'>552</a>
+<a name='L553'></a><a href='#L553'>553</a>
+<a name='L554'></a><a href='#L554'>554</a>
+<a name='L555'></a><a href='#L555'>555</a>
+<a name='L556'></a><a href='#L556'>556</a>
+<a name='L557'></a><a href='#L557'>557</a>
+<a name='L558'></a><a href='#L558'>558</a>
+<a name='L559'></a><a href='#L559'>559</a>
+<a name='L560'></a><a href='#L560'>560</a>
+<a name='L561'></a><a href='#L561'>561</a>
+<a name='L562'></a><a href='#L562'>562</a>
+<a name='L563'></a><a href='#L563'>563</a>
+<a name='L564'></a><a href='#L564'>564</a>
+<a name='L565'></a><a href='#L565'>565</a>
+<a name='L566'></a><a href='#L566'>566</a>
+<a name='L567'></a><a href='#L567'>567</a>
+<a name='L568'></a><a href='#L568'>568</a>
+<a name='L569'></a><a href='#L569'>569</a>
+<a name='L570'></a><a href='#L570'>570</a>
+<a name='L571'></a><a href='#L571'>571</a>
+<a name='L572'></a><a href='#L572'>572</a>
+<a name='L573'></a><a href='#L573'>573</a>
+<a name='L574'></a><a href='#L574'>574</a>
+<a name='L575'></a><a href='#L575'>575</a>
+<a name='L576'></a><a href='#L576'>576</a>
+<a name='L577'></a><a href='#L577'>577</a>
+<a name='L578'></a><a href='#L578'>578</a>
+<a name='L579'></a><a href='#L579'>579</a>
+<a name='L580'></a><a href='#L580'>580</a>
+<a name='L581'></a><a href='#L581'>581</a>
+<a name='L582'></a><a href='#L582'>582</a>
+<a name='L583'></a><a href='#L583'>583</a>
+<a name='L584'></a><a href='#L584'>584</a>
+<a name='L585'></a><a href='#L585'>585</a>
+<a name='L586'></a><a href='#L586'>586</a>
+<a name='L587'></a><a href='#L587'>587</a>
+<a name='L588'></a><a href='#L588'>588</a>
+<a name='L589'></a><a href='#L589'>589</a>
+<a name='L590'></a><a href='#L590'>590</a>
+<a name='L591'></a><a href='#L591'>591</a>
+<a name='L592'></a><a href='#L592'>592</a>
+<a name='L593'></a><a href='#L593'>593</a>
+<a name='L594'></a><a href='#L594'>594</a>
+<a name='L595'></a><a href='#L595'>595</a>
+<a name='L596'></a><a href='#L596'>596</a>
+<a name='L597'></a><a href='#L597'>597</a>
+<a name='L598'></a><a href='#L598'>598</a>
+<a name='L599'></a><a href='#L599'>599</a>
+<a name='L600'></a><a href='#L600'>600</a>
+<a name='L601'></a><a href='#L601'>601</a>
+<a name='L602'></a><a href='#L602'>602</a>
+<a name='L603'></a><a href='#L603'>603</a>
+<a name='L604'></a><a href='#L604'>604</a>
+<a name='L605'></a><a href='#L605'>605</a>
+<a name='L606'></a><a href='#L606'>606</a>
+<a name='L607'></a><a href='#L607'>607</a>
+<a name='L608'></a><a href='#L608'>608</a>
+<a name='L609'></a><a href='#L609'>609</a>
+<a name='L610'></a><a href='#L610'>610</a>
+<a name='L611'></a><a href='#L611'>611</a>
+<a name='L612'></a><a href='#L612'>612</a>
+<a name='L613'></a><a href='#L613'>613</a>
+<a name='L614'></a><a href='#L614'>614</a>
+<a name='L615'></a><a href='#L615'>615</a>
+<a name='L616'></a><a href='#L616'>616</a>
+<a name='L617'></a><a href='#L617'>617</a>
+<a name='L618'></a><a href='#L618'>618</a>
+<a name='L619'></a><a href='#L619'>619</a>
+<a name='L620'></a><a href='#L620'>620</a>
+<a name='L621'></a><a href='#L621'>621</a>
+<a name='L622'></a><a href='#L622'>622</a>
+<a name='L623'></a><a href='#L623'>623</a>
+<a name='L624'></a><a href='#L624'>624</a>
+<a name='L625'></a><a href='#L625'>625</a>
+<a name='L626'></a><a href='#L626'>626</a>
+<a name='L627'></a><a href='#L627'>627</a>
+<a name='L628'></a><a href='#L628'>628</a>
+<a name='L629'></a><a href='#L629'>629</a>
+<a name='L630'></a><a href='#L630'>630</a>
+<a name='L631'></a><a href='#L631'>631</a>
+<a name='L632'></a><a href='#L632'>632</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type {
+  CreateServicePolicyOptions,
+  ServicePolicy,
+} from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import {</span>
+  BrokenCircuitError,
+  HttpError,
+  createServicePolicy,
+  handleWhen,
+} from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';</span>
+<span class="cstat-no" title="statement not covered" >import { Duration, getErrorMessage, hasProperty } from '@metamask/utils';</span>
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+import { CircuitState, IDisposable } from 'cockatiel';
+<span class="cstat-no" title="statement not covered" >import deepmerge from 'deepmerge';</span>
+import type { Logger } from 'loglevel';
+&nbsp;
+import type { AbstractRpcService } from './abstract-rpc-service';
+import type { FetchOptions } from './shared';
+<span class="cstat-no" title="statement not covered" >import { projectLogger, createModuleLogger } from '../logger';</span>
+&nbsp;
+/**
+ * Options for the RpcService constructor.
+ */
+export type RpcServiceOptions = {
+  /**
+   * A function that can be used to convert a binary string into a
+   * base64-encoded ASCII string. Used to encode authorization credentials.
+   */
+  btoa: typeof btoa;
+  /**
+   * The URL of the RPC endpoint to hit.
+   */
+  endpointUrl: URL | string;
+  /**
+   * A function that can be used to make an HTTP request. If your JavaScript
+   * environment supports `fetch` natively, you'll probably want to pass that;
+   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).
+   */
+  fetch: typeof fetch;
+  /**
+   * A common set of options that will be used to make every request. Can be
+   * overridden on the request level (e.g. to add headers).
+   */
+  fetchOptions?: FetchOptions;
+  /**
+   * A `loglevel` logger.
+   */
+  logger?: Pick&lt;Logger, 'warn'&gt;;
+  /**
+   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is
+   * not accepted, as it is overwritten. See {@link createServicePolicy}.
+   */
+  policyOptions?: Omit&lt;CreateServicePolicyOptions, 'retryFilterPolicy'&gt;;
+};
+&nbsp;
+const log = <span class="cstat-no" title="statement not covered" >createModuleLogger(projectLogger, 'RpcService');</span>
+&nbsp;
+/**
+ * The maximum number of times that a failing service should be re-run before
+ * giving up.
+ */
+export const <span class="cstat-no" title="statement not covered" >DEFAULT_MAX_RETRIES = 4;</span>
+&nbsp;
+/**
+ * The maximum number of times that the service is allowed to fail before
+ * pausing further retries. This is set to a value such that if given a
+ * service that continually fails, the policy needs to be executed 3 times
+ * before further retries are paused.
+ */
+export const <span class="cstat-no" title="statement not covered" >DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;</span>
+&nbsp;
+/**
+ * The list of error messages that represent a failure to connect to the network.
+ *
+ * This list was derived from Sindre Sorhus's `is-network-error` package:
+ * &lt;https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js&gt;
+ */
+export const <span class="cstat-no" title="statement not covered" >CONNECTION_ERRORS = [</span>
+  // Chrome
+  {
+    constructorName: 'TypeError',
+    pattern: /network error/u,
+  },
+  // Chrome
+  {
+    constructorName: 'TypeError',
+    pattern: /Failed to fetch/u,
+  },
+  // Firefox
+  {
+    constructorName: 'TypeError',
+    pattern: /NetworkError when attempting to fetch resource\./u,
+  },
+  // Safari 16
+  {
+    constructorName: 'TypeError',
+    pattern: /The Internet connection appears to be offline\./u,
+  },
+  // Safari 17+
+  {
+    constructorName: 'TypeError',
+    pattern: /Load failed/u,
+  },
+  // `cross-fetch`
+  {
+    constructorName: 'TypeError',
+    pattern: /Network request failed/u,
+  },
+  // `node-fetch`
+  {
+    constructorName: 'FetchError',
+    pattern: /request to (.+) failed/u,
+  },
+  // Undici (Node.js)
+  {
+    constructorName: 'TypeError',
+    pattern: /fetch failed/u,
+  },
+  // Undici (Node.js)
+  {
+    constructorName: 'TypeError',
+    pattern: /terminated/u,
+  },
+];
+&nbsp;
+/**
+ * Custom JSON-RPC error codes for specific cases.
+ *
+ * These should be moved to `@metamask/rpc-errors` eventually.
+ */
+export const <span class="cstat-no" title="statement not covered" >CUSTOM_RPC_ERRORS = {</span>
+  unauthorized: -32006,
+  httpClientError: -32080,
+} as const;
+&nbsp;
+/**
+ * Determines whether the given error represents a failure to reach the network
+ * after request parameters have been validated.
+ *
+ * This is somewhat difficult to verify because JavaScript engines (and in
+ * some cases libraries) produce slightly different error messages for this
+ * particular scenario, and we need to account for this.
+ *
+ * @param error - The error.
+ * @returns True if the error indicates that the network cannot be connected to,
+ * and false otherwise.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >i</span>sConnectionError(</span>error: unknown): boolean {
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if (!(typeof error === 'object' &amp;&amp; error !== null &amp;&amp; 'message' in error)) {</span>
+<span class="cstat-no" title="statement not covered" >    return false;</span>
+  }
+&nbsp;
+  const { message } = <span class="cstat-no" title="statement not covered" >error;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return (</span>
+    typeof message === 'string' &amp;&amp;
+    !isNockError(message) &amp;&amp;
+    CONNECTION_ERRORS.some(<span class="fstat-no" title="function not covered" >({</span> constructorName, pattern }) =&gt; {
+<span class="cstat-no" title="statement not covered" >      return (</span>
+        error.constructor.name === constructorName &amp;&amp; pattern.test(message)
+      );
+    })
+  );
+}
+&nbsp;
+/**
+ * Determines whether the given error message refers to a Nock error.
+ *
+ * It's important that if we failed to mock a request in a test, the resulting
+ * error does not cause the request to be retried so that we can see it right
+ * away.
+ *
+ * @param message - The error message to test.
+ * @returns True if the message indicates a missing Nock mock, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isNockError(</span>message: string): boolean {
+<span class="cstat-no" title="statement not covered" >  return message.includes('Nock:');</span>
+}
+&nbsp;
+/**
+ * Determine whether the given error message indicates a failure to parse JSON.
+ *
+ * This is different in tests vs. implementation code because it may manifest as
+ * a FetchError or a SyntaxError.
+ *
+ * @param error - The error object to test.
+ * @returns True if the error indicates a JSON parse error, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isJsonParseError(</span>error: unknown): boolean {
+<span class="cstat-no" title="statement not covered" >  return (</span>
+    error instanceof SyntaxError ||
+    /invalid json/iu.test(getErrorMessage(error))
+  );
+}
+&nbsp;
+/**
+ * Guarantees a URL, even given a string. This is useful for checking components
+ * of that URL.
+ *
+ * @param endpointUrlOrUrlString - Either a URL object or a string that
+ * represents the URL of an endpoint.
+ * @returns A URL object.
+ */
+function <span class="fstat-no" title="function not covered" >getNormalizedEndpointUrl(</span>endpointUrlOrUrlString: URL | string): URL {
+<span class="cstat-no" title="statement not covered" >  return endpointUrlOrUrlString instanceof URL</span>
+    ? endpointUrlOrUrlString
+    : new URL(endpointUrlOrUrlString);
+}
+&nbsp;
+/**
+ * Strips username and password from a URL.
+ *
+ * @param url - The URL to strip credentials from.
+ * @returns A new URL object with credentials removed.
+ */
+function <span class="fstat-no" title="function not covered" >stripCredentialsFromUrl(</span>url: URL): URL {
+  const strippedUrl = <span class="cstat-no" title="statement not covered" >new URL(url.toString());</span>
+<span class="cstat-no" title="statement not covered" >  strippedUrl.username = '';</span>
+<span class="cstat-no" title="statement not covered" >  strippedUrl.password = '';</span>
+<span class="cstat-no" title="statement not covered" >  return strippedUrl;</span>
+}
+&nbsp;
+/**
+ * This class is responsible for making a request to an endpoint that implements
+ * the JSON-RPC protocol. It is designed to gracefully handle network and server
+ * failures, retrying requests using exponential backoff. It also offers a hook
+ * which can used to respond to slow requests.
+ */
+<span class="cstat-no" title="statement not covered" >export class R</span>pcService implements AbstractRpcService {
+  /**
+   * The URL of the RPC endpoint.
+   */
+  readonly endpointUrl: URL;
+&nbsp;
+  /**
+   * The last error that the retry policy captured (or `undefined` if the last
+   * execution of the service was successful).
+   */
+  lastError: Error | undefined;
+&nbsp;
+  /**
+   * The function used to make an HTTP request.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#fetch: typeof fetch;</span>
+&nbsp;
+  /**
+   * A common set of options that the request options will extend.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#fetchOptions: FetchOptions;</span>
+&nbsp;
+  /**
+   * A `loglevel` logger.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#logger: RpcServiceOptions['logger'];</span>
+&nbsp;
+  /**
+   * The policy that wraps the request.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#policy: ServicePolicy;</span>
+&nbsp;
+  /**
+   * Constructs a new RpcService object.
+   *
+   * @param options - The options. See {@link RpcServiceOptions}.
+   */
+<span class="fstat-no" title="function not covered" >  constructor(o</span>ptions: RpcServiceOptions) {
+    const {
+      btoa: givenBtoa,
+      endpointUrl,
+      fetch: givenFetch,
+      logger,
+      fetchOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+      policyOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+    } = <span class="cstat-no" title="statement not covered" >options;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#fetch = givenFetch;</span>
+    const normalizedUrl = <span class="cstat-no" title="statement not covered" >getNormalizedEndpointUrl(endpointUrl);</span>
+<span class="cstat-no" title="statement not covered" >    this.#fetchOptions = this.#getDefaultFetchOptions(</span>
+      normalizedUrl,
+      fetchOptions,
+      givenBtoa,
+    );
+<span class="cstat-no" title="statement not covered" >    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);</span>
+<span class="cstat-no" title="statement not covered" >    this.#logger = logger;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#policy = createServicePolicy({</span>
+      maxRetries: DEFAULT_MAX_RETRIES,
+      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+      ...policyOptions,
+      retryFilterPolicy: handleWhen(<span class="fstat-no" title="function not covered" >(e</span>rror) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          // Ignore errors where the request failed to establish
+          isConnectionError(error) ||
+          // Ignore server sent HTML error pages or truncated JSON responses
+          isJsonParseError(error) ||
+          // Ignore server overload errors
+          ('httpStatus' in error &amp;&amp;
+            (error.httpStatus === 502 ||
+              error.httpStatus === 503 ||
+              error.httpStatus === 504)) ||
+          (hasProperty(error, 'code') &amp;&amp;
+            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))
+        );
+      }),
+    });
+  }
+&nbsp;
+  /**
+   * Resets the underlying composite Cockatiel policy.
+   *
+   * This is useful in a collection of RpcServices where some act as failovers
+   * for others where you effectively want to invalidate the failovers when the
+   * primary recovers.
+   */
+<span class="fstat-no" title="function not covered" >  resetPolicy(</span>): void {
+<span class="cstat-no" title="statement not covered" >    this.#policy.reset();</span>
+  }
+&nbsp;
+  /**
+   * @returns The state of the underlying circuit.
+   */
+<span class="fstat-no" title="function not covered" >  getCircuitState(</span>): CircuitState {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.getCircuitState();</span>
+  }
+&nbsp;
+  /**
+   * Listens for when the RPC service retries the request.
+   *
+   * @param listener - The callback to be called when the retry occurs.
+   * @returns What {@link ServicePolicy.onRetry} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onRetry(</span>listener: Parameters&lt;AbstractRpcService['onRetry']&gt;[0]): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onRetry(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      listener({ ...data, endpointUrl: this.endpointUrl.toString() });</span>
+    });
+  }
+&nbsp;
+  /**
+   * Listens for when the RPC service retries the request too many times in a
+   * row, causing the underlying circuit to break.
+   *
+   * @param listener - The callback to be called when the circuit is broken.
+   * @returns What {@link ServicePolicy.onBreak} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onBreak(</span>listener: Parameters&lt;AbstractRpcService['onBreak']&gt;[0]): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onBreak(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+      // `{ isolated: true }` is a special object that shows up when `isolate`
+      // is called on the circuit breaker. Usually `isolate` is used to hold the
+      // circuit open, but we (ab)use this method in `createServicePolicy` to
+      // reset the circuit breaker policy. When we do this, we don't want to
+      // call `onBreak` handlers, because then it causes
+      // `NetworkController:rpcEndpointUnavailable` and
+      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we
+      // have to ignore that object here. The consequence is that `isolate`
+      // doesn't function the way it is intended, at least in the context of an
+      // RpcService. However, we are making a bet that we won't need to use it
+      // other than how we are already using it.
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (!('isolated' in data)) {</span>
+<span class="cstat-no" title="statement not covered" >        listener({ ...data, endpointUrl: this.endpointUrl.toString() });</span>
+      }
+    });
+  }
+&nbsp;
+  /**
+   * Listens for when the policy underlying this RPC service detects a slow
+   * request.
+   *
+   * @param listener - The callback to be called when the request is slow.
+   * @returns What {@link ServicePolicy.onDegraded} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onDegraded(</span>
+    listener: Parameters&lt;AbstractRpcService['onDegraded']&gt;[0],
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });</span>
+    });
+  }
+&nbsp;
+  /**
+   * Listens for when the policy underlying this RPC service is available.
+   *
+   * @param listener - The callback to be called when the request is available.
+   * @returns What {@link ServicePolicy.onAvailable} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onAvailable(</span>
+    listener: Parameters&lt;AbstractRpcService['onAvailable']&gt;[0],
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onAvailable(<span class="fstat-no" title="function not covered" >() =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      listener({ endpointUrl: this.endpointUrl.toString() });</span>
+    });
+  }
+&nbsp;
+  /**
+   * Makes a request to the RPC endpoint.
+   *
+   * This overload is specifically designed for `eth_getBlockByNumber`, which
+   * can return a `result` of `null` despite an expected `Result` being
+   * provided.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: JsonRpcRequest&lt;Params&gt; &amp; { method: 'eth_getBlockByNumber' },
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt; | JsonRpcResponse&lt;null&gt;&gt;;
+&nbsp;
+  /**
+   * Makes a request to the RPC endpoint.
+   *
+   * This overload is designed for all RPC methods except for
+   * `eth_getBlockByNumber`, which are expected to return a `result` of the
+   * expected `Result`.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: JsonRpcRequest&lt;Params&gt;,
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt;&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  async </span>request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    // The request object may be frozen and must not be mutated.
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions: FetchOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;JsonRpcResponse&lt;Result | null&gt;&gt; {
+    const completeFetchOptions = <span class="cstat-no" title="statement not covered" >this.#getCompleteFetchOptions(</span>
+      jsonRpcRequest,
+      fetchOptions,
+    );
+<span class="cstat-no" title="statement not covered" >    return await this.#executeAndProcessRequest&lt;Result&gt;(completeFetchOptions);</span>
+  }
+&nbsp;
+  /**
+   * Constructs a default set of options to `fetch`.
+   *
+   * If a username and password are present in the URL, they are extracted to an
+   * Authorization header.
+   *
+   * @param endpointUrl - The endpoint URL.
+   * @param fetchOptions - The options to `fetch`.
+   * @param givenBtoa - An implementation of `btoa`.
+   * @returns The default fetch options.
+   */
+  #getDefaultFetchOptions(
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >    endpointUrl: URL,</span></span>
+    fetchOptions: FetchOptions,
+    givenBtoa: (stringToEncode: string) =&gt; string,
+  ): FetchOptions {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (endpointUrl.username &amp;&amp; endpointUrl.password) {</span>
+      const authString = <span class="cstat-no" title="statement not covered" >`${endpointUrl.username}:${endpointUrl.password}`;</span>
+      const encodedCredentials = <span class="cstat-no" title="statement not covered" >givenBtoa(authString);</span>
+<span class="cstat-no" title="statement not covered" >      return deepmerge(fetchOptions, {</span>
+        headers: { Authorization: `Basic ${encodedCredentials}` },
+      });
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return fetchOptions;</span>
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Constructs a final set of options to pass to `fetch`. Note that the method
+   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request.
+   * @param fetchOptions - Custom `fetch` options.
+   * @returns The complete set of `fetch` options.
+   */
+  #getCompleteFetchOptions&lt;Params extends JsonRpcParams&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions: FetchOptions,
+  ): FetchOptions {
+    const defaultOptions = <span class="cstat-no" title="statement not covered" >{</span>
+      method: 'POST',
+      headers: {
+        Accept: 'application/json',
+        'Content-Type': 'application/json',
+      },
+    };
+    const mergedOptions = <span class="cstat-no" title="statement not covered" >deepmerge(</span>
+      defaultOptions,
+      deepmerge(this.#fetchOptions, fetchOptions),
+    );
+&nbsp;
+    const { id, jsonrpc, method, params } = <span class="cstat-no" title="statement not covered" >jsonRpcRequest;</span>
+    const body = <span class="cstat-no" title="statement not covered" >JSON.stringify({</span>
+      id,
+      jsonrpc,
+      method,
+      params,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { ...mergedOptions, body };</span>
+  }
+&nbsp;
+  /**
+   * Makes the request using the Cockatiel policy that this service creates.
+   *
+   * @param fetchOptions - The options for `fetch`; will be combined with the
+   * fetch options passed to the constructor
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async<span class="fstat-no" title="function not covered" > #executeAndProcessRequest&lt;Result extends Json&gt;(</span>
+    fetchOptions: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt; | JsonRpcResponse&lt;null&gt;&gt; {
+    let response: Response | undefined;
+<span class="cstat-no" title="statement not covered" >    try {</span>
+<span class="cstat-no" title="statement not covered" >      log(</span>
+        `[${this.endpointUrl}] Circuit state`,
+        this.#policy.getCircuitState(),
+      );
+      const jsonDecodedResponse = <span class="cstat-no" title="statement not covered" >await this.#policy.execute(</span>
+<span class="fstat-no" title="function not covered" >        async </span>(context) =&gt; {
+<span class="cstat-no" title="statement not covered" >          log(</span>
+            'REQUEST INITIATED:',
+            this.endpointUrl.toString(),
+            '::',
+            fetchOptions,
+            // @ts-expect-error This property _is_ here, the type of
+            // ServicePolicy is just wrong.
+            `(attempt ${context.attempt + 1})`,
+          );
+<span class="cstat-no" title="statement not covered" >          response = await this.#fetch(this.endpointUrl, fetchOptions);</span>
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (!response.ok) {</span>
+<span class="cstat-no" title="statement not covered" >            throw new HttpError(response.status);</span>
+          }
+<span class="cstat-no" title="statement not covered" >          log(</span>
+            'REQUEST SUCCESSFUL:',
+            this.endpointUrl.toString(),
+            response.status,
+          );
+<span class="cstat-no" title="statement not covered" >          return await response.json();</span>
+        },
+      );
+<span class="cstat-no" title="statement not covered" >      this.lastError = undefined;</span>
+<span class="cstat-no" title="statement not covered" >      return jsonDecodedResponse;</span>
+    } catch (error) {
+<span class="cstat-no" title="statement not covered" >      log('REQUEST ERROR:', this.endpointUrl.toString(), error);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      this.lastError =</span>
+        error instanceof Error ? error : new Error(getErrorMessage(error));
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      if (error instanceof HttpError) {</span>
+        const status = <span class="cstat-no" title="statement not covered" >error.httpStatus;</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (status === 401) {</span>
+<span class="cstat-no" title="statement not covered" >          throw new JsonRpcError(</span>
+            CUSTOM_RPC_ERRORS.unauthorized,
+            'Unauthorized.',
+            {
+              httpStatus: status,
+            },
+          );
+        }
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (status === 429) {</span>
+<span class="cstat-no" title="statement not covered" >          throw rpcErrors.limitExceeded({</span>
+            message: 'Request is being rate limited.',
+            data: {
+              httpStatus: status,
+            },
+          });
+        }
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (status &gt;= 500 || status === 402 || status === 404) {</span>
+<span class="cstat-no" title="statement not covered" >          throw rpcErrors.resourceUnavailable({</span>
+            message: 'RPC endpoint not found or unavailable.',
+            data: {
+              httpStatus: status,
+            },
+          });
+        }
+&nbsp;
+        // Handle all other 4xx errors as generic HTTP client errors
+<span class="cstat-no" title="statement not covered" >        throw new JsonRpcError(</span>
+          CUSTOM_RPC_ERRORS.httpClientError,
+          'RPC endpoint returned HTTP client error.',
+          {
+            httpStatus: status,
+          },
+        );
+      } else <span class="cstat-no" title="statement not covered" >if (isJsonParseError(error)) {</span>
+<span class="cstat-no" title="statement not covered" >        throw rpcErrors.parse({</span>
+          message: 'RPC endpoint did not return JSON.',
+        });
+      } else <span class="cstat-no" title="statement not covered" ><span class="missing-if-branch" title="if path not taken" >I</span>if (error instanceof BrokenCircuitError) {</span>
+<span class="cstat-no" title="statement not covered" >        this.#logger?.warn(error);</span>
+        const remainingCircuitOpenDuration =
+<span class="cstat-no" title="statement not covered" >          this.#policy.getRemainingCircuitOpenDuration();</span>
+        const formattedRemainingCircuitOpenDuration = <span class="cstat-no" title="statement not covered" >Intl.NumberFormat(</span>
+          undefined,
+          { maximumFractionDigits: 2 },
+        ).format(
+          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /
+            Duration.Minute,
+        );
+<span class="cstat-no" title="statement not covered" >        throw rpcErrors.resourceUnavailable({</span>
+          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,
+        });
+      }
+<span class="cstat-no" title="statement not covered" >      throw error;</span>
+    }
+  }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../../sorter.js"></script>
+        <script src="../../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/throttled-fetch.ts.html b/coverage/lcov-report/src/throttled-fetch.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..d08f910435bfa10b36e7111af62cfa8457a4fd84
--- /dev/null
+++ b/coverage/lcov-report/src/throttled-fetch.ts.html
@@ -0,0 +1,427 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/throttled-fetch.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> throttled-fetch.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">68.18% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>15/22</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">71.42% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>5/7</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">66.66% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/6</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">66.66% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>14/21</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line medium'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">5x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
+ * Configuration for network throttling by chain ID.
+ * Maps chain IDs (in hex format) to delay in milliseconds.
+ */
+export const NETWORK_THROTTLE_CONFIG: Record&lt;string, number&gt; = {
+  '0x2019': 2000, // Klaytn - 2s delay
+  '0x504': 1000, // Moonbeam - 1s delay
+  '0x505': 1000, // Moonriver - 1s delay
+  '0x4e454152': 1500, // Aurora - 1.5s delay
+};
+&nbsp;
+/**
+ * Creates a throttled fetch function that adds artificial delays before making requests.
+ * Useful for testing slow network conditions.
+ *
+ * @param delayMs - The delay in milliseconds to add before each request
+ * @param originalFetch - The original fetch function to wrap
+ * @returns A throttled fetch function
+ */
+export function createThrottledFetch(
+  delayMs: number,
+  originalFetch: typeof fetch,
+): typeof fetch {
+  if (delayMs &lt;= 0) {
+    return originalFetch;
+  }
+&nbsp;
+  return async (
+    input: RequestInfo | URL,
+    init?: RequestInit,
+  ): Promise&lt;Response&gt; =&gt; {
+    // Add artificial delay before making the request
+    await new Promise((resolve) =&gt; setTimeout(resolve, delayMs));
+    return originalFetch(input, init);
+  };
+}
+&nbsp;
+/**
+ * Creates a fetch function that applies throttling based on the chain ID.
+ * Extracts chain ID from the RPC endpoint URL to determine the appropriate delay.
+ *
+ * @param rpcEndpointUrl - The RPC endpoint URL (may contain chain ID context)
+ * @param chainId - The chain ID in hex format (e.g., '0x2019')
+ * @param originalFetch - The original fetch function to wrap
+ * @param throttleConfig - Optional custom throttle configuration map
+ * @returns A throttled fetch function if configured for this chain, otherwise the original
+ */
+export function createThrottledFetchForChainId(
+  rpcEndpointUrl: string,
+  chainId: string,
+  originalFetch: typeof fetch,
+  throttleConfig: Record&lt;string, number&gt; = NETWORK_THROTTLE_CONFIG,
+): typeof fetch {
+  const delayMs = throttleConfig[chainId] || 0;
+&nbsp;
+  if (delayMs === 0) {
+    return originalFetch;
+  }
+&nbsp;
+  console.log(
+    `[NetworkThrottle] Applying ${delayMs}ms delay to chain ${chainId} (${rpcEndpointUrl})`,
+  );
+&nbsp;
+  return createThrottledFetch(delayMs, originalFetch);
+}
+&nbsp;
+/**
+ * Creates a wrapped getRpcServiceOptions function that applies network throttling
+ * based on chain ID. This is meant to be used in NetworkController initialization.
+ *
+ * @param originalGetRpcServiceOptions - The original getRpcServiceOptions function
+ * @param getChainIdForUrl - Function to get the chain ID for a given RPC endpoint URL
+ * @param throttleConfig - Optional custom throttle configuration map
+ * @returns A wrapped getRpcServiceOptions function that applies throttling
+ *
+ * @example
+ * ```typescript
+ * const networkController = new NetworkController({
+ *   getRpcServiceOptions: createThrottledGetRpcServiceOptions(
+ *     (rpcEndpointUrl) =&gt; ({ fetch, btoa }),
+ *     (rpcEndpointUrl) =&gt; '0x1', // Get chainId from your config
+ *   ),
+ *   // ... other options
+ * });
+ * ```
+ */
+export function <span class="fstat-no" title="function not covered" >createThrottledGetRpcServiceOptions(</span>
+  originalGetRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; { fetch: typeof fetch; btoa: typeof btoa; [key: string]: unknown },
+  getChainIdForUrl: (rpcEndpointUrl: string) =&gt; string | undefined,
+  throttleConfig: Record&lt;string, number&gt; = <span class="branch-0 cbranch-no" title="branch not covered" >NETWORK_THROTTLE_CONFIG,</span>
+): typeof originalGetRpcServiceOptions {
+<span class="cstat-no" title="statement not covered" >  return <span class="fstat-no" title="function not covered" >(r</span>pcEndpointUrl: string) =&gt; {</span>
+    const options = <span class="cstat-no" title="statement not covered" >originalGetRpcServiceOptions(rpcEndpointUrl);</span>
+    const chainId = <span class="cstat-no" title="statement not covered" >getChainIdForUrl(rpcEndpointUrl);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!chainId) {</span>
+<span class="cstat-no" title="statement not covered" >      return options;</span>
+    }
+&nbsp;
+    const throttledFetch = <span class="cstat-no" title="statement not covered" >createThrottledFetchForChainId(</span>
+      rpcEndpointUrl,
+      chainId,
+      options.fetch,
+      throttleConfig,
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+      ...options,
+      fetch: throttledFetch,
+    };
+  };
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov-report/src/types.ts.html b/coverage/lcov-report/src/types.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..c1c9566c5e75b2461600861d3cbdfcc01959e469
--- /dev/null
+++ b/coverage/lcov-report/src/types.ts.html
@@ -0,0 +1,289 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/types.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> types.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/2</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/1</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type { InfuraNetworkType, ChainId } from '@metamask/controller-utils';
+import type { BlockTracker as BaseBlockTracker } from '@metamask/eth-block-tracker';
+import type { InternalProvider } from '@metamask/eth-json-rpc-provider';
+import type { MiddlewareContext } from '@metamask/json-rpc-engine/v2';
+import type { Hex } from '@metamask/utils';
+&nbsp;
+export type Provider = InternalProvider&lt;
+  MiddlewareContext&lt;
+    { origin: string; skipCache: boolean } &amp; Record&lt;string, unknown&gt;
+  &gt;
+&gt;;
+&nbsp;
+export type BlockTracker = BaseBlockTracker &amp; {
+  checkForLatestBlock(): Promise&lt;string&gt;;
+};
+&nbsp;
+/**
+ * The type of network client that can be created.
+ */
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export enum N</span>etworkClientType {</span>
+<span class="cstat-no" title="statement not covered" >  Custom = 'custom',</span>
+<span class="cstat-no" title="statement not covered" >  Infura = 'infura',</span>
+}
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for a network.
+ */
+type CommonNetworkClientConfiguration = {
+  chainId: Hex;
+  failoverRpcUrls?: string[];
+  ticker: string;
+};
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for a custom
+ * network.
+ */
+export type CustomNetworkClientConfiguration =
+  CommonNetworkClientConfiguration &amp; {
+    rpcUrl: string;
+    type: NetworkClientType.Custom;
+  };
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for an Infura
+ * network.
+ */
+export type InfuraNetworkClientConfiguration =
+  CommonNetworkClientConfiguration &amp; {
+    network: InfuraNetworkType;
+    infuraProjectId: string;
+    type: NetworkClientType.Infura;
+  };
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for a network.
+ */
+export type NetworkClientConfiguration =
+  | CustomNetworkClientConfiguration
+  | InfuraNetworkClientConfiguration;
+&nbsp;
+/**
+ * The Chain ID representing the additional networks to be included as default.
+ */
+export type AdditionalDefaultNetwork = (typeof ChainId)[
+  | 'megaeth-testnet'
+  | 'megaeth-testnet-v2'
+  | 'monad-testnet'];
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.420Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/lcov.info b/coverage/lcov.info
new file mode 100644
index 0000000000000000000000000000000000000000..9faeffeea34e439c22c613446b7aadf7be8efaf1
--- /dev/null
+++ b/coverage/lcov.info
@@ -0,0 +1,1637 @@
+TN:
+SF:src/NetworkController.ts
+FN:94,(anonymous_9)
+FN:297,knownKeysOf
+FN:314,isErrorWithCode
+FN:800,getDefaultNetworkConfigurationsByChainId
+FN:807,(anonymous_13)
+FN:823,getDefaultInfuraNetworkConfigurationsByChainId
+FN:829,(anonymous_15)
+FN:865,getDefaultCustomNetworkConfigurationsByChainId
+FN:935,getCustomNetworkConfiguration
+FN:966,getDefaultNetworkControllerState
+FN:987,(anonymous_19)
+FN:998,getNetworkConfigurations
+FN:1013,(anonymous_21)
+FN:1024,getAvailableNetworkClientIds
+FN:1027,(anonymous_23)
+FN:1029,(anonymous_24)
+FN:1145,isValidUrl
+FN:1161,deriveInfuraNetworkNameFromRpcEndpointUrl
+FN:1191,validateInitialState
+FN:1253,correctInitialState
+FN:1259,(anonymous_29)
+FN:1266,(anonymous_30)
+FN:1269,(anonymous_31)
+FN:1305,buildNetworkConfigurationsByNetworkClientId
+FN:1310,(anonymous_33)
+FN:1311,(anonymous_34)
+FN:1364,(anonymous_35)
+FN:1425,(anonymous_36)
+FN:1491,(anonymous_37)
+FN:1499,(anonymous_38)
+FN:1507,(anonymous_39)
+FN:1520,(anonymous_40)
+FN:1529,(anonymous_41)
+FN:1580,(anonymous_42)
+FN:1597,(anonymous_43)
+FN:1617,(anonymous_44)
+FN:1633,(anonymous_45)
+FN:1667,(anonymous_46)
+FN:1775,(anonymous_47)
+FN:1886,(anonymous_48)
+FN:2070,(anonymous_49)
+FN:2093,(anonymous_50)
+FN:2144,(anonymous_51)
+FN:2164,(anonymous_52)
+FN:2173,(anonymous_53)
+FN:2212,(anonymous_54)
+FN:2223,(anonymous_55)
+FN:2236,(anonymous_56)
+FN:2253,(anonymous_57)
+FN:2266,(anonymous_58)
+FN:2291,(anonymous_59)
+FN:2332,(anonymous_60)
+FN:2366,(anonymous_61)
+FN:2376,(anonymous_62)
+FN:2387,(anonymous_63)
+FN:2464,(anonymous_64)
+FN:2493,(anonymous_65)
+FN:2500,(anonymous_66)
+FN:2521,(anonymous_67)
+FN:2524,(anonymous_68)
+FN:2554,(anonymous_69)
+FN:2565,(anonymous_70)
+FN:2593,(anonymous_71)
+FN:2605,(anonymous_72)
+FN:2616,(anonymous_73)
+FN:2627,(anonymous_74)
+FN:2652,(anonymous_75)
+FN:2663,(anonymous_76)
+FN:2674,(anonymous_77)
+FN:2677,(anonymous_78)
+FN:2694,(anonymous_79)
+FN:1543,_NetworkController_updateRpcFailoverEnabled
+FN:1722,_NetworkController_refreshNetwork
+FN:1802,_NetworkController_determineNetworkMetadata
+FN:1927,_NetworkController_lookupGivenNetwork
+FN:1950,_NetworkController_lookupSelectedNetwork
+FN:1956,(anonymous_85)
+FN:2026,_NetworkController_updateMetadataForNetwork
+FN:2044,(anonymous_87)
+FN:2061,_NetworkController_getLatestBlock
+FN:2118,(anonymous_89)
+FN:2121,(anonymous_90)
+FN:2196,_NetworkController_determineEIP1559Compatibility
+FN:2206,_NetworkController_validateNetworkFields
+FN:2812,(anonymous_93)
+FN:2822,(anonymous_94)
+FN:2834,(anonymous_95)
+FN:2842,(anonymous_96)
+FN:2869,(anonymous_97)
+FN:2875,(anonymous_98)
+FN:2885,(anonymous_99)
+FN:2918,_NetworkController_determineNetworkConfigurationToPersist
+FN:2940,(anonymous_101)
+FN:2951,(anonymous_102)
+FN:2955,(anonymous_103)
+FN:2962,(anonymous_104)
+FN:2967,_NetworkController_registerNetworkClientsAsNeeded
+FN:2991,(anonymous_106)
+FN:2997,(anonymous_107)
+FN:3001,(anonymous_108)
+FN:3008,(anonymous_109)
+FN:3052,_NetworkController_unregisterNetworkClientsAsNeeded
+FN:3073,(anonymous_111)
+FN:3079,(anonymous_112)
+FN:3083,(anonymous_113)
+FN:3090,(anonymous_114)
+FN:3103,_NetworkController_updateNetworkConfigurations
+FN:3165,_NetworkController_ensureAutoManagedNetworkClientRegistryPopulated
+FN:3178,_NetworkController_createAutoManagedNetworkClientRegistry
+FN:3188,(anonymous_118)
+FN:3191,(anonymous_119)
+FN:3238,(anonymous_120)
+FN:3258,_NetworkController_applyNetworkSelection
+FN:3323,(anonymous_122)
+FNF:114
+FNH:0
+FNDA:0,(anonymous_9)
+FNDA:0,knownKeysOf
+FNDA:0,isErrorWithCode
+FNDA:0,getDefaultNetworkConfigurationsByChainId
+FNDA:0,(anonymous_13)
+FNDA:0,getDefaultInfuraNetworkConfigurationsByChainId
+FNDA:0,(anonymous_15)
+FNDA:0,getDefaultCustomNetworkConfigurationsByChainId
+FNDA:0,getCustomNetworkConfiguration
+FNDA:0,getDefaultNetworkControllerState
+FNDA:0,(anonymous_19)
+FNDA:0,getNetworkConfigurations
+FNDA:0,(anonymous_21)
+FNDA:0,getAvailableNetworkClientIds
+FNDA:0,(anonymous_23)
+FNDA:0,(anonymous_24)
+FNDA:0,isValidUrl
+FNDA:0,deriveInfuraNetworkNameFromRpcEndpointUrl
+FNDA:0,validateInitialState
+FNDA:0,correctInitialState
+FNDA:0,(anonymous_29)
+FNDA:0,(anonymous_30)
+FNDA:0,(anonymous_31)
+FNDA:0,buildNetworkConfigurationsByNetworkClientId
+FNDA:0,(anonymous_33)
+FNDA:0,(anonymous_34)
+FNDA:0,(anonymous_35)
+FNDA:0,(anonymous_36)
+FNDA:0,(anonymous_37)
+FNDA:0,(anonymous_38)
+FNDA:0,(anonymous_39)
+FNDA:0,(anonymous_40)
+FNDA:0,(anonymous_41)
+FNDA:0,(anonymous_42)
+FNDA:0,(anonymous_43)
+FNDA:0,(anonymous_44)
+FNDA:0,(anonymous_45)
+FNDA:0,(anonymous_46)
+FNDA:0,(anonymous_47)
+FNDA:0,(anonymous_48)
+FNDA:0,(anonymous_49)
+FNDA:0,(anonymous_50)
+FNDA:0,(anonymous_51)
+FNDA:0,(anonymous_52)
+FNDA:0,(anonymous_53)
+FNDA:0,(anonymous_54)
+FNDA:0,(anonymous_55)
+FNDA:0,(anonymous_56)
+FNDA:0,(anonymous_57)
+FNDA:0,(anonymous_58)
+FNDA:0,(anonymous_59)
+FNDA:0,(anonymous_60)
+FNDA:0,(anonymous_61)
+FNDA:0,(anonymous_62)
+FNDA:0,(anonymous_63)
+FNDA:0,(anonymous_64)
+FNDA:0,(anonymous_65)
+FNDA:0,(anonymous_66)
+FNDA:0,(anonymous_67)
+FNDA:0,(anonymous_68)
+FNDA:0,(anonymous_69)
+FNDA:0,(anonymous_70)
+FNDA:0,(anonymous_71)
+FNDA:0,(anonymous_72)
+FNDA:0,(anonymous_73)
+FNDA:0,(anonymous_74)
+FNDA:0,(anonymous_75)
+FNDA:0,(anonymous_76)
+FNDA:0,(anonymous_77)
+FNDA:0,(anonymous_78)
+FNDA:0,(anonymous_79)
+FNDA:0,_NetworkController_updateRpcFailoverEnabled
+FNDA:0,_NetworkController_refreshNetwork
+FNDA:0,_NetworkController_determineNetworkMetadata
+FNDA:0,_NetworkController_lookupGivenNetwork
+FNDA:0,_NetworkController_lookupSelectedNetwork
+FNDA:0,(anonymous_85)
+FNDA:0,_NetworkController_updateMetadataForNetwork
+FNDA:0,(anonymous_87)
+FNDA:0,_NetworkController_getLatestBlock
+FNDA:0,(anonymous_89)
+FNDA:0,(anonymous_90)
+FNDA:0,_NetworkController_determineEIP1559Compatibility
+FNDA:0,_NetworkController_validateNetworkFields
+FNDA:0,(anonymous_93)
+FNDA:0,(anonymous_94)
+FNDA:0,(anonymous_95)
+FNDA:0,(anonymous_96)
+FNDA:0,(anonymous_97)
+FNDA:0,(anonymous_98)
+FNDA:0,(anonymous_99)
+FNDA:0,_NetworkController_determineNetworkConfigurationToPersist
+FNDA:0,(anonymous_101)
+FNDA:0,(anonymous_102)
+FNDA:0,(anonymous_103)
+FNDA:0,(anonymous_104)
+FNDA:0,_NetworkController_registerNetworkClientsAsNeeded
+FNDA:0,(anonymous_106)
+FNDA:0,(anonymous_107)
+FNDA:0,(anonymous_108)
+FNDA:0,(anonymous_109)
+FNDA:0,_NetworkController_unregisterNetworkClientsAsNeeded
+FNDA:0,(anonymous_111)
+FNDA:0,(anonymous_112)
+FNDA:0,(anonymous_113)
+FNDA:0,(anonymous_114)
+FNDA:0,_NetworkController_updateNetworkConfigurations
+FNDA:0,_NetworkController_ensureAutoManagedNetworkClientRegistryPopulated
+FNDA:0,_NetworkController_createAutoManagedNetworkClientRegistry
+FNDA:0,(anonymous_118)
+FNDA:0,(anonymous_119)
+FNDA:0,(anonymous_120)
+FNDA:0,_NetworkController_applyNetworkSelection
+FNDA:0,(anonymous_122)
+DA:5,0
+DA:7,0
+DA:21,0
+DA:23,0
+DA:24,0
+DA:30,0
+DA:31,0
+DA:33,0
+DA:34,0
+DA:36,0
+DA:37,0
+DA:38,0
+DA:40,0
+DA:49,0
+DA:50,0
+DA:52,0
+DA:62,0
+DA:65,0
+DA:94,0
+DA:95,0
+DA:96,0
+DA:297,0
+DA:302,0
+DA:315,0
+DA:362,0
+DA:803,0
+DA:804,0
+DA:806,0
+DA:808,0
+DA:809,0
+DA:811,0
+DA:827,0
+DA:830,0
+DA:833,0
+DA:834,0
+DA:838,0
+DA:840,0
+DA:856,0
+DA:872,0
+DA:916,0
+DA:921,0
+DA:926,0
+DA:938,0
+DA:939,0
+DA:941,0
+DA:966,0
+DA:969,0
+DA:971,0
+DA:973,0
+DA:987,0
+DA:990,0
+DA:998,0
+DA:1001,0
+DA:1011,0
+DA:1014,0
+DA:1024,0
+DA:1027,0
+DA:1028,0
+DA:1029,0
+DA:1041,0
+DA:1146,0
+DA:1147,0
+DA:1164,0
+DA:1166,0
+DA:1167,0
+DA:1168,0
+DA:1171,0
+DA:1174,0
+DA:1192,0
+DA:1195,0
+DA:1199,0
+DA:1200,0
+DA:1205,0
+DA:1206,0
+DA:1207,0
+DA:1213,0
+DA:1220,0
+DA:1221,0
+DA:1226,0
+DA:1231,0
+DA:1237,0
+DA:1238,0
+DA:1257,0
+DA:1259,0
+DA:1260,0
+DA:1263,0
+DA:1266,0
+DA:1269,0
+DA:1270,0
+DA:1271,0
+DA:1273,0
+DA:1276,0
+DA:1281,0
+DA:1284,0
+DA:1285,0
+DA:1286,0
+DA:1288,0
+DA:1308,0
+DA:1311,0
+DA:1312,0
+DA:1322,0
+DA:1327,0
+DA:1329,0
+DA:1331,0
+DA:1333,0
+DA:1335,0
+DA:1337,0
+DA:1339,0
+DA:1343,0
+DA:1345,0
+DA:1347,0
+DA:1349,0
+DA:1354,0
+DA:1374,0
+DA:1375,0
+DA:1379,0
+DA:1380,0
+DA:1382,0
+DA:1383,0
+DA:1386,0
+DA:1412,0
+DA:1413,0
+DA:1414,0
+DA:1415,0
+DA:1416,0
+DA:1418,0
+DA:1420,0
+DA:1425,0
+DA:1426,0
+DA:1429,0
+DA:1434,0
+DA:1439,0
+DA:1444,0
+DA:1449,0
+DA:1454,0
+DA:1459,0
+DA:1464,0
+DA:1469,0
+DA:1474,0
+DA:1479,0
+DA:1484,0
+DA:1489,0
+DA:1492,0
+DA:1497,0
+DA:1500,0
+DA:1505,0
+DA:1508,0
+DA:1521,0
+DA:1530,0
+DA:1543,0
+DA:1544,0
+DA:1545,0
+DA:1549,0
+DA:1551,0
+DA:1554,0
+DA:1557,0
+DA:1560,0
+DA:1564,0
+DA:1571,0
+DA:1586,0
+DA:1603,0
+DA:1604,0
+DA:1609,0
+DA:1618,0
+DA:1621,0
+DA:1636,0
+DA:1638,0
+DA:1670,0
+DA:1671,0
+DA:1675,0
+DA:1677,0
+DA:1679,0
+DA:1684,0
+DA:1689,0
+DA:1693,0
+DA:1696,0
+DA:1697,0
+DA:1701,0
+DA:1728,0
+DA:1729,0
+DA:1730,0
+DA:1731,0
+DA:1780,0
+DA:1782,0
+DA:1783,0
+DA:1786,0
+DA:1812,0
+DA:1817,0
+DA:1821,0
+DA:1822,0
+DA:1824,0
+DA:1826,0
+DA:1828,0
+DA:1830,0
+DA:1835,0
+DA:1836,0
+DA:1839,0
+DA:1846,0
+DA:1850,0
+DA:1851,0
+DA:1852,0
+DA:1853,0
+DA:1858,0
+DA:1859,0
+DA:1862,0
+DA:1866,0
+DA:1867,0
+DA:1871,0
+DA:1887,0
+DA:1888,0
+DA:1890,0
+DA:1929,0
+DA:1931,0
+DA:1951,0
+DA:1952,0
+DA:1955,0
+DA:1956,0
+DA:1957,0
+DA:1958,0
+DA:1959,0
+DA:1983,0
+DA:1986,0
+DA:1988,0
+DA:1991,0
+DA:1994,0
+DA:1995,0
+DA:2000,0
+DA:2005,0
+DA:2009,0
+DA:2014,0
+DA:2015,0
+DA:2016,0
+DA:2017,0
+DA:2018,0
+DA:2024,0
+DA:2044,0
+DA:2045,0
+DA:2050,0
+DA:2051,0
+DA:2053,0
+DA:2054,0
+DA:2055,0
+DA:2057,0
+DA:2071,0
+DA:2072,0
+DA:2076,0
+DA:2077,0
+DA:2080,0
+DA:2099,0
+DA:2102,0
+DA:2115,0
+DA:2116,0
+DA:2118,0
+DA:2119,0
+DA:2122,0
+DA:2125,0
+DA:2128,0
+DA:2147,0
+DA:2148,0
+DA:2150,0
+DA:2151,0
+DA:2155,0
+DA:2157,0
+DA:2158,0
+DA:2161,0
+DA:2164,0
+DA:2165,0
+DA:2166,0
+DA:2170,0
+DA:2176,0
+DA:2177,0
+DA:2178,0
+DA:2179,0
+DA:2181,0
+DA:2184,0
+DA:2199,0
+DA:2201,0
+DA:2202,0
+DA:2205,0
+DA:2213,0
+DA:2226,0
+DA:2239,0
+DA:2254,0
+DA:2257,0
+DA:2259,0
+DA:2265,0
+DA:2268,0
+DA:2274,0
+DA:2282,0
+DA:2286,0
+DA:2291,0
+DA:2292,0
+DA:2300,0
+DA:2305,0
+DA:2340,0
+DA:2342,0
+DA:2343,0
+DA:2348,0
+DA:2350,0
+DA:2353,0
+DA:2355,0
+DA:2362,0
+DA:2364,0
+DA:2366,0
+DA:2367,0
+DA:2376,0
+DA:2377,0
+DA:2387,0
+DA:2388,0
+DA:2396,0
+DA:2401,0
+DA:2405,0
+DA:2410,0
+DA:2412,0
+DA:2413,0
+DA:2417,0
+DA:2421,0
+DA:2425,0
+DA:2429,0
+DA:2432,0
+DA:2436,0
+DA:2440,0
+DA:2448,0
+DA:2454,0
+DA:2462,0
+DA:2463,0
+DA:2466,0
+DA:2469,0
+DA:2477,0
+DA:2481,0
+DA:2486,0
+DA:2491,0
+DA:2494,0
+DA:2501,0
+DA:2508,0
+DA:2513,0
+DA:2519,0
+DA:2522,0
+DA:2525,0
+DA:2532,0
+DA:2536,0
+DA:2537,0
+DA:2542,0
+DA:2543,0
+DA:2549,0
+DA:2553,0
+DA:2555,0
+DA:2565,0
+DA:2566,0
+DA:2576,0
+DA:2581,0
+DA:2595,0
+DA:2597,0
+DA:2598,0
+DA:2603,0
+DA:2606,0
+DA:2609,0
+DA:2613,0
+DA:2616,0
+DA:2617,0
+DA:2623,0
+DA:2627,0
+DA:2628,0
+DA:2634,0
+DA:2635,0
+DA:2639,0
+DA:2653,0
+DA:2664,0
+DA:2677,0
+DA:2678,0
+DA:2696,0
+DA:2698,0
+DA:2699,0
+DA:2703,0
+DA:2706,0
+DA:2730,0
+DA:2732,0
+DA:2737,0
+DA:2739,0
+DA:2743,0
+DA:2748,0
+DA:2753,0
+DA:2754,0
+DA:2755,0
+DA:2756,0
+DA:2760,0
+DA:2768,0
+DA:2775,0
+DA:2776,0
+DA:2781,0
+DA:2782,0
+DA:2786,0
+DA:2787,0
+DA:2788,0
+DA:2793,0
+DA:2797,0
+DA:2802,0
+DA:2807,0
+DA:2812,0
+DA:2815,0
+DA:2820,0
+DA:2823,0
+DA:2827,0
+DA:2832,0
+DA:2835,0
+DA:2840,0
+DA:2841,0
+DA:2843,0
+DA:2845,0
+DA:2846,0
+DA:2847,0
+DA:2851,0
+DA:2859,0
+DA:2863,0
+DA:2868,0
+DA:2870,0
+DA:2876,0
+DA:2878,0
+DA:2879,0
+DA:2884,0
+DA:2886,0
+DA:2888,0
+DA:2889,0
+DA:2894,0
+DA:2895,0
+DA:2896,0
+DA:2899,0
+DA:2900,0
+DA:2901,0
+DA:2902,0
+DA:2910,0
+DA:2914,0
+DA:2938,0
+DA:2945,0
+DA:2951,0
+DA:2958,0
+DA:2962,0
+DA:2966,0
+DA:2989,0
+DA:2994,0
+DA:2997,0
+DA:3004,0
+DA:3008,0
+DA:3012,0
+DA:3013,0
+DA:3014,0
+DA:3033,0
+DA:3071,0
+DA:3076,0
+DA:3079,0
+DA:3086,0
+DA:3090,0
+DA:3094,0
+DA:3095,0
+DA:3098,0
+DA:3099,0
+DA:3135,0
+DA:3137,0
+DA:3143,0
+DA:3148,0
+DA:3149,0
+DA:3155,0
+DA:3157,0
+DA:3161,0
+DA:3176,0
+DA:3187,0
+DA:3188,0
+DA:3190,0
+DA:3191,0
+DA:3192,0
+DA:3193,0
+DA:3196,0
+DA:3216,0
+DA:3237,0
+DA:3245,0
+DA:3287,0
+DA:3293,0
+DA:3295,0
+DA:3301,0
+DA:3307,0
+DA:3310,0
+DA:3314,0
+DA:3315,0
+DA:3318,0
+DA:3321,0
+DA:3323,0
+DA:3324,0
+DA:3325,0
+DA:3330,0
+DA:3333,0
+DA:3334,0
+DA:3336,0
+DA:3341,0
+DA:3342,0
+DA:3346,0
+DA:3354,0
+LF:496
+LH:0
+BRDA:94,0,0,0
+BRDA:94,0,1,0
+BRDA:315,1,0,0
+BRDA:315,1,1,0
+BRDA:315,1,2,0
+BRDA:801,2,0,0
+BRDA:808,3,0,0
+BRDA:833,4,0,0
+BRDA:1148,5,0,0
+BRDA:1148,5,1,0
+BRDA:1148,5,2,0
+BRDA:1166,6,0,0
+BRDA:1167,7,0,0
+BRDA:1199,8,0,0
+BRDA:1206,9,0,0
+BRDA:1213,10,0,0
+BRDA:1213,10,1,0
+BRDA:1214,11,0,0
+BRDA:1214,11,1,0
+BRDA:1220,12,0,0
+BRDA:1226,13,0,0
+BRDA:1237,14,0,0
+BRDA:1270,15,0,0
+BRDA:1284,16,0,0
+BRDA:1373,17,0,0
+BRDA:1382,18,0,0
+BRDA:1382,19,0,0
+BRDA:1382,19,1,0
+BRDA:1603,20,0,0
+BRDA:1603,21,0,0
+BRDA:1603,21,1,0
+BRDA:1670,22,0,0
+BRDA:1677,23,0,0
+BRDA:1696,24,0,0
+BRDA:1775,25,0,0
+BRDA:1776,26,0,0
+BRDA:1782,27,0,0
+BRDA:1887,28,0,0
+BRDA:1887,28,1,0
+BRDA:2071,29,0,0
+BRDA:2076,30,0,0
+BRDA:2095,31,0,0
+BRDA:2147,32,0,0
+BRDA:2150,33,0,0
+BRDA:2157,34,0,0
+BRDA:2165,35,0,0
+BRDA:2177,36,0,0
+BRDA:2268,37,0,0
+BRDA:2268,37,1,0
+BRDA:2335,38,0,0
+BRDA:2342,39,0,0
+BRDA:2368,40,0,0
+BRDA:2368,40,1,0
+BRDA:2368,40,2,0
+BRDA:2368,40,3,0
+BRDA:2378,41,0,0
+BRDA:2378,41,1,0
+BRDA:2378,41,2,0
+BRDA:2378,41,3,0
+BRDA:2378,41,4,0
+BRDA:2389,42,0,0
+BRDA:2389,42,1,0
+BRDA:2389,42,2,0
+BRDA:2396,43,0,0
+BRDA:2396,43,1,0
+BRDA:2397,44,0,0
+BRDA:2397,44,1,0
+BRDA:2401,45,0,0
+BRDA:2401,45,1,0
+BRDA:2410,46,0,0
+BRDA:2410,46,1,0
+BRDA:2412,47,0,0
+BRDA:2412,47,1,0
+BRDA:2425,48,0,0
+BRDA:2425,48,1,0
+BRDA:2429,49,0,0
+BRDA:2429,49,1,0
+BRDA:2440,50,0,0
+BRDA:2463,51,0,0
+BRDA:2466,52,0,0
+BRDA:2466,52,1,0
+BRDA:2470,53,0,0
+BRDA:2470,53,1,0
+BRDA:2470,53,2,0
+BRDA:2491,54,0,0
+BRDA:2492,55,0,0
+BRDA:2492,55,1,0
+BRDA:2492,55,2,0
+BRDA:2495,56,0,0
+BRDA:2495,56,1,0
+BRDA:2502,57,0,0
+BRDA:2502,57,1,0
+BRDA:2526,58,0,0
+BRDA:2526,58,1,0
+BRDA:2532,59,0,0
+BRDA:2532,59,1,0
+BRDA:2536,60,0,0
+BRDA:2542,61,0,0
+BRDA:2549,62,0,0
+BRDA:2549,62,1,0
+BRDA:2550,63,0,0
+BRDA:2550,63,1,0
+BRDA:2597,64,0,0
+BRDA:2603,65,0,0
+BRDA:2698,66,0,0
+BRDA:1544,67,0,0
+BRDA:1560,68,0,0
+BRDA:1561,69,0,0
+BRDA:1561,69,1,0
+BRDA:1564,70,0,0
+BRDA:1564,70,1,0
+BRDA:1724,71,0,0
+BRDA:1812,72,0,0
+BRDA:1812,72,1,0
+BRDA:1828,73,0,0
+BRDA:1828,73,1,0
+BRDA:1830,74,0,0
+BRDA:1831,75,0,0
+BRDA:1831,75,1,0
+BRDA:1831,75,2,0
+BRDA:1846,76,0,0
+BRDA:1846,76,1,0
+BRDA:1847,77,0,0
+BRDA:1847,77,1,0
+BRDA:1851,78,0,0
+BRDA:1851,78,1,0
+BRDA:1951,79,0,0
+BRDA:1988,80,0,0
+BRDA:2000,81,0,0
+BRDA:2001,82,0,0
+BRDA:2001,82,1,0
+BRDA:2014,83,0,0
+BRDA:2014,83,1,0
+BRDA:2015,84,0,0
+BRDA:2015,84,1,0
+BRDA:2017,85,0,0
+BRDA:2045,86,0,0
+BRDA:2045,86,1,0
+BRDA:2053,87,0,0
+BRDA:2054,88,0,0
+BRDA:2054,88,1,0
+BRDA:2113,89,0,0
+BRDA:2122,90,0,0
+BRDA:2122,90,1,0
+BRDA:2201,91,0,0
+BRDA:2732,92,0,0
+BRDA:2732,92,1,0
+BRDA:2737,93,0,0
+BRDA:2737,93,1,0
+BRDA:2739,94,0,0
+BRDA:2740,95,0,0
+BRDA:2740,95,1,0
+BRDA:2748,96,0,0
+BRDA:2749,97,0,0
+BRDA:2749,97,1,0
+BRDA:2754,98,0,0
+BRDA:2755,99,0,0
+BRDA:2755,99,1,0
+BRDA:2768,100,0,0
+BRDA:2768,100,1,0
+BRDA:2769,101,0,0
+BRDA:2769,101,1,0
+BRDA:2775,102,0,0
+BRDA:2781,103,0,0
+BRDA:2787,104,0,0
+BRDA:2793,105,0,0
+BRDA:2793,105,1,0
+BRDA:2797,106,0,0
+BRDA:2798,107,0,0
+BRDA:2798,107,1,0
+BRDA:2798,107,2,0
+BRDA:2807,108,0,0
+BRDA:2808,109,0,0
+BRDA:2808,109,1,0
+BRDA:2808,109,2,0
+BRDA:2808,109,3,0
+BRDA:2820,110,0,0
+BRDA:2823,111,0,0
+BRDA:2823,111,1,0
+BRDA:2835,112,0,0
+BRDA:2835,112,1,0
+BRDA:2845,113,0,0
+BRDA:2846,114,0,0
+BRDA:2846,114,1,0
+BRDA:2859,115,0,0
+BRDA:2870,116,0,0
+BRDA:2870,116,1,0
+BRDA:2878,117,0,0
+BRDA:2888,118,0,0
+BRDA:2895,119,0,0
+BRDA:2901,120,0,0
+BRDA:2903,121,0,0
+BRDA:2903,121,1,0
+BRDA:2910,122,0,0
+BRDA:2946,123,0,0
+BRDA:2946,123,1,0
+BRDA:3013,124,0,0
+BRDA:3013,124,1,0
+BRDA:3137,125,0,0
+BRDA:3138,126,0,0
+BRDA:3138,126,1,0
+BRDA:3138,126,2,0
+BRDA:3148,127,0,0
+BRDA:3148,128,0,0
+BRDA:3148,128,1,0
+BRDA:3149,129,0,0
+BRDA:3176,130,0,0
+BRDA:3176,130,1,0
+BRDA:3192,131,0,0
+BRDA:3280,132,0,0
+BRDA:3293,133,0,0
+BRDA:3293,133,1,0
+BRDA:3314,134,0,0
+BRDA:3325,135,0,0
+BRDA:3325,135,1,0
+BRDA:3333,136,0,0
+BRDA:3333,136,1,0
+BRDA:3341,137,0,0
+BRDA:3341,137,1,0
+BRF:219
+BRH:0
+end_of_record
+TN:
+SF:src/constants.ts
+FN:8,(anonymous_0)
+FNF:1
+FNH:0
+FNDA:0,(anonymous_0)
+DA:8,0
+DA:13,0
+DA:17,0
+DA:23,0
+DA:28,0
+DA:33,0
+DA:36,0
+DA:43,0
+LF:8
+LH:0
+BRDA:8,0,0,0
+BRDA:8,0,1,0
+BRF:2
+BRH:0
+end_of_record
+TN:
+SF:src/create-auto-managed-network-client.ts
+FN:87,createAutoManagedNetworkClient
+FN:93,(anonymous_1)
+FN:116,(anonymous_2)
+FN:137,(anonymous_3)
+FN:159,(anonymous_4)
+FN:174,(anonymous_5)
+FN:186,(anonymous_6)
+FN:208,(anonymous_7)
+FN:223,(anonymous_8)
+FN:233,(anonymous_9)
+FN:237,(anonymous_10)
+FN:243,(anonymous_11)
+FNF:12
+FNH:0
+FNDA:0,createAutoManagedNetworkClient
+FNDA:0,(anonymous_1)
+FNDA:0,(anonymous_2)
+FNDA:0,(anonymous_3)
+FNDA:0,(anonymous_4)
+FNDA:0,(anonymous_5)
+FNDA:0,(anonymous_6)
+FNDA:0,(anonymous_7)
+FNDA:0,(anonymous_8)
+FNDA:0,(anonymous_9)
+FNDA:0,(anonymous_10)
+FNDA:0,(anonymous_11)
+DA:6,0
+DA:23,0
+DA:59,0
+DA:87,0
+DA:96,0
+DA:113,0
+DA:116,0
+DA:117,0
+DA:127,0
+DA:128,0
+DA:133,0
+DA:136,0
+DA:145,0
+DA:146,0
+DA:149,0
+DA:151,0
+DA:154,0
+DA:155,0
+DA:159,0
+DA:163,0
+DA:166,0
+DA:169,0
+DA:175,0
+DA:176,0
+DA:178,0
+DA:179,0
+DA:183,0
+DA:194,0
+DA:195,0
+DA:198,0
+DA:200,0
+DA:203,0
+DA:204,0
+DA:208,0
+DA:212,0
+DA:215,0
+DA:218,0
+DA:224,0
+DA:225,0
+DA:227,0
+DA:228,0
+DA:233,0
+DA:234,0
+DA:237,0
+DA:238,0
+DA:239,0
+DA:240,0
+DA:243,0
+DA:244,0
+DA:245,0
+DA:246,0
+DA:249,0
+LF:52
+LH:0
+BRDA:93,0,0,0
+BRDA:117,1,0,0
+BRDA:117,1,1,0
+BRDA:127,2,0,0
+BRDA:145,3,0,0
+BRDA:151,4,0,0
+BRDA:155,5,0,0
+BRDA:163,6,0,0
+BRDA:163,6,1,0
+BRDA:175,7,0,0
+BRDA:194,8,0,0
+BRDA:200,9,0,0
+BRDA:204,10,0,0
+BRDA:212,11,0,0
+BRDA:212,11,1,0
+BRDA:224,12,0,0
+BRF:16
+BRH:0
+end_of_record
+TN:
+SF:src/create-network-client.ts
+FN:87,createNetworkClient
+FN:165,(anonymous_1)
+FN:194,createRpcServiceChain
+FN:216,(anonymous_3)
+FN:251,(anonymous_4)
+FN:267,(anonymous_5)
+FN:284,(anonymous_6)
+FN:307,(anonymous_7)
+FN:317,(anonymous_8)
+FN:333,(anonymous_9)
+FN:341,(anonymous_10)
+FN:371,createBlockTracker
+FN:408,createInfuraNetworkMiddleware
+FN:443,createNetworkAndChainIdMiddleware
+FN:453,(anonymous_14)
+FN:456,(anonymous_15)
+FN:473,createCustomNetworkMiddleware
+FN:511,createEstimateGasDelayTestMiddleware
+FN:515,(anonymous_18)
+FN:517,(anonymous_19)
+FNF:20
+FNH:0
+FNDA:0,createNetworkClient
+FNDA:0,(anonymous_1)
+FNDA:0,createRpcServiceChain
+FNDA:0,(anonymous_3)
+FNDA:0,(anonymous_4)
+FNDA:0,(anonymous_5)
+FNDA:0,(anonymous_6)
+FNDA:0,(anonymous_7)
+FNDA:0,(anonymous_8)
+FNDA:0,(anonymous_9)
+FNDA:0,(anonymous_10)
+FNDA:0,createBlockTracker
+FNDA:0,createInfuraNetworkMiddleware
+FNDA:0,createNetworkAndChainIdMiddleware
+FNDA:0,(anonymous_14)
+FNDA:0,(anonymous_15)
+FNDA:0,createCustomNetworkMiddleware
+FNDA:0,createEstimateGasDelayTestMiddleware
+FNDA:0,(anonymous_18)
+FNDA:0,(anonymous_19)
+DA:5,0
+DA:7,0
+DA:10,0
+DA:11,0
+DA:12,0
+DA:21,0
+DA:22,0
+DA:23,0
+DA:24,0
+DA:40,0
+DA:46,0
+DA:48,0
+DA:87,0
+DA:109,0
+DA:112,0
+DA:123,0
+DA:124,0
+DA:133,0
+DA:136,0
+DA:138,0
+DA:146,0
+DA:159,0
+DA:165,0
+DA:168,0
+DA:171,0
+DA:213,0
+DA:216,0
+DA:217,0
+DA:220,0
+DA:226,0
+DA:251,0
+DA:254,0
+DA:255,0
+DA:256,0
+DA:257,0
+DA:259,0
+DA:262,0
+DA:267,0
+DA:268,0
+DA:270,0
+DA:273,0
+DA:276,0
+DA:283,0
+DA:289,0
+DA:291,0
+DA:294,0
+DA:297,0
+DA:307,0
+DA:308,0
+DA:309,0
+DA:316,0
+DA:322,0
+DA:323,0
+DA:333,0
+DA:334,0
+DA:340,0
+DA:346,0
+DA:356,0
+DA:387,0
+DA:391,0
+DA:423,0
+DA:448,0
+DA:453,0
+DA:456,0
+DA:457,0
+DA:458,0
+DA:460,0
+DA:488,0
+DA:492,0
+DA:515,0
+DA:516,0
+DA:517,0
+DA:519,0
+LF:73
+LH:0
+BRDA:109,0,0,0
+BRDA:109,0,1,0
+BRDA:123,1,0,0
+BRDA:123,1,1,0
+BRDA:146,2,0,0
+BRDA:146,2,1,0
+BRDA:213,3,0,0
+BRDA:213,3,1,0
+BRDA:214,4,0,0
+BRDA:214,4,1,0
+BRDA:254,5,0,0
+BRDA:254,5,1,0
+BRDA:256,6,0,0
+BRDA:270,7,0,0
+BRDA:291,8,0,0
+BRDA:387,9,0,0
+BRDA:387,9,1,0
+BRDA:387,10,0,0
+BRDA:387,10,1,0
+BRDA:457,11,0,0
+BRDA:488,12,0,0
+BRDA:488,12,1,0
+BRDA:516,13,0,0
+BRF:23
+BRH:0
+end_of_record
+TN:
+SF:src/logger.ts
+FN:5,(anonymous_0)
+FNF:1
+FNH:0
+FNDA:0,(anonymous_0)
+DA:1,0
+DA:3,0
+DA:5,0
+LF:3
+LH:0
+BRF:0
+BRH:0
+end_of_record
+TN:
+SF:src/throttled-fetch.ts
+FN:20,createThrottledFetch
+FN:28,(anonymous_1)
+FN:33,(anonymous_2)
+FN:48,createThrottledFetchForChainId
+FN:87,createThrottledGetRpcServiceOptions
+FN:94,(anonymous_5)
+FNF:6
+FNH:4
+FNDA:5,createThrottledFetch
+FNDA:4,(anonymous_1)
+FNDA:4,(anonymous_2)
+FNDA:3,createThrottledFetchForChainId
+FNDA:0,createThrottledGetRpcServiceOptions
+FNDA:0,(anonymous_5)
+DA:5,1
+DA:20,1
+DA:24,5
+DA:25,1
+DA:28,4
+DA:33,4
+DA:34,4
+DA:48,1
+DA:54,3
+DA:56,3
+DA:57,1
+DA:60,2
+DA:64,2
+DA:87,1
+DA:94,0
+DA:95,0
+DA:96,0
+DA:98,0
+DA:99,0
+DA:102,0
+DA:109,0
+LF:21
+LH:14
+BRDA:24,0,0,1
+BRDA:52,1,0,1
+BRDA:54,2,0,3
+BRDA:54,2,1,1
+BRDA:56,3,0,1
+BRDA:92,4,0,0
+BRDA:98,5,0,0
+BRF:7
+BRH:5
+end_of_record
+TN:
+SF:src/types.ts
+FN:20,(anonymous_0)
+FNF:1
+FNH:0
+FNDA:0,(anonymous_0)
+DA:20,0
+DA:21,0
+DA:22,0
+LF:3
+LH:0
+BRDA:20,0,0,0
+BRDA:20,0,1,0
+BRF:2
+BRH:0
+end_of_record
+TN:
+SF:src/rpc-service/rpc-service-chain.ts
+FN:99,(anonymous_2)
+FN:103,(anonymous_3)
+FN:122,(anonymous_4)
+FN:139,(anonymous_5)
+FN:159,(anonymous_6)
+FN:165,(anonymous_7)
+FN:166,(anonymous_8)
+FN:175,(anonymous_9)
+FN:176,(anonymous_10)
+FN:195,(anonymous_11)
+FN:216,(anonymous_12)
+FN:222,(anonymous_13)
+FN:223,(anonymous_14)
+FN:232,(anonymous_15)
+FN:233,(anonymous_16)
+FN:261,(anonymous_17)
+FN:292,(anonymous_18)
+FN:298,(anonymous_19)
+FN:299,(anonymous_20)
+FN:308,(anonymous_21)
+FN:309,(anonymous_22)
+FN:330,(anonymous_23)
+FN:389,(anonymous_24)
+FNF:23
+FNH:0
+FNDA:0,(anonymous_2)
+FNDA:0,(anonymous_3)
+FNDA:0,(anonymous_4)
+FNDA:0,(anonymous_5)
+FNDA:0,(anonymous_6)
+FNDA:0,(anonymous_7)
+FNDA:0,(anonymous_8)
+FNDA:0,(anonymous_9)
+FNDA:0,(anonymous_10)
+FNDA:0,(anonymous_11)
+FNDA:0,(anonymous_12)
+FNDA:0,(anonymous_13)
+FNDA:0,(anonymous_14)
+FNDA:0,(anonymous_15)
+FNDA:0,(anonymous_16)
+FNDA:0,(anonymous_17)
+FNDA:0,(anonymous_18)
+FNDA:0,(anonymous_19)
+FNDA:0,(anonymous_20)
+FNDA:0,(anonymous_21)
+FNDA:0,(anonymous_22)
+FNDA:0,(anonymous_23)
+FNDA:0,(anonymous_24)
+DA:1,0
+DA:13,0
+DA:21,0
+DA:23,0
+DA:28,0
+DA:46,0
+DA:50,0
+DA:60,0
+DA:70,0
+DA:80,0
+DA:85,0
+DA:90,0
+DA:102,0
+DA:103,0
+DA:105,0
+DA:107,0
+DA:108,0
+DA:115,0
+DA:121,0
+DA:122,0
+DA:123,0
+DA:124,0
+DA:125,0
+DA:126,0
+DA:127,0
+DA:132,0
+DA:138,0
+DA:139,0
+DA:140,0
+DA:141,0
+DA:142,0
+DA:143,0
+DA:144,0
+DA:165,0
+DA:166,0
+DA:167,0
+DA:174,0
+DA:176,0
+DA:203,0
+DA:222,0
+DA:223,0
+DA:224,0
+DA:231,0
+DA:233,0
+DA:269,0
+DA:298,0
+DA:299,0
+DA:300,0
+DA:307,0
+DA:309,0
+DA:338,0
+DA:400,0
+DA:401,0
+DA:402,0
+DA:404,0
+DA:406,0
+DA:410,0
+DA:411,0
+DA:412,0
+DA:417,0
+DA:418,0
+DA:420,0
+DA:422,0
+DA:423,0
+DA:424,0
+DA:427,0
+DA:430,0
+DA:438,0
+DA:441,0
+DA:442,0
+DA:450,0
+DA:453,0
+DA:457,0
+DA:464,0
+DA:465,0
+DA:468,0
+DA:469,0
+DA:473,0
+DA:479,0
+LF:79
+LH:0
+BRDA:123,0,0,0
+BRDA:140,1,0,0
+BRDA:391,2,0,0
+BRDA:422,3,0,0
+BRDA:423,4,0,0
+BRDA:430,5,0,0
+BRDA:431,6,0,0
+BRDA:431,6,1,0
+BRDA:431,6,2,0
+BRDA:451,7,0,0
+BRDA:451,7,1,0
+BRDA:457,8,0,0
+BRDA:464,9,0,0
+BRF:13
+BRH:0
+end_of_record
+TN:
+SF:src/rpc-service/rpc-service.ts
+FN:154,isConnectionError
+FN:164,(anonymous_4)
+FN:182,isNockError
+FN:195,isJsonParseError
+FN:210,getNormalizedEndpointUrl
+FN:222,stripCredentialsFromUrl
+FN:272,(anonymous_9)
+FN:296,(anonymous_10)
+FN:321,(anonymous_11)
+FN:328,(anonymous_12)
+FN:339,(anonymous_13)
+FN:340,(anonymous_14)
+FN:353,(anonymous_15)
+FN:354,(anonymous_16)
+FN:380,(anonymous_17)
+FN:383,(anonymous_18)
+FN:395,(anonymous_19)
+FN:398,(anonymous_20)
+FN:447,(anonymous_21)
+FN:471,_RpcService_getDefaultFetchOptions
+FN:484,_RpcService_getCompleteFetchOptions
+FN:533,_RpcService_executeAndProcessRequest
+FN:543,(anonymous_25)
+FNF:23
+FNH:0
+FNDA:0,isConnectionError
+FNDA:0,(anonymous_4)
+FNDA:0,isNockError
+FNDA:0,isJsonParseError
+FNDA:0,getNormalizedEndpointUrl
+FNDA:0,stripCredentialsFromUrl
+FNDA:0,(anonymous_9)
+FNDA:0,(anonymous_10)
+FNDA:0,(anonymous_11)
+FNDA:0,(anonymous_12)
+FNDA:0,(anonymous_13)
+FNDA:0,(anonymous_14)
+FNDA:0,(anonymous_15)
+FNDA:0,(anonymous_16)
+FNDA:0,(anonymous_17)
+FNDA:0,(anonymous_18)
+FNDA:0,(anonymous_19)
+FNDA:0,(anonymous_20)
+FNDA:0,(anonymous_21)
+FNDA:0,_RpcService_getDefaultFetchOptions
+FNDA:0,_RpcService_getCompleteFetchOptions
+FNDA:0,_RpcService_executeAndProcessRequest
+FNDA:0,(anonymous_25)
+DA:5,0
+DA:11,0
+DA:12,0
+DA:20,0
+DA:25,0
+DA:62,0
+DA:68,0
+DA:76,0
+DA:84,0
+DA:137,0
+DA:154,0
+DA:155,0
+DA:156,0
+DA:159,0
+DA:161,0
+DA:165,0
+DA:183,0
+DA:196,0
+DA:211,0
+DA:223,0
+DA:224,0
+DA:225,0
+DA:226,0
+DA:235,0
+DA:250,0
+DA:255,0
+DA:260,0
+DA:265,0
+DA:280,0
+DA:282,0
+DA:283,0
+DA:284,0
+DA:289,0
+DA:290,0
+DA:292,0
+DA:297,0
+DA:322,0
+DA:329,0
+DA:340,0
+DA:341,0
+DA:354,0
+DA:366,0
+DA:367,0
+DA:383,0
+DA:384,0
+DA:398,0
+DA:399,0
+DA:452,0
+DA:456,0
+DA:471,0
+DA:475,0
+DA:476,0
+DA:477,0
+DA:478,0
+DA:483,0
+DA:498,0
+DA:505,0
+DA:510,0
+DA:511,0
+DA:518,0
+DA:537,0
+DA:538,0
+DA:542,0
+DA:544,0
+DA:553,0
+DA:554,0
+DA:555,0
+DA:557,0
+DA:562,0
+DA:565,0
+DA:566,0
+DA:568,0
+DA:570,0
+DA:573,0
+DA:574,0
+DA:575,0
+DA:576,0
+DA:584,0
+DA:585,0
+DA:592,0
+DA:593,0
+DA:602,0
+DA:609,0
+DA:610,0
+DA:613,0
+DA:614,0
+DA:616,0
+DA:617,0
+DA:624,0
+DA:628,0
+LF:90
+LH:0
+BRDA:155,0,0,0
+BRDA:155,1,0,0
+BRDA:155,1,1,0
+BRDA:155,1,2,0
+BRDA:162,2,0,0
+BRDA:162,2,1,0
+BRDA:162,2,2,0
+BRDA:166,3,0,0
+BRDA:166,3,1,0
+BRDA:197,4,0,0
+BRDA:197,4,1,0
+BRDA:211,5,0,0
+BRDA:211,5,1,0
+BRDA:278,6,0,0
+BRDA:279,7,0,0
+BRDA:299,8,0,0
+BRDA:299,8,1,0
+BRDA:299,8,2,0
+BRDA:299,8,3,0
+BRDA:299,8,4,0
+BRDA:299,8,5,0
+BRDA:299,8,6,0
+BRDA:299,8,7,0
+BRDA:299,8,8,0
+BRDA:366,9,0,0
+BRDA:384,10,0,0
+BRDA:384,10,1,0
+BRDA:450,11,0,0
+BRDA:475,12,0,0
+BRDA:475,13,0,0
+BRDA:475,13,1,0
+BRDA:554,14,0,0
+BRDA:571,15,0,0
+BRDA:571,15,1,0
+BRDA:573,16,0,0
+BRDA:573,16,1,0
+BRDA:575,17,0,0
+BRDA:584,18,0,0
+BRDA:592,19,0,0
+BRDA:592,20,0,0
+BRDA:592,20,1,0
+BRDA:592,20,2,0
+BRDA:609,21,0,0
+BRDA:609,21,1,0
+BRDA:613,22,0,0
+BRDA:621,23,0,0
+BRDA:621,23,1,0
+BRF:47
+BRH:0
+end_of_record
diff --git a/coverage/prettify.css b/coverage/prettify.css
new file mode 100644
index 0000000000000000000000000000000000000000..b317a7cda31a440fbd47540297ee3c68d51f343e
--- /dev/null
+++ b/coverage/prettify.css
@@ -0,0 +1 @@
+.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}pre.prettyprint{padding:2px;border:1px solid #888}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
diff --git a/coverage/prettify.js b/coverage/prettify.js
new file mode 100644
index 0000000000000000000000000000000000000000..b3225238f26e3ab49a5e41e9cb287a73c82740b7
--- /dev/null
+++ b/coverage/prettify.js
@@ -0,0 +1,2 @@
+/* eslint-disable */
+window.PR_SHOULD_USE_CONTINUATION=true;(function(){var h=["break,continue,do,else,for,if,return,while"];var u=[h,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"];var p=[u,"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"];var l=[p,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"];var x=[p,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"];var R=[x,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"];var r="all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes";var w=[p,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"];var s="caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END";var I=[h,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"];var f=[h,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"];var H=[h,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"];var A=[l,R,w,s+I,f,H];var e=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/;var C="str";var z="kwd";var j="com";var O="typ";var G="lit";var L="pun";var F="pln";var m="tag";var E="dec";var J="src";var P="atn";var n="atv";var N="nocode";var M="(?:^^\\.?|[+-]|\\!|\\!=|\\!==|\\#|\\%|\\%=|&|&&|&&=|&=|\\(|\\*|\\*=|\\+=|\\,|\\-=|\\->|\\/|\\/=|:|::|\\;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\@|\\[|\\^|\\^=|\\^\\^|\\^\\^=|\\{|\\||\\|=|\\|\\||\\|\\|=|\\~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*";function k(Z){var ad=0;var S=false;var ac=false;for(var V=0,U=Z.length;V<U;++V){var ae=Z[V];if(ae.ignoreCase){ac=true}else{if(/[a-z]/i.test(ae.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,""))){S=true;ac=false;break}}}var Y={b:8,t:9,n:10,v:11,f:12,r:13};function ab(ah){var ag=ah.charCodeAt(0);if(ag!==92){return ag}var af=ah.charAt(1);ag=Y[af];if(ag){return ag}else{if("0"<=af&&af<="7"){return parseInt(ah.substring(1),8)}else{if(af==="u"||af==="x"){return parseInt(ah.substring(2),16)}else{return ah.charCodeAt(1)}}}}function T(af){if(af<32){return(af<16?"\\x0":"\\x")+af.toString(16)}var ag=String.fromCharCode(af);if(ag==="\\"||ag==="-"||ag==="["||ag==="]"){ag="\\"+ag}return ag}function X(am){var aq=am.substring(1,am.length-1).match(new RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\[0-3][0-7]{0,2}|\\\\[0-7]{1,2}|\\\\[\\s\\S]|-|[^-\\\\]","g"));var ak=[];var af=[];var ao=aq[0]==="^";for(var ar=ao?1:0,aj=aq.length;ar<aj;++ar){var ah=aq[ar];if(/\\[bdsw]/i.test(ah)){ak.push(ah)}else{var ag=ab(ah);var al;if(ar+2<aj&&"-"===aq[ar+1]){al=ab(aq[ar+2]);ar+=2}else{al=ag}af.push([ag,al]);if(!(al<65||ag>122)){if(!(al<65||ag>90)){af.push([Math.max(65,ag)|32,Math.min(al,90)|32])}if(!(al<97||ag>122)){af.push([Math.max(97,ag)&~32,Math.min(al,122)&~32])}}}}af.sort(function(av,au){return(av[0]-au[0])||(au[1]-av[1])});var ai=[];var ap=[NaN,NaN];for(var ar=0;ar<af.length;++ar){var at=af[ar];if(at[0]<=ap[1]+1){ap[1]=Math.max(ap[1],at[1])}else{ai.push(ap=at)}}var an=["["];if(ao){an.push("^")}an.push.apply(an,ak);for(var ar=0;ar<ai.length;++ar){var at=ai[ar];an.push(T(at[0]));if(at[1]>at[0]){if(at[1]+1>at[0]){an.push("-")}an.push(T(at[1]))}}an.push("]");return an.join("")}function W(al){var aj=al.source.match(new RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!=]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g"));var ah=aj.length;var an=[];for(var ak=0,am=0;ak<ah;++ak){var ag=aj[ak];if(ag==="("){++am}else{if("\\"===ag.charAt(0)){var af=+ag.substring(1);if(af&&af<=am){an[af]=-1}}}}for(var ak=1;ak<an.length;++ak){if(-1===an[ak]){an[ak]=++ad}}for(var ak=0,am=0;ak<ah;++ak){var ag=aj[ak];if(ag==="("){++am;if(an[am]===undefined){aj[ak]="(?:"}}else{if("\\"===ag.charAt(0)){var af=+ag.substring(1);if(af&&af<=am){aj[ak]="\\"+an[am]}}}}for(var ak=0,am=0;ak<ah;++ak){if("^"===aj[ak]&&"^"!==aj[ak+1]){aj[ak]=""}}if(al.ignoreCase&&S){for(var ak=0;ak<ah;++ak){var ag=aj[ak];var ai=ag.charAt(0);if(ag.length>=2&&ai==="["){aj[ak]=X(ag)}else{if(ai!=="\\"){aj[ak]=ag.replace(/[a-zA-Z]/g,function(ao){var ap=ao.charCodeAt(0);return"["+String.fromCharCode(ap&~32,ap|32)+"]"})}}}}return aj.join("")}var aa=[];for(var V=0,U=Z.length;V<U;++V){var ae=Z[V];if(ae.global||ae.multiline){throw new Error(""+ae)}aa.push("(?:"+W(ae)+")")}return new RegExp(aa.join("|"),ac?"gi":"g")}function a(V){var U=/(?:^|\s)nocode(?:\s|$)/;var X=[];var T=0;var Z=[];var W=0;var S;if(V.currentStyle){S=V.currentStyle.whiteSpace}else{if(window.getComputedStyle){S=document.defaultView.getComputedStyle(V,null).getPropertyValue("white-space")}}var Y=S&&"pre"===S.substring(0,3);function aa(ab){switch(ab.nodeType){case 1:if(U.test(ab.className)){return}for(var ae=ab.firstChild;ae;ae=ae.nextSibling){aa(ae)}var ad=ab.nodeName;if("BR"===ad||"LI"===ad){X[W]="\n";Z[W<<1]=T++;Z[(W++<<1)|1]=ab}break;case 3:case 4:var ac=ab.nodeValue;if(ac.length){if(!Y){ac=ac.replace(/[ \t\r\n]+/g," ")}else{ac=ac.replace(/\r\n?/g,"\n")}X[W]=ac;Z[W<<1]=T;T+=ac.length;Z[(W++<<1)|1]=ab}break}}aa(V);return{sourceCode:X.join("").replace(/\n$/,""),spans:Z}}function B(S,U,W,T){if(!U){return}var V={sourceCode:U,basePos:S};W(V);T.push.apply(T,V.decorations)}var v=/\S/;function o(S){var V=undefined;for(var U=S.firstChild;U;U=U.nextSibling){var T=U.nodeType;V=(T===1)?(V?S:U):(T===3)?(v.test(U.nodeValue)?S:V):V}return V===S?undefined:V}function g(U,T){var S={};var V;(function(){var ad=U.concat(T);var ah=[];var ag={};for(var ab=0,Z=ad.length;ab<Z;++ab){var Y=ad[ab];var ac=Y[3];if(ac){for(var ae=ac.length;--ae>=0;){S[ac.charAt(ae)]=Y}}var af=Y[1];var aa=""+af;if(!ag.hasOwnProperty(aa)){ah.push(af);ag[aa]=null}}ah.push(/[\0-\uffff]/);V=k(ah)})();var X=T.length;var W=function(ah){var Z=ah.sourceCode,Y=ah.basePos;var ad=[Y,F];var af=0;var an=Z.match(V)||[];var aj={};for(var ae=0,aq=an.length;ae<aq;++ae){var ag=an[ae];var ap=aj[ag];var ai=void 0;var am;if(typeof ap==="string"){am=false}else{var aa=S[ag.charAt(0)];if(aa){ai=ag.match(aa[1]);ap=aa[0]}else{for(var ao=0;ao<X;++ao){aa=T[ao];ai=ag.match(aa[1]);if(ai){ap=aa[0];break}}if(!ai){ap=F}}am=ap.length>=5&&"lang-"===ap.substring(0,5);if(am&&!(ai&&typeof ai[1]==="string")){am=false;ap=J}if(!am){aj[ag]=ap}}var ab=af;af+=ag.length;if(!am){ad.push(Y+ab,ap)}else{var al=ai[1];var ak=ag.indexOf(al);var ac=ak+al.length;if(ai[2]){ac=ag.length-ai[2].length;ak=ac-al.length}var ar=ap.substring(5);B(Y+ab,ag.substring(0,ak),W,ad);B(Y+ab+ak,al,q(ar,al),ad);B(Y+ab+ac,ag.substring(ac),W,ad)}}ah.decorations=ad};return W}function i(T){var W=[],S=[];if(T.tripleQuotedStrings){W.push([C,/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,null,"'\""])}else{if(T.multiLineStrings){W.push([C,/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"])}else{W.push([C,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"])}}if(T.verbatimStrings){S.push([C,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null])}var Y=T.hashComments;if(Y){if(T.cStyleComments){if(Y>1){W.push([j,/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,null,"#"])}else{W.push([j,/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"])}S.push([C,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,null])}else{W.push([j,/^#[^\r\n]*/,null,"#"])}}if(T.cStyleComments){S.push([j,/^\/\/[^\r\n]*/,null]);S.push([j,/^\/\*[\s\S]*?(?:\*\/|$)/,null])}if(T.regexLiterals){var X=("/(?=[^/*])(?:[^/\\x5B\\x5C]|\\x5C[\\s\\S]|\\x5B(?:[^\\x5C\\x5D]|\\x5C[\\s\\S])*(?:\\x5D|$))+/");S.push(["lang-regex",new RegExp("^"+M+"("+X+")")])}var V=T.types;if(V){S.push([O,V])}var U=(""+T.keywords).replace(/^ | $/g,"");if(U.length){S.push([z,new RegExp("^(?:"+U.replace(/[\s,]+/g,"|")+")\\b"),null])}W.push([F,/^\s+/,null," \r\n\t\xA0"]);S.push([G,/^@[a-z_$][a-z_$@0-9]*/i,null],[O,/^(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null],[F,/^[a-z_$][a-z_$@0-9]*/i,null],[G,new RegExp("^(?:0x[a-f0-9]+|(?:\\d(?:_\\d+)*\\d*(?:\\.\\d*)?|\\.\\d\\+)(?:e[+\\-]?\\d+)?)[a-z]*","i"),null,"0123456789"],[F,/^\\[\s\S]?/,null],[L,/^.[^\s\w\.$@\'\"\`\/\#\\]*/,null]);return g(W,S)}var K=i({keywords:A,hashComments:true,cStyleComments:true,multiLineStrings:true,regexLiterals:true});function Q(V,ag){var U=/(?:^|\s)nocode(?:\s|$)/;var ab=/\r\n?|\n/;var ac=V.ownerDocument;var S;if(V.currentStyle){S=V.currentStyle.whiteSpace}else{if(window.getComputedStyle){S=ac.defaultView.getComputedStyle(V,null).getPropertyValue("white-space")}}var Z=S&&"pre"===S.substring(0,3);var af=ac.createElement("LI");while(V.firstChild){af.appendChild(V.firstChild)}var W=[af];function ae(al){switch(al.nodeType){case 1:if(U.test(al.className)){break}if("BR"===al.nodeName){ad(al);if(al.parentNode){al.parentNode.removeChild(al)}}else{for(var an=al.firstChild;an;an=an.nextSibling){ae(an)}}break;case 3:case 4:if(Z){var am=al.nodeValue;var aj=am.match(ab);if(aj){var ai=am.substring(0,aj.index);al.nodeValue=ai;var ah=am.substring(aj.index+aj[0].length);if(ah){var ak=al.parentNode;ak.insertBefore(ac.createTextNode(ah),al.nextSibling)}ad(al);if(!ai){al.parentNode.removeChild(al)}}}break}}function ad(ak){while(!ak.nextSibling){ak=ak.parentNode;if(!ak){return}}function ai(al,ar){var aq=ar?al.cloneNode(false):al;var ao=al.parentNode;if(ao){var ap=ai(ao,1);var an=al.nextSibling;ap.appendChild(aq);for(var am=an;am;am=an){an=am.nextSibling;ap.appendChild(am)}}return aq}var ah=ai(ak.nextSibling,0);for(var aj;(aj=ah.parentNode)&&aj.nodeType===1;){ah=aj}W.push(ah)}for(var Y=0;Y<W.length;++Y){ae(W[Y])}if(ag===(ag|0)){W[0].setAttribute("value",ag)}var aa=ac.createElement("OL");aa.className="linenums";var X=Math.max(0,((ag-1))|0)||0;for(var Y=0,T=W.length;Y<T;++Y){af=W[Y];af.className="L"+((Y+X)%10);if(!af.firstChild){af.appendChild(ac.createTextNode("\xA0"))}aa.appendChild(af)}V.appendChild(aa)}function D(ac){var aj=/\bMSIE\b/.test(navigator.userAgent);var am=/\n/g;var al=ac.sourceCode;var an=al.length;var V=0;var aa=ac.spans;var T=aa.length;var ah=0;var X=ac.decorations;var Y=X.length;var Z=0;X[Y]=an;var ar,aq;for(aq=ar=0;aq<Y;){if(X[aq]!==X[aq+2]){X[ar++]=X[aq++];X[ar++]=X[aq++]}else{aq+=2}}Y=ar;for(aq=ar=0;aq<Y;){var at=X[aq];var ab=X[aq+1];var W=aq+2;while(W+2<=Y&&X[W+1]===ab){W+=2}X[ar++]=at;X[ar++]=ab;aq=W}Y=X.length=ar;var ae=null;while(ah<T){var af=aa[ah];var S=aa[ah+2]||an;var ag=X[Z];var ap=X[Z+2]||an;var W=Math.min(S,ap);var ak=aa[ah+1];var U;if(ak.nodeType!==1&&(U=al.substring(V,W))){if(aj){U=U.replace(am,"\r")}ak.nodeValue=U;var ai=ak.ownerDocument;var ao=ai.createElement("SPAN");ao.className=X[Z+1];var ad=ak.parentNode;ad.replaceChild(ao,ak);ao.appendChild(ak);if(V<S){aa[ah+1]=ak=ai.createTextNode(al.substring(W,S));ad.insertBefore(ak,ao.nextSibling)}}V=W;if(V>=S){ah+=2}if(V>=ap){Z+=2}}}var t={};function c(U,V){for(var S=V.length;--S>=0;){var T=V[S];if(!t.hasOwnProperty(T)){t[T]=U}else{if(window.console){console.warn("cannot override language handler %s",T)}}}}function q(T,S){if(!(T&&t.hasOwnProperty(T))){T=/^\s*</.test(S)?"default-markup":"default-code"}return t[T]}c(K,["default-code"]);c(g([],[[F,/^[^<?]+/],[E,/^<!\w[^>]*(?:>|$)/],[j,/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],[L,/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]);c(g([[F,/^[\s]+/,null," \t\r\n"],[n,/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[[m,/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],[P,/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],[L,/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]);c(g([],[[n,/^[\s\S]+/]]),["uq.val"]);c(i({keywords:l,hashComments:true,cStyleComments:true,types:e}),["c","cc","cpp","cxx","cyc","m"]);c(i({keywords:"null,true,false"}),["json"]);c(i({keywords:R,hashComments:true,cStyleComments:true,verbatimStrings:true,types:e}),["cs"]);c(i({keywords:x,cStyleComments:true}),["java"]);c(i({keywords:H,hashComments:true,multiLineStrings:true}),["bsh","csh","sh"]);c(i({keywords:I,hashComments:true,multiLineStrings:true,tripleQuotedStrings:true}),["cv","py"]);c(i({keywords:s,hashComments:true,multiLineStrings:true,regexLiterals:true}),["perl","pl","pm"]);c(i({keywords:f,hashComments:true,multiLineStrings:true,regexLiterals:true}),["rb"]);c(i({keywords:w,cStyleComments:true,regexLiterals:true}),["js"]);c(i({keywords:r,hashComments:3,cStyleComments:true,multilineStrings:true,tripleQuotedStrings:true,regexLiterals:true}),["coffee"]);c(g([],[[C,/^[\s\S]+/]]),["regex"]);function d(V){var U=V.langExtension;try{var S=a(V.sourceNode);var T=S.sourceCode;V.sourceCode=T;V.spans=S.spans;V.basePos=0;q(U,T)(V);D(V)}catch(W){if("console" in window){console.log(W&&W.stack?W.stack:W)}}}function y(W,V,U){var S=document.createElement("PRE");S.innerHTML=W;if(U){Q(S,U)}var T={langExtension:V,numberLines:U,sourceNode:S};d(T);return S.innerHTML}function b(ad){function Y(af){return document.getElementsByTagName(af)}var ac=[Y("pre"),Y("code"),Y("xmp")];var T=[];for(var aa=0;aa<ac.length;++aa){for(var Z=0,V=ac[aa].length;Z<V;++Z){T.push(ac[aa][Z])}}ac=null;var W=Date;if(!W.now){W={now:function(){return +(new Date)}}}var X=0;var S;var ab=/\blang(?:uage)?-([\w.]+)(?!\S)/;var ae=/\bprettyprint\b/;function U(){var ag=(window.PR_SHOULD_USE_CONTINUATION?W.now()+250:Infinity);for(;X<T.length&&W.now()<ag;X++){var aj=T[X];var ai=aj.className;if(ai.indexOf("prettyprint")>=0){var ah=ai.match(ab);var am;if(!ah&&(am=o(aj))&&"CODE"===am.tagName){ah=am.className.match(ab)}if(ah){ah=ah[1]}var al=false;for(var ak=aj.parentNode;ak;ak=ak.parentNode){if((ak.tagName==="pre"||ak.tagName==="code"||ak.tagName==="xmp")&&ak.className&&ak.className.indexOf("prettyprint")>=0){al=true;break}}if(!al){var af=aj.className.match(/\blinenums\b(?::(\d+))?/);af=af?af[1]&&af[1].length?+af[1]:true:false;if(af){Q(aj,af)}S={langExtension:ah,sourceNode:aj,numberLines:af};d(S)}}}if(X<T.length){setTimeout(U,250)}else{if(ad){ad()}}}U()}window.prettyPrintOne=y;window.prettyPrint=b;window.PR={createSimpleLexer:g,registerLangHandler:c,sourceDecorator:i,PR_ATTRIB_NAME:P,PR_ATTRIB_VALUE:n,PR_COMMENT:j,PR_DECLARATION:E,PR_KEYWORD:z,PR_LITERAL:G,PR_NOCODE:N,PR_PLAIN:F,PR_PUNCTUATION:L,PR_SOURCE:J,PR_STRING:C,PR_TAG:m,PR_TYPE:O}})();PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_DECLARATION,/^<!\w[^>]*(?:>|$)/],[PR.PR_COMMENT,/^<\!--[\s\S]*?(?:-\->|$)/],[PR.PR_PUNCTUATION,/^(?:<[%?]|[%?]>)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-handlebars",/^<script\b[^>]*type\s*=\s*['"]?text\/x-handlebars-template['"]?\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i],[PR.PR_DECLARATION,/^{{[#^>/]?\s*[\w.][^}]*}}/],[PR.PR_DECLARATION,/^{{&?\s*[\w.][^}]*}}/],[PR.PR_DECLARATION,/^{{{>?\s*[\w.][^}]*}}}/],[PR.PR_COMMENT,/^{{![^}]*}}/]]),["handlebars","hbs"]);PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[ \t\r\n\f]+/,null," \t\r\n\f"]],[[PR.PR_STRING,/^\"(?:[^\n\r\f\\\"]|\\(?:\r\n?|\n|\f)|\\[\s\S])*\"/,null],[PR.PR_STRING,/^\'(?:[^\n\r\f\\\']|\\(?:\r\n?|\n|\f)|\\[\s\S])*\'/,null],["lang-css-str",/^url\(([^\)\"\']*)\)/i],[PR.PR_KEYWORD,/^(?:url|rgb|\!important|@import|@page|@media|@charset|inherit)(?=[^\-\w]|$)/i,null],["lang-css-kw",/^(-?(?:[_a-z]|(?:\\[0-9a-f]+ ?))(?:[_a-z0-9\-]|\\(?:\\[0-9a-f]+ ?))*)\s*:/i],[PR.PR_COMMENT,/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],[PR.PR_COMMENT,/^(?:<!--|-->)/],[PR.PR_LITERAL,/^(?:\d+|\d*\.\d+)(?:%|[a-z]+)?/i],[PR.PR_LITERAL,/^#(?:[0-9a-f]{3}){1,2}/i],[PR.PR_PLAIN,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i],[PR.PR_PUNCTUATION,/^[^\s\w\'\"]+/]]),["css"]);PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_KEYWORD,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i]]),["css-kw"]);PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_STRING,/^[^\)\"\']+/]]),["css-str"]);
diff --git a/coverage/sort-arrow-sprite.png b/coverage/sort-arrow-sprite.png
new file mode 100644
index 0000000000000000000000000000000000000000..6ed68316eb3f65dec9063332d2f69bf3093bbfab
--- /dev/null
+++ b/coverage/sort-arrow-sprite.png
@@ -0,0 +1,3 @@
+ï¿½PNG
+
+   IHDR         ï¿½Fï¿½3   QIDATxcp/ï¿½ï¿½c 0Fï¿½Hï¿½0LE]Xï¿½Ä‰ï¿½J6ï¿½Aï¿½ï¿½ï¿½2ï¿½ï¿½Ç…ï¿½*0%`ï¿½b(ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½B0pï¿½ï¿½ Nã¤¸ï¿½ï¿½xï¿½    IENDï¿½B`ï¿½
\ No newline at end of file
diff --git a/coverage/sorter.js b/coverage/sorter.js
new file mode 100644
index 0000000000000000000000000000000000000000..2bb296a8ca8e48e468f22b92250b9fe2518b8cfc
--- /dev/null
+++ b/coverage/sorter.js
@@ -0,0 +1,196 @@
+/* eslint-disable */
+var addSorting = (function() {
+    'use strict';
+    var cols,
+        currentSort = {
+            index: 0,
+            desc: false
+        };
+
+    // returns the summary table element
+    function getTable() {
+        return document.querySelector('.coverage-summary');
+    }
+    // returns the thead element of the summary table
+    function getTableHeader() {
+        return getTable().querySelector('thead tr');
+    }
+    // returns the tbody element of the summary table
+    function getTableBody() {
+        return getTable().querySelector('tbody');
+    }
+    // returns the th element for nth column
+    function getNthColumn(n) {
+        return getTableHeader().querySelectorAll('th')[n];
+    }
+
+    function onFilterInput() {
+        const searchValue = document.getElementById('fileSearch').value;
+        const rows = document.getElementsByTagName('tbody')[0].children;
+        for (let i = 0; i < rows.length; i++) {
+            const row = rows[i];
+            if (
+                row.textContent
+                    .toLowerCase()
+                    .includes(searchValue.toLowerCase())
+            ) {
+                row.style.display = '';
+            } else {
+                row.style.display = 'none';
+            }
+        }
+    }
+
+    // loads the search box
+    function addSearchBox() {
+        var template = document.getElementById('filterTemplate');
+        var templateClone = template.content.cloneNode(true);
+        templateClone.getElementById('fileSearch').oninput = onFilterInput;
+        template.parentElement.appendChild(templateClone);
+    }
+
+    // loads all columns
+    function loadColumns() {
+        var colNodes = getTableHeader().querySelectorAll('th'),
+            colNode,
+            cols = [],
+            col,
+            i;
+
+        for (i = 0; i < colNodes.length; i += 1) {
+            colNode = colNodes[i];
+            col = {
+                key: colNode.getAttribute('data-col'),
+                sortable: !colNode.getAttribute('data-nosort'),
+                type: colNode.getAttribute('data-type') || 'string'
+            };
+            cols.push(col);
+            if (col.sortable) {
+                col.defaultDescSort = col.type === 'number';
+                colNode.innerHTML =
+                    colNode.innerHTML + '<span class="sorter"></span>';
+            }
+        }
+        return cols;
+    }
+    // attaches a data attribute to every tr element with an object
+    // of data values keyed by column name
+    function loadRowData(tableRow) {
+        var tableCols = tableRow.querySelectorAll('td'),
+            colNode,
+            col,
+            data = {},
+            i,
+            val;
+        for (i = 0; i < tableCols.length; i += 1) {
+            colNode = tableCols[i];
+            col = cols[i];
+            val = colNode.getAttribute('data-value');
+            if (col.type === 'number') {
+                val = Number(val);
+            }
+            data[col.key] = val;
+        }
+        return data;
+    }
+    // loads all row data
+    function loadData() {
+        var rows = getTableBody().querySelectorAll('tr'),
+            i;
+
+        for (i = 0; i < rows.length; i += 1) {
+            rows[i].data = loadRowData(rows[i]);
+        }
+    }
+    // sorts the table using the data for the ith column
+    function sortByIndex(index, desc) {
+        var key = cols[index].key,
+            sorter = function(a, b) {
+                a = a.data[key];
+                b = b.data[key];
+                return a < b ? -1 : a > b ? 1 : 0;
+            },
+            finalSorter = sorter,
+            tableBody = document.querySelector('.coverage-summary tbody'),
+            rowNodes = tableBody.querySelectorAll('tr'),
+            rows = [],
+            i;
+
+        if (desc) {
+            finalSorter = function(a, b) {
+                return -1 * sorter(a, b);
+            };
+        }
+
+        for (i = 0; i < rowNodes.length; i += 1) {
+            rows.push(rowNodes[i]);
+            tableBody.removeChild(rowNodes[i]);
+        }
+
+        rows.sort(finalSorter);
+
+        for (i = 0; i < rows.length; i += 1) {
+            tableBody.appendChild(rows[i]);
+        }
+    }
+    // removes sort indicators for current column being sorted
+    function removeSortIndicators() {
+        var col = getNthColumn(currentSort.index),
+            cls = col.className;
+
+        cls = cls.replace(/ sorted$/, '').replace(/ sorted-desc$/, '');
+        col.className = cls;
+    }
+    // adds sort indicators for current column being sorted
+    function addSortIndicators() {
+        getNthColumn(currentSort.index).className += currentSort.desc
+            ? ' sorted-desc'
+            : ' sorted';
+    }
+    // adds event listeners for all sorter widgets
+    function enableUI() {
+        var i,
+            el,
+            ithSorter = function ithSorter(i) {
+                var col = cols[i];
+
+                return function() {
+                    var desc = col.defaultDescSort;
+
+                    if (currentSort.index === i) {
+                        desc = !currentSort.desc;
+                    }
+                    sortByIndex(i, desc);
+                    removeSortIndicators();
+                    currentSort.index = i;
+                    currentSort.desc = desc;
+                    addSortIndicators();
+                };
+            };
+        for (i = 0; i < cols.length; i += 1) {
+            if (cols[i].sortable) {
+                // add the click event handler on the th so users
+                // dont have to click on those tiny arrows
+                el = getNthColumn(i).querySelector('.sorter').parentElement;
+                if (el.addEventListener) {
+                    el.addEventListener('click', ithSorter(i));
+                } else {
+                    el.attachEvent('onclick', ithSorter(i));
+                }
+            }
+        }
+    }
+    // adds sorting functionality to the UI
+    return function() {
+        if (!getTable()) {
+            return;
+        }
+        cols = loadColumns();
+        loadData();
+        addSearchBox();
+        addSortIndicators();
+        enableUI();
+    };
+})();
+
+window.addEventListener('load', addSorting);
diff --git a/coverage/src/NetworkController.ts.html b/coverage/src/NetworkController.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..e6615bd85c95bd2ab1190353c8f525e863d266d3
--- /dev/null
+++ b/coverage/src/NetworkController.ts.html
@@ -0,0 +1,10153 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/NetworkController.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> NetworkController.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/496</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/219</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/114</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/496</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a>
+<a name='L483'></a><a href='#L483'>483</a>
+<a name='L484'></a><a href='#L484'>484</a>
+<a name='L485'></a><a href='#L485'>485</a>
+<a name='L486'></a><a href='#L486'>486</a>
+<a name='L487'></a><a href='#L487'>487</a>
+<a name='L488'></a><a href='#L488'>488</a>
+<a name='L489'></a><a href='#L489'>489</a>
+<a name='L490'></a><a href='#L490'>490</a>
+<a name='L491'></a><a href='#L491'>491</a>
+<a name='L492'></a><a href='#L492'>492</a>
+<a name='L493'></a><a href='#L493'>493</a>
+<a name='L494'></a><a href='#L494'>494</a>
+<a name='L495'></a><a href='#L495'>495</a>
+<a name='L496'></a><a href='#L496'>496</a>
+<a name='L497'></a><a href='#L497'>497</a>
+<a name='L498'></a><a href='#L498'>498</a>
+<a name='L499'></a><a href='#L499'>499</a>
+<a name='L500'></a><a href='#L500'>500</a>
+<a name='L501'></a><a href='#L501'>501</a>
+<a name='L502'></a><a href='#L502'>502</a>
+<a name='L503'></a><a href='#L503'>503</a>
+<a name='L504'></a><a href='#L504'>504</a>
+<a name='L505'></a><a href='#L505'>505</a>
+<a name='L506'></a><a href='#L506'>506</a>
+<a name='L507'></a><a href='#L507'>507</a>
+<a name='L508'></a><a href='#L508'>508</a>
+<a name='L509'></a><a href='#L509'>509</a>
+<a name='L510'></a><a href='#L510'>510</a>
+<a name='L511'></a><a href='#L511'>511</a>
+<a name='L512'></a><a href='#L512'>512</a>
+<a name='L513'></a><a href='#L513'>513</a>
+<a name='L514'></a><a href='#L514'>514</a>
+<a name='L515'></a><a href='#L515'>515</a>
+<a name='L516'></a><a href='#L516'>516</a>
+<a name='L517'></a><a href='#L517'>517</a>
+<a name='L518'></a><a href='#L518'>518</a>
+<a name='L519'></a><a href='#L519'>519</a>
+<a name='L520'></a><a href='#L520'>520</a>
+<a name='L521'></a><a href='#L521'>521</a>
+<a name='L522'></a><a href='#L522'>522</a>
+<a name='L523'></a><a href='#L523'>523</a>
+<a name='L524'></a><a href='#L524'>524</a>
+<a name='L525'></a><a href='#L525'>525</a>
+<a name='L526'></a><a href='#L526'>526</a>
+<a name='L527'></a><a href='#L527'>527</a>
+<a name='L528'></a><a href='#L528'>528</a>
+<a name='L529'></a><a href='#L529'>529</a>
+<a name='L530'></a><a href='#L530'>530</a>
+<a name='L531'></a><a href='#L531'>531</a>
+<a name='L532'></a><a href='#L532'>532</a>
+<a name='L533'></a><a href='#L533'>533</a>
+<a name='L534'></a><a href='#L534'>534</a>
+<a name='L535'></a><a href='#L535'>535</a>
+<a name='L536'></a><a href='#L536'>536</a>
+<a name='L537'></a><a href='#L537'>537</a>
+<a name='L538'></a><a href='#L538'>538</a>
+<a name='L539'></a><a href='#L539'>539</a>
+<a name='L540'></a><a href='#L540'>540</a>
+<a name='L541'></a><a href='#L541'>541</a>
+<a name='L542'></a><a href='#L542'>542</a>
+<a name='L543'></a><a href='#L543'>543</a>
+<a name='L544'></a><a href='#L544'>544</a>
+<a name='L545'></a><a href='#L545'>545</a>
+<a name='L546'></a><a href='#L546'>546</a>
+<a name='L547'></a><a href='#L547'>547</a>
+<a name='L548'></a><a href='#L548'>548</a>
+<a name='L549'></a><a href='#L549'>549</a>
+<a name='L550'></a><a href='#L550'>550</a>
+<a name='L551'></a><a href='#L551'>551</a>
+<a name='L552'></a><a href='#L552'>552</a>
+<a name='L553'></a><a href='#L553'>553</a>
+<a name='L554'></a><a href='#L554'>554</a>
+<a name='L555'></a><a href='#L555'>555</a>
+<a name='L556'></a><a href='#L556'>556</a>
+<a name='L557'></a><a href='#L557'>557</a>
+<a name='L558'></a><a href='#L558'>558</a>
+<a name='L559'></a><a href='#L559'>559</a>
+<a name='L560'></a><a href='#L560'>560</a>
+<a name='L561'></a><a href='#L561'>561</a>
+<a name='L562'></a><a href='#L562'>562</a>
+<a name='L563'></a><a href='#L563'>563</a>
+<a name='L564'></a><a href='#L564'>564</a>
+<a name='L565'></a><a href='#L565'>565</a>
+<a name='L566'></a><a href='#L566'>566</a>
+<a name='L567'></a><a href='#L567'>567</a>
+<a name='L568'></a><a href='#L568'>568</a>
+<a name='L569'></a><a href='#L569'>569</a>
+<a name='L570'></a><a href='#L570'>570</a>
+<a name='L571'></a><a href='#L571'>571</a>
+<a name='L572'></a><a href='#L572'>572</a>
+<a name='L573'></a><a href='#L573'>573</a>
+<a name='L574'></a><a href='#L574'>574</a>
+<a name='L575'></a><a href='#L575'>575</a>
+<a name='L576'></a><a href='#L576'>576</a>
+<a name='L577'></a><a href='#L577'>577</a>
+<a name='L578'></a><a href='#L578'>578</a>
+<a name='L579'></a><a href='#L579'>579</a>
+<a name='L580'></a><a href='#L580'>580</a>
+<a name='L581'></a><a href='#L581'>581</a>
+<a name='L582'></a><a href='#L582'>582</a>
+<a name='L583'></a><a href='#L583'>583</a>
+<a name='L584'></a><a href='#L584'>584</a>
+<a name='L585'></a><a href='#L585'>585</a>
+<a name='L586'></a><a href='#L586'>586</a>
+<a name='L587'></a><a href='#L587'>587</a>
+<a name='L588'></a><a href='#L588'>588</a>
+<a name='L589'></a><a href='#L589'>589</a>
+<a name='L590'></a><a href='#L590'>590</a>
+<a name='L591'></a><a href='#L591'>591</a>
+<a name='L592'></a><a href='#L592'>592</a>
+<a name='L593'></a><a href='#L593'>593</a>
+<a name='L594'></a><a href='#L594'>594</a>
+<a name='L595'></a><a href='#L595'>595</a>
+<a name='L596'></a><a href='#L596'>596</a>
+<a name='L597'></a><a href='#L597'>597</a>
+<a name='L598'></a><a href='#L598'>598</a>
+<a name='L599'></a><a href='#L599'>599</a>
+<a name='L600'></a><a href='#L600'>600</a>
+<a name='L601'></a><a href='#L601'>601</a>
+<a name='L602'></a><a href='#L602'>602</a>
+<a name='L603'></a><a href='#L603'>603</a>
+<a name='L604'></a><a href='#L604'>604</a>
+<a name='L605'></a><a href='#L605'>605</a>
+<a name='L606'></a><a href='#L606'>606</a>
+<a name='L607'></a><a href='#L607'>607</a>
+<a name='L608'></a><a href='#L608'>608</a>
+<a name='L609'></a><a href='#L609'>609</a>
+<a name='L610'></a><a href='#L610'>610</a>
+<a name='L611'></a><a href='#L611'>611</a>
+<a name='L612'></a><a href='#L612'>612</a>
+<a name='L613'></a><a href='#L613'>613</a>
+<a name='L614'></a><a href='#L614'>614</a>
+<a name='L615'></a><a href='#L615'>615</a>
+<a name='L616'></a><a href='#L616'>616</a>
+<a name='L617'></a><a href='#L617'>617</a>
+<a name='L618'></a><a href='#L618'>618</a>
+<a name='L619'></a><a href='#L619'>619</a>
+<a name='L620'></a><a href='#L620'>620</a>
+<a name='L621'></a><a href='#L621'>621</a>
+<a name='L622'></a><a href='#L622'>622</a>
+<a name='L623'></a><a href='#L623'>623</a>
+<a name='L624'></a><a href='#L624'>624</a>
+<a name='L625'></a><a href='#L625'>625</a>
+<a name='L626'></a><a href='#L626'>626</a>
+<a name='L627'></a><a href='#L627'>627</a>
+<a name='L628'></a><a href='#L628'>628</a>
+<a name='L629'></a><a href='#L629'>629</a>
+<a name='L630'></a><a href='#L630'>630</a>
+<a name='L631'></a><a href='#L631'>631</a>
+<a name='L632'></a><a href='#L632'>632</a>
+<a name='L633'></a><a href='#L633'>633</a>
+<a name='L634'></a><a href='#L634'>634</a>
+<a name='L635'></a><a href='#L635'>635</a>
+<a name='L636'></a><a href='#L636'>636</a>
+<a name='L637'></a><a href='#L637'>637</a>
+<a name='L638'></a><a href='#L638'>638</a>
+<a name='L639'></a><a href='#L639'>639</a>
+<a name='L640'></a><a href='#L640'>640</a>
+<a name='L641'></a><a href='#L641'>641</a>
+<a name='L642'></a><a href='#L642'>642</a>
+<a name='L643'></a><a href='#L643'>643</a>
+<a name='L644'></a><a href='#L644'>644</a>
+<a name='L645'></a><a href='#L645'>645</a>
+<a name='L646'></a><a href='#L646'>646</a>
+<a name='L647'></a><a href='#L647'>647</a>
+<a name='L648'></a><a href='#L648'>648</a>
+<a name='L649'></a><a href='#L649'>649</a>
+<a name='L650'></a><a href='#L650'>650</a>
+<a name='L651'></a><a href='#L651'>651</a>
+<a name='L652'></a><a href='#L652'>652</a>
+<a name='L653'></a><a href='#L653'>653</a>
+<a name='L654'></a><a href='#L654'>654</a>
+<a name='L655'></a><a href='#L655'>655</a>
+<a name='L656'></a><a href='#L656'>656</a>
+<a name='L657'></a><a href='#L657'>657</a>
+<a name='L658'></a><a href='#L658'>658</a>
+<a name='L659'></a><a href='#L659'>659</a>
+<a name='L660'></a><a href='#L660'>660</a>
+<a name='L661'></a><a href='#L661'>661</a>
+<a name='L662'></a><a href='#L662'>662</a>
+<a name='L663'></a><a href='#L663'>663</a>
+<a name='L664'></a><a href='#L664'>664</a>
+<a name='L665'></a><a href='#L665'>665</a>
+<a name='L666'></a><a href='#L666'>666</a>
+<a name='L667'></a><a href='#L667'>667</a>
+<a name='L668'></a><a href='#L668'>668</a>
+<a name='L669'></a><a href='#L669'>669</a>
+<a name='L670'></a><a href='#L670'>670</a>
+<a name='L671'></a><a href='#L671'>671</a>
+<a name='L672'></a><a href='#L672'>672</a>
+<a name='L673'></a><a href='#L673'>673</a>
+<a name='L674'></a><a href='#L674'>674</a>
+<a name='L675'></a><a href='#L675'>675</a>
+<a name='L676'></a><a href='#L676'>676</a>
+<a name='L677'></a><a href='#L677'>677</a>
+<a name='L678'></a><a href='#L678'>678</a>
+<a name='L679'></a><a href='#L679'>679</a>
+<a name='L680'></a><a href='#L680'>680</a>
+<a name='L681'></a><a href='#L681'>681</a>
+<a name='L682'></a><a href='#L682'>682</a>
+<a name='L683'></a><a href='#L683'>683</a>
+<a name='L684'></a><a href='#L684'>684</a>
+<a name='L685'></a><a href='#L685'>685</a>
+<a name='L686'></a><a href='#L686'>686</a>
+<a name='L687'></a><a href='#L687'>687</a>
+<a name='L688'></a><a href='#L688'>688</a>
+<a name='L689'></a><a href='#L689'>689</a>
+<a name='L690'></a><a href='#L690'>690</a>
+<a name='L691'></a><a href='#L691'>691</a>
+<a name='L692'></a><a href='#L692'>692</a>
+<a name='L693'></a><a href='#L693'>693</a>
+<a name='L694'></a><a href='#L694'>694</a>
+<a name='L695'></a><a href='#L695'>695</a>
+<a name='L696'></a><a href='#L696'>696</a>
+<a name='L697'></a><a href='#L697'>697</a>
+<a name='L698'></a><a href='#L698'>698</a>
+<a name='L699'></a><a href='#L699'>699</a>
+<a name='L700'></a><a href='#L700'>700</a>
+<a name='L701'></a><a href='#L701'>701</a>
+<a name='L702'></a><a href='#L702'>702</a>
+<a name='L703'></a><a href='#L703'>703</a>
+<a name='L704'></a><a href='#L704'>704</a>
+<a name='L705'></a><a href='#L705'>705</a>
+<a name='L706'></a><a href='#L706'>706</a>
+<a name='L707'></a><a href='#L707'>707</a>
+<a name='L708'></a><a href='#L708'>708</a>
+<a name='L709'></a><a href='#L709'>709</a>
+<a name='L710'></a><a href='#L710'>710</a>
+<a name='L711'></a><a href='#L711'>711</a>
+<a name='L712'></a><a href='#L712'>712</a>
+<a name='L713'></a><a href='#L713'>713</a>
+<a name='L714'></a><a href='#L714'>714</a>
+<a name='L715'></a><a href='#L715'>715</a>
+<a name='L716'></a><a href='#L716'>716</a>
+<a name='L717'></a><a href='#L717'>717</a>
+<a name='L718'></a><a href='#L718'>718</a>
+<a name='L719'></a><a href='#L719'>719</a>
+<a name='L720'></a><a href='#L720'>720</a>
+<a name='L721'></a><a href='#L721'>721</a>
+<a name='L722'></a><a href='#L722'>722</a>
+<a name='L723'></a><a href='#L723'>723</a>
+<a name='L724'></a><a href='#L724'>724</a>
+<a name='L725'></a><a href='#L725'>725</a>
+<a name='L726'></a><a href='#L726'>726</a>
+<a name='L727'></a><a href='#L727'>727</a>
+<a name='L728'></a><a href='#L728'>728</a>
+<a name='L729'></a><a href='#L729'>729</a>
+<a name='L730'></a><a href='#L730'>730</a>
+<a name='L731'></a><a href='#L731'>731</a>
+<a name='L732'></a><a href='#L732'>732</a>
+<a name='L733'></a><a href='#L733'>733</a>
+<a name='L734'></a><a href='#L734'>734</a>
+<a name='L735'></a><a href='#L735'>735</a>
+<a name='L736'></a><a href='#L736'>736</a>
+<a name='L737'></a><a href='#L737'>737</a>
+<a name='L738'></a><a href='#L738'>738</a>
+<a name='L739'></a><a href='#L739'>739</a>
+<a name='L740'></a><a href='#L740'>740</a>
+<a name='L741'></a><a href='#L741'>741</a>
+<a name='L742'></a><a href='#L742'>742</a>
+<a name='L743'></a><a href='#L743'>743</a>
+<a name='L744'></a><a href='#L744'>744</a>
+<a name='L745'></a><a href='#L745'>745</a>
+<a name='L746'></a><a href='#L746'>746</a>
+<a name='L747'></a><a href='#L747'>747</a>
+<a name='L748'></a><a href='#L748'>748</a>
+<a name='L749'></a><a href='#L749'>749</a>
+<a name='L750'></a><a href='#L750'>750</a>
+<a name='L751'></a><a href='#L751'>751</a>
+<a name='L752'></a><a href='#L752'>752</a>
+<a name='L753'></a><a href='#L753'>753</a>
+<a name='L754'></a><a href='#L754'>754</a>
+<a name='L755'></a><a href='#L755'>755</a>
+<a name='L756'></a><a href='#L756'>756</a>
+<a name='L757'></a><a href='#L757'>757</a>
+<a name='L758'></a><a href='#L758'>758</a>
+<a name='L759'></a><a href='#L759'>759</a>
+<a name='L760'></a><a href='#L760'>760</a>
+<a name='L761'></a><a href='#L761'>761</a>
+<a name='L762'></a><a href='#L762'>762</a>
+<a name='L763'></a><a href='#L763'>763</a>
+<a name='L764'></a><a href='#L764'>764</a>
+<a name='L765'></a><a href='#L765'>765</a>
+<a name='L766'></a><a href='#L766'>766</a>
+<a name='L767'></a><a href='#L767'>767</a>
+<a name='L768'></a><a href='#L768'>768</a>
+<a name='L769'></a><a href='#L769'>769</a>
+<a name='L770'></a><a href='#L770'>770</a>
+<a name='L771'></a><a href='#L771'>771</a>
+<a name='L772'></a><a href='#L772'>772</a>
+<a name='L773'></a><a href='#L773'>773</a>
+<a name='L774'></a><a href='#L774'>774</a>
+<a name='L775'></a><a href='#L775'>775</a>
+<a name='L776'></a><a href='#L776'>776</a>
+<a name='L777'></a><a href='#L777'>777</a>
+<a name='L778'></a><a href='#L778'>778</a>
+<a name='L779'></a><a href='#L779'>779</a>
+<a name='L780'></a><a href='#L780'>780</a>
+<a name='L781'></a><a href='#L781'>781</a>
+<a name='L782'></a><a href='#L782'>782</a>
+<a name='L783'></a><a href='#L783'>783</a>
+<a name='L784'></a><a href='#L784'>784</a>
+<a name='L785'></a><a href='#L785'>785</a>
+<a name='L786'></a><a href='#L786'>786</a>
+<a name='L787'></a><a href='#L787'>787</a>
+<a name='L788'></a><a href='#L788'>788</a>
+<a name='L789'></a><a href='#L789'>789</a>
+<a name='L790'></a><a href='#L790'>790</a>
+<a name='L791'></a><a href='#L791'>791</a>
+<a name='L792'></a><a href='#L792'>792</a>
+<a name='L793'></a><a href='#L793'>793</a>
+<a name='L794'></a><a href='#L794'>794</a>
+<a name='L795'></a><a href='#L795'>795</a>
+<a name='L796'></a><a href='#L796'>796</a>
+<a name='L797'></a><a href='#L797'>797</a>
+<a name='L798'></a><a href='#L798'>798</a>
+<a name='L799'></a><a href='#L799'>799</a>
+<a name='L800'></a><a href='#L800'>800</a>
+<a name='L801'></a><a href='#L801'>801</a>
+<a name='L802'></a><a href='#L802'>802</a>
+<a name='L803'></a><a href='#L803'>803</a>
+<a name='L804'></a><a href='#L804'>804</a>
+<a name='L805'></a><a href='#L805'>805</a>
+<a name='L806'></a><a href='#L806'>806</a>
+<a name='L807'></a><a href='#L807'>807</a>
+<a name='L808'></a><a href='#L808'>808</a>
+<a name='L809'></a><a href='#L809'>809</a>
+<a name='L810'></a><a href='#L810'>810</a>
+<a name='L811'></a><a href='#L811'>811</a>
+<a name='L812'></a><a href='#L812'>812</a>
+<a name='L813'></a><a href='#L813'>813</a>
+<a name='L814'></a><a href='#L814'>814</a>
+<a name='L815'></a><a href='#L815'>815</a>
+<a name='L816'></a><a href='#L816'>816</a>
+<a name='L817'></a><a href='#L817'>817</a>
+<a name='L818'></a><a href='#L818'>818</a>
+<a name='L819'></a><a href='#L819'>819</a>
+<a name='L820'></a><a href='#L820'>820</a>
+<a name='L821'></a><a href='#L821'>821</a>
+<a name='L822'></a><a href='#L822'>822</a>
+<a name='L823'></a><a href='#L823'>823</a>
+<a name='L824'></a><a href='#L824'>824</a>
+<a name='L825'></a><a href='#L825'>825</a>
+<a name='L826'></a><a href='#L826'>826</a>
+<a name='L827'></a><a href='#L827'>827</a>
+<a name='L828'></a><a href='#L828'>828</a>
+<a name='L829'></a><a href='#L829'>829</a>
+<a name='L830'></a><a href='#L830'>830</a>
+<a name='L831'></a><a href='#L831'>831</a>
+<a name='L832'></a><a href='#L832'>832</a>
+<a name='L833'></a><a href='#L833'>833</a>
+<a name='L834'></a><a href='#L834'>834</a>
+<a name='L835'></a><a href='#L835'>835</a>
+<a name='L836'></a><a href='#L836'>836</a>
+<a name='L837'></a><a href='#L837'>837</a>
+<a name='L838'></a><a href='#L838'>838</a>
+<a name='L839'></a><a href='#L839'>839</a>
+<a name='L840'></a><a href='#L840'>840</a>
+<a name='L841'></a><a href='#L841'>841</a>
+<a name='L842'></a><a href='#L842'>842</a>
+<a name='L843'></a><a href='#L843'>843</a>
+<a name='L844'></a><a href='#L844'>844</a>
+<a name='L845'></a><a href='#L845'>845</a>
+<a name='L846'></a><a href='#L846'>846</a>
+<a name='L847'></a><a href='#L847'>847</a>
+<a name='L848'></a><a href='#L848'>848</a>
+<a name='L849'></a><a href='#L849'>849</a>
+<a name='L850'></a><a href='#L850'>850</a>
+<a name='L851'></a><a href='#L851'>851</a>
+<a name='L852'></a><a href='#L852'>852</a>
+<a name='L853'></a><a href='#L853'>853</a>
+<a name='L854'></a><a href='#L854'>854</a>
+<a name='L855'></a><a href='#L855'>855</a>
+<a name='L856'></a><a href='#L856'>856</a>
+<a name='L857'></a><a href='#L857'>857</a>
+<a name='L858'></a><a href='#L858'>858</a>
+<a name='L859'></a><a href='#L859'>859</a>
+<a name='L860'></a><a href='#L860'>860</a>
+<a name='L861'></a><a href='#L861'>861</a>
+<a name='L862'></a><a href='#L862'>862</a>
+<a name='L863'></a><a href='#L863'>863</a>
+<a name='L864'></a><a href='#L864'>864</a>
+<a name='L865'></a><a href='#L865'>865</a>
+<a name='L866'></a><a href='#L866'>866</a>
+<a name='L867'></a><a href='#L867'>867</a>
+<a name='L868'></a><a href='#L868'>868</a>
+<a name='L869'></a><a href='#L869'>869</a>
+<a name='L870'></a><a href='#L870'>870</a>
+<a name='L871'></a><a href='#L871'>871</a>
+<a name='L872'></a><a href='#L872'>872</a>
+<a name='L873'></a><a href='#L873'>873</a>
+<a name='L874'></a><a href='#L874'>874</a>
+<a name='L875'></a><a href='#L875'>875</a>
+<a name='L876'></a><a href='#L876'>876</a>
+<a name='L877'></a><a href='#L877'>877</a>
+<a name='L878'></a><a href='#L878'>878</a>
+<a name='L879'></a><a href='#L879'>879</a>
+<a name='L880'></a><a href='#L880'>880</a>
+<a name='L881'></a><a href='#L881'>881</a>
+<a name='L882'></a><a href='#L882'>882</a>
+<a name='L883'></a><a href='#L883'>883</a>
+<a name='L884'></a><a href='#L884'>884</a>
+<a name='L885'></a><a href='#L885'>885</a>
+<a name='L886'></a><a href='#L886'>886</a>
+<a name='L887'></a><a href='#L887'>887</a>
+<a name='L888'></a><a href='#L888'>888</a>
+<a name='L889'></a><a href='#L889'>889</a>
+<a name='L890'></a><a href='#L890'>890</a>
+<a name='L891'></a><a href='#L891'>891</a>
+<a name='L892'></a><a href='#L892'>892</a>
+<a name='L893'></a><a href='#L893'>893</a>
+<a name='L894'></a><a href='#L894'>894</a>
+<a name='L895'></a><a href='#L895'>895</a>
+<a name='L896'></a><a href='#L896'>896</a>
+<a name='L897'></a><a href='#L897'>897</a>
+<a name='L898'></a><a href='#L898'>898</a>
+<a name='L899'></a><a href='#L899'>899</a>
+<a name='L900'></a><a href='#L900'>900</a>
+<a name='L901'></a><a href='#L901'>901</a>
+<a name='L902'></a><a href='#L902'>902</a>
+<a name='L903'></a><a href='#L903'>903</a>
+<a name='L904'></a><a href='#L904'>904</a>
+<a name='L905'></a><a href='#L905'>905</a>
+<a name='L906'></a><a href='#L906'>906</a>
+<a name='L907'></a><a href='#L907'>907</a>
+<a name='L908'></a><a href='#L908'>908</a>
+<a name='L909'></a><a href='#L909'>909</a>
+<a name='L910'></a><a href='#L910'>910</a>
+<a name='L911'></a><a href='#L911'>911</a>
+<a name='L912'></a><a href='#L912'>912</a>
+<a name='L913'></a><a href='#L913'>913</a>
+<a name='L914'></a><a href='#L914'>914</a>
+<a name='L915'></a><a href='#L915'>915</a>
+<a name='L916'></a><a href='#L916'>916</a>
+<a name='L917'></a><a href='#L917'>917</a>
+<a name='L918'></a><a href='#L918'>918</a>
+<a name='L919'></a><a href='#L919'>919</a>
+<a name='L920'></a><a href='#L920'>920</a>
+<a name='L921'></a><a href='#L921'>921</a>
+<a name='L922'></a><a href='#L922'>922</a>
+<a name='L923'></a><a href='#L923'>923</a>
+<a name='L924'></a><a href='#L924'>924</a>
+<a name='L925'></a><a href='#L925'>925</a>
+<a name='L926'></a><a href='#L926'>926</a>
+<a name='L927'></a><a href='#L927'>927</a>
+<a name='L928'></a><a href='#L928'>928</a>
+<a name='L929'></a><a href='#L929'>929</a>
+<a name='L930'></a><a href='#L930'>930</a>
+<a name='L931'></a><a href='#L931'>931</a>
+<a name='L932'></a><a href='#L932'>932</a>
+<a name='L933'></a><a href='#L933'>933</a>
+<a name='L934'></a><a href='#L934'>934</a>
+<a name='L935'></a><a href='#L935'>935</a>
+<a name='L936'></a><a href='#L936'>936</a>
+<a name='L937'></a><a href='#L937'>937</a>
+<a name='L938'></a><a href='#L938'>938</a>
+<a name='L939'></a><a href='#L939'>939</a>
+<a name='L940'></a><a href='#L940'>940</a>
+<a name='L941'></a><a href='#L941'>941</a>
+<a name='L942'></a><a href='#L942'>942</a>
+<a name='L943'></a><a href='#L943'>943</a>
+<a name='L944'></a><a href='#L944'>944</a>
+<a name='L945'></a><a href='#L945'>945</a>
+<a name='L946'></a><a href='#L946'>946</a>
+<a name='L947'></a><a href='#L947'>947</a>
+<a name='L948'></a><a href='#L948'>948</a>
+<a name='L949'></a><a href='#L949'>949</a>
+<a name='L950'></a><a href='#L950'>950</a>
+<a name='L951'></a><a href='#L951'>951</a>
+<a name='L952'></a><a href='#L952'>952</a>
+<a name='L953'></a><a href='#L953'>953</a>
+<a name='L954'></a><a href='#L954'>954</a>
+<a name='L955'></a><a href='#L955'>955</a>
+<a name='L956'></a><a href='#L956'>956</a>
+<a name='L957'></a><a href='#L957'>957</a>
+<a name='L958'></a><a href='#L958'>958</a>
+<a name='L959'></a><a href='#L959'>959</a>
+<a name='L960'></a><a href='#L960'>960</a>
+<a name='L961'></a><a href='#L961'>961</a>
+<a name='L962'></a><a href='#L962'>962</a>
+<a name='L963'></a><a href='#L963'>963</a>
+<a name='L964'></a><a href='#L964'>964</a>
+<a name='L965'></a><a href='#L965'>965</a>
+<a name='L966'></a><a href='#L966'>966</a>
+<a name='L967'></a><a href='#L967'>967</a>
+<a name='L968'></a><a href='#L968'>968</a>
+<a name='L969'></a><a href='#L969'>969</a>
+<a name='L970'></a><a href='#L970'>970</a>
+<a name='L971'></a><a href='#L971'>971</a>
+<a name='L972'></a><a href='#L972'>972</a>
+<a name='L973'></a><a href='#L973'>973</a>
+<a name='L974'></a><a href='#L974'>974</a>
+<a name='L975'></a><a href='#L975'>975</a>
+<a name='L976'></a><a href='#L976'>976</a>
+<a name='L977'></a><a href='#L977'>977</a>
+<a name='L978'></a><a href='#L978'>978</a>
+<a name='L979'></a><a href='#L979'>979</a>
+<a name='L980'></a><a href='#L980'>980</a>
+<a name='L981'></a><a href='#L981'>981</a>
+<a name='L982'></a><a href='#L982'>982</a>
+<a name='L983'></a><a href='#L983'>983</a>
+<a name='L984'></a><a href='#L984'>984</a>
+<a name='L985'></a><a href='#L985'>985</a>
+<a name='L986'></a><a href='#L986'>986</a>
+<a name='L987'></a><a href='#L987'>987</a>
+<a name='L988'></a><a href='#L988'>988</a>
+<a name='L989'></a><a href='#L989'>989</a>
+<a name='L990'></a><a href='#L990'>990</a>
+<a name='L991'></a><a href='#L991'>991</a>
+<a name='L992'></a><a href='#L992'>992</a>
+<a name='L993'></a><a href='#L993'>993</a>
+<a name='L994'></a><a href='#L994'>994</a>
+<a name='L995'></a><a href='#L995'>995</a>
+<a name='L996'></a><a href='#L996'>996</a>
+<a name='L997'></a><a href='#L997'>997</a>
+<a name='L998'></a><a href='#L998'>998</a>
+<a name='L999'></a><a href='#L999'>999</a>
+<a name='L1000'></a><a href='#L1000'>1000</a>
+<a name='L1001'></a><a href='#L1001'>1001</a>
+<a name='L1002'></a><a href='#L1002'>1002</a>
+<a name='L1003'></a><a href='#L1003'>1003</a>
+<a name='L1004'></a><a href='#L1004'>1004</a>
+<a name='L1005'></a><a href='#L1005'>1005</a>
+<a name='L1006'></a><a href='#L1006'>1006</a>
+<a name='L1007'></a><a href='#L1007'>1007</a>
+<a name='L1008'></a><a href='#L1008'>1008</a>
+<a name='L1009'></a><a href='#L1009'>1009</a>
+<a name='L1010'></a><a href='#L1010'>1010</a>
+<a name='L1011'></a><a href='#L1011'>1011</a>
+<a name='L1012'></a><a href='#L1012'>1012</a>
+<a name='L1013'></a><a href='#L1013'>1013</a>
+<a name='L1014'></a><a href='#L1014'>1014</a>
+<a name='L1015'></a><a href='#L1015'>1015</a>
+<a name='L1016'></a><a href='#L1016'>1016</a>
+<a name='L1017'></a><a href='#L1017'>1017</a>
+<a name='L1018'></a><a href='#L1018'>1018</a>
+<a name='L1019'></a><a href='#L1019'>1019</a>
+<a name='L1020'></a><a href='#L1020'>1020</a>
+<a name='L1021'></a><a href='#L1021'>1021</a>
+<a name='L1022'></a><a href='#L1022'>1022</a>
+<a name='L1023'></a><a href='#L1023'>1023</a>
+<a name='L1024'></a><a href='#L1024'>1024</a>
+<a name='L1025'></a><a href='#L1025'>1025</a>
+<a name='L1026'></a><a href='#L1026'>1026</a>
+<a name='L1027'></a><a href='#L1027'>1027</a>
+<a name='L1028'></a><a href='#L1028'>1028</a>
+<a name='L1029'></a><a href='#L1029'>1029</a>
+<a name='L1030'></a><a href='#L1030'>1030</a>
+<a name='L1031'></a><a href='#L1031'>1031</a>
+<a name='L1032'></a><a href='#L1032'>1032</a>
+<a name='L1033'></a><a href='#L1033'>1033</a>
+<a name='L1034'></a><a href='#L1034'>1034</a>
+<a name='L1035'></a><a href='#L1035'>1035</a>
+<a name='L1036'></a><a href='#L1036'>1036</a>
+<a name='L1037'></a><a href='#L1037'>1037</a>
+<a name='L1038'></a><a href='#L1038'>1038</a>
+<a name='L1039'></a><a href='#L1039'>1039</a>
+<a name='L1040'></a><a href='#L1040'>1040</a>
+<a name='L1041'></a><a href='#L1041'>1041</a>
+<a name='L1042'></a><a href='#L1042'>1042</a>
+<a name='L1043'></a><a href='#L1043'>1043</a>
+<a name='L1044'></a><a href='#L1044'>1044</a>
+<a name='L1045'></a><a href='#L1045'>1045</a>
+<a name='L1046'></a><a href='#L1046'>1046</a>
+<a name='L1047'></a><a href='#L1047'>1047</a>
+<a name='L1048'></a><a href='#L1048'>1048</a>
+<a name='L1049'></a><a href='#L1049'>1049</a>
+<a name='L1050'></a><a href='#L1050'>1050</a>
+<a name='L1051'></a><a href='#L1051'>1051</a>
+<a name='L1052'></a><a href='#L1052'>1052</a>
+<a name='L1053'></a><a href='#L1053'>1053</a>
+<a name='L1054'></a><a href='#L1054'>1054</a>
+<a name='L1055'></a><a href='#L1055'>1055</a>
+<a name='L1056'></a><a href='#L1056'>1056</a>
+<a name='L1057'></a><a href='#L1057'>1057</a>
+<a name='L1058'></a><a href='#L1058'>1058</a>
+<a name='L1059'></a><a href='#L1059'>1059</a>
+<a name='L1060'></a><a href='#L1060'>1060</a>
+<a name='L1061'></a><a href='#L1061'>1061</a>
+<a name='L1062'></a><a href='#L1062'>1062</a>
+<a name='L1063'></a><a href='#L1063'>1063</a>
+<a name='L1064'></a><a href='#L1064'>1064</a>
+<a name='L1065'></a><a href='#L1065'>1065</a>
+<a name='L1066'></a><a href='#L1066'>1066</a>
+<a name='L1067'></a><a href='#L1067'>1067</a>
+<a name='L1068'></a><a href='#L1068'>1068</a>
+<a name='L1069'></a><a href='#L1069'>1069</a>
+<a name='L1070'></a><a href='#L1070'>1070</a>
+<a name='L1071'></a><a href='#L1071'>1071</a>
+<a name='L1072'></a><a href='#L1072'>1072</a>
+<a name='L1073'></a><a href='#L1073'>1073</a>
+<a name='L1074'></a><a href='#L1074'>1074</a>
+<a name='L1075'></a><a href='#L1075'>1075</a>
+<a name='L1076'></a><a href='#L1076'>1076</a>
+<a name='L1077'></a><a href='#L1077'>1077</a>
+<a name='L1078'></a><a href='#L1078'>1078</a>
+<a name='L1079'></a><a href='#L1079'>1079</a>
+<a name='L1080'></a><a href='#L1080'>1080</a>
+<a name='L1081'></a><a href='#L1081'>1081</a>
+<a name='L1082'></a><a href='#L1082'>1082</a>
+<a name='L1083'></a><a href='#L1083'>1083</a>
+<a name='L1084'></a><a href='#L1084'>1084</a>
+<a name='L1085'></a><a href='#L1085'>1085</a>
+<a name='L1086'></a><a href='#L1086'>1086</a>
+<a name='L1087'></a><a href='#L1087'>1087</a>
+<a name='L1088'></a><a href='#L1088'>1088</a>
+<a name='L1089'></a><a href='#L1089'>1089</a>
+<a name='L1090'></a><a href='#L1090'>1090</a>
+<a name='L1091'></a><a href='#L1091'>1091</a>
+<a name='L1092'></a><a href='#L1092'>1092</a>
+<a name='L1093'></a><a href='#L1093'>1093</a>
+<a name='L1094'></a><a href='#L1094'>1094</a>
+<a name='L1095'></a><a href='#L1095'>1095</a>
+<a name='L1096'></a><a href='#L1096'>1096</a>
+<a name='L1097'></a><a href='#L1097'>1097</a>
+<a name='L1098'></a><a href='#L1098'>1098</a>
+<a name='L1099'></a><a href='#L1099'>1099</a>
+<a name='L1100'></a><a href='#L1100'>1100</a>
+<a name='L1101'></a><a href='#L1101'>1101</a>
+<a name='L1102'></a><a href='#L1102'>1102</a>
+<a name='L1103'></a><a href='#L1103'>1103</a>
+<a name='L1104'></a><a href='#L1104'>1104</a>
+<a name='L1105'></a><a href='#L1105'>1105</a>
+<a name='L1106'></a><a href='#L1106'>1106</a>
+<a name='L1107'></a><a href='#L1107'>1107</a>
+<a name='L1108'></a><a href='#L1108'>1108</a>
+<a name='L1109'></a><a href='#L1109'>1109</a>
+<a name='L1110'></a><a href='#L1110'>1110</a>
+<a name='L1111'></a><a href='#L1111'>1111</a>
+<a name='L1112'></a><a href='#L1112'>1112</a>
+<a name='L1113'></a><a href='#L1113'>1113</a>
+<a name='L1114'></a><a href='#L1114'>1114</a>
+<a name='L1115'></a><a href='#L1115'>1115</a>
+<a name='L1116'></a><a href='#L1116'>1116</a>
+<a name='L1117'></a><a href='#L1117'>1117</a>
+<a name='L1118'></a><a href='#L1118'>1118</a>
+<a name='L1119'></a><a href='#L1119'>1119</a>
+<a name='L1120'></a><a href='#L1120'>1120</a>
+<a name='L1121'></a><a href='#L1121'>1121</a>
+<a name='L1122'></a><a href='#L1122'>1122</a>
+<a name='L1123'></a><a href='#L1123'>1123</a>
+<a name='L1124'></a><a href='#L1124'>1124</a>
+<a name='L1125'></a><a href='#L1125'>1125</a>
+<a name='L1126'></a><a href='#L1126'>1126</a>
+<a name='L1127'></a><a href='#L1127'>1127</a>
+<a name='L1128'></a><a href='#L1128'>1128</a>
+<a name='L1129'></a><a href='#L1129'>1129</a>
+<a name='L1130'></a><a href='#L1130'>1130</a>
+<a name='L1131'></a><a href='#L1131'>1131</a>
+<a name='L1132'></a><a href='#L1132'>1132</a>
+<a name='L1133'></a><a href='#L1133'>1133</a>
+<a name='L1134'></a><a href='#L1134'>1134</a>
+<a name='L1135'></a><a href='#L1135'>1135</a>
+<a name='L1136'></a><a href='#L1136'>1136</a>
+<a name='L1137'></a><a href='#L1137'>1137</a>
+<a name='L1138'></a><a href='#L1138'>1138</a>
+<a name='L1139'></a><a href='#L1139'>1139</a>
+<a name='L1140'></a><a href='#L1140'>1140</a>
+<a name='L1141'></a><a href='#L1141'>1141</a>
+<a name='L1142'></a><a href='#L1142'>1142</a>
+<a name='L1143'></a><a href='#L1143'>1143</a>
+<a name='L1144'></a><a href='#L1144'>1144</a>
+<a name='L1145'></a><a href='#L1145'>1145</a>
+<a name='L1146'></a><a href='#L1146'>1146</a>
+<a name='L1147'></a><a href='#L1147'>1147</a>
+<a name='L1148'></a><a href='#L1148'>1148</a>
+<a name='L1149'></a><a href='#L1149'>1149</a>
+<a name='L1150'></a><a href='#L1150'>1150</a>
+<a name='L1151'></a><a href='#L1151'>1151</a>
+<a name='L1152'></a><a href='#L1152'>1152</a>
+<a name='L1153'></a><a href='#L1153'>1153</a>
+<a name='L1154'></a><a href='#L1154'>1154</a>
+<a name='L1155'></a><a href='#L1155'>1155</a>
+<a name='L1156'></a><a href='#L1156'>1156</a>
+<a name='L1157'></a><a href='#L1157'>1157</a>
+<a name='L1158'></a><a href='#L1158'>1158</a>
+<a name='L1159'></a><a href='#L1159'>1159</a>
+<a name='L1160'></a><a href='#L1160'>1160</a>
+<a name='L1161'></a><a href='#L1161'>1161</a>
+<a name='L1162'></a><a href='#L1162'>1162</a>
+<a name='L1163'></a><a href='#L1163'>1163</a>
+<a name='L1164'></a><a href='#L1164'>1164</a>
+<a name='L1165'></a><a href='#L1165'>1165</a>
+<a name='L1166'></a><a href='#L1166'>1166</a>
+<a name='L1167'></a><a href='#L1167'>1167</a>
+<a name='L1168'></a><a href='#L1168'>1168</a>
+<a name='L1169'></a><a href='#L1169'>1169</a>
+<a name='L1170'></a><a href='#L1170'>1170</a>
+<a name='L1171'></a><a href='#L1171'>1171</a>
+<a name='L1172'></a><a href='#L1172'>1172</a>
+<a name='L1173'></a><a href='#L1173'>1173</a>
+<a name='L1174'></a><a href='#L1174'>1174</a>
+<a name='L1175'></a><a href='#L1175'>1175</a>
+<a name='L1176'></a><a href='#L1176'>1176</a>
+<a name='L1177'></a><a href='#L1177'>1177</a>
+<a name='L1178'></a><a href='#L1178'>1178</a>
+<a name='L1179'></a><a href='#L1179'>1179</a>
+<a name='L1180'></a><a href='#L1180'>1180</a>
+<a name='L1181'></a><a href='#L1181'>1181</a>
+<a name='L1182'></a><a href='#L1182'>1182</a>
+<a name='L1183'></a><a href='#L1183'>1183</a>
+<a name='L1184'></a><a href='#L1184'>1184</a>
+<a name='L1185'></a><a href='#L1185'>1185</a>
+<a name='L1186'></a><a href='#L1186'>1186</a>
+<a name='L1187'></a><a href='#L1187'>1187</a>
+<a name='L1188'></a><a href='#L1188'>1188</a>
+<a name='L1189'></a><a href='#L1189'>1189</a>
+<a name='L1190'></a><a href='#L1190'>1190</a>
+<a name='L1191'></a><a href='#L1191'>1191</a>
+<a name='L1192'></a><a href='#L1192'>1192</a>
+<a name='L1193'></a><a href='#L1193'>1193</a>
+<a name='L1194'></a><a href='#L1194'>1194</a>
+<a name='L1195'></a><a href='#L1195'>1195</a>
+<a name='L1196'></a><a href='#L1196'>1196</a>
+<a name='L1197'></a><a href='#L1197'>1197</a>
+<a name='L1198'></a><a href='#L1198'>1198</a>
+<a name='L1199'></a><a href='#L1199'>1199</a>
+<a name='L1200'></a><a href='#L1200'>1200</a>
+<a name='L1201'></a><a href='#L1201'>1201</a>
+<a name='L1202'></a><a href='#L1202'>1202</a>
+<a name='L1203'></a><a href='#L1203'>1203</a>
+<a name='L1204'></a><a href='#L1204'>1204</a>
+<a name='L1205'></a><a href='#L1205'>1205</a>
+<a name='L1206'></a><a href='#L1206'>1206</a>
+<a name='L1207'></a><a href='#L1207'>1207</a>
+<a name='L1208'></a><a href='#L1208'>1208</a>
+<a name='L1209'></a><a href='#L1209'>1209</a>
+<a name='L1210'></a><a href='#L1210'>1210</a>
+<a name='L1211'></a><a href='#L1211'>1211</a>
+<a name='L1212'></a><a href='#L1212'>1212</a>
+<a name='L1213'></a><a href='#L1213'>1213</a>
+<a name='L1214'></a><a href='#L1214'>1214</a>
+<a name='L1215'></a><a href='#L1215'>1215</a>
+<a name='L1216'></a><a href='#L1216'>1216</a>
+<a name='L1217'></a><a href='#L1217'>1217</a>
+<a name='L1218'></a><a href='#L1218'>1218</a>
+<a name='L1219'></a><a href='#L1219'>1219</a>
+<a name='L1220'></a><a href='#L1220'>1220</a>
+<a name='L1221'></a><a href='#L1221'>1221</a>
+<a name='L1222'></a><a href='#L1222'>1222</a>
+<a name='L1223'></a><a href='#L1223'>1223</a>
+<a name='L1224'></a><a href='#L1224'>1224</a>
+<a name='L1225'></a><a href='#L1225'>1225</a>
+<a name='L1226'></a><a href='#L1226'>1226</a>
+<a name='L1227'></a><a href='#L1227'>1227</a>
+<a name='L1228'></a><a href='#L1228'>1228</a>
+<a name='L1229'></a><a href='#L1229'>1229</a>
+<a name='L1230'></a><a href='#L1230'>1230</a>
+<a name='L1231'></a><a href='#L1231'>1231</a>
+<a name='L1232'></a><a href='#L1232'>1232</a>
+<a name='L1233'></a><a href='#L1233'>1233</a>
+<a name='L1234'></a><a href='#L1234'>1234</a>
+<a name='L1235'></a><a href='#L1235'>1235</a>
+<a name='L1236'></a><a href='#L1236'>1236</a>
+<a name='L1237'></a><a href='#L1237'>1237</a>
+<a name='L1238'></a><a href='#L1238'>1238</a>
+<a name='L1239'></a><a href='#L1239'>1239</a>
+<a name='L1240'></a><a href='#L1240'>1240</a>
+<a name='L1241'></a><a href='#L1241'>1241</a>
+<a name='L1242'></a><a href='#L1242'>1242</a>
+<a name='L1243'></a><a href='#L1243'>1243</a>
+<a name='L1244'></a><a href='#L1244'>1244</a>
+<a name='L1245'></a><a href='#L1245'>1245</a>
+<a name='L1246'></a><a href='#L1246'>1246</a>
+<a name='L1247'></a><a href='#L1247'>1247</a>
+<a name='L1248'></a><a href='#L1248'>1248</a>
+<a name='L1249'></a><a href='#L1249'>1249</a>
+<a name='L1250'></a><a href='#L1250'>1250</a>
+<a name='L1251'></a><a href='#L1251'>1251</a>
+<a name='L1252'></a><a href='#L1252'>1252</a>
+<a name='L1253'></a><a href='#L1253'>1253</a>
+<a name='L1254'></a><a href='#L1254'>1254</a>
+<a name='L1255'></a><a href='#L1255'>1255</a>
+<a name='L1256'></a><a href='#L1256'>1256</a>
+<a name='L1257'></a><a href='#L1257'>1257</a>
+<a name='L1258'></a><a href='#L1258'>1258</a>
+<a name='L1259'></a><a href='#L1259'>1259</a>
+<a name='L1260'></a><a href='#L1260'>1260</a>
+<a name='L1261'></a><a href='#L1261'>1261</a>
+<a name='L1262'></a><a href='#L1262'>1262</a>
+<a name='L1263'></a><a href='#L1263'>1263</a>
+<a name='L1264'></a><a href='#L1264'>1264</a>
+<a name='L1265'></a><a href='#L1265'>1265</a>
+<a name='L1266'></a><a href='#L1266'>1266</a>
+<a name='L1267'></a><a href='#L1267'>1267</a>
+<a name='L1268'></a><a href='#L1268'>1268</a>
+<a name='L1269'></a><a href='#L1269'>1269</a>
+<a name='L1270'></a><a href='#L1270'>1270</a>
+<a name='L1271'></a><a href='#L1271'>1271</a>
+<a name='L1272'></a><a href='#L1272'>1272</a>
+<a name='L1273'></a><a href='#L1273'>1273</a>
+<a name='L1274'></a><a href='#L1274'>1274</a>
+<a name='L1275'></a><a href='#L1275'>1275</a>
+<a name='L1276'></a><a href='#L1276'>1276</a>
+<a name='L1277'></a><a href='#L1277'>1277</a>
+<a name='L1278'></a><a href='#L1278'>1278</a>
+<a name='L1279'></a><a href='#L1279'>1279</a>
+<a name='L1280'></a><a href='#L1280'>1280</a>
+<a name='L1281'></a><a href='#L1281'>1281</a>
+<a name='L1282'></a><a href='#L1282'>1282</a>
+<a name='L1283'></a><a href='#L1283'>1283</a>
+<a name='L1284'></a><a href='#L1284'>1284</a>
+<a name='L1285'></a><a href='#L1285'>1285</a>
+<a name='L1286'></a><a href='#L1286'>1286</a>
+<a name='L1287'></a><a href='#L1287'>1287</a>
+<a name='L1288'></a><a href='#L1288'>1288</a>
+<a name='L1289'></a><a href='#L1289'>1289</a>
+<a name='L1290'></a><a href='#L1290'>1290</a>
+<a name='L1291'></a><a href='#L1291'>1291</a>
+<a name='L1292'></a><a href='#L1292'>1292</a>
+<a name='L1293'></a><a href='#L1293'>1293</a>
+<a name='L1294'></a><a href='#L1294'>1294</a>
+<a name='L1295'></a><a href='#L1295'>1295</a>
+<a name='L1296'></a><a href='#L1296'>1296</a>
+<a name='L1297'></a><a href='#L1297'>1297</a>
+<a name='L1298'></a><a href='#L1298'>1298</a>
+<a name='L1299'></a><a href='#L1299'>1299</a>
+<a name='L1300'></a><a href='#L1300'>1300</a>
+<a name='L1301'></a><a href='#L1301'>1301</a>
+<a name='L1302'></a><a href='#L1302'>1302</a>
+<a name='L1303'></a><a href='#L1303'>1303</a>
+<a name='L1304'></a><a href='#L1304'>1304</a>
+<a name='L1305'></a><a href='#L1305'>1305</a>
+<a name='L1306'></a><a href='#L1306'>1306</a>
+<a name='L1307'></a><a href='#L1307'>1307</a>
+<a name='L1308'></a><a href='#L1308'>1308</a>
+<a name='L1309'></a><a href='#L1309'>1309</a>
+<a name='L1310'></a><a href='#L1310'>1310</a>
+<a name='L1311'></a><a href='#L1311'>1311</a>
+<a name='L1312'></a><a href='#L1312'>1312</a>
+<a name='L1313'></a><a href='#L1313'>1313</a>
+<a name='L1314'></a><a href='#L1314'>1314</a>
+<a name='L1315'></a><a href='#L1315'>1315</a>
+<a name='L1316'></a><a href='#L1316'>1316</a>
+<a name='L1317'></a><a href='#L1317'>1317</a>
+<a name='L1318'></a><a href='#L1318'>1318</a>
+<a name='L1319'></a><a href='#L1319'>1319</a>
+<a name='L1320'></a><a href='#L1320'>1320</a>
+<a name='L1321'></a><a href='#L1321'>1321</a>
+<a name='L1322'></a><a href='#L1322'>1322</a>
+<a name='L1323'></a><a href='#L1323'>1323</a>
+<a name='L1324'></a><a href='#L1324'>1324</a>
+<a name='L1325'></a><a href='#L1325'>1325</a>
+<a name='L1326'></a><a href='#L1326'>1326</a>
+<a name='L1327'></a><a href='#L1327'>1327</a>
+<a name='L1328'></a><a href='#L1328'>1328</a>
+<a name='L1329'></a><a href='#L1329'>1329</a>
+<a name='L1330'></a><a href='#L1330'>1330</a>
+<a name='L1331'></a><a href='#L1331'>1331</a>
+<a name='L1332'></a><a href='#L1332'>1332</a>
+<a name='L1333'></a><a href='#L1333'>1333</a>
+<a name='L1334'></a><a href='#L1334'>1334</a>
+<a name='L1335'></a><a href='#L1335'>1335</a>
+<a name='L1336'></a><a href='#L1336'>1336</a>
+<a name='L1337'></a><a href='#L1337'>1337</a>
+<a name='L1338'></a><a href='#L1338'>1338</a>
+<a name='L1339'></a><a href='#L1339'>1339</a>
+<a name='L1340'></a><a href='#L1340'>1340</a>
+<a name='L1341'></a><a href='#L1341'>1341</a>
+<a name='L1342'></a><a href='#L1342'>1342</a>
+<a name='L1343'></a><a href='#L1343'>1343</a>
+<a name='L1344'></a><a href='#L1344'>1344</a>
+<a name='L1345'></a><a href='#L1345'>1345</a>
+<a name='L1346'></a><a href='#L1346'>1346</a>
+<a name='L1347'></a><a href='#L1347'>1347</a>
+<a name='L1348'></a><a href='#L1348'>1348</a>
+<a name='L1349'></a><a href='#L1349'>1349</a>
+<a name='L1350'></a><a href='#L1350'>1350</a>
+<a name='L1351'></a><a href='#L1351'>1351</a>
+<a name='L1352'></a><a href='#L1352'>1352</a>
+<a name='L1353'></a><a href='#L1353'>1353</a>
+<a name='L1354'></a><a href='#L1354'>1354</a>
+<a name='L1355'></a><a href='#L1355'>1355</a>
+<a name='L1356'></a><a href='#L1356'>1356</a>
+<a name='L1357'></a><a href='#L1357'>1357</a>
+<a name='L1358'></a><a href='#L1358'>1358</a>
+<a name='L1359'></a><a href='#L1359'>1359</a>
+<a name='L1360'></a><a href='#L1360'>1360</a>
+<a name='L1361'></a><a href='#L1361'>1361</a>
+<a name='L1362'></a><a href='#L1362'>1362</a>
+<a name='L1363'></a><a href='#L1363'>1363</a>
+<a name='L1364'></a><a href='#L1364'>1364</a>
+<a name='L1365'></a><a href='#L1365'>1365</a>
+<a name='L1366'></a><a href='#L1366'>1366</a>
+<a name='L1367'></a><a href='#L1367'>1367</a>
+<a name='L1368'></a><a href='#L1368'>1368</a>
+<a name='L1369'></a><a href='#L1369'>1369</a>
+<a name='L1370'></a><a href='#L1370'>1370</a>
+<a name='L1371'></a><a href='#L1371'>1371</a>
+<a name='L1372'></a><a href='#L1372'>1372</a>
+<a name='L1373'></a><a href='#L1373'>1373</a>
+<a name='L1374'></a><a href='#L1374'>1374</a>
+<a name='L1375'></a><a href='#L1375'>1375</a>
+<a name='L1376'></a><a href='#L1376'>1376</a>
+<a name='L1377'></a><a href='#L1377'>1377</a>
+<a name='L1378'></a><a href='#L1378'>1378</a>
+<a name='L1379'></a><a href='#L1379'>1379</a>
+<a name='L1380'></a><a href='#L1380'>1380</a>
+<a name='L1381'></a><a href='#L1381'>1381</a>
+<a name='L1382'></a><a href='#L1382'>1382</a>
+<a name='L1383'></a><a href='#L1383'>1383</a>
+<a name='L1384'></a><a href='#L1384'>1384</a>
+<a name='L1385'></a><a href='#L1385'>1385</a>
+<a name='L1386'></a><a href='#L1386'>1386</a>
+<a name='L1387'></a><a href='#L1387'>1387</a>
+<a name='L1388'></a><a href='#L1388'>1388</a>
+<a name='L1389'></a><a href='#L1389'>1389</a>
+<a name='L1390'></a><a href='#L1390'>1390</a>
+<a name='L1391'></a><a href='#L1391'>1391</a>
+<a name='L1392'></a><a href='#L1392'>1392</a>
+<a name='L1393'></a><a href='#L1393'>1393</a>
+<a name='L1394'></a><a href='#L1394'>1394</a>
+<a name='L1395'></a><a href='#L1395'>1395</a>
+<a name='L1396'></a><a href='#L1396'>1396</a>
+<a name='L1397'></a><a href='#L1397'>1397</a>
+<a name='L1398'></a><a href='#L1398'>1398</a>
+<a name='L1399'></a><a href='#L1399'>1399</a>
+<a name='L1400'></a><a href='#L1400'>1400</a>
+<a name='L1401'></a><a href='#L1401'>1401</a>
+<a name='L1402'></a><a href='#L1402'>1402</a>
+<a name='L1403'></a><a href='#L1403'>1403</a>
+<a name='L1404'></a><a href='#L1404'>1404</a>
+<a name='L1405'></a><a href='#L1405'>1405</a>
+<a name='L1406'></a><a href='#L1406'>1406</a>
+<a name='L1407'></a><a href='#L1407'>1407</a>
+<a name='L1408'></a><a href='#L1408'>1408</a>
+<a name='L1409'></a><a href='#L1409'>1409</a>
+<a name='L1410'></a><a href='#L1410'>1410</a>
+<a name='L1411'></a><a href='#L1411'>1411</a>
+<a name='L1412'></a><a href='#L1412'>1412</a>
+<a name='L1413'></a><a href='#L1413'>1413</a>
+<a name='L1414'></a><a href='#L1414'>1414</a>
+<a name='L1415'></a><a href='#L1415'>1415</a>
+<a name='L1416'></a><a href='#L1416'>1416</a>
+<a name='L1417'></a><a href='#L1417'>1417</a>
+<a name='L1418'></a><a href='#L1418'>1418</a>
+<a name='L1419'></a><a href='#L1419'>1419</a>
+<a name='L1420'></a><a href='#L1420'>1420</a>
+<a name='L1421'></a><a href='#L1421'>1421</a>
+<a name='L1422'></a><a href='#L1422'>1422</a>
+<a name='L1423'></a><a href='#L1423'>1423</a>
+<a name='L1424'></a><a href='#L1424'>1424</a>
+<a name='L1425'></a><a href='#L1425'>1425</a>
+<a name='L1426'></a><a href='#L1426'>1426</a>
+<a name='L1427'></a><a href='#L1427'>1427</a>
+<a name='L1428'></a><a href='#L1428'>1428</a>
+<a name='L1429'></a><a href='#L1429'>1429</a>
+<a name='L1430'></a><a href='#L1430'>1430</a>
+<a name='L1431'></a><a href='#L1431'>1431</a>
+<a name='L1432'></a><a href='#L1432'>1432</a>
+<a name='L1433'></a><a href='#L1433'>1433</a>
+<a name='L1434'></a><a href='#L1434'>1434</a>
+<a name='L1435'></a><a href='#L1435'>1435</a>
+<a name='L1436'></a><a href='#L1436'>1436</a>
+<a name='L1437'></a><a href='#L1437'>1437</a>
+<a name='L1438'></a><a href='#L1438'>1438</a>
+<a name='L1439'></a><a href='#L1439'>1439</a>
+<a name='L1440'></a><a href='#L1440'>1440</a>
+<a name='L1441'></a><a href='#L1441'>1441</a>
+<a name='L1442'></a><a href='#L1442'>1442</a>
+<a name='L1443'></a><a href='#L1443'>1443</a>
+<a name='L1444'></a><a href='#L1444'>1444</a>
+<a name='L1445'></a><a href='#L1445'>1445</a>
+<a name='L1446'></a><a href='#L1446'>1446</a>
+<a name='L1447'></a><a href='#L1447'>1447</a>
+<a name='L1448'></a><a href='#L1448'>1448</a>
+<a name='L1449'></a><a href='#L1449'>1449</a>
+<a name='L1450'></a><a href='#L1450'>1450</a>
+<a name='L1451'></a><a href='#L1451'>1451</a>
+<a name='L1452'></a><a href='#L1452'>1452</a>
+<a name='L1453'></a><a href='#L1453'>1453</a>
+<a name='L1454'></a><a href='#L1454'>1454</a>
+<a name='L1455'></a><a href='#L1455'>1455</a>
+<a name='L1456'></a><a href='#L1456'>1456</a>
+<a name='L1457'></a><a href='#L1457'>1457</a>
+<a name='L1458'></a><a href='#L1458'>1458</a>
+<a name='L1459'></a><a href='#L1459'>1459</a>
+<a name='L1460'></a><a href='#L1460'>1460</a>
+<a name='L1461'></a><a href='#L1461'>1461</a>
+<a name='L1462'></a><a href='#L1462'>1462</a>
+<a name='L1463'></a><a href='#L1463'>1463</a>
+<a name='L1464'></a><a href='#L1464'>1464</a>
+<a name='L1465'></a><a href='#L1465'>1465</a>
+<a name='L1466'></a><a href='#L1466'>1466</a>
+<a name='L1467'></a><a href='#L1467'>1467</a>
+<a name='L1468'></a><a href='#L1468'>1468</a>
+<a name='L1469'></a><a href='#L1469'>1469</a>
+<a name='L1470'></a><a href='#L1470'>1470</a>
+<a name='L1471'></a><a href='#L1471'>1471</a>
+<a name='L1472'></a><a href='#L1472'>1472</a>
+<a name='L1473'></a><a href='#L1473'>1473</a>
+<a name='L1474'></a><a href='#L1474'>1474</a>
+<a name='L1475'></a><a href='#L1475'>1475</a>
+<a name='L1476'></a><a href='#L1476'>1476</a>
+<a name='L1477'></a><a href='#L1477'>1477</a>
+<a name='L1478'></a><a href='#L1478'>1478</a>
+<a name='L1479'></a><a href='#L1479'>1479</a>
+<a name='L1480'></a><a href='#L1480'>1480</a>
+<a name='L1481'></a><a href='#L1481'>1481</a>
+<a name='L1482'></a><a href='#L1482'>1482</a>
+<a name='L1483'></a><a href='#L1483'>1483</a>
+<a name='L1484'></a><a href='#L1484'>1484</a>
+<a name='L1485'></a><a href='#L1485'>1485</a>
+<a name='L1486'></a><a href='#L1486'>1486</a>
+<a name='L1487'></a><a href='#L1487'>1487</a>
+<a name='L1488'></a><a href='#L1488'>1488</a>
+<a name='L1489'></a><a href='#L1489'>1489</a>
+<a name='L1490'></a><a href='#L1490'>1490</a>
+<a name='L1491'></a><a href='#L1491'>1491</a>
+<a name='L1492'></a><a href='#L1492'>1492</a>
+<a name='L1493'></a><a href='#L1493'>1493</a>
+<a name='L1494'></a><a href='#L1494'>1494</a>
+<a name='L1495'></a><a href='#L1495'>1495</a>
+<a name='L1496'></a><a href='#L1496'>1496</a>
+<a name='L1497'></a><a href='#L1497'>1497</a>
+<a name='L1498'></a><a href='#L1498'>1498</a>
+<a name='L1499'></a><a href='#L1499'>1499</a>
+<a name='L1500'></a><a href='#L1500'>1500</a>
+<a name='L1501'></a><a href='#L1501'>1501</a>
+<a name='L1502'></a><a href='#L1502'>1502</a>
+<a name='L1503'></a><a href='#L1503'>1503</a>
+<a name='L1504'></a><a href='#L1504'>1504</a>
+<a name='L1505'></a><a href='#L1505'>1505</a>
+<a name='L1506'></a><a href='#L1506'>1506</a>
+<a name='L1507'></a><a href='#L1507'>1507</a>
+<a name='L1508'></a><a href='#L1508'>1508</a>
+<a name='L1509'></a><a href='#L1509'>1509</a>
+<a name='L1510'></a><a href='#L1510'>1510</a>
+<a name='L1511'></a><a href='#L1511'>1511</a>
+<a name='L1512'></a><a href='#L1512'>1512</a>
+<a name='L1513'></a><a href='#L1513'>1513</a>
+<a name='L1514'></a><a href='#L1514'>1514</a>
+<a name='L1515'></a><a href='#L1515'>1515</a>
+<a name='L1516'></a><a href='#L1516'>1516</a>
+<a name='L1517'></a><a href='#L1517'>1517</a>
+<a name='L1518'></a><a href='#L1518'>1518</a>
+<a name='L1519'></a><a href='#L1519'>1519</a>
+<a name='L1520'></a><a href='#L1520'>1520</a>
+<a name='L1521'></a><a href='#L1521'>1521</a>
+<a name='L1522'></a><a href='#L1522'>1522</a>
+<a name='L1523'></a><a href='#L1523'>1523</a>
+<a name='L1524'></a><a href='#L1524'>1524</a>
+<a name='L1525'></a><a href='#L1525'>1525</a>
+<a name='L1526'></a><a href='#L1526'>1526</a>
+<a name='L1527'></a><a href='#L1527'>1527</a>
+<a name='L1528'></a><a href='#L1528'>1528</a>
+<a name='L1529'></a><a href='#L1529'>1529</a>
+<a name='L1530'></a><a href='#L1530'>1530</a>
+<a name='L1531'></a><a href='#L1531'>1531</a>
+<a name='L1532'></a><a href='#L1532'>1532</a>
+<a name='L1533'></a><a href='#L1533'>1533</a>
+<a name='L1534'></a><a href='#L1534'>1534</a>
+<a name='L1535'></a><a href='#L1535'>1535</a>
+<a name='L1536'></a><a href='#L1536'>1536</a>
+<a name='L1537'></a><a href='#L1537'>1537</a>
+<a name='L1538'></a><a href='#L1538'>1538</a>
+<a name='L1539'></a><a href='#L1539'>1539</a>
+<a name='L1540'></a><a href='#L1540'>1540</a>
+<a name='L1541'></a><a href='#L1541'>1541</a>
+<a name='L1542'></a><a href='#L1542'>1542</a>
+<a name='L1543'></a><a href='#L1543'>1543</a>
+<a name='L1544'></a><a href='#L1544'>1544</a>
+<a name='L1545'></a><a href='#L1545'>1545</a>
+<a name='L1546'></a><a href='#L1546'>1546</a>
+<a name='L1547'></a><a href='#L1547'>1547</a>
+<a name='L1548'></a><a href='#L1548'>1548</a>
+<a name='L1549'></a><a href='#L1549'>1549</a>
+<a name='L1550'></a><a href='#L1550'>1550</a>
+<a name='L1551'></a><a href='#L1551'>1551</a>
+<a name='L1552'></a><a href='#L1552'>1552</a>
+<a name='L1553'></a><a href='#L1553'>1553</a>
+<a name='L1554'></a><a href='#L1554'>1554</a>
+<a name='L1555'></a><a href='#L1555'>1555</a>
+<a name='L1556'></a><a href='#L1556'>1556</a>
+<a name='L1557'></a><a href='#L1557'>1557</a>
+<a name='L1558'></a><a href='#L1558'>1558</a>
+<a name='L1559'></a><a href='#L1559'>1559</a>
+<a name='L1560'></a><a href='#L1560'>1560</a>
+<a name='L1561'></a><a href='#L1561'>1561</a>
+<a name='L1562'></a><a href='#L1562'>1562</a>
+<a name='L1563'></a><a href='#L1563'>1563</a>
+<a name='L1564'></a><a href='#L1564'>1564</a>
+<a name='L1565'></a><a href='#L1565'>1565</a>
+<a name='L1566'></a><a href='#L1566'>1566</a>
+<a name='L1567'></a><a href='#L1567'>1567</a>
+<a name='L1568'></a><a href='#L1568'>1568</a>
+<a name='L1569'></a><a href='#L1569'>1569</a>
+<a name='L1570'></a><a href='#L1570'>1570</a>
+<a name='L1571'></a><a href='#L1571'>1571</a>
+<a name='L1572'></a><a href='#L1572'>1572</a>
+<a name='L1573'></a><a href='#L1573'>1573</a>
+<a name='L1574'></a><a href='#L1574'>1574</a>
+<a name='L1575'></a><a href='#L1575'>1575</a>
+<a name='L1576'></a><a href='#L1576'>1576</a>
+<a name='L1577'></a><a href='#L1577'>1577</a>
+<a name='L1578'></a><a href='#L1578'>1578</a>
+<a name='L1579'></a><a href='#L1579'>1579</a>
+<a name='L1580'></a><a href='#L1580'>1580</a>
+<a name='L1581'></a><a href='#L1581'>1581</a>
+<a name='L1582'></a><a href='#L1582'>1582</a>
+<a name='L1583'></a><a href='#L1583'>1583</a>
+<a name='L1584'></a><a href='#L1584'>1584</a>
+<a name='L1585'></a><a href='#L1585'>1585</a>
+<a name='L1586'></a><a href='#L1586'>1586</a>
+<a name='L1587'></a><a href='#L1587'>1587</a>
+<a name='L1588'></a><a href='#L1588'>1588</a>
+<a name='L1589'></a><a href='#L1589'>1589</a>
+<a name='L1590'></a><a href='#L1590'>1590</a>
+<a name='L1591'></a><a href='#L1591'>1591</a>
+<a name='L1592'></a><a href='#L1592'>1592</a>
+<a name='L1593'></a><a href='#L1593'>1593</a>
+<a name='L1594'></a><a href='#L1594'>1594</a>
+<a name='L1595'></a><a href='#L1595'>1595</a>
+<a name='L1596'></a><a href='#L1596'>1596</a>
+<a name='L1597'></a><a href='#L1597'>1597</a>
+<a name='L1598'></a><a href='#L1598'>1598</a>
+<a name='L1599'></a><a href='#L1599'>1599</a>
+<a name='L1600'></a><a href='#L1600'>1600</a>
+<a name='L1601'></a><a href='#L1601'>1601</a>
+<a name='L1602'></a><a href='#L1602'>1602</a>
+<a name='L1603'></a><a href='#L1603'>1603</a>
+<a name='L1604'></a><a href='#L1604'>1604</a>
+<a name='L1605'></a><a href='#L1605'>1605</a>
+<a name='L1606'></a><a href='#L1606'>1606</a>
+<a name='L1607'></a><a href='#L1607'>1607</a>
+<a name='L1608'></a><a href='#L1608'>1608</a>
+<a name='L1609'></a><a href='#L1609'>1609</a>
+<a name='L1610'></a><a href='#L1610'>1610</a>
+<a name='L1611'></a><a href='#L1611'>1611</a>
+<a name='L1612'></a><a href='#L1612'>1612</a>
+<a name='L1613'></a><a href='#L1613'>1613</a>
+<a name='L1614'></a><a href='#L1614'>1614</a>
+<a name='L1615'></a><a href='#L1615'>1615</a>
+<a name='L1616'></a><a href='#L1616'>1616</a>
+<a name='L1617'></a><a href='#L1617'>1617</a>
+<a name='L1618'></a><a href='#L1618'>1618</a>
+<a name='L1619'></a><a href='#L1619'>1619</a>
+<a name='L1620'></a><a href='#L1620'>1620</a>
+<a name='L1621'></a><a href='#L1621'>1621</a>
+<a name='L1622'></a><a href='#L1622'>1622</a>
+<a name='L1623'></a><a href='#L1623'>1623</a>
+<a name='L1624'></a><a href='#L1624'>1624</a>
+<a name='L1625'></a><a href='#L1625'>1625</a>
+<a name='L1626'></a><a href='#L1626'>1626</a>
+<a name='L1627'></a><a href='#L1627'>1627</a>
+<a name='L1628'></a><a href='#L1628'>1628</a>
+<a name='L1629'></a><a href='#L1629'>1629</a>
+<a name='L1630'></a><a href='#L1630'>1630</a>
+<a name='L1631'></a><a href='#L1631'>1631</a>
+<a name='L1632'></a><a href='#L1632'>1632</a>
+<a name='L1633'></a><a href='#L1633'>1633</a>
+<a name='L1634'></a><a href='#L1634'>1634</a>
+<a name='L1635'></a><a href='#L1635'>1635</a>
+<a name='L1636'></a><a href='#L1636'>1636</a>
+<a name='L1637'></a><a href='#L1637'>1637</a>
+<a name='L1638'></a><a href='#L1638'>1638</a>
+<a name='L1639'></a><a href='#L1639'>1639</a>
+<a name='L1640'></a><a href='#L1640'>1640</a>
+<a name='L1641'></a><a href='#L1641'>1641</a>
+<a name='L1642'></a><a href='#L1642'>1642</a>
+<a name='L1643'></a><a href='#L1643'>1643</a>
+<a name='L1644'></a><a href='#L1644'>1644</a>
+<a name='L1645'></a><a href='#L1645'>1645</a>
+<a name='L1646'></a><a href='#L1646'>1646</a>
+<a name='L1647'></a><a href='#L1647'>1647</a>
+<a name='L1648'></a><a href='#L1648'>1648</a>
+<a name='L1649'></a><a href='#L1649'>1649</a>
+<a name='L1650'></a><a href='#L1650'>1650</a>
+<a name='L1651'></a><a href='#L1651'>1651</a>
+<a name='L1652'></a><a href='#L1652'>1652</a>
+<a name='L1653'></a><a href='#L1653'>1653</a>
+<a name='L1654'></a><a href='#L1654'>1654</a>
+<a name='L1655'></a><a href='#L1655'>1655</a>
+<a name='L1656'></a><a href='#L1656'>1656</a>
+<a name='L1657'></a><a href='#L1657'>1657</a>
+<a name='L1658'></a><a href='#L1658'>1658</a>
+<a name='L1659'></a><a href='#L1659'>1659</a>
+<a name='L1660'></a><a href='#L1660'>1660</a>
+<a name='L1661'></a><a href='#L1661'>1661</a>
+<a name='L1662'></a><a href='#L1662'>1662</a>
+<a name='L1663'></a><a href='#L1663'>1663</a>
+<a name='L1664'></a><a href='#L1664'>1664</a>
+<a name='L1665'></a><a href='#L1665'>1665</a>
+<a name='L1666'></a><a href='#L1666'>1666</a>
+<a name='L1667'></a><a href='#L1667'>1667</a>
+<a name='L1668'></a><a href='#L1668'>1668</a>
+<a name='L1669'></a><a href='#L1669'>1669</a>
+<a name='L1670'></a><a href='#L1670'>1670</a>
+<a name='L1671'></a><a href='#L1671'>1671</a>
+<a name='L1672'></a><a href='#L1672'>1672</a>
+<a name='L1673'></a><a href='#L1673'>1673</a>
+<a name='L1674'></a><a href='#L1674'>1674</a>
+<a name='L1675'></a><a href='#L1675'>1675</a>
+<a name='L1676'></a><a href='#L1676'>1676</a>
+<a name='L1677'></a><a href='#L1677'>1677</a>
+<a name='L1678'></a><a href='#L1678'>1678</a>
+<a name='L1679'></a><a href='#L1679'>1679</a>
+<a name='L1680'></a><a href='#L1680'>1680</a>
+<a name='L1681'></a><a href='#L1681'>1681</a>
+<a name='L1682'></a><a href='#L1682'>1682</a>
+<a name='L1683'></a><a href='#L1683'>1683</a>
+<a name='L1684'></a><a href='#L1684'>1684</a>
+<a name='L1685'></a><a href='#L1685'>1685</a>
+<a name='L1686'></a><a href='#L1686'>1686</a>
+<a name='L1687'></a><a href='#L1687'>1687</a>
+<a name='L1688'></a><a href='#L1688'>1688</a>
+<a name='L1689'></a><a href='#L1689'>1689</a>
+<a name='L1690'></a><a href='#L1690'>1690</a>
+<a name='L1691'></a><a href='#L1691'>1691</a>
+<a name='L1692'></a><a href='#L1692'>1692</a>
+<a name='L1693'></a><a href='#L1693'>1693</a>
+<a name='L1694'></a><a href='#L1694'>1694</a>
+<a name='L1695'></a><a href='#L1695'>1695</a>
+<a name='L1696'></a><a href='#L1696'>1696</a>
+<a name='L1697'></a><a href='#L1697'>1697</a>
+<a name='L1698'></a><a href='#L1698'>1698</a>
+<a name='L1699'></a><a href='#L1699'>1699</a>
+<a name='L1700'></a><a href='#L1700'>1700</a>
+<a name='L1701'></a><a href='#L1701'>1701</a>
+<a name='L1702'></a><a href='#L1702'>1702</a>
+<a name='L1703'></a><a href='#L1703'>1703</a>
+<a name='L1704'></a><a href='#L1704'>1704</a>
+<a name='L1705'></a><a href='#L1705'>1705</a>
+<a name='L1706'></a><a href='#L1706'>1706</a>
+<a name='L1707'></a><a href='#L1707'>1707</a>
+<a name='L1708'></a><a href='#L1708'>1708</a>
+<a name='L1709'></a><a href='#L1709'>1709</a>
+<a name='L1710'></a><a href='#L1710'>1710</a>
+<a name='L1711'></a><a href='#L1711'>1711</a>
+<a name='L1712'></a><a href='#L1712'>1712</a>
+<a name='L1713'></a><a href='#L1713'>1713</a>
+<a name='L1714'></a><a href='#L1714'>1714</a>
+<a name='L1715'></a><a href='#L1715'>1715</a>
+<a name='L1716'></a><a href='#L1716'>1716</a>
+<a name='L1717'></a><a href='#L1717'>1717</a>
+<a name='L1718'></a><a href='#L1718'>1718</a>
+<a name='L1719'></a><a href='#L1719'>1719</a>
+<a name='L1720'></a><a href='#L1720'>1720</a>
+<a name='L1721'></a><a href='#L1721'>1721</a>
+<a name='L1722'></a><a href='#L1722'>1722</a>
+<a name='L1723'></a><a href='#L1723'>1723</a>
+<a name='L1724'></a><a href='#L1724'>1724</a>
+<a name='L1725'></a><a href='#L1725'>1725</a>
+<a name='L1726'></a><a href='#L1726'>1726</a>
+<a name='L1727'></a><a href='#L1727'>1727</a>
+<a name='L1728'></a><a href='#L1728'>1728</a>
+<a name='L1729'></a><a href='#L1729'>1729</a>
+<a name='L1730'></a><a href='#L1730'>1730</a>
+<a name='L1731'></a><a href='#L1731'>1731</a>
+<a name='L1732'></a><a href='#L1732'>1732</a>
+<a name='L1733'></a><a href='#L1733'>1733</a>
+<a name='L1734'></a><a href='#L1734'>1734</a>
+<a name='L1735'></a><a href='#L1735'>1735</a>
+<a name='L1736'></a><a href='#L1736'>1736</a>
+<a name='L1737'></a><a href='#L1737'>1737</a>
+<a name='L1738'></a><a href='#L1738'>1738</a>
+<a name='L1739'></a><a href='#L1739'>1739</a>
+<a name='L1740'></a><a href='#L1740'>1740</a>
+<a name='L1741'></a><a href='#L1741'>1741</a>
+<a name='L1742'></a><a href='#L1742'>1742</a>
+<a name='L1743'></a><a href='#L1743'>1743</a>
+<a name='L1744'></a><a href='#L1744'>1744</a>
+<a name='L1745'></a><a href='#L1745'>1745</a>
+<a name='L1746'></a><a href='#L1746'>1746</a>
+<a name='L1747'></a><a href='#L1747'>1747</a>
+<a name='L1748'></a><a href='#L1748'>1748</a>
+<a name='L1749'></a><a href='#L1749'>1749</a>
+<a name='L1750'></a><a href='#L1750'>1750</a>
+<a name='L1751'></a><a href='#L1751'>1751</a>
+<a name='L1752'></a><a href='#L1752'>1752</a>
+<a name='L1753'></a><a href='#L1753'>1753</a>
+<a name='L1754'></a><a href='#L1754'>1754</a>
+<a name='L1755'></a><a href='#L1755'>1755</a>
+<a name='L1756'></a><a href='#L1756'>1756</a>
+<a name='L1757'></a><a href='#L1757'>1757</a>
+<a name='L1758'></a><a href='#L1758'>1758</a>
+<a name='L1759'></a><a href='#L1759'>1759</a>
+<a name='L1760'></a><a href='#L1760'>1760</a>
+<a name='L1761'></a><a href='#L1761'>1761</a>
+<a name='L1762'></a><a href='#L1762'>1762</a>
+<a name='L1763'></a><a href='#L1763'>1763</a>
+<a name='L1764'></a><a href='#L1764'>1764</a>
+<a name='L1765'></a><a href='#L1765'>1765</a>
+<a name='L1766'></a><a href='#L1766'>1766</a>
+<a name='L1767'></a><a href='#L1767'>1767</a>
+<a name='L1768'></a><a href='#L1768'>1768</a>
+<a name='L1769'></a><a href='#L1769'>1769</a>
+<a name='L1770'></a><a href='#L1770'>1770</a>
+<a name='L1771'></a><a href='#L1771'>1771</a>
+<a name='L1772'></a><a href='#L1772'>1772</a>
+<a name='L1773'></a><a href='#L1773'>1773</a>
+<a name='L1774'></a><a href='#L1774'>1774</a>
+<a name='L1775'></a><a href='#L1775'>1775</a>
+<a name='L1776'></a><a href='#L1776'>1776</a>
+<a name='L1777'></a><a href='#L1777'>1777</a>
+<a name='L1778'></a><a href='#L1778'>1778</a>
+<a name='L1779'></a><a href='#L1779'>1779</a>
+<a name='L1780'></a><a href='#L1780'>1780</a>
+<a name='L1781'></a><a href='#L1781'>1781</a>
+<a name='L1782'></a><a href='#L1782'>1782</a>
+<a name='L1783'></a><a href='#L1783'>1783</a>
+<a name='L1784'></a><a href='#L1784'>1784</a>
+<a name='L1785'></a><a href='#L1785'>1785</a>
+<a name='L1786'></a><a href='#L1786'>1786</a>
+<a name='L1787'></a><a href='#L1787'>1787</a>
+<a name='L1788'></a><a href='#L1788'>1788</a>
+<a name='L1789'></a><a href='#L1789'>1789</a>
+<a name='L1790'></a><a href='#L1790'>1790</a>
+<a name='L1791'></a><a href='#L1791'>1791</a>
+<a name='L1792'></a><a href='#L1792'>1792</a>
+<a name='L1793'></a><a href='#L1793'>1793</a>
+<a name='L1794'></a><a href='#L1794'>1794</a>
+<a name='L1795'></a><a href='#L1795'>1795</a>
+<a name='L1796'></a><a href='#L1796'>1796</a>
+<a name='L1797'></a><a href='#L1797'>1797</a>
+<a name='L1798'></a><a href='#L1798'>1798</a>
+<a name='L1799'></a><a href='#L1799'>1799</a>
+<a name='L1800'></a><a href='#L1800'>1800</a>
+<a name='L1801'></a><a href='#L1801'>1801</a>
+<a name='L1802'></a><a href='#L1802'>1802</a>
+<a name='L1803'></a><a href='#L1803'>1803</a>
+<a name='L1804'></a><a href='#L1804'>1804</a>
+<a name='L1805'></a><a href='#L1805'>1805</a>
+<a name='L1806'></a><a href='#L1806'>1806</a>
+<a name='L1807'></a><a href='#L1807'>1807</a>
+<a name='L1808'></a><a href='#L1808'>1808</a>
+<a name='L1809'></a><a href='#L1809'>1809</a>
+<a name='L1810'></a><a href='#L1810'>1810</a>
+<a name='L1811'></a><a href='#L1811'>1811</a>
+<a name='L1812'></a><a href='#L1812'>1812</a>
+<a name='L1813'></a><a href='#L1813'>1813</a>
+<a name='L1814'></a><a href='#L1814'>1814</a>
+<a name='L1815'></a><a href='#L1815'>1815</a>
+<a name='L1816'></a><a href='#L1816'>1816</a>
+<a name='L1817'></a><a href='#L1817'>1817</a>
+<a name='L1818'></a><a href='#L1818'>1818</a>
+<a name='L1819'></a><a href='#L1819'>1819</a>
+<a name='L1820'></a><a href='#L1820'>1820</a>
+<a name='L1821'></a><a href='#L1821'>1821</a>
+<a name='L1822'></a><a href='#L1822'>1822</a>
+<a name='L1823'></a><a href='#L1823'>1823</a>
+<a name='L1824'></a><a href='#L1824'>1824</a>
+<a name='L1825'></a><a href='#L1825'>1825</a>
+<a name='L1826'></a><a href='#L1826'>1826</a>
+<a name='L1827'></a><a href='#L1827'>1827</a>
+<a name='L1828'></a><a href='#L1828'>1828</a>
+<a name='L1829'></a><a href='#L1829'>1829</a>
+<a name='L1830'></a><a href='#L1830'>1830</a>
+<a name='L1831'></a><a href='#L1831'>1831</a>
+<a name='L1832'></a><a href='#L1832'>1832</a>
+<a name='L1833'></a><a href='#L1833'>1833</a>
+<a name='L1834'></a><a href='#L1834'>1834</a>
+<a name='L1835'></a><a href='#L1835'>1835</a>
+<a name='L1836'></a><a href='#L1836'>1836</a>
+<a name='L1837'></a><a href='#L1837'>1837</a>
+<a name='L1838'></a><a href='#L1838'>1838</a>
+<a name='L1839'></a><a href='#L1839'>1839</a>
+<a name='L1840'></a><a href='#L1840'>1840</a>
+<a name='L1841'></a><a href='#L1841'>1841</a>
+<a name='L1842'></a><a href='#L1842'>1842</a>
+<a name='L1843'></a><a href='#L1843'>1843</a>
+<a name='L1844'></a><a href='#L1844'>1844</a>
+<a name='L1845'></a><a href='#L1845'>1845</a>
+<a name='L1846'></a><a href='#L1846'>1846</a>
+<a name='L1847'></a><a href='#L1847'>1847</a>
+<a name='L1848'></a><a href='#L1848'>1848</a>
+<a name='L1849'></a><a href='#L1849'>1849</a>
+<a name='L1850'></a><a href='#L1850'>1850</a>
+<a name='L1851'></a><a href='#L1851'>1851</a>
+<a name='L1852'></a><a href='#L1852'>1852</a>
+<a name='L1853'></a><a href='#L1853'>1853</a>
+<a name='L1854'></a><a href='#L1854'>1854</a>
+<a name='L1855'></a><a href='#L1855'>1855</a>
+<a name='L1856'></a><a href='#L1856'>1856</a>
+<a name='L1857'></a><a href='#L1857'>1857</a>
+<a name='L1858'></a><a href='#L1858'>1858</a>
+<a name='L1859'></a><a href='#L1859'>1859</a>
+<a name='L1860'></a><a href='#L1860'>1860</a>
+<a name='L1861'></a><a href='#L1861'>1861</a>
+<a name='L1862'></a><a href='#L1862'>1862</a>
+<a name='L1863'></a><a href='#L1863'>1863</a>
+<a name='L1864'></a><a href='#L1864'>1864</a>
+<a name='L1865'></a><a href='#L1865'>1865</a>
+<a name='L1866'></a><a href='#L1866'>1866</a>
+<a name='L1867'></a><a href='#L1867'>1867</a>
+<a name='L1868'></a><a href='#L1868'>1868</a>
+<a name='L1869'></a><a href='#L1869'>1869</a>
+<a name='L1870'></a><a href='#L1870'>1870</a>
+<a name='L1871'></a><a href='#L1871'>1871</a>
+<a name='L1872'></a><a href='#L1872'>1872</a>
+<a name='L1873'></a><a href='#L1873'>1873</a>
+<a name='L1874'></a><a href='#L1874'>1874</a>
+<a name='L1875'></a><a href='#L1875'>1875</a>
+<a name='L1876'></a><a href='#L1876'>1876</a>
+<a name='L1877'></a><a href='#L1877'>1877</a>
+<a name='L1878'></a><a href='#L1878'>1878</a>
+<a name='L1879'></a><a href='#L1879'>1879</a>
+<a name='L1880'></a><a href='#L1880'>1880</a>
+<a name='L1881'></a><a href='#L1881'>1881</a>
+<a name='L1882'></a><a href='#L1882'>1882</a>
+<a name='L1883'></a><a href='#L1883'>1883</a>
+<a name='L1884'></a><a href='#L1884'>1884</a>
+<a name='L1885'></a><a href='#L1885'>1885</a>
+<a name='L1886'></a><a href='#L1886'>1886</a>
+<a name='L1887'></a><a href='#L1887'>1887</a>
+<a name='L1888'></a><a href='#L1888'>1888</a>
+<a name='L1889'></a><a href='#L1889'>1889</a>
+<a name='L1890'></a><a href='#L1890'>1890</a>
+<a name='L1891'></a><a href='#L1891'>1891</a>
+<a name='L1892'></a><a href='#L1892'>1892</a>
+<a name='L1893'></a><a href='#L1893'>1893</a>
+<a name='L1894'></a><a href='#L1894'>1894</a>
+<a name='L1895'></a><a href='#L1895'>1895</a>
+<a name='L1896'></a><a href='#L1896'>1896</a>
+<a name='L1897'></a><a href='#L1897'>1897</a>
+<a name='L1898'></a><a href='#L1898'>1898</a>
+<a name='L1899'></a><a href='#L1899'>1899</a>
+<a name='L1900'></a><a href='#L1900'>1900</a>
+<a name='L1901'></a><a href='#L1901'>1901</a>
+<a name='L1902'></a><a href='#L1902'>1902</a>
+<a name='L1903'></a><a href='#L1903'>1903</a>
+<a name='L1904'></a><a href='#L1904'>1904</a>
+<a name='L1905'></a><a href='#L1905'>1905</a>
+<a name='L1906'></a><a href='#L1906'>1906</a>
+<a name='L1907'></a><a href='#L1907'>1907</a>
+<a name='L1908'></a><a href='#L1908'>1908</a>
+<a name='L1909'></a><a href='#L1909'>1909</a>
+<a name='L1910'></a><a href='#L1910'>1910</a>
+<a name='L1911'></a><a href='#L1911'>1911</a>
+<a name='L1912'></a><a href='#L1912'>1912</a>
+<a name='L1913'></a><a href='#L1913'>1913</a>
+<a name='L1914'></a><a href='#L1914'>1914</a>
+<a name='L1915'></a><a href='#L1915'>1915</a>
+<a name='L1916'></a><a href='#L1916'>1916</a>
+<a name='L1917'></a><a href='#L1917'>1917</a>
+<a name='L1918'></a><a href='#L1918'>1918</a>
+<a name='L1919'></a><a href='#L1919'>1919</a>
+<a name='L1920'></a><a href='#L1920'>1920</a>
+<a name='L1921'></a><a href='#L1921'>1921</a>
+<a name='L1922'></a><a href='#L1922'>1922</a>
+<a name='L1923'></a><a href='#L1923'>1923</a>
+<a name='L1924'></a><a href='#L1924'>1924</a>
+<a name='L1925'></a><a href='#L1925'>1925</a>
+<a name='L1926'></a><a href='#L1926'>1926</a>
+<a name='L1927'></a><a href='#L1927'>1927</a>
+<a name='L1928'></a><a href='#L1928'>1928</a>
+<a name='L1929'></a><a href='#L1929'>1929</a>
+<a name='L1930'></a><a href='#L1930'>1930</a>
+<a name='L1931'></a><a href='#L1931'>1931</a>
+<a name='L1932'></a><a href='#L1932'>1932</a>
+<a name='L1933'></a><a href='#L1933'>1933</a>
+<a name='L1934'></a><a href='#L1934'>1934</a>
+<a name='L1935'></a><a href='#L1935'>1935</a>
+<a name='L1936'></a><a href='#L1936'>1936</a>
+<a name='L1937'></a><a href='#L1937'>1937</a>
+<a name='L1938'></a><a href='#L1938'>1938</a>
+<a name='L1939'></a><a href='#L1939'>1939</a>
+<a name='L1940'></a><a href='#L1940'>1940</a>
+<a name='L1941'></a><a href='#L1941'>1941</a>
+<a name='L1942'></a><a href='#L1942'>1942</a>
+<a name='L1943'></a><a href='#L1943'>1943</a>
+<a name='L1944'></a><a href='#L1944'>1944</a>
+<a name='L1945'></a><a href='#L1945'>1945</a>
+<a name='L1946'></a><a href='#L1946'>1946</a>
+<a name='L1947'></a><a href='#L1947'>1947</a>
+<a name='L1948'></a><a href='#L1948'>1948</a>
+<a name='L1949'></a><a href='#L1949'>1949</a>
+<a name='L1950'></a><a href='#L1950'>1950</a>
+<a name='L1951'></a><a href='#L1951'>1951</a>
+<a name='L1952'></a><a href='#L1952'>1952</a>
+<a name='L1953'></a><a href='#L1953'>1953</a>
+<a name='L1954'></a><a href='#L1954'>1954</a>
+<a name='L1955'></a><a href='#L1955'>1955</a>
+<a name='L1956'></a><a href='#L1956'>1956</a>
+<a name='L1957'></a><a href='#L1957'>1957</a>
+<a name='L1958'></a><a href='#L1958'>1958</a>
+<a name='L1959'></a><a href='#L1959'>1959</a>
+<a name='L1960'></a><a href='#L1960'>1960</a>
+<a name='L1961'></a><a href='#L1961'>1961</a>
+<a name='L1962'></a><a href='#L1962'>1962</a>
+<a name='L1963'></a><a href='#L1963'>1963</a>
+<a name='L1964'></a><a href='#L1964'>1964</a>
+<a name='L1965'></a><a href='#L1965'>1965</a>
+<a name='L1966'></a><a href='#L1966'>1966</a>
+<a name='L1967'></a><a href='#L1967'>1967</a>
+<a name='L1968'></a><a href='#L1968'>1968</a>
+<a name='L1969'></a><a href='#L1969'>1969</a>
+<a name='L1970'></a><a href='#L1970'>1970</a>
+<a name='L1971'></a><a href='#L1971'>1971</a>
+<a name='L1972'></a><a href='#L1972'>1972</a>
+<a name='L1973'></a><a href='#L1973'>1973</a>
+<a name='L1974'></a><a href='#L1974'>1974</a>
+<a name='L1975'></a><a href='#L1975'>1975</a>
+<a name='L1976'></a><a href='#L1976'>1976</a>
+<a name='L1977'></a><a href='#L1977'>1977</a>
+<a name='L1978'></a><a href='#L1978'>1978</a>
+<a name='L1979'></a><a href='#L1979'>1979</a>
+<a name='L1980'></a><a href='#L1980'>1980</a>
+<a name='L1981'></a><a href='#L1981'>1981</a>
+<a name='L1982'></a><a href='#L1982'>1982</a>
+<a name='L1983'></a><a href='#L1983'>1983</a>
+<a name='L1984'></a><a href='#L1984'>1984</a>
+<a name='L1985'></a><a href='#L1985'>1985</a>
+<a name='L1986'></a><a href='#L1986'>1986</a>
+<a name='L1987'></a><a href='#L1987'>1987</a>
+<a name='L1988'></a><a href='#L1988'>1988</a>
+<a name='L1989'></a><a href='#L1989'>1989</a>
+<a name='L1990'></a><a href='#L1990'>1990</a>
+<a name='L1991'></a><a href='#L1991'>1991</a>
+<a name='L1992'></a><a href='#L1992'>1992</a>
+<a name='L1993'></a><a href='#L1993'>1993</a>
+<a name='L1994'></a><a href='#L1994'>1994</a>
+<a name='L1995'></a><a href='#L1995'>1995</a>
+<a name='L1996'></a><a href='#L1996'>1996</a>
+<a name='L1997'></a><a href='#L1997'>1997</a>
+<a name='L1998'></a><a href='#L1998'>1998</a>
+<a name='L1999'></a><a href='#L1999'>1999</a>
+<a name='L2000'></a><a href='#L2000'>2000</a>
+<a name='L2001'></a><a href='#L2001'>2001</a>
+<a name='L2002'></a><a href='#L2002'>2002</a>
+<a name='L2003'></a><a href='#L2003'>2003</a>
+<a name='L2004'></a><a href='#L2004'>2004</a>
+<a name='L2005'></a><a href='#L2005'>2005</a>
+<a name='L2006'></a><a href='#L2006'>2006</a>
+<a name='L2007'></a><a href='#L2007'>2007</a>
+<a name='L2008'></a><a href='#L2008'>2008</a>
+<a name='L2009'></a><a href='#L2009'>2009</a>
+<a name='L2010'></a><a href='#L2010'>2010</a>
+<a name='L2011'></a><a href='#L2011'>2011</a>
+<a name='L2012'></a><a href='#L2012'>2012</a>
+<a name='L2013'></a><a href='#L2013'>2013</a>
+<a name='L2014'></a><a href='#L2014'>2014</a>
+<a name='L2015'></a><a href='#L2015'>2015</a>
+<a name='L2016'></a><a href='#L2016'>2016</a>
+<a name='L2017'></a><a href='#L2017'>2017</a>
+<a name='L2018'></a><a href='#L2018'>2018</a>
+<a name='L2019'></a><a href='#L2019'>2019</a>
+<a name='L2020'></a><a href='#L2020'>2020</a>
+<a name='L2021'></a><a href='#L2021'>2021</a>
+<a name='L2022'></a><a href='#L2022'>2022</a>
+<a name='L2023'></a><a href='#L2023'>2023</a>
+<a name='L2024'></a><a href='#L2024'>2024</a>
+<a name='L2025'></a><a href='#L2025'>2025</a>
+<a name='L2026'></a><a href='#L2026'>2026</a>
+<a name='L2027'></a><a href='#L2027'>2027</a>
+<a name='L2028'></a><a href='#L2028'>2028</a>
+<a name='L2029'></a><a href='#L2029'>2029</a>
+<a name='L2030'></a><a href='#L2030'>2030</a>
+<a name='L2031'></a><a href='#L2031'>2031</a>
+<a name='L2032'></a><a href='#L2032'>2032</a>
+<a name='L2033'></a><a href='#L2033'>2033</a>
+<a name='L2034'></a><a href='#L2034'>2034</a>
+<a name='L2035'></a><a href='#L2035'>2035</a>
+<a name='L2036'></a><a href='#L2036'>2036</a>
+<a name='L2037'></a><a href='#L2037'>2037</a>
+<a name='L2038'></a><a href='#L2038'>2038</a>
+<a name='L2039'></a><a href='#L2039'>2039</a>
+<a name='L2040'></a><a href='#L2040'>2040</a>
+<a name='L2041'></a><a href='#L2041'>2041</a>
+<a name='L2042'></a><a href='#L2042'>2042</a>
+<a name='L2043'></a><a href='#L2043'>2043</a>
+<a name='L2044'></a><a href='#L2044'>2044</a>
+<a name='L2045'></a><a href='#L2045'>2045</a>
+<a name='L2046'></a><a href='#L2046'>2046</a>
+<a name='L2047'></a><a href='#L2047'>2047</a>
+<a name='L2048'></a><a href='#L2048'>2048</a>
+<a name='L2049'></a><a href='#L2049'>2049</a>
+<a name='L2050'></a><a href='#L2050'>2050</a>
+<a name='L2051'></a><a href='#L2051'>2051</a>
+<a name='L2052'></a><a href='#L2052'>2052</a>
+<a name='L2053'></a><a href='#L2053'>2053</a>
+<a name='L2054'></a><a href='#L2054'>2054</a>
+<a name='L2055'></a><a href='#L2055'>2055</a>
+<a name='L2056'></a><a href='#L2056'>2056</a>
+<a name='L2057'></a><a href='#L2057'>2057</a>
+<a name='L2058'></a><a href='#L2058'>2058</a>
+<a name='L2059'></a><a href='#L2059'>2059</a>
+<a name='L2060'></a><a href='#L2060'>2060</a>
+<a name='L2061'></a><a href='#L2061'>2061</a>
+<a name='L2062'></a><a href='#L2062'>2062</a>
+<a name='L2063'></a><a href='#L2063'>2063</a>
+<a name='L2064'></a><a href='#L2064'>2064</a>
+<a name='L2065'></a><a href='#L2065'>2065</a>
+<a name='L2066'></a><a href='#L2066'>2066</a>
+<a name='L2067'></a><a href='#L2067'>2067</a>
+<a name='L2068'></a><a href='#L2068'>2068</a>
+<a name='L2069'></a><a href='#L2069'>2069</a>
+<a name='L2070'></a><a href='#L2070'>2070</a>
+<a name='L2071'></a><a href='#L2071'>2071</a>
+<a name='L2072'></a><a href='#L2072'>2072</a>
+<a name='L2073'></a><a href='#L2073'>2073</a>
+<a name='L2074'></a><a href='#L2074'>2074</a>
+<a name='L2075'></a><a href='#L2075'>2075</a>
+<a name='L2076'></a><a href='#L2076'>2076</a>
+<a name='L2077'></a><a href='#L2077'>2077</a>
+<a name='L2078'></a><a href='#L2078'>2078</a>
+<a name='L2079'></a><a href='#L2079'>2079</a>
+<a name='L2080'></a><a href='#L2080'>2080</a>
+<a name='L2081'></a><a href='#L2081'>2081</a>
+<a name='L2082'></a><a href='#L2082'>2082</a>
+<a name='L2083'></a><a href='#L2083'>2083</a>
+<a name='L2084'></a><a href='#L2084'>2084</a>
+<a name='L2085'></a><a href='#L2085'>2085</a>
+<a name='L2086'></a><a href='#L2086'>2086</a>
+<a name='L2087'></a><a href='#L2087'>2087</a>
+<a name='L2088'></a><a href='#L2088'>2088</a>
+<a name='L2089'></a><a href='#L2089'>2089</a>
+<a name='L2090'></a><a href='#L2090'>2090</a>
+<a name='L2091'></a><a href='#L2091'>2091</a>
+<a name='L2092'></a><a href='#L2092'>2092</a>
+<a name='L2093'></a><a href='#L2093'>2093</a>
+<a name='L2094'></a><a href='#L2094'>2094</a>
+<a name='L2095'></a><a href='#L2095'>2095</a>
+<a name='L2096'></a><a href='#L2096'>2096</a>
+<a name='L2097'></a><a href='#L2097'>2097</a>
+<a name='L2098'></a><a href='#L2098'>2098</a>
+<a name='L2099'></a><a href='#L2099'>2099</a>
+<a name='L2100'></a><a href='#L2100'>2100</a>
+<a name='L2101'></a><a href='#L2101'>2101</a>
+<a name='L2102'></a><a href='#L2102'>2102</a>
+<a name='L2103'></a><a href='#L2103'>2103</a>
+<a name='L2104'></a><a href='#L2104'>2104</a>
+<a name='L2105'></a><a href='#L2105'>2105</a>
+<a name='L2106'></a><a href='#L2106'>2106</a>
+<a name='L2107'></a><a href='#L2107'>2107</a>
+<a name='L2108'></a><a href='#L2108'>2108</a>
+<a name='L2109'></a><a href='#L2109'>2109</a>
+<a name='L2110'></a><a href='#L2110'>2110</a>
+<a name='L2111'></a><a href='#L2111'>2111</a>
+<a name='L2112'></a><a href='#L2112'>2112</a>
+<a name='L2113'></a><a href='#L2113'>2113</a>
+<a name='L2114'></a><a href='#L2114'>2114</a>
+<a name='L2115'></a><a href='#L2115'>2115</a>
+<a name='L2116'></a><a href='#L2116'>2116</a>
+<a name='L2117'></a><a href='#L2117'>2117</a>
+<a name='L2118'></a><a href='#L2118'>2118</a>
+<a name='L2119'></a><a href='#L2119'>2119</a>
+<a name='L2120'></a><a href='#L2120'>2120</a>
+<a name='L2121'></a><a href='#L2121'>2121</a>
+<a name='L2122'></a><a href='#L2122'>2122</a>
+<a name='L2123'></a><a href='#L2123'>2123</a>
+<a name='L2124'></a><a href='#L2124'>2124</a>
+<a name='L2125'></a><a href='#L2125'>2125</a>
+<a name='L2126'></a><a href='#L2126'>2126</a>
+<a name='L2127'></a><a href='#L2127'>2127</a>
+<a name='L2128'></a><a href='#L2128'>2128</a>
+<a name='L2129'></a><a href='#L2129'>2129</a>
+<a name='L2130'></a><a href='#L2130'>2130</a>
+<a name='L2131'></a><a href='#L2131'>2131</a>
+<a name='L2132'></a><a href='#L2132'>2132</a>
+<a name='L2133'></a><a href='#L2133'>2133</a>
+<a name='L2134'></a><a href='#L2134'>2134</a>
+<a name='L2135'></a><a href='#L2135'>2135</a>
+<a name='L2136'></a><a href='#L2136'>2136</a>
+<a name='L2137'></a><a href='#L2137'>2137</a>
+<a name='L2138'></a><a href='#L2138'>2138</a>
+<a name='L2139'></a><a href='#L2139'>2139</a>
+<a name='L2140'></a><a href='#L2140'>2140</a>
+<a name='L2141'></a><a href='#L2141'>2141</a>
+<a name='L2142'></a><a href='#L2142'>2142</a>
+<a name='L2143'></a><a href='#L2143'>2143</a>
+<a name='L2144'></a><a href='#L2144'>2144</a>
+<a name='L2145'></a><a href='#L2145'>2145</a>
+<a name='L2146'></a><a href='#L2146'>2146</a>
+<a name='L2147'></a><a href='#L2147'>2147</a>
+<a name='L2148'></a><a href='#L2148'>2148</a>
+<a name='L2149'></a><a href='#L2149'>2149</a>
+<a name='L2150'></a><a href='#L2150'>2150</a>
+<a name='L2151'></a><a href='#L2151'>2151</a>
+<a name='L2152'></a><a href='#L2152'>2152</a>
+<a name='L2153'></a><a href='#L2153'>2153</a>
+<a name='L2154'></a><a href='#L2154'>2154</a>
+<a name='L2155'></a><a href='#L2155'>2155</a>
+<a name='L2156'></a><a href='#L2156'>2156</a>
+<a name='L2157'></a><a href='#L2157'>2157</a>
+<a name='L2158'></a><a href='#L2158'>2158</a>
+<a name='L2159'></a><a href='#L2159'>2159</a>
+<a name='L2160'></a><a href='#L2160'>2160</a>
+<a name='L2161'></a><a href='#L2161'>2161</a>
+<a name='L2162'></a><a href='#L2162'>2162</a>
+<a name='L2163'></a><a href='#L2163'>2163</a>
+<a name='L2164'></a><a href='#L2164'>2164</a>
+<a name='L2165'></a><a href='#L2165'>2165</a>
+<a name='L2166'></a><a href='#L2166'>2166</a>
+<a name='L2167'></a><a href='#L2167'>2167</a>
+<a name='L2168'></a><a href='#L2168'>2168</a>
+<a name='L2169'></a><a href='#L2169'>2169</a>
+<a name='L2170'></a><a href='#L2170'>2170</a>
+<a name='L2171'></a><a href='#L2171'>2171</a>
+<a name='L2172'></a><a href='#L2172'>2172</a>
+<a name='L2173'></a><a href='#L2173'>2173</a>
+<a name='L2174'></a><a href='#L2174'>2174</a>
+<a name='L2175'></a><a href='#L2175'>2175</a>
+<a name='L2176'></a><a href='#L2176'>2176</a>
+<a name='L2177'></a><a href='#L2177'>2177</a>
+<a name='L2178'></a><a href='#L2178'>2178</a>
+<a name='L2179'></a><a href='#L2179'>2179</a>
+<a name='L2180'></a><a href='#L2180'>2180</a>
+<a name='L2181'></a><a href='#L2181'>2181</a>
+<a name='L2182'></a><a href='#L2182'>2182</a>
+<a name='L2183'></a><a href='#L2183'>2183</a>
+<a name='L2184'></a><a href='#L2184'>2184</a>
+<a name='L2185'></a><a href='#L2185'>2185</a>
+<a name='L2186'></a><a href='#L2186'>2186</a>
+<a name='L2187'></a><a href='#L2187'>2187</a>
+<a name='L2188'></a><a href='#L2188'>2188</a>
+<a name='L2189'></a><a href='#L2189'>2189</a>
+<a name='L2190'></a><a href='#L2190'>2190</a>
+<a name='L2191'></a><a href='#L2191'>2191</a>
+<a name='L2192'></a><a href='#L2192'>2192</a>
+<a name='L2193'></a><a href='#L2193'>2193</a>
+<a name='L2194'></a><a href='#L2194'>2194</a>
+<a name='L2195'></a><a href='#L2195'>2195</a>
+<a name='L2196'></a><a href='#L2196'>2196</a>
+<a name='L2197'></a><a href='#L2197'>2197</a>
+<a name='L2198'></a><a href='#L2198'>2198</a>
+<a name='L2199'></a><a href='#L2199'>2199</a>
+<a name='L2200'></a><a href='#L2200'>2200</a>
+<a name='L2201'></a><a href='#L2201'>2201</a>
+<a name='L2202'></a><a href='#L2202'>2202</a>
+<a name='L2203'></a><a href='#L2203'>2203</a>
+<a name='L2204'></a><a href='#L2204'>2204</a>
+<a name='L2205'></a><a href='#L2205'>2205</a>
+<a name='L2206'></a><a href='#L2206'>2206</a>
+<a name='L2207'></a><a href='#L2207'>2207</a>
+<a name='L2208'></a><a href='#L2208'>2208</a>
+<a name='L2209'></a><a href='#L2209'>2209</a>
+<a name='L2210'></a><a href='#L2210'>2210</a>
+<a name='L2211'></a><a href='#L2211'>2211</a>
+<a name='L2212'></a><a href='#L2212'>2212</a>
+<a name='L2213'></a><a href='#L2213'>2213</a>
+<a name='L2214'></a><a href='#L2214'>2214</a>
+<a name='L2215'></a><a href='#L2215'>2215</a>
+<a name='L2216'></a><a href='#L2216'>2216</a>
+<a name='L2217'></a><a href='#L2217'>2217</a>
+<a name='L2218'></a><a href='#L2218'>2218</a>
+<a name='L2219'></a><a href='#L2219'>2219</a>
+<a name='L2220'></a><a href='#L2220'>2220</a>
+<a name='L2221'></a><a href='#L2221'>2221</a>
+<a name='L2222'></a><a href='#L2222'>2222</a>
+<a name='L2223'></a><a href='#L2223'>2223</a>
+<a name='L2224'></a><a href='#L2224'>2224</a>
+<a name='L2225'></a><a href='#L2225'>2225</a>
+<a name='L2226'></a><a href='#L2226'>2226</a>
+<a name='L2227'></a><a href='#L2227'>2227</a>
+<a name='L2228'></a><a href='#L2228'>2228</a>
+<a name='L2229'></a><a href='#L2229'>2229</a>
+<a name='L2230'></a><a href='#L2230'>2230</a>
+<a name='L2231'></a><a href='#L2231'>2231</a>
+<a name='L2232'></a><a href='#L2232'>2232</a>
+<a name='L2233'></a><a href='#L2233'>2233</a>
+<a name='L2234'></a><a href='#L2234'>2234</a>
+<a name='L2235'></a><a href='#L2235'>2235</a>
+<a name='L2236'></a><a href='#L2236'>2236</a>
+<a name='L2237'></a><a href='#L2237'>2237</a>
+<a name='L2238'></a><a href='#L2238'>2238</a>
+<a name='L2239'></a><a href='#L2239'>2239</a>
+<a name='L2240'></a><a href='#L2240'>2240</a>
+<a name='L2241'></a><a href='#L2241'>2241</a>
+<a name='L2242'></a><a href='#L2242'>2242</a>
+<a name='L2243'></a><a href='#L2243'>2243</a>
+<a name='L2244'></a><a href='#L2244'>2244</a>
+<a name='L2245'></a><a href='#L2245'>2245</a>
+<a name='L2246'></a><a href='#L2246'>2246</a>
+<a name='L2247'></a><a href='#L2247'>2247</a>
+<a name='L2248'></a><a href='#L2248'>2248</a>
+<a name='L2249'></a><a href='#L2249'>2249</a>
+<a name='L2250'></a><a href='#L2250'>2250</a>
+<a name='L2251'></a><a href='#L2251'>2251</a>
+<a name='L2252'></a><a href='#L2252'>2252</a>
+<a name='L2253'></a><a href='#L2253'>2253</a>
+<a name='L2254'></a><a href='#L2254'>2254</a>
+<a name='L2255'></a><a href='#L2255'>2255</a>
+<a name='L2256'></a><a href='#L2256'>2256</a>
+<a name='L2257'></a><a href='#L2257'>2257</a>
+<a name='L2258'></a><a href='#L2258'>2258</a>
+<a name='L2259'></a><a href='#L2259'>2259</a>
+<a name='L2260'></a><a href='#L2260'>2260</a>
+<a name='L2261'></a><a href='#L2261'>2261</a>
+<a name='L2262'></a><a href='#L2262'>2262</a>
+<a name='L2263'></a><a href='#L2263'>2263</a>
+<a name='L2264'></a><a href='#L2264'>2264</a>
+<a name='L2265'></a><a href='#L2265'>2265</a>
+<a name='L2266'></a><a href='#L2266'>2266</a>
+<a name='L2267'></a><a href='#L2267'>2267</a>
+<a name='L2268'></a><a href='#L2268'>2268</a>
+<a name='L2269'></a><a href='#L2269'>2269</a>
+<a name='L2270'></a><a href='#L2270'>2270</a>
+<a name='L2271'></a><a href='#L2271'>2271</a>
+<a name='L2272'></a><a href='#L2272'>2272</a>
+<a name='L2273'></a><a href='#L2273'>2273</a>
+<a name='L2274'></a><a href='#L2274'>2274</a>
+<a name='L2275'></a><a href='#L2275'>2275</a>
+<a name='L2276'></a><a href='#L2276'>2276</a>
+<a name='L2277'></a><a href='#L2277'>2277</a>
+<a name='L2278'></a><a href='#L2278'>2278</a>
+<a name='L2279'></a><a href='#L2279'>2279</a>
+<a name='L2280'></a><a href='#L2280'>2280</a>
+<a name='L2281'></a><a href='#L2281'>2281</a>
+<a name='L2282'></a><a href='#L2282'>2282</a>
+<a name='L2283'></a><a href='#L2283'>2283</a>
+<a name='L2284'></a><a href='#L2284'>2284</a>
+<a name='L2285'></a><a href='#L2285'>2285</a>
+<a name='L2286'></a><a href='#L2286'>2286</a>
+<a name='L2287'></a><a href='#L2287'>2287</a>
+<a name='L2288'></a><a href='#L2288'>2288</a>
+<a name='L2289'></a><a href='#L2289'>2289</a>
+<a name='L2290'></a><a href='#L2290'>2290</a>
+<a name='L2291'></a><a href='#L2291'>2291</a>
+<a name='L2292'></a><a href='#L2292'>2292</a>
+<a name='L2293'></a><a href='#L2293'>2293</a>
+<a name='L2294'></a><a href='#L2294'>2294</a>
+<a name='L2295'></a><a href='#L2295'>2295</a>
+<a name='L2296'></a><a href='#L2296'>2296</a>
+<a name='L2297'></a><a href='#L2297'>2297</a>
+<a name='L2298'></a><a href='#L2298'>2298</a>
+<a name='L2299'></a><a href='#L2299'>2299</a>
+<a name='L2300'></a><a href='#L2300'>2300</a>
+<a name='L2301'></a><a href='#L2301'>2301</a>
+<a name='L2302'></a><a href='#L2302'>2302</a>
+<a name='L2303'></a><a href='#L2303'>2303</a>
+<a name='L2304'></a><a href='#L2304'>2304</a>
+<a name='L2305'></a><a href='#L2305'>2305</a>
+<a name='L2306'></a><a href='#L2306'>2306</a>
+<a name='L2307'></a><a href='#L2307'>2307</a>
+<a name='L2308'></a><a href='#L2308'>2308</a>
+<a name='L2309'></a><a href='#L2309'>2309</a>
+<a name='L2310'></a><a href='#L2310'>2310</a>
+<a name='L2311'></a><a href='#L2311'>2311</a>
+<a name='L2312'></a><a href='#L2312'>2312</a>
+<a name='L2313'></a><a href='#L2313'>2313</a>
+<a name='L2314'></a><a href='#L2314'>2314</a>
+<a name='L2315'></a><a href='#L2315'>2315</a>
+<a name='L2316'></a><a href='#L2316'>2316</a>
+<a name='L2317'></a><a href='#L2317'>2317</a>
+<a name='L2318'></a><a href='#L2318'>2318</a>
+<a name='L2319'></a><a href='#L2319'>2319</a>
+<a name='L2320'></a><a href='#L2320'>2320</a>
+<a name='L2321'></a><a href='#L2321'>2321</a>
+<a name='L2322'></a><a href='#L2322'>2322</a>
+<a name='L2323'></a><a href='#L2323'>2323</a>
+<a name='L2324'></a><a href='#L2324'>2324</a>
+<a name='L2325'></a><a href='#L2325'>2325</a>
+<a name='L2326'></a><a href='#L2326'>2326</a>
+<a name='L2327'></a><a href='#L2327'>2327</a>
+<a name='L2328'></a><a href='#L2328'>2328</a>
+<a name='L2329'></a><a href='#L2329'>2329</a>
+<a name='L2330'></a><a href='#L2330'>2330</a>
+<a name='L2331'></a><a href='#L2331'>2331</a>
+<a name='L2332'></a><a href='#L2332'>2332</a>
+<a name='L2333'></a><a href='#L2333'>2333</a>
+<a name='L2334'></a><a href='#L2334'>2334</a>
+<a name='L2335'></a><a href='#L2335'>2335</a>
+<a name='L2336'></a><a href='#L2336'>2336</a>
+<a name='L2337'></a><a href='#L2337'>2337</a>
+<a name='L2338'></a><a href='#L2338'>2338</a>
+<a name='L2339'></a><a href='#L2339'>2339</a>
+<a name='L2340'></a><a href='#L2340'>2340</a>
+<a name='L2341'></a><a href='#L2341'>2341</a>
+<a name='L2342'></a><a href='#L2342'>2342</a>
+<a name='L2343'></a><a href='#L2343'>2343</a>
+<a name='L2344'></a><a href='#L2344'>2344</a>
+<a name='L2345'></a><a href='#L2345'>2345</a>
+<a name='L2346'></a><a href='#L2346'>2346</a>
+<a name='L2347'></a><a href='#L2347'>2347</a>
+<a name='L2348'></a><a href='#L2348'>2348</a>
+<a name='L2349'></a><a href='#L2349'>2349</a>
+<a name='L2350'></a><a href='#L2350'>2350</a>
+<a name='L2351'></a><a href='#L2351'>2351</a>
+<a name='L2352'></a><a href='#L2352'>2352</a>
+<a name='L2353'></a><a href='#L2353'>2353</a>
+<a name='L2354'></a><a href='#L2354'>2354</a>
+<a name='L2355'></a><a href='#L2355'>2355</a>
+<a name='L2356'></a><a href='#L2356'>2356</a>
+<a name='L2357'></a><a href='#L2357'>2357</a>
+<a name='L2358'></a><a href='#L2358'>2358</a>
+<a name='L2359'></a><a href='#L2359'>2359</a>
+<a name='L2360'></a><a href='#L2360'>2360</a>
+<a name='L2361'></a><a href='#L2361'>2361</a>
+<a name='L2362'></a><a href='#L2362'>2362</a>
+<a name='L2363'></a><a href='#L2363'>2363</a>
+<a name='L2364'></a><a href='#L2364'>2364</a>
+<a name='L2365'></a><a href='#L2365'>2365</a>
+<a name='L2366'></a><a href='#L2366'>2366</a>
+<a name='L2367'></a><a href='#L2367'>2367</a>
+<a name='L2368'></a><a href='#L2368'>2368</a>
+<a name='L2369'></a><a href='#L2369'>2369</a>
+<a name='L2370'></a><a href='#L2370'>2370</a>
+<a name='L2371'></a><a href='#L2371'>2371</a>
+<a name='L2372'></a><a href='#L2372'>2372</a>
+<a name='L2373'></a><a href='#L2373'>2373</a>
+<a name='L2374'></a><a href='#L2374'>2374</a>
+<a name='L2375'></a><a href='#L2375'>2375</a>
+<a name='L2376'></a><a href='#L2376'>2376</a>
+<a name='L2377'></a><a href='#L2377'>2377</a>
+<a name='L2378'></a><a href='#L2378'>2378</a>
+<a name='L2379'></a><a href='#L2379'>2379</a>
+<a name='L2380'></a><a href='#L2380'>2380</a>
+<a name='L2381'></a><a href='#L2381'>2381</a>
+<a name='L2382'></a><a href='#L2382'>2382</a>
+<a name='L2383'></a><a href='#L2383'>2383</a>
+<a name='L2384'></a><a href='#L2384'>2384</a>
+<a name='L2385'></a><a href='#L2385'>2385</a>
+<a name='L2386'></a><a href='#L2386'>2386</a>
+<a name='L2387'></a><a href='#L2387'>2387</a>
+<a name='L2388'></a><a href='#L2388'>2388</a>
+<a name='L2389'></a><a href='#L2389'>2389</a>
+<a name='L2390'></a><a href='#L2390'>2390</a>
+<a name='L2391'></a><a href='#L2391'>2391</a>
+<a name='L2392'></a><a href='#L2392'>2392</a>
+<a name='L2393'></a><a href='#L2393'>2393</a>
+<a name='L2394'></a><a href='#L2394'>2394</a>
+<a name='L2395'></a><a href='#L2395'>2395</a>
+<a name='L2396'></a><a href='#L2396'>2396</a>
+<a name='L2397'></a><a href='#L2397'>2397</a>
+<a name='L2398'></a><a href='#L2398'>2398</a>
+<a name='L2399'></a><a href='#L2399'>2399</a>
+<a name='L2400'></a><a href='#L2400'>2400</a>
+<a name='L2401'></a><a href='#L2401'>2401</a>
+<a name='L2402'></a><a href='#L2402'>2402</a>
+<a name='L2403'></a><a href='#L2403'>2403</a>
+<a name='L2404'></a><a href='#L2404'>2404</a>
+<a name='L2405'></a><a href='#L2405'>2405</a>
+<a name='L2406'></a><a href='#L2406'>2406</a>
+<a name='L2407'></a><a href='#L2407'>2407</a>
+<a name='L2408'></a><a href='#L2408'>2408</a>
+<a name='L2409'></a><a href='#L2409'>2409</a>
+<a name='L2410'></a><a href='#L2410'>2410</a>
+<a name='L2411'></a><a href='#L2411'>2411</a>
+<a name='L2412'></a><a href='#L2412'>2412</a>
+<a name='L2413'></a><a href='#L2413'>2413</a>
+<a name='L2414'></a><a href='#L2414'>2414</a>
+<a name='L2415'></a><a href='#L2415'>2415</a>
+<a name='L2416'></a><a href='#L2416'>2416</a>
+<a name='L2417'></a><a href='#L2417'>2417</a>
+<a name='L2418'></a><a href='#L2418'>2418</a>
+<a name='L2419'></a><a href='#L2419'>2419</a>
+<a name='L2420'></a><a href='#L2420'>2420</a>
+<a name='L2421'></a><a href='#L2421'>2421</a>
+<a name='L2422'></a><a href='#L2422'>2422</a>
+<a name='L2423'></a><a href='#L2423'>2423</a>
+<a name='L2424'></a><a href='#L2424'>2424</a>
+<a name='L2425'></a><a href='#L2425'>2425</a>
+<a name='L2426'></a><a href='#L2426'>2426</a>
+<a name='L2427'></a><a href='#L2427'>2427</a>
+<a name='L2428'></a><a href='#L2428'>2428</a>
+<a name='L2429'></a><a href='#L2429'>2429</a>
+<a name='L2430'></a><a href='#L2430'>2430</a>
+<a name='L2431'></a><a href='#L2431'>2431</a>
+<a name='L2432'></a><a href='#L2432'>2432</a>
+<a name='L2433'></a><a href='#L2433'>2433</a>
+<a name='L2434'></a><a href='#L2434'>2434</a>
+<a name='L2435'></a><a href='#L2435'>2435</a>
+<a name='L2436'></a><a href='#L2436'>2436</a>
+<a name='L2437'></a><a href='#L2437'>2437</a>
+<a name='L2438'></a><a href='#L2438'>2438</a>
+<a name='L2439'></a><a href='#L2439'>2439</a>
+<a name='L2440'></a><a href='#L2440'>2440</a>
+<a name='L2441'></a><a href='#L2441'>2441</a>
+<a name='L2442'></a><a href='#L2442'>2442</a>
+<a name='L2443'></a><a href='#L2443'>2443</a>
+<a name='L2444'></a><a href='#L2444'>2444</a>
+<a name='L2445'></a><a href='#L2445'>2445</a>
+<a name='L2446'></a><a href='#L2446'>2446</a>
+<a name='L2447'></a><a href='#L2447'>2447</a>
+<a name='L2448'></a><a href='#L2448'>2448</a>
+<a name='L2449'></a><a href='#L2449'>2449</a>
+<a name='L2450'></a><a href='#L2450'>2450</a>
+<a name='L2451'></a><a href='#L2451'>2451</a>
+<a name='L2452'></a><a href='#L2452'>2452</a>
+<a name='L2453'></a><a href='#L2453'>2453</a>
+<a name='L2454'></a><a href='#L2454'>2454</a>
+<a name='L2455'></a><a href='#L2455'>2455</a>
+<a name='L2456'></a><a href='#L2456'>2456</a>
+<a name='L2457'></a><a href='#L2457'>2457</a>
+<a name='L2458'></a><a href='#L2458'>2458</a>
+<a name='L2459'></a><a href='#L2459'>2459</a>
+<a name='L2460'></a><a href='#L2460'>2460</a>
+<a name='L2461'></a><a href='#L2461'>2461</a>
+<a name='L2462'></a><a href='#L2462'>2462</a>
+<a name='L2463'></a><a href='#L2463'>2463</a>
+<a name='L2464'></a><a href='#L2464'>2464</a>
+<a name='L2465'></a><a href='#L2465'>2465</a>
+<a name='L2466'></a><a href='#L2466'>2466</a>
+<a name='L2467'></a><a href='#L2467'>2467</a>
+<a name='L2468'></a><a href='#L2468'>2468</a>
+<a name='L2469'></a><a href='#L2469'>2469</a>
+<a name='L2470'></a><a href='#L2470'>2470</a>
+<a name='L2471'></a><a href='#L2471'>2471</a>
+<a name='L2472'></a><a href='#L2472'>2472</a>
+<a name='L2473'></a><a href='#L2473'>2473</a>
+<a name='L2474'></a><a href='#L2474'>2474</a>
+<a name='L2475'></a><a href='#L2475'>2475</a>
+<a name='L2476'></a><a href='#L2476'>2476</a>
+<a name='L2477'></a><a href='#L2477'>2477</a>
+<a name='L2478'></a><a href='#L2478'>2478</a>
+<a name='L2479'></a><a href='#L2479'>2479</a>
+<a name='L2480'></a><a href='#L2480'>2480</a>
+<a name='L2481'></a><a href='#L2481'>2481</a>
+<a name='L2482'></a><a href='#L2482'>2482</a>
+<a name='L2483'></a><a href='#L2483'>2483</a>
+<a name='L2484'></a><a href='#L2484'>2484</a>
+<a name='L2485'></a><a href='#L2485'>2485</a>
+<a name='L2486'></a><a href='#L2486'>2486</a>
+<a name='L2487'></a><a href='#L2487'>2487</a>
+<a name='L2488'></a><a href='#L2488'>2488</a>
+<a name='L2489'></a><a href='#L2489'>2489</a>
+<a name='L2490'></a><a href='#L2490'>2490</a>
+<a name='L2491'></a><a href='#L2491'>2491</a>
+<a name='L2492'></a><a href='#L2492'>2492</a>
+<a name='L2493'></a><a href='#L2493'>2493</a>
+<a name='L2494'></a><a href='#L2494'>2494</a>
+<a name='L2495'></a><a href='#L2495'>2495</a>
+<a name='L2496'></a><a href='#L2496'>2496</a>
+<a name='L2497'></a><a href='#L2497'>2497</a>
+<a name='L2498'></a><a href='#L2498'>2498</a>
+<a name='L2499'></a><a href='#L2499'>2499</a>
+<a name='L2500'></a><a href='#L2500'>2500</a>
+<a name='L2501'></a><a href='#L2501'>2501</a>
+<a name='L2502'></a><a href='#L2502'>2502</a>
+<a name='L2503'></a><a href='#L2503'>2503</a>
+<a name='L2504'></a><a href='#L2504'>2504</a>
+<a name='L2505'></a><a href='#L2505'>2505</a>
+<a name='L2506'></a><a href='#L2506'>2506</a>
+<a name='L2507'></a><a href='#L2507'>2507</a>
+<a name='L2508'></a><a href='#L2508'>2508</a>
+<a name='L2509'></a><a href='#L2509'>2509</a>
+<a name='L2510'></a><a href='#L2510'>2510</a>
+<a name='L2511'></a><a href='#L2511'>2511</a>
+<a name='L2512'></a><a href='#L2512'>2512</a>
+<a name='L2513'></a><a href='#L2513'>2513</a>
+<a name='L2514'></a><a href='#L2514'>2514</a>
+<a name='L2515'></a><a href='#L2515'>2515</a>
+<a name='L2516'></a><a href='#L2516'>2516</a>
+<a name='L2517'></a><a href='#L2517'>2517</a>
+<a name='L2518'></a><a href='#L2518'>2518</a>
+<a name='L2519'></a><a href='#L2519'>2519</a>
+<a name='L2520'></a><a href='#L2520'>2520</a>
+<a name='L2521'></a><a href='#L2521'>2521</a>
+<a name='L2522'></a><a href='#L2522'>2522</a>
+<a name='L2523'></a><a href='#L2523'>2523</a>
+<a name='L2524'></a><a href='#L2524'>2524</a>
+<a name='L2525'></a><a href='#L2525'>2525</a>
+<a name='L2526'></a><a href='#L2526'>2526</a>
+<a name='L2527'></a><a href='#L2527'>2527</a>
+<a name='L2528'></a><a href='#L2528'>2528</a>
+<a name='L2529'></a><a href='#L2529'>2529</a>
+<a name='L2530'></a><a href='#L2530'>2530</a>
+<a name='L2531'></a><a href='#L2531'>2531</a>
+<a name='L2532'></a><a href='#L2532'>2532</a>
+<a name='L2533'></a><a href='#L2533'>2533</a>
+<a name='L2534'></a><a href='#L2534'>2534</a>
+<a name='L2535'></a><a href='#L2535'>2535</a>
+<a name='L2536'></a><a href='#L2536'>2536</a>
+<a name='L2537'></a><a href='#L2537'>2537</a>
+<a name='L2538'></a><a href='#L2538'>2538</a>
+<a name='L2539'></a><a href='#L2539'>2539</a>
+<a name='L2540'></a><a href='#L2540'>2540</a>
+<a name='L2541'></a><a href='#L2541'>2541</a>
+<a name='L2542'></a><a href='#L2542'>2542</a>
+<a name='L2543'></a><a href='#L2543'>2543</a>
+<a name='L2544'></a><a href='#L2544'>2544</a>
+<a name='L2545'></a><a href='#L2545'>2545</a>
+<a name='L2546'></a><a href='#L2546'>2546</a>
+<a name='L2547'></a><a href='#L2547'>2547</a>
+<a name='L2548'></a><a href='#L2548'>2548</a>
+<a name='L2549'></a><a href='#L2549'>2549</a>
+<a name='L2550'></a><a href='#L2550'>2550</a>
+<a name='L2551'></a><a href='#L2551'>2551</a>
+<a name='L2552'></a><a href='#L2552'>2552</a>
+<a name='L2553'></a><a href='#L2553'>2553</a>
+<a name='L2554'></a><a href='#L2554'>2554</a>
+<a name='L2555'></a><a href='#L2555'>2555</a>
+<a name='L2556'></a><a href='#L2556'>2556</a>
+<a name='L2557'></a><a href='#L2557'>2557</a>
+<a name='L2558'></a><a href='#L2558'>2558</a>
+<a name='L2559'></a><a href='#L2559'>2559</a>
+<a name='L2560'></a><a href='#L2560'>2560</a>
+<a name='L2561'></a><a href='#L2561'>2561</a>
+<a name='L2562'></a><a href='#L2562'>2562</a>
+<a name='L2563'></a><a href='#L2563'>2563</a>
+<a name='L2564'></a><a href='#L2564'>2564</a>
+<a name='L2565'></a><a href='#L2565'>2565</a>
+<a name='L2566'></a><a href='#L2566'>2566</a>
+<a name='L2567'></a><a href='#L2567'>2567</a>
+<a name='L2568'></a><a href='#L2568'>2568</a>
+<a name='L2569'></a><a href='#L2569'>2569</a>
+<a name='L2570'></a><a href='#L2570'>2570</a>
+<a name='L2571'></a><a href='#L2571'>2571</a>
+<a name='L2572'></a><a href='#L2572'>2572</a>
+<a name='L2573'></a><a href='#L2573'>2573</a>
+<a name='L2574'></a><a href='#L2574'>2574</a>
+<a name='L2575'></a><a href='#L2575'>2575</a>
+<a name='L2576'></a><a href='#L2576'>2576</a>
+<a name='L2577'></a><a href='#L2577'>2577</a>
+<a name='L2578'></a><a href='#L2578'>2578</a>
+<a name='L2579'></a><a href='#L2579'>2579</a>
+<a name='L2580'></a><a href='#L2580'>2580</a>
+<a name='L2581'></a><a href='#L2581'>2581</a>
+<a name='L2582'></a><a href='#L2582'>2582</a>
+<a name='L2583'></a><a href='#L2583'>2583</a>
+<a name='L2584'></a><a href='#L2584'>2584</a>
+<a name='L2585'></a><a href='#L2585'>2585</a>
+<a name='L2586'></a><a href='#L2586'>2586</a>
+<a name='L2587'></a><a href='#L2587'>2587</a>
+<a name='L2588'></a><a href='#L2588'>2588</a>
+<a name='L2589'></a><a href='#L2589'>2589</a>
+<a name='L2590'></a><a href='#L2590'>2590</a>
+<a name='L2591'></a><a href='#L2591'>2591</a>
+<a name='L2592'></a><a href='#L2592'>2592</a>
+<a name='L2593'></a><a href='#L2593'>2593</a>
+<a name='L2594'></a><a href='#L2594'>2594</a>
+<a name='L2595'></a><a href='#L2595'>2595</a>
+<a name='L2596'></a><a href='#L2596'>2596</a>
+<a name='L2597'></a><a href='#L2597'>2597</a>
+<a name='L2598'></a><a href='#L2598'>2598</a>
+<a name='L2599'></a><a href='#L2599'>2599</a>
+<a name='L2600'></a><a href='#L2600'>2600</a>
+<a name='L2601'></a><a href='#L2601'>2601</a>
+<a name='L2602'></a><a href='#L2602'>2602</a>
+<a name='L2603'></a><a href='#L2603'>2603</a>
+<a name='L2604'></a><a href='#L2604'>2604</a>
+<a name='L2605'></a><a href='#L2605'>2605</a>
+<a name='L2606'></a><a href='#L2606'>2606</a>
+<a name='L2607'></a><a href='#L2607'>2607</a>
+<a name='L2608'></a><a href='#L2608'>2608</a>
+<a name='L2609'></a><a href='#L2609'>2609</a>
+<a name='L2610'></a><a href='#L2610'>2610</a>
+<a name='L2611'></a><a href='#L2611'>2611</a>
+<a name='L2612'></a><a href='#L2612'>2612</a>
+<a name='L2613'></a><a href='#L2613'>2613</a>
+<a name='L2614'></a><a href='#L2614'>2614</a>
+<a name='L2615'></a><a href='#L2615'>2615</a>
+<a name='L2616'></a><a href='#L2616'>2616</a>
+<a name='L2617'></a><a href='#L2617'>2617</a>
+<a name='L2618'></a><a href='#L2618'>2618</a>
+<a name='L2619'></a><a href='#L2619'>2619</a>
+<a name='L2620'></a><a href='#L2620'>2620</a>
+<a name='L2621'></a><a href='#L2621'>2621</a>
+<a name='L2622'></a><a href='#L2622'>2622</a>
+<a name='L2623'></a><a href='#L2623'>2623</a>
+<a name='L2624'></a><a href='#L2624'>2624</a>
+<a name='L2625'></a><a href='#L2625'>2625</a>
+<a name='L2626'></a><a href='#L2626'>2626</a>
+<a name='L2627'></a><a href='#L2627'>2627</a>
+<a name='L2628'></a><a href='#L2628'>2628</a>
+<a name='L2629'></a><a href='#L2629'>2629</a>
+<a name='L2630'></a><a href='#L2630'>2630</a>
+<a name='L2631'></a><a href='#L2631'>2631</a>
+<a name='L2632'></a><a href='#L2632'>2632</a>
+<a name='L2633'></a><a href='#L2633'>2633</a>
+<a name='L2634'></a><a href='#L2634'>2634</a>
+<a name='L2635'></a><a href='#L2635'>2635</a>
+<a name='L2636'></a><a href='#L2636'>2636</a>
+<a name='L2637'></a><a href='#L2637'>2637</a>
+<a name='L2638'></a><a href='#L2638'>2638</a>
+<a name='L2639'></a><a href='#L2639'>2639</a>
+<a name='L2640'></a><a href='#L2640'>2640</a>
+<a name='L2641'></a><a href='#L2641'>2641</a>
+<a name='L2642'></a><a href='#L2642'>2642</a>
+<a name='L2643'></a><a href='#L2643'>2643</a>
+<a name='L2644'></a><a href='#L2644'>2644</a>
+<a name='L2645'></a><a href='#L2645'>2645</a>
+<a name='L2646'></a><a href='#L2646'>2646</a>
+<a name='L2647'></a><a href='#L2647'>2647</a>
+<a name='L2648'></a><a href='#L2648'>2648</a>
+<a name='L2649'></a><a href='#L2649'>2649</a>
+<a name='L2650'></a><a href='#L2650'>2650</a>
+<a name='L2651'></a><a href='#L2651'>2651</a>
+<a name='L2652'></a><a href='#L2652'>2652</a>
+<a name='L2653'></a><a href='#L2653'>2653</a>
+<a name='L2654'></a><a href='#L2654'>2654</a>
+<a name='L2655'></a><a href='#L2655'>2655</a>
+<a name='L2656'></a><a href='#L2656'>2656</a>
+<a name='L2657'></a><a href='#L2657'>2657</a>
+<a name='L2658'></a><a href='#L2658'>2658</a>
+<a name='L2659'></a><a href='#L2659'>2659</a>
+<a name='L2660'></a><a href='#L2660'>2660</a>
+<a name='L2661'></a><a href='#L2661'>2661</a>
+<a name='L2662'></a><a href='#L2662'>2662</a>
+<a name='L2663'></a><a href='#L2663'>2663</a>
+<a name='L2664'></a><a href='#L2664'>2664</a>
+<a name='L2665'></a><a href='#L2665'>2665</a>
+<a name='L2666'></a><a href='#L2666'>2666</a>
+<a name='L2667'></a><a href='#L2667'>2667</a>
+<a name='L2668'></a><a href='#L2668'>2668</a>
+<a name='L2669'></a><a href='#L2669'>2669</a>
+<a name='L2670'></a><a href='#L2670'>2670</a>
+<a name='L2671'></a><a href='#L2671'>2671</a>
+<a name='L2672'></a><a href='#L2672'>2672</a>
+<a name='L2673'></a><a href='#L2673'>2673</a>
+<a name='L2674'></a><a href='#L2674'>2674</a>
+<a name='L2675'></a><a href='#L2675'>2675</a>
+<a name='L2676'></a><a href='#L2676'>2676</a>
+<a name='L2677'></a><a href='#L2677'>2677</a>
+<a name='L2678'></a><a href='#L2678'>2678</a>
+<a name='L2679'></a><a href='#L2679'>2679</a>
+<a name='L2680'></a><a href='#L2680'>2680</a>
+<a name='L2681'></a><a href='#L2681'>2681</a>
+<a name='L2682'></a><a href='#L2682'>2682</a>
+<a name='L2683'></a><a href='#L2683'>2683</a>
+<a name='L2684'></a><a href='#L2684'>2684</a>
+<a name='L2685'></a><a href='#L2685'>2685</a>
+<a name='L2686'></a><a href='#L2686'>2686</a>
+<a name='L2687'></a><a href='#L2687'>2687</a>
+<a name='L2688'></a><a href='#L2688'>2688</a>
+<a name='L2689'></a><a href='#L2689'>2689</a>
+<a name='L2690'></a><a href='#L2690'>2690</a>
+<a name='L2691'></a><a href='#L2691'>2691</a>
+<a name='L2692'></a><a href='#L2692'>2692</a>
+<a name='L2693'></a><a href='#L2693'>2693</a>
+<a name='L2694'></a><a href='#L2694'>2694</a>
+<a name='L2695'></a><a href='#L2695'>2695</a>
+<a name='L2696'></a><a href='#L2696'>2696</a>
+<a name='L2697'></a><a href='#L2697'>2697</a>
+<a name='L2698'></a><a href='#L2698'>2698</a>
+<a name='L2699'></a><a href='#L2699'>2699</a>
+<a name='L2700'></a><a href='#L2700'>2700</a>
+<a name='L2701'></a><a href='#L2701'>2701</a>
+<a name='L2702'></a><a href='#L2702'>2702</a>
+<a name='L2703'></a><a href='#L2703'>2703</a>
+<a name='L2704'></a><a href='#L2704'>2704</a>
+<a name='L2705'></a><a href='#L2705'>2705</a>
+<a name='L2706'></a><a href='#L2706'>2706</a>
+<a name='L2707'></a><a href='#L2707'>2707</a>
+<a name='L2708'></a><a href='#L2708'>2708</a>
+<a name='L2709'></a><a href='#L2709'>2709</a>
+<a name='L2710'></a><a href='#L2710'>2710</a>
+<a name='L2711'></a><a href='#L2711'>2711</a>
+<a name='L2712'></a><a href='#L2712'>2712</a>
+<a name='L2713'></a><a href='#L2713'>2713</a>
+<a name='L2714'></a><a href='#L2714'>2714</a>
+<a name='L2715'></a><a href='#L2715'>2715</a>
+<a name='L2716'></a><a href='#L2716'>2716</a>
+<a name='L2717'></a><a href='#L2717'>2717</a>
+<a name='L2718'></a><a href='#L2718'>2718</a>
+<a name='L2719'></a><a href='#L2719'>2719</a>
+<a name='L2720'></a><a href='#L2720'>2720</a>
+<a name='L2721'></a><a href='#L2721'>2721</a>
+<a name='L2722'></a><a href='#L2722'>2722</a>
+<a name='L2723'></a><a href='#L2723'>2723</a>
+<a name='L2724'></a><a href='#L2724'>2724</a>
+<a name='L2725'></a><a href='#L2725'>2725</a>
+<a name='L2726'></a><a href='#L2726'>2726</a>
+<a name='L2727'></a><a href='#L2727'>2727</a>
+<a name='L2728'></a><a href='#L2728'>2728</a>
+<a name='L2729'></a><a href='#L2729'>2729</a>
+<a name='L2730'></a><a href='#L2730'>2730</a>
+<a name='L2731'></a><a href='#L2731'>2731</a>
+<a name='L2732'></a><a href='#L2732'>2732</a>
+<a name='L2733'></a><a href='#L2733'>2733</a>
+<a name='L2734'></a><a href='#L2734'>2734</a>
+<a name='L2735'></a><a href='#L2735'>2735</a>
+<a name='L2736'></a><a href='#L2736'>2736</a>
+<a name='L2737'></a><a href='#L2737'>2737</a>
+<a name='L2738'></a><a href='#L2738'>2738</a>
+<a name='L2739'></a><a href='#L2739'>2739</a>
+<a name='L2740'></a><a href='#L2740'>2740</a>
+<a name='L2741'></a><a href='#L2741'>2741</a>
+<a name='L2742'></a><a href='#L2742'>2742</a>
+<a name='L2743'></a><a href='#L2743'>2743</a>
+<a name='L2744'></a><a href='#L2744'>2744</a>
+<a name='L2745'></a><a href='#L2745'>2745</a>
+<a name='L2746'></a><a href='#L2746'>2746</a>
+<a name='L2747'></a><a href='#L2747'>2747</a>
+<a name='L2748'></a><a href='#L2748'>2748</a>
+<a name='L2749'></a><a href='#L2749'>2749</a>
+<a name='L2750'></a><a href='#L2750'>2750</a>
+<a name='L2751'></a><a href='#L2751'>2751</a>
+<a name='L2752'></a><a href='#L2752'>2752</a>
+<a name='L2753'></a><a href='#L2753'>2753</a>
+<a name='L2754'></a><a href='#L2754'>2754</a>
+<a name='L2755'></a><a href='#L2755'>2755</a>
+<a name='L2756'></a><a href='#L2756'>2756</a>
+<a name='L2757'></a><a href='#L2757'>2757</a>
+<a name='L2758'></a><a href='#L2758'>2758</a>
+<a name='L2759'></a><a href='#L2759'>2759</a>
+<a name='L2760'></a><a href='#L2760'>2760</a>
+<a name='L2761'></a><a href='#L2761'>2761</a>
+<a name='L2762'></a><a href='#L2762'>2762</a>
+<a name='L2763'></a><a href='#L2763'>2763</a>
+<a name='L2764'></a><a href='#L2764'>2764</a>
+<a name='L2765'></a><a href='#L2765'>2765</a>
+<a name='L2766'></a><a href='#L2766'>2766</a>
+<a name='L2767'></a><a href='#L2767'>2767</a>
+<a name='L2768'></a><a href='#L2768'>2768</a>
+<a name='L2769'></a><a href='#L2769'>2769</a>
+<a name='L2770'></a><a href='#L2770'>2770</a>
+<a name='L2771'></a><a href='#L2771'>2771</a>
+<a name='L2772'></a><a href='#L2772'>2772</a>
+<a name='L2773'></a><a href='#L2773'>2773</a>
+<a name='L2774'></a><a href='#L2774'>2774</a>
+<a name='L2775'></a><a href='#L2775'>2775</a>
+<a name='L2776'></a><a href='#L2776'>2776</a>
+<a name='L2777'></a><a href='#L2777'>2777</a>
+<a name='L2778'></a><a href='#L2778'>2778</a>
+<a name='L2779'></a><a href='#L2779'>2779</a>
+<a name='L2780'></a><a href='#L2780'>2780</a>
+<a name='L2781'></a><a href='#L2781'>2781</a>
+<a name='L2782'></a><a href='#L2782'>2782</a>
+<a name='L2783'></a><a href='#L2783'>2783</a>
+<a name='L2784'></a><a href='#L2784'>2784</a>
+<a name='L2785'></a><a href='#L2785'>2785</a>
+<a name='L2786'></a><a href='#L2786'>2786</a>
+<a name='L2787'></a><a href='#L2787'>2787</a>
+<a name='L2788'></a><a href='#L2788'>2788</a>
+<a name='L2789'></a><a href='#L2789'>2789</a>
+<a name='L2790'></a><a href='#L2790'>2790</a>
+<a name='L2791'></a><a href='#L2791'>2791</a>
+<a name='L2792'></a><a href='#L2792'>2792</a>
+<a name='L2793'></a><a href='#L2793'>2793</a>
+<a name='L2794'></a><a href='#L2794'>2794</a>
+<a name='L2795'></a><a href='#L2795'>2795</a>
+<a name='L2796'></a><a href='#L2796'>2796</a>
+<a name='L2797'></a><a href='#L2797'>2797</a>
+<a name='L2798'></a><a href='#L2798'>2798</a>
+<a name='L2799'></a><a href='#L2799'>2799</a>
+<a name='L2800'></a><a href='#L2800'>2800</a>
+<a name='L2801'></a><a href='#L2801'>2801</a>
+<a name='L2802'></a><a href='#L2802'>2802</a>
+<a name='L2803'></a><a href='#L2803'>2803</a>
+<a name='L2804'></a><a href='#L2804'>2804</a>
+<a name='L2805'></a><a href='#L2805'>2805</a>
+<a name='L2806'></a><a href='#L2806'>2806</a>
+<a name='L2807'></a><a href='#L2807'>2807</a>
+<a name='L2808'></a><a href='#L2808'>2808</a>
+<a name='L2809'></a><a href='#L2809'>2809</a>
+<a name='L2810'></a><a href='#L2810'>2810</a>
+<a name='L2811'></a><a href='#L2811'>2811</a>
+<a name='L2812'></a><a href='#L2812'>2812</a>
+<a name='L2813'></a><a href='#L2813'>2813</a>
+<a name='L2814'></a><a href='#L2814'>2814</a>
+<a name='L2815'></a><a href='#L2815'>2815</a>
+<a name='L2816'></a><a href='#L2816'>2816</a>
+<a name='L2817'></a><a href='#L2817'>2817</a>
+<a name='L2818'></a><a href='#L2818'>2818</a>
+<a name='L2819'></a><a href='#L2819'>2819</a>
+<a name='L2820'></a><a href='#L2820'>2820</a>
+<a name='L2821'></a><a href='#L2821'>2821</a>
+<a name='L2822'></a><a href='#L2822'>2822</a>
+<a name='L2823'></a><a href='#L2823'>2823</a>
+<a name='L2824'></a><a href='#L2824'>2824</a>
+<a name='L2825'></a><a href='#L2825'>2825</a>
+<a name='L2826'></a><a href='#L2826'>2826</a>
+<a name='L2827'></a><a href='#L2827'>2827</a>
+<a name='L2828'></a><a href='#L2828'>2828</a>
+<a name='L2829'></a><a href='#L2829'>2829</a>
+<a name='L2830'></a><a href='#L2830'>2830</a>
+<a name='L2831'></a><a href='#L2831'>2831</a>
+<a name='L2832'></a><a href='#L2832'>2832</a>
+<a name='L2833'></a><a href='#L2833'>2833</a>
+<a name='L2834'></a><a href='#L2834'>2834</a>
+<a name='L2835'></a><a href='#L2835'>2835</a>
+<a name='L2836'></a><a href='#L2836'>2836</a>
+<a name='L2837'></a><a href='#L2837'>2837</a>
+<a name='L2838'></a><a href='#L2838'>2838</a>
+<a name='L2839'></a><a href='#L2839'>2839</a>
+<a name='L2840'></a><a href='#L2840'>2840</a>
+<a name='L2841'></a><a href='#L2841'>2841</a>
+<a name='L2842'></a><a href='#L2842'>2842</a>
+<a name='L2843'></a><a href='#L2843'>2843</a>
+<a name='L2844'></a><a href='#L2844'>2844</a>
+<a name='L2845'></a><a href='#L2845'>2845</a>
+<a name='L2846'></a><a href='#L2846'>2846</a>
+<a name='L2847'></a><a href='#L2847'>2847</a>
+<a name='L2848'></a><a href='#L2848'>2848</a>
+<a name='L2849'></a><a href='#L2849'>2849</a>
+<a name='L2850'></a><a href='#L2850'>2850</a>
+<a name='L2851'></a><a href='#L2851'>2851</a>
+<a name='L2852'></a><a href='#L2852'>2852</a>
+<a name='L2853'></a><a href='#L2853'>2853</a>
+<a name='L2854'></a><a href='#L2854'>2854</a>
+<a name='L2855'></a><a href='#L2855'>2855</a>
+<a name='L2856'></a><a href='#L2856'>2856</a>
+<a name='L2857'></a><a href='#L2857'>2857</a>
+<a name='L2858'></a><a href='#L2858'>2858</a>
+<a name='L2859'></a><a href='#L2859'>2859</a>
+<a name='L2860'></a><a href='#L2860'>2860</a>
+<a name='L2861'></a><a href='#L2861'>2861</a>
+<a name='L2862'></a><a href='#L2862'>2862</a>
+<a name='L2863'></a><a href='#L2863'>2863</a>
+<a name='L2864'></a><a href='#L2864'>2864</a>
+<a name='L2865'></a><a href='#L2865'>2865</a>
+<a name='L2866'></a><a href='#L2866'>2866</a>
+<a name='L2867'></a><a href='#L2867'>2867</a>
+<a name='L2868'></a><a href='#L2868'>2868</a>
+<a name='L2869'></a><a href='#L2869'>2869</a>
+<a name='L2870'></a><a href='#L2870'>2870</a>
+<a name='L2871'></a><a href='#L2871'>2871</a>
+<a name='L2872'></a><a href='#L2872'>2872</a>
+<a name='L2873'></a><a href='#L2873'>2873</a>
+<a name='L2874'></a><a href='#L2874'>2874</a>
+<a name='L2875'></a><a href='#L2875'>2875</a>
+<a name='L2876'></a><a href='#L2876'>2876</a>
+<a name='L2877'></a><a href='#L2877'>2877</a>
+<a name='L2878'></a><a href='#L2878'>2878</a>
+<a name='L2879'></a><a href='#L2879'>2879</a>
+<a name='L2880'></a><a href='#L2880'>2880</a>
+<a name='L2881'></a><a href='#L2881'>2881</a>
+<a name='L2882'></a><a href='#L2882'>2882</a>
+<a name='L2883'></a><a href='#L2883'>2883</a>
+<a name='L2884'></a><a href='#L2884'>2884</a>
+<a name='L2885'></a><a href='#L2885'>2885</a>
+<a name='L2886'></a><a href='#L2886'>2886</a>
+<a name='L2887'></a><a href='#L2887'>2887</a>
+<a name='L2888'></a><a href='#L2888'>2888</a>
+<a name='L2889'></a><a href='#L2889'>2889</a>
+<a name='L2890'></a><a href='#L2890'>2890</a>
+<a name='L2891'></a><a href='#L2891'>2891</a>
+<a name='L2892'></a><a href='#L2892'>2892</a>
+<a name='L2893'></a><a href='#L2893'>2893</a>
+<a name='L2894'></a><a href='#L2894'>2894</a>
+<a name='L2895'></a><a href='#L2895'>2895</a>
+<a name='L2896'></a><a href='#L2896'>2896</a>
+<a name='L2897'></a><a href='#L2897'>2897</a>
+<a name='L2898'></a><a href='#L2898'>2898</a>
+<a name='L2899'></a><a href='#L2899'>2899</a>
+<a name='L2900'></a><a href='#L2900'>2900</a>
+<a name='L2901'></a><a href='#L2901'>2901</a>
+<a name='L2902'></a><a href='#L2902'>2902</a>
+<a name='L2903'></a><a href='#L2903'>2903</a>
+<a name='L2904'></a><a href='#L2904'>2904</a>
+<a name='L2905'></a><a href='#L2905'>2905</a>
+<a name='L2906'></a><a href='#L2906'>2906</a>
+<a name='L2907'></a><a href='#L2907'>2907</a>
+<a name='L2908'></a><a href='#L2908'>2908</a>
+<a name='L2909'></a><a href='#L2909'>2909</a>
+<a name='L2910'></a><a href='#L2910'>2910</a>
+<a name='L2911'></a><a href='#L2911'>2911</a>
+<a name='L2912'></a><a href='#L2912'>2912</a>
+<a name='L2913'></a><a href='#L2913'>2913</a>
+<a name='L2914'></a><a href='#L2914'>2914</a>
+<a name='L2915'></a><a href='#L2915'>2915</a>
+<a name='L2916'></a><a href='#L2916'>2916</a>
+<a name='L2917'></a><a href='#L2917'>2917</a>
+<a name='L2918'></a><a href='#L2918'>2918</a>
+<a name='L2919'></a><a href='#L2919'>2919</a>
+<a name='L2920'></a><a href='#L2920'>2920</a>
+<a name='L2921'></a><a href='#L2921'>2921</a>
+<a name='L2922'></a><a href='#L2922'>2922</a>
+<a name='L2923'></a><a href='#L2923'>2923</a>
+<a name='L2924'></a><a href='#L2924'>2924</a>
+<a name='L2925'></a><a href='#L2925'>2925</a>
+<a name='L2926'></a><a href='#L2926'>2926</a>
+<a name='L2927'></a><a href='#L2927'>2927</a>
+<a name='L2928'></a><a href='#L2928'>2928</a>
+<a name='L2929'></a><a href='#L2929'>2929</a>
+<a name='L2930'></a><a href='#L2930'>2930</a>
+<a name='L2931'></a><a href='#L2931'>2931</a>
+<a name='L2932'></a><a href='#L2932'>2932</a>
+<a name='L2933'></a><a href='#L2933'>2933</a>
+<a name='L2934'></a><a href='#L2934'>2934</a>
+<a name='L2935'></a><a href='#L2935'>2935</a>
+<a name='L2936'></a><a href='#L2936'>2936</a>
+<a name='L2937'></a><a href='#L2937'>2937</a>
+<a name='L2938'></a><a href='#L2938'>2938</a>
+<a name='L2939'></a><a href='#L2939'>2939</a>
+<a name='L2940'></a><a href='#L2940'>2940</a>
+<a name='L2941'></a><a href='#L2941'>2941</a>
+<a name='L2942'></a><a href='#L2942'>2942</a>
+<a name='L2943'></a><a href='#L2943'>2943</a>
+<a name='L2944'></a><a href='#L2944'>2944</a>
+<a name='L2945'></a><a href='#L2945'>2945</a>
+<a name='L2946'></a><a href='#L2946'>2946</a>
+<a name='L2947'></a><a href='#L2947'>2947</a>
+<a name='L2948'></a><a href='#L2948'>2948</a>
+<a name='L2949'></a><a href='#L2949'>2949</a>
+<a name='L2950'></a><a href='#L2950'>2950</a>
+<a name='L2951'></a><a href='#L2951'>2951</a>
+<a name='L2952'></a><a href='#L2952'>2952</a>
+<a name='L2953'></a><a href='#L2953'>2953</a>
+<a name='L2954'></a><a href='#L2954'>2954</a>
+<a name='L2955'></a><a href='#L2955'>2955</a>
+<a name='L2956'></a><a href='#L2956'>2956</a>
+<a name='L2957'></a><a href='#L2957'>2957</a>
+<a name='L2958'></a><a href='#L2958'>2958</a>
+<a name='L2959'></a><a href='#L2959'>2959</a>
+<a name='L2960'></a><a href='#L2960'>2960</a>
+<a name='L2961'></a><a href='#L2961'>2961</a>
+<a name='L2962'></a><a href='#L2962'>2962</a>
+<a name='L2963'></a><a href='#L2963'>2963</a>
+<a name='L2964'></a><a href='#L2964'>2964</a>
+<a name='L2965'></a><a href='#L2965'>2965</a>
+<a name='L2966'></a><a href='#L2966'>2966</a>
+<a name='L2967'></a><a href='#L2967'>2967</a>
+<a name='L2968'></a><a href='#L2968'>2968</a>
+<a name='L2969'></a><a href='#L2969'>2969</a>
+<a name='L2970'></a><a href='#L2970'>2970</a>
+<a name='L2971'></a><a href='#L2971'>2971</a>
+<a name='L2972'></a><a href='#L2972'>2972</a>
+<a name='L2973'></a><a href='#L2973'>2973</a>
+<a name='L2974'></a><a href='#L2974'>2974</a>
+<a name='L2975'></a><a href='#L2975'>2975</a>
+<a name='L2976'></a><a href='#L2976'>2976</a>
+<a name='L2977'></a><a href='#L2977'>2977</a>
+<a name='L2978'></a><a href='#L2978'>2978</a>
+<a name='L2979'></a><a href='#L2979'>2979</a>
+<a name='L2980'></a><a href='#L2980'>2980</a>
+<a name='L2981'></a><a href='#L2981'>2981</a>
+<a name='L2982'></a><a href='#L2982'>2982</a>
+<a name='L2983'></a><a href='#L2983'>2983</a>
+<a name='L2984'></a><a href='#L2984'>2984</a>
+<a name='L2985'></a><a href='#L2985'>2985</a>
+<a name='L2986'></a><a href='#L2986'>2986</a>
+<a name='L2987'></a><a href='#L2987'>2987</a>
+<a name='L2988'></a><a href='#L2988'>2988</a>
+<a name='L2989'></a><a href='#L2989'>2989</a>
+<a name='L2990'></a><a href='#L2990'>2990</a>
+<a name='L2991'></a><a href='#L2991'>2991</a>
+<a name='L2992'></a><a href='#L2992'>2992</a>
+<a name='L2993'></a><a href='#L2993'>2993</a>
+<a name='L2994'></a><a href='#L2994'>2994</a>
+<a name='L2995'></a><a href='#L2995'>2995</a>
+<a name='L2996'></a><a href='#L2996'>2996</a>
+<a name='L2997'></a><a href='#L2997'>2997</a>
+<a name='L2998'></a><a href='#L2998'>2998</a>
+<a name='L2999'></a><a href='#L2999'>2999</a>
+<a name='L3000'></a><a href='#L3000'>3000</a>
+<a name='L3001'></a><a href='#L3001'>3001</a>
+<a name='L3002'></a><a href='#L3002'>3002</a>
+<a name='L3003'></a><a href='#L3003'>3003</a>
+<a name='L3004'></a><a href='#L3004'>3004</a>
+<a name='L3005'></a><a href='#L3005'>3005</a>
+<a name='L3006'></a><a href='#L3006'>3006</a>
+<a name='L3007'></a><a href='#L3007'>3007</a>
+<a name='L3008'></a><a href='#L3008'>3008</a>
+<a name='L3009'></a><a href='#L3009'>3009</a>
+<a name='L3010'></a><a href='#L3010'>3010</a>
+<a name='L3011'></a><a href='#L3011'>3011</a>
+<a name='L3012'></a><a href='#L3012'>3012</a>
+<a name='L3013'></a><a href='#L3013'>3013</a>
+<a name='L3014'></a><a href='#L3014'>3014</a>
+<a name='L3015'></a><a href='#L3015'>3015</a>
+<a name='L3016'></a><a href='#L3016'>3016</a>
+<a name='L3017'></a><a href='#L3017'>3017</a>
+<a name='L3018'></a><a href='#L3018'>3018</a>
+<a name='L3019'></a><a href='#L3019'>3019</a>
+<a name='L3020'></a><a href='#L3020'>3020</a>
+<a name='L3021'></a><a href='#L3021'>3021</a>
+<a name='L3022'></a><a href='#L3022'>3022</a>
+<a name='L3023'></a><a href='#L3023'>3023</a>
+<a name='L3024'></a><a href='#L3024'>3024</a>
+<a name='L3025'></a><a href='#L3025'>3025</a>
+<a name='L3026'></a><a href='#L3026'>3026</a>
+<a name='L3027'></a><a href='#L3027'>3027</a>
+<a name='L3028'></a><a href='#L3028'>3028</a>
+<a name='L3029'></a><a href='#L3029'>3029</a>
+<a name='L3030'></a><a href='#L3030'>3030</a>
+<a name='L3031'></a><a href='#L3031'>3031</a>
+<a name='L3032'></a><a href='#L3032'>3032</a>
+<a name='L3033'></a><a href='#L3033'>3033</a>
+<a name='L3034'></a><a href='#L3034'>3034</a>
+<a name='L3035'></a><a href='#L3035'>3035</a>
+<a name='L3036'></a><a href='#L3036'>3036</a>
+<a name='L3037'></a><a href='#L3037'>3037</a>
+<a name='L3038'></a><a href='#L3038'>3038</a>
+<a name='L3039'></a><a href='#L3039'>3039</a>
+<a name='L3040'></a><a href='#L3040'>3040</a>
+<a name='L3041'></a><a href='#L3041'>3041</a>
+<a name='L3042'></a><a href='#L3042'>3042</a>
+<a name='L3043'></a><a href='#L3043'>3043</a>
+<a name='L3044'></a><a href='#L3044'>3044</a>
+<a name='L3045'></a><a href='#L3045'>3045</a>
+<a name='L3046'></a><a href='#L3046'>3046</a>
+<a name='L3047'></a><a href='#L3047'>3047</a>
+<a name='L3048'></a><a href='#L3048'>3048</a>
+<a name='L3049'></a><a href='#L3049'>3049</a>
+<a name='L3050'></a><a href='#L3050'>3050</a>
+<a name='L3051'></a><a href='#L3051'>3051</a>
+<a name='L3052'></a><a href='#L3052'>3052</a>
+<a name='L3053'></a><a href='#L3053'>3053</a>
+<a name='L3054'></a><a href='#L3054'>3054</a>
+<a name='L3055'></a><a href='#L3055'>3055</a>
+<a name='L3056'></a><a href='#L3056'>3056</a>
+<a name='L3057'></a><a href='#L3057'>3057</a>
+<a name='L3058'></a><a href='#L3058'>3058</a>
+<a name='L3059'></a><a href='#L3059'>3059</a>
+<a name='L3060'></a><a href='#L3060'>3060</a>
+<a name='L3061'></a><a href='#L3061'>3061</a>
+<a name='L3062'></a><a href='#L3062'>3062</a>
+<a name='L3063'></a><a href='#L3063'>3063</a>
+<a name='L3064'></a><a href='#L3064'>3064</a>
+<a name='L3065'></a><a href='#L3065'>3065</a>
+<a name='L3066'></a><a href='#L3066'>3066</a>
+<a name='L3067'></a><a href='#L3067'>3067</a>
+<a name='L3068'></a><a href='#L3068'>3068</a>
+<a name='L3069'></a><a href='#L3069'>3069</a>
+<a name='L3070'></a><a href='#L3070'>3070</a>
+<a name='L3071'></a><a href='#L3071'>3071</a>
+<a name='L3072'></a><a href='#L3072'>3072</a>
+<a name='L3073'></a><a href='#L3073'>3073</a>
+<a name='L3074'></a><a href='#L3074'>3074</a>
+<a name='L3075'></a><a href='#L3075'>3075</a>
+<a name='L3076'></a><a href='#L3076'>3076</a>
+<a name='L3077'></a><a href='#L3077'>3077</a>
+<a name='L3078'></a><a href='#L3078'>3078</a>
+<a name='L3079'></a><a href='#L3079'>3079</a>
+<a name='L3080'></a><a href='#L3080'>3080</a>
+<a name='L3081'></a><a href='#L3081'>3081</a>
+<a name='L3082'></a><a href='#L3082'>3082</a>
+<a name='L3083'></a><a href='#L3083'>3083</a>
+<a name='L3084'></a><a href='#L3084'>3084</a>
+<a name='L3085'></a><a href='#L3085'>3085</a>
+<a name='L3086'></a><a href='#L3086'>3086</a>
+<a name='L3087'></a><a href='#L3087'>3087</a>
+<a name='L3088'></a><a href='#L3088'>3088</a>
+<a name='L3089'></a><a href='#L3089'>3089</a>
+<a name='L3090'></a><a href='#L3090'>3090</a>
+<a name='L3091'></a><a href='#L3091'>3091</a>
+<a name='L3092'></a><a href='#L3092'>3092</a>
+<a name='L3093'></a><a href='#L3093'>3093</a>
+<a name='L3094'></a><a href='#L3094'>3094</a>
+<a name='L3095'></a><a href='#L3095'>3095</a>
+<a name='L3096'></a><a href='#L3096'>3096</a>
+<a name='L3097'></a><a href='#L3097'>3097</a>
+<a name='L3098'></a><a href='#L3098'>3098</a>
+<a name='L3099'></a><a href='#L3099'>3099</a>
+<a name='L3100'></a><a href='#L3100'>3100</a>
+<a name='L3101'></a><a href='#L3101'>3101</a>
+<a name='L3102'></a><a href='#L3102'>3102</a>
+<a name='L3103'></a><a href='#L3103'>3103</a>
+<a name='L3104'></a><a href='#L3104'>3104</a>
+<a name='L3105'></a><a href='#L3105'>3105</a>
+<a name='L3106'></a><a href='#L3106'>3106</a>
+<a name='L3107'></a><a href='#L3107'>3107</a>
+<a name='L3108'></a><a href='#L3108'>3108</a>
+<a name='L3109'></a><a href='#L3109'>3109</a>
+<a name='L3110'></a><a href='#L3110'>3110</a>
+<a name='L3111'></a><a href='#L3111'>3111</a>
+<a name='L3112'></a><a href='#L3112'>3112</a>
+<a name='L3113'></a><a href='#L3113'>3113</a>
+<a name='L3114'></a><a href='#L3114'>3114</a>
+<a name='L3115'></a><a href='#L3115'>3115</a>
+<a name='L3116'></a><a href='#L3116'>3116</a>
+<a name='L3117'></a><a href='#L3117'>3117</a>
+<a name='L3118'></a><a href='#L3118'>3118</a>
+<a name='L3119'></a><a href='#L3119'>3119</a>
+<a name='L3120'></a><a href='#L3120'>3120</a>
+<a name='L3121'></a><a href='#L3121'>3121</a>
+<a name='L3122'></a><a href='#L3122'>3122</a>
+<a name='L3123'></a><a href='#L3123'>3123</a>
+<a name='L3124'></a><a href='#L3124'>3124</a>
+<a name='L3125'></a><a href='#L3125'>3125</a>
+<a name='L3126'></a><a href='#L3126'>3126</a>
+<a name='L3127'></a><a href='#L3127'>3127</a>
+<a name='L3128'></a><a href='#L3128'>3128</a>
+<a name='L3129'></a><a href='#L3129'>3129</a>
+<a name='L3130'></a><a href='#L3130'>3130</a>
+<a name='L3131'></a><a href='#L3131'>3131</a>
+<a name='L3132'></a><a href='#L3132'>3132</a>
+<a name='L3133'></a><a href='#L3133'>3133</a>
+<a name='L3134'></a><a href='#L3134'>3134</a>
+<a name='L3135'></a><a href='#L3135'>3135</a>
+<a name='L3136'></a><a href='#L3136'>3136</a>
+<a name='L3137'></a><a href='#L3137'>3137</a>
+<a name='L3138'></a><a href='#L3138'>3138</a>
+<a name='L3139'></a><a href='#L3139'>3139</a>
+<a name='L3140'></a><a href='#L3140'>3140</a>
+<a name='L3141'></a><a href='#L3141'>3141</a>
+<a name='L3142'></a><a href='#L3142'>3142</a>
+<a name='L3143'></a><a href='#L3143'>3143</a>
+<a name='L3144'></a><a href='#L3144'>3144</a>
+<a name='L3145'></a><a href='#L3145'>3145</a>
+<a name='L3146'></a><a href='#L3146'>3146</a>
+<a name='L3147'></a><a href='#L3147'>3147</a>
+<a name='L3148'></a><a href='#L3148'>3148</a>
+<a name='L3149'></a><a href='#L3149'>3149</a>
+<a name='L3150'></a><a href='#L3150'>3150</a>
+<a name='L3151'></a><a href='#L3151'>3151</a>
+<a name='L3152'></a><a href='#L3152'>3152</a>
+<a name='L3153'></a><a href='#L3153'>3153</a>
+<a name='L3154'></a><a href='#L3154'>3154</a>
+<a name='L3155'></a><a href='#L3155'>3155</a>
+<a name='L3156'></a><a href='#L3156'>3156</a>
+<a name='L3157'></a><a href='#L3157'>3157</a>
+<a name='L3158'></a><a href='#L3158'>3158</a>
+<a name='L3159'></a><a href='#L3159'>3159</a>
+<a name='L3160'></a><a href='#L3160'>3160</a>
+<a name='L3161'></a><a href='#L3161'>3161</a>
+<a name='L3162'></a><a href='#L3162'>3162</a>
+<a name='L3163'></a><a href='#L3163'>3163</a>
+<a name='L3164'></a><a href='#L3164'>3164</a>
+<a name='L3165'></a><a href='#L3165'>3165</a>
+<a name='L3166'></a><a href='#L3166'>3166</a>
+<a name='L3167'></a><a href='#L3167'>3167</a>
+<a name='L3168'></a><a href='#L3168'>3168</a>
+<a name='L3169'></a><a href='#L3169'>3169</a>
+<a name='L3170'></a><a href='#L3170'>3170</a>
+<a name='L3171'></a><a href='#L3171'>3171</a>
+<a name='L3172'></a><a href='#L3172'>3172</a>
+<a name='L3173'></a><a href='#L3173'>3173</a>
+<a name='L3174'></a><a href='#L3174'>3174</a>
+<a name='L3175'></a><a href='#L3175'>3175</a>
+<a name='L3176'></a><a href='#L3176'>3176</a>
+<a name='L3177'></a><a href='#L3177'>3177</a>
+<a name='L3178'></a><a href='#L3178'>3178</a>
+<a name='L3179'></a><a href='#L3179'>3179</a>
+<a name='L3180'></a><a href='#L3180'>3180</a>
+<a name='L3181'></a><a href='#L3181'>3181</a>
+<a name='L3182'></a><a href='#L3182'>3182</a>
+<a name='L3183'></a><a href='#L3183'>3183</a>
+<a name='L3184'></a><a href='#L3184'>3184</a>
+<a name='L3185'></a><a href='#L3185'>3185</a>
+<a name='L3186'></a><a href='#L3186'>3186</a>
+<a name='L3187'></a><a href='#L3187'>3187</a>
+<a name='L3188'></a><a href='#L3188'>3188</a>
+<a name='L3189'></a><a href='#L3189'>3189</a>
+<a name='L3190'></a><a href='#L3190'>3190</a>
+<a name='L3191'></a><a href='#L3191'>3191</a>
+<a name='L3192'></a><a href='#L3192'>3192</a>
+<a name='L3193'></a><a href='#L3193'>3193</a>
+<a name='L3194'></a><a href='#L3194'>3194</a>
+<a name='L3195'></a><a href='#L3195'>3195</a>
+<a name='L3196'></a><a href='#L3196'>3196</a>
+<a name='L3197'></a><a href='#L3197'>3197</a>
+<a name='L3198'></a><a href='#L3198'>3198</a>
+<a name='L3199'></a><a href='#L3199'>3199</a>
+<a name='L3200'></a><a href='#L3200'>3200</a>
+<a name='L3201'></a><a href='#L3201'>3201</a>
+<a name='L3202'></a><a href='#L3202'>3202</a>
+<a name='L3203'></a><a href='#L3203'>3203</a>
+<a name='L3204'></a><a href='#L3204'>3204</a>
+<a name='L3205'></a><a href='#L3205'>3205</a>
+<a name='L3206'></a><a href='#L3206'>3206</a>
+<a name='L3207'></a><a href='#L3207'>3207</a>
+<a name='L3208'></a><a href='#L3208'>3208</a>
+<a name='L3209'></a><a href='#L3209'>3209</a>
+<a name='L3210'></a><a href='#L3210'>3210</a>
+<a name='L3211'></a><a href='#L3211'>3211</a>
+<a name='L3212'></a><a href='#L3212'>3212</a>
+<a name='L3213'></a><a href='#L3213'>3213</a>
+<a name='L3214'></a><a href='#L3214'>3214</a>
+<a name='L3215'></a><a href='#L3215'>3215</a>
+<a name='L3216'></a><a href='#L3216'>3216</a>
+<a name='L3217'></a><a href='#L3217'>3217</a>
+<a name='L3218'></a><a href='#L3218'>3218</a>
+<a name='L3219'></a><a href='#L3219'>3219</a>
+<a name='L3220'></a><a href='#L3220'>3220</a>
+<a name='L3221'></a><a href='#L3221'>3221</a>
+<a name='L3222'></a><a href='#L3222'>3222</a>
+<a name='L3223'></a><a href='#L3223'>3223</a>
+<a name='L3224'></a><a href='#L3224'>3224</a>
+<a name='L3225'></a><a href='#L3225'>3225</a>
+<a name='L3226'></a><a href='#L3226'>3226</a>
+<a name='L3227'></a><a href='#L3227'>3227</a>
+<a name='L3228'></a><a href='#L3228'>3228</a>
+<a name='L3229'></a><a href='#L3229'>3229</a>
+<a name='L3230'></a><a href='#L3230'>3230</a>
+<a name='L3231'></a><a href='#L3231'>3231</a>
+<a name='L3232'></a><a href='#L3232'>3232</a>
+<a name='L3233'></a><a href='#L3233'>3233</a>
+<a name='L3234'></a><a href='#L3234'>3234</a>
+<a name='L3235'></a><a href='#L3235'>3235</a>
+<a name='L3236'></a><a href='#L3236'>3236</a>
+<a name='L3237'></a><a href='#L3237'>3237</a>
+<a name='L3238'></a><a href='#L3238'>3238</a>
+<a name='L3239'></a><a href='#L3239'>3239</a>
+<a name='L3240'></a><a href='#L3240'>3240</a>
+<a name='L3241'></a><a href='#L3241'>3241</a>
+<a name='L3242'></a><a href='#L3242'>3242</a>
+<a name='L3243'></a><a href='#L3243'>3243</a>
+<a name='L3244'></a><a href='#L3244'>3244</a>
+<a name='L3245'></a><a href='#L3245'>3245</a>
+<a name='L3246'></a><a href='#L3246'>3246</a>
+<a name='L3247'></a><a href='#L3247'>3247</a>
+<a name='L3248'></a><a href='#L3248'>3248</a>
+<a name='L3249'></a><a href='#L3249'>3249</a>
+<a name='L3250'></a><a href='#L3250'>3250</a>
+<a name='L3251'></a><a href='#L3251'>3251</a>
+<a name='L3252'></a><a href='#L3252'>3252</a>
+<a name='L3253'></a><a href='#L3253'>3253</a>
+<a name='L3254'></a><a href='#L3254'>3254</a>
+<a name='L3255'></a><a href='#L3255'>3255</a>
+<a name='L3256'></a><a href='#L3256'>3256</a>
+<a name='L3257'></a><a href='#L3257'>3257</a>
+<a name='L3258'></a><a href='#L3258'>3258</a>
+<a name='L3259'></a><a href='#L3259'>3259</a>
+<a name='L3260'></a><a href='#L3260'>3260</a>
+<a name='L3261'></a><a href='#L3261'>3261</a>
+<a name='L3262'></a><a href='#L3262'>3262</a>
+<a name='L3263'></a><a href='#L3263'>3263</a>
+<a name='L3264'></a><a href='#L3264'>3264</a>
+<a name='L3265'></a><a href='#L3265'>3265</a>
+<a name='L3266'></a><a href='#L3266'>3266</a>
+<a name='L3267'></a><a href='#L3267'>3267</a>
+<a name='L3268'></a><a href='#L3268'>3268</a>
+<a name='L3269'></a><a href='#L3269'>3269</a>
+<a name='L3270'></a><a href='#L3270'>3270</a>
+<a name='L3271'></a><a href='#L3271'>3271</a>
+<a name='L3272'></a><a href='#L3272'>3272</a>
+<a name='L3273'></a><a href='#L3273'>3273</a>
+<a name='L3274'></a><a href='#L3274'>3274</a>
+<a name='L3275'></a><a href='#L3275'>3275</a>
+<a name='L3276'></a><a href='#L3276'>3276</a>
+<a name='L3277'></a><a href='#L3277'>3277</a>
+<a name='L3278'></a><a href='#L3278'>3278</a>
+<a name='L3279'></a><a href='#L3279'>3279</a>
+<a name='L3280'></a><a href='#L3280'>3280</a>
+<a name='L3281'></a><a href='#L3281'>3281</a>
+<a name='L3282'></a><a href='#L3282'>3282</a>
+<a name='L3283'></a><a href='#L3283'>3283</a>
+<a name='L3284'></a><a href='#L3284'>3284</a>
+<a name='L3285'></a><a href='#L3285'>3285</a>
+<a name='L3286'></a><a href='#L3286'>3286</a>
+<a name='L3287'></a><a href='#L3287'>3287</a>
+<a name='L3288'></a><a href='#L3288'>3288</a>
+<a name='L3289'></a><a href='#L3289'>3289</a>
+<a name='L3290'></a><a href='#L3290'>3290</a>
+<a name='L3291'></a><a href='#L3291'>3291</a>
+<a name='L3292'></a><a href='#L3292'>3292</a>
+<a name='L3293'></a><a href='#L3293'>3293</a>
+<a name='L3294'></a><a href='#L3294'>3294</a>
+<a name='L3295'></a><a href='#L3295'>3295</a>
+<a name='L3296'></a><a href='#L3296'>3296</a>
+<a name='L3297'></a><a href='#L3297'>3297</a>
+<a name='L3298'></a><a href='#L3298'>3298</a>
+<a name='L3299'></a><a href='#L3299'>3299</a>
+<a name='L3300'></a><a href='#L3300'>3300</a>
+<a name='L3301'></a><a href='#L3301'>3301</a>
+<a name='L3302'></a><a href='#L3302'>3302</a>
+<a name='L3303'></a><a href='#L3303'>3303</a>
+<a name='L3304'></a><a href='#L3304'>3304</a>
+<a name='L3305'></a><a href='#L3305'>3305</a>
+<a name='L3306'></a><a href='#L3306'>3306</a>
+<a name='L3307'></a><a href='#L3307'>3307</a>
+<a name='L3308'></a><a href='#L3308'>3308</a>
+<a name='L3309'></a><a href='#L3309'>3309</a>
+<a name='L3310'></a><a href='#L3310'>3310</a>
+<a name='L3311'></a><a href='#L3311'>3311</a>
+<a name='L3312'></a><a href='#L3312'>3312</a>
+<a name='L3313'></a><a href='#L3313'>3313</a>
+<a name='L3314'></a><a href='#L3314'>3314</a>
+<a name='L3315'></a><a href='#L3315'>3315</a>
+<a name='L3316'></a><a href='#L3316'>3316</a>
+<a name='L3317'></a><a href='#L3317'>3317</a>
+<a name='L3318'></a><a href='#L3318'>3318</a>
+<a name='L3319'></a><a href='#L3319'>3319</a>
+<a name='L3320'></a><a href='#L3320'>3320</a>
+<a name='L3321'></a><a href='#L3321'>3321</a>
+<a name='L3322'></a><a href='#L3322'>3322</a>
+<a name='L3323'></a><a href='#L3323'>3323</a>
+<a name='L3324'></a><a href='#L3324'>3324</a>
+<a name='L3325'></a><a href='#L3325'>3325</a>
+<a name='L3326'></a><a href='#L3326'>3326</a>
+<a name='L3327'></a><a href='#L3327'>3327</a>
+<a name='L3328'></a><a href='#L3328'>3328</a>
+<a name='L3329'></a><a href='#L3329'>3329</a>
+<a name='L3330'></a><a href='#L3330'>3330</a>
+<a name='L3331'></a><a href='#L3331'>3331</a>
+<a name='L3332'></a><a href='#L3332'>3332</a>
+<a name='L3333'></a><a href='#L3333'>3333</a>
+<a name='L3334'></a><a href='#L3334'>3334</a>
+<a name='L3335'></a><a href='#L3335'>3335</a>
+<a name='L3336'></a><a href='#L3336'>3336</a>
+<a name='L3337'></a><a href='#L3337'>3337</a>
+<a name='L3338'></a><a href='#L3338'>3338</a>
+<a name='L3339'></a><a href='#L3339'>3339</a>
+<a name='L3340'></a><a href='#L3340'>3340</a>
+<a name='L3341'></a><a href='#L3341'>3341</a>
+<a name='L3342'></a><a href='#L3342'>3342</a>
+<a name='L3343'></a><a href='#L3343'>3343</a>
+<a name='L3344'></a><a href='#L3344'>3344</a>
+<a name='L3345'></a><a href='#L3345'>3345</a>
+<a name='L3346'></a><a href='#L3346'>3346</a>
+<a name='L3347'></a><a href='#L3347'>3347</a>
+<a name='L3348'></a><a href='#L3348'>3348</a>
+<a name='L3349'></a><a href='#L3349'>3349</a>
+<a name='L3350'></a><a href='#L3350'>3350</a>
+<a name='L3351'></a><a href='#L3351'>3351</a>
+<a name='L3352'></a><a href='#L3352'>3352</a>
+<a name='L3353'></a><a href='#L3353'>3353</a>
+<a name='L3354'></a><a href='#L3354'>3354</a>
+<a name='L3355'></a><a href='#L3355'>3355</a>
+<a name='L3356'></a><a href='#L3356'>3356</a>
+<a name='L3357'></a><a href='#L3357'>3357</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type {
+  ControllerGetStateAction,
+  ControllerStateChangeEvent,
+} from '@metamask/base-controller';
+<span class="cstat-no" title="statement not covered" >import { BaseController } from '@metamask/base-controller';</span>
+import type { Partialize } from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import {</span>
+  InfuraNetworkType,
+  CustomNetworkType,
+  NetworkType,
+  isSafeChainId,
+  isInfuraNetworkType,
+  ChainId,
+  NetworksTicker,
+  NetworkNickname,
+  BUILT_IN_CUSTOM_NETWORKS_RPC,
+  BUILT_IN_NETWORKS,
+  BuiltInNetworkName,
+} from '@metamask/controller-utils';
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+<span class="cstat-no" title="statement not covered" >import EthQuery from '@metamask/eth-query';</span>
+import type { Messenger } from '@metamask/messenger';
+<span class="cstat-no" title="statement not covered" >import { errorCodes } from '@metamask/rpc-errors';</span>
+<span class="cstat-no" title="statement not covered" >import {</span>
+  createEventEmitterProxy,
+  createSwappableProxy,
+} from '@metamask/swappable-obj-proxy';
+import type { SwappableProxy } from '@metamask/swappable-obj-proxy';
+import type { Hex } from '@metamask/utils';
+<span class="cstat-no" title="statement not covered" >import { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';</span>
+<span class="cstat-no" title="statement not covered" >import deepEqual from 'fast-deep-equal';</span>
+import type { Draft } from 'immer';
+<span class="cstat-no" title="statement not covered" >import { produce } from 'immer';</span>
+<span class="cstat-no" title="statement not covered" >import { cloneDeep } from 'lodash';</span>
+import type { Logger } from 'loglevel';
+<span class="cstat-no" title="statement not covered" >import { createSelector } from 'reselect';</span>
+<span class="cstat-no" title="statement not covered" >import * as URI from 'uri-js';</span>
+<span class="cstat-no" title="statement not covered" >import { v4 as uuidV4 } from 'uuid';</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >import {</span>
+  DEPRECATED_NETWORKS,
+  INFURA_BLOCKED_KEY,
+  NetworkStatus,
+} from './constants';
+import type {
+  AutoManagedNetworkClient,
+  ProxyWithAccessibleTarget,
+} from './create-auto-managed-network-client';
+<span class="cstat-no" title="statement not covered" >import { createAutoManagedNetworkClient } from './create-auto-managed-network-client';</span>
+<span class="cstat-no" title="statement not covered" >import { projectLogger, createModuleLogger } from './logger';</span>
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+<span class="cstat-no" title="statement not covered" >import { NetworkClientType } from './types';</span>
+import type {
+  BlockTracker,
+  Provider,
+  CustomNetworkClientConfiguration,
+  InfuraNetworkClientConfiguration,
+  NetworkClientConfiguration,
+  AdditionalDefaultNetwork,
+} from './types';
+&nbsp;
+const debugLog = <span class="cstat-no" title="statement not covered" >createModuleLogger(projectLogger, 'NetworkController');</span>
+&nbsp;
+const INFURA_URL_REGEX =
+<span class="cstat-no" title="statement not covered" >  /^https:\/\/(?&lt;networkName&gt;[^.]+)\.infura\.io\/v\d+\/(?&lt;apiKey&gt;.+)$/u;</span>
+&nbsp;
+export type Block = {
+  baseFeePerGas?: string;
+};
+&nbsp;
+/**
+ * Information about a network not held by any other part of state.
+ */
+export type NetworkMetadata = {
+  /**
+   * EIPs supported by the network.
+   */
+  // eslint-disable-next-line @typescript-eslint/naming-convention
+  EIPS: {
+    [eipNumber: number]: boolean;
+  };
+  /**
+   * Indicates the availability of the network
+   */
+  status: NetworkStatus;
+};
+&nbsp;
+/**
+ * The type of an RPC endpoint.
+ *
+ * @see {@link CustomRpcEndpoint}
+ * @see {@link InfuraRpcEndpoint}
+ */
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export enum R</span>pcEndpointType {</span>
+<span class="cstat-no" title="statement not covered" >  Custom = 'custom',</span>
+<span class="cstat-no" title="statement not covered" >  Infura = 'infura',</span>
+}
+&nbsp;
+/**
+ * An Infura RPC endpoint is a reference to a specific network that Infura
+ * supports as well as an Infura account we own that we allow users to make use
+ * of for free. We need to disambiguate these endpoints from custom RPC
+ * endpoints, because while the types for these kinds of object both have the
+ * same interface, the URL for an Infura endpoint contains the Infura project
+ * ID, and we don't want this to be present in state. We therefore hide it by
+ * representing it in the URL as `{infuraProjectId}`, which we replace this when
+ * create network clients. But we need to know somehow that we only need to do
+ * this replacement for Infura endpoints and not custom endpoints â€” hence the
+ * separate type.
+ */
+export type InfuraRpcEndpoint = {
+  /**
+   * Alternate RPC endpoints to use when this endpoint is down.
+   */
+  failoverUrls?: string[];
+  /**
+   * The optional user-facing nickname of the endpoint.
+   */
+  name?: string;
+  /**
+   * The identifier for the network client that has been created for this RPC
+   * endpoint. This is also used to uniquely identify the RPC endpoint in a
+   * set of RPC endpoints as well: once assigned, it is used to determine
+   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.
+   */
+  networkClientId: BuiltInNetworkClientId;
+  /**
+   * The type of this endpoint, always "default".
+   */
+  type: RpcEndpointType.Infura;
+  /**
+   * The URL of the endpoint. Expected to be a template with the string
+   * `{infuraProjectId}`, which will get replaced with the Infura project ID
+   * when the network client is created.
+   */
+  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;
+};
+&nbsp;
+/**
+ * A custom RPC endpoint is a reference to a user-defined server which fronts an
+ * EVM chain. It may refer to an Infura network, but only by coincidence.
+ */
+export type CustomRpcEndpoint = {
+  /**
+   * Alternate RPC endpoints to use when this endpoint is down.
+   */
+  failoverUrls?: string[];
+  /**
+   * The optional user-facing nickname of the endpoint.
+   */
+  name?: string;
+  /**
+   * The identifier for the network client that has been created for this RPC
+   * endpoint. This is also used to uniquely identify the RPC endpoint in a
+   * set of RPC endpoints as well: once assigned, it is used to determine
+   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.
+   */
+  networkClientId: CustomNetworkClientId;
+  /**
+   * The type of this endpoint, always "custom".
+   */
+  type: RpcEndpointType.Custom;
+  /**
+   * The URL of the endpoint.
+   */
+  url: string;
+};
+&nbsp;
+/**
+ * An RPC endpoint is a reference to a server which fronts an EVM chain. There
+ * are two varieties of RPC endpoints: Infura and custom.
+ *
+ * @see {@link CustomRpcEndpoint}
+ * @see {@link InfuraRpcEndpoint}
+ */
+export type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;
+&nbsp;
+/**
+ * From a user perspective, a network configuration holds information about a
+ * network that a user can select through the client. A "network" in this sense
+ * can explicitly refer to an EVM chain that the user explicitly adds or doesn't
+ * need to add (because it comes shipped with the client). The properties here
+ * therefore directly map to fields that a user sees and can edit for a network
+ * within the client.
+ *
+ * Internally, a network configuration represents a single conceptual EVM chain,
+ * which is represented tangibly via multiple RPC endpoints. A "network" is then
+ * something for which a network client object is created automatically or
+ * created on demand when it is added to the client.
+ */
+export type NetworkConfiguration = {
+  /**
+   * A set of URLs that allows the user to view activity that has occurred on
+   * the chain.
+   */
+  blockExplorerUrls: string[];
+  /**
+   * The ID of the chain. Represented in hexadecimal format with a leading "0x"
+   * instead of decimal format so that when viewed out of context it can be
+   * unambiguously interpreted.
+   */
+  chainId: Hex;
+  /**
+   * A reference to a URL that the client will use by default to allow the user
+   * to view activity that has occurred on the chain. This index must refer to
+   * an item in `blockExplorerUrls`.
+   */
+  defaultBlockExplorerUrlIndex?: number;
+  /**
+   * A reference to an RPC endpoint that all requests will use by default in order to
+   * interact with the chain. This index must refer to an item in
+   * `rpcEndpoints`.
+   */
+  defaultRpcEndpointIndex: number;
+  /**
+   * The user-facing nickname assigned to the chain.
+   */
+  name: string;
+  /**
+   * The name of the currency to use for the chain.
+   */
+  nativeCurrency: string;
+  /**
+   * The collection of possible RPC endpoints that the client can use to
+   * interact with the chain.
+   */
+  rpcEndpoints: RpcEndpoint[];
+  /**
+   * Profile Sync - Network Sync field.
+   * Allows comparison of local network state with state to sync.
+   */
+  lastUpdatedAt?: number;
+};
+&nbsp;
+/**
+ * A custom RPC endpoint in a new network configuration, meant to be used in
+ * conjunction with `AddNetworkFields`.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and therefore network clients
+ * do not exist for them yet (and hence IDs need to be generated).
+ */
+export type AddNetworkCustomRpcEndpointFields = Omit&lt;
+  CustomRpcEndpoint,
+  'networkClientId'
+&gt;;
+&nbsp;
+/**
+ * A new network configuration that `addNetwork` takes.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and are not represented by
+ * network clients yet.
+ */
+export type AddNetworkFields = Omit&lt;NetworkConfiguration, 'rpcEndpoints'&gt; &amp; {
+  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];
+};
+&nbsp;
+/**
+ * A custom RPC endpoint in an updated representation of a network
+ * configuration, meant to be used in conjunction with `UpdateNetworkFields`.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and therefore network clients
+ * do not exist for them yet (and hence IDs need to be generated).
+ */
+export type UpdateNetworkCustomRpcEndpointFields = Partialize&lt;
+  CustomRpcEndpoint,
+  'networkClientId'
+&gt;;
+&nbsp;
+/**
+ * An updated representation of an existing network configuration that
+ * `updateNetwork` takes.
+ *
+ * Custom RPC endpoints may or may not have a `networkClientId` property; if
+ * they do, then it is assumed that they already exist, and if not, then it is
+ * assumed that they are new and are not represented by network clients yet.
+ */
+export type UpdateNetworkFields = Omit&lt;NetworkConfiguration, 'rpcEndpoints'&gt; &amp; {
+  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];
+};
+&nbsp;
+/**
+ * `Object.keys()` is intentionally generic: it returns the keys of an object,
+ * but it cannot make guarantees about the contents of that object, so the type
+ * of the keys is merely `string[]`. While this is technically accurate, it is
+ * also unnecessary if we have an object that we own and whose contents are
+ * known exactly.
+ *
+ * TODO: Move to @metamask/utils.
+ *
+ * @param object - The object.
+ * @returns The keys of an object, typed according to the type of the object
+ * itself.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >k</span>nownKeysOf&lt;</span>Key extends PropertyKey&gt;(
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  object: Partial&lt;Record&lt;Key, any&gt;&gt;,
+): Key[] {
+<span class="cstat-no" title="statement not covered" >  return Object.keys(object) as Key[];</span>
+}
+&nbsp;
+/**
+ * Type guard for determining whether the given value is an error object with a
+ * `code` property, such as an instance of Error.
+ *
+ * TODO: Move this to @metamask/utils.
+ *
+ * @param error - The object to check.
+ * @returns True if `error` has a `code`, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isErrorWithCode(</span>error: unknown): error is { code: string | number } {
+<span class="cstat-no" title="statement not covered" >  return typeof error === 'object' &amp;&amp; error !== null &amp;&amp; 'code' in error;</span>
+}
+&nbsp;
+/**
+ * The string that uniquely identifies an Infura network client.
+ */
+export type BuiltInNetworkClientId = InfuraNetworkType;
+&nbsp;
+/**
+ * The string that uniquely identifies a custom network client.
+ */
+export type CustomNetworkClientId = string;
+&nbsp;
+/**
+ * The string that uniquely identifies a network client.
+ */
+export type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;
+&nbsp;
+/**
+ * Extra information about each network, such as whether it is accessible or
+ * blocked and whether it supports EIP-1559, keyed by network client ID.
+ */
+export type NetworksMetadata = Record&lt;NetworkClientId, NetworkMetadata&gt;;
+&nbsp;
+/**
+ * The state that NetworkController stores.
+ */
+export type NetworkState = {
+  /**
+   * The ID of the network client that the proxies returned by
+   * `getSelectedNetworkClient` currently point to.
+   */
+  selectedNetworkClientId: NetworkClientId;
+  /**
+   * The registry of networks and corresponding RPC endpoints that the
+   * controller can use to make requests for various chains.
+   *
+   * @see {@link NetworkConfiguration}
+   */
+  networkConfigurationsByChainId: Record&lt;Hex, NetworkConfiguration&gt;;
+  /**
+   * Extra information about each network, such as whether it is accessible or
+   * blocked and whether it supports EIP-1559, keyed by network client ID.
+   */
+  networksMetadata: NetworksMetadata;
+};
+&nbsp;
+const controllerName = <span class="cstat-no" title="statement not covered" >'NetworkController';</span>
+&nbsp;
+/**
+ * Represents the block tracker for the currently selected network. (Note that
+ * this is a proxy around a proxy: the inner one exists so that the block
+ * tracker doesn't have to exist until it's used, and the outer one exists so
+ * that the currently selected network can change without consumers needing to
+ * refresh the object reference to that network.)
+ */
+export type BlockTrackerProxy = SwappableProxy&lt;
+  ProxyWithAccessibleTarget&lt;BlockTracker&gt;
+&gt;;
+&nbsp;
+/**
+ * Represents the provider for the currently selected network. (Note that this
+ * is a proxy around a proxy: the inner one exists so that the provider doesn't
+ * have to exist until it's used, and the outer one exists so that the currently
+ * selected network can change without consumers needing to refresh the object
+ * reference to that network.)
+ */
+export type ProviderProxy = SwappableProxy&lt;ProxyWithAccessibleTarget&lt;Provider&gt;&gt;;
+&nbsp;
+export type NetworkControllerStateChangeEvent = ControllerStateChangeEvent&lt;
+  typeof controllerName,
+  NetworkState
+&gt;;
+&nbsp;
+/**
+ * `networkWillChange` is published when the current network is about to be
+ * switched, but the new provider has not been created and no state changes have
+ * occurred yet.
+ */
+export type NetworkControllerNetworkWillChangeEvent = {
+  type: 'NetworkController:networkWillChange';
+  payload: [NetworkState];
+};
+&nbsp;
+/**
+ * `networkDidChange` is published after a provider has been created for a newly
+ * switched network (but before the network has been confirmed to be available).
+ */
+export type NetworkControllerNetworkDidChangeEvent = {
+  type: 'NetworkController:networkDidChange';
+  payload: [NetworkState];
+};
+&nbsp;
+/**
+ * `infuraIsBlocked` is published after the network is switched to an Infura
+ * network, but when Infura returns an error blocking the user based on their
+ * location.
+ */
+export type NetworkControllerInfuraIsBlockedEvent = {
+  type: 'NetworkController:infuraIsBlocked';
+  payload: [];
+};
+&nbsp;
+/**
+ * `infuraIsBlocked` is published either after the network is switched to an
+ * Infura network and Infura does not return an error blocking the user based on
+ * their location, or the network is switched to a non-Infura network.
+ */
+export type NetworkControllerInfuraIsUnblockedEvent = {
+  type: 'NetworkController:infuraIsUnblocked';
+  payload: [];
+};
+&nbsp;
+/**
+ * `networkAdded` is published after a network configuration is added to the
+ * network configuration registry and network clients are created for it.
+ */
+export type NetworkControllerNetworkAddedEvent = {
+  type: 'NetworkController:networkAdded';
+  payload: [networkConfiguration: NetworkConfiguration];
+};
+&nbsp;
+/**
+ * `networkRemoved` is published after a network configuration is removed from the
+ * network configuration registry and once the network clients have been removed.
+ */
+export type NetworkControllerNetworkRemovedEvent = {
+  type: 'NetworkController:networkRemoved';
+  payload: [networkConfiguration: NetworkConfiguration];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointChainUnavailable` is published when, after
+ * trying all endpoints in an endpoint chain, the last failover reaches a
+ * maximum number of consecutive 5xx responses, breaking the underlying circuit.
+ *
+ * In other words, this event will not be published if a failover is available,
+ * even if the primary is not.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.error - The last error produced by the last failover in the
+ * endpoint chain.
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainUnavailableEvent = {
+  type: 'NetworkController:rpcEndpointChainUnavailable';
+  payload: [
+    {
+      chainId: Hex;
+      error: unknown;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointUnavailable` is published when any
+ * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx
+ * responses, breaking the underlying circuit.
+ *
+ * In other words, this event will be published if a primary is not available,
+ * even if a failover is.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint which reached the
+ * maximum number of consecutive 5xx responses. You can compare this to
+ * `primaryEndpointUrl` to know whether it was a failover or a primary.
+ * @param payload.error - The last error produced by the endpoint.
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ */
+export type NetworkControllerRpcEndpointUnavailableEvent = {
+  type: 'NetworkController:rpcEndpointUnavailable';
+  payload: [
+    {
+      chainId: Hex;
+      endpointUrl: string;
+      error: unknown;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointChainDegraded` is published for any of the
+ * endpoints in an endpoint chain when one of the following two conditions hold
+ * (and the chain is not already in a degraded state):
+ *
+ * 1. A successful (2xx) request, even after being retried, cannot be made to
+ * the endpoint.
+ * 2. A successful (2xx) request can be made to the endpoint, but it takes
+ * longer than expected to complete.
+ *
+ * Note that this event will be published even if there are local connectivity
+ * issues which prevent requests from being initiated. This is intentional.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.error - The last error produced by the endpoint (or
+ * `undefined` if the request was slow).
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainDegradedEvent = {
+  type: 'NetworkController:rpcEndpointChainDegraded';
+  payload: [
+    {
+      chainId: Hex;
+      error: unknown;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+&nbsp;
+/**
+ *
+ * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints
+ * in an endpoint chain when:
+ *
+ * 1. A successful (2xx) request, even after being retried, cannot be made to
+ * the endpoint.
+ * 2. A successful (2xx) request can be made to the endpoint, but it takes
+ * longer than expected to complete.
+ *
+ * Note that this event will be published even if there are local connectivity
+ * issues which prevent requests from being initiated. This is intentional.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint for which requests
+ * failed or were slow to complete. You can compare this to `primaryEndpointUrl`
+ * to know whether it was a failover or a primary.
+ * @param payload.error - The last error produced by the endpoint (or
+ * `undefined` if the request was slow).
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ */
+export type NetworkControllerRpcEndpointDegradedEvent = {
+  type: 'NetworkController:rpcEndpointDegraded';
+  payload: [
+    {
+      chainId: Hex;
+      endpointUrl: string;
+      error: unknown;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointChainAvailable` is published in one of two
+ * cases:
+ *
+ * 1. The first time that a 2xx request is made to any of the endpoints in an
+ * endpoint chain.
+ * 2. When requests to any of the endpoints previously failed (placing the
+ * endpoint in a degraded or unavailable status), but are now succeeding again.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainAvailableEvent = {
+  type: 'NetworkController:rpcEndpointChainAvailable';
+  payload: [
+    {
+      chainId: Hex;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+&nbsp;
+/**
+ * `NetworkController:rpcEndpointRetried` is published before a request to any
+ * endpoint in an endpoint chain is retried.
+ *
+ * This is mainly useful for tests.
+ *
+ * @param payload - The event payload.
+ * @param payload.attempt - The current attempt counter for the endpoint
+ * (starting from 0).
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint being retried.
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ * @see {@link RpcService} for the list of retriable errors.
+ */
+export type NetworkControllerRpcEndpointRetriedEvent = {
+  type: 'NetworkController:rpcEndpointRetried';
+  payload: [
+    {
+      attempt: number;
+      chainId: Hex;
+      endpointUrl: string;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+&nbsp;
+export type NetworkControllerEvents =
+  | NetworkControllerStateChangeEvent
+  | NetworkControllerNetworkWillChangeEvent
+  | NetworkControllerNetworkDidChangeEvent
+  | NetworkControllerInfuraIsBlockedEvent
+  | NetworkControllerInfuraIsUnblockedEvent
+  | NetworkControllerNetworkAddedEvent
+  | NetworkControllerNetworkRemovedEvent
+  | NetworkControllerRpcEndpointChainUnavailableEvent
+  | NetworkControllerRpcEndpointUnavailableEvent
+  | NetworkControllerRpcEndpointChainDegradedEvent
+  | NetworkControllerRpcEndpointDegradedEvent
+  | NetworkControllerRpcEndpointChainAvailableEvent
+  | NetworkControllerRpcEndpointRetriedEvent;
+&nbsp;
+/**
+ * All events that {@link NetworkController} calls internally.
+ */
+type AllowedEvents = never;
+&nbsp;
+export type NetworkControllerGetStateAction = ControllerGetStateAction&lt;
+  typeof controllerName,
+  NetworkState
+&gt;;
+&nbsp;
+export type NetworkControllerGetEthQueryAction = {
+  type: `NetworkController:getEthQuery`;
+  handler: () =&gt; EthQuery | undefined;
+};
+&nbsp;
+export type NetworkControllerGetNetworkClientByIdAction = {
+  type: `NetworkController:getNetworkClientById`;
+  handler: NetworkController['getNetworkClientById'];
+};
+&nbsp;
+export type NetworkControllerGetSelectedNetworkClientAction = {
+  type: `NetworkController:getSelectedNetworkClient`;
+  handler: NetworkController['getSelectedNetworkClient'];
+};
+&nbsp;
+export type NetworkControllerGetSelectedChainIdAction = {
+  type: 'NetworkController:getSelectedChainId';
+  handler: NetworkController['getSelectedChainId'];
+};
+&nbsp;
+export type NetworkControllerGetEIP1559CompatibilityAction = {
+  type: `NetworkController:getEIP1559Compatibility`;
+  handler: NetworkController['getEIP1559Compatibility'];
+};
+&nbsp;
+export type NetworkControllerFindNetworkClientIdByChainIdAction = {
+  type: `NetworkController:findNetworkClientIdByChainId`;
+  handler: NetworkController['findNetworkClientIdByChainId'];
+};
+&nbsp;
+/**
+ * Change the currently selected network to the given built-in network type.
+ *
+ * @deprecated This action has been replaced by `setActiveNetwork`, and will be
+ * removed in a future release.
+ */
+export type NetworkControllerSetProviderTypeAction = {
+  type: `NetworkController:setProviderType`;
+  handler: NetworkController['setProviderType'];
+};
+&nbsp;
+export type NetworkControllerSetActiveNetworkAction = {
+  type: `NetworkController:setActiveNetwork`;
+  handler: NetworkController['setActiveNetwork'];
+};
+&nbsp;
+export type NetworkControllerGetNetworkConfigurationByChainId = {
+  type: `NetworkController:getNetworkConfigurationByChainId`;
+  handler: NetworkController['getNetworkConfigurationByChainId'];
+};
+&nbsp;
+export type NetworkControllerGetNetworkConfigurationByNetworkClientId = {
+  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;
+  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];
+};
+&nbsp;
+export type NetworkControllerAddNetworkAction = {
+  type: 'NetworkController:addNetwork';
+  handler: NetworkController['addNetwork'];
+};
+&nbsp;
+export type NetworkControllerRemoveNetworkAction = {
+  type: 'NetworkController:removeNetwork';
+  handler: NetworkController['removeNetwork'];
+};
+&nbsp;
+export type NetworkControllerUpdateNetworkAction = {
+  type: 'NetworkController:updateNetwork';
+  handler: NetworkController['updateNetwork'];
+};
+&nbsp;
+export type NetworkControllerActions =
+  | NetworkControllerGetStateAction
+  | NetworkControllerGetEthQueryAction
+  | NetworkControllerGetNetworkClientByIdAction
+  | NetworkControllerGetSelectedNetworkClientAction
+  | NetworkControllerGetSelectedChainIdAction
+  | NetworkControllerGetEIP1559CompatibilityAction
+  | NetworkControllerFindNetworkClientIdByChainIdAction
+  | NetworkControllerSetActiveNetworkAction
+  | NetworkControllerSetProviderTypeAction
+  | NetworkControllerGetNetworkConfigurationByChainId
+  | NetworkControllerGetNetworkConfigurationByNetworkClientId
+  | NetworkControllerAddNetworkAction
+  | NetworkControllerRemoveNetworkAction
+  | NetworkControllerUpdateNetworkAction;
+&nbsp;
+/**
+ * All actions that {@link NetworkController} calls internally.
+ */
+type AllowedActions = never;
+&nbsp;
+export type NetworkControllerMessenger = Messenger&lt;
+  typeof controllerName,
+  NetworkControllerActions | AllowedActions,
+  NetworkControllerEvents | AllowedEvents
+&gt;;
+&nbsp;
+/**
+ * Options for the NetworkController constructor.
+ */
+export type NetworkControllerOptions = {
+  /**
+   * The messenger suited for this controller.
+   */
+  messenger: NetworkControllerMessenger;
+  /**
+   * The API key for Infura, used to make requests to Infura.
+   */
+  infuraProjectId: string;
+  /**
+   * The desired state with which to initialize this controller.
+   * Missing properties will be filled in with defaults. For instance, if not
+   * specified, `networkConfigurationsByChainId` will default to a basic set of
+   * network configurations (see {@link InfuraNetworkType} for the list).
+   */
+  state?: Partial&lt;NetworkState&gt;;
+  /**
+   * A `loglevel` logger object.
+   */
+  log?: Logger;
+  /**
+   * A function that can be used to customize a RPC service constructed for an
+   * RPC endpoint. The function takes the URL of the endpoint and should return
+   * an object with type {@link RpcServiceOptions}, minus `failoverService`
+   * and `endpointUrl` (as they are filled in automatically).
+   */
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  /**
+   * A function that can be used to customize a block tracker constructed for an
+   * RPC endpoint. The function takes the URL of the endpoint and should return
+   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as
+   * it is filled in automatically).
+   */
+  getBlockTrackerOptions?: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  /**
+   * An array of Hex Chain IDs representing the additional networks to be included as default.
+   */
+  additionalDefaultNetworks?: AdditionalDefaultNetwork[];
+  /**
+   * Whether or not requests sent to unavailable RPC endpoints should be
+   * automatically diverted to configured failover RPC endpoints.
+   */
+  isRpcFailoverEnabled?: boolean;
+};
+&nbsp;
+/**
+ * Constructs a value for the state property `networkConfigurationsByChainId`
+ * which will be used if it has not been provided to the constructor.
+ *
+ * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.
+ * @returns The default value for `networkConfigurationsByChainId`.
+ */
+function <span class="fstat-no" title="function not covered" >getDefaultNetworkConfigurationsByChainId(</span>
+  additionalDefaultNetworks: AdditionalDefaultNetwork[] = <span class="branch-0 cbranch-no" title="branch not covered" >[],</span>
+): Record&lt;Hex, NetworkConfiguration&gt; {
+  const infuraNetworks = <span class="cstat-no" title="statement not covered" >getDefaultInfuraNetworkConfigurationsByChainId();</span>
+  const customNetworks = <span class="cstat-no" title="statement not covered" >getDefaultCustomNetworkConfigurationsByChainId();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return additionalDefaultNetworks.reduce&lt;Record&lt;Hex, NetworkConfiguration&gt;&gt;(</span>
+<span class="fstat-no" title="function not covered" >    (o</span>bj, chainId) =&gt; {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (hasProperty(customNetworks, chainId)) {</span>
+<span class="cstat-no" title="statement not covered" >        obj[chainId] = customNetworks[chainId];</span>
+      }
+<span class="cstat-no" title="statement not covered" >      return obj;</span>
+    },
+    // Always include the infura networks in the default networks
+    infuraNetworks,
+  );
+}
+&nbsp;
+/**
+ * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.
+ *
+ * @returns The `networkConfigurationsByChainId` object of all Infura networks.
+ */
+function <span class="fstat-no" title="function not covered" >getDefaultInfuraNetworkConfigurationsByChainId(</span>): Record&lt;
+  Hex,
+  NetworkConfiguration
+&gt; {
+<span class="cstat-no" title="statement not covered" >  return Object.values(InfuraNetworkType).reduce&lt;</span>
+    Record&lt;Hex, NetworkConfiguration&gt;
+  &gt;(<span class="fstat-no" title="function not covered" >(o</span>bj, infuraNetworkType) =&gt; {
+    const chainId = <span class="cstat-no" title="statement not covered" >ChainId[infuraNetworkType];</span>
+&nbsp;
+    // Skip deprecated network as default network.
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (DEPRECATED_NETWORKS.has(chainId)) {</span>
+<span class="cstat-no" title="statement not covered" >      return obj;</span>
+    }
+&nbsp;
+    const rpcEndpointUrl =
+<span class="cstat-no" title="statement not covered" >      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;</span>
+&nbsp;
+    const networkConfiguration: NetworkConfiguration = <span class="cstat-no" title="statement not covered" >{</span>
+      blockExplorerUrls: [],
+      chainId,
+      defaultRpcEndpointIndex: 0,
+      name: NetworkNickname[infuraNetworkType],
+      nativeCurrency: NetworksTicker[infuraNetworkType],
+      rpcEndpoints: [
+        {
+          failoverUrls: [],
+          networkClientId: infuraNetworkType,
+          type: RpcEndpointType.Infura,
+          url: rpcEndpointUrl,
+        },
+      ],
+    };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { ...obj, [chainId]: networkConfiguration };</span>
+  }, {});
+}
+&nbsp;
+/**
+ * Constructs a `networkConfigurationsByChainId` object for all default custom networks.
+ *
+ * @returns The `networkConfigurationsByChainId` object of all custom networks.
+ */
+function <span class="fstat-no" title="function not covered" >getDefaultCustomNetworkConfigurationsByChainId(</span>): Record&lt;
+  Hex,
+  NetworkConfiguration
+&gt; {
+  // Create the `networkConfigurationsByChainId` objects explicitly,
+  // Because it is not always guaranteed that the custom networks are included in the
+  // default networks.
+  const configs = <span class="cstat-no" title="statement not covered" >{</span>
+    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['megaeth-testnet'],
+    ),
+    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(
+      CustomNetworkType['megaeth-testnet-v2'],
+    ),
+    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['monad-testnet'],
+    ),
+    // New additions for 20+ network performance testing
+    [ChainId[BuiltInNetworkName.FantomMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['fantom-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.GnosisMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['gnosis-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.CeloMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['celo-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.CronosMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['cronos-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.Aurora]]: getCustomNetworkConfiguration(
+      CustomNetworkType.aurora,
+    ),
+    [ChainId[BuiltInNetworkName.MoonbeamMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['moonbeam-mainnet']),
+    [ChainId[BuiltInNetworkName.MoonriverMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['moonriver-mainnet']),
+    [ChainId[BuiltInNetworkName.KlaytnMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['klaytn-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.AvalancheMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['avalanche-mainnet']),
+    [ChainId[BuiltInNetworkName.ZkSyncEraMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['zksync-era-mainnet']),
+    [ChainId[BuiltInNetworkName.PalmMainnet]]: getCustomNetworkConfiguration(
+      CustomNetworkType['palm-mainnet'],
+    ),
+    [ChainId[BuiltInNetworkName.HyperEvmMainnet]]:
+      getCustomNetworkConfiguration(CustomNetworkType['hypervm-mainnet']),
+  };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  console.log(</span>
+    '[NetworkController] getDefaultCustomNetworkConfigurationsByChainId - returning',
+    Object.keys(configs).length,
+    'custom network configurations',
+  );
+<span class="cstat-no" title="statement not covered" >  console.log(</span>
+    '[NetworkController] Custom network chain IDs:',
+    Object.keys(configs),
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return configs;</span>
+}
+&nbsp;
+/**
+ * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.
+ *
+ * @param customNetworkType - The type of the custom network.
+ * @returns The `NetworkConfiguration` object.
+ */
+function <span class="fstat-no" title="function not covered" >getCustomNetworkConfiguration(</span>
+  customNetworkType: CustomNetworkType,
+): NetworkConfiguration {
+  const { ticker, rpcPrefs } = <span class="cstat-no" title="statement not covered" >BUILT_IN_NETWORKS[customNetworkType];</span>
+  const rpcEndpointUrl = <span class="cstat-no" title="statement not covered" >BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return {</span>
+    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],
+    chainId: ChainId[customNetworkType],
+    defaultRpcEndpointIndex: 0,
+    defaultBlockExplorerUrlIndex: 0,
+    name: NetworkNickname[customNetworkType],
+    nativeCurrency: ticker,
+    rpcEndpoints: [
+      {
+        failoverUrls: [],
+        networkClientId: customNetworkType,
+        type: RpcEndpointType.Custom,
+        url: rpcEndpointUrl,
+      },
+    ],
+  };
+}
+&nbsp;
+/**
+ * Constructs properties for the NetworkController state whose values will be
+ * used if not provided to the constructor.
+ *
+ * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.
+ * @returns The default NetworkController state.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >g</span>etDefaultNetworkControllerState(</span>
+  additionalDefaultNetworks?: AdditionalDefaultNetwork[],
+): NetworkState {
+  const networksMetadata = <span class="cstat-no" title="statement not covered" >{};</span>
+  const networkConfigurationsByChainId =
+<span class="cstat-no" title="statement not covered" >    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return {</span>
+    selectedNetworkClientId: InfuraNetworkType.mainnet,
+    networksMetadata,
+    networkConfigurationsByChainId,
+  };
+}
+&nbsp;
+/**
+ * Redux selector for getting all network configurations from NetworkController
+ * state, keyed by chain ID.
+ *
+ * @param state - NetworkController state
+ * @returns All registered network configurations, keyed by chain ID.
+ */
+const selectNetworkConfigurationsByChainId = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
+  state: NetworkState,
+): Record&lt;`0x${string}`, NetworkConfiguration&gt; =&gt;
+<span class="cstat-no" title="statement not covered" >  state.networkConfigurationsByChainId;</span>
+&nbsp;
+/**
+ * Get a list of all network configurations.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network configurations
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >g</span>etNetworkConfigurations(</span>
+  state: NetworkState,
+): NetworkConfiguration[] {
+<span class="cstat-no" title="statement not covered" >  return Object.values(state.networkConfigurationsByChainId);</span>
+}
+&nbsp;
+/**
+ * Redux selector for getting a list of all network configurations from
+ * NetworkController state.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network configurations
+ */
+export const <span class="cstat-no" title="statement not covered" >selectNetworkConfigurations = createSelector(</span>
+  selectNetworkConfigurationsByChainId,
+<span class="fstat-no" title="function not covered" >  (n</span>etworkConfigurationsByChainId) =&gt;
+<span class="cstat-no" title="statement not covered" >    Object.values(networkConfigurationsByChainId),</span>
+);
+&nbsp;
+/**
+ * Get a list of all available network client IDs from a list of network
+ * configurations.
+ *
+ * @param networkConfigurations - The array of network configurations
+ * @returns A list of all available client IDs
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >g</span>etAvailableNetworkClientIds(</span>
+  networkConfigurations: NetworkConfiguration[],
+): string[] {
+<span class="cstat-no" title="statement not covered" >  return networkConfigurations.flatMap(<span class="fstat-no" title="function not covered" >(n</span>etworkConfiguration) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >    networkConfiguration.rpcEndpoints.map(</span>
+<span class="fstat-no" title="function not covered" >      (r</span>pcEndpoint) =&gt; <span class="cstat-no" title="statement not covered" >rpcEndpoint.networkClientId,</span>
+    ),
+  );
+}
+&nbsp;
+/**
+ * Redux selector for getting a list of all available network client IDs
+ * from NetworkController state.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network client IDs.
+ */
+export const <span class="cstat-no" title="statement not covered" >selectAvailableNetworkClientIds = createSelector(</span>
+  selectNetworkConfigurations,
+  getAvailableNetworkClientIds,
+);
+&nbsp;
+/**
+ * The collection of auto-managed network clients that map to Infura networks.
+ */
+export type AutoManagedBuiltInNetworkClientRegistry = Record&lt;
+  BuiltInNetworkClientId,
+  AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;
+&gt;;
+&nbsp;
+/**
+ * The collection of auto-managed network clients that map to Infura networks.
+ */
+export type AutoManagedCustomNetworkClientRegistry = Record&lt;
+  CustomNetworkClientId,
+  AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;
+&gt;;
+&nbsp;
+/**
+ * The collection of auto-managed network clients that map to Infura networks
+ * as well as custom networks that users have added.
+ */
+export type AutoManagedNetworkClientRegistry = {
+  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;
+  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork` and `updateNetwork` to create a network client for an
+ * RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type AddNetworkClientOperation = {
+  type: 'add';
+  rpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `updateNetwork` and `removeNetwork` to remove a network client for
+ * an RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type RemoveNetworkClientOperation = {
+  type: 'remove';
+  rpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork` and `updateNetwork` to replace the network client for
+ * an RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type ReplaceNetworkClientOperation = {
+  type: 'replace';
+  oldRpcEndpoint: RpcEndpoint;
+  newRpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC
+ * endpoint, as far as the network client registry is concerned.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type NoopNetworkClientOperation = {
+  type: 'noop';
+  rpcEndpoint: RpcEndpoint;
+};
+&nbsp;
+/**
+ * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to
+ * update the network client registry.
+ *
+ * - When `addNetwork` is called, represents a network client that should be
+ * created for a new RPC endpoint.
+ * - When `removeNetwork` is called, represents a network client that should be
+ * destroyed for a previously existing RPC endpoint.
+ * - When `updateNetwork` is called, represents either:
+ *   - a network client that should be added for a new RPC endpoint
+ *   - a network client that should be removed for a previously existing RPC
+ *   endpoint
+ *   - a network client that should be replaced for an RPC endpoint that was
+ *   changed in a non-major way, or
+ *   - a network client that should be unchanged for an RPC endpoint that was
+ *   also unchanged.
+ */
+type NetworkClientOperation =
+  | AddNetworkClientOperation
+  | RemoveNetworkClientOperation
+  | ReplaceNetworkClientOperation
+  | NoopNetworkClientOperation;
+&nbsp;
+/**
+ * Determines whether the given URL is valid by attempting to parse it.
+ *
+ * @param url - The URL to test.
+ * @returns True if the URL is valid, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isValidUrl(</span>url: string): boolean {
+  const uri = <span class="cstat-no" title="statement not covered" >URI.parse(url);</span>
+<span class="cstat-no" title="statement not covered" >  return (</span>
+    uri.error === undefined &amp;&amp; (uri.scheme === 'http' || uri.scheme === 'https')
+  );
+}
+&nbsp;
+/**
+ * Given an Infura API URL, extracts the subdomain that identifies the Infura
+ * network.
+ *
+ * @param rpcEndpointUrl - The URL to operate on.
+ * @returns The Infura network name that the URL references.
+ * @throws if the URL is not an Infura API URL, or if an Infura network is not
+ * present in the URL.
+ */
+function <span class="fstat-no" title="function not covered" >deriveInfuraNetworkNameFromRpcEndpointUrl(</span>
+  rpcEndpointUrl: string,
+): InfuraNetworkType {
+  const match = <span class="cstat-no" title="statement not covered" >INFURA_URL_REGEX.exec(rpcEndpointUrl);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if (match?.groups) {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInfuraNetworkType(match.groups.networkName)) {</span>
+<span class="cstat-no" title="statement not covered" >      return match.groups.networkName;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);</span>
+  }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  throw new Error('Could not derive Infura network from RPC endpoint URL');</span>
+}
+&nbsp;
+/**
+ * Performs a series of checks that the given NetworkController state is
+ * internally consistent â€” that all parts of state that are supposed to match in
+ * fact do â€” so that working with the state later on doesn't cause unexpected
+ * errors.
+ *
+ * In the case of NetworkController, there are several parts of state that need
+ * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry
+ * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC
+ * endpoint within a network configuration.
+ *
+ * @param state - The NetworkController state to verify.
+ * @throws if the state is invalid in some way.
+ */
+function <span class="fstat-no" title="function not covered" >validateInitialState(</span>state: NetworkState): void {
+  const networkConfigurationEntries = <span class="cstat-no" title="statement not covered" >Object.entries(</span>
+    state.networkConfigurationsByChainId,
+  );
+  const networkClientIds = <span class="cstat-no" title="statement not covered" >getAvailableNetworkClientIds(</span>
+    getNetworkConfigurations(state),
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if (networkConfigurationEntries.length === 0) {</span>
+<span class="cstat-no" title="statement not covered" >    throw new Error(</span>
+      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',
+    );
+  }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (chainId !== networkConfiguration.chainId) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \`chainId\` of '${networkConfiguration.chainId}'`,
+      );
+    }
+&nbsp;
+    const isInvalidDefaultBlockExplorerUrlIndex =
+<span class="cstat-no" title="statement not covered" >      networkConfiguration.blockExplorerUrls.length &gt; 0</span>
+        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||
+          networkConfiguration.blockExplorerUrls[
+            networkConfiguration.defaultBlockExplorerUrlIndex
+          ] === undefined
+        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInvalidDefaultBlockExplorerUrlIndex) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' has a \`defaultBlockExplorerUrlIndex\` that does not refer to an entry in \`blockExplorerUrls\``,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      networkConfiguration.rpcEndpoints[
+        networkConfiguration.defaultRpcEndpointIndex
+      ] === undefined
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' has a \`defaultRpcEndpointIndex\` that does not refer to an entry in \`rpcEndpoints\``,
+      );
+    }
+  }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if ([...new Set(networkClientIds)].length &lt; networkClientIds.length) {</span>
+<span class="cstat-no" title="statement not covered" >    throw new Error(</span>
+      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',
+    );
+  }
+}
+&nbsp;
+/**
+ * Checks that the given initial NetworkController state is internally
+ * consistent similar to `validateInitialState`, but if an anomaly is detected,
+ * it does its best to correct the state and logs an error to Sentry.
+ *
+ * @param state - The NetworkController state to verify.
+ * @param messenger - The NetworkController messenger.
+ * @returns The corrected state.
+ */
+function <span class="fstat-no" title="function not covered" >correctInitialState(</span>
+  state: NetworkState,
+  messenger: NetworkControllerMessenger,
+): NetworkState {
+  const networkConfigurationsSortedByChainId = <span class="cstat-no" title="statement not covered" >getNetworkConfigurations(</span>
+    state,
+  ).sort(<span class="fstat-no" title="function not covered" >(a</span>, b) =&gt; <span class="cstat-no" title="statement not covered" >a.chainId.localeCompare(b.chainId))</span>;
+  const availableNetworkClientIds = <span class="cstat-no" title="statement not covered" >getAvailableNetworkClientIds(</span>
+    networkConfigurationsSortedByChainId,
+  );
+  const invalidNetworkClientIdsWithMetadata = <span class="cstat-no" title="statement not covered" >Object.keys(</span>
+    state.networksMetadata,
+  ).filter(
+<span class="fstat-no" title="function not covered" >    (n</span>etworkClientId) =&gt; <span class="cstat-no" title="statement not covered" >!availableNetworkClientIds.includes(networkClientId),</span>
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return produce(state, <span class="fstat-no" title="function not covered" >(n</span>ewState) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {</span>
+      const firstNetworkConfiguration = <span class="cstat-no" title="statement not covered" >networkConfigurationsSortedByChainId[0];</span>
+      const newSelectedNetworkClientId =
+<span class="cstat-no" title="statement not covered" >        firstNetworkConfiguration.rpcEndpoints[</span>
+          firstNetworkConfiguration.defaultRpcEndpointIndex
+        ].networkClientId;
+<span class="cstat-no" title="statement not covered" >      messenger.captureException?.(</span>
+        new Error(
+          `\`selectedNetworkClientId\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,
+        ),
+      );
+<span class="cstat-no" title="statement not covered" >      newState.selectedNetworkClientId = newSelectedNetworkClientId;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (invalidNetworkClientIdsWithMetadata.length &gt; 0) {</span>
+<span class="cstat-no" title="statement not covered" >      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {</span>
+<span class="cstat-no" title="statement not covered" >        delete newState.networksMetadata[invalidNetworkClientId];</span>
+      }
+<span class="cstat-no" title="statement not covered" >      messenger.captureException?.(</span>
+        new Error(
+          '`networksMetadata` had invalid network client IDs, which have been removed',
+        ),
+      );
+    }
+  });
+}
+&nbsp;
+/**
+ * Transforms a map of chain ID to network configuration to a map of network
+ * client ID to network configuration.
+ *
+ * @param networkConfigurationsByChainId - The network configurations, keyed by
+ * chain ID.
+ * @returns The network configurations, keyed by network client ID.
+ */
+function <span class="fstat-no" title="function not covered" >buildNetworkConfigurationsByNetworkClientId(</span>
+  networkConfigurationsByChainId: Record&lt;Hex, NetworkConfiguration&gt;,
+): Map&lt;NetworkClientId, NetworkConfiguration&gt; {
+<span class="cstat-no" title="statement not covered" >  return new Map(</span>
+    Object.values(networkConfigurationsByChainId).flatMap(
+<span class="fstat-no" title="function not covered" >      (n</span>etworkConfiguration) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return networkConfiguration.rpcEndpoints.map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return [rpcEndpoint.networkClientId, networkConfiguration];</span>
+        });
+      },
+    ),
+  );
+}
+&nbsp;
+/**
+ * Controller that creates and manages an Ethereum network provider.
+ */
+<span class="cstat-no" title="statement not covered" >export class N</span>etworkController extends BaseController&lt;
+  typeof controllerName,
+  NetworkState,
+  NetworkControllerMessenger
+&gt; {
+<span class="cstat-no" title="statement not covered" >  #ethQuery?: EthQuery;</span>
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#infuraProjectId: string;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #previouslySelectedNetworkClientId: string;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #providerProxy: ProviderProxy | undefined;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #blockTrackerProxy: BlockTrackerProxy | undefined;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #autoManagedNetworkClient?:</span>
+    | AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;
+    | AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;;
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#log: Logger | undefined;</span>
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];</span>
+&nbsp;
+  readonly <span class="cstat-no" title="statement not covered" >#getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #networkConfigurationsByNetworkClientId: Map&lt;</span>
+    NetworkClientId,
+    NetworkConfiguration
+  &gt;;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  #isRpcFailoverEnabled: Exclude&lt;</span>
+    NetworkControllerOptions['isRpcFailoverEnabled'],
+    undefined
+  &gt;;
+&nbsp;
+  /**
+   * Constructs a NetworkController.
+   *
+   * @param options - The options; see {@link NetworkControllerOptions}.
+   */
+<span class="fstat-no" title="function not covered" >  constructor(o</span>ptions: NetworkControllerOptions) {
+    const {
+      messenger,
+      state,
+      infuraProjectId,
+      log,
+      getRpcServiceOptions,
+      getBlockTrackerOptions,
+      additionalDefaultNetworks,
+      isRpcFailoverEnabled = <span class="branch-0 cbranch-no" title="branch not covered" >false,</span>
+    } = <span class="cstat-no" title="statement not covered" >options;</span>
+    const initialState = <span class="cstat-no" title="statement not covered" >{</span>
+      ...getDefaultNetworkControllerState(additionalDefaultNetworks),
+      ...state,
+    };
+<span class="cstat-no" title="statement not covered" >    validateInitialState(initialState);</span>
+    const correctedInitialState = <span class="cstat-no" title="statement not covered" >correctInitialState(initialState, messenger);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!infuraProjectId || typeof infuraProjectId !== 'string') {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error('Invalid Infura project ID');</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    super({</span>
+      name: controllerName,
+      metadata: {
+        selectedNetworkClientId: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+        networksMetadata: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+        networkConfigurationsByChainId: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+      },
+      messenger,
+      state: correctedInitialState,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#infuraProjectId = infuraProjectId;</span>
+<span class="cstat-no" title="statement not covered" >    this.#log = log;</span>
+<span class="cstat-no" title="statement not covered" >    this.#getRpcServiceOptions = getRpcServiceOptions;</span>
+<span class="cstat-no" title="statement not covered" >    this.#getBlockTrackerOptions = getBlockTrackerOptions;</span>
+<span class="cstat-no" title="statement not covered" >    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#previouslySelectedNetworkClientId =</span>
+      this.state.selectedNetworkClientId;
+<span class="cstat-no" title="statement not covered" >    this.#networkConfigurationsByNetworkClientId =</span>
+      buildNetworkConfigurationsByNetworkClientId(
+        this.state.networkConfigurationsByChainId,
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, <span class="fstat-no" title="function not covered" >() =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      return this.#ethQuery;</span>
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getNetworkClientById`,
+      this.getNetworkClientById.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getEIP1559Compatibility`,
+      this.getEIP1559Compatibility.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:setActiveNetwork`,
+      this.setActiveNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:setProviderType`,
+      this.setProviderType.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:findNetworkClientIdByChainId`,
+      this.findNetworkClientIdByChainId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getNetworkConfigurationByChainId`,
+      this.getNetworkConfigurationByChainId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getNetworkConfigurationByNetworkClientId`,
+      this.getNetworkConfigurationByNetworkClientId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getSelectedNetworkClient`,
+      this.getSelectedNetworkClient.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:getSelectedChainId`,
+      this.getSelectedChainId.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:addNetwork`,
+      this.addNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:removeNetwork`,
+      this.removeNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.registerActionHandler(</span>
+      `${this.name}:updateNetwork`,
+      this.updateNetwork.bind(this),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe(</span>
+      `${this.name}:rpcEndpointChainUnavailable`,
+<span class="fstat-no" title="function not covered" >      ({</span> networkClientId }) =&gt; {
+<span class="cstat-no" title="statement not covered" >        this.#updateMetadataForNetwork(networkClientId, {</span>
+          networkStatus: NetworkStatus.Unavailable,
+        });
+      },
+    );
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe(</span>
+      `${this.name}:rpcEndpointChainDegraded`,
+<span class="fstat-no" title="function not covered" >      ({</span> networkClientId }) =&gt; {
+<span class="cstat-no" title="statement not covered" >        this.#updateMetadataForNetwork(networkClientId, {</span>
+          networkStatus: NetworkStatus.Degraded,
+        });
+      },
+    );
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe(</span>
+      `${this.name}:rpcEndpointChainAvailable`,
+<span class="fstat-no" title="function not covered" >      ({</span> networkClientId }) =&gt; {
+<span class="cstat-no" title="statement not covered" >        this.#updateMetadataForNetwork(networkClientId, {</span>
+          networkStatus: NetworkStatus.Available,
+        });
+      },
+    );
+  }
+&nbsp;
+  /**
+   * Enables the RPC failover functionality. That is, if any RPC endpoints are
+   * configured with failover URLs, then traffic will automatically be diverted
+   * to them if those RPC endpoints are unavailable.
+   */
+<span class="fstat-no" title="function not covered" >  enableRpcFailover(</span>): void {
+<span class="cstat-no" title="statement not covered" >    this.#updateRpcFailoverEnabled(true);</span>
+  }
+&nbsp;
+  /**
+   * Disables the RPC failover functionality. That is, even if any RPC endpoints
+   * are configured with failover URLs, then traffic will not automatically be
+   * diverted to them if those RPC endpoints are unavailable.
+   */
+<span class="fstat-no" title="function not covered" >  disableRpcFailover(</span>): void {
+<span class="cstat-no" title="statement not covered" >    this.#updateRpcFailoverEnabled(false);</span>
+  }
+&nbsp;
+  /**
+   * Enables or disables the RPC failover functionality, depending on the
+   * boolean given. This is done by reconstructing all network clients that were
+   * originally configured with failover URLs so that those URLs are either
+   * honored or ignored. Network client IDs will be preserved so as not to
+   * invalidate state in other controllers.
+   *
+   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the
+   * RPC failover functionality.
+   */
+  #updateRpcFailoverEnabled(<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >newIsRpcFailoverEnabled: boolean)</span>: void {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {</span>
+<span class="cstat-no" title="statement not covered" >      return;</span>
+    }
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const networkClientsById of Object.values(</span>
+      autoManagedNetworkClientRegistry,
+    )) {
+<span class="cstat-no" title="statement not covered" >      for (const networkClientId of Object.keys(networkClientsById)) {</span>
+        // Type assertion: We can assume that `networkClientId` is valid here.
+        const networkClient =
+<span class="cstat-no" title="statement not covered" >          networkClientsById[</span>
+            networkClientId as keyof typeof networkClientsById
+          ];
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+          networkClient.configuration.failoverRpcUrls &amp;&amp;
+          networkClient.configuration.failoverRpcUrls.length &gt; 0
+        ) {
+<span class="cstat-no" title="statement not covered" >          newIsRpcFailoverEnabled</span>
+            ? networkClient.enableRpcFailover()
+            : networkClient.disableRpcFailover();
+        }
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;</span>
+  }
+&nbsp;
+  /**
+   * Accesses the provider and block tracker for the currently selected network.
+   *
+   * @returns The proxy and block tracker proxies.
+   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.
+   */
+<span class="fstat-no" title="function not covered" >  getProviderAndBlockTracker(</span>): {
+    provider: SwappableProxy&lt;ProxyWithAccessibleTarget&lt;Provider&gt;&gt; | undefined;
+    blockTracker:
+      | SwappableProxy&lt;ProxyWithAccessibleTarget&lt;BlockTracker&gt;&gt;
+      | undefined;
+  } {
+<span class="cstat-no" title="statement not covered" >    return {</span>
+      provider: this.#providerProxy,
+      blockTracker: this.#blockTrackerProxy,
+    };
+  }
+&nbsp;
+  /**
+   * Accesses the provider and block tracker for the currently selected network.
+   *
+   * @returns an object with the provider and block tracker proxies for the currently selected network.
+   */
+<span class="fstat-no" title="function not covered" >  getSelectedNetworkClient(</span>):
+    | {
+        provider: SwappableProxy&lt;ProxyWithAccessibleTarget&lt;Provider&gt;&gt;;
+        blockTracker: SwappableProxy&lt;ProxyWithAccessibleTarget&lt;BlockTracker&gt;&gt;;
+      }
+    | undefined {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#providerProxy &amp;&amp; this.#blockTrackerProxy) {</span>
+<span class="cstat-no" title="statement not covered" >      return {</span>
+        provider: this.#providerProxy,
+        blockTracker: this.#blockTrackerProxy,
+      };
+    }
+<span class="cstat-no" title="statement not covered" >    return undefined;</span>
+  }
+&nbsp;
+  /**
+   * Accesses the chain ID from the selected network client.
+   *
+   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.
+   */
+<span class="fstat-no" title="function not covered" >  getSelectedChainId(</span>): Hex | undefined {
+    const networkConfiguration = <span class="cstat-no" title="statement not covered" >this.getNetworkConfigurationByNetworkClientId(</span>
+      this.state.selectedNetworkClientId,
+    );
+<span class="cstat-no" title="statement not covered" >    return networkConfiguration?.chainId;</span>
+  }
+&nbsp;
+  /**
+   * Internally, the Infura and custom network clients are categorized by type
+   * so that when accessing either kind of network client, TypeScript knows
+   * which type to assign to the network client. For some cases it's more useful
+   * to be able to access network clients by ID instead of by type and then ID,
+   * so this function makes that possible.
+   *
+   * @returns The network clients registered so far, keyed by ID.
+   */
+<span class="fstat-no" title="function not covered" >  getNetworkClientRegistry(</span>): AutoManagedBuiltInNetworkClientRegistry &amp;
+    AutoManagedCustomNetworkClientRegistry {
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return Object.assign(</span>
+      {},
+      autoManagedNetworkClientRegistry[NetworkClientType.Infura],
+      autoManagedNetworkClientRegistry[NetworkClientType.Custom],
+    );
+  }
+&nbsp;
+  /**
+   * Returns the Infura network client with the given ID.
+   *
+   * @param infuraNetworkClientId - An Infura network client ID.
+   * @returns The Infura network client.
+   * @throws If an Infura network client does not exist with the given ID.
+   */
+  getNetworkClientById(
+    infuraNetworkClientId: BuiltInNetworkClientId,
+  ): AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;;
+&nbsp;
+  /**
+   * Returns the custom network client with the given ID.
+   *
+   * @param customNetworkClientId - A custom network client ID.
+   * @returns The custom network client.
+   * @throws If a custom network client does not exist with the given ID.
+   */
+  getNetworkClientById(
+    customNetworkClientId: CustomNetworkClientId,
+  ): AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  getNetworkClientById(</span>
+    networkClientId: NetworkClientId,
+  ): AutoManagedNetworkClient&lt;NetworkClientConfiguration&gt; {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!networkClientId) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error('No network client ID was provided.');</span>
+    }
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInfuraNetworkType(networkClientId)) {</span>
+      const infuraNetworkClient =
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Infura][</span>
+          networkClientId
+        ];
+      // This is impossible to reach
+      /* istanbul ignore if */
+<span class="cstat-no" title="statement not covered" >      if (!infuraNetworkClient) {</span>
+        throw new Error(
+          `No Infura network client was found with the ID "${networkClientId}".`,
+        );
+      }
+<span class="cstat-no" title="statement not covered" >      return infuraNetworkClient;</span>
+    }
+&nbsp;
+    const customNetworkClient =
+<span class="cstat-no" title="statement not covered" >      autoManagedNetworkClientRegistry[NetworkClientType.Custom][</span>
+        networkClientId
+      ];
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!customNetworkClient) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `No custom network client was found with the ID "${networkClientId}".`,
+      );
+    }
+<span class="cstat-no" title="statement not covered" >    return customNetworkClient;</span>
+  }
+&nbsp;
+  /**
+   * Executes a series of steps to switch the network:
+   *
+   * 1. Notifies subscribers via the messenger that the network is about to be
+   * switched (and, really, that the global provider and block tracker proxies
+   * will be re-pointed to a new network).
+   * 2. Looks up a known and preinitialized network client matching the given
+   * ID and uses it to re-point the aforementioned provider and block tracker
+   * proxies.
+   * 3. Notifies subscribers via the messenger that the network has switched.
+   * 4. Captures metadata for the newly switched network in state.
+   *
+   * @param networkClientId - The ID of a network client that requests will be
+   * routed through (either the name of an Infura network or the ID of a custom
+   * network configuration).
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   */
+  async<span class="fstat-no" title="function not covered" > #refreshNetwork(</span>
+    networkClientId: string,
+    options: {
+      updateState?: (state: Draft&lt;NetworkState&gt;) =&gt; void;
+    } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish('NetworkController:networkWillChange', this.state);</span>
+<span class="cstat-no" title="statement not covered" >    this.#applyNetworkSelection(networkClientId, options);</span>
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish('NetworkController:networkDidChange', this.state);</span>
+<span class="cstat-no" title="statement not covered" >    await this.lookupNetwork();</span>
+  }
+&nbsp;
+  /**
+   * Creates proxies for accessing the global network client and its block
+   * tracker. You must call this method in order to use
+   * `getProviderAndBlockTracker` (or its replacement,
+   * `getSelectedNetworkClient`).
+   *
+   * @param options - Optional arguments.
+   * @param options.lookupNetwork - Usually, metadata for the global network
+   * will be populated via a call to `lookupNetwork` after creating the provider
+   * and block tracker proxies. This allows for responding to the status of the
+   * global network after initializing this controller; however, it requires
+   * making a request to the network to do so. In the clients, where controllers
+   * are initialized before the UI is shown, this may be undesirable, as it
+   * means that if the user has just installed MetaMask, their IP address may be
+   * shared with a third party before they have a chance to finish onboarding.
+   * You can pass `false` if you'd like to disable this request and call
+   * `lookupNetwork` yourself.
+   */
+  initializeProvider(options: { lookupNetwork: false }): void;
+&nbsp;
+  /**
+   * Creates proxies for accessing the global network client and its block
+   * tracker. You must call this method in order to use
+   * `getProviderAndBlockTracker` (or its replacement,
+   * `getSelectedNetworkClient`).
+   *
+   * @param options - Optional arguments.
+   * @param options.lookupNetwork - Usually, metadata for the global network
+   * will be populated via a call to `lookupNetwork` after creating the provider
+   * and block tracker proxies. This allows for responding to the status of the
+   * global network after initializing this controller; however, it requires
+   * making a request to the network to do so. In the clients, where controllers
+   * are initialized before the UI is shown, this may be undesirable, as it
+   * means that if the user has just installed MetaMask, their IP address may be
+   * shared with a third party before they have a chance to finish onboarding.
+   * You can pass `false` if you'd like to disable this request and call
+   * `lookupNetwork` yourself.
+   * @returns A promise that resolves when the network lookup completes.
+   */
+  initializeProvider(options?: { lookupNetwork?: boolean }): Promise&lt;void&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  initializeProvider(</span>{
+    lookupNetwork = <span class="branch-0 cbranch-no" title="branch not covered" >true,</span>
+  }: {
+    lookupNetwork?: boolean;
+  } = <span class="branch-0 cbranch-no" title="branch not covered" >{})</span>: Promise&lt;void&gt; | undefined {
+<span class="cstat-no" title="statement not covered" >    this.#applyNetworkSelection(this.state.selectedNetworkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (lookupNetwork) {</span>
+<span class="cstat-no" title="statement not covered" >      return this.lookupNetwork();</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return undefined;</span>
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network:
+   *
+   * - The connectivity status: whether it is available, geo-blocked (Infura
+   * only), unavailable, or unknown
+   * - The capabilities status: whether it supports EIP-1559, whether it does
+   * not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * If no ID is provided, uses the currently selected network.
+   * @returns The resulting metadata for the network.
+   */
+  async<span class="fstat-no" title="function not covered" > #determineNetworkMetadata(n</span>etworkClientId: NetworkClientId): Promise&lt;{
+    isInfura: boolean;
+    networkStatus:
+      | NetworkStatus.Available
+      | NetworkStatus.Unknown
+      | NetworkStatus.Unavailable
+      | NetworkStatus.Blocked;
+    isEIP1559Compatible: undefined | boolean;
+  }&gt; {
+    // Force TypeScript to use one of the two overloads explicitly
+    const networkClient = <span class="cstat-no" title="statement not covered" >isInfuraNetworkType(networkClientId)</span>
+      ? this.getNetworkClientById(networkClientId)
+      : this.getNetworkClientById(networkClientId);
+&nbsp;
+    const isInfura =
+<span class="cstat-no" title="statement not covered" >      networkClient.configuration.type === NetworkClientType.Infura;</span>
+    let networkStatus: NetworkStatus;
+    let isEIP1559Compatible: boolean | undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    try {</span>
+<span class="cstat-no" title="statement not covered" >      isEIP1559Compatible =</span>
+        await this.#determineEIP1559Compatibility(networkClientId);
+<span class="cstat-no" title="statement not covered" >      networkStatus = NetworkStatus.Available;</span>
+    } catch (error) {
+<span class="cstat-no" title="statement not covered" >      debugLog('NetworkController: lookupNetwork: ', error);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      if (isErrorWithCode(error)) {</span>
+        let responseBody;
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+          isInfura &amp;&amp;
+          hasProperty(error, 'message') &amp;&amp;
+          typeof error.message === 'string'
+        ) {
+<span class="cstat-no" title="statement not covered" >          try {</span>
+<span class="cstat-no" title="statement not covered" >            responseBody = JSON.parse(error.message);</span>
+          } catch {
+            // error.message must not be JSON
+<span class="cstat-no" title="statement not covered" >            this.#log?.warn(</span>
+              'NetworkController: lookupNetwork: json parse error: ',
+              error,
+            );
+          }
+        }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        if (</span>
+          isPlainObject(responseBody) &amp;&amp;
+          responseBody.error === INFURA_BLOCKED_KEY
+        ) {
+<span class="cstat-no" title="statement not covered" >          networkStatus = NetworkStatus.Blocked;</span>
+        } else <span class="cstat-no" title="statement not covered" >if (error.code === errorCodes.rpc.internal) {</span>
+<span class="cstat-no" title="statement not covered" >          networkStatus = NetworkStatus.Unknown;</span>
+<span class="cstat-no" title="statement not covered" >          this.#log?.warn(</span>
+            'NetworkController: lookupNetwork: rpc internal error: ',
+            error,
+          );
+        } else {
+<span class="cstat-no" title="statement not covered" >          networkStatus = NetworkStatus.Unavailable;</span>
+<span class="cstat-no" title="statement not covered" >          this.#log?.warn('NetworkController: lookupNetwork: ', error);</span>
+        }
+      } else {
+<span class="cstat-no" title="statement not covered" >        debugLog(</span>
+          'NetworkController - could not determine network status',
+          error,
+        );
+<span class="cstat-no" title="statement not covered" >        networkStatus = NetworkStatus.Unknown;</span>
+<span class="cstat-no" title="statement not covered" >        this.#log?.warn('NetworkController: lookupNetwork: ', error);</span>
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { isInfura, networkStatus, isEIP1559Compatible };</span>
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given or selected network, persisting it to state:
+   *
+   * - The connectivity status: whether it is available, geo-blocked (Infura
+   * only), unavailable, or unknown
+   * - The capabilities status: whether it supports EIP-1559, whether it does
+   * not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * If no ID is provided, uses the currently selected network.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>lookupNetwork(networkClientId?: NetworkClientId): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    if (networkClientId) {</span>
+<span class="cstat-no" title="statement not covered" >      await this.#lookupGivenNetwork(networkClientId);</span>
+    } else {
+<span class="cstat-no" title="statement not covered" >      await this.#lookupSelectedNetwork();</span>
+    }
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * @deprecated Please use `lookupNetwork` and pass a network client ID
+   * instead. This method will be removed in a future major version.
+   */
+  // We are planning on removing this so we aren't interested in testing this
+  // right now.
+  /* istanbul ignore next */
+  async lookupNetworkByClientId(
+    networkClientId: NetworkClientId,
+  ): Promise&lt;void&gt; {
+    await this.#lookupGivenNetwork(networkClientId);
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   */
+  async<span class="fstat-no" title="function not covered" > #lookupGivenNetwork(n</span>etworkClientId: NetworkClientId): Promise&lt;void&gt; {
+    const { networkStatus, isEIP1559Compatible } =
+<span class="cstat-no" title="statement not covered" >      await this.#determineNetworkMetadata(networkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#updateMetadataForNetwork(networkClientId, {</span>
+      networkStatus,
+      isEIP1559Compatible,
+    });
+  }
+&nbsp;
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the currently selected network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * Note that it is possible for the current network to be switched while this
+   * method is running. If that is the case, it will exit early (as this method
+   * will also run for the new network).
+   */
+  async<span class="fstat-no" title="function not covered" > #lookupSelectedNetwork(): Promise&lt;void&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.#ethQuery) {</span>
+<span class="cstat-no" title="statement not covered" >      return;</span>
+    }
+&nbsp;
+    let networkChanged = <span class="cstat-no" title="statement not covered" >false;</span>
+    const listener = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      networkChanged = true;</span>
+<span class="cstat-no" title="statement not covered" >      try {</span>
+<span class="cstat-no" title="statement not covered" >        this.messenger.unsubscribe(</span>
+          'NetworkController:networkDidChange',
+          listener,
+        );
+      } catch (error) {
+        // In theory, this `catch` should not be necessary given that this error
+        // would occur "inside" of the call to `#determineEIP1559Compatibility`
+        // below and so it should be caught by the `try`/`catch` below (it is
+        // impossible to reproduce in tests for that reason). However, somehow
+        // it occurs within Mobile and so we have to add our own `try`/`catch`
+        // here.
+        /* istanbul ignore next */
+        if (
+          !(error instanceof Error) ||
+          error.message !==
+            'Subscription not found for event: NetworkController:networkDidChange'
+        ) {
+          // Again, this error should not happen and is impossible to reproduce
+          // in tests.
+          /* istanbul ignore next */
+          throw error;
+        }
+      }
+    };
+<span class="cstat-no" title="statement not covered" >    this.messenger.subscribe('NetworkController:networkDidChange', listener);</span>
+&nbsp;
+    const { isInfura, networkStatus, isEIP1559Compatible } =
+<span class="cstat-no" title="statement not covered" >      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkChanged) {</span>
+      // If the network has changed, then `lookupNetwork` either has been or is
+      // in the process of being called, so we don't need to go further.
+<span class="cstat-no" title="statement not covered" >      return;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    try {</span>
+<span class="cstat-no" title="statement not covered" >      this.messenger.unsubscribe(</span>
+        'NetworkController:networkDidChange',
+        listener,
+      );
+    } catch (error) {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        !(error instanceof Error) ||
+        error.message !==
+          'Subscription not found for event: NetworkController:networkDidChange'
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw error;</span>
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {</span>
+      networkStatus,
+      isEIP1559Compatible,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (isInfura) {</span>
+<span class="cstat-no" title="statement not covered" >      if (networkStatus === NetworkStatus.Available) {</span>
+<span class="cstat-no" title="statement not covered" >        this.messenger.publish('NetworkController:infuraIsUnblocked');</span>
+      } else <span class="cstat-no" title="statement not covered" ><span class="missing-if-branch" title="if path not taken" >I</span>if (networkStatus === NetworkStatus.Blocked) {</span>
+<span class="cstat-no" title="statement not covered" >        this.messenger.publish('NetworkController:infuraIsBlocked');</span>
+      }
+    } else {
+      // Always publish infuraIsUnblocked regardless of network status to
+      // prevent consumers from being stuck in a blocked state if they were
+      // previously connected to an Infura network that was blocked
+<span class="cstat-no" title="statement not covered" >      this.messenger.publish('NetworkController:infuraIsUnblocked');</span>
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Updates the metadata for the given network in state.
+   *
+   * @param networkClientId - The associated network client ID.
+   * @param metadata - The metadata to store in state.
+   * @param metadata.networkStatus - The network status to store in state.
+   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to
+   * store in state.
+   */
+  #updateMetadataForNetwork(
+    networkClientId: NetworkClientId,
+    metadata: {
+      networkStatus: NetworkStatus;
+      isEIP1559Compatible?: boolean | undefined;
+    },
+  ): void {
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      state.networksMetadata[networkClientId] ??= {</span>
+        status: NetworkStatus.Unknown,
+        EIPS: {},
+      };
+&nbsp;
+      const newMetadata = <span class="cstat-no" title="statement not covered" >state.networksMetadata[networkClientId];</span>
+<span class="cstat-no" title="statement not covered" >      newMetadata.status = metadata.networkStatus;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if ('isEIP1559Compatible' in metadata) {</span>
+<span class="cstat-no" title="statement not covered" >        if (metadata.isEIP1559Compatible === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >          delete newMetadata.EIPS[1559];</span>
+        } else {
+<span class="cstat-no" title="statement not covered" >          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;</span>
+        }
+      }
+    });
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Convenience method to update provider network type settings.
+   *
+   * @param type - Human readable network name.
+   * @deprecated This has been replaced by `setActiveNetwork`, and will be
+   * removed in a future release
+   */
+<span class="fstat-no" title="function not covered" >  async </span>setProviderType(type: InfuraNetworkType): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if ((type as unknown) === NetworkType.rpc) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `NetworkController - cannot call "setProviderType" with type "${NetworkType.rpc}". Use "setActiveNetwork"`,
+      );
+    }
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!isInfuraNetworkType(type)) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(`Unknown Infura provider type "${String(type)}".`);</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    await this.setActiveNetwork(type);</span>
+  }
+&nbsp;
+  /**
+   * Changes the selected network.
+   *
+   * @param networkClientId - The ID of a network client that will be used to
+   * make requests.
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   * @throws if no network client is associated with the given
+   * network client ID.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>setActiveNetwork(
+    networkClientId: string,
+    options: {
+      updateState?: (state: Draft&lt;NetworkState&gt;) =&gt; void;
+    } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    this.#previouslySelectedNetworkClientId =</span>
+      this.state.selectedNetworkClientId;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    await this.#refreshNetwork(networkClientId, options);</span>
+  }
+&nbsp;
+  /**
+   * Fetches the latest block for the network.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.
+   * @returns A promise that either resolves to the block header or null if
+   * there is no latest block, or rejects with an error.
+   */
+  #getLatestBlock(
+    networkClientId: NetworkClientId = <span class="branch-0 cbranch-no" title="branch not covered" >this.state.selectedNetworkClientId,</span>
+  ): Promise&lt;Block&gt; {
+    const networkClient = <span class="cstat-no" title="statement not covered" >this.getNetworkClientById(networkClientId);</span>
+    const ethQuery = <span class="cstat-no" title="statement not covered" >new EthQuery(networkClient.provider);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return new Promise(<span class="fstat-no" title="function not covered" >(r</span>esolve, reject) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      ethQuery.sendAsync(</span>
+        { method: 'eth_getBlockByNumber', params: ['latest', false] },
+<span class="fstat-no" title="function not covered" >        (e</span>rror: unknown, block?: unknown) =&gt; {
+<span class="cstat-no" title="statement not covered" >          if (error) {</span>
+            // This error comes from JsonRpcEngine, we don't control it.
+            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors
+<span class="cstat-no" title="statement not covered" >            reject(error);</span>
+          } else {
+            // TODO: Validate this type
+<span class="cstat-no" title="statement not covered" >            resolve(block as Block);</span>
+          }
+        },
+      );
+    });
+  }
+&nbsp;
+  /**
+   * Determines whether the network supports EIP-1559 by checking whether the
+   * latest block has a `baseFeePerGas` property, then updates state
+   * appropriately.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.
+   * @returns A promise that resolves to true if the network supports EIP-1559
+   * , false otherwise, or `undefined` if unable to determine the compatibility.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>getEIP1559Compatibility(
+    networkClientId?: NetworkClientId,
+  ): Promise&lt;undefined | boolean&gt; {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkClientId) {</span>
+<span class="cstat-no" title="statement not covered" >      return this.get1559CompatibilityWithNetworkClientId(networkClientId);</span>
+    }
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.#ethQuery) {</span>
+<span class="cstat-no" title="statement not covered" >      return false;</span>
+    }
+&nbsp;
+    const { EIPS } =
+<span class="cstat-no" title="statement not covered" >      this.state.networksMetadata[this.state.selectedNetworkClientId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (EIPS[1559] !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      return EIPS[1559];</span>
+    }
+&nbsp;
+    const isEIP1559Compatible = <span class="cstat-no" title="statement not covered" >await this.#determineEIP1559Compatibility(</span>
+      this.state.selectedNetworkClientId,
+    );
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (isEIP1559Compatible !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =</span>
+          isEIP1559Compatible;
+      }
+    });
+<span class="cstat-no" title="statement not covered" >    return isEIP1559Compatible;</span>
+  }
+&nbsp;
+<span class="fstat-no" title="function not covered" >  async </span>get1559CompatibilityWithNetworkClientId(
+    networkClientId: NetworkClientId,
+  ): Promise&lt;boolean&gt; {
+    let metadata = <span class="cstat-no" title="statement not covered" >this.state.networksMetadata[networkClientId];</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (metadata?.EIPS[1559] === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      await this.lookupNetwork(networkClientId);</span>
+<span class="cstat-no" title="statement not covered" >      metadata = this.state.networksMetadata[networkClientId];</span>
+    }
+    const { EIPS } = <span class="cstat-no" title="statement not covered" >metadata;</span>
+&nbsp;
+    // may want to include some 'freshness' value - something to make sure we refetch this from time to time
+<span class="cstat-no" title="statement not covered" >    return EIPS[1559];</span>
+  }
+&nbsp;
+  /**
+   * Retrieves and checks the latest block from the currently selected
+   * network; if the block has a `baseFeePerGas` property, then we know
+   * that the network supports EIP-1559; otherwise it doesn't.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility
+   * @returns A promise that resolves to `true` if the network supports EIP-1559,
+   * `false` otherwise, or `undefined` if unable to retrieve the last block.
+   */
+  async<span class="fstat-no" title="function not covered" > #determineEIP1559Compatibility(</span>
+    networkClientId: NetworkClientId,
+  ): Promise&lt;boolean | undefined&gt; {
+    const latestBlock = <span class="cstat-no" title="statement not covered" >await this.#getLatestBlock(networkClientId);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!latestBlock) {</span>
+<span class="cstat-no" title="statement not covered" >      return undefined;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return latestBlock.baseFeePerGas !== undefined;</span>
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Ensures that the provider and block tracker proxies are pointed to the
+   * currently selected network and refreshes the metadata for the
+   */
+<span class="fstat-no" title="function not covered" >  async </span>resetConnection(): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    await this.#refreshNetwork(this.state.selectedNetworkClientId);</span>
+  }
+&nbsp;
+  /**
+   * Returns the network configuration that has been filed under the given chain
+   * ID.
+   *
+   * @param chainId - The chain ID to use as a key.
+   * @returns The network configuration if one exists, or undefined.
+   */
+<span class="fstat-no" title="function not covered" >  getNetworkConfigurationByChainId(</span>
+    chainId: Hex,
+  ): NetworkConfiguration | undefined {
+<span class="cstat-no" title="statement not covered" >    return this.state.networkConfigurationsByChainId[chainId];</span>
+  }
+&nbsp;
+  /**
+   * Returns the network configuration that contains an RPC endpoint with the
+   * given network client ID.
+   *
+   * @param networkClientId - The network client ID to use as a key.
+   * @returns The network configuration if one exists, or undefined.
+   */
+<span class="fstat-no" title="function not covered" >  getNetworkConfigurationByNetworkClientId(</span>
+    networkClientId: NetworkClientId,
+  ): NetworkConfiguration | undefined {
+<span class="cstat-no" title="statement not covered" >    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);</span>
+  }
+&nbsp;
+  /**
+   * Creates and registers network clients for the collection of Infura and
+   * custom RPC endpoints that can be used to make requests for a particular
+   * chain, storing the given configuration object in state for later reference.
+   *
+   * @param fields - The object that describes the new network/chain and lists
+   * the RPC endpoints which front that chain.
+   * @returns The newly added network configuration.
+   * @throws if any part of `fields` would produce invalid state.
+   * @see {@link NetworkConfiguration}
+   */
+<span class="fstat-no" title="function not covered" >  addNetwork(</span>fields: AddNetworkFields): NetworkConfiguration {
+    const { rpcEndpoints: setOfRpcEndpointFields } = <span class="cstat-no" title="statement not covered" >fields;</span>
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#validateNetworkFields({</span>
+      mode: 'add',
+      networkFields: fields,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+    const networkClientOperations = <span class="cstat-no" title="statement not covered" >setOfRpcEndpointFields.map(</span>
+<span class="fstat-no" title="function not covered" >      (d</span>efaultOrCustomRpcEndpointFields) =&gt; {
+        const rpcEndpoint =
+<span class="cstat-no" title="statement not covered" >          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom</span>
+            ? {
+                ...defaultOrCustomRpcEndpointFields,
+                networkClientId: uuidV4(),
+              }
+            : defaultOrCustomRpcEndpointFields;
+<span class="cstat-no" title="statement not covered" >        return {</span>
+          type: 'add' as const,
+          rpcEndpoint,
+        };
+      },
+    );
+&nbsp;
+    const newNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.#determineNetworkConfigurationToPersist({</span>
+        networkFields: fields,
+        networkClientOperations,
+      });
+<span class="cstat-no" title="statement not covered" >    this.#registerNetworkClientsAsNeeded({</span>
+      networkFields: fields,
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      this.#updateNetworkConfigurations({</span>
+        state,
+        mode: 'add',
+        networkFields: fields,
+        networkConfigurationToPersist: newNetworkConfiguration,
+      });
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish(</span>
+      `${controllerName}:networkAdded`,
+      newNetworkConfiguration,
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return newNetworkConfiguration;</span>
+  }
+&nbsp;
+  /**
+   * Updates the configuration for a previously stored network filed under the
+   * given chain ID, creating + registering new network clients to represent RPC
+   * endpoints that have been added and destroying + unregistering existing
+   * network clients for RPC endpoints that have been removed.
+   *
+   * Note that if `chainId` is changed, then all network clients associated with
+   * that chain will be removed and re-added, even if none of the RPC endpoints
+   * have changed.
+   *
+   * @param chainId - The chain ID associated with an existing network.
+   * @param fields - The object that describes the updates to the network/chain,
+   * including the new set of RPC endpoints which should front that chain.
+   * @param options - Options to provide.
+   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot
+   * remove an RPC endpoint that is being represented by the currently selected
+   * network client. This option allows you to specify another RPC endpoint
+   * (either an existing one or a new one) that should be used to select a new
+   * network instead.
+   * @returns The updated network configuration.
+   * @throws if `chainId` does not refer to an existing network configuration,
+   * if any part of `fields` would produce invalid state, etc.
+   * @see {@link NetworkConfiguration}
+   */
+<span class="fstat-no" title="function not covered" >  async </span>updateNetwork(
+    chainId: Hex,
+    fields: UpdateNetworkFields,
+    {
+      replacementSelectedRpcEndpointIndex,
+    }: { replacementSelectedRpcEndpointIndex?: number } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;NetworkConfiguration&gt; {
+    const existingNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.state.networkConfigurationsByChainId[chainId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (existingNetworkConfiguration === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `Could not update network: Cannot find network configuration for chain '${chainId}'`,
+      );
+    }
+&nbsp;
+    const existingChainId = <span class="cstat-no" title="statement not covered" >chainId;</span>
+    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =
+<span class="cstat-no" title="statement not covered" >      fields;</span>
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#validateNetworkFields({</span>
+      mode: 'update',
+      networkFields: fields,
+      existingNetworkConfiguration,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+    const networkClientOperations: NetworkClientOperation[] = <span class="cstat-no" title="statement not covered" >[];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {</span>
+      const existingRpcEndpointForNoop =
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration.rpcEndpoints.find(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            rpcEndpoint.type === newRpcEndpointFields.type &amp;&amp;
+            rpcEndpoint.url === newRpcEndpointFields.url &amp;&amp;
+            (rpcEndpoint.networkClientId ===
+              newRpcEndpointFields.networkClientId ||
+              newRpcEndpointFields.networkClientId === undefined)
+          );
+        });
+      const existingRpcEndpointForReplaceWhenChainChanged =
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration.rpcEndpoints.find(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            (rpcEndpoint.type === RpcEndpointType.Infura &amp;&amp;
+              newRpcEndpointFields.type === RpcEndpointType.Infura) ||
+            (rpcEndpoint.type === newRpcEndpointFields.type &amp;&amp;
+              rpcEndpoint.networkClientId ===
+                newRpcEndpointFields.networkClientId &amp;&amp;
+              rpcEndpoint.url === newRpcEndpointFields.url)
+          );
+        });
+      const existingRpcEndpointForReplaceWhenChainNotChanged =
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration.rpcEndpoints.find(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            rpcEndpoint.type === newRpcEndpointFields.type &amp;&amp;
+            (rpcEndpoint.url === newRpcEndpointFields.url ||
+              rpcEndpoint.networkClientId ===
+                newRpcEndpointFields.networkClientId)
+          );
+        });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      if (</span>
+        newChainId !== existingChainId &amp;&amp;
+        existingRpcEndpointForReplaceWhenChainChanged !== undefined
+      ) {
+        const newRpcEndpoint =
+<span class="cstat-no" title="statement not covered" >          newRpcEndpointFields.type === RpcEndpointType.Infura</span>
+            ? newRpcEndpointFields
+            : { ...newRpcEndpointFields, networkClientId: uuidV4() };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push({</span>
+          type: 'replace' as const,
+          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,
+          newRpcEndpoint,
+        });
+      } else <span class="cstat-no" title="statement not covered" >if (existingRpcEndpointForNoop !== undefined) {</span>
+        let newRpcEndpoint;
+<span class="cstat-no" title="statement not covered" >        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {</span>
+<span class="cstat-no" title="statement not covered" >          newRpcEndpoint = existingRpcEndpointForNoop;</span>
+        } else {
+          // `networkClientId` shouldn't be missing at this point; if it is,
+          // that's a mistake, so fill it back in
+<span class="cstat-no" title="statement not covered" >          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {</span>
+            networkClientId: existingRpcEndpointForNoop.networkClientId,
+          });
+        }
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push({</span>
+          type: 'noop' as const,
+          rpcEndpoint: newRpcEndpoint,
+        });
+      } else <span class="cstat-no" title="statement not covered" >if (</span>
+        existingRpcEndpointForReplaceWhenChainNotChanged === undefined
+      ) {
+        const newRpcEndpoint =
+<span class="cstat-no" title="statement not covered" >          newRpcEndpointFields.type === RpcEndpointType.Infura</span>
+            ? newRpcEndpointFields
+            : { ...newRpcEndpointFields, networkClientId: uuidV4() };
+        const networkClientOperation = <span class="cstat-no" title="statement not covered" >{</span>
+          type: 'add' as const,
+          rpcEndpoint: newRpcEndpoint,
+        };
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push(networkClientOperation);</span>
+      } else {
+        let newRpcEndpoint;
+        /* istanbul ignore if */
+<span class="cstat-no" title="statement not covered" >        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {</span>
+          // This case can't actually happen. If we're here, it means that some
+          // part of the RPC endpoint changed. But there is no part of an Infura
+          // RPC endpoint that can be changed (as it would immediately make that
+          // RPC endpoint self-inconsistent). This is just here to appease
+          // TypeScript.
+          newRpcEndpoint = newRpcEndpointFields;
+        } else <span class="missing-if-branch" title="if path not taken" >I</span>{
+<span class="cstat-no" title="statement not covered" >          newRpcEndpoint = {</span>
+            ...newRpcEndpointFields,
+            networkClientId: uuidV4(),
+          };
+        }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push({</span>
+          type: 'replace' as const,
+          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,
+          newRpcEndpoint,
+        });
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        !networkClientOperations.some(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; {
+          const otherRpcEndpoint =
+<span class="cstat-no" title="statement not covered" >            networkClientOperation.type === 'replace'</span>
+              ? networkClientOperation.oldRpcEndpoint
+              : networkClientOperation.rpcEndpoint;
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            otherRpcEndpoint.type === existingRpcEndpoint.type &amp;&amp;
+            otherRpcEndpoint.networkClientId ===
+              existingRpcEndpoint.networkClientId &amp;&amp;
+            otherRpcEndpoint.url === existingRpcEndpoint.url
+          );
+        })
+      ) {
+        const networkClientOperation = <span class="cstat-no" title="statement not covered" >{</span>
+          type: 'remove' as const,
+          rpcEndpoint: existingRpcEndpoint,
+        };
+<span class="cstat-no" title="statement not covered" >        networkClientOperations.push(networkClientOperation);</span>
+      }
+    }
+&nbsp;
+    const updatedNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.#determineNetworkConfigurationToPersist({</span>
+        networkFields: fields,
+        networkClientOperations,
+      });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      replacementSelectedRpcEndpointIndex === undefined &amp;&amp;
+      networkClientOperations.some(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          networkClientOperation.type === 'remove' &amp;&amp;
+          networkClientOperation.rpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      }) &amp;&amp;
+      !networkClientOperations.some(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          networkClientOperation.type === 'replace' &amp;&amp;
+          networkClientOperation.oldRpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      })
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \`replacementSelectedRpcEndpointIndex\` option.`,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#registerNetworkClientsAsNeeded({</span>
+      networkFields: fields,
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+    const replacementSelectedRpcEndpointWithIndex = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .map(
+<span class="fstat-no" title="function not covered" >        (n</span>etworkClientOperation, index) =&gt;
+<span class="cstat-no" title="statement not covered" >          [networkClientOperation, index] as const,</span>
+      )
+      .find(<span class="fstat-no" title="function not covered" >([</span>networkClientOperation, _index]) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          networkClientOperation.type === 'replace' &amp;&amp;
+          networkClientOperation.oldRpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      });
+    const correctedReplacementSelectedRpcEndpointIndex =
+<span class="cstat-no" title="statement not covered" >      replacementSelectedRpcEndpointIndex ??</span>
+      replacementSelectedRpcEndpointWithIndex?.[1];
+&nbsp;
+    let rpcEndpointToSelect: RpcEndpoint | undefined;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      rpcEndpointToSelect =</span>
+        updatedNetworkConfiguration.rpcEndpoints[
+          correctedReplacementSelectedRpcEndpointIndex
+        ];
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (rpcEndpointToSelect === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `Could not update network: \`replacementSelectedRpcEndpointIndex\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \`rpcEndpoints\``,
+        );
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (</span>
+      rpcEndpointToSelect &amp;&amp;
+      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId
+    ) {
+<span class="cstat-no" title="statement not covered" >      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {</span>
+        updateState: <span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {
+<span class="cstat-no" title="statement not covered" >          this.#updateNetworkConfigurations({</span>
+            state,
+            mode: 'update',
+            networkFields: fields,
+            networkConfigurationToPersist: updatedNetworkConfiguration,
+            existingNetworkConfiguration,
+          });
+        },
+      });
+    } else {
+<span class="cstat-no" title="statement not covered" >      this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        this.#updateNetworkConfigurations({</span>
+          state,
+          mode: 'update',
+          networkFields: fields,
+          networkConfigurationToPersist: updatedNetworkConfiguration,
+          existingNetworkConfiguration,
+        });
+      });
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#unregisterNetworkClientsAsNeeded({</span>
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return updatedNetworkConfiguration;</span>
+  }
+&nbsp;
+  /**
+   * Destroys and unregisters the network identified by the given chain ID, also
+   * removing the associated network configuration from state.
+   *
+   * @param chainId - The chain ID associated with an existing network.
+   * @throws if `chainId` does not refer to an existing network configuration,
+   * or if the currently selected network is being removed.
+   * @see {@link NetworkConfiguration}
+   */
+<span class="fstat-no" title="function not covered" >  removeNetwork(</span>chainId: Hex): void {
+    const existingNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.state.networkConfigurationsByChainId[chainId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (existingNetworkConfiguration === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `Cannot find network configuration for chain '${chainId}'`,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      existingNetworkConfiguration.rpcEndpoints.some(
+<span class="fstat-no" title="function not covered" >        (r</span>pcEndpoint) =&gt;
+<span class="cstat-no" title="statement not covered" >          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,</span>
+      )
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(`Cannot remove the currently selected network`);</span>
+    }
+&nbsp;
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+    const networkClientOperations =
+<span class="cstat-no" title="statement not covered" >      existingNetworkConfiguration.rpcEndpoints.map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        return {</span>
+          type: 'remove' as const,
+          rpcEndpoint,
+        };
+      });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#unregisterNetworkClientsAsNeeded({</span>
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      this.#updateNetworkConfigurations({</span>
+        state,
+        mode: 'remove',
+        existingNetworkConfiguration,
+      });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >        delete state.networksMetadata[rpcEndpoint.networkClientId];</span>
+      }
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.messenger.publish(</span>
+      'NetworkController:networkRemoved',
+      existingNetworkConfiguration,
+    );
+  }
+&nbsp;
+  /**
+   * Assuming that the network has been previously switched, switches to this
+   * new network.
+   *
+   * If the network has not been previously switched, this method is equivalent
+   * to {@link resetConnection}.
+   */
+<span class="fstat-no" title="function not covered" >  async </span>rollbackToPreviousProvider(): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);</span>
+  }
+&nbsp;
+  /**
+   * Deactivates the controller, stopping any ongoing polling.
+   *
+   * In-progress requests will not be aborted.
+   */
+  // We're intentionally changing the signature of an extended method.
+  // eslint-disable-next-line @typescript-eslint/no-misused-promises
+<span class="fstat-no" title="function not covered" >  async </span>destroy(): Promise&lt;void&gt; {
+<span class="cstat-no" title="statement not covered" >    await this.#blockTrackerProxy?.destroy();</span>
+  }
+&nbsp;
+  /**
+   * Merges the given backup data into controller state.
+   *
+   * @param backup - The data that has been backed up.
+   * @param backup.networkConfigurationsByChainId - Network configurations,
+   * keyed by chain ID.
+   */
+<span class="fstat-no" title="function not covered" >  loadBackup(</span>{
+    networkConfigurationsByChainId,
+  }: Pick&lt;NetworkState, 'networkConfigurationsByChainId'&gt;): void {
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      state.networkConfigurationsByChainId = {</span>
+        ...state.networkConfigurationsByChainId,
+        ...networkConfigurationsByChainId,
+      };
+    });
+  }
+&nbsp;
+  /**
+   * Searches for the default RPC endpoint configured for the given chain and
+   * returns its network client ID. This can then be passed to
+   * {@link getNetworkClientById} to retrieve the network client.
+   *
+   * @param chainId - Chain ID to search for.
+   * @returns The ID of the network client created for the chain's default RPC
+   * endpoint.
+   */
+<span class="fstat-no" title="function not covered" >  findNetworkClientIdByChainId(</span>chainId: Hex): NetworkClientId {
+    const networkConfiguration =
+<span class="cstat-no" title="statement not covered" >      this.state.networkConfigurationsByChainId[chainId];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!networkConfiguration) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(`Invalid chain ID "${chainId}"`);</span>
+    }
+&nbsp;
+    const { networkClientId } =
+<span class="cstat-no" title="statement not covered" >      networkConfiguration.rpcEndpoints[</span>
+        networkConfiguration.defaultRpcEndpointIndex
+      ];
+<span class="cstat-no" title="statement not covered" >    return networkClientId;</span>
+  }
+&nbsp;
+  /**
+   * Ensure that the given fields which will be used to either add or update a
+   * network are valid.
+   *
+   * @param args - The arguments.
+   */
+  #validateNetworkFields(
+    args: {
+      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+    } &amp; (
+      | {
+          mode: 'add';
+          networkFields: AddNetworkFields;
+        }
+      | {
+          mode: 'update';
+          existingNetworkConfiguration: NetworkConfiguration;
+          networkFields: UpdateNetworkFields;
+        }
+    ),
+  ): void {
+    const { mode, networkFields, autoManagedNetworkClientRegistry } = <span class="cstat-no" title="statement not covered" >args;</span>
+    const existingNetworkConfiguration =
+<span class="cstat-no" title="statement not covered" >      'existingNetworkConfiguration' in args</span>
+        ? args.existingNetworkConfiguration
+        : null;
+&nbsp;
+    const errorMessagePrefix =
+<span class="cstat-no" title="statement not covered" >      mode === 'update' ? 'Could not update network' : 'Could not add network';</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      !isStrictHexString(networkFields.chainId) ||
+      !isSafeChainId(networkFields.chainId)
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: Invalid \`chainId\` '${networkFields.chainId}' (must start with "0x" and not exceed the maximum)`,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      existingNetworkConfiguration === null ||
+      networkFields.chainId !== existingNetworkConfiguration.chainId
+    ) {
+      const existingNetworkConfigurationViaChainId =
+<span class="cstat-no" title="statement not covered" >        this.state.networkConfigurationsByChainId[networkFields.chainId];</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (existingNetworkConfigurationViaChainId !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        if (existingNetworkConfiguration === null) {</span>
+<span class="cstat-no" title="statement not covered" >          throw new Error(</span>
+            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,
+          );
+        } else {
+<span class="cstat-no" title="statement not covered" >          throw new Error(</span>
+            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,
+          );
+        }
+      }
+    }
+&nbsp;
+    const isInvalidDefaultBlockExplorerUrlIndex =
+<span class="cstat-no" title="statement not covered" >      networkFields.blockExplorerUrls.length &gt; 0</span>
+        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||
+          networkFields.blockExplorerUrls[
+            networkFields.defaultBlockExplorerUrlIndex
+          ] === undefined
+        : networkFields.defaultBlockExplorerUrlIndex !== undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (isInvalidDefaultBlockExplorerUrlIndex) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: \`defaultBlockExplorerUrlIndex\` must refer to an entry in \`blockExplorerUrls\``,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkFields.rpcEndpoints.length === 0) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: \`rpcEndpoints\` must be a non-empty array`,
+      );
+    }
+<span class="cstat-no" title="statement not covered" >    for (const rpcEndpointFields of networkFields.rpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (!isValidUrl(rpcEndpointFields.url)) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: An entry in \`rpcEndpoints\` has invalid URL '${rpcEndpointFields.url}'`,
+        );
+      }
+      const networkClientId =
+<span class="cstat-no" title="statement not covered" >        'networkClientId' in rpcEndpointFields</span>
+          ? rpcEndpointFields.networkClientId
+          : undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        rpcEndpointFields.type === RpcEndpointType.Custom &amp;&amp;
+        networkClientId !== undefined &amp;&amp;
+        isInfuraNetworkType(networkClientId)
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,
+        );
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        mode === 'update' &amp;&amp;
+        networkClientId !== undefined &amp;&amp;
+        rpcEndpointFields.type === RpcEndpointType.Custom &amp;&amp;
+        !Object.values(autoManagedNetworkClientRegistry).some(
+<span class="fstat-no" title="function not covered" >          (n</span>etworkClientsById) =&gt; <span class="cstat-no" title="statement not covered" >networkClientId in networkClientsById,</span>
+        )
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,
+        );
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        networkFields.rpcEndpoints.some(
+<span class="fstat-no" title="function not covered" >          (o</span>therRpcEndpointFields) =&gt;
+<span class="cstat-no" title="statement not covered" >            otherRpcEndpointFields !== rpcEndpointFields &amp;&amp;</span>
+            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),
+        )
+      ) {
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,
+        );
+      }
+&nbsp;
+      const networkConfigurationsForOtherChains = <span class="cstat-no" title="statement not covered" >Object.values(</span>
+        this.state.networkConfigurationsByChainId,
+      ).filter(<span class="fstat-no" title="function not covered" >(n</span>etworkConfiguration) =&gt;
+<span class="cstat-no" title="statement not covered" >        existingNetworkConfiguration</span>
+          ? networkConfiguration.chainId !==
+            existingNetworkConfiguration.chainId
+          : true,
+      );
+<span class="cstat-no" title="statement not covered" >      for (const networkConfiguration of networkConfigurationsForOtherChains) {</span>
+        const rpcEndpoint = <span class="cstat-no" title="statement not covered" >networkConfiguration.rpcEndpoints.find(</span>
+<span class="fstat-no" title="function not covered" >          (e</span>xistingRpcEndpoint) =&gt;
+<span class="cstat-no" title="statement not covered" >            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),</span>
+        );
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (rpcEndpoint) {</span>
+<span class="cstat-no" title="statement not covered" >          if (mode === 'update') {</span>
+<span class="cstat-no" title="statement not covered" >            throw new Error(</span>
+              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,
+            );
+          } else {
+<span class="cstat-no" title="statement not covered" >            throw new Error(</span>
+              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,
+            );
+          }
+        }
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      [...new Set(networkFields.rpcEndpoints)].length &lt;
+      networkFields.rpcEndpoints.length
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,
+      );
+    }
+&nbsp;
+    const networkClientIds = <span class="cstat-no" title="statement not covered" >networkFields.rpcEndpoints</span>
+      .map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt;
+<span class="cstat-no" title="statement not covered" >        'networkClientId' in rpcEndpoint</span>
+          ? rpcEndpoint.networkClientId
+          : undefined,
+      )
+      .filter(
+<span class="fstat-no" title="function not covered" >        (n</span>etworkClientId): networkClientId is NetworkClientId =&gt;
+<span class="cstat-no" title="statement not covered" >          networkClientId !== undefined,</span>
+      );
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if ([...new Set(networkClientIds)].length &lt; networkClientIds.length) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,
+      );
+    }
+&nbsp;
+    const infuraRpcEndpoints = <span class="cstat-no" title="statement not covered" >networkFields.rpcEndpoints.filter(</span>
+<span class="fstat-no" title="function not covered" >      (r</span>pcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =&gt;
+<span class="cstat-no" title="statement not covered" >        rpcEndpointFields.type === RpcEndpointType.Infura,</span>
+    );
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (infuraRpcEndpoints.length &gt; 1) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,
+      );
+    }
+&nbsp;
+    const soleInfuraRpcEndpoint = <span class="cstat-no" title="statement not covered" >infuraRpcEndpoints[0];</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (soleInfuraRpcEndpoint) {</span>
+      const infuraNetworkName = <span class="cstat-no" title="statement not covered" >deriveInfuraNetworkNameFromRpcEndpointUrl(</span>
+        soleInfuraRpcEndpoint.url,
+      );
+      const infuraNetworkNickname = <span class="cstat-no" title="statement not covered" >NetworkNickname[infuraNetworkName];</span>
+      const infuraChainId = <span class="cstat-no" title="statement not covered" >ChainId[infuraNetworkName];</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (networkFields.chainId !== infuraChainId) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(</span>
+          mode === 'add'
+            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`
+            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,
+        );
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===
+      undefined
+    ) {
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        `${errorMessagePrefix}: \`defaultRpcEndpointIndex\` must refer to an entry in \`rpcEndpoints\``,
+      );
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Constructs a network configuration that will be persisted to state when
+   * adding or updating a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkFields - The fields used to add or update a network.
+   * @param args.networkClientOperations - Operations which were calculated for
+   * updating the network client registry but which also map back to RPC
+   * endpoints (and so can be used to save those RPC endpoints).
+   * @returns The network configuration to persist.
+   */
+  #determineNetworkConfigurationToPersist({
+    networkFields,
+    networkClientOperations,
+  }: {
+    networkFields: AddNetworkFields | UpdateNetworkFields;
+    networkClientOperations: NetworkClientOperation[];
+  }): NetworkConfiguration {
+    const rpcEndpointsToPersist = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .filter(
+<span class="fstat-no" title="function not covered" >        (</span>
+          networkClientOperation,
+        ): networkClientOperation is
+          | AddNetworkClientOperation
+          | NoopNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >          return (</span>
+            networkClientOperation.type === 'add' ||
+            networkClientOperation.type === 'noop'
+          );
+        },
+      )
+      .map(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.rpcEndpoint)</span>
+      .concat(
+        networkClientOperations
+          .filter(
+<span class="fstat-no" title="function not covered" >            (</span>
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >              return networkClientOperation.type === 'replace';</span>
+            },
+          )
+          .map(
+<span class="fstat-no" title="function not covered" >            (n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.newRpcEndpoint,</span>
+          ),
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };</span>
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Creates and registers network clients using the given operations calculated
+   * as a part of adding or updating a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkFields - The fields used to add or update a network.
+   * @param args.networkClientOperations - Dictate which network clients need to
+   * be created.
+   * @param args.autoManagedNetworkClientRegistry - The network client registry
+   * to update.
+   */
+  #registerNetworkClientsAsNeeded({
+    networkFields,
+    networkClientOperations,
+    autoManagedNetworkClientRegistry,
+  }: {
+    networkFields: AddNetworkFields | UpdateNetworkFields;
+    networkClientOperations: NetworkClientOperation[];
+    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+  }): void {
+    const addedRpcEndpoints = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .filter(
+<span class="fstat-no" title="function not covered" >        (</span>
+          networkClientOperation,
+        ): networkClientOperation is AddNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >          return networkClientOperation.type === 'add';</span>
+        },
+      )
+      .map(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.rpcEndpoint)</span>
+      .concat(
+        networkClientOperations
+          .filter(
+<span class="fstat-no" title="function not covered" >            (</span>
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >              return networkClientOperation.type === 'replace';</span>
+            },
+          )
+          .map(
+<span class="fstat-no" title="function not covered" >            (n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.newRpcEndpoint,</span>
+          ),
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const addedRpcEndpoint of addedRpcEndpoints) {</span>
+<span class="cstat-no" title="statement not covered" >      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {</span>
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Infura][</span>
+          addedRpcEndpoint.networkClientId
+        ] = createAutoManagedNetworkClient({
+          networkClientId: addedRpcEndpoint.networkClientId,
+          networkClientConfiguration: {
+            type: NetworkClientType.Infura,
+            chainId: networkFields.chainId,
+            network: addedRpcEndpoint.networkClientId,
+            failoverRpcUrls: addedRpcEndpoint.failoverUrls,
+            infuraProjectId: this.#infuraProjectId,
+            ticker: networkFields.nativeCurrency,
+          },
+          getRpcServiceOptions: this.#getRpcServiceOptions,
+          getBlockTrackerOptions: this.#getBlockTrackerOptions,
+          messenger: this.messenger,
+          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+          logger: this.#log,
+        });
+      } else {
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Custom][</span>
+          addedRpcEndpoint.networkClientId
+        ] = createAutoManagedNetworkClient({
+          networkClientId: addedRpcEndpoint.networkClientId,
+          networkClientConfiguration: {
+            type: NetworkClientType.Custom,
+            chainId: networkFields.chainId,
+            failoverRpcUrls: addedRpcEndpoint.failoverUrls,
+            rpcUrl: addedRpcEndpoint.url,
+            ticker: networkFields.nativeCurrency,
+          },
+          getRpcServiceOptions: this.#getRpcServiceOptions,
+          getBlockTrackerOptions: this.#getBlockTrackerOptions,
+          messenger: this.messenger,
+          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+          logger: this.#log,
+        });
+      }
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Destroys and removes network clients using the given operations calculated
+   * as a part of updating or removing a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkClientOperations - Dictate which network clients to
+   * remove.
+   * @param args.autoManagedNetworkClientRegistry - The network client registry
+   * to update.
+   */
+  #unregisterNetworkClientsAsNeeded({
+    networkClientOperations,
+    autoManagedNetworkClientRegistry,
+  }: {
+    networkClientOperations: NetworkClientOperation[];
+    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+  }): void {
+    const removedRpcEndpoints = <span class="cstat-no" title="statement not covered" >networkClientOperations</span>
+      .filter(
+<span class="fstat-no" title="function not covered" >        (</span>
+          networkClientOperation,
+        ): networkClientOperation is RemoveNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >          return networkClientOperation.type === 'remove';</span>
+        },
+      )
+      .map(<span class="fstat-no" title="function not covered" >(n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.rpcEndpoint)</span>
+      .concat(
+        networkClientOperations
+          .filter(
+<span class="fstat-no" title="function not covered" >            (</span>
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation =&gt; {
+<span class="cstat-no" title="statement not covered" >              return networkClientOperation.type === 'replace';</span>
+            },
+          )
+          .map(
+<span class="fstat-no" title="function not covered" >            (n</span>etworkClientOperation) =&gt; <span class="cstat-no" title="statement not covered" >networkClientOperation.oldRpcEndpoint,</span>
+          ),
+      );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const rpcEndpoint of removedRpcEndpoints) {</span>
+      const networkClient = <span class="cstat-no" title="statement not covered" >this.getNetworkClientById(</span>
+        rpcEndpoint.networkClientId,
+      );
+<span class="cstat-no" title="statement not covered" >      networkClient.destroy();</span>
+<span class="cstat-no" title="statement not covered" >      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][</span>
+        rpcEndpoint.networkClientId
+      ];
+    }
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Updates `networkConfigurationsByChainId` in state depending on whether a
+   * network is being added, updated, or removed.
+   *
+   * - The existing network configuration will be removed when a network is
+   * being filed under a different chain or removed.
+   * - A network configuration will be stored when a network is being added or
+   * when a network is being updated.
+   *
+   * @param args - The arguments to this function.
+   */
+  #updateNetworkConfigurations(
+    args: { state: Draft&lt;NetworkState&gt; } &amp; (
+      | {
+          mode: 'add';
+          networkFields: AddNetworkFields;
+          networkConfigurationToPersist: NetworkConfiguration;
+        }
+      | {
+          mode: 'update';
+          networkFields: UpdateNetworkFields;
+          networkConfigurationToPersist: NetworkConfiguration;
+          existingNetworkConfiguration: NetworkConfiguration;
+        }
+      | {
+          mode: 'remove';
+          existingNetworkConfiguration: NetworkConfiguration;
+        }
+    ),
+  ): void {
+    const { state, mode } = <span class="cstat-no" title="statement not covered" >args;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+      mode === 'remove' ||
+      (mode === 'update' &amp;&amp;
+        args.networkFields.chainId !==
+          args.existingNetworkConfiguration.chainId)
+    ) {
+<span class="cstat-no" title="statement not covered" >      delete state.networkConfigurationsByChainId[</span>
+        args.existingNetworkConfiguration.chainId
+      ];
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (mode === 'add' || mode === 'update') {</span>
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+        !deepEqual(
+          state.networkConfigurationsByChainId[args.networkFields.chainId],
+          args.networkConfigurationToPersist,
+        )
+      ) {
+<span class="cstat-no" title="statement not covered" >        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();</span>
+      }
+<span class="cstat-no" title="statement not covered" >      state.networkConfigurationsByChainId[args.networkFields.chainId] =</span>
+        args.networkConfigurationToPersist;
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#networkConfigurationsByNetworkClientId =</span>
+      buildNetworkConfigurationsByNetworkClientId(
+        cloneDeep(state.networkConfigurationsByChainId),
+      );
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Before accessing or switching the network, the registry of network clients
+   * needs to be populated. Otherwise, `#applyNetworkSelection` and
+   * `getNetworkClientRegistry` will throw an error. This method checks to see if the
+   * population step has happened yet, and if not, makes it happen.
+   *
+   * @returns The populated network client registry.
+   */
+  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {
+<span class="cstat-no" title="statement not covered" >    return (this.#autoManagedNetworkClientRegistry ??=</span>
+      this.#createAutoManagedNetworkClientRegistry());
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Constructs the registry of network clients based on the set of default
+   * and custom networks in state.
+   *
+   * @returns The network clients keyed by ID.
+   */
+  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {
+    const chainIds = <span class="cstat-no" title="statement not covered" >knownKeysOf(this.state.networkConfigurationsByChainId);</span>
+    const networkClientsWithIds = <span class="cstat-no" title="statement not covered" >chainIds.flatMap(<span class="fstat-no" title="function not covered" >(c</span>hainId) =&gt; {</span>
+      const networkConfiguration =
+<span class="cstat-no" title="statement not covered" >        this.state.networkConfigurationsByChainId[chainId];</span>
+<span class="cstat-no" title="statement not covered" >      return networkConfiguration.rpcEndpoints.map(<span class="fstat-no" title="function not covered" >(r</span>pcEndpoint) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (rpcEndpoint.type === RpcEndpointType.Infura) {</span>
+          const infuraNetworkName = <span class="cstat-no" title="statement not covered" >deriveInfuraNetworkNameFromRpcEndpointUrl(</span>
+            rpcEndpoint.url,
+          );
+<span class="cstat-no" title="statement not covered" >          return [</span>
+            rpcEndpoint.networkClientId,
+            createAutoManagedNetworkClient({
+              networkClientId: rpcEndpoint.networkClientId,
+              networkClientConfiguration: {
+                type: NetworkClientType.Infura,
+                network: infuraNetworkName,
+                failoverRpcUrls: rpcEndpoint.failoverUrls,
+                infuraProjectId: this.#infuraProjectId,
+                chainId: networkConfiguration.chainId,
+                ticker: networkConfiguration.nativeCurrency,
+              },
+              getRpcServiceOptions: this.#getRpcServiceOptions,
+              getBlockTrackerOptions: this.#getBlockTrackerOptions,
+              messenger: this.messenger,
+              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+              logger: this.#log,
+            }),
+          ] as const;
+        }
+<span class="cstat-no" title="statement not covered" >        return [</span>
+          rpcEndpoint.networkClientId,
+          createAutoManagedNetworkClient({
+            networkClientId: rpcEndpoint.networkClientId,
+            networkClientConfiguration: {
+              type: NetworkClientType.Custom,
+              chainId: networkConfiguration.chainId,
+              failoverRpcUrls: rpcEndpoint.failoverUrls,
+              rpcUrl: rpcEndpoint.url,
+              ticker: networkConfiguration.nativeCurrency,
+            },
+            getRpcServiceOptions: this.#getRpcServiceOptions,
+            getBlockTrackerOptions: this.#getBlockTrackerOptions,
+            messenger: this.messenger,
+            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+            logger: this.#log,
+          }),
+        ] as const;
+      });
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return networkClientsWithIds.reduce(</span>
+<span class="fstat-no" title="function not covered" >      (</span>
+        obj: {
+          [NetworkClientType.Custom]: Partial&lt;AutoManagedCustomNetworkClientRegistry&gt;;
+          [NetworkClientType.Infura]: Partial&lt;AutoManagedBuiltInNetworkClientRegistry&gt;;
+        },
+        [networkClientId, networkClient],
+      ) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return {</span>
+          ...obj,
+          [networkClient.configuration.type]: {
+            ...obj[networkClient.configuration.type],
+            [networkClientId]: networkClient,
+          },
+        };
+      },
+      {
+        [NetworkClientType.Custom]: {},
+        [NetworkClientType.Infura]: {},
+      },
+    ) as AutoManagedNetworkClientRegistry;
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Updates the global provider and block tracker proxies (accessible via
+   * {@link getSelectedNetworkClient}) to point to the same ones within the
+   * given network client, thereby magically switching any consumers using these
+   * proxies to use the new network.
+   *
+   * Also refreshes the EthQuery instance accessible via the `getEthQuery`
+   * action to wrap the provider from the new network client. Note that this is
+   * not a proxy, so consumers will need to call `getEthQuery` again after the
+   * network switch.
+   *
+   * @param networkClientId - The ID of a network client that requests will be
+   * routed through (either the name of an Infura network or the ID of a custom
+   * network configuration).
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   * @throws if no network client could be found matching the given ID.
+   */
+  #applyNetworkSelection(
+    networkClientId: string,
+    {
+      updateState,
+    }: {
+      updateState?: (state: Draft&lt;NetworkState&gt;) =&gt; void;
+    } = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): void {
+    const autoManagedNetworkClientRegistry =
+<span class="cstat-no" title="statement not covered" >      this.#ensureAutoManagedNetworkClientRegistryPopulated(</span>);
+&nbsp;
+    let autoManagedNetworkClient:
+      | AutoManagedNetworkClient&lt;CustomNetworkClientConfiguration&gt;
+      | AutoManagedNetworkClient&lt;InfuraNetworkClientConfiguration&gt;;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (isInfuraNetworkType(networkClientId)) {</span>
+      const possibleAutoManagedNetworkClient =
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Infura][</span>
+          networkClientId
+        ];
+&nbsp;
+      // This is impossible to reach
+      /* istanbul ignore if */
+<span class="cstat-no" title="statement not covered" >      if (!possibleAutoManagedNetworkClient) {</span>
+        throw new Error(
+          `No Infura network client found with ID '${networkClientId}'`,
+        );
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      autoManagedNetworkClient = possibleAutoManagedNetworkClient;</span>
+    } else {
+      const possibleAutoManagedNetworkClient =
+<span class="cstat-no" title="statement not covered" >        autoManagedNetworkClientRegistry[NetworkClientType.Custom][</span>
+          networkClientId
+        ];
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (!possibleAutoManagedNetworkClient) {</span>
+<span class="cstat-no" title="statement not covered" >        throw new Error(`No network client found with ID '${networkClientId}'`);</span>
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      autoManagedNetworkClient = possibleAutoManagedNetworkClient;</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#autoManagedNetworkClient = autoManagedNetworkClient;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.update(<span class="fstat-no" title="function not covered" >(s</span>tate) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      state.selectedNetworkClientId = networkClientId;</span>
+<span class="cstat-no" title="statement not covered" >      state.networksMetadata[networkClientId] ??= {</span>
+        status: NetworkStatus.Unknown,
+        EIPS: {},
+      };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      updateState?.(state);</span>
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (this.#providerProxy) {</span>
+<span class="cstat-no" title="statement not covered" >      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);</span>
+    } else {
+<span class="cstat-no" title="statement not covered" >      this.#providerProxy = createSwappableProxy(</span>
+        this.#autoManagedNetworkClient.provider,
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    if (this.#blockTrackerProxy) {</span>
+<span class="cstat-no" title="statement not covered" >      this.#blockTrackerProxy.setTarget(</span>
+        this.#autoManagedNetworkClient.blockTracker,
+      );
+    } else {
+<span class="cstat-no" title="statement not covered" >      this.#blockTrackerProxy = createEventEmitterProxy(</span>
+        this.#autoManagedNetworkClient.blockTracker,
+        {
+          eventFilter: 'skipInternal',
+        },
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#ethQuery = new EthQuery(this.#providerProxy);</span>
+  }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/constants.ts.html b/coverage/src/constants.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..9e9faf347bbe3419fe598aab473ca0f9583767e6
--- /dev/null
+++ b/coverage/src/constants.ts.html
@@ -0,0 +1,214 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/constants.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> constants.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/8</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/2</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/1</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/8</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
+ * Represents the availability status of an RPC endpoint. (Regrettably, the
+ * name of this type is a misnomer.)
+ *
+ * The availability status is set both automatically (as requests are made) and
+ * manually (when `lookupNetwork` is called).
+ */
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export enum N</span>etworkStatus {</span>
+  /**
+   * Either the availability status of the RPC endpoint has not been determined,
+   * or request that `lookupNetwork` performed returned an unknown error.
+   */
+<span class="cstat-no" title="statement not covered" >  Unknown = 'unknown',</span>
+  /**
+   * The RPC endpoint is consistently returning successful (2xx) responses.
+   */
+<span class="cstat-no" title="statement not covered" >  Available = 'available',</span>
+  /**
+   * Either the last request to the RPC endpoint was either too slow, or the
+   * endpoint is consistently returning errors and the number of retries has
+   * been reached.
+   */
+<span class="cstat-no" title="statement not covered" >  Degraded = 'degraded',</span>
+  /**
+   * The RPC endpoint is consistently returning enough 5xx errors that requests
+   * have been paused.
+   */
+<span class="cstat-no" title="statement not covered" >  Unavailable = 'unavailable',</span>
+  /**
+   * The RPC endpoint is inaccessible for the user based on their location. This
+   * status only applies to Infura networks.
+   */
+<span class="cstat-no" title="statement not covered" >  Blocked = 'blocked',</span>
+}
+&nbsp;
+export const <span class="cstat-no" title="statement not covered" >INFURA_BLOCKED_KEY = 'countryBlocked';</span>
+&nbsp;
+/**
+ * A set of deprecated network ChainId.
+ * The network controller will exclude those the networks begin as default network,
+ * without the need to remove the network from constant list of controller-utils.
+ */
+export const <span class="cstat-no" title="statement not covered" >DEPRECATED_NETWORKS = new Set&lt;string&gt;(['0xe704', '0x5']);</span>
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/create-auto-managed-network-client.ts.html b/coverage/src/create-auto-managed-network-client.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..e4f319b319466b80461f3364fbc705e284aa097c
--- /dev/null
+++ b/coverage/src/create-auto-managed-network-client.ts.html
@@ -0,0 +1,856 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/create-auto-managed-network-client.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> create-auto-managed-network-client.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/52</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/16</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/12</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/52</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+import { Json } from '@metamask/utils';
+import type { Logger } from 'loglevel';
+&nbsp;
+import type { NetworkClient } from './create-network-client';
+<span class="cstat-no" title="statement not covered" >import { createNetworkClient } from './create-network-client';</span>
+import type {
+  NetworkClientId,
+  NetworkControllerMessenger,
+} from './NetworkController';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+import type {
+  BlockTracker,
+  NetworkClientConfiguration,
+  Provider,
+} from './types';
+&nbsp;
+/**
+ * The name of the method on both the provider and block tracker proxy which can
+ * be used to get the underlying provider or block tracker from the network
+ * client, when it is initialized.
+ */
+const REFLECTIVE_PROPERTY_NAME = <span class="cstat-no" title="statement not covered" >'__target__';</span>
+&nbsp;
+/**
+ * Represents a proxy object which wraps a target object. As a proxy, it allows
+ * for accessing and setting all of the properties that the target object
+ * supports, but also supports an extra propertyName (`__target__`) to access
+ * the target itself.
+ *
+ * @template Type - The type of the target object. It is assumed that this type
+ * will be constant even when the target is swapped.
+ */
+export type ProxyWithAccessibleTarget&lt;TargetType&gt; = TargetType &amp; {
+  [REFLECTIVE_PROPERTY_NAME]: TargetType;
+};
+&nbsp;
+/**
+ * An object that provides the same interface as a network client but where the
+ * network client is not initialized until either the provider or block tracker
+ * is first accessed.
+ */
+export type AutoManagedNetworkClient&lt;
+  Configuration extends NetworkClientConfiguration,
+&gt; = {
+  configuration: Configuration;
+  provider: ProxyWithAccessibleTarget&lt;Provider&gt;;
+  blockTracker: ProxyWithAccessibleTarget&lt;BlockTracker&gt;;
+  destroy: () =&gt; void;
+  enableRpcFailover: () =&gt; void;
+  disableRpcFailover: () =&gt; void;
+};
+&nbsp;
+/**
+ * By default, the provider and block provider proxies will point to nothing.
+ * This is impossible when using the Proxy API, as the target object has to be
+ * something, so this object represents that "something".
+ */
+const UNINITIALIZED_TARGET = <span class="cstat-no" title="statement not covered" >{ __UNINITIALIZED__: true };</span>
+&nbsp;
+/**
+ * This function creates two proxies, one that wraps a provider and another that
+ * wraps a block tracker. These proxies are unique in that both will be "empty"
+ * at first; that is, neither will point to a functional provider or block
+ * tracker. Instead, as soon as a method or event is accessed on either object
+ * that requires a network request to function, a network client is created on
+ * the fly and the method or event in question is then forwarded to whichever
+ * part of the network client is serving as the receiver. The network client is
+ * then cached for subsequent usages.
+ *
+ * @param args - The arguments.
+ * @param args.networkClientId - The ID that will be assigned to the new network
+ * client in the registry.
+ * @param args.networkClientConfiguration - The configuration object that will be
+ * used to instantiate the network client when it is needed.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.getBlockTrackerOptions - Factory for constructing block tracker
+ * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The auto-managed network client.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >c</span>reateAutoManagedNetworkClient&lt;</span>
+  Configuration extends NetworkClientConfiguration,
+&gt;({
+  networkClientId,
+  networkClientConfiguration,
+  getRpcServiceOptions,
+  getBlockTrackerOptions = <span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >(): Omit&lt;</span></span>
+    PollingBlockTrackerOptions,
+    'provider'
+  &gt; =&gt; (<span class="cstat-no" title="statement not covered" >{})</span>,
+  messenger,
+  isRpcFailoverEnabled: givenIsRpcFailoverEnabled,
+  logger,
+}: {
+  networkClientId: NetworkClientId;
+  networkClientConfiguration: Configuration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  getBlockTrackerOptions?: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): AutoManagedNetworkClient&lt;Configuration&gt; {
+  let isRpcFailoverEnabled = <span class="cstat-no" title="statement not covered" >givenIsRpcFailoverEnabled;</span>
+  let networkClient: NetworkClient | undefined;
+&nbsp;
+  const ensureNetworkClientCreated = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): NetworkClient =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    networkClient ??= createNetworkClient({</span>
+      id: networkClientId,
+      configuration: networkClientConfiguration,
+      getRpcServiceOptions,
+      getBlockTrackerOptions,
+      messenger,
+      isRpcFailoverEnabled,
+      logger,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (networkClient === undefined) {</span>
+<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
+        "It looks like `createNetworkClient` didn't return anything. Perhaps it's being mocked?",
+      );
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return networkClient;</span>
+  };
+&nbsp;
+  const providerProxy = <span class="cstat-no" title="statement not covered" >new Proxy(UNINITIALIZED_TARGET, {</span>
+<span class="fstat-no" title="function not covered" >    get(</span>
+      _target: unknown,
+      propertyName: PropertyKey,
+      receiver: unknown,
+    ):
+      | Provider
+      | ((this: unknown, ...args: unknown[]) =&gt; Promise&lt;Json&gt; | undefined)
+      | undefined {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >        return networkClient?.provider;</span>
+      }
+&nbsp;
+      const { provider } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName in provider) {</span>
+        // Typecast: We know that `[propertyName]` is a propertyName on
+        // `provider`.
+        const value = <span class="cstat-no" title="statement not covered" >provider[propertyName as keyof typeof provider];</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof value === 'function') {</span>
+          // Ensure that the method on the provider is called with `this` as
+          // the target, *not* the proxy (which happens by default) â€”
+          // this allows private properties to be accessed
+<span class="cstat-no" title="statement not covered" >          return <span class="fstat-no" title="function not covered" >function (this: unknown, .</span>..args: unknown[]): Promise&lt;Json&gt; {</span>
+            // @ts-expect-error We don't care that `this` may not be compatible
+            // with the signature of the method being called, as technically
+            // it can be anything.
+<span class="cstat-no" title="statement not covered" >            return value.apply(this === receiver ? provider : this, args);</span>
+          };
+        }
+<span class="cstat-no" title="statement not covered" >        return value;</span>
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      return undefined;</span>
+    },
+&nbsp;
+    // TODO: Replace `any` with type
+    // eslint-disable-next-line @typescript-eslint/no-explicit-any
+<span class="fstat-no" title="function not covered" >    has(</span>_target: any, propertyName: PropertyKey): boolean {
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >        return true;</span>
+      }
+      const { provider } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+<span class="cstat-no" title="statement not covered" >      return propertyName in provider;</span>
+    },
+  });
+&nbsp;
+  const blockTrackerProxy: ProxyWithAccessibleTarget&lt;BlockTracker&gt; = <span class="cstat-no" title="statement not covered" >new Proxy(</span>
+    UNINITIALIZED_TARGET,
+    {
+<span class="fstat-no" title="function not covered" >      get(</span>
+        _target: unknown,
+        propertyName: PropertyKey,
+        receiver: unknown,
+      ):
+        | BlockTracker
+        | ((this: unknown, ...args: unknown[]) =&gt; unknown)
+        | undefined {
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >          return networkClient?.blockTracker;</span>
+        }
+&nbsp;
+        const { blockTracker } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName in blockTracker) {</span>
+          // Typecast: We know that `[propertyName]` is a propertyName on
+          // `provider`.
+          const value = <span class="cstat-no" title="statement not covered" >blockTracker[propertyName as keyof typeof blockTracker];</span>
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof value === 'function') {</span>
+            // Ensure that the method on the provider is called with `this` as
+            // the target, *not* the proxy (which happens by default) â€”
+            // this allows private properties to be accessed
+<span class="cstat-no" title="statement not covered" >            return <span class="fstat-no" title="function not covered" >function (this: unknown, .</span>..args: unknown[]) {</span>
+              // @ts-expect-error We don't care that `this` may not be
+              // compatible with the signature of the method being called, as
+              // technically it can be anything.
+<span class="cstat-no" title="statement not covered" >              return value.apply(this === receiver ? blockTracker : this, args);</span>
+            };
+          }
+<span class="cstat-no" title="statement not covered" >          return value;</span>
+        }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        return undefined;</span>
+      },
+&nbsp;
+      // TODO: Replace `any` with type
+      // eslint-disable-next-line @typescript-eslint/no-explicit-any
+<span class="fstat-no" title="function not covered" >      has(</span>_target: any, propertyName: PropertyKey): boolean {
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (propertyName === REFLECTIVE_PROPERTY_NAME) {</span>
+<span class="cstat-no" title="statement not covered" >          return true;</span>
+        }
+        const { blockTracker } = <span class="cstat-no" title="statement not covered" >ensureNetworkClientCreated();</span>
+<span class="cstat-no" title="statement not covered" >        return propertyName in blockTracker;</span>
+      },
+    },
+  );
+&nbsp;
+  const destroy = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    networkClient?.destroy();</span>
+  };
+&nbsp;
+  const enableRpcFailover = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    isRpcFailoverEnabled = true;</span>
+<span class="cstat-no" title="statement not covered" >    destroy();</span>
+<span class="cstat-no" title="statement not covered" >    networkClient = undefined;</span>
+  };
+&nbsp;
+  const disableRpcFailover = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    isRpcFailoverEnabled = false;</span>
+<span class="cstat-no" title="statement not covered" >    destroy();</span>
+<span class="cstat-no" title="statement not covered" >    networkClient = undefined;</span>
+  };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return {</span>
+    configuration: networkClientConfiguration,
+    provider: providerProxy,
+    blockTracker: blockTrackerProxy,
+    destroy,
+    enableRpcFailover,
+    disableRpcFailover,
+  };
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/create-network-client.ts.html b/coverage/src/create-network-client.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..f0dc56be60fdd5276d3b873e69c4755d14d3e1d2
--- /dev/null
+++ b/coverage/src/create-network-client.ts.html
@@ -0,0 +1,1648 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/create-network-client.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> create-network-client.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/74</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/23</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/20</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/73</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a>
+<a name='L483'></a><a href='#L483'>483</a>
+<a name='L484'></a><a href='#L484'>484</a>
+<a name='L485'></a><a href='#L485'>485</a>
+<a name='L486'></a><a href='#L486'>486</a>
+<a name='L487'></a><a href='#L487'>487</a>
+<a name='L488'></a><a href='#L488'>488</a>
+<a name='L489'></a><a href='#L489'>489</a>
+<a name='L490'></a><a href='#L490'>490</a>
+<a name='L491'></a><a href='#L491'>491</a>
+<a name='L492'></a><a href='#L492'>492</a>
+<a name='L493'></a><a href='#L493'>493</a>
+<a name='L494'></a><a href='#L494'>494</a>
+<a name='L495'></a><a href='#L495'>495</a>
+<a name='L496'></a><a href='#L496'>496</a>
+<a name='L497'></a><a href='#L497'>497</a>
+<a name='L498'></a><a href='#L498'>498</a>
+<a name='L499'></a><a href='#L499'>499</a>
+<a name='L500'></a><a href='#L500'>500</a>
+<a name='L501'></a><a href='#L501'>501</a>
+<a name='L502'></a><a href='#L502'>502</a>
+<a name='L503'></a><a href='#L503'>503</a>
+<a name='L504'></a><a href='#L504'>504</a>
+<a name='L505'></a><a href='#L505'>505</a>
+<a name='L506'></a><a href='#L506'>506</a>
+<a name='L507'></a><a href='#L507'>507</a>
+<a name='L508'></a><a href='#L508'>508</a>
+<a name='L509'></a><a href='#L509'>509</a>
+<a name='L510'></a><a href='#L510'>510</a>
+<a name='L511'></a><a href='#L511'>511</a>
+<a name='L512'></a><a href='#L512'>512</a>
+<a name='L513'></a><a href='#L513'>513</a>
+<a name='L514'></a><a href='#L514'>514</a>
+<a name='L515'></a><a href='#L515'>515</a>
+<a name='L516'></a><a href='#L516'>516</a>
+<a name='L517'></a><a href='#L517'>517</a>
+<a name='L518'></a><a href='#L518'>518</a>
+<a name='L519'></a><a href='#L519'>519</a>
+<a name='L520'></a><a href='#L520'>520</a>
+<a name='L521'></a><a href='#L521'>521</a>
+<a name='L522'></a><a href='#L522'>522</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type {
+  CockatielFailureReason,
+  InfuraNetworkType,
+} from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import { ChainId } from '@metamask/controller-utils';</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >import { createThrottledFetchForChainId } from './throttled-fetch';</span>
+&nbsp;
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+<span class="cstat-no" title="statement not covered" >import { PollingBlockTracker } from '@metamask/eth-block-tracker';</span>
+<span class="cstat-no" title="statement not covered" >import { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';</span>
+<span class="cstat-no" title="statement not covered" >import {</span>
+  createBlockCacheMiddleware,
+  createBlockRefMiddleware,
+  createBlockRefRewriteMiddleware,
+  createBlockTrackerInspectorMiddleware,
+  createInflightCacheMiddleware,
+  createFetchMiddleware,
+  createRetryOnEmptyMiddleware,
+} from '@metamask/eth-json-rpc-middleware';
+<span class="cstat-no" title="statement not covered" >import { InternalProvider } from '@metamask/eth-json-rpc-provider';</span>
+<span class="cstat-no" title="statement not covered" >import { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';</span>
+<span class="cstat-no" title="statement not covered" >import { asV2Middleware } from '@metamask/json-rpc-engine';</span>
+<span class="cstat-no" title="statement not covered" >import {</span>
+  createScaffoldMiddleware,
+  JsonRpcEngineV2,
+} from '@metamask/json-rpc-engine/v2';
+import type {
+  JsonRpcMiddleware,
+  MiddlewareContext,
+} from '@metamask/json-rpc-engine/v2';
+import type { Hex, Json, JsonRpcRequest } from '@metamask/utils';
+import type { Logger } from 'loglevel';
+&nbsp;
+import type {
+  NetworkClientId,
+  NetworkControllerMessenger,
+} from './NetworkController';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+<span class="cstat-no" title="statement not covered" >import { RpcServiceChain } from './rpc-service/rpc-service-chain';</span>
+import type {
+  BlockTracker,
+  NetworkClientConfiguration,
+  Provider,
+} from './types';
+<span class="cstat-no" title="statement not covered" >import { NetworkClientType } from './types';</span>
+&nbsp;
+const SECOND = <span class="cstat-no" title="statement not covered" >1000;</span>
+&nbsp;
+/**
+ * The pair of provider / block tracker that can be used to interface with the
+ * network and respond to new activity.
+ */
+export type NetworkClient = {
+  configuration: NetworkClientConfiguration;
+  provider: Provider;
+  blockTracker: BlockTracker;
+  destroy: () =&gt; void;
+};
+&nbsp;
+type RpcApiMiddleware = JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext&lt;{ origin: string }&gt;
+&gt;;
+&nbsp;
+/**
+ * Create a JSON RPC network client for a specific network.
+ *
+ * @param args - The arguments.
+ * @param args.id - The ID that will be assigned to the new network client in
+ * the registry.
+ * @param args.configuration - The network configuration.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.getBlockTrackerOptions - Factory for constructing block tracker
+ * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable. This effectively
+ * causes the `failoverRpcUrls` property of the network client configuration
+ * to be honored or ignored.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The network client.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >c</span>reateNetworkClient(</span>{
+  id,
+  configuration,
+  getRpcServiceOptions,
+  getBlockTrackerOptions,
+  messenger,
+  isRpcFailoverEnabled,
+  logger,
+}: {
+  id: NetworkClientId;
+  configuration: NetworkClientConfiguration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  getBlockTrackerOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): NetworkClient {
+  const primaryEndpointUrl =
+<span class="cstat-no" title="statement not covered" >    configuration.type === NetworkClientType.Infura</span>
+      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`
+      : configuration.rpcUrl;
+  const rpcServiceChain = <span class="cstat-no" title="statement not covered" >createRpcServiceChain({</span>
+    id,
+    primaryEndpointUrl,
+    configuration,
+    getRpcServiceOptions,
+    messenger,
+    isRpcFailoverEnabled,
+    logger,
+  });
+&nbsp;
+  let rpcApiMiddleware: RpcApiMiddleware;
+<span class="cstat-no" title="statement not covered" >  if (configuration.type === NetworkClientType.Infura) {</span>
+<span class="cstat-no" title="statement not covered" >    rpcApiMiddleware = asV2Middleware(</span>
+      createInfuraMiddleware({
+        rpcService: rpcServiceChain,
+        options: {
+          source: 'metamask',
+        },
+      }),
+    );
+  } else {
+<span class="cstat-no" title="statement not covered" >    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });</span>
+  }
+&nbsp;
+  const rpcProvider = <span class="cstat-no" title="statement not covered" >providerFromMiddlewareV2(rpcApiMiddleware);</span>
+&nbsp;
+  const blockTracker = <span class="cstat-no" title="statement not covered" >createBlockTracker({</span>
+    networkClientType: configuration.type,
+    endpointUrl: primaryEndpointUrl,
+    getOptions: getBlockTrackerOptions,
+    provider: rpcProvider,
+  });
+&nbsp;
+  const networkMiddleware =
+<span class="cstat-no" title="statement not covered" >    configuration.type === NetworkClientType.Infura</span>
+      ? createInfuraNetworkMiddleware({
+          blockTracker,
+          network: configuration.network,
+          rpcProvider,
+          rpcApiMiddleware,
+        })
+      : createCustomNetworkMiddleware({
+          blockTracker,
+          chainId: configuration.chainId,
+          rpcApiMiddleware,
+        });
+&nbsp;
+  const provider: Provider = <span class="cstat-no" title="statement not covered" >new InternalProvider({</span>
+    engine: JsonRpcEngineV2.create({
+      middleware: [networkMiddleware],
+    }),
+  });
+&nbsp;
+  const destroy = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(): void =</span>&gt; {</span>
+    // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+    // eslint-disable-next-line @typescript-eslint/no-floating-promises
+<span class="cstat-no" title="statement not covered" >    blockTracker.destroy();</span>
+  };
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return { configuration, provider, blockTracker, destroy };</span>
+}
+&nbsp;
+/**
+ * Creates an RPC service chain, which represents the primary endpoint URL for
+ * the network as well as its failover URLs.
+ *
+ * @param args - The arguments.
+ * @param args.id - The ID that will be assigned to the new network client in
+ * the registry.
+ * @param args.primaryEndpointUrl - The primary endpoint URL.
+ * @param args.configuration - The network configuration.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable. This effectively
+ * causes the `failoverRpcUrls` property of the network client configuration
+ * to be honored or ignored.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The RPC service chain.
+ */
+function <span class="fstat-no" title="function not covered" >createRpcServiceChain(</span>{
+  id,
+  primaryEndpointUrl,
+  configuration,
+  getRpcServiceOptions,
+  messenger,
+  isRpcFailoverEnabled,
+  logger,
+}: {
+  id: NetworkClientId;
+  primaryEndpointUrl: string;
+  configuration: NetworkClientConfiguration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;RpcServiceOptions, 'failoverService' | 'endpointUrl'&gt;;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): RpcServiceChain {
+  const availableEndpointUrls: [string, ...string[]] = <span class="cstat-no" title="statement not covered" >isRpcFailoverEnabled</span>
+    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]
+    : [primaryEndpointUrl];
+  const rpcServiceConfigurations = <span class="cstat-no" title="statement not covered" >availableEndpointUrls.map(<span class="fstat-no" title="function not covered" >(e</span>ndpointUrl) =&gt; {</span>
+    const options = <span class="cstat-no" title="statement not covered" >getRpcServiceOptions(endpointUrl);</span>
+&nbsp;
+    // Apply network throttling based on chain ID if configured
+    const throttledFetch = <span class="cstat-no" title="statement not covered" >createThrottledFetchForChainId(</span>
+      endpointUrl,
+      configuration.chainId,
+      options.fetch,
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+      ...options,
+      fetch: throttledFetch,
+      endpointUrl,
+      logger,
+    };
+  });
+&nbsp;
+  /**
+   * Extracts the error from Cockatiel's `FailureReason` type received in
+   * circuit breaker event handlers.
+   *
+   * The `FailureReason` object can have two possible shapes:
+   * - `{ error: Error }` - When the RPC service throws an error (the common
+   * case for RPC failures).
+   * - `{ value: T }` - When the RPC service returns a value that the retry
+   * filter policy considers a failure.
+   *
+   * @param value - The event data object from the circuit breaker event
+   * listener (after destructuring known properties like `endpointUrl`). This
+   * represents Cockatiel's `FailureReason` type.
+   * @returns The error or failure value, or `undefined` if neither property
+   * exists (which shouldn't happen in practice unless the circuit breaker is
+   * manually isolated).
+   */
+  const getError = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
+    value: CockatielFailureReason&lt;unknown&gt; | Record&lt;never, never&gt;,
+  ): Error | unknown | undefined =&gt; {
+<span class="cstat-no" title="statement not covered" >    if ('error' in value) {</span>
+<span class="cstat-no" title="statement not covered" >      return value.error;</span>
+    } else <span class="cstat-no" title="statement not covered" ><span class="missing-if-branch" title="if path not taken" >I</span>if ('value' in value) {</span>
+<span class="cstat-no" title="statement not covered" >      return value.value;</span>
+    }
+<span class="cstat-no" title="statement not covered" >    return undefined;</span>
+  };
+&nbsp;
+  const rpcServiceChain = <span class="cstat-no" title="statement not covered" >new RpcServiceChain([</span>
+    rpcServiceConfigurations[0],
+    ...rpcServiceConfigurations.slice(1),
+  ]);
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onBreak(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+    const error = <span class="cstat-no" title="statement not covered" >getError(data);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (error === undefined) {</span>
+      // This error shouldn't happen in practice because we never call `.isolate`
+      // on the circuit breaker policy, but we need to appease TypeScript.
+<span class="cstat-no" title="statement not covered" >      throw new Error('Could not make request to endpoint.');</span>
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {</span>
+      chainId: configuration.chainId,
+      networkClientId: id,
+      error,
+    });
+  });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onServiceBreak(</span>
+<span class="fstat-no" title="function not covered" >    ({</span>
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+      ...rest
+    }) =&gt; {
+      const error = <span class="cstat-no" title="statement not covered" >getError(rest);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (error === undefined) {</span>
+        // This error shouldn't happen in practice because we never call `.isolate`
+        // on the circuit breaker policy, but we need to appease TypeScript.
+<span class="cstat-no" title="statement not covered" >        throw new Error('Could not make request to endpoint.');</span>
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      messenger.publish('NetworkController:rpcEndpointUnavailable', {</span>
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        error,
+      });
+    },
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+    const error = <span class="cstat-no" title="statement not covered" >getError(data);</span>
+<span class="cstat-no" title="statement not covered" >    messenger.publish('NetworkController:rpcEndpointChainDegraded', {</span>
+      chainId: configuration.chainId,
+      networkClientId: id,
+      error,
+    });
+  });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onServiceDegraded(</span>
+<span class="fstat-no" title="function not covered" >    ({</span>
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+      ...rest
+    }) =&gt; {
+      const error = <span class="cstat-no" title="statement not covered" >getError(rest);</span>
+<span class="cstat-no" title="statement not covered" >      messenger.publish('NetworkController:rpcEndpointDegraded', {</span>
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        error,
+      });
+    },
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onAvailable(<span class="fstat-no" title="function not covered" >() =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    messenger.publish('NetworkController:rpcEndpointChainAvailable', {</span>
+      chainId: configuration.chainId,
+      networkClientId: id,
+    });
+  });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  rpcServiceChain.onServiceRetry(</span>
+<span class="fstat-no" title="function not covered" >    ({</span>
+      attempt,
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+    }) =&gt; {
+<span class="cstat-no" title="statement not covered" >      messenger.publish('NetworkController:rpcEndpointRetried', {</span>
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        attempt,
+      });
+    },
+  );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return rpcServiceChain;</span>
+}
+&nbsp;
+/**
+ * Create the block tracker for the network.
+ *
+ * @param args - The arguments.
+ * @param args.networkClientType - The type of the network client ("infura" or
+ * "custom").
+ * @param args.endpointUrl - The URL of the endpoint.
+ * @param args.getOptions - Factory for the block tracker options.
+ * @param args.provider - The EIP-1193 provider for the network's JSON-RPC
+ * middleware stack.
+ * @returns The created block tracker.
+ */
+function <span class="fstat-no" title="function not covered" >createBlockTracker(</span>{
+  networkClientType,
+  endpointUrl,
+  getOptions,
+  provider,
+}: {
+  networkClientType: NetworkClientType;
+  endpointUrl: string;
+  getOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; Omit&lt;PollingBlockTrackerOptions, 'provider'&gt;;
+  provider: InternalProvider;
+}): PollingBlockTracker {
+  const testOptions =
+    // Needed for testing.
+    // eslint-disable-next-line no-restricted-globals
+<span class="cstat-no" title="statement not covered" >    process.env.IN_TEST &amp;&amp; networkClientType === NetworkClientType.Custom</span>
+      ? { pollingInterval: SECOND }
+      : {};
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return new PollingBlockTracker({</span>
+    ...testOptions,
+    ...getOptions(endpointUrl),
+    provider,
+  });
+}
+&nbsp;
+/**
+ * Create middleware for infura.
+ *
+ * @param args - The arguments.
+ * @param args.blockTracker - The block tracker to use.
+ * @param args.network - The Infura network to use.
+ * @param args.rpcProvider - The RPC provider to use.
+ * @param args.rpcApiMiddleware - Additional middleware.
+ * @returns The collection of middleware that makes up the Infura client.
+ */
+function <span class="fstat-no" title="function not covered" >createInfuraNetworkMiddleware(</span>{
+  blockTracker,
+  network,
+  rpcProvider,
+  rpcApiMiddleware,
+}: {
+  blockTracker: PollingBlockTracker;
+  network: InfuraNetworkType;
+  rpcProvider: InternalProvider;
+  rpcApiMiddleware: RpcApiMiddleware;
+}): JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext&lt;{ origin: string; skipCache: boolean }&gt;
+&gt; {
+<span class="cstat-no" title="statement not covered" >  return JsonRpcEngineV2.create({</span>
+    middleware: [
+      createNetworkAndChainIdMiddleware({ network }),
+      createBlockCacheMiddleware({ blockTracker }),
+      createInflightCacheMiddleware(),
+      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),
+      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),
+      createBlockTrackerInspectorMiddleware({ blockTracker }),
+      rpcApiMiddleware,
+    ],
+  }).asMiddleware();
+}
+&nbsp;
+/**
+ * Creates static method middleware.
+ *
+ * @param args - The Arguments.
+ * @param args.network - The Infura network to use.
+ * @returns The middleware that implements the eth_chainId method.
+ */
+function <span class="fstat-no" title="function not covered" >createNetworkAndChainIdMiddleware(</span>{
+  network,
+}: {
+  network: InfuraNetworkType;
+}): JsonRpcMiddleware&lt;JsonRpcRequest&gt; {
+<span class="cstat-no" title="statement not covered" >  return createScaffoldMiddleware({</span>
+    eth_chainId: ChainId[network],
+  });
+}
+&nbsp;
+const createChainIdMiddleware = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
+  chainId: Hex,
+): JsonRpcMiddleware&lt;JsonRpcRequest, Json&gt; =&gt; {
+<span class="cstat-no" title="statement not covered" >  return <span class="fstat-no" title="function not covered" >({</span> request, next }) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (request.method === 'eth_chainId') {</span>
+<span class="cstat-no" title="statement not covered" >      return chainId;</span>
+    }
+<span class="cstat-no" title="statement not covered" >    return next();</span>
+  };
+};
+&nbsp;
+/**
+ * Creates custom middleware.
+ *
+ * @param args - The arguments.
+ * @param args.blockTracker - The block tracker to use.
+ * @param args.chainId - The chain id to use.
+ * @param args.rpcApiMiddleware - Additional middleware.
+ * @returns The collection of middleware that makes up the Infura client.
+ */
+function <span class="fstat-no" title="function not covered" >createCustomNetworkMiddleware(</span>{
+  blockTracker,
+  chainId,
+  rpcApiMiddleware,
+}: {
+  blockTracker: PollingBlockTracker;
+  chainId: Hex;
+  rpcApiMiddleware: RpcApiMiddleware;
+}): JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext&lt;{ origin: string; skipCache: boolean }&gt;
+&gt; {
+  // Needed for testing.
+  // eslint-disable-next-line no-restricted-globals
+  const testMiddlewares = <span class="cstat-no" title="statement not covered" >process.env.IN_TEST</span>
+    ? [createEstimateGasDelayTestMiddleware()]
+    : [];
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return JsonRpcEngineV2.create({</span>
+    middleware: [
+      ...testMiddlewares,
+      createChainIdMiddleware(chainId),
+      createBlockRefRewriteMiddleware({ blockTracker }),
+      createBlockCacheMiddleware({ blockTracker }),
+      createInflightCacheMiddleware(),
+      createBlockTrackerInspectorMiddleware({ blockTracker }),
+      rpcApiMiddleware,
+    ],
+  }).asMiddleware();
+}
+&nbsp;
+/**
+ * For use in tests only.
+ * Adds a delay to `eth_estimateGas` calls.
+ *
+ * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.
+ */
+function <span class="fstat-no" title="function not covered" >createEstimateGasDelayTestMiddleware(</span>): JsonRpcMiddleware&lt;
+  JsonRpcRequest,
+  Json
+&gt; {
+<span class="cstat-no" title="statement not covered" >  return <span class="fstat-no" title="function not covered" >async </span>({ request, next }) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (request.method === 'eth_estimateGas') {</span>
+<span class="cstat-no" title="statement not covered" >      await new Promise(<span class="fstat-no" title="function not covered" >(r</span>esolve) =&gt; <span class="cstat-no" title="statement not covered" >setTimeout(resolve, SECOND * 2))</span>;</span>
+    }
+<span class="cstat-no" title="statement not covered" >    return next();</span>
+  };
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/index.html b/coverage/src/index.html
new file mode 100644
index 0000000000000000000000000000000000000000..1e979bab869deddccfab5ed0362b2af7d1449437
--- /dev/null
+++ b/coverage/src/index.html
@@ -0,0 +1,206 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> src</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">2.27% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>15/658</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">1.85% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>5/269</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">2.58% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/155</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">2.13% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>14/656</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file low" data-value="NetworkController.ts"><a href="NetworkController.ts.html">NetworkController.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="496" class="abs low">0/496</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="219" class="abs low">0/219</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="114" class="abs low">0/114</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="496" class="abs low">0/496</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="constants.ts"><a href="constants.ts.html">constants.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="8" class="abs low">0/8</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="2" class="abs low">0/2</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="1" class="abs low">0/1</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="8" class="abs low">0/8</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="create-auto-managed-network-client.ts"><a href="create-auto-managed-network-client.ts.html">create-auto-managed-network-client.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="52" class="abs low">0/52</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="16" class="abs low">0/16</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="12" class="abs low">0/12</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="52" class="abs low">0/52</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="create-network-client.ts"><a href="create-network-client.ts.html">create-network-client.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="74" class="abs low">0/74</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="23" class="abs low">0/23</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="20" class="abs low">0/20</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="73" class="abs low">0/73</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="logger.ts"><a href="logger.ts.html">logger.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	<td data-value="100" class="pct high">100%</td>
+	<td data-value="0" class="abs high">0/0</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="1" class="abs low">0/1</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	</tr>
+
+<tr>
+	<td class="file medium" data-value="throttled-fetch.ts"><a href="throttled-fetch.ts.html">throttled-fetch.ts</a></td>
+	<td data-value="68.18" class="pic medium">
+	<div class="chart"><div class="cover-fill" style="width: 68%"></div><div class="cover-empty" style="width: 32%"></div></div>
+	</td>
+	<td data-value="68.18" class="pct medium">68.18%</td>
+	<td data-value="22" class="abs medium">15/22</td>
+	<td data-value="71.42" class="pct medium">71.42%</td>
+	<td data-value="7" class="abs medium">5/7</td>
+	<td data-value="66.66" class="pct medium">66.66%</td>
+	<td data-value="6" class="abs medium">4/6</td>
+	<td data-value="66.66" class="pct medium">66.66%</td>
+	<td data-value="21" class="abs medium">14/21</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="types.ts"><a href="types.ts.html">types.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="2" class="abs low">0/2</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="1" class="abs low">0/1</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="3" class="abs low">0/3</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/logger.ts.html b/coverage/src/logger.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..46a36b6231dfaa1199df8b3589ed0f9ffd3704b0
--- /dev/null
+++ b/coverage/src/logger.ts.html
@@ -0,0 +1,100 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/logger.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> logger.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">100% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/0</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/1</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" >import { createProjectLogger, c</span>reateModuleLogger } from '@metamask/utils';
+&nbsp;
+export const <span class="cstat-no" title="statement not covered" >projectLogger = createProjectLogger('network-controller');</span>
+&nbsp;
+export { <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >createModuleLogger </span>};</span>
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/rpc-service/index.html b/coverage/src/rpc-service/index.html
new file mode 100644
index 0000000000000000000000000000000000000000..42952bb05b52297f7b6768e3fbb9fc25aeacb95f
--- /dev/null
+++ b/coverage/src/rpc-service/index.html
@@ -0,0 +1,131 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/rpc-service</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../../prettify.css" />
+    <link rel="stylesheet" href="../../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../../index.html">All files</a> src/rpc-service</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/172</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/60</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/46</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/169</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <div class="pad1">
+<table class="coverage-summary">
+<thead>
+<tr>
+   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
+   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
+   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
+   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
+   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
+   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
+   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
+   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
+</tr>
+</thead>
+<tbody><tr>
+	<td class="file low" data-value="rpc-service-chain.ts"><a href="rpc-service-chain.ts.html">rpc-service-chain.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="82" class="abs low">0/82</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="13" class="abs low">0/13</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="23" class="abs low">0/23</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="79" class="abs low">0/79</td>
+	</tr>
+
+<tr>
+	<td class="file low" data-value="rpc-service.ts"><a href="rpc-service.ts.html">rpc-service.ts</a></td>
+	<td data-value="0" class="pic low">
+	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
+	</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="90" class="abs low">0/90</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="47" class="abs low">0/47</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="23" class="abs low">0/23</td>
+	<td data-value="0" class="pct low">0%</td>
+	<td data-value="90" class="abs low">0/90</td>
+	</tr>
+
+</tbody>
+</table>
+</div>
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../../sorter.js"></script>
+        <script src="../../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/rpc-service/rpc-service-chain.ts.html b/coverage/src/rpc-service/rpc-service-chain.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..46a725571e97c3de54ed0c5f8e4a8844b6dbc4f4
--- /dev/null
+++ b/coverage/src/rpc-service/rpc-service-chain.ts.html
@@ -0,0 +1,1528 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/rpc-service/rpc-service-chain.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../../prettify.css" />
+    <link rel="stylesheet" href="../../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/rpc-service</a> rpc-service-chain.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/82</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/13</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/23</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/79</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" >import {</span>
+  CircuitState,
+  CockatielEventEmitter,
+} from '@metamask/controller-utils';
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+import { IDisposable } from 'cockatiel';
+&nbsp;
+<span class="cstat-no" title="statement not covered" >import { RpcService } from './rpc-service';</span>
+import type { RpcServiceOptions } from './rpc-service';
+import type {
+  CockatielEventToEventListenerWithData,
+  ExcludeCockatielEventData,
+  ExtractCockatielEventData,
+  FetchOptions,
+} from './shared';
+<span class="cstat-no" title="statement not covered" >import { projectLogger, createModuleLogger } from '../logger';</span>
+&nbsp;
+const log = <span class="cstat-no" title="statement not covered" >createModuleLogger(projectLogger, 'RpcServiceChain');</span>
+&nbsp;
+/**
+ * Statuses that the RPC service chain can be in.
+ */
+const STATUSES = <span class="cstat-no" title="statement not covered" >{</span>
+  Available: 'available',
+  Degraded: 'degraded',
+  Unknown: 'unknown',
+  Unavailable: 'unavailable',
+} as const;
+&nbsp;
+/**
+ * Statuses that the RPC service chain can be in.
+ */
+type Status = (typeof STATUSES)[keyof typeof STATUSES];
+&nbsp;
+/**
+ * This class constructs and manages requests to a chain of RpcService objects
+ * which represent RPC endpoints with which to access a particular network. The
+ * first service in the chain is intended to be the primary way of hitting the
+ * network and the remaining services are used as failovers.
+ */
+<span class="cstat-no" title="statement not covered" >export class R</span>pcServiceChain {
+  /**
+   * The event emitter for the `onAvailable` event.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#onAvailableEventEmitter: CockatielEventEmitter&lt;</span>
+    ExcludeCockatielEventData&lt;
+      ExtractCockatielEventData&lt;RpcService['onAvailable']&gt;,
+      'endpointUrl'
+    &gt;
+  &gt;;
+&nbsp;
+  /**
+   * The event emitter for the `onBreak` event.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#onBreakEventEmitter: CockatielEventEmitter&lt;</span>
+    ExcludeCockatielEventData&lt;
+      ExtractCockatielEventData&lt;RpcService['onBreak']&gt;,
+      'endpointUrl'
+    &gt;
+  &gt;;
+&nbsp;
+  /**
+   * The event emitter for the `onDegraded` event.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#onDegradedEventEmitter: CockatielEventEmitter&lt;</span>
+    ExcludeCockatielEventData&lt;
+      ExtractCockatielEventData&lt;RpcService['onDegraded']&gt;,
+      'endpointUrl'
+    &gt;
+  &gt;;
+&nbsp;
+  /**
+   * The first RPC service that requests will be sent to.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#primaryService: RpcService;</span>
+&nbsp;
+  /**
+   * The RPC services in the chain.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#services: RpcService[];</span>
+&nbsp;
+  /**
+   * The status of the RPC service chain.
+   */
+<span class="cstat-no" title="statement not covered" >  #status: Status;</span>
+&nbsp;
+  /**
+   * Constructs a new RpcServiceChain object.
+   *
+   * @param rpcServiceConfigurations - The options for the RPC services
+   * that you want to construct. Each object in this array is the same as
+   * {@link RpcServiceOptions}.
+   */
+<span class="fstat-no" title="function not covered" >  constructor(</span>
+    rpcServiceConfigurations: [RpcServiceOptions, ...RpcServiceOptions[]],
+  ) {
+<span class="cstat-no" title="statement not covered" >    this.#services = rpcServiceConfigurations.map(</span>
+<span class="fstat-no" title="function not covered" >      (r</span>pcServiceConfiguration) =&gt; <span class="cstat-no" title="statement not covered" >new RpcService(rpcServiceConfiguration),</span>
+    );
+<span class="cstat-no" title="statement not covered" >    this.#primaryService = this.#services[0];</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#status = STATUSES.Unknown;</span>
+<span class="cstat-no" title="statement not covered" >    this.#onBreakEventEmitter = new CockatielEventEmitter&lt;</span>
+      ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onBreak']&gt;,
+        'endpointUrl'
+      &gt;
+    &gt;();
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#onDegradedEventEmitter = new CockatielEventEmitter&lt;</span>
+      ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onDegraded']&gt;,
+        'endpointUrl'
+      &gt;
+    &gt;();
+<span class="cstat-no" title="statement not covered" >    for (const service of this.#services) {</span>
+<span class="cstat-no" title="statement not covered" >      service.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#status !== STATUSES.Degraded) {</span>
+<span class="cstat-no" title="statement not covered" >          log('Updating status to "degraded"', data);</span>
+<span class="cstat-no" title="statement not covered" >          this.#status = STATUSES.Degraded;</span>
+          const { endpointUrl, ...rest } = <span class="cstat-no" title="statement not covered" >data;</span>
+<span class="cstat-no" title="statement not covered" >          this.#onDegradedEventEmitter.emit(rest);</span>
+        }
+      });
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#onAvailableEventEmitter = new CockatielEventEmitter&lt;</span>
+      ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onAvailable']&gt;,
+        'endpointUrl'
+      &gt;
+    &gt;();
+<span class="cstat-no" title="statement not covered" >    for (const service of this.#services) {</span>
+<span class="cstat-no" title="statement not covered" >      service.onAvailable(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (this.#status !== STATUSES.Available) {</span>
+<span class="cstat-no" title="statement not covered" >          log('Updating status to "available"', data);</span>
+<span class="cstat-no" title="statement not covered" >          this.#status = STATUSES.Available;</span>
+          const { endpointUrl, ...rest } = <span class="cstat-no" title="statement not covered" >data;</span>
+<span class="cstat-no" title="statement not covered" >          this.#onAvailableEventEmitter.emit(rest);</span>
+        }
+      });
+    }
+  }
+&nbsp;
+  /**
+   * Calls the provided callback when any of the RPC services is retried.
+   *
+   * This is mainly useful for tests.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the event listener.
+   */
+<span class="fstat-no" title="function not covered" >  onServiceRetry(</span>
+    listener: CockatielEventToEventListenerWithData&lt;
+      RpcService['onRetry'],
+      { primaryEndpointUrl: string }
+    &gt;,
+  ): { dispose(): void } {
+    const disposables = <span class="cstat-no" title="statement not covered" >this.#services.map(<span class="fstat-no" title="function not covered" >(s</span>ervice) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >      service.onRetry(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        listener({</span>
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+<span class="fstat-no" title="function not covered" >      dispose(</span>): void {
+<span class="cstat-no" title="statement not covered" >        disposables.forEach(<span class="fstat-no" title="function not covered" >(d</span>isposable) =&gt; <span class="cstat-no" title="statement not covered" >disposable.dispose())</span>;</span>
+      },
+    };
+  }
+&nbsp;
+  /**
+   * Calls the provided callback only when the maximum number of failed
+   * consecutive attempts to receive a 2xx response has been reached for all
+   * RPC services in the chain, and all services' underlying circuits have
+   * broken.
+   *
+   * The callback will not be called if a service's circuit breaks but its
+   * failover does not. Use `onServiceBreak` if you'd like a lower level of
+   * granularity.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onBreak(</span>
+    listener: (
+      data: ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onBreak']&gt;,
+        'endpointUrl'
+      &gt;,
+    ) =&gt; void,
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#onBreakEventEmitter.addListener(listener);</span>
+  }
+&nbsp;
+  /**
+   * Calls the provided callback each time when, for *any* of the RPC services
+   * in this chain, the maximum number of failed consecutive attempts to receive
+   * a 2xx response has been reached and the underlying circuit has broken. A
+   * more granular version of `onBreak`.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onServiceBreak(</span>
+    listener: CockatielEventToEventListenerWithData&lt;
+      RpcService['onBreak'],
+      { primaryEndpointUrl: string }
+    &gt;,
+  ): IDisposable {
+    const disposables = <span class="cstat-no" title="statement not covered" >this.#services.map(<span class="fstat-no" title="function not covered" >(s</span>ervice) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >      service.onBreak(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        listener({</span>
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+<span class="fstat-no" title="function not covered" >      dispose(</span>): void {
+<span class="cstat-no" title="statement not covered" >        disposables.forEach(<span class="fstat-no" title="function not covered" >(d</span>isposable) =&gt; <span class="cstat-no" title="statement not covered" >disposable.dispose())</span>;</span>
+      },
+    };
+  }
+&nbsp;
+  /**
+   * Calls the provided callback if no requests have been initiated yet or
+   * all requests to RPC services in this chain have responded successfully in a
+   * timely fashion, and then one of the two conditions apply:
+   *
+   * 1. When a retriable error is encountered making a request to an RPC
+   * service, and the request is retried until a set maximum is reached.
+   * 2. When a RPC service responds successfully, but the request takes longer
+   * than a set number of seconds to complete.
+   *
+   * Note that the callback will be called even if there are local connectivity
+   * issues which prevent requests from being initiated. This is intentional.
+   *
+   * Also note this callback will only be called if the RPC service chain as a
+   * whole is in a "degraded" state, and will then only be called once (e.g., it
+   * will not be called if a failover service falls into a degraded state, then
+   * the primary comes back online, but it is slow). Use `onServiceDegraded` if
+   * you'd like a lower level of granularity.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onDegraded(</span>
+    listener: (
+      data: ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onDegraded']&gt;,
+        'endpointUrl'
+      &gt;,
+    ) =&gt; void,
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#onDegradedEventEmitter.addListener(listener);</span>
+  }
+&nbsp;
+  /**
+   * Calls the provided callback each time one of the two conditions apply:
+   *
+   * 1. When a retriable error is encountered making a request to an RPC
+   * service, and the request is retried until a set maximum is reached.
+   * 2. When a RPC service responds successfully, but the request takes longer
+   * than a set number of seconds to complete.
+   *
+   * Note that the callback will be called even if there are local connectivity
+   * issues which prevent requests from being initiated. This is intentional.
+   *
+   * This is a more granular version of `onDegraded`. The callback will be
+   * called for each slow request to an RPC service. It may also be called again
+   * if a failover service falls into a degraded state, then the primary comes
+   * back online, but it is slow.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onServiceDegraded(</span>
+    listener: CockatielEventToEventListenerWithData&lt;
+      RpcService['onDegraded'],
+      { primaryEndpointUrl: string }
+    &gt;,
+  ): IDisposable {
+    const disposables = <span class="cstat-no" title="statement not covered" >this.#services.map(<span class="fstat-no" title="function not covered" >(s</span>ervice) =&gt;</span>
+<span class="cstat-no" title="statement not covered" >      service.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >        listener({</span>
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+<span class="fstat-no" title="function not covered" >      dispose(</span>): void {
+<span class="cstat-no" title="statement not covered" >        disposables.forEach(<span class="fstat-no" title="function not covered" >(d</span>isposable) =&gt; <span class="cstat-no" title="statement not covered" >disposable.dispose())</span>;</span>
+      },
+    };
+  }
+&nbsp;
+  /**
+   * Calls the provided callback in one of the following two conditions:
+   *
+   * 1. The first time that a 2xx request is made to any of the RPC services in
+   * this chain.
+   * 2. When requests to any the failover RPC services in this chain were
+   * failing such that they were degraded or their underyling circuits broke,
+   * but the first request to the primary succeeds again.
+   *
+   * Note this callback will only be called if the RPC service chain as a whole
+   * is in an "available" state.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+<span class="fstat-no" title="function not covered" >  onAvailable(</span>
+    listener: (
+      data: ExcludeCockatielEventData&lt;
+        ExtractCockatielEventData&lt;RpcService['onAvailable']&gt;,
+        'endpointUrl'
+      &gt;,
+    ) =&gt; void,
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#onAvailableEventEmitter.addListener(listener);</span>
+  }
+&nbsp;
+  /**
+   * Uses the RPC services in the chain to make a request, using each service
+   * after the first as a fallback to the previous one as necessary.
+   *
+   * This overload is specifically designed for `eth_getBlockByNumber`, which
+   * can return a `result` of `null` despite an expected `Result` being
+   * provided.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws A 401 error if the response status is 401.
+   * @throws A "rate limiting" error if the response HTTP status is 429.
+   * @throws A "resource unavailable" error if the response status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client error (-32100) for any other 4xx status codes.
+   * @throws A "parse" error if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt; &amp; {
+      method: 'eth_getBlockByNumber';
+    },
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt; | JsonRpcResponse&lt;null&gt;&gt;;
+&nbsp;
+  /**
+   * Uses the RPC services in the chain to make a request, using each service
+   * after the first as a fallback to the previous one as necessary.
+   *
+   * This overload is designed for all RPC methods except for
+   * `eth_getBlockByNumber`, which are expected to return a `result` of the
+   * expected `Result`.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws A 401 error if the response status is 401.
+   * @throws A "rate limiting" error if the response HTTP status is 429.
+   * @throws A "resource unavailable" error if the response status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client error (-32100) for any other 4xx status codes.
+   * @throws A "parse" error if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt;&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  async </span>request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions: FetchOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;JsonRpcResponse&lt;Result | null&gt;&gt; {
+    // Start with the primary (first) service and switch to failovers as the
+    // need arises. This is a bit confusing, so keep reading for more on how
+    // this works.
+&nbsp;
+    let availableServiceIndex: number | undefined;
+    let response: JsonRpcResponse&lt;Result&gt; | undefined;
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    for (const [i, service] of this.#services.entries()) {</span>
+<span class="cstat-no" title="statement not covered" >      log(`Trying service #${i + 1}...`);</span>
+      const previousCircuitState = <span class="cstat-no" title="statement not covered" >service.getCircuitState();</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      try {</span>
+        // Try making the request through the service.
+<span class="cstat-no" title="statement not covered" >        response = await service.request&lt;Params, Result&gt;(</span>
+          jsonRpcRequest,
+          fetchOptions,
+        );
+<span class="cstat-no" title="statement not covered" >        log('Service successfully received request.');</span>
+<span class="cstat-no" title="statement not covered" >        availableServiceIndex = i;</span>
+<span class="cstat-no" title="statement not covered" >        break;</span>
+      } catch (error) {
+        // Oops, that didn't work.
+        // Capture this error so that we can handle it later.
+&nbsp;
+        const { lastError } = <span class="cstat-no" title="statement not covered" >service;</span>
+        const isCircuitOpen = <span class="cstat-no" title="statement not covered" >service.getCircuitState() === CircuitState.Open;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        log('Service failed! error =', error, 'lastError = ', lastError);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (isCircuitOpen) {</span>
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (i &lt; this.#services.length - 1) {</span>
+<span class="cstat-no" title="statement not covered" >            log(</span>
+              "This service's circuit is open. Proceeding to next service...",
+            );
+<span class="cstat-no" title="statement not covered" >            continue;</span>
+          }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (</span>
+            previousCircuitState !== CircuitState.Open &amp;&amp;
+            this.#status !== STATUSES.Unavailable &amp;&amp;
+            lastError !== undefined
+          ) {
+            // If the service's circuit just broke and it's the last one in the
+            // chain, then trigger the onBreak event. (But if for some reason we
+            // have already done this, then don't do it.)
+<span class="cstat-no" title="statement not covered" >            log(</span>
+              'This service\'s circuit just opened and it is the last service. Updating status to "unavailable" and triggering onBreak.',
+            );
+<span class="cstat-no" title="statement not covered" >            this.#status = STATUSES.Unavailable;</span>
+<span class="cstat-no" title="statement not covered" >            this.#onBreakEventEmitter.emit({</span>
+              error: lastError,
+            });
+          }
+        }
+&nbsp;
+        // The service failed, and we throw whatever the error is. The calling
+        // code can try again if it so desires.
+<span class="cstat-no" title="statement not covered" >        log(</span>
+          `${isCircuitOpen ? '' : "This service's circuit is closed. "}Re-throwing error.`,
+        );
+<span class="cstat-no" title="statement not covered" >        throw error;</span>
+      }
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (response) {</span>
+      // If one of the services is available, reset all of the circuits of the
+      // following services. If we didn't do this and the service became
+      // unavailable in the future, and any of the failovers' circuits were
+      // open (due to previous failures), we would receive a "circuit broken"
+      // error when we attempted to divert traffic to the failovers again.
+      //
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (availableServiceIndex !== undefined) {</span>
+<span class="cstat-no" title="statement not covered" >        for (const [i, service] of [...this.#services.entries()].slice(</span>
+          availableServiceIndex + 1,
+        )) {
+<span class="cstat-no" title="statement not covered" >          log(`Resetting policy for service #${i + 1}.`);</span>
+<span class="cstat-no" title="statement not covered" >          service.resetPolicy();</span>
+        }
+      }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      return response;</span>
+    }
+&nbsp;
+    // The only way we can end up here is if there are no services to loop over.
+    // That is not possible due to the types on the constructor, but TypeScript
+    // doesn't know this, so we have to appease it.
+<span class="cstat-no" title="statement not covered" >    throw new Error('Nothing to return');</span>
+  }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../../sorter.js"></script>
+        <script src="../../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/rpc-service/rpc-service.ts.html b/coverage/src/rpc-service/rpc-service.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..be0d682fb0c4936f457c6f528259973a5ac1e503
--- /dev/null
+++ b/coverage/src/rpc-service/rpc-service.ts.html
@@ -0,0 +1,1978 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/rpc-service/rpc-service.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../../prettify.css" />
+    <link rel="stylesheet" href="../../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/rpc-service</a> rpc-service.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/90</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/47</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/23</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/90</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a>
+<a name='L116'></a><a href='#L116'>116</a>
+<a name='L117'></a><a href='#L117'>117</a>
+<a name='L118'></a><a href='#L118'>118</a>
+<a name='L119'></a><a href='#L119'>119</a>
+<a name='L120'></a><a href='#L120'>120</a>
+<a name='L121'></a><a href='#L121'>121</a>
+<a name='L122'></a><a href='#L122'>122</a>
+<a name='L123'></a><a href='#L123'>123</a>
+<a name='L124'></a><a href='#L124'>124</a>
+<a name='L125'></a><a href='#L125'>125</a>
+<a name='L126'></a><a href='#L126'>126</a>
+<a name='L127'></a><a href='#L127'>127</a>
+<a name='L128'></a><a href='#L128'>128</a>
+<a name='L129'></a><a href='#L129'>129</a>
+<a name='L130'></a><a href='#L130'>130</a>
+<a name='L131'></a><a href='#L131'>131</a>
+<a name='L132'></a><a href='#L132'>132</a>
+<a name='L133'></a><a href='#L133'>133</a>
+<a name='L134'></a><a href='#L134'>134</a>
+<a name='L135'></a><a href='#L135'>135</a>
+<a name='L136'></a><a href='#L136'>136</a>
+<a name='L137'></a><a href='#L137'>137</a>
+<a name='L138'></a><a href='#L138'>138</a>
+<a name='L139'></a><a href='#L139'>139</a>
+<a name='L140'></a><a href='#L140'>140</a>
+<a name='L141'></a><a href='#L141'>141</a>
+<a name='L142'></a><a href='#L142'>142</a>
+<a name='L143'></a><a href='#L143'>143</a>
+<a name='L144'></a><a href='#L144'>144</a>
+<a name='L145'></a><a href='#L145'>145</a>
+<a name='L146'></a><a href='#L146'>146</a>
+<a name='L147'></a><a href='#L147'>147</a>
+<a name='L148'></a><a href='#L148'>148</a>
+<a name='L149'></a><a href='#L149'>149</a>
+<a name='L150'></a><a href='#L150'>150</a>
+<a name='L151'></a><a href='#L151'>151</a>
+<a name='L152'></a><a href='#L152'>152</a>
+<a name='L153'></a><a href='#L153'>153</a>
+<a name='L154'></a><a href='#L154'>154</a>
+<a name='L155'></a><a href='#L155'>155</a>
+<a name='L156'></a><a href='#L156'>156</a>
+<a name='L157'></a><a href='#L157'>157</a>
+<a name='L158'></a><a href='#L158'>158</a>
+<a name='L159'></a><a href='#L159'>159</a>
+<a name='L160'></a><a href='#L160'>160</a>
+<a name='L161'></a><a href='#L161'>161</a>
+<a name='L162'></a><a href='#L162'>162</a>
+<a name='L163'></a><a href='#L163'>163</a>
+<a name='L164'></a><a href='#L164'>164</a>
+<a name='L165'></a><a href='#L165'>165</a>
+<a name='L166'></a><a href='#L166'>166</a>
+<a name='L167'></a><a href='#L167'>167</a>
+<a name='L168'></a><a href='#L168'>168</a>
+<a name='L169'></a><a href='#L169'>169</a>
+<a name='L170'></a><a href='#L170'>170</a>
+<a name='L171'></a><a href='#L171'>171</a>
+<a name='L172'></a><a href='#L172'>172</a>
+<a name='L173'></a><a href='#L173'>173</a>
+<a name='L174'></a><a href='#L174'>174</a>
+<a name='L175'></a><a href='#L175'>175</a>
+<a name='L176'></a><a href='#L176'>176</a>
+<a name='L177'></a><a href='#L177'>177</a>
+<a name='L178'></a><a href='#L178'>178</a>
+<a name='L179'></a><a href='#L179'>179</a>
+<a name='L180'></a><a href='#L180'>180</a>
+<a name='L181'></a><a href='#L181'>181</a>
+<a name='L182'></a><a href='#L182'>182</a>
+<a name='L183'></a><a href='#L183'>183</a>
+<a name='L184'></a><a href='#L184'>184</a>
+<a name='L185'></a><a href='#L185'>185</a>
+<a name='L186'></a><a href='#L186'>186</a>
+<a name='L187'></a><a href='#L187'>187</a>
+<a name='L188'></a><a href='#L188'>188</a>
+<a name='L189'></a><a href='#L189'>189</a>
+<a name='L190'></a><a href='#L190'>190</a>
+<a name='L191'></a><a href='#L191'>191</a>
+<a name='L192'></a><a href='#L192'>192</a>
+<a name='L193'></a><a href='#L193'>193</a>
+<a name='L194'></a><a href='#L194'>194</a>
+<a name='L195'></a><a href='#L195'>195</a>
+<a name='L196'></a><a href='#L196'>196</a>
+<a name='L197'></a><a href='#L197'>197</a>
+<a name='L198'></a><a href='#L198'>198</a>
+<a name='L199'></a><a href='#L199'>199</a>
+<a name='L200'></a><a href='#L200'>200</a>
+<a name='L201'></a><a href='#L201'>201</a>
+<a name='L202'></a><a href='#L202'>202</a>
+<a name='L203'></a><a href='#L203'>203</a>
+<a name='L204'></a><a href='#L204'>204</a>
+<a name='L205'></a><a href='#L205'>205</a>
+<a name='L206'></a><a href='#L206'>206</a>
+<a name='L207'></a><a href='#L207'>207</a>
+<a name='L208'></a><a href='#L208'>208</a>
+<a name='L209'></a><a href='#L209'>209</a>
+<a name='L210'></a><a href='#L210'>210</a>
+<a name='L211'></a><a href='#L211'>211</a>
+<a name='L212'></a><a href='#L212'>212</a>
+<a name='L213'></a><a href='#L213'>213</a>
+<a name='L214'></a><a href='#L214'>214</a>
+<a name='L215'></a><a href='#L215'>215</a>
+<a name='L216'></a><a href='#L216'>216</a>
+<a name='L217'></a><a href='#L217'>217</a>
+<a name='L218'></a><a href='#L218'>218</a>
+<a name='L219'></a><a href='#L219'>219</a>
+<a name='L220'></a><a href='#L220'>220</a>
+<a name='L221'></a><a href='#L221'>221</a>
+<a name='L222'></a><a href='#L222'>222</a>
+<a name='L223'></a><a href='#L223'>223</a>
+<a name='L224'></a><a href='#L224'>224</a>
+<a name='L225'></a><a href='#L225'>225</a>
+<a name='L226'></a><a href='#L226'>226</a>
+<a name='L227'></a><a href='#L227'>227</a>
+<a name='L228'></a><a href='#L228'>228</a>
+<a name='L229'></a><a href='#L229'>229</a>
+<a name='L230'></a><a href='#L230'>230</a>
+<a name='L231'></a><a href='#L231'>231</a>
+<a name='L232'></a><a href='#L232'>232</a>
+<a name='L233'></a><a href='#L233'>233</a>
+<a name='L234'></a><a href='#L234'>234</a>
+<a name='L235'></a><a href='#L235'>235</a>
+<a name='L236'></a><a href='#L236'>236</a>
+<a name='L237'></a><a href='#L237'>237</a>
+<a name='L238'></a><a href='#L238'>238</a>
+<a name='L239'></a><a href='#L239'>239</a>
+<a name='L240'></a><a href='#L240'>240</a>
+<a name='L241'></a><a href='#L241'>241</a>
+<a name='L242'></a><a href='#L242'>242</a>
+<a name='L243'></a><a href='#L243'>243</a>
+<a name='L244'></a><a href='#L244'>244</a>
+<a name='L245'></a><a href='#L245'>245</a>
+<a name='L246'></a><a href='#L246'>246</a>
+<a name='L247'></a><a href='#L247'>247</a>
+<a name='L248'></a><a href='#L248'>248</a>
+<a name='L249'></a><a href='#L249'>249</a>
+<a name='L250'></a><a href='#L250'>250</a>
+<a name='L251'></a><a href='#L251'>251</a>
+<a name='L252'></a><a href='#L252'>252</a>
+<a name='L253'></a><a href='#L253'>253</a>
+<a name='L254'></a><a href='#L254'>254</a>
+<a name='L255'></a><a href='#L255'>255</a>
+<a name='L256'></a><a href='#L256'>256</a>
+<a name='L257'></a><a href='#L257'>257</a>
+<a name='L258'></a><a href='#L258'>258</a>
+<a name='L259'></a><a href='#L259'>259</a>
+<a name='L260'></a><a href='#L260'>260</a>
+<a name='L261'></a><a href='#L261'>261</a>
+<a name='L262'></a><a href='#L262'>262</a>
+<a name='L263'></a><a href='#L263'>263</a>
+<a name='L264'></a><a href='#L264'>264</a>
+<a name='L265'></a><a href='#L265'>265</a>
+<a name='L266'></a><a href='#L266'>266</a>
+<a name='L267'></a><a href='#L267'>267</a>
+<a name='L268'></a><a href='#L268'>268</a>
+<a name='L269'></a><a href='#L269'>269</a>
+<a name='L270'></a><a href='#L270'>270</a>
+<a name='L271'></a><a href='#L271'>271</a>
+<a name='L272'></a><a href='#L272'>272</a>
+<a name='L273'></a><a href='#L273'>273</a>
+<a name='L274'></a><a href='#L274'>274</a>
+<a name='L275'></a><a href='#L275'>275</a>
+<a name='L276'></a><a href='#L276'>276</a>
+<a name='L277'></a><a href='#L277'>277</a>
+<a name='L278'></a><a href='#L278'>278</a>
+<a name='L279'></a><a href='#L279'>279</a>
+<a name='L280'></a><a href='#L280'>280</a>
+<a name='L281'></a><a href='#L281'>281</a>
+<a name='L282'></a><a href='#L282'>282</a>
+<a name='L283'></a><a href='#L283'>283</a>
+<a name='L284'></a><a href='#L284'>284</a>
+<a name='L285'></a><a href='#L285'>285</a>
+<a name='L286'></a><a href='#L286'>286</a>
+<a name='L287'></a><a href='#L287'>287</a>
+<a name='L288'></a><a href='#L288'>288</a>
+<a name='L289'></a><a href='#L289'>289</a>
+<a name='L290'></a><a href='#L290'>290</a>
+<a name='L291'></a><a href='#L291'>291</a>
+<a name='L292'></a><a href='#L292'>292</a>
+<a name='L293'></a><a href='#L293'>293</a>
+<a name='L294'></a><a href='#L294'>294</a>
+<a name='L295'></a><a href='#L295'>295</a>
+<a name='L296'></a><a href='#L296'>296</a>
+<a name='L297'></a><a href='#L297'>297</a>
+<a name='L298'></a><a href='#L298'>298</a>
+<a name='L299'></a><a href='#L299'>299</a>
+<a name='L300'></a><a href='#L300'>300</a>
+<a name='L301'></a><a href='#L301'>301</a>
+<a name='L302'></a><a href='#L302'>302</a>
+<a name='L303'></a><a href='#L303'>303</a>
+<a name='L304'></a><a href='#L304'>304</a>
+<a name='L305'></a><a href='#L305'>305</a>
+<a name='L306'></a><a href='#L306'>306</a>
+<a name='L307'></a><a href='#L307'>307</a>
+<a name='L308'></a><a href='#L308'>308</a>
+<a name='L309'></a><a href='#L309'>309</a>
+<a name='L310'></a><a href='#L310'>310</a>
+<a name='L311'></a><a href='#L311'>311</a>
+<a name='L312'></a><a href='#L312'>312</a>
+<a name='L313'></a><a href='#L313'>313</a>
+<a name='L314'></a><a href='#L314'>314</a>
+<a name='L315'></a><a href='#L315'>315</a>
+<a name='L316'></a><a href='#L316'>316</a>
+<a name='L317'></a><a href='#L317'>317</a>
+<a name='L318'></a><a href='#L318'>318</a>
+<a name='L319'></a><a href='#L319'>319</a>
+<a name='L320'></a><a href='#L320'>320</a>
+<a name='L321'></a><a href='#L321'>321</a>
+<a name='L322'></a><a href='#L322'>322</a>
+<a name='L323'></a><a href='#L323'>323</a>
+<a name='L324'></a><a href='#L324'>324</a>
+<a name='L325'></a><a href='#L325'>325</a>
+<a name='L326'></a><a href='#L326'>326</a>
+<a name='L327'></a><a href='#L327'>327</a>
+<a name='L328'></a><a href='#L328'>328</a>
+<a name='L329'></a><a href='#L329'>329</a>
+<a name='L330'></a><a href='#L330'>330</a>
+<a name='L331'></a><a href='#L331'>331</a>
+<a name='L332'></a><a href='#L332'>332</a>
+<a name='L333'></a><a href='#L333'>333</a>
+<a name='L334'></a><a href='#L334'>334</a>
+<a name='L335'></a><a href='#L335'>335</a>
+<a name='L336'></a><a href='#L336'>336</a>
+<a name='L337'></a><a href='#L337'>337</a>
+<a name='L338'></a><a href='#L338'>338</a>
+<a name='L339'></a><a href='#L339'>339</a>
+<a name='L340'></a><a href='#L340'>340</a>
+<a name='L341'></a><a href='#L341'>341</a>
+<a name='L342'></a><a href='#L342'>342</a>
+<a name='L343'></a><a href='#L343'>343</a>
+<a name='L344'></a><a href='#L344'>344</a>
+<a name='L345'></a><a href='#L345'>345</a>
+<a name='L346'></a><a href='#L346'>346</a>
+<a name='L347'></a><a href='#L347'>347</a>
+<a name='L348'></a><a href='#L348'>348</a>
+<a name='L349'></a><a href='#L349'>349</a>
+<a name='L350'></a><a href='#L350'>350</a>
+<a name='L351'></a><a href='#L351'>351</a>
+<a name='L352'></a><a href='#L352'>352</a>
+<a name='L353'></a><a href='#L353'>353</a>
+<a name='L354'></a><a href='#L354'>354</a>
+<a name='L355'></a><a href='#L355'>355</a>
+<a name='L356'></a><a href='#L356'>356</a>
+<a name='L357'></a><a href='#L357'>357</a>
+<a name='L358'></a><a href='#L358'>358</a>
+<a name='L359'></a><a href='#L359'>359</a>
+<a name='L360'></a><a href='#L360'>360</a>
+<a name='L361'></a><a href='#L361'>361</a>
+<a name='L362'></a><a href='#L362'>362</a>
+<a name='L363'></a><a href='#L363'>363</a>
+<a name='L364'></a><a href='#L364'>364</a>
+<a name='L365'></a><a href='#L365'>365</a>
+<a name='L366'></a><a href='#L366'>366</a>
+<a name='L367'></a><a href='#L367'>367</a>
+<a name='L368'></a><a href='#L368'>368</a>
+<a name='L369'></a><a href='#L369'>369</a>
+<a name='L370'></a><a href='#L370'>370</a>
+<a name='L371'></a><a href='#L371'>371</a>
+<a name='L372'></a><a href='#L372'>372</a>
+<a name='L373'></a><a href='#L373'>373</a>
+<a name='L374'></a><a href='#L374'>374</a>
+<a name='L375'></a><a href='#L375'>375</a>
+<a name='L376'></a><a href='#L376'>376</a>
+<a name='L377'></a><a href='#L377'>377</a>
+<a name='L378'></a><a href='#L378'>378</a>
+<a name='L379'></a><a href='#L379'>379</a>
+<a name='L380'></a><a href='#L380'>380</a>
+<a name='L381'></a><a href='#L381'>381</a>
+<a name='L382'></a><a href='#L382'>382</a>
+<a name='L383'></a><a href='#L383'>383</a>
+<a name='L384'></a><a href='#L384'>384</a>
+<a name='L385'></a><a href='#L385'>385</a>
+<a name='L386'></a><a href='#L386'>386</a>
+<a name='L387'></a><a href='#L387'>387</a>
+<a name='L388'></a><a href='#L388'>388</a>
+<a name='L389'></a><a href='#L389'>389</a>
+<a name='L390'></a><a href='#L390'>390</a>
+<a name='L391'></a><a href='#L391'>391</a>
+<a name='L392'></a><a href='#L392'>392</a>
+<a name='L393'></a><a href='#L393'>393</a>
+<a name='L394'></a><a href='#L394'>394</a>
+<a name='L395'></a><a href='#L395'>395</a>
+<a name='L396'></a><a href='#L396'>396</a>
+<a name='L397'></a><a href='#L397'>397</a>
+<a name='L398'></a><a href='#L398'>398</a>
+<a name='L399'></a><a href='#L399'>399</a>
+<a name='L400'></a><a href='#L400'>400</a>
+<a name='L401'></a><a href='#L401'>401</a>
+<a name='L402'></a><a href='#L402'>402</a>
+<a name='L403'></a><a href='#L403'>403</a>
+<a name='L404'></a><a href='#L404'>404</a>
+<a name='L405'></a><a href='#L405'>405</a>
+<a name='L406'></a><a href='#L406'>406</a>
+<a name='L407'></a><a href='#L407'>407</a>
+<a name='L408'></a><a href='#L408'>408</a>
+<a name='L409'></a><a href='#L409'>409</a>
+<a name='L410'></a><a href='#L410'>410</a>
+<a name='L411'></a><a href='#L411'>411</a>
+<a name='L412'></a><a href='#L412'>412</a>
+<a name='L413'></a><a href='#L413'>413</a>
+<a name='L414'></a><a href='#L414'>414</a>
+<a name='L415'></a><a href='#L415'>415</a>
+<a name='L416'></a><a href='#L416'>416</a>
+<a name='L417'></a><a href='#L417'>417</a>
+<a name='L418'></a><a href='#L418'>418</a>
+<a name='L419'></a><a href='#L419'>419</a>
+<a name='L420'></a><a href='#L420'>420</a>
+<a name='L421'></a><a href='#L421'>421</a>
+<a name='L422'></a><a href='#L422'>422</a>
+<a name='L423'></a><a href='#L423'>423</a>
+<a name='L424'></a><a href='#L424'>424</a>
+<a name='L425'></a><a href='#L425'>425</a>
+<a name='L426'></a><a href='#L426'>426</a>
+<a name='L427'></a><a href='#L427'>427</a>
+<a name='L428'></a><a href='#L428'>428</a>
+<a name='L429'></a><a href='#L429'>429</a>
+<a name='L430'></a><a href='#L430'>430</a>
+<a name='L431'></a><a href='#L431'>431</a>
+<a name='L432'></a><a href='#L432'>432</a>
+<a name='L433'></a><a href='#L433'>433</a>
+<a name='L434'></a><a href='#L434'>434</a>
+<a name='L435'></a><a href='#L435'>435</a>
+<a name='L436'></a><a href='#L436'>436</a>
+<a name='L437'></a><a href='#L437'>437</a>
+<a name='L438'></a><a href='#L438'>438</a>
+<a name='L439'></a><a href='#L439'>439</a>
+<a name='L440'></a><a href='#L440'>440</a>
+<a name='L441'></a><a href='#L441'>441</a>
+<a name='L442'></a><a href='#L442'>442</a>
+<a name='L443'></a><a href='#L443'>443</a>
+<a name='L444'></a><a href='#L444'>444</a>
+<a name='L445'></a><a href='#L445'>445</a>
+<a name='L446'></a><a href='#L446'>446</a>
+<a name='L447'></a><a href='#L447'>447</a>
+<a name='L448'></a><a href='#L448'>448</a>
+<a name='L449'></a><a href='#L449'>449</a>
+<a name='L450'></a><a href='#L450'>450</a>
+<a name='L451'></a><a href='#L451'>451</a>
+<a name='L452'></a><a href='#L452'>452</a>
+<a name='L453'></a><a href='#L453'>453</a>
+<a name='L454'></a><a href='#L454'>454</a>
+<a name='L455'></a><a href='#L455'>455</a>
+<a name='L456'></a><a href='#L456'>456</a>
+<a name='L457'></a><a href='#L457'>457</a>
+<a name='L458'></a><a href='#L458'>458</a>
+<a name='L459'></a><a href='#L459'>459</a>
+<a name='L460'></a><a href='#L460'>460</a>
+<a name='L461'></a><a href='#L461'>461</a>
+<a name='L462'></a><a href='#L462'>462</a>
+<a name='L463'></a><a href='#L463'>463</a>
+<a name='L464'></a><a href='#L464'>464</a>
+<a name='L465'></a><a href='#L465'>465</a>
+<a name='L466'></a><a href='#L466'>466</a>
+<a name='L467'></a><a href='#L467'>467</a>
+<a name='L468'></a><a href='#L468'>468</a>
+<a name='L469'></a><a href='#L469'>469</a>
+<a name='L470'></a><a href='#L470'>470</a>
+<a name='L471'></a><a href='#L471'>471</a>
+<a name='L472'></a><a href='#L472'>472</a>
+<a name='L473'></a><a href='#L473'>473</a>
+<a name='L474'></a><a href='#L474'>474</a>
+<a name='L475'></a><a href='#L475'>475</a>
+<a name='L476'></a><a href='#L476'>476</a>
+<a name='L477'></a><a href='#L477'>477</a>
+<a name='L478'></a><a href='#L478'>478</a>
+<a name='L479'></a><a href='#L479'>479</a>
+<a name='L480'></a><a href='#L480'>480</a>
+<a name='L481'></a><a href='#L481'>481</a>
+<a name='L482'></a><a href='#L482'>482</a>
+<a name='L483'></a><a href='#L483'>483</a>
+<a name='L484'></a><a href='#L484'>484</a>
+<a name='L485'></a><a href='#L485'>485</a>
+<a name='L486'></a><a href='#L486'>486</a>
+<a name='L487'></a><a href='#L487'>487</a>
+<a name='L488'></a><a href='#L488'>488</a>
+<a name='L489'></a><a href='#L489'>489</a>
+<a name='L490'></a><a href='#L490'>490</a>
+<a name='L491'></a><a href='#L491'>491</a>
+<a name='L492'></a><a href='#L492'>492</a>
+<a name='L493'></a><a href='#L493'>493</a>
+<a name='L494'></a><a href='#L494'>494</a>
+<a name='L495'></a><a href='#L495'>495</a>
+<a name='L496'></a><a href='#L496'>496</a>
+<a name='L497'></a><a href='#L497'>497</a>
+<a name='L498'></a><a href='#L498'>498</a>
+<a name='L499'></a><a href='#L499'>499</a>
+<a name='L500'></a><a href='#L500'>500</a>
+<a name='L501'></a><a href='#L501'>501</a>
+<a name='L502'></a><a href='#L502'>502</a>
+<a name='L503'></a><a href='#L503'>503</a>
+<a name='L504'></a><a href='#L504'>504</a>
+<a name='L505'></a><a href='#L505'>505</a>
+<a name='L506'></a><a href='#L506'>506</a>
+<a name='L507'></a><a href='#L507'>507</a>
+<a name='L508'></a><a href='#L508'>508</a>
+<a name='L509'></a><a href='#L509'>509</a>
+<a name='L510'></a><a href='#L510'>510</a>
+<a name='L511'></a><a href='#L511'>511</a>
+<a name='L512'></a><a href='#L512'>512</a>
+<a name='L513'></a><a href='#L513'>513</a>
+<a name='L514'></a><a href='#L514'>514</a>
+<a name='L515'></a><a href='#L515'>515</a>
+<a name='L516'></a><a href='#L516'>516</a>
+<a name='L517'></a><a href='#L517'>517</a>
+<a name='L518'></a><a href='#L518'>518</a>
+<a name='L519'></a><a href='#L519'>519</a>
+<a name='L520'></a><a href='#L520'>520</a>
+<a name='L521'></a><a href='#L521'>521</a>
+<a name='L522'></a><a href='#L522'>522</a>
+<a name='L523'></a><a href='#L523'>523</a>
+<a name='L524'></a><a href='#L524'>524</a>
+<a name='L525'></a><a href='#L525'>525</a>
+<a name='L526'></a><a href='#L526'>526</a>
+<a name='L527'></a><a href='#L527'>527</a>
+<a name='L528'></a><a href='#L528'>528</a>
+<a name='L529'></a><a href='#L529'>529</a>
+<a name='L530'></a><a href='#L530'>530</a>
+<a name='L531'></a><a href='#L531'>531</a>
+<a name='L532'></a><a href='#L532'>532</a>
+<a name='L533'></a><a href='#L533'>533</a>
+<a name='L534'></a><a href='#L534'>534</a>
+<a name='L535'></a><a href='#L535'>535</a>
+<a name='L536'></a><a href='#L536'>536</a>
+<a name='L537'></a><a href='#L537'>537</a>
+<a name='L538'></a><a href='#L538'>538</a>
+<a name='L539'></a><a href='#L539'>539</a>
+<a name='L540'></a><a href='#L540'>540</a>
+<a name='L541'></a><a href='#L541'>541</a>
+<a name='L542'></a><a href='#L542'>542</a>
+<a name='L543'></a><a href='#L543'>543</a>
+<a name='L544'></a><a href='#L544'>544</a>
+<a name='L545'></a><a href='#L545'>545</a>
+<a name='L546'></a><a href='#L546'>546</a>
+<a name='L547'></a><a href='#L547'>547</a>
+<a name='L548'></a><a href='#L548'>548</a>
+<a name='L549'></a><a href='#L549'>549</a>
+<a name='L550'></a><a href='#L550'>550</a>
+<a name='L551'></a><a href='#L551'>551</a>
+<a name='L552'></a><a href='#L552'>552</a>
+<a name='L553'></a><a href='#L553'>553</a>
+<a name='L554'></a><a href='#L554'>554</a>
+<a name='L555'></a><a href='#L555'>555</a>
+<a name='L556'></a><a href='#L556'>556</a>
+<a name='L557'></a><a href='#L557'>557</a>
+<a name='L558'></a><a href='#L558'>558</a>
+<a name='L559'></a><a href='#L559'>559</a>
+<a name='L560'></a><a href='#L560'>560</a>
+<a name='L561'></a><a href='#L561'>561</a>
+<a name='L562'></a><a href='#L562'>562</a>
+<a name='L563'></a><a href='#L563'>563</a>
+<a name='L564'></a><a href='#L564'>564</a>
+<a name='L565'></a><a href='#L565'>565</a>
+<a name='L566'></a><a href='#L566'>566</a>
+<a name='L567'></a><a href='#L567'>567</a>
+<a name='L568'></a><a href='#L568'>568</a>
+<a name='L569'></a><a href='#L569'>569</a>
+<a name='L570'></a><a href='#L570'>570</a>
+<a name='L571'></a><a href='#L571'>571</a>
+<a name='L572'></a><a href='#L572'>572</a>
+<a name='L573'></a><a href='#L573'>573</a>
+<a name='L574'></a><a href='#L574'>574</a>
+<a name='L575'></a><a href='#L575'>575</a>
+<a name='L576'></a><a href='#L576'>576</a>
+<a name='L577'></a><a href='#L577'>577</a>
+<a name='L578'></a><a href='#L578'>578</a>
+<a name='L579'></a><a href='#L579'>579</a>
+<a name='L580'></a><a href='#L580'>580</a>
+<a name='L581'></a><a href='#L581'>581</a>
+<a name='L582'></a><a href='#L582'>582</a>
+<a name='L583'></a><a href='#L583'>583</a>
+<a name='L584'></a><a href='#L584'>584</a>
+<a name='L585'></a><a href='#L585'>585</a>
+<a name='L586'></a><a href='#L586'>586</a>
+<a name='L587'></a><a href='#L587'>587</a>
+<a name='L588'></a><a href='#L588'>588</a>
+<a name='L589'></a><a href='#L589'>589</a>
+<a name='L590'></a><a href='#L590'>590</a>
+<a name='L591'></a><a href='#L591'>591</a>
+<a name='L592'></a><a href='#L592'>592</a>
+<a name='L593'></a><a href='#L593'>593</a>
+<a name='L594'></a><a href='#L594'>594</a>
+<a name='L595'></a><a href='#L595'>595</a>
+<a name='L596'></a><a href='#L596'>596</a>
+<a name='L597'></a><a href='#L597'>597</a>
+<a name='L598'></a><a href='#L598'>598</a>
+<a name='L599'></a><a href='#L599'>599</a>
+<a name='L600'></a><a href='#L600'>600</a>
+<a name='L601'></a><a href='#L601'>601</a>
+<a name='L602'></a><a href='#L602'>602</a>
+<a name='L603'></a><a href='#L603'>603</a>
+<a name='L604'></a><a href='#L604'>604</a>
+<a name='L605'></a><a href='#L605'>605</a>
+<a name='L606'></a><a href='#L606'>606</a>
+<a name='L607'></a><a href='#L607'>607</a>
+<a name='L608'></a><a href='#L608'>608</a>
+<a name='L609'></a><a href='#L609'>609</a>
+<a name='L610'></a><a href='#L610'>610</a>
+<a name='L611'></a><a href='#L611'>611</a>
+<a name='L612'></a><a href='#L612'>612</a>
+<a name='L613'></a><a href='#L613'>613</a>
+<a name='L614'></a><a href='#L614'>614</a>
+<a name='L615'></a><a href='#L615'>615</a>
+<a name='L616'></a><a href='#L616'>616</a>
+<a name='L617'></a><a href='#L617'>617</a>
+<a name='L618'></a><a href='#L618'>618</a>
+<a name='L619'></a><a href='#L619'>619</a>
+<a name='L620'></a><a href='#L620'>620</a>
+<a name='L621'></a><a href='#L621'>621</a>
+<a name='L622'></a><a href='#L622'>622</a>
+<a name='L623'></a><a href='#L623'>623</a>
+<a name='L624'></a><a href='#L624'>624</a>
+<a name='L625'></a><a href='#L625'>625</a>
+<a name='L626'></a><a href='#L626'>626</a>
+<a name='L627'></a><a href='#L627'>627</a>
+<a name='L628'></a><a href='#L628'>628</a>
+<a name='L629'></a><a href='#L629'>629</a>
+<a name='L630'></a><a href='#L630'>630</a>
+<a name='L631'></a><a href='#L631'>631</a>
+<a name='L632'></a><a href='#L632'>632</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type {
+  CreateServicePolicyOptions,
+  ServicePolicy,
+} from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import {</span>
+  BrokenCircuitError,
+  HttpError,
+  createServicePolicy,
+  handleWhen,
+} from '@metamask/controller-utils';
+<span class="cstat-no" title="statement not covered" >import { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';</span>
+<span class="cstat-no" title="statement not covered" >import { Duration, getErrorMessage, hasProperty } from '@metamask/utils';</span>
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+import { CircuitState, IDisposable } from 'cockatiel';
+<span class="cstat-no" title="statement not covered" >import deepmerge from 'deepmerge';</span>
+import type { Logger } from 'loglevel';
+&nbsp;
+import type { AbstractRpcService } from './abstract-rpc-service';
+import type { FetchOptions } from './shared';
+<span class="cstat-no" title="statement not covered" >import { projectLogger, createModuleLogger } from '../logger';</span>
+&nbsp;
+/**
+ * Options for the RpcService constructor.
+ */
+export type RpcServiceOptions = {
+  /**
+   * A function that can be used to convert a binary string into a
+   * base64-encoded ASCII string. Used to encode authorization credentials.
+   */
+  btoa: typeof btoa;
+  /**
+   * The URL of the RPC endpoint to hit.
+   */
+  endpointUrl: URL | string;
+  /**
+   * A function that can be used to make an HTTP request. If your JavaScript
+   * environment supports `fetch` natively, you'll probably want to pass that;
+   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).
+   */
+  fetch: typeof fetch;
+  /**
+   * A common set of options that will be used to make every request. Can be
+   * overridden on the request level (e.g. to add headers).
+   */
+  fetchOptions?: FetchOptions;
+  /**
+   * A `loglevel` logger.
+   */
+  logger?: Pick&lt;Logger, 'warn'&gt;;
+  /**
+   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is
+   * not accepted, as it is overwritten. See {@link createServicePolicy}.
+   */
+  policyOptions?: Omit&lt;CreateServicePolicyOptions, 'retryFilterPolicy'&gt;;
+};
+&nbsp;
+const log = <span class="cstat-no" title="statement not covered" >createModuleLogger(projectLogger, 'RpcService');</span>
+&nbsp;
+/**
+ * The maximum number of times that a failing service should be re-run before
+ * giving up.
+ */
+export const <span class="cstat-no" title="statement not covered" >DEFAULT_MAX_RETRIES = 4;</span>
+&nbsp;
+/**
+ * The maximum number of times that the service is allowed to fail before
+ * pausing further retries. This is set to a value such that if given a
+ * service that continually fails, the policy needs to be executed 3 times
+ * before further retries are paused.
+ */
+export const <span class="cstat-no" title="statement not covered" >DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;</span>
+&nbsp;
+/**
+ * The list of error messages that represent a failure to connect to the network.
+ *
+ * This list was derived from Sindre Sorhus's `is-network-error` package:
+ * &lt;https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js&gt;
+ */
+export const <span class="cstat-no" title="statement not covered" >CONNECTION_ERRORS = [</span>
+  // Chrome
+  {
+    constructorName: 'TypeError',
+    pattern: /network error/u,
+  },
+  // Chrome
+  {
+    constructorName: 'TypeError',
+    pattern: /Failed to fetch/u,
+  },
+  // Firefox
+  {
+    constructorName: 'TypeError',
+    pattern: /NetworkError when attempting to fetch resource\./u,
+  },
+  // Safari 16
+  {
+    constructorName: 'TypeError',
+    pattern: /The Internet connection appears to be offline\./u,
+  },
+  // Safari 17+
+  {
+    constructorName: 'TypeError',
+    pattern: /Load failed/u,
+  },
+  // `cross-fetch`
+  {
+    constructorName: 'TypeError',
+    pattern: /Network request failed/u,
+  },
+  // `node-fetch`
+  {
+    constructorName: 'FetchError',
+    pattern: /request to (.+) failed/u,
+  },
+  // Undici (Node.js)
+  {
+    constructorName: 'TypeError',
+    pattern: /fetch failed/u,
+  },
+  // Undici (Node.js)
+  {
+    constructorName: 'TypeError',
+    pattern: /terminated/u,
+  },
+];
+&nbsp;
+/**
+ * Custom JSON-RPC error codes for specific cases.
+ *
+ * These should be moved to `@metamask/rpc-errors` eventually.
+ */
+export const <span class="cstat-no" title="statement not covered" >CUSTOM_RPC_ERRORS = {</span>
+  unauthorized: -32006,
+  httpClientError: -32080,
+} as const;
+&nbsp;
+/**
+ * Determines whether the given error represents a failure to reach the network
+ * after request parameters have been validated.
+ *
+ * This is somewhat difficult to verify because JavaScript engines (and in
+ * some cases libraries) produce slightly different error messages for this
+ * particular scenario, and we need to account for this.
+ *
+ * @param error - The error.
+ * @returns True if the error indicates that the network cannot be connected to,
+ * and false otherwise.
+ */
+<span class="cstat-no" title="statement not covered" >export function <span class="fstat-no" title="function not covered" >i</span>sConnectionError(</span>error: unknown): boolean {
+<span class="cstat-no" title="statement not covered" >  <span class="missing-if-branch" title="if path not taken" >I</span>if (!(typeof error === 'object' &amp;&amp; error !== null &amp;&amp; 'message' in error)) {</span>
+<span class="cstat-no" title="statement not covered" >    return false;</span>
+  }
+&nbsp;
+  const { message } = <span class="cstat-no" title="statement not covered" >error;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >  return (</span>
+    typeof message === 'string' &amp;&amp;
+    !isNockError(message) &amp;&amp;
+    CONNECTION_ERRORS.some(<span class="fstat-no" title="function not covered" >({</span> constructorName, pattern }) =&gt; {
+<span class="cstat-no" title="statement not covered" >      return (</span>
+        error.constructor.name === constructorName &amp;&amp; pattern.test(message)
+      );
+    })
+  );
+}
+&nbsp;
+/**
+ * Determines whether the given error message refers to a Nock error.
+ *
+ * It's important that if we failed to mock a request in a test, the resulting
+ * error does not cause the request to be retried so that we can see it right
+ * away.
+ *
+ * @param message - The error message to test.
+ * @returns True if the message indicates a missing Nock mock, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isNockError(</span>message: string): boolean {
+<span class="cstat-no" title="statement not covered" >  return message.includes('Nock:');</span>
+}
+&nbsp;
+/**
+ * Determine whether the given error message indicates a failure to parse JSON.
+ *
+ * This is different in tests vs. implementation code because it may manifest as
+ * a FetchError or a SyntaxError.
+ *
+ * @param error - The error object to test.
+ * @returns True if the error indicates a JSON parse error, false otherwise.
+ */
+function <span class="fstat-no" title="function not covered" >isJsonParseError(</span>error: unknown): boolean {
+<span class="cstat-no" title="statement not covered" >  return (</span>
+    error instanceof SyntaxError ||
+    /invalid json/iu.test(getErrorMessage(error))
+  );
+}
+&nbsp;
+/**
+ * Guarantees a URL, even given a string. This is useful for checking components
+ * of that URL.
+ *
+ * @param endpointUrlOrUrlString - Either a URL object or a string that
+ * represents the URL of an endpoint.
+ * @returns A URL object.
+ */
+function <span class="fstat-no" title="function not covered" >getNormalizedEndpointUrl(</span>endpointUrlOrUrlString: URL | string): URL {
+<span class="cstat-no" title="statement not covered" >  return endpointUrlOrUrlString instanceof URL</span>
+    ? endpointUrlOrUrlString
+    : new URL(endpointUrlOrUrlString);
+}
+&nbsp;
+/**
+ * Strips username and password from a URL.
+ *
+ * @param url - The URL to strip credentials from.
+ * @returns A new URL object with credentials removed.
+ */
+function <span class="fstat-no" title="function not covered" >stripCredentialsFromUrl(</span>url: URL): URL {
+  const strippedUrl = <span class="cstat-no" title="statement not covered" >new URL(url.toString());</span>
+<span class="cstat-no" title="statement not covered" >  strippedUrl.username = '';</span>
+<span class="cstat-no" title="statement not covered" >  strippedUrl.password = '';</span>
+<span class="cstat-no" title="statement not covered" >  return strippedUrl;</span>
+}
+&nbsp;
+/**
+ * This class is responsible for making a request to an endpoint that implements
+ * the JSON-RPC protocol. It is designed to gracefully handle network and server
+ * failures, retrying requests using exponential backoff. It also offers a hook
+ * which can used to respond to slow requests.
+ */
+<span class="cstat-no" title="statement not covered" >export class R</span>pcService implements AbstractRpcService {
+  /**
+   * The URL of the RPC endpoint.
+   */
+  readonly endpointUrl: URL;
+&nbsp;
+  /**
+   * The last error that the retry policy captured (or `undefined` if the last
+   * execution of the service was successful).
+   */
+  lastError: Error | undefined;
+&nbsp;
+  /**
+   * The function used to make an HTTP request.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#fetch: typeof fetch;</span>
+&nbsp;
+  /**
+   * A common set of options that the request options will extend.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#fetchOptions: FetchOptions;</span>
+&nbsp;
+  /**
+   * A `loglevel` logger.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#logger: RpcServiceOptions['logger'];</span>
+&nbsp;
+  /**
+   * The policy that wraps the request.
+   */
+  readonly <span class="cstat-no" title="statement not covered" >#policy: ServicePolicy;</span>
+&nbsp;
+  /**
+   * Constructs a new RpcService object.
+   *
+   * @param options - The options. See {@link RpcServiceOptions}.
+   */
+<span class="fstat-no" title="function not covered" >  constructor(o</span>ptions: RpcServiceOptions) {
+    const {
+      btoa: givenBtoa,
+      endpointUrl,
+      fetch: givenFetch,
+      logger,
+      fetchOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+      policyOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+    } = <span class="cstat-no" title="statement not covered" >options;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#fetch = givenFetch;</span>
+    const normalizedUrl = <span class="cstat-no" title="statement not covered" >getNormalizedEndpointUrl(endpointUrl);</span>
+<span class="cstat-no" title="statement not covered" >    this.#fetchOptions = this.#getDefaultFetchOptions(</span>
+      normalizedUrl,
+      fetchOptions,
+      givenBtoa,
+    );
+<span class="cstat-no" title="statement not covered" >    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);</span>
+<span class="cstat-no" title="statement not covered" >    this.#logger = logger;</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    this.#policy = createServicePolicy({</span>
+      maxRetries: DEFAULT_MAX_RETRIES,
+      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+      ...policyOptions,
+      retryFilterPolicy: handleWhen(<span class="fstat-no" title="function not covered" >(e</span>rror) =&gt; {
+<span class="cstat-no" title="statement not covered" >        return (</span>
+          // Ignore errors where the request failed to establish
+          isConnectionError(error) ||
+          // Ignore server sent HTML error pages or truncated JSON responses
+          isJsonParseError(error) ||
+          // Ignore server overload errors
+          ('httpStatus' in error &amp;&amp;
+            (error.httpStatus === 502 ||
+              error.httpStatus === 503 ||
+              error.httpStatus === 504)) ||
+          (hasProperty(error, 'code') &amp;&amp;
+            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))
+        );
+      }),
+    });
+  }
+&nbsp;
+  /**
+   * Resets the underlying composite Cockatiel policy.
+   *
+   * This is useful in a collection of RpcServices where some act as failovers
+   * for others where you effectively want to invalidate the failovers when the
+   * primary recovers.
+   */
+<span class="fstat-no" title="function not covered" >  resetPolicy(</span>): void {
+<span class="cstat-no" title="statement not covered" >    this.#policy.reset();</span>
+  }
+&nbsp;
+  /**
+   * @returns The state of the underlying circuit.
+   */
+<span class="fstat-no" title="function not covered" >  getCircuitState(</span>): CircuitState {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.getCircuitState();</span>
+  }
+&nbsp;
+  /**
+   * Listens for when the RPC service retries the request.
+   *
+   * @param listener - The callback to be called when the retry occurs.
+   * @returns What {@link ServicePolicy.onRetry} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onRetry(</span>listener: Parameters&lt;AbstractRpcService['onRetry']&gt;[0]): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onRetry(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      listener({ ...data, endpointUrl: this.endpointUrl.toString() });</span>
+    });
+  }
+&nbsp;
+  /**
+   * Listens for when the RPC service retries the request too many times in a
+   * row, causing the underlying circuit to break.
+   *
+   * @param listener - The callback to be called when the circuit is broken.
+   * @returns What {@link ServicePolicy.onBreak} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onBreak(</span>listener: Parameters&lt;AbstractRpcService['onBreak']&gt;[0]): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onBreak(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+      // `{ isolated: true }` is a special object that shows up when `isolate`
+      // is called on the circuit breaker. Usually `isolate` is used to hold the
+      // circuit open, but we (ab)use this method in `createServicePolicy` to
+      // reset the circuit breaker policy. When we do this, we don't want to
+      // call `onBreak` handlers, because then it causes
+      // `NetworkController:rpcEndpointUnavailable` and
+      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we
+      // have to ignore that object here. The consequence is that `isolate`
+      // doesn't function the way it is intended, at least in the context of an
+      // RpcService. However, we are making a bet that we won't need to use it
+      // other than how we are already using it.
+<span class="cstat-no" title="statement not covered" >      <span class="missing-if-branch" title="if path not taken" >I</span>if (!('isolated' in data)) {</span>
+<span class="cstat-no" title="statement not covered" >        listener({ ...data, endpointUrl: this.endpointUrl.toString() });</span>
+      }
+    });
+  }
+&nbsp;
+  /**
+   * Listens for when the policy underlying this RPC service detects a slow
+   * request.
+   *
+   * @param listener - The callback to be called when the request is slow.
+   * @returns What {@link ServicePolicy.onDegraded} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onDegraded(</span>
+    listener: Parameters&lt;AbstractRpcService['onDegraded']&gt;[0],
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onDegraded(<span class="fstat-no" title="function not covered" >(d</span>ata) =&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });</span>
+    });
+  }
+&nbsp;
+  /**
+   * Listens for when the policy underlying this RPC service is available.
+   *
+   * @param listener - The callback to be called when the request is available.
+   * @returns What {@link ServicePolicy.onAvailable} returns.
+   * @see {@link createServicePolicy}
+   */
+<span class="fstat-no" title="function not covered" >  onAvailable(</span>
+    listener: Parameters&lt;AbstractRpcService['onAvailable']&gt;[0],
+  ): IDisposable {
+<span class="cstat-no" title="statement not covered" >    return this.#policy.onAvailable(<span class="fstat-no" title="function not covered" >() =</span>&gt; {</span>
+<span class="cstat-no" title="statement not covered" >      listener({ endpointUrl: this.endpointUrl.toString() });</span>
+    });
+  }
+&nbsp;
+  /**
+   * Makes a request to the RPC endpoint.
+   *
+   * This overload is specifically designed for `eth_getBlockByNumber`, which
+   * can return a `result` of `null` despite an expected `Result` being
+   * provided.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: JsonRpcRequest&lt;Params&gt; &amp; { method: 'eth_getBlockByNumber' },
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt; | JsonRpcResponse&lt;null&gt;&gt;;
+&nbsp;
+  /**
+   * Makes a request to the RPC endpoint.
+   *
+   * This overload is designed for all RPC methods except for
+   * `eth_getBlockByNumber`, which are expected to return a `result` of the
+   * expected `Result`.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    jsonRpcRequest: JsonRpcRequest&lt;Params&gt;,
+    fetchOptions?: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt;&gt;;
+&nbsp;
+<span class="fstat-no" title="function not covered" >  async </span>request&lt;Params extends JsonRpcParams, Result extends Json&gt;(
+    // The request object may be frozen and must not be mutated.
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions: FetchOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span>
+  ): Promise&lt;JsonRpcResponse&lt;Result | null&gt;&gt; {
+    const completeFetchOptions = <span class="cstat-no" title="statement not covered" >this.#getCompleteFetchOptions(</span>
+      jsonRpcRequest,
+      fetchOptions,
+    );
+<span class="cstat-no" title="statement not covered" >    return await this.#executeAndProcessRequest&lt;Result&gt;(completeFetchOptions);</span>
+  }
+&nbsp;
+  /**
+   * Constructs a default set of options to `fetch`.
+   *
+   * If a username and password are present in the URL, they are extracted to an
+   * Authorization header.
+   *
+   * @param endpointUrl - The endpoint URL.
+   * @param fetchOptions - The options to `fetch`.
+   * @param givenBtoa - An implementation of `btoa`.
+   * @returns The default fetch options.
+   */
+  #getDefaultFetchOptions(
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >    endpointUrl: URL,</span></span>
+    fetchOptions: FetchOptions,
+    givenBtoa: (stringToEncode: string) =&gt; string,
+  ): FetchOptions {
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (endpointUrl.username &amp;&amp; endpointUrl.password) {</span>
+      const authString = <span class="cstat-no" title="statement not covered" >`${endpointUrl.username}:${endpointUrl.password}`;</span>
+      const encodedCredentials = <span class="cstat-no" title="statement not covered" >givenBtoa(authString);</span>
+<span class="cstat-no" title="statement not covered" >      return deepmerge(fetchOptions, {</span>
+        headers: { Authorization: `Basic ${encodedCredentials}` },
+      });
+    }
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return fetchOptions;</span>
+  }<span class="fstat-no" title="function not covered" ></span>
+&nbsp;
+  /**
+   * Constructs a final set of options to pass to `fetch`. Note that the method
+   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request.
+   * @param fetchOptions - Custom `fetch` options.
+   * @returns The complete set of `fetch` options.
+   */
+  #getCompleteFetchOptions&lt;Params extends JsonRpcParams&gt;(
+    jsonRpcRequest: Readonly&lt;JsonRpcRequest&lt;Params&gt;&gt;,
+    fetchOptions: FetchOptions,
+  ): FetchOptions {
+    const defaultOptions = <span class="cstat-no" title="statement not covered" >{</span>
+      method: 'POST',
+      headers: {
+        Accept: 'application/json',
+        'Content-Type': 'application/json',
+      },
+    };
+    const mergedOptions = <span class="cstat-no" title="statement not covered" >deepmerge(</span>
+      defaultOptions,
+      deepmerge(this.#fetchOptions, fetchOptions),
+    );
+&nbsp;
+    const { id, jsonrpc, method, params } = <span class="cstat-no" title="statement not covered" >jsonRpcRequest;</span>
+    const body = <span class="cstat-no" title="statement not covered" >JSON.stringify({</span>
+      id,
+      jsonrpc,
+      method,
+      params,
+    });
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return { ...mergedOptions, body };</span>
+  }
+&nbsp;
+  /**
+   * Makes the request using the Cockatiel policy that this service creates.
+   *
+   * @param fetchOptions - The options for `fetch`; will be combined with the
+   * fetch options passed to the constructor
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async<span class="fstat-no" title="function not covered" > #executeAndProcessRequest&lt;Result extends Json&gt;(</span>
+    fetchOptions: FetchOptions,
+  ): Promise&lt;JsonRpcResponse&lt;Result&gt; | JsonRpcResponse&lt;null&gt;&gt; {
+    let response: Response | undefined;
+<span class="cstat-no" title="statement not covered" >    try {</span>
+<span class="cstat-no" title="statement not covered" >      log(</span>
+        `[${this.endpointUrl}] Circuit state`,
+        this.#policy.getCircuitState(),
+      );
+      const jsonDecodedResponse = <span class="cstat-no" title="statement not covered" >await this.#policy.execute(</span>
+<span class="fstat-no" title="function not covered" >        async </span>(context) =&gt; {
+<span class="cstat-no" title="statement not covered" >          log(</span>
+            'REQUEST INITIATED:',
+            this.endpointUrl.toString(),
+            '::',
+            fetchOptions,
+            // @ts-expect-error This property _is_ here, the type of
+            // ServicePolicy is just wrong.
+            `(attempt ${context.attempt + 1})`,
+          );
+<span class="cstat-no" title="statement not covered" >          response = await this.#fetch(this.endpointUrl, fetchOptions);</span>
+<span class="cstat-no" title="statement not covered" >          <span class="missing-if-branch" title="if path not taken" >I</span>if (!response.ok) {</span>
+<span class="cstat-no" title="statement not covered" >            throw new HttpError(response.status);</span>
+          }
+<span class="cstat-no" title="statement not covered" >          log(</span>
+            'REQUEST SUCCESSFUL:',
+            this.endpointUrl.toString(),
+            response.status,
+          );
+<span class="cstat-no" title="statement not covered" >          return await response.json();</span>
+        },
+      );
+<span class="cstat-no" title="statement not covered" >      this.lastError = undefined;</span>
+<span class="cstat-no" title="statement not covered" >      return jsonDecodedResponse;</span>
+    } catch (error) {
+<span class="cstat-no" title="statement not covered" >      log('REQUEST ERROR:', this.endpointUrl.toString(), error);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      this.lastError =</span>
+        error instanceof Error ? error : new Error(getErrorMessage(error));
+&nbsp;
+<span class="cstat-no" title="statement not covered" >      if (error instanceof HttpError) {</span>
+        const status = <span class="cstat-no" title="statement not covered" >error.httpStatus;</span>
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (status === 401) {</span>
+<span class="cstat-no" title="statement not covered" >          throw new JsonRpcError(</span>
+            CUSTOM_RPC_ERRORS.unauthorized,
+            'Unauthorized.',
+            {
+              httpStatus: status,
+            },
+          );
+        }
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (status === 429) {</span>
+<span class="cstat-no" title="statement not covered" >          throw rpcErrors.limitExceeded({</span>
+            message: 'Request is being rate limited.',
+            data: {
+              httpStatus: status,
+            },
+          });
+        }
+<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>if (status &gt;= 500 || status === 402 || status === 404) {</span>
+<span class="cstat-no" title="statement not covered" >          throw rpcErrors.resourceUnavailable({</span>
+            message: 'RPC endpoint not found or unavailable.',
+            data: {
+              httpStatus: status,
+            },
+          });
+        }
+&nbsp;
+        // Handle all other 4xx errors as generic HTTP client errors
+<span class="cstat-no" title="statement not covered" >        throw new JsonRpcError(</span>
+          CUSTOM_RPC_ERRORS.httpClientError,
+          'RPC endpoint returned HTTP client error.',
+          {
+            httpStatus: status,
+          },
+        );
+      } else <span class="cstat-no" title="statement not covered" >if (isJsonParseError(error)) {</span>
+<span class="cstat-no" title="statement not covered" >        throw rpcErrors.parse({</span>
+          message: 'RPC endpoint did not return JSON.',
+        });
+      } else <span class="cstat-no" title="statement not covered" ><span class="missing-if-branch" title="if path not taken" >I</span>if (error instanceof BrokenCircuitError) {</span>
+<span class="cstat-no" title="statement not covered" >        this.#logger?.warn(error);</span>
+        const remainingCircuitOpenDuration =
+<span class="cstat-no" title="statement not covered" >          this.#policy.getRemainingCircuitOpenDuration();</span>
+        const formattedRemainingCircuitOpenDuration = <span class="cstat-no" title="statement not covered" >Intl.NumberFormat(</span>
+          undefined,
+          { maximumFractionDigits: 2 },
+        ).format(
+          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /
+            Duration.Minute,
+        );
+<span class="cstat-no" title="statement not covered" >        throw rpcErrors.resourceUnavailable({</span>
+          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,
+        });
+      }
+<span class="cstat-no" title="statement not covered" >      throw error;</span>
+    }
+  }
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../../sorter.js"></script>
+        <script src="../../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/throttled-fetch.ts.html b/coverage/src/throttled-fetch.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..b534f1dd6aa69d0f17fb9a56c76dd67223a473f2
--- /dev/null
+++ b/coverage/src/throttled-fetch.ts.html
@@ -0,0 +1,427 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/throttled-fetch.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> throttled-fetch.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">68.18% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>15/22</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">71.42% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>5/7</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">66.66% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>4/6</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">66.66% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>14/21</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line medium'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a>
+<a name='L70'></a><a href='#L70'>70</a>
+<a name='L71'></a><a href='#L71'>71</a>
+<a name='L72'></a><a href='#L72'>72</a>
+<a name='L73'></a><a href='#L73'>73</a>
+<a name='L74'></a><a href='#L74'>74</a>
+<a name='L75'></a><a href='#L75'>75</a>
+<a name='L76'></a><a href='#L76'>76</a>
+<a name='L77'></a><a href='#L77'>77</a>
+<a name='L78'></a><a href='#L78'>78</a>
+<a name='L79'></a><a href='#L79'>79</a>
+<a name='L80'></a><a href='#L80'>80</a>
+<a name='L81'></a><a href='#L81'>81</a>
+<a name='L82'></a><a href='#L82'>82</a>
+<a name='L83'></a><a href='#L83'>83</a>
+<a name='L84'></a><a href='#L84'>84</a>
+<a name='L85'></a><a href='#L85'>85</a>
+<a name='L86'></a><a href='#L86'>86</a>
+<a name='L87'></a><a href='#L87'>87</a>
+<a name='L88'></a><a href='#L88'>88</a>
+<a name='L89'></a><a href='#L89'>89</a>
+<a name='L90'></a><a href='#L90'>90</a>
+<a name='L91'></a><a href='#L91'>91</a>
+<a name='L92'></a><a href='#L92'>92</a>
+<a name='L93'></a><a href='#L93'>93</a>
+<a name='L94'></a><a href='#L94'>94</a>
+<a name='L95'></a><a href='#L95'>95</a>
+<a name='L96'></a><a href='#L96'>96</a>
+<a name='L97'></a><a href='#L97'>97</a>
+<a name='L98'></a><a href='#L98'>98</a>
+<a name='L99'></a><a href='#L99'>99</a>
+<a name='L100'></a><a href='#L100'>100</a>
+<a name='L101'></a><a href='#L101'>101</a>
+<a name='L102'></a><a href='#L102'>102</a>
+<a name='L103'></a><a href='#L103'>103</a>
+<a name='L104'></a><a href='#L104'>104</a>
+<a name='L105'></a><a href='#L105'>105</a>
+<a name='L106'></a><a href='#L106'>106</a>
+<a name='L107'></a><a href='#L107'>107</a>
+<a name='L108'></a><a href='#L108'>108</a>
+<a name='L109'></a><a href='#L109'>109</a>
+<a name='L110'></a><a href='#L110'>110</a>
+<a name='L111'></a><a href='#L111'>111</a>
+<a name='L112'></a><a href='#L112'>112</a>
+<a name='L113'></a><a href='#L113'>113</a>
+<a name='L114'></a><a href='#L114'>114</a>
+<a name='L115'></a><a href='#L115'>115</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">5x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-yes">4x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">3x</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">2x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-yes">1x</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
+ * Configuration for network throttling by chain ID.
+ * Maps chain IDs (in hex format) to delay in milliseconds.
+ */
+export const NETWORK_THROTTLE_CONFIG: Record&lt;string, number&gt; = {
+  '0x2019': 2000, // Klaytn - 2s delay
+  '0x504': 1000, // Moonbeam - 1s delay
+  '0x505': 1000, // Moonriver - 1s delay
+  '0x4e454152': 1500, // Aurora - 1.5s delay
+};
+&nbsp;
+/**
+ * Creates a throttled fetch function that adds artificial delays before making requests.
+ * Useful for testing slow network conditions.
+ *
+ * @param delayMs - The delay in milliseconds to add before each request
+ * @param originalFetch - The original fetch function to wrap
+ * @returns A throttled fetch function
+ */
+export function createThrottledFetch(
+  delayMs: number,
+  originalFetch: typeof fetch,
+): typeof fetch {
+  if (delayMs &lt;= 0) {
+    return originalFetch;
+  }
+&nbsp;
+  return async (
+    input: RequestInfo | URL,
+    init?: RequestInit,
+  ): Promise&lt;Response&gt; =&gt; {
+    // Add artificial delay before making the request
+    await new Promise((resolve) =&gt; setTimeout(resolve, delayMs));
+    return originalFetch(input, init);
+  };
+}
+&nbsp;
+/**
+ * Creates a fetch function that applies throttling based on the chain ID.
+ * Extracts chain ID from the RPC endpoint URL to determine the appropriate delay.
+ *
+ * @param rpcEndpointUrl - The RPC endpoint URL (may contain chain ID context)
+ * @param chainId - The chain ID in hex format (e.g., '0x2019')
+ * @param originalFetch - The original fetch function to wrap
+ * @param throttleConfig - Optional custom throttle configuration map
+ * @returns A throttled fetch function if configured for this chain, otherwise the original
+ */
+export function createThrottledFetchForChainId(
+  rpcEndpointUrl: string,
+  chainId: string,
+  originalFetch: typeof fetch,
+  throttleConfig: Record&lt;string, number&gt; = NETWORK_THROTTLE_CONFIG,
+): typeof fetch {
+  const delayMs = throttleConfig[chainId] || 0;
+&nbsp;
+  if (delayMs === 0) {
+    return originalFetch;
+  }
+&nbsp;
+  console.log(
+    `[NetworkThrottle] Applying ${delayMs}ms delay to chain ${chainId} (${rpcEndpointUrl})`,
+  );
+&nbsp;
+  return createThrottledFetch(delayMs, originalFetch);
+}
+&nbsp;
+/**
+ * Creates a wrapped getRpcServiceOptions function that applies network throttling
+ * based on chain ID. This is meant to be used in NetworkController initialization.
+ *
+ * @param originalGetRpcServiceOptions - The original getRpcServiceOptions function
+ * @param getChainIdForUrl - Function to get the chain ID for a given RPC endpoint URL
+ * @param throttleConfig - Optional custom throttle configuration map
+ * @returns A wrapped getRpcServiceOptions function that applies throttling
+ *
+ * @example
+ * ```typescript
+ * const networkController = new NetworkController({
+ *   getRpcServiceOptions: createThrottledGetRpcServiceOptions(
+ *     (rpcEndpointUrl) =&gt; ({ fetch, btoa }),
+ *     (rpcEndpointUrl) =&gt; '0x1', // Get chainId from your config
+ *   ),
+ *   // ... other options
+ * });
+ * ```
+ */
+export function <span class="fstat-no" title="function not covered" >createThrottledGetRpcServiceOptions(</span>
+  originalGetRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) =&gt; { fetch: typeof fetch; btoa: typeof btoa; [key: string]: unknown },
+  getChainIdForUrl: (rpcEndpointUrl: string) =&gt; string | undefined,
+  throttleConfig: Record&lt;string, number&gt; = <span class="branch-0 cbranch-no" title="branch not covered" >NETWORK_THROTTLE_CONFIG,</span>
+): typeof originalGetRpcServiceOptions {
+<span class="cstat-no" title="statement not covered" >  return <span class="fstat-no" title="function not covered" >(r</span>pcEndpointUrl: string) =&gt; {</span>
+    const options = <span class="cstat-no" title="statement not covered" >originalGetRpcServiceOptions(rpcEndpointUrl);</span>
+    const chainId = <span class="cstat-no" title="statement not covered" >getChainIdForUrl(rpcEndpointUrl);</span>
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!chainId) {</span>
+<span class="cstat-no" title="statement not covered" >      return options;</span>
+    }
+&nbsp;
+    const throttledFetch = <span class="cstat-no" title="statement not covered" >createThrottledFetchForChainId(</span>
+      rpcEndpointUrl,
+      chainId,
+      options.fetch,
+      throttleConfig,
+    );
+&nbsp;
+<span class="cstat-no" title="statement not covered" >    return {</span>
+      ...options,
+      fetch: throttledFetch,
+    };
+  };
+}
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/coverage/src/types.ts.html b/coverage/src/types.ts.html
new file mode 100644
index 0000000000000000000000000000000000000000..055554b2ba8a17ba440e970800a689306a4efef6
--- /dev/null
+++ b/coverage/src/types.ts.html
@@ -0,0 +1,289 @@
+
+<!doctype html>
+<html lang="en">
+
+<head>
+    <title>Code coverage report for src/types.ts</title>
+    <meta charset="utf-8" />
+    <link rel="stylesheet" href="../prettify.css" />
+    <link rel="stylesheet" href="../base.css" />
+    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
+    <meta name="viewport" content="width=device-width, initial-scale=1" />
+    <style type='text/css'>
+        .coverage-summary .sorter {
+            background-image: url(../sort-arrow-sprite.png);
+        }
+    </style>
+</head>
+    
+<body>
+<div class='wrapper'>
+    <div class='pad1'>
+        <h1><a href="../index.html">All files</a> / <a href="index.html">src</a> types.ts</h1>
+        <div class='clearfix'>
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Statements</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Branches</span>
+                <span class='fraction'>0/2</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Functions</span>
+                <span class='fraction'>0/1</span>
+            </div>
+        
+            
+            <div class='fl pad1y space-right2'>
+                <span class="strong">0% </span>
+                <span class="quiet">Lines</span>
+                <span class='fraction'>0/3</span>
+            </div>
+        
+            
+        </div>
+        <p class="quiet">
+            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
+        </p>
+        <template id="filterTemplate">
+            <div class="quiet">
+                Filter:
+                <input type="search" id="fileSearch">
+            </div>
+        </template>
+    </div>
+    <div class='status-line low'></div>
+    <pre><table class="coverage">
+<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
+<a name='L2'></a><a href='#L2'>2</a>
+<a name='L3'></a><a href='#L3'>3</a>
+<a name='L4'></a><a href='#L4'>4</a>
+<a name='L5'></a><a href='#L5'>5</a>
+<a name='L6'></a><a href='#L6'>6</a>
+<a name='L7'></a><a href='#L7'>7</a>
+<a name='L8'></a><a href='#L8'>8</a>
+<a name='L9'></a><a href='#L9'>9</a>
+<a name='L10'></a><a href='#L10'>10</a>
+<a name='L11'></a><a href='#L11'>11</a>
+<a name='L12'></a><a href='#L12'>12</a>
+<a name='L13'></a><a href='#L13'>13</a>
+<a name='L14'></a><a href='#L14'>14</a>
+<a name='L15'></a><a href='#L15'>15</a>
+<a name='L16'></a><a href='#L16'>16</a>
+<a name='L17'></a><a href='#L17'>17</a>
+<a name='L18'></a><a href='#L18'>18</a>
+<a name='L19'></a><a href='#L19'>19</a>
+<a name='L20'></a><a href='#L20'>20</a>
+<a name='L21'></a><a href='#L21'>21</a>
+<a name='L22'></a><a href='#L22'>22</a>
+<a name='L23'></a><a href='#L23'>23</a>
+<a name='L24'></a><a href='#L24'>24</a>
+<a name='L25'></a><a href='#L25'>25</a>
+<a name='L26'></a><a href='#L26'>26</a>
+<a name='L27'></a><a href='#L27'>27</a>
+<a name='L28'></a><a href='#L28'>28</a>
+<a name='L29'></a><a href='#L29'>29</a>
+<a name='L30'></a><a href='#L30'>30</a>
+<a name='L31'></a><a href='#L31'>31</a>
+<a name='L32'></a><a href='#L32'>32</a>
+<a name='L33'></a><a href='#L33'>33</a>
+<a name='L34'></a><a href='#L34'>34</a>
+<a name='L35'></a><a href='#L35'>35</a>
+<a name='L36'></a><a href='#L36'>36</a>
+<a name='L37'></a><a href='#L37'>37</a>
+<a name='L38'></a><a href='#L38'>38</a>
+<a name='L39'></a><a href='#L39'>39</a>
+<a name='L40'></a><a href='#L40'>40</a>
+<a name='L41'></a><a href='#L41'>41</a>
+<a name='L42'></a><a href='#L42'>42</a>
+<a name='L43'></a><a href='#L43'>43</a>
+<a name='L44'></a><a href='#L44'>44</a>
+<a name='L45'></a><a href='#L45'>45</a>
+<a name='L46'></a><a href='#L46'>46</a>
+<a name='L47'></a><a href='#L47'>47</a>
+<a name='L48'></a><a href='#L48'>48</a>
+<a name='L49'></a><a href='#L49'>49</a>
+<a name='L50'></a><a href='#L50'>50</a>
+<a name='L51'></a><a href='#L51'>51</a>
+<a name='L52'></a><a href='#L52'>52</a>
+<a name='L53'></a><a href='#L53'>53</a>
+<a name='L54'></a><a href='#L54'>54</a>
+<a name='L55'></a><a href='#L55'>55</a>
+<a name='L56'></a><a href='#L56'>56</a>
+<a name='L57'></a><a href='#L57'>57</a>
+<a name='L58'></a><a href='#L58'>58</a>
+<a name='L59'></a><a href='#L59'>59</a>
+<a name='L60'></a><a href='#L60'>60</a>
+<a name='L61'></a><a href='#L61'>61</a>
+<a name='L62'></a><a href='#L62'>62</a>
+<a name='L63'></a><a href='#L63'>63</a>
+<a name='L64'></a><a href='#L64'>64</a>
+<a name='L65'></a><a href='#L65'>65</a>
+<a name='L66'></a><a href='#L66'>66</a>
+<a name='L67'></a><a href='#L67'>67</a>
+<a name='L68'></a><a href='#L68'>68</a>
+<a name='L69'></a><a href='#L69'>69</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-no">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span>
+<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import type { InfuraNetworkType, ChainId } from '@metamask/controller-utils';
+import type { BlockTracker as BaseBlockTracker } from '@metamask/eth-block-tracker';
+import type { InternalProvider } from '@metamask/eth-json-rpc-provider';
+import type { MiddlewareContext } from '@metamask/json-rpc-engine/v2';
+import type { Hex } from '@metamask/utils';
+&nbsp;
+export type Provider = InternalProvider&lt;
+  MiddlewareContext&lt;
+    { origin: string; skipCache: boolean } &amp; Record&lt;string, unknown&gt;
+  &gt;
+&gt;;
+&nbsp;
+export type BlockTracker = BaseBlockTracker &amp; {
+  checkForLatestBlock(): Promise&lt;string&gt;;
+};
+&nbsp;
+/**
+ * The type of network client that can be created.
+ */
+<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export enum N</span>etworkClientType {</span>
+<span class="cstat-no" title="statement not covered" >  Custom = 'custom',</span>
+<span class="cstat-no" title="statement not covered" >  Infura = 'infura',</span>
+}
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for a network.
+ */
+type CommonNetworkClientConfiguration = {
+  chainId: Hex;
+  failoverRpcUrls?: string[];
+  ticker: string;
+};
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for a custom
+ * network.
+ */
+export type CustomNetworkClientConfiguration =
+  CommonNetworkClientConfiguration &amp; {
+    rpcUrl: string;
+    type: NetworkClientType.Custom;
+  };
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for an Infura
+ * network.
+ */
+export type InfuraNetworkClientConfiguration =
+  CommonNetworkClientConfiguration &amp; {
+    network: InfuraNetworkType;
+    infuraProjectId: string;
+    type: NetworkClientType.Infura;
+  };
+&nbsp;
+/**
+ * A configuration object that can be used to create a client for a network.
+ */
+export type NetworkClientConfiguration =
+  | CustomNetworkClientConfiguration
+  | InfuraNetworkClientConfiguration;
+&nbsp;
+/**
+ * The Chain ID representing the additional networks to be included as default.
+ */
+export type AdditionalDefaultNetwork = (typeof ChainId)[
+  | 'megaeth-testnet'
+  | 'megaeth-testnet-v2'
+  | 'monad-testnet'];
+&nbsp;</pre></td></tr></table></pre>
+
+                <div class='push'></div><!-- for sticky footer -->
+            </div><!-- /wrapper -->
+            <div class='footer quiet pad2 space-top1 center small'>
+                Code coverage generated by
+                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
+                at 2026-01-13T19:28:22.397Z
+            </div>
+        <script src="../prettify.js"></script>
+        <script>
+            window.onload = function () {
+                prettyPrint();
+            };
+        </script>
+        <script src="../sorter.js"></script>
+        <script src="../block-navigation.js"></script>
+    </body>
+</html>
+    
\ No newline at end of file
diff --git a/dist/NetworkController.cjs b/dist/NetworkController.cjs
index 288b10d2737b0950ea9c083d728e6149c7eee76a..42972102aed0dd469700ffd6d4a04c5afdae7495 100644
--- a/dist/NetworkController.cjs
+++ b/dist/NetworkController.cjs
@@ -164,6 +164,12 @@ function getDefaultCustomNetworkConfigurationsByChainId() {
         [controller_utils_1.ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['megaeth-testnet']),
         [controller_utils_1.ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['megaeth-testnet-v2']),
         [controller_utils_1.ChainId['monad-testnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['monad-testnet']),
+        // Environment 3: Power User test networks
+        [controller_utils_1.ChainId['fantom-mainnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['fantom-mainnet']),
+        [controller_utils_1.ChainId['gnosis-mainnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['gnosis-mainnet']),
+        [controller_utils_1.ChainId['cronos-mainnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['cronos-mainnet']),
+        [controller_utils_1.ChainId['moonbeam-mainnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['moonbeam-mainnet']),
+        [controller_utils_1.ChainId['moonriver-mainnet']]: getCustomNetworkConfiguration(controller_utils_1.CustomNetworkType['moonriver-mainnet']),
     };
 }
 /**
diff --git a/dist/NetworkController.cjs.map b/dist/NetworkController.cjs.map
index f8ead9e8735094c813f1475ebb31a4dab1764128..de5088a3d666785a29ced66ac6d0ffb89618aca7 100644
--- a/dist/NetworkController.cjs.map
+++ b/dist/NetworkController.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"NetworkController.cjs","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport { BaseController } from '@metamask/base-controller';\nimport type { Partialize } from '@metamask/controller-utils';\nimport {\n  InfuraNetworkType,\n  CustomNetworkType,\n  NetworkType,\n  isSafeChainId,\n  isInfuraNetworkType,\n  ChainId,\n  NetworksTicker,\n  NetworkNickname,\n  BUILT_IN_CUSTOM_NETWORKS_RPC,\n  BUILT_IN_NETWORKS,\n} from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport EthQuery from '@metamask/eth-query';\nimport type { Messenger } from '@metamask/messenger';\nimport { errorCodes } from '@metamask/rpc-errors';\nimport {\n  createEventEmitterProxy,\n  createSwappableProxy,\n} from '@metamask/swappable-obj-proxy';\nimport type { SwappableProxy } from '@metamask/swappable-obj-proxy';\nimport type { Hex } from '@metamask/utils';\nimport { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';\nimport deepEqual from 'fast-deep-equal';\nimport type { Draft } from 'immer';\nimport { produce } from 'immer';\nimport { cloneDeep } from 'lodash';\nimport type { Logger } from 'loglevel';\nimport { createSelector } from 'reselect';\nimport * as URI from 'uri-js';\nimport { v4 as uuidV4 } from 'uuid';\n\nimport {\n  DEPRECATED_NETWORKS,\n  INFURA_BLOCKED_KEY,\n  NetworkStatus,\n} from './constants';\nimport type {\n  AutoManagedNetworkClient,\n  ProxyWithAccessibleTarget,\n} from './create-auto-managed-network-client';\nimport { createAutoManagedNetworkClient } from './create-auto-managed-network-client';\nimport { projectLogger, createModuleLogger } from './logger';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { NetworkClientType } from './types';\nimport type {\n  BlockTracker,\n  Provider,\n  CustomNetworkClientConfiguration,\n  InfuraNetworkClientConfiguration,\n  NetworkClientConfiguration,\n  AdditionalDefaultNetwork,\n} from './types';\n\nconst debugLog = createModuleLogger(projectLogger, 'NetworkController');\n\nconst INFURA_URL_REGEX =\n  /^https:\\/\\/(?<networkName>[^.]+)\\.infura\\.io\\/v\\d+\\/(?<apiKey>.+)$/u;\n\nexport type Block = {\n  baseFeePerGas?: string;\n};\n\n/**\n * Information about a network not held by any other part of state.\n */\nexport type NetworkMetadata = {\n  /**\n   * EIPs supported by the network.\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  EIPS: {\n    [eipNumber: number]: boolean;\n  };\n  /**\n   * Indicates the availability of the network\n   */\n  status: NetworkStatus;\n};\n\n/**\n * The type of an RPC endpoint.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport enum RpcEndpointType {\n  Custom = 'custom',\n  Infura = 'infura',\n}\n\n/**\n * An Infura RPC endpoint is a reference to a specific network that Infura\n * supports as well as an Infura account we own that we allow users to make use\n * of for free. We need to disambiguate these endpoints from custom RPC\n * endpoints, because while the types for these kinds of object both have the\n * same interface, the URL for an Infura endpoint contains the Infura project\n * ID, and we don't want this to be present in state. We therefore hide it by\n * representing it in the URL as `{infuraProjectId}`, which we replace this when\n * create network clients. But we need to know somehow that we only need to do\n * this replacement for Infura endpoints and not custom endpoints â€” hence the\n * separate type.\n */\nexport type InfuraRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: BuiltInNetworkClientId;\n  /**\n   * The type of this endpoint, always \"default\".\n   */\n  type: RpcEndpointType.Infura;\n  /**\n   * The URL of the endpoint. Expected to be a template with the string\n   * `{infuraProjectId}`, which will get replaced with the Infura project ID\n   * when the network client is created.\n   */\n  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;\n};\n\n/**\n * A custom RPC endpoint is a reference to a user-defined server which fronts an\n * EVM chain. It may refer to an Infura network, but only by coincidence.\n */\nexport type CustomRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: CustomNetworkClientId;\n  /**\n   * The type of this endpoint, always \"custom\".\n   */\n  type: RpcEndpointType.Custom;\n  /**\n   * The URL of the endpoint.\n   */\n  url: string;\n};\n\n/**\n * An RPC endpoint is a reference to a server which fronts an EVM chain. There\n * are two varieties of RPC endpoints: Infura and custom.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;\n\n/**\n * From a user perspective, a network configuration holds information about a\n * network that a user can select through the client. A \"network\" in this sense\n * can explicitly refer to an EVM chain that the user explicitly adds or doesn't\n * need to add (because it comes shipped with the client). The properties here\n * therefore directly map to fields that a user sees and can edit for a network\n * within the client.\n *\n * Internally, a network configuration represents a single conceptual EVM chain,\n * which is represented tangibly via multiple RPC endpoints. A \"network\" is then\n * something for which a network client object is created automatically or\n * created on demand when it is added to the client.\n */\nexport type NetworkConfiguration = {\n  /**\n   * A set of URLs that allows the user to view activity that has occurred on\n   * the chain.\n   */\n  blockExplorerUrls: string[];\n  /**\n   * The ID of the chain. Represented in hexadecimal format with a leading \"0x\"\n   * instead of decimal format so that when viewed out of context it can be\n   * unambiguously interpreted.\n   */\n  chainId: Hex;\n  /**\n   * A reference to a URL that the client will use by default to allow the user\n   * to view activity that has occurred on the chain. This index must refer to\n   * an item in `blockExplorerUrls`.\n   */\n  defaultBlockExplorerUrlIndex?: number;\n  /**\n   * A reference to an RPC endpoint that all requests will use by default in order to\n   * interact with the chain. This index must refer to an item in\n   * `rpcEndpoints`.\n   */\n  defaultRpcEndpointIndex: number;\n  /**\n   * The user-facing nickname assigned to the chain.\n   */\n  name: string;\n  /**\n   * The name of the currency to use for the chain.\n   */\n  nativeCurrency: string;\n  /**\n   * The collection of possible RPC endpoints that the client can use to\n   * interact with the chain.\n   */\n  rpcEndpoints: RpcEndpoint[];\n  /**\n   * Profile Sync - Network Sync field.\n   * Allows comparison of local network state with state to sync.\n   */\n  lastUpdatedAt?: number;\n};\n\n/**\n * A custom RPC endpoint in a new network configuration, meant to be used in\n * conjunction with `AddNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type AddNetworkCustomRpcEndpointFields = Omit<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * A new network configuration that `addNetwork` takes.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and are not represented by\n * network clients yet.\n */\nexport type AddNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * A custom RPC endpoint in an updated representation of a network\n * configuration, meant to be used in conjunction with `UpdateNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type UpdateNetworkCustomRpcEndpointFields = Partialize<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * An updated representation of an existing network configuration that\n * `updateNetwork` takes.\n *\n * Custom RPC endpoints may or may not have a `networkClientId` property; if\n * they do, then it is assumed that they already exist, and if not, then it is\n * assumed that they are new and are not represented by network clients yet.\n */\nexport type UpdateNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * `Object.keys()` is intentionally generic: it returns the keys of an object,\n * but it cannot make guarantees about the contents of that object, so the type\n * of the keys is merely `string[]`. While this is technically accurate, it is\n * also unnecessary if we have an object that we own and whose contents are\n * known exactly.\n *\n * TODO: Move to @metamask/utils.\n *\n * @param object - The object.\n * @returns The keys of an object, typed according to the type of the object\n * itself.\n */\nexport function knownKeysOf<Key extends PropertyKey>(\n  // TODO: Replace `any` with type\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  object: Partial<Record<Key, any>>,\n): Key[] {\n  return Object.keys(object) as Key[];\n}\n\n/**\n * Type guard for determining whether the given value is an error object with a\n * `code` property, such as an instance of Error.\n *\n * TODO: Move this to @metamask/utils.\n *\n * @param error - The object to check.\n * @returns True if `error` has a `code`, false otherwise.\n */\nfunction isErrorWithCode(error: unknown): error is { code: string | number } {\n  return typeof error === 'object' && error !== null && 'code' in error;\n}\n\n/**\n * The string that uniquely identifies an Infura network client.\n */\nexport type BuiltInNetworkClientId = InfuraNetworkType;\n\n/**\n * The string that uniquely identifies a custom network client.\n */\nexport type CustomNetworkClientId = string;\n\n/**\n * The string that uniquely identifies a network client.\n */\nexport type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;\n\n/**\n * Extra information about each network, such as whether it is accessible or\n * blocked and whether it supports EIP-1559, keyed by network client ID.\n */\nexport type NetworksMetadata = Record<NetworkClientId, NetworkMetadata>;\n\n/**\n * The state that NetworkController stores.\n */\nexport type NetworkState = {\n  /**\n   * The ID of the network client that the proxies returned by\n   * `getSelectedNetworkClient` currently point to.\n   */\n  selectedNetworkClientId: NetworkClientId;\n  /**\n   * The registry of networks and corresponding RPC endpoints that the\n   * controller can use to make requests for various chains.\n   *\n   * @see {@link NetworkConfiguration}\n   */\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>;\n  /**\n   * Extra information about each network, such as whether it is accessible or\n   * blocked and whether it supports EIP-1559, keyed by network client ID.\n   */\n  networksMetadata: NetworksMetadata;\n};\n\nconst controllerName = 'NetworkController';\n\n/**\n * Represents the block tracker for the currently selected network. (Note that\n * this is a proxy around a proxy: the inner one exists so that the block\n * tracker doesn't have to exist until it's used, and the outer one exists so\n * that the currently selected network can change without consumers needing to\n * refresh the object reference to that network.)\n */\nexport type BlockTrackerProxy = SwappableProxy<\n  ProxyWithAccessibleTarget<BlockTracker>\n>;\n\n/**\n * Represents the provider for the currently selected network. (Note that this\n * is a proxy around a proxy: the inner one exists so that the provider doesn't\n * have to exist until it's used, and the outer one exists so that the currently\n * selected network can change without consumers needing to refresh the object\n * reference to that network.)\n */\nexport type ProviderProxy = SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n\nexport type NetworkControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof controllerName,\n  NetworkState\n>;\n\n/**\n * `networkWillChange` is published when the current network is about to be\n * switched, but the new provider has not been created and no state changes have\n * occurred yet.\n */\nexport type NetworkControllerNetworkWillChangeEvent = {\n  type: 'NetworkController:networkWillChange';\n  payload: [NetworkState];\n};\n\n/**\n * `networkDidChange` is published after a provider has been created for a newly\n * switched network (but before the network has been confirmed to be available).\n */\nexport type NetworkControllerNetworkDidChangeEvent = {\n  type: 'NetworkController:networkDidChange';\n  payload: [NetworkState];\n};\n\n/**\n * `infuraIsBlocked` is published after the network is switched to an Infura\n * network, but when Infura returns an error blocking the user based on their\n * location.\n */\nexport type NetworkControllerInfuraIsBlockedEvent = {\n  type: 'NetworkController:infuraIsBlocked';\n  payload: [];\n};\n\n/**\n * `infuraIsBlocked` is published either after the network is switched to an\n * Infura network and Infura does not return an error blocking the user based on\n * their location, or the network is switched to a non-Infura network.\n */\nexport type NetworkControllerInfuraIsUnblockedEvent = {\n  type: 'NetworkController:infuraIsUnblocked';\n  payload: [];\n};\n\n/**\n * `networkAdded` is published after a network configuration is added to the\n * network configuration registry and network clients are created for it.\n */\nexport type NetworkControllerNetworkAddedEvent = {\n  type: 'NetworkController:networkAdded';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `networkRemoved` is published after a network configuration is removed from the\n * network configuration registry and once the network clients have been removed.\n */\nexport type NetworkControllerNetworkRemovedEvent = {\n  type: 'NetworkController:networkRemoved';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `NetworkController:rpcEndpointChainUnavailable` is published when, after\n * trying all endpoints in an endpoint chain, the last failover reaches a\n * maximum number of consecutive 5xx responses, breaking the underlying circuit.\n *\n * In other words, this event will not be published if a failover is available,\n * even if the primary is not.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the last failover in the\n * endpoint chain.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointChainUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointUnavailable` is published when any\n * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx\n * responses, breaking the underlying circuit.\n *\n * In other words, this event will be published if a primary is not available,\n * even if a failover is.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint which reached the\n * maximum number of consecutive 5xx responses. You can compare this to\n * `primaryEndpointUrl` to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainDegraded` is published for any of the\n * endpoints in an endpoint chain when one of the following two conditions hold\n * (and the chain is not already in a degraded state):\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainDegradedEvent = {\n  type: 'NetworkController:rpcEndpointChainDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n *\n * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints\n * in an endpoint chain when:\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint for which requests\n * failed or were slow to complete. You can compare this to `primaryEndpointUrl`\n * to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointDegradedEvent = {\n  type: 'NetworkController:rpcEndpointDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainAvailable` is published in one of two\n * cases:\n *\n * 1. The first time that a 2xx request is made to any of the endpoints in an\n * endpoint chain.\n * 2. When requests to any of the endpoints previously failed (placing the\n * endpoint in a degraded or unavailable status), but are now succeeding again.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainAvailableEvent = {\n  type: 'NetworkController:rpcEndpointChainAvailable';\n  payload: [\n    {\n      chainId: Hex;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointRetried` is published before a request to any\n * endpoint in an endpoint chain is retried.\n *\n * This is mainly useful for tests.\n *\n * @param payload - The event payload.\n * @param payload.attempt - The current attempt counter for the endpoint\n * (starting from 0).\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint being retried.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n * @see {@link RpcService} for the list of retriable errors.\n */\nexport type NetworkControllerRpcEndpointRetriedEvent = {\n  type: 'NetworkController:rpcEndpointRetried';\n  payload: [\n    {\n      attempt: number;\n      chainId: Hex;\n      endpointUrl: string;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\nexport type NetworkControllerEvents =\n  | NetworkControllerStateChangeEvent\n  | NetworkControllerNetworkWillChangeEvent\n  | NetworkControllerNetworkDidChangeEvent\n  | NetworkControllerInfuraIsBlockedEvent\n  | NetworkControllerInfuraIsUnblockedEvent\n  | NetworkControllerNetworkAddedEvent\n  | NetworkControllerNetworkRemovedEvent\n  | NetworkControllerRpcEndpointChainUnavailableEvent\n  | NetworkControllerRpcEndpointUnavailableEvent\n  | NetworkControllerRpcEndpointChainDegradedEvent\n  | NetworkControllerRpcEndpointDegradedEvent\n  | NetworkControllerRpcEndpointChainAvailableEvent\n  | NetworkControllerRpcEndpointRetriedEvent;\n\n/**\n * All events that {@link NetworkController} calls internally.\n */\ntype AllowedEvents = never;\n\nexport type NetworkControllerGetStateAction = ControllerGetStateAction<\n  typeof controllerName,\n  NetworkState\n>;\n\nexport type NetworkControllerGetEthQueryAction = {\n  type: `NetworkController:getEthQuery`;\n  handler: () => EthQuery | undefined;\n};\n\nexport type NetworkControllerGetNetworkClientByIdAction = {\n  type: `NetworkController:getNetworkClientById`;\n  handler: NetworkController['getNetworkClientById'];\n};\n\nexport type NetworkControllerGetSelectedNetworkClientAction = {\n  type: `NetworkController:getSelectedNetworkClient`;\n  handler: NetworkController['getSelectedNetworkClient'];\n};\n\nexport type NetworkControllerGetSelectedChainIdAction = {\n  type: 'NetworkController:getSelectedChainId';\n  handler: NetworkController['getSelectedChainId'];\n};\n\nexport type NetworkControllerGetEIP1559CompatibilityAction = {\n  type: `NetworkController:getEIP1559Compatibility`;\n  handler: NetworkController['getEIP1559Compatibility'];\n};\n\nexport type NetworkControllerFindNetworkClientIdByChainIdAction = {\n  type: `NetworkController:findNetworkClientIdByChainId`;\n  handler: NetworkController['findNetworkClientIdByChainId'];\n};\n\n/**\n * Change the currently selected network to the given built-in network type.\n *\n * @deprecated This action has been replaced by `setActiveNetwork`, and will be\n * removed in a future release.\n */\nexport type NetworkControllerSetProviderTypeAction = {\n  type: `NetworkController:setProviderType`;\n  handler: NetworkController['setProviderType'];\n};\n\nexport type NetworkControllerSetActiveNetworkAction = {\n  type: `NetworkController:setActiveNetwork`;\n  handler: NetworkController['setActiveNetwork'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByChainId = {\n  type: `NetworkController:getNetworkConfigurationByChainId`;\n  handler: NetworkController['getNetworkConfigurationByChainId'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByNetworkClientId = {\n  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;\n  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];\n};\n\nexport type NetworkControllerAddNetworkAction = {\n  type: 'NetworkController:addNetwork';\n  handler: NetworkController['addNetwork'];\n};\n\nexport type NetworkControllerRemoveNetworkAction = {\n  type: 'NetworkController:removeNetwork';\n  handler: NetworkController['removeNetwork'];\n};\n\nexport type NetworkControllerUpdateNetworkAction = {\n  type: 'NetworkController:updateNetwork';\n  handler: NetworkController['updateNetwork'];\n};\n\nexport type NetworkControllerActions =\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetEthQueryAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | NetworkControllerGetSelectedNetworkClientAction\n  | NetworkControllerGetSelectedChainIdAction\n  | NetworkControllerGetEIP1559CompatibilityAction\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerSetActiveNetworkAction\n  | NetworkControllerSetProviderTypeAction\n  | NetworkControllerGetNetworkConfigurationByChainId\n  | NetworkControllerGetNetworkConfigurationByNetworkClientId\n  | NetworkControllerAddNetworkAction\n  | NetworkControllerRemoveNetworkAction\n  | NetworkControllerUpdateNetworkAction;\n\n/**\n * All actions that {@link NetworkController} calls internally.\n */\ntype AllowedActions = never;\n\nexport type NetworkControllerMessenger = Messenger<\n  typeof controllerName,\n  NetworkControllerActions | AllowedActions,\n  NetworkControllerEvents | AllowedEvents\n>;\n\n/**\n * Options for the NetworkController constructor.\n */\nexport type NetworkControllerOptions = {\n  /**\n   * The messenger suited for this controller.\n   */\n  messenger: NetworkControllerMessenger;\n  /**\n   * The API key for Infura, used to make requests to Infura.\n   */\n  infuraProjectId: string;\n  /**\n   * The desired state with which to initialize this controller.\n   * Missing properties will be filled in with defaults. For instance, if not\n   * specified, `networkConfigurationsByChainId` will default to a basic set of\n   * network configurations (see {@link InfuraNetworkType} for the list).\n   */\n  state?: Partial<NetworkState>;\n  /**\n   * A `loglevel` logger object.\n   */\n  log?: Logger;\n  /**\n   * A function that can be used to customize a RPC service constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object with type {@link RpcServiceOptions}, minus `failoverService`\n   * and `endpointUrl` (as they are filled in automatically).\n   */\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  /**\n   * A function that can be used to customize a block tracker constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as\n   * it is filled in automatically).\n   */\n  getBlockTrackerOptions?: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  /**\n   * An array of Hex Chain IDs representing the additional networks to be included as default.\n   */\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[];\n  /**\n   * Whether or not requests sent to unavailable RPC endpoints should be\n   * automatically diverted to configured failover RPC endpoints.\n   */\n  isRpcFailoverEnabled?: boolean;\n};\n\n/**\n * Constructs a value for the state property `networkConfigurationsByChainId`\n * which will be used if it has not been provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default value for `networkConfigurationsByChainId`.\n */\nfunction getDefaultNetworkConfigurationsByChainId(\n  additionalDefaultNetworks: AdditionalDefaultNetwork[] = [],\n): Record<Hex, NetworkConfiguration> {\n  const infuraNetworks = getDefaultInfuraNetworkConfigurationsByChainId();\n  const customNetworks = getDefaultCustomNetworkConfigurationsByChainId();\n\n  return additionalDefaultNetworks.reduce<Record<Hex, NetworkConfiguration>>(\n    (obj, chainId) => {\n      if (hasProperty(customNetworks, chainId)) {\n        obj[chainId] = customNetworks[chainId];\n      }\n      return obj;\n    },\n    // Always include the infura networks in the default networks\n    infuraNetworks,\n  );\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all Infura networks.\n */\nfunction getDefaultInfuraNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  return Object.values(InfuraNetworkType).reduce<\n    Record<Hex, NetworkConfiguration>\n  >((obj, infuraNetworkType) => {\n    const chainId = ChainId[infuraNetworkType];\n\n    // Skip deprecated network as default network.\n    if (DEPRECATED_NETWORKS.has(chainId)) {\n      return obj;\n    }\n\n    const rpcEndpointUrl =\n      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;\n\n    const networkConfiguration: NetworkConfiguration = {\n      blockExplorerUrls: [],\n      chainId,\n      defaultRpcEndpointIndex: 0,\n      name: NetworkNickname[infuraNetworkType],\n      nativeCurrency: NetworksTicker[infuraNetworkType],\n      rpcEndpoints: [\n        {\n          failoverUrls: [],\n          networkClientId: infuraNetworkType,\n          type: RpcEndpointType.Infura,\n          url: rpcEndpointUrl,\n        },\n      ],\n    };\n\n    return { ...obj, [chainId]: networkConfiguration };\n  }, {});\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default custom networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all custom networks.\n */\nfunction getDefaultCustomNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  // Create the `networkConfigurationsByChainId` objects explicitly,\n  // Because it is not always guaranteed that the custom networks are included in the\n  // default networks.\n  return {\n    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet'],\n    ),\n    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet-v2'],\n    ),\n    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['monad-testnet'],\n    ),\n  };\n}\n\n/**\n * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.\n *\n * @param customNetworkType - The type of the custom network.\n * @returns The `NetworkConfiguration` object.\n */\nfunction getCustomNetworkConfiguration(\n  customNetworkType: CustomNetworkType,\n): NetworkConfiguration {\n  const { ticker, rpcPrefs } = BUILT_IN_NETWORKS[customNetworkType];\n  const rpcEndpointUrl = BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];\n\n  return {\n    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],\n    chainId: ChainId[customNetworkType],\n    defaultRpcEndpointIndex: 0,\n    defaultBlockExplorerUrlIndex: 0,\n    name: NetworkNickname[customNetworkType],\n    nativeCurrency: ticker,\n    rpcEndpoints: [\n      {\n        failoverUrls: [],\n        networkClientId: customNetworkType,\n        type: RpcEndpointType.Custom,\n        url: rpcEndpointUrl,\n      },\n    ],\n  };\n}\n\n/**\n * Constructs properties for the NetworkController state whose values will be\n * used if not provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default NetworkController state.\n */\nexport function getDefaultNetworkControllerState(\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[],\n): NetworkState {\n  const networksMetadata = {};\n  const networkConfigurationsByChainId =\n    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);\n\n  return {\n    selectedNetworkClientId: InfuraNetworkType.mainnet,\n    networksMetadata,\n    networkConfigurationsByChainId,\n  };\n}\n\n/**\n * Redux selector for getting all network configurations from NetworkController\n * state, keyed by chain ID.\n *\n * @param state - NetworkController state\n * @returns All registered network configurations, keyed by chain ID.\n */\nconst selectNetworkConfigurationsByChainId = (\n  state: NetworkState,\n): Record<`0x${string}`, NetworkConfiguration> =>\n  state.networkConfigurationsByChainId;\n\n/**\n * Get a list of all network configurations.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport function getNetworkConfigurations(\n  state: NetworkState,\n): NetworkConfiguration[] {\n  return Object.values(state.networkConfigurationsByChainId);\n}\n\n/**\n * Redux selector for getting a list of all network configurations from\n * NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport const selectNetworkConfigurations = createSelector(\n  selectNetworkConfigurationsByChainId,\n  (networkConfigurationsByChainId) =>\n    Object.values(networkConfigurationsByChainId),\n);\n\n/**\n * Get a list of all available network client IDs from a list of network\n * configurations.\n *\n * @param networkConfigurations - The array of network configurations\n * @returns A list of all available client IDs\n */\nexport function getAvailableNetworkClientIds(\n  networkConfigurations: NetworkConfiguration[],\n): string[] {\n  return networkConfigurations.flatMap((networkConfiguration) =>\n    networkConfiguration.rpcEndpoints.map(\n      (rpcEndpoint) => rpcEndpoint.networkClientId,\n    ),\n  );\n}\n\n/**\n * Redux selector for getting a list of all available network client IDs\n * from NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network client IDs.\n */\nexport const selectAvailableNetworkClientIds = createSelector(\n  selectNetworkConfigurations,\n  getAvailableNetworkClientIds,\n);\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedBuiltInNetworkClientRegistry = Record<\n  BuiltInNetworkClientId,\n  AutoManagedNetworkClient<InfuraNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedCustomNetworkClientRegistry = Record<\n  CustomNetworkClientId,\n  AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks\n * as well as custom networks that users have added.\n */\nexport type AutoManagedNetworkClientRegistry = {\n  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;\n  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to create a network client for an\n * RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype AddNetworkClientOperation = {\n  type: 'add';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `updateNetwork` and `removeNetwork` to remove a network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype RemoveNetworkClientOperation = {\n  type: 'remove';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to replace the network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype ReplaceNetworkClientOperation = {\n  type: 'replace';\n  oldRpcEndpoint: RpcEndpoint;\n  newRpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC\n * endpoint, as far as the network client registry is concerned.\n *\n * @see {@link NetworkClientOperation}\n */\ntype NoopNetworkClientOperation = {\n  type: 'noop';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to\n * update the network client registry.\n *\n * - When `addNetwork` is called, represents a network client that should be\n * created for a new RPC endpoint.\n * - When `removeNetwork` is called, represents a network client that should be\n * destroyed for a previously existing RPC endpoint.\n * - When `updateNetwork` is called, represents either:\n *   - a network client that should be added for a new RPC endpoint\n *   - a network client that should be removed for a previously existing RPC\n *   endpoint\n *   - a network client that should be replaced for an RPC endpoint that was\n *   changed in a non-major way, or\n *   - a network client that should be unchanged for an RPC endpoint that was\n *   also unchanged.\n */\ntype NetworkClientOperation =\n  | AddNetworkClientOperation\n  | RemoveNetworkClientOperation\n  | ReplaceNetworkClientOperation\n  | NoopNetworkClientOperation;\n\n/**\n * Determines whether the given URL is valid by attempting to parse it.\n *\n * @param url - The URL to test.\n * @returns True if the URL is valid, false otherwise.\n */\nfunction isValidUrl(url: string): boolean {\n  const uri = URI.parse(url);\n  return (\n    uri.error === undefined && (uri.scheme === 'http' || uri.scheme === 'https')\n  );\n}\n\n/**\n * Given an Infura API URL, extracts the subdomain that identifies the Infura\n * network.\n *\n * @param rpcEndpointUrl - The URL to operate on.\n * @returns The Infura network name that the URL references.\n * @throws if the URL is not an Infura API URL, or if an Infura network is not\n * present in the URL.\n */\nfunction deriveInfuraNetworkNameFromRpcEndpointUrl(\n  rpcEndpointUrl: string,\n): InfuraNetworkType {\n  const match = INFURA_URL_REGEX.exec(rpcEndpointUrl);\n\n  if (match?.groups) {\n    if (isInfuraNetworkType(match.groups.networkName)) {\n      return match.groups.networkName;\n    }\n\n    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);\n  }\n\n  throw new Error('Could not derive Infura network from RPC endpoint URL');\n}\n\n/**\n * Performs a series of checks that the given NetworkController state is\n * internally consistent â€” that all parts of state that are supposed to match in\n * fact do â€” so that working with the state later on doesn't cause unexpected\n * errors.\n *\n * In the case of NetworkController, there are several parts of state that need\n * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry\n * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC\n * endpoint within a network configuration.\n *\n * @param state - The NetworkController state to verify.\n * @throws if the state is invalid in some way.\n */\nfunction validateInitialState(state: NetworkState): void {\n  const networkConfigurationEntries = Object.entries(\n    state.networkConfigurationsByChainId,\n  );\n  const networkClientIds = getAvailableNetworkClientIds(\n    getNetworkConfigurations(state),\n  );\n\n  if (networkConfigurationEntries.length === 0) {\n    throw new Error(\n      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',\n    );\n  }\n\n  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {\n    if (chainId !== networkConfiguration.chainId) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \\`chainId\\` of '${networkConfiguration.chainId}'`,\n      );\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkConfiguration.blockExplorerUrls.length > 0\n        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||\n          networkConfiguration.blockExplorerUrls[\n            networkConfiguration.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultBlockExplorerUrlIndex\\` that does not refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ] === undefined\n    ) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultRpcEndpointIndex\\` that does not refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n    throw new Error(\n      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',\n    );\n  }\n}\n\n/**\n * Checks that the given initial NetworkController state is internally\n * consistent similar to `validateInitialState`, but if an anomaly is detected,\n * it does its best to correct the state and logs an error to Sentry.\n *\n * @param state - The NetworkController state to verify.\n * @param messenger - The NetworkController messenger.\n * @returns The corrected state.\n */\nfunction correctInitialState(\n  state: NetworkState,\n  messenger: NetworkControllerMessenger,\n): NetworkState {\n  const networkConfigurationsSortedByChainId = getNetworkConfigurations(\n    state,\n  ).sort((a, b) => a.chainId.localeCompare(b.chainId));\n  const availableNetworkClientIds = getAvailableNetworkClientIds(\n    networkConfigurationsSortedByChainId,\n  );\n  const invalidNetworkClientIdsWithMetadata = Object.keys(\n    state.networksMetadata,\n  ).filter(\n    (networkClientId) => !availableNetworkClientIds.includes(networkClientId),\n  );\n\n  return produce(state, (newState) => {\n    if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {\n      const firstNetworkConfiguration = networkConfigurationsSortedByChainId[0];\n      const newSelectedNetworkClientId =\n        firstNetworkConfiguration.rpcEndpoints[\n          firstNetworkConfiguration.defaultRpcEndpointIndex\n        ].networkClientId;\n      messenger.captureException?.(\n        new Error(\n          `\\`selectedNetworkClientId\\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,\n        ),\n      );\n      newState.selectedNetworkClientId = newSelectedNetworkClientId;\n    }\n\n    if (invalidNetworkClientIdsWithMetadata.length > 0) {\n      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {\n        delete newState.networksMetadata[invalidNetworkClientId];\n      }\n      messenger.captureException?.(\n        new Error(\n          '`networksMetadata` had invalid network client IDs, which have been removed',\n        ),\n      );\n    }\n  });\n}\n\n/**\n * Transforms a map of chain ID to network configuration to a map of network\n * client ID to network configuration.\n *\n * @param networkConfigurationsByChainId - The network configurations, keyed by\n * chain ID.\n * @returns The network configurations, keyed by network client ID.\n */\nfunction buildNetworkConfigurationsByNetworkClientId(\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>,\n): Map<NetworkClientId, NetworkConfiguration> {\n  return new Map(\n    Object.values(networkConfigurationsByChainId).flatMap(\n      (networkConfiguration) => {\n        return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n          return [rpcEndpoint.networkClientId, networkConfiguration];\n        });\n      },\n    ),\n  );\n}\n\n/**\n * Controller that creates and manages an Ethereum network provider.\n */\nexport class NetworkController extends BaseController<\n  typeof controllerName,\n  NetworkState,\n  NetworkControllerMessenger\n> {\n  #ethQuery?: EthQuery;\n\n  readonly #infuraProjectId: string;\n\n  #previouslySelectedNetworkClientId: string;\n\n  #providerProxy: ProviderProxy | undefined;\n\n  #blockTrackerProxy: BlockTrackerProxy | undefined;\n\n  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;\n\n  #autoManagedNetworkClient?:\n    | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n    | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  readonly #log: Logger | undefined;\n\n  readonly #getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];\n\n  readonly #getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];\n\n  #networkConfigurationsByNetworkClientId: Map<\n    NetworkClientId,\n    NetworkConfiguration\n  >;\n\n  #isRpcFailoverEnabled: Exclude<\n    NetworkControllerOptions['isRpcFailoverEnabled'],\n    undefined\n  >;\n\n  /**\n   * Constructs a NetworkController.\n   *\n   * @param options - The options; see {@link NetworkControllerOptions}.\n   */\n  constructor(options: NetworkControllerOptions) {\n    const {\n      messenger,\n      state,\n      infuraProjectId,\n      log,\n      getRpcServiceOptions,\n      getBlockTrackerOptions,\n      additionalDefaultNetworks,\n      isRpcFailoverEnabled = false,\n    } = options;\n    const initialState = {\n      ...getDefaultNetworkControllerState(additionalDefaultNetworks),\n      ...state,\n    };\n    validateInitialState(initialState);\n    const correctedInitialState = correctInitialState(initialState, messenger);\n\n    if (!infuraProjectId || typeof infuraProjectId !== 'string') {\n      throw new Error('Invalid Infura project ID');\n    }\n\n    super({\n      name: controllerName,\n      metadata: {\n        selectedNetworkClientId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networksMetadata: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networkConfigurationsByChainId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n      },\n      messenger,\n      state: correctedInitialState,\n    });\n\n    this.#infuraProjectId = infuraProjectId;\n    this.#log = log;\n    this.#getRpcServiceOptions = getRpcServiceOptions;\n    this.#getBlockTrackerOptions = getBlockTrackerOptions;\n    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;\n\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        this.state.networkConfigurationsByChainId,\n      );\n\n    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, () => {\n      return this.#ethQuery;\n    });\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkClientById`,\n      this.getNetworkClientById.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getEIP1559Compatibility`,\n      this.getEIP1559Compatibility.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setActiveNetwork`,\n      this.setActiveNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setProviderType`,\n      this.setProviderType.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:findNetworkClientIdByChainId`,\n      this.findNetworkClientIdByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByChainId`,\n      this.getNetworkConfigurationByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByNetworkClientId`,\n      this.getNetworkConfigurationByNetworkClientId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedNetworkClient`,\n      this.getSelectedNetworkClient.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedChainId`,\n      this.getSelectedChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:addNetwork`,\n      this.addNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:removeNetwork`,\n      this.removeNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:updateNetwork`,\n      this.updateNetwork.bind(this),\n    );\n\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainUnavailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Unavailable,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainDegraded`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Degraded,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainAvailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Available,\n        });\n      },\n    );\n  }\n\n  /**\n   * Enables the RPC failover functionality. That is, if any RPC endpoints are\n   * configured with failover URLs, then traffic will automatically be diverted\n   * to them if those RPC endpoints are unavailable.\n   */\n  enableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(true);\n  }\n\n  /**\n   * Disables the RPC failover functionality. That is, even if any RPC endpoints\n   * are configured with failover URLs, then traffic will not automatically be\n   * diverted to them if those RPC endpoints are unavailable.\n   */\n  disableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(false);\n  }\n\n  /**\n   * Enables or disables the RPC failover functionality, depending on the\n   * boolean given. This is done by reconstructing all network clients that were\n   * originally configured with failover URLs so that those URLs are either\n   * honored or ignored. Network client IDs will be preserved so as not to\n   * invalidate state in other controllers.\n   *\n   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the\n   * RPC failover functionality.\n   */\n  #updateRpcFailoverEnabled(newIsRpcFailoverEnabled: boolean): void {\n    if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {\n      return;\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    for (const networkClientsById of Object.values(\n      autoManagedNetworkClientRegistry,\n    )) {\n      for (const networkClientId of Object.keys(networkClientsById)) {\n        // Type assertion: We can assume that `networkClientId` is valid here.\n        const networkClient =\n          networkClientsById[\n            networkClientId as keyof typeof networkClientsById\n          ];\n        if (\n          networkClient.configuration.failoverRpcUrls &&\n          networkClient.configuration.failoverRpcUrls.length > 0\n        ) {\n          newIsRpcFailoverEnabled\n            ? networkClient.enableRpcFailover()\n            : networkClient.disableRpcFailover();\n        }\n      }\n    }\n\n    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns The proxy and block tracker proxies.\n   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.\n   */\n  getProviderAndBlockTracker(): {\n    provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>> | undefined;\n    blockTracker:\n      | SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>\n      | undefined;\n  } {\n    return {\n      provider: this.#providerProxy,\n      blockTracker: this.#blockTrackerProxy,\n    };\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns an object with the provider and block tracker proxies for the currently selected network.\n   */\n  getSelectedNetworkClient():\n    | {\n        provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n        blockTracker: SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>;\n      }\n    | undefined {\n    if (this.#providerProxy && this.#blockTrackerProxy) {\n      return {\n        provider: this.#providerProxy,\n        blockTracker: this.#blockTrackerProxy,\n      };\n    }\n    return undefined;\n  }\n\n  /**\n   * Accesses the chain ID from the selected network client.\n   *\n   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.\n   */\n  getSelectedChainId(): Hex | undefined {\n    const networkConfiguration = this.getNetworkConfigurationByNetworkClientId(\n      this.state.selectedNetworkClientId,\n    );\n    return networkConfiguration?.chainId;\n  }\n\n  /**\n   * Internally, the Infura and custom network clients are categorized by type\n   * so that when accessing either kind of network client, TypeScript knows\n   * which type to assign to the network client. For some cases it's more useful\n   * to be able to access network clients by ID instead of by type and then ID,\n   * so this function makes that possible.\n   *\n   * @returns The network clients registered so far, keyed by ID.\n   */\n  getNetworkClientRegistry(): AutoManagedBuiltInNetworkClientRegistry &\n    AutoManagedCustomNetworkClientRegistry {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    return Object.assign(\n      {},\n      autoManagedNetworkClientRegistry[NetworkClientType.Infura],\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom],\n    );\n  }\n\n  /**\n   * Returns the Infura network client with the given ID.\n   *\n   * @param infuraNetworkClientId - An Infura network client ID.\n   * @returns The Infura network client.\n   * @throws If an Infura network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    infuraNetworkClientId: BuiltInNetworkClientId,\n  ): AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  /**\n   * Returns the custom network client with the given ID.\n   *\n   * @param customNetworkClientId - A custom network client ID.\n   * @returns The custom network client.\n   * @throws If a custom network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    customNetworkClientId: CustomNetworkClientId,\n  ): AutoManagedNetworkClient<CustomNetworkClientConfiguration>;\n\n  getNetworkClientById(\n    networkClientId: NetworkClientId,\n  ): AutoManagedNetworkClient<NetworkClientConfiguration> {\n    if (!networkClientId) {\n      throw new Error('No network client ID was provided.');\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const infuraNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!infuraNetworkClient) {\n        throw new Error(\n          `No Infura network client was found with the ID \"${networkClientId}\".`,\n        );\n      }\n      return infuraNetworkClient;\n    }\n\n    const customNetworkClient =\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n        networkClientId\n      ];\n    if (!customNetworkClient) {\n      throw new Error(\n        `No custom network client was found with the ID \"${networkClientId}\".`,\n      );\n    }\n    return customNetworkClient;\n  }\n\n  /**\n   * Executes a series of steps to switch the network:\n   *\n   * 1. Notifies subscribers via the messenger that the network is about to be\n   * switched (and, really, that the global provider and block tracker proxies\n   * will be re-pointed to a new network).\n   * 2. Looks up a known and preinitialized network client matching the given\n   * ID and uses it to re-point the aforementioned provider and block tracker\n   * proxies.\n   * 3. Notifies subscribers via the messenger that the network has switched.\n   * 4. Captures metadata for the newly switched network in state.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   */\n  async #refreshNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.messenger.publish('NetworkController:networkWillChange', this.state);\n    this.#applyNetworkSelection(networkClientId, options);\n    this.messenger.publish('NetworkController:networkDidChange', this.state);\n    await this.lookupNetwork();\n  }\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   */\n  initializeProvider(options: { lookupNetwork: false }): void;\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   * @returns A promise that resolves when the network lookup completes.\n   */\n  initializeProvider(options?: { lookupNetwork?: boolean }): Promise<void>;\n\n  initializeProvider({\n    lookupNetwork = true,\n  }: {\n    lookupNetwork?: boolean;\n  } = {}): Promise<void> | undefined {\n    this.#applyNetworkSelection(this.state.selectedNetworkClientId);\n\n    if (lookupNetwork) {\n      return this.lookupNetwork();\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   * @returns The resulting metadata for the network.\n   */\n  async #determineNetworkMetadata(networkClientId: NetworkClientId): Promise<{\n    isInfura: boolean;\n    networkStatus:\n      | NetworkStatus.Available\n      | NetworkStatus.Unknown\n      | NetworkStatus.Unavailable\n      | NetworkStatus.Blocked;\n    isEIP1559Compatible: undefined | boolean;\n  }> {\n    // Force TypeScript to use one of the two overloads explicitly\n    const networkClient = isInfuraNetworkType(networkClientId)\n      ? this.getNetworkClientById(networkClientId)\n      : this.getNetworkClientById(networkClientId);\n\n    const isInfura =\n      networkClient.configuration.type === NetworkClientType.Infura;\n    let networkStatus: NetworkStatus;\n    let isEIP1559Compatible: boolean | undefined;\n\n    try {\n      isEIP1559Compatible =\n        await this.#determineEIP1559Compatibility(networkClientId);\n      networkStatus = NetworkStatus.Available;\n    } catch (error) {\n      debugLog('NetworkController: lookupNetwork: ', error);\n\n      if (isErrorWithCode(error)) {\n        let responseBody;\n        if (\n          isInfura &&\n          hasProperty(error, 'message') &&\n          typeof error.message === 'string'\n        ) {\n          try {\n            responseBody = JSON.parse(error.message);\n          } catch {\n            // error.message must not be JSON\n            this.#log?.warn(\n              'NetworkController: lookupNetwork: json parse error: ',\n              error,\n            );\n          }\n        }\n\n        if (\n          isPlainObject(responseBody) &&\n          responseBody.error === INFURA_BLOCKED_KEY\n        ) {\n          networkStatus = NetworkStatus.Blocked;\n        } else if (error.code === errorCodes.rpc.internal) {\n          networkStatus = NetworkStatus.Unknown;\n          this.#log?.warn(\n            'NetworkController: lookupNetwork: rpc internal error: ',\n            error,\n          );\n        } else {\n          networkStatus = NetworkStatus.Unavailable;\n          this.#log?.warn('NetworkController: lookupNetwork: ', error);\n        }\n      } else {\n        debugLog(\n          'NetworkController - could not determine network status',\n          error,\n        );\n        networkStatus = NetworkStatus.Unknown;\n        this.#log?.warn('NetworkController: lookupNetwork: ', error);\n      }\n    }\n\n    return { isInfura, networkStatus, isEIP1559Compatible };\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given or selected network, persisting it to state:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   */\n  async lookupNetwork(networkClientId?: NetworkClientId): Promise<void> {\n    if (networkClientId) {\n      await this.#lookupGivenNetwork(networkClientId);\n    } else {\n      await this.#lookupSelectedNetwork();\n    }\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * @deprecated Please use `lookupNetwork` and pass a network client ID\n   * instead. This method will be removed in a future major version.\n   */\n  // We are planning on removing this so we aren't interested in testing this\n  // right now.\n  /* istanbul ignore next */\n  async lookupNetworkByClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<void> {\n    await this.#lookupGivenNetwork(networkClientId);\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   */\n  async #lookupGivenNetwork(networkClientId: NetworkClientId): Promise<void> {\n    const { networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(networkClientId);\n\n    this.#updateMetadataForNetwork(networkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the currently selected network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * Note that it is possible for the current network to be switched while this\n   * method is running. If that is the case, it will exit early (as this method\n   * will also run for the new network).\n   */\n  async #lookupSelectedNetwork(): Promise<void> {\n    if (!this.#ethQuery) {\n      return;\n    }\n\n    let networkChanged = false;\n    const listener = (): void => {\n      networkChanged = true;\n      try {\n        this.messenger.unsubscribe(\n          'NetworkController:networkDidChange',\n          listener,\n        );\n      } catch (error) {\n        // In theory, this `catch` should not be necessary given that this error\n        // would occur \"inside\" of the call to `#determineEIP1559Compatibility`\n        // below and so it should be caught by the `try`/`catch` below (it is\n        // impossible to reproduce in tests for that reason). However, somehow\n        // it occurs within Mobile and so we have to add our own `try`/`catch`\n        // here.\n        /* istanbul ignore next */\n        if (\n          !(error instanceof Error) ||\n          error.message !==\n            'Subscription not found for event: NetworkController:networkDidChange'\n        ) {\n          // Again, this error should not happen and is impossible to reproduce\n          // in tests.\n          /* istanbul ignore next */\n          throw error;\n        }\n      }\n    };\n    this.messenger.subscribe('NetworkController:networkDidChange', listener);\n\n    const { isInfura, networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);\n\n    if (networkChanged) {\n      // If the network has changed, then `lookupNetwork` either has been or is\n      // in the process of being called, so we don't need to go further.\n      return;\n    }\n\n    try {\n      this.messenger.unsubscribe(\n        'NetworkController:networkDidChange',\n        listener,\n      );\n    } catch (error) {\n      if (\n        !(error instanceof Error) ||\n        error.message !==\n          'Subscription not found for event: NetworkController:networkDidChange'\n      ) {\n        throw error;\n      }\n    }\n\n    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n\n    if (isInfura) {\n      if (networkStatus === NetworkStatus.Available) {\n        this.messenger.publish('NetworkController:infuraIsUnblocked');\n      } else if (networkStatus === NetworkStatus.Blocked) {\n        this.messenger.publish('NetworkController:infuraIsBlocked');\n      }\n    } else {\n      // Always publish infuraIsUnblocked regardless of network status to\n      // prevent consumers from being stuck in a blocked state if they were\n      // previously connected to an Infura network that was blocked\n      this.messenger.publish('NetworkController:infuraIsUnblocked');\n    }\n  }\n\n  /**\n   * Updates the metadata for the given network in state.\n   *\n   * @param networkClientId - The associated network client ID.\n   * @param metadata - The metadata to store in state.\n   * @param metadata.networkStatus - The network status to store in state.\n   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to\n   * store in state.\n   */\n  #updateMetadataForNetwork(\n    networkClientId: NetworkClientId,\n    metadata: {\n      networkStatus: NetworkStatus;\n      isEIP1559Compatible?: boolean | undefined;\n    },\n  ): void {\n    this.update((state) => {\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      const newMetadata = state.networksMetadata[networkClientId];\n      newMetadata.status = metadata.networkStatus;\n\n      if ('isEIP1559Compatible' in metadata) {\n        if (metadata.isEIP1559Compatible === undefined) {\n          delete newMetadata.EIPS[1559];\n        } else {\n          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;\n        }\n      }\n    });\n  }\n\n  /**\n   * Convenience method to update provider network type settings.\n   *\n   * @param type - Human readable network name.\n   * @deprecated This has been replaced by `setActiveNetwork`, and will be\n   * removed in a future release\n   */\n  async setProviderType(type: InfuraNetworkType): Promise<void> {\n    if ((type as unknown) === NetworkType.rpc) {\n      throw new Error(\n        `NetworkController - cannot call \"setProviderType\" with type \"${NetworkType.rpc}\". Use \"setActiveNetwork\"`,\n      );\n    }\n    if (!isInfuraNetworkType(type)) {\n      throw new Error(`Unknown Infura provider type \"${String(type)}\".`);\n    }\n\n    await this.setActiveNetwork(type);\n  }\n\n  /**\n   * Changes the selected network.\n   *\n   * @param networkClientId - The ID of a network client that will be used to\n   * make requests.\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client is associated with the given\n   * network client ID.\n   */\n  async setActiveNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n\n    await this.#refreshNetwork(networkClientId, options);\n  }\n\n  /**\n   * Fetches the latest block for the network.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.\n   * @returns A promise that either resolves to the block header or null if\n   * there is no latest block, or rejects with an error.\n   */\n  #getLatestBlock(\n    networkClientId: NetworkClientId = this.state.selectedNetworkClientId,\n  ): Promise<Block> {\n    const networkClient = this.getNetworkClientById(networkClientId);\n    const ethQuery = new EthQuery(networkClient.provider);\n\n    return new Promise((resolve, reject) => {\n      ethQuery.sendAsync(\n        { method: 'eth_getBlockByNumber', params: ['latest', false] },\n        (error: unknown, block?: unknown) => {\n          if (error) {\n            // This error comes from JsonRpcEngine, we don't control it.\n            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n            reject(error);\n          } else {\n            // TODO: Validate this type\n            resolve(block as Block);\n          }\n        },\n      );\n    });\n  }\n\n  /**\n   * Determines whether the network supports EIP-1559 by checking whether the\n   * latest block has a `baseFeePerGas` property, then updates state\n   * appropriately.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.\n   * @returns A promise that resolves to true if the network supports EIP-1559\n   * , false otherwise, or `undefined` if unable to determine the compatibility.\n   */\n  async getEIP1559Compatibility(\n    networkClientId?: NetworkClientId,\n  ): Promise<undefined | boolean> {\n    if (networkClientId) {\n      return this.get1559CompatibilityWithNetworkClientId(networkClientId);\n    }\n    if (!this.#ethQuery) {\n      return false;\n    }\n\n    const { EIPS } =\n      this.state.networksMetadata[this.state.selectedNetworkClientId];\n\n    if (EIPS[1559] !== undefined) {\n      return EIPS[1559];\n    }\n\n    const isEIP1559Compatible = await this.#determineEIP1559Compatibility(\n      this.state.selectedNetworkClientId,\n    );\n    this.update((state) => {\n      if (isEIP1559Compatible !== undefined) {\n        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =\n          isEIP1559Compatible;\n      }\n    });\n    return isEIP1559Compatible;\n  }\n\n  async get1559CompatibilityWithNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean> {\n    let metadata = this.state.networksMetadata[networkClientId];\n    if (metadata?.EIPS[1559] === undefined) {\n      await this.lookupNetwork(networkClientId);\n      metadata = this.state.networksMetadata[networkClientId];\n    }\n    const { EIPS } = metadata;\n\n    // may want to include some 'freshness' value - something to make sure we refetch this from time to time\n    return EIPS[1559];\n  }\n\n  /**\n   * Retrieves and checks the latest block from the currently selected\n   * network; if the block has a `baseFeePerGas` property, then we know\n   * that the network supports EIP-1559; otherwise it doesn't.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility\n   * @returns A promise that resolves to `true` if the network supports EIP-1559,\n   * `false` otherwise, or `undefined` if unable to retrieve the last block.\n   */\n  async #determineEIP1559Compatibility(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean | undefined> {\n    const latestBlock = await this.#getLatestBlock(networkClientId);\n\n    if (!latestBlock) {\n      return undefined;\n    }\n\n    return latestBlock.baseFeePerGas !== undefined;\n  }\n\n  /**\n   * Ensures that the provider and block tracker proxies are pointed to the\n   * currently selected network and refreshes the metadata for the\n   */\n  async resetConnection(): Promise<void> {\n    await this.#refreshNetwork(this.state.selectedNetworkClientId);\n  }\n\n  /**\n   * Returns the network configuration that has been filed under the given chain\n   * ID.\n   *\n   * @param chainId - The chain ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByChainId(\n    chainId: Hex,\n  ): NetworkConfiguration | undefined {\n    return this.state.networkConfigurationsByChainId[chainId];\n  }\n\n  /**\n   * Returns the network configuration that contains an RPC endpoint with the\n   * given network client ID.\n   *\n   * @param networkClientId - The network client ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): NetworkConfiguration | undefined {\n    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);\n  }\n\n  /**\n   * Creates and registers network clients for the collection of Infura and\n   * custom RPC endpoints that can be used to make requests for a particular\n   * chain, storing the given configuration object in state for later reference.\n   *\n   * @param fields - The object that describes the new network/chain and lists\n   * the RPC endpoints which front that chain.\n   * @returns The newly added network configuration.\n   * @throws if any part of `fields` would produce invalid state.\n   * @see {@link NetworkConfiguration}\n   */\n  addNetwork(fields: AddNetworkFields): NetworkConfiguration {\n    const { rpcEndpoints: setOfRpcEndpointFields } = fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'add',\n      networkFields: fields,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations = setOfRpcEndpointFields.map(\n      (defaultOrCustomRpcEndpointFields) => {\n        const rpcEndpoint =\n          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom\n            ? {\n                ...defaultOrCustomRpcEndpointFields,\n                networkClientId: uuidV4(),\n              }\n            : defaultOrCustomRpcEndpointFields;\n        return {\n          type: 'add' as const,\n          rpcEndpoint,\n        };\n      },\n    );\n\n    const newNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'add',\n        networkFields: fields,\n        networkConfigurationToPersist: newNetworkConfiguration,\n      });\n    });\n\n    this.messenger.publish(\n      `${controllerName}:networkAdded`,\n      newNetworkConfiguration,\n    );\n\n    return newNetworkConfiguration;\n  }\n\n  /**\n   * Updates the configuration for a previously stored network filed under the\n   * given chain ID, creating + registering new network clients to represent RPC\n   * endpoints that have been added and destroying + unregistering existing\n   * network clients for RPC endpoints that have been removed.\n   *\n   * Note that if `chainId` is changed, then all network clients associated with\n   * that chain will be removed and re-added, even if none of the RPC endpoints\n   * have changed.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @param fields - The object that describes the updates to the network/chain,\n   * including the new set of RPC endpoints which should front that chain.\n   * @param options - Options to provide.\n   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot\n   * remove an RPC endpoint that is being represented by the currently selected\n   * network client. This option allows you to specify another RPC endpoint\n   * (either an existing one or a new one) that should be used to select a new\n   * network instead.\n   * @returns The updated network configuration.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * if any part of `fields` would produce invalid state, etc.\n   * @see {@link NetworkConfiguration}\n   */\n  async updateNetwork(\n    chainId: Hex,\n    fields: UpdateNetworkFields,\n    {\n      replacementSelectedRpcEndpointIndex,\n    }: { replacementSelectedRpcEndpointIndex?: number } = {},\n  ): Promise<NetworkConfiguration> {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Could not update network: Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    const existingChainId = chainId;\n    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =\n      fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'update',\n      networkFields: fields,\n      existingNetworkConfiguration,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations: NetworkClientOperation[] = [];\n\n    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {\n      const existingRpcEndpointForNoop =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            rpcEndpoint.url === newRpcEndpointFields.url &&\n            (rpcEndpoint.networkClientId ===\n              newRpcEndpointFields.networkClientId ||\n              newRpcEndpointFields.networkClientId === undefined)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            (rpcEndpoint.type === RpcEndpointType.Infura &&\n              newRpcEndpointFields.type === RpcEndpointType.Infura) ||\n            (rpcEndpoint.type === newRpcEndpointFields.type &&\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId &&\n              rpcEndpoint.url === newRpcEndpointFields.url)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainNotChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            (rpcEndpoint.url === newRpcEndpointFields.url ||\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId)\n          );\n        });\n\n      if (\n        newChainId !== existingChainId &&\n        existingRpcEndpointForReplaceWhenChainChanged !== undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,\n          newRpcEndpoint,\n        });\n      } else if (existingRpcEndpointForNoop !== undefined) {\n        let newRpcEndpoint;\n        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {\n          newRpcEndpoint = existingRpcEndpointForNoop;\n        } else {\n          // `networkClientId` shouldn't be missing at this point; if it is,\n          // that's a mistake, so fill it back in\n          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {\n            networkClientId: existingRpcEndpointForNoop.networkClientId,\n          });\n        }\n        networkClientOperations.push({\n          type: 'noop' as const,\n          rpcEndpoint: newRpcEndpoint,\n        });\n      } else if (\n        existingRpcEndpointForReplaceWhenChainNotChanged === undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n        const networkClientOperation = {\n          type: 'add' as const,\n          rpcEndpoint: newRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      } else {\n        let newRpcEndpoint;\n        /* istanbul ignore if */\n        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {\n          // This case can't actually happen. If we're here, it means that some\n          // part of the RPC endpoint changed. But there is no part of an Infura\n          // RPC endpoint that can be changed (as it would immediately make that\n          // RPC endpoint self-inconsistent). This is just here to appease\n          // TypeScript.\n          newRpcEndpoint = newRpcEndpointFields;\n        } else {\n          newRpcEndpoint = {\n            ...newRpcEndpointFields,\n            networkClientId: uuidV4(),\n          };\n        }\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,\n          newRpcEndpoint,\n        });\n      }\n    }\n\n    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n      if (\n        !networkClientOperations.some((networkClientOperation) => {\n          const otherRpcEndpoint =\n            networkClientOperation.type === 'replace'\n              ? networkClientOperation.oldRpcEndpoint\n              : networkClientOperation.rpcEndpoint;\n          return (\n            otherRpcEndpoint.type === existingRpcEndpoint.type &&\n            otherRpcEndpoint.networkClientId ===\n              existingRpcEndpoint.networkClientId &&\n            otherRpcEndpoint.url === existingRpcEndpoint.url\n          );\n        })\n      ) {\n        const networkClientOperation = {\n          type: 'remove' as const,\n          rpcEndpoint: existingRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      }\n    }\n\n    const updatedNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n\n    if (\n      replacementSelectedRpcEndpointIndex === undefined &&\n      networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'remove' &&\n          networkClientOperation.rpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      }) &&\n      !networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      })\n    ) {\n      throw new Error(\n        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \\`replacementSelectedRpcEndpointIndex\\` option.`,\n      );\n    }\n\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const replacementSelectedRpcEndpointWithIndex = networkClientOperations\n      .map(\n        (networkClientOperation, index) =>\n          [networkClientOperation, index] as const,\n      )\n      .find(([networkClientOperation, _index]) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      });\n    const correctedReplacementSelectedRpcEndpointIndex =\n      replacementSelectedRpcEndpointIndex ??\n      replacementSelectedRpcEndpointWithIndex?.[1];\n\n    let rpcEndpointToSelect: RpcEndpoint | undefined;\n    if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {\n      rpcEndpointToSelect =\n        updatedNetworkConfiguration.rpcEndpoints[\n          correctedReplacementSelectedRpcEndpointIndex\n        ];\n\n      if (rpcEndpointToSelect === undefined) {\n        throw new Error(\n          `Could not update network: \\`replacementSelectedRpcEndpointIndex\\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \\`rpcEndpoints\\``,\n        );\n      }\n    }\n\n    if (\n      rpcEndpointToSelect &&\n      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId\n    ) {\n      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {\n        updateState: (state) => {\n          this.#updateNetworkConfigurations({\n            state,\n            mode: 'update',\n            networkFields: fields,\n            networkConfigurationToPersist: updatedNetworkConfiguration,\n            existingNetworkConfiguration,\n          });\n        },\n      });\n    } else {\n      this.update((state) => {\n        this.#updateNetworkConfigurations({\n          state,\n          mode: 'update',\n          networkFields: fields,\n          networkConfigurationToPersist: updatedNetworkConfiguration,\n          existingNetworkConfiguration,\n        });\n      });\n    }\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    return updatedNetworkConfiguration;\n  }\n\n  /**\n   * Destroys and unregisters the network identified by the given chain ID, also\n   * removing the associated network configuration from state.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * or if the currently selected network is being removed.\n   * @see {@link NetworkConfiguration}\n   */\n  removeNetwork(chainId: Hex): void {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration.rpcEndpoints.some(\n        (rpcEndpoint) =>\n          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,\n      )\n    ) {\n      throw new Error(`Cannot remove the currently selected network`);\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    const networkClientOperations =\n      existingNetworkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        return {\n          type: 'remove' as const,\n          rpcEndpoint,\n        };\n      });\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'remove',\n        existingNetworkConfiguration,\n      });\n\n      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n        delete state.networksMetadata[rpcEndpoint.networkClientId];\n      }\n    });\n\n    this.messenger.publish(\n      'NetworkController:networkRemoved',\n      existingNetworkConfiguration,\n    );\n  }\n\n  /**\n   * Assuming that the network has been previously switched, switches to this\n   * new network.\n   *\n   * If the network has not been previously switched, this method is equivalent\n   * to {@link resetConnection}.\n   */\n  async rollbackToPreviousProvider(): Promise<void> {\n    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);\n  }\n\n  /**\n   * Deactivates the controller, stopping any ongoing polling.\n   *\n   * In-progress requests will not be aborted.\n   */\n  // We're intentionally changing the signature of an extended method.\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  async destroy(): Promise<void> {\n    await this.#blockTrackerProxy?.destroy();\n  }\n\n  /**\n   * Merges the given backup data into controller state.\n   *\n   * @param backup - The data that has been backed up.\n   * @param backup.networkConfigurationsByChainId - Network configurations,\n   * keyed by chain ID.\n   */\n  loadBackup({\n    networkConfigurationsByChainId,\n  }: Pick<NetworkState, 'networkConfigurationsByChainId'>): void {\n    this.update((state) => {\n      state.networkConfigurationsByChainId = {\n        ...state.networkConfigurationsByChainId,\n        ...networkConfigurationsByChainId,\n      };\n    });\n  }\n\n  /**\n   * Searches for the default RPC endpoint configured for the given chain and\n   * returns its network client ID. This can then be passed to\n   * {@link getNetworkClientById} to retrieve the network client.\n   *\n   * @param chainId - Chain ID to search for.\n   * @returns The ID of the network client created for the chain's default RPC\n   * endpoint.\n   */\n  findNetworkClientIdByChainId(chainId: Hex): NetworkClientId {\n    const networkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (!networkConfiguration) {\n      throw new Error(`Invalid chain ID \"${chainId}\"`);\n    }\n\n    const { networkClientId } =\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ];\n    return networkClientId;\n  }\n\n  /**\n   * Ensure that the given fields which will be used to either add or update a\n   * network are valid.\n   *\n   * @param args - The arguments.\n   */\n  #validateNetworkFields(\n    args: {\n      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n    } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n        }\n      | {\n          mode: 'update';\n          existingNetworkConfiguration: NetworkConfiguration;\n          networkFields: UpdateNetworkFields;\n        }\n    ),\n  ): void {\n    const { mode, networkFields, autoManagedNetworkClientRegistry } = args;\n    const existingNetworkConfiguration =\n      'existingNetworkConfiguration' in args\n        ? args.existingNetworkConfiguration\n        : null;\n\n    const errorMessagePrefix =\n      mode === 'update' ? 'Could not update network' : 'Could not add network';\n\n    if (\n      !isStrictHexString(networkFields.chainId) ||\n      !isSafeChainId(networkFields.chainId)\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Invalid \\`chainId\\` '${networkFields.chainId}' (must start with \"0x\" and not exceed the maximum)`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration === null ||\n      networkFields.chainId !== existingNetworkConfiguration.chainId\n    ) {\n      const existingNetworkConfigurationViaChainId =\n        this.state.networkConfigurationsByChainId[networkFields.chainId];\n      if (existingNetworkConfigurationViaChainId !== undefined) {\n        if (existingNetworkConfiguration === null) {\n          throw new Error(\n            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        } else {\n          throw new Error(\n            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        }\n      }\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkFields.blockExplorerUrls.length > 0\n        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||\n          networkFields.blockExplorerUrls[\n            networkFields.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkFields.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultBlockExplorerUrlIndex\\` must refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (networkFields.rpcEndpoints.length === 0) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`rpcEndpoints\\` must be a non-empty array`,\n      );\n    }\n    for (const rpcEndpointFields of networkFields.rpcEndpoints) {\n      if (!isValidUrl(rpcEndpointFields.url)) {\n        throw new Error(\n          `${errorMessagePrefix}: An entry in \\`rpcEndpoints\\` has invalid URL '${rpcEndpointFields.url}'`,\n        );\n      }\n      const networkClientId =\n        'networkClientId' in rpcEndpointFields\n          ? rpcEndpointFields.networkClientId\n          : undefined;\n\n      if (\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        networkClientId !== undefined &&\n        isInfuraNetworkType(networkClientId)\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,\n        );\n      }\n\n      if (\n        mode === 'update' &&\n        networkClientId !== undefined &&\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        !Object.values(autoManagedNetworkClientRegistry).some(\n          (networkClientsById) => networkClientId in networkClientsById,\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,\n        );\n      }\n\n      if (\n        networkFields.rpcEndpoints.some(\n          (otherRpcEndpointFields) =>\n            otherRpcEndpointFields !== rpcEndpointFields &&\n            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,\n        );\n      }\n\n      const networkConfigurationsForOtherChains = Object.values(\n        this.state.networkConfigurationsByChainId,\n      ).filter((networkConfiguration) =>\n        existingNetworkConfiguration\n          ? networkConfiguration.chainId !==\n            existingNetworkConfiguration.chainId\n          : true,\n      );\n      for (const networkConfiguration of networkConfigurationsForOtherChains) {\n        const rpcEndpoint = networkConfiguration.rpcEndpoints.find(\n          (existingRpcEndpoint) =>\n            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),\n        );\n        if (rpcEndpoint) {\n          if (mode === 'update') {\n            throw new Error(\n              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          } else {\n            throw new Error(\n              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          }\n        }\n      }\n    }\n\n    if (\n      [...new Set(networkFields.rpcEndpoints)].length <\n      networkFields.rpcEndpoints.length\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,\n      );\n    }\n\n    const networkClientIds = networkFields.rpcEndpoints\n      .map((rpcEndpoint) =>\n        'networkClientId' in rpcEndpoint\n          ? rpcEndpoint.networkClientId\n          : undefined,\n      )\n      .filter(\n        (networkClientId): networkClientId is NetworkClientId =>\n          networkClientId !== undefined,\n      );\n    if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,\n      );\n    }\n\n    const infuraRpcEndpoints = networkFields.rpcEndpoints.filter(\n      (rpcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =>\n        rpcEndpointFields.type === RpcEndpointType.Infura,\n    );\n    if (infuraRpcEndpoints.length > 1) {\n      throw new Error(\n        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,\n      );\n    }\n\n    const soleInfuraRpcEndpoint = infuraRpcEndpoints[0];\n    if (soleInfuraRpcEndpoint) {\n      const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n        soleInfuraRpcEndpoint.url,\n      );\n      const infuraNetworkNickname = NetworkNickname[infuraNetworkName];\n      const infuraChainId = ChainId[infuraNetworkName];\n      if (networkFields.chainId !== infuraChainId) {\n        throw new Error(\n          mode === 'add'\n            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`\n            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,\n        );\n      }\n    }\n\n    if (\n      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===\n      undefined\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultRpcEndpointIndex\\` must refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  /**\n   * Constructs a network configuration that will be persisted to state when\n   * adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Operations which were calculated for\n   * updating the network client registry but which also map back to RPC\n   * endpoints (and so can be used to save those RPC endpoints).\n   * @returns The network configuration to persist.\n   */\n  #determineNetworkConfigurationToPersist({\n    networkFields,\n    networkClientOperations,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n  }): NetworkConfiguration {\n    const rpcEndpointsToPersist = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is\n          | AddNetworkClientOperation\n          | NoopNetworkClientOperation => {\n          return (\n            networkClientOperation.type === 'add' ||\n            networkClientOperation.type === 'noop'\n          );\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };\n  }\n\n  /**\n   * Creates and registers network clients using the given operations calculated\n   * as a part of adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Dictate which network clients need to\n   * be created.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #registerNetworkClientsAsNeeded({\n    networkFields,\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const addedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is AddNetworkClientOperation => {\n          return networkClientOperation.type === 'add';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    for (const addedRpcEndpoint of addedRpcEndpoints) {\n      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Infura,\n            chainId: networkFields.chainId,\n            network: addedRpcEndpoint.networkClientId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            infuraProjectId: this.#infuraProjectId,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      } else {\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Custom,\n            chainId: networkFields.chainId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            rpcUrl: addedRpcEndpoint.url,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      }\n    }\n  }\n\n  /**\n   * Destroys and removes network clients using the given operations calculated\n   * as a part of updating or removing a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkClientOperations - Dictate which network clients to\n   * remove.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #unregisterNetworkClientsAsNeeded({\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const removedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is RemoveNetworkClientOperation => {\n          return networkClientOperation.type === 'remove';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.oldRpcEndpoint,\n          ),\n      );\n\n    for (const rpcEndpoint of removedRpcEndpoints) {\n      const networkClient = this.getNetworkClientById(\n        rpcEndpoint.networkClientId,\n      );\n      networkClient.destroy();\n      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][\n        rpcEndpoint.networkClientId\n      ];\n    }\n  }\n\n  /**\n   * Updates `networkConfigurationsByChainId` in state depending on whether a\n   * network is being added, updated, or removed.\n   *\n   * - The existing network configuration will be removed when a network is\n   * being filed under a different chain or removed.\n   * - A network configuration will be stored when a network is being added or\n   * when a network is being updated.\n   *\n   * @param args - The arguments to this function.\n   */\n  #updateNetworkConfigurations(\n    args: { state: Draft<NetworkState> } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n        }\n      | {\n          mode: 'update';\n          networkFields: UpdateNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n      | {\n          mode: 'remove';\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n    ),\n  ): void {\n    const { state, mode } = args;\n\n    if (\n      mode === 'remove' ||\n      (mode === 'update' &&\n        args.networkFields.chainId !==\n          args.existingNetworkConfiguration.chainId)\n    ) {\n      delete state.networkConfigurationsByChainId[\n        args.existingNetworkConfiguration.chainId\n      ];\n    }\n\n    if (mode === 'add' || mode === 'update') {\n      if (\n        !deepEqual(\n          state.networkConfigurationsByChainId[args.networkFields.chainId],\n          args.networkConfigurationToPersist,\n        )\n      ) {\n        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();\n      }\n      state.networkConfigurationsByChainId[args.networkFields.chainId] =\n        args.networkConfigurationToPersist;\n    }\n\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        cloneDeep(state.networkConfigurationsByChainId),\n      );\n  }\n\n  /**\n   * Before accessing or switching the network, the registry of network clients\n   * needs to be populated. Otherwise, `#applyNetworkSelection` and\n   * `getNetworkClientRegistry` will throw an error. This method checks to see if the\n   * population step has happened yet, and if not, makes it happen.\n   *\n   * @returns The populated network client registry.\n   */\n  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {\n    return (this.#autoManagedNetworkClientRegistry ??=\n      this.#createAutoManagedNetworkClientRegistry());\n  }\n\n  /**\n   * Constructs the registry of network clients based on the set of default\n   * and custom networks in state.\n   *\n   * @returns The network clients keyed by ID.\n   */\n  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {\n    const chainIds = knownKeysOf(this.state.networkConfigurationsByChainId);\n    const networkClientsWithIds = chainIds.flatMap((chainId) => {\n      const networkConfiguration =\n        this.state.networkConfigurationsByChainId[chainId];\n      return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        if (rpcEndpoint.type === RpcEndpointType.Infura) {\n          const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n            rpcEndpoint.url,\n          );\n          return [\n            rpcEndpoint.networkClientId,\n            createAutoManagedNetworkClient({\n              networkClientId: rpcEndpoint.networkClientId,\n              networkClientConfiguration: {\n                type: NetworkClientType.Infura,\n                network: infuraNetworkName,\n                failoverRpcUrls: rpcEndpoint.failoverUrls,\n                infuraProjectId: this.#infuraProjectId,\n                chainId: networkConfiguration.chainId,\n                ticker: networkConfiguration.nativeCurrency,\n              },\n              getRpcServiceOptions: this.#getRpcServiceOptions,\n              getBlockTrackerOptions: this.#getBlockTrackerOptions,\n              messenger: this.messenger,\n              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n              logger: this.#log,\n            }),\n          ] as const;\n        }\n        return [\n          rpcEndpoint.networkClientId,\n          createAutoManagedNetworkClient({\n            networkClientId: rpcEndpoint.networkClientId,\n            networkClientConfiguration: {\n              type: NetworkClientType.Custom,\n              chainId: networkConfiguration.chainId,\n              failoverRpcUrls: rpcEndpoint.failoverUrls,\n              rpcUrl: rpcEndpoint.url,\n              ticker: networkConfiguration.nativeCurrency,\n            },\n            getRpcServiceOptions: this.#getRpcServiceOptions,\n            getBlockTrackerOptions: this.#getBlockTrackerOptions,\n            messenger: this.messenger,\n            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n            logger: this.#log,\n          }),\n        ] as const;\n      });\n    });\n\n    return networkClientsWithIds.reduce(\n      (\n        obj: {\n          [NetworkClientType.Custom]: Partial<AutoManagedCustomNetworkClientRegistry>;\n          [NetworkClientType.Infura]: Partial<AutoManagedBuiltInNetworkClientRegistry>;\n        },\n        [networkClientId, networkClient],\n      ) => {\n        return {\n          ...obj,\n          [networkClient.configuration.type]: {\n            ...obj[networkClient.configuration.type],\n            [networkClientId]: networkClient,\n          },\n        };\n      },\n      {\n        [NetworkClientType.Custom]: {},\n        [NetworkClientType.Infura]: {},\n      },\n    ) as AutoManagedNetworkClientRegistry;\n  }\n\n  /**\n   * Updates the global provider and block tracker proxies (accessible via\n   * {@link getSelectedNetworkClient}) to point to the same ones within the\n   * given network client, thereby magically switching any consumers using these\n   * proxies to use the new network.\n   *\n   * Also refreshes the EthQuery instance accessible via the `getEthQuery`\n   * action to wrap the provider from the new network client. Note that this is\n   * not a proxy, so consumers will need to call `getEthQuery` again after the\n   * network switch.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client could be found matching the given ID.\n   */\n  #applyNetworkSelection(\n    networkClientId: string,\n    {\n      updateState,\n    }: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): void {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    let autoManagedNetworkClient:\n      | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n      | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(\n          `No Infura network client found with ID '${networkClientId}'`,\n        );\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    } else {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          networkClientId\n        ];\n\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(`No network client found with ID '${networkClientId}'`);\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    }\n\n    this.#autoManagedNetworkClient = autoManagedNetworkClient;\n\n    this.update((state) => {\n      state.selectedNetworkClientId = networkClientId;\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      updateState?.(state);\n    });\n\n    if (this.#providerProxy) {\n      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);\n    } else {\n      this.#providerProxy = createSwappableProxy(\n        this.#autoManagedNetworkClient.provider,\n      );\n    }\n\n    if (this.#blockTrackerProxy) {\n      this.#blockTrackerProxy.setTarget(\n        this.#autoManagedNetworkClient.blockTracker,\n      );\n    } else {\n      this.#blockTrackerProxy = createEventEmitterProxy(\n        this.#autoManagedNetworkClient.blockTracker,\n        {\n          eventFilter: 'skipInternal',\n        },\n      );\n    }\n\n    this.#ethQuery = new EthQuery(this.#providerProxy);\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"NetworkController.cjs","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport { BaseController } from '@metamask/base-controller';\nimport type { ConnectivityControllerGetStateAction } from '@metamask/connectivity-controller';\nimport type { Partialize } from '@metamask/controller-utils';\nimport {\n  InfuraNetworkType,\n  CustomNetworkType,\n  NetworkType,\n  isSafeChainId,\n  isInfuraNetworkType,\n  ChainId,\n  NetworksTicker,\n  NetworkNickname,\n  BUILT_IN_CUSTOM_NETWORKS_RPC,\n  BUILT_IN_NETWORKS,\n} from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport EthQuery from '@metamask/eth-query';\nimport type { Messenger } from '@metamask/messenger';\nimport { errorCodes } from '@metamask/rpc-errors';\nimport {\n  createEventEmitterProxy,\n  createSwappableProxy,\n} from '@metamask/swappable-obj-proxy';\nimport type { SwappableProxy } from '@metamask/swappable-obj-proxy';\nimport type { Hex } from '@metamask/utils';\nimport { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';\nimport deepEqual from 'fast-deep-equal';\nimport type { Draft } from 'immer';\nimport { produce } from 'immer';\nimport { cloneDeep } from 'lodash';\nimport type { Logger } from 'loglevel';\nimport { createSelector } from 'reselect';\nimport * as URI from 'uri-js';\nimport { v4 as uuidV4 } from 'uuid';\n\nimport {\n  DEPRECATED_NETWORKS,\n  INFURA_BLOCKED_KEY,\n  NetworkStatus,\n} from './constants';\nimport type {\n  AutoManagedNetworkClient,\n  ProxyWithAccessibleTarget,\n} from './create-auto-managed-network-client';\nimport { createAutoManagedNetworkClient } from './create-auto-managed-network-client';\nimport { projectLogger, createModuleLogger } from './logger';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { NetworkClientType } from './types';\nimport type {\n  BlockTracker,\n  Provider,\n  CustomNetworkClientConfiguration,\n  InfuraNetworkClientConfiguration,\n  NetworkClientConfiguration,\n  AdditionalDefaultNetwork,\n} from './types';\n\nconst debugLog = createModuleLogger(projectLogger, 'NetworkController');\n\nconst INFURA_URL_REGEX =\n  /^https:\\/\\/(?<networkName>[^.]+)\\.infura\\.io\\/v\\d+\\/(?<apiKey>.+)$/u;\n\nexport type Block = {\n  baseFeePerGas?: string;\n};\n\n/**\n * Information about a network not held by any other part of state.\n */\nexport type NetworkMetadata = {\n  /**\n   * EIPs supported by the network.\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  EIPS: {\n    [eipNumber: number]: boolean;\n  };\n  /**\n   * Indicates the availability of the network\n   */\n  status: NetworkStatus;\n};\n\n/**\n * The type of an RPC endpoint.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport enum RpcEndpointType {\n  Custom = 'custom',\n  Infura = 'infura',\n}\n\n/**\n * An Infura RPC endpoint is a reference to a specific network that Infura\n * supports as well as an Infura account we own that we allow users to make use\n * of for free. We need to disambiguate these endpoints from custom RPC\n * endpoints, because while the types for these kinds of object both have the\n * same interface, the URL for an Infura endpoint contains the Infura project\n * ID, and we don't want this to be present in state. We therefore hide it by\n * representing it in the URL as `{infuraProjectId}`, which we replace this when\n * create network clients. But we need to know somehow that we only need to do\n * this replacement for Infura endpoints and not custom endpoints â€” hence the\n * separate type.\n */\nexport type InfuraRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: BuiltInNetworkClientId;\n  /**\n   * The type of this endpoint, always \"default\".\n   */\n  type: RpcEndpointType.Infura;\n  /**\n   * The URL of the endpoint. Expected to be a template with the string\n   * `{infuraProjectId}`, which will get replaced with the Infura project ID\n   * when the network client is created.\n   */\n  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;\n};\n\n/**\n * A custom RPC endpoint is a reference to a user-defined server which fronts an\n * EVM chain. It may refer to an Infura network, but only by coincidence.\n */\nexport type CustomRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: CustomNetworkClientId;\n  /**\n   * The type of this endpoint, always \"custom\".\n   */\n  type: RpcEndpointType.Custom;\n  /**\n   * The URL of the endpoint.\n   */\n  url: string;\n};\n\n/**\n * An RPC endpoint is a reference to a server which fronts an EVM chain. There\n * are two varieties of RPC endpoints: Infura and custom.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;\n\n/**\n * From a user perspective, a network configuration holds information about a\n * network that a user can select through the client. A \"network\" in this sense\n * can explicitly refer to an EVM chain that the user explicitly adds or doesn't\n * need to add (because it comes shipped with the client). The properties here\n * therefore directly map to fields that a user sees and can edit for a network\n * within the client.\n *\n * Internally, a network configuration represents a single conceptual EVM chain,\n * which is represented tangibly via multiple RPC endpoints. A \"network\" is then\n * something for which a network client object is created automatically or\n * created on demand when it is added to the client.\n */\nexport type NetworkConfiguration = {\n  /**\n   * A set of URLs that allows the user to view activity that has occurred on\n   * the chain.\n   */\n  blockExplorerUrls: string[];\n  /**\n   * The ID of the chain. Represented in hexadecimal format with a leading \"0x\"\n   * instead of decimal format so that when viewed out of context it can be\n   * unambiguously interpreted.\n   */\n  chainId: Hex;\n  /**\n   * A reference to a URL that the client will use by default to allow the user\n   * to view activity that has occurred on the chain. This index must refer to\n   * an item in `blockExplorerUrls`.\n   */\n  defaultBlockExplorerUrlIndex?: number;\n  /**\n   * A reference to an RPC endpoint that all requests will use by default in order to\n   * interact with the chain. This index must refer to an item in\n   * `rpcEndpoints`.\n   */\n  defaultRpcEndpointIndex: number;\n  /**\n   * The user-facing nickname assigned to the chain.\n   */\n  name: string;\n  /**\n   * The name of the currency to use for the chain.\n   */\n  nativeCurrency: string;\n  /**\n   * The collection of possible RPC endpoints that the client can use to\n   * interact with the chain.\n   */\n  rpcEndpoints: RpcEndpoint[];\n  /**\n   * Profile Sync - Network Sync field.\n   * Allows comparison of local network state with state to sync.\n   */\n  lastUpdatedAt?: number;\n};\n\n/**\n * A custom RPC endpoint in a new network configuration, meant to be used in\n * conjunction with `AddNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type AddNetworkCustomRpcEndpointFields = Omit<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * A new network configuration that `addNetwork` takes.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and are not represented by\n * network clients yet.\n */\nexport type AddNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * A custom RPC endpoint in an updated representation of a network\n * configuration, meant to be used in conjunction with `UpdateNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type UpdateNetworkCustomRpcEndpointFields = Partialize<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * An updated representation of an existing network configuration that\n * `updateNetwork` takes.\n *\n * Custom RPC endpoints may or may not have a `networkClientId` property; if\n * they do, then it is assumed that they already exist, and if not, then it is\n * assumed that they are new and are not represented by network clients yet.\n */\nexport type UpdateNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * `Object.keys()` is intentionally generic: it returns the keys of an object,\n * but it cannot make guarantees about the contents of that object, so the type\n * of the keys is merely `string[]`. While this is technically accurate, it is\n * also unnecessary if we have an object that we own and whose contents are\n * known exactly.\n *\n * TODO: Move to @metamask/utils.\n *\n * @param object - The object.\n * @returns The keys of an object, typed according to the type of the object\n * itself.\n */\nexport function knownKeysOf<Key extends PropertyKey>(\n  // TODO: Replace `any` with type\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  object: Partial<Record<Key, any>>,\n): Key[] {\n  return Object.keys(object) as Key[];\n}\n\n/**\n * Type guard for determining whether the given value is an error object with a\n * `code` property, such as an instance of Error.\n *\n * TODO: Move this to @metamask/utils.\n *\n * @param error - The object to check.\n * @returns True if `error` has a `code`, false otherwise.\n */\nfunction isErrorWithCode(error: unknown): error is { code: string | number } {\n  return typeof error === 'object' && error !== null && 'code' in error;\n}\n\n/**\n * The string that uniquely identifies an Infura network client.\n */\nexport type BuiltInNetworkClientId = InfuraNetworkType;\n\n/**\n * The string that uniquely identifies a custom network client.\n */\nexport type CustomNetworkClientId = string;\n\n/**\n * The string that uniquely identifies a network client.\n */\nexport type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;\n\n/**\n * Extra information about each network, such as whether it is accessible or\n * blocked and whether it supports EIP-1559, keyed by network client ID.\n */\nexport type NetworksMetadata = Record<NetworkClientId, NetworkMetadata>;\n\n/**\n * The state that NetworkController stores.\n */\nexport type NetworkState = {\n  /**\n   * The ID of the network client that the proxies returned by\n   * `getSelectedNetworkClient` currently point to.\n   */\n  selectedNetworkClientId: NetworkClientId;\n  /**\n   * The registry of networks and corresponding RPC endpoints that the\n   * controller can use to make requests for various chains.\n   *\n   * @see {@link NetworkConfiguration}\n   */\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>;\n  /**\n   * Extra information about each network, such as whether it is accessible or\n   * blocked and whether it supports EIP-1559, keyed by network client ID.\n   */\n  networksMetadata: NetworksMetadata;\n};\n\nconst controllerName = 'NetworkController';\n\n/**\n * Represents the block tracker for the currently selected network. (Note that\n * this is a proxy around a proxy: the inner one exists so that the block\n * tracker doesn't have to exist until it's used, and the outer one exists so\n * that the currently selected network can change without consumers needing to\n * refresh the object reference to that network.)\n */\nexport type BlockTrackerProxy = SwappableProxy<\n  ProxyWithAccessibleTarget<BlockTracker>\n>;\n\n/**\n * Represents the provider for the currently selected network. (Note that this\n * is a proxy around a proxy: the inner one exists so that the provider doesn't\n * have to exist until it's used, and the outer one exists so that the currently\n * selected network can change without consumers needing to refresh the object\n * reference to that network.)\n */\nexport type ProviderProxy = SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n\nexport type NetworkControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof controllerName,\n  NetworkState\n>;\n\n/**\n * `networkWillChange` is published when the current network is about to be\n * switched, but the new provider has not been created and no state changes have\n * occurred yet.\n */\nexport type NetworkControllerNetworkWillChangeEvent = {\n  type: 'NetworkController:networkWillChange';\n  payload: [NetworkState];\n};\n\n/**\n * `networkDidChange` is published after a provider has been created for a newly\n * switched network (but before the network has been confirmed to be available).\n */\nexport type NetworkControllerNetworkDidChangeEvent = {\n  type: 'NetworkController:networkDidChange';\n  payload: [NetworkState];\n};\n\n/**\n * `infuraIsBlocked` is published after the network is switched to an Infura\n * network, but when Infura returns an error blocking the user based on their\n * location.\n */\nexport type NetworkControllerInfuraIsBlockedEvent = {\n  type: 'NetworkController:infuraIsBlocked';\n  payload: [];\n};\n\n/**\n * `infuraIsBlocked` is published either after the network is switched to an\n * Infura network and Infura does not return an error blocking the user based on\n * their location, or the network is switched to a non-Infura network.\n */\nexport type NetworkControllerInfuraIsUnblockedEvent = {\n  type: 'NetworkController:infuraIsUnblocked';\n  payload: [];\n};\n\n/**\n * `networkAdded` is published after a network configuration is added to the\n * network configuration registry and network clients are created for it.\n */\nexport type NetworkControllerNetworkAddedEvent = {\n  type: 'NetworkController:networkAdded';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `networkRemoved` is published after a network configuration is removed from the\n * network configuration registry and once the network clients have been removed.\n */\nexport type NetworkControllerNetworkRemovedEvent = {\n  type: 'NetworkController:networkRemoved';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `NetworkController:rpcEndpointChainUnavailable` is published when, after\n * trying all endpoints in an endpoint chain, the last failover reaches a\n * maximum number of consecutive 5xx responses, breaking the underlying circuit.\n *\n * In other words, this event will not be published if a failover is available,\n * even if the primary is not.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the last failover in the\n * endpoint chain.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointChainUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointUnavailable` is published when any\n * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx\n * responses, breaking the underlying circuit.\n *\n * In other words, this event will be published if a primary is not available,\n * even if a failover is.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint which reached the\n * maximum number of consecutive 5xx responses. You can compare this to\n * `primaryEndpointUrl` to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainDegraded` is published for any of the\n * endpoints in an endpoint chain when one of the following two conditions hold\n * (and the chain is not already in a degraded state):\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainDegradedEvent = {\n  type: 'NetworkController:rpcEndpointChainDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n *\n * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints\n * in an endpoint chain when:\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint for which requests\n * failed or were slow to complete. You can compare this to `primaryEndpointUrl`\n * to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointDegradedEvent = {\n  type: 'NetworkController:rpcEndpointDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainAvailable` is published in one of two\n * cases:\n *\n * 1. The first time that a 2xx request is made to any of the endpoints in an\n * endpoint chain.\n * 2. When requests to any of the endpoints previously failed (placing the\n * endpoint in a degraded or unavailable status), but are now succeeding again.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainAvailableEvent = {\n  type: 'NetworkController:rpcEndpointChainAvailable';\n  payload: [\n    {\n      chainId: Hex;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointRetried` is published before a request to any\n * endpoint in an endpoint chain is retried.\n *\n * This is mainly useful for tests.\n *\n * @param payload - The event payload.\n * @param payload.attempt - The current attempt counter for the endpoint\n * (starting from 0).\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint being retried.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n * @see {@link RpcService} for the list of retriable errors.\n */\nexport type NetworkControllerRpcEndpointRetriedEvent = {\n  type: 'NetworkController:rpcEndpointRetried';\n  payload: [\n    {\n      attempt: number;\n      chainId: Hex;\n      endpointUrl: string;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\nexport type NetworkControllerEvents =\n  | NetworkControllerStateChangeEvent\n  | NetworkControllerNetworkWillChangeEvent\n  | NetworkControllerNetworkDidChangeEvent\n  | NetworkControllerInfuraIsBlockedEvent\n  | NetworkControllerInfuraIsUnblockedEvent\n  | NetworkControllerNetworkAddedEvent\n  | NetworkControllerNetworkRemovedEvent\n  | NetworkControllerRpcEndpointChainUnavailableEvent\n  | NetworkControllerRpcEndpointUnavailableEvent\n  | NetworkControllerRpcEndpointChainDegradedEvent\n  | NetworkControllerRpcEndpointDegradedEvent\n  | NetworkControllerRpcEndpointChainAvailableEvent\n  | NetworkControllerRpcEndpointRetriedEvent;\n\n/**\n * All events that {@link NetworkController} calls internally.\n */\ntype AllowedEvents = never;\n\nexport type NetworkControllerGetStateAction = ControllerGetStateAction<\n  typeof controllerName,\n  NetworkState\n>;\n\nexport type NetworkControllerGetEthQueryAction = {\n  type: `NetworkController:getEthQuery`;\n  handler: () => EthQuery | undefined;\n};\n\nexport type NetworkControllerGetNetworkClientByIdAction = {\n  type: `NetworkController:getNetworkClientById`;\n  handler: NetworkController['getNetworkClientById'];\n};\n\nexport type NetworkControllerGetSelectedNetworkClientAction = {\n  type: `NetworkController:getSelectedNetworkClient`;\n  handler: NetworkController['getSelectedNetworkClient'];\n};\n\nexport type NetworkControllerGetSelectedChainIdAction = {\n  type: 'NetworkController:getSelectedChainId';\n  handler: NetworkController['getSelectedChainId'];\n};\n\nexport type NetworkControllerGetEIP1559CompatibilityAction = {\n  type: `NetworkController:getEIP1559Compatibility`;\n  handler: NetworkController['getEIP1559Compatibility'];\n};\n\nexport type NetworkControllerFindNetworkClientIdByChainIdAction = {\n  type: `NetworkController:findNetworkClientIdByChainId`;\n  handler: NetworkController['findNetworkClientIdByChainId'];\n};\n\n/**\n * Change the currently selected network to the given built-in network type.\n *\n * @deprecated This action has been replaced by `setActiveNetwork`, and will be\n * removed in a future release.\n */\nexport type NetworkControllerSetProviderTypeAction = {\n  type: `NetworkController:setProviderType`;\n  handler: NetworkController['setProviderType'];\n};\n\nexport type NetworkControllerSetActiveNetworkAction = {\n  type: `NetworkController:setActiveNetwork`;\n  handler: NetworkController['setActiveNetwork'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByChainId = {\n  type: `NetworkController:getNetworkConfigurationByChainId`;\n  handler: NetworkController['getNetworkConfigurationByChainId'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByNetworkClientId = {\n  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;\n  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];\n};\n\nexport type NetworkControllerAddNetworkAction = {\n  type: 'NetworkController:addNetwork';\n  handler: NetworkController['addNetwork'];\n};\n\nexport type NetworkControllerRemoveNetworkAction = {\n  type: 'NetworkController:removeNetwork';\n  handler: NetworkController['removeNetwork'];\n};\n\nexport type NetworkControllerUpdateNetworkAction = {\n  type: 'NetworkController:updateNetwork';\n  handler: NetworkController['updateNetwork'];\n};\n\nexport type NetworkControllerActions =\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetEthQueryAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | NetworkControllerGetSelectedNetworkClientAction\n  | NetworkControllerGetSelectedChainIdAction\n  | NetworkControllerGetEIP1559CompatibilityAction\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerSetActiveNetworkAction\n  | NetworkControllerSetProviderTypeAction\n  | NetworkControllerGetNetworkConfigurationByChainId\n  | NetworkControllerGetNetworkConfigurationByNetworkClientId\n  | NetworkControllerAddNetworkAction\n  | NetworkControllerRemoveNetworkAction\n  | NetworkControllerUpdateNetworkAction;\n\n/**\n * All actions that {@link NetworkController} calls internally.\n */\ntype AllowedActions = ConnectivityControllerGetStateAction;\n\nexport type NetworkControllerMessenger = Messenger<\n  typeof controllerName,\n  NetworkControllerActions | AllowedActions,\n  NetworkControllerEvents | AllowedEvents\n>;\n\n/**\n * Options for the NetworkController constructor.\n */\nexport type NetworkControllerOptions = {\n  /**\n   * The messenger suited for this controller.\n   */\n  messenger: NetworkControllerMessenger;\n  /**\n   * The API key for Infura, used to make requests to Infura.\n   */\n  infuraProjectId: string;\n  /**\n   * The desired state with which to initialize this controller.\n   * Missing properties will be filled in with defaults. For instance, if not\n   * specified, `networkConfigurationsByChainId` will default to a basic set of\n   * network configurations (see {@link InfuraNetworkType} for the list).\n   */\n  state?: Partial<NetworkState>;\n  /**\n   * A `loglevel` logger object.\n   */\n  log?: Logger;\n  /**\n   * A function that can be used to customize a RPC service constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object with type {@link RpcServiceOptions}, minus `failoverService`\n   * and `endpointUrl` (as they are filled in automatically).\n   */\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  /**\n   * A function that can be used to customize a block tracker constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as\n   * it is filled in automatically).\n   */\n  getBlockTrackerOptions?: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  /**\n   * An array of Hex Chain IDs representing the additional networks to be included as default.\n   */\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[];\n  /**\n   * Whether or not requests sent to unavailable RPC endpoints should be\n   * automatically diverted to configured failover RPC endpoints.\n   */\n  isRpcFailoverEnabled?: boolean;\n};\n\n/**\n * Constructs a value for the state property `networkConfigurationsByChainId`\n * which will be used if it has not been provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default value for `networkConfigurationsByChainId`.\n */\nfunction getDefaultNetworkConfigurationsByChainId(\n  additionalDefaultNetworks: AdditionalDefaultNetwork[] = [],\n): Record<Hex, NetworkConfiguration> {\n  const infuraNetworks = getDefaultInfuraNetworkConfigurationsByChainId();\n  const customNetworks = getDefaultCustomNetworkConfigurationsByChainId();\n\n  return additionalDefaultNetworks.reduce<Record<Hex, NetworkConfiguration>>(\n    (obj, chainId) => {\n      if (hasProperty(customNetworks, chainId)) {\n        obj[chainId] = customNetworks[chainId];\n      }\n      return obj;\n    },\n    // Always include the infura networks in the default networks\n    infuraNetworks,\n  );\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all Infura networks.\n */\nfunction getDefaultInfuraNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  return Object.values(InfuraNetworkType).reduce<\n    Record<Hex, NetworkConfiguration>\n  >((obj, infuraNetworkType) => {\n    const chainId = ChainId[infuraNetworkType];\n\n    // Skip deprecated network as default network.\n    if (DEPRECATED_NETWORKS.has(chainId)) {\n      return obj;\n    }\n\n    const rpcEndpointUrl =\n      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;\n\n    const networkConfiguration: NetworkConfiguration = {\n      blockExplorerUrls: [],\n      chainId,\n      defaultRpcEndpointIndex: 0,\n      name: NetworkNickname[infuraNetworkType],\n      nativeCurrency: NetworksTicker[infuraNetworkType],\n      rpcEndpoints: [\n        {\n          failoverUrls: [],\n          networkClientId: infuraNetworkType,\n          type: RpcEndpointType.Infura,\n          url: rpcEndpointUrl,\n        },\n      ],\n    };\n\n    return { ...obj, [chainId]: networkConfiguration };\n  }, {});\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default custom networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all custom networks.\n */\nfunction getDefaultCustomNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  // Create the `networkConfigurationsByChainId` objects explicitly,\n  // Because it is not always guaranteed that the custom networks are included in the\n  // default networks.\n  return {\n    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet'],\n    ),\n    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet-v2'],\n    ),\n    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['monad-testnet'],\n    ),\n    // Environment 3: Power User test networks\n    [ChainId['fantom-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['fantom-mainnet'],\n    ),\n    [ChainId['gnosis-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['gnosis-mainnet'],\n    ),\n    [ChainId['cronos-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['cronos-mainnet'],\n    ),\n    [ChainId['moonbeam-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['moonbeam-mainnet'],\n    ),\n    [ChainId['moonriver-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['moonriver-mainnet'],\n    ),\n  };\n}\n\n/**\n * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.\n *\n * @param customNetworkType - The type of the custom network.\n * @returns The `NetworkConfiguration` object.\n */\nfunction getCustomNetworkConfiguration(\n  customNetworkType: CustomNetworkType,\n): NetworkConfiguration {\n  const { ticker, rpcPrefs } = BUILT_IN_NETWORKS[customNetworkType];\n  const rpcEndpointUrl = BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];\n\n  return {\n    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],\n    chainId: ChainId[customNetworkType],\n    defaultRpcEndpointIndex: 0,\n    defaultBlockExplorerUrlIndex: 0,\n    name: NetworkNickname[customNetworkType],\n    nativeCurrency: ticker,\n    rpcEndpoints: [\n      {\n        failoverUrls: [],\n        networkClientId: customNetworkType,\n        type: RpcEndpointType.Custom,\n        url: rpcEndpointUrl,\n      },\n    ],\n  };\n}\n\n/**\n * Constructs properties for the NetworkController state whose values will be\n * used if not provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default NetworkController state.\n */\nexport function getDefaultNetworkControllerState(\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[],\n): NetworkState {\n  const networksMetadata = {};\n  const networkConfigurationsByChainId =\n    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);\n\n  return {\n    selectedNetworkClientId: InfuraNetworkType.mainnet,\n    networksMetadata,\n    networkConfigurationsByChainId,\n  };\n}\n\n/**\n * Redux selector for getting all network configurations from NetworkController\n * state, keyed by chain ID.\n *\n * @param state - NetworkController state\n * @returns All registered network configurations, keyed by chain ID.\n */\nconst selectNetworkConfigurationsByChainId = (\n  state: NetworkState,\n): Record<`0x${string}`, NetworkConfiguration> =>\n  state.networkConfigurationsByChainId;\n\n/**\n * Get a list of all network configurations.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport function getNetworkConfigurations(\n  state: NetworkState,\n): NetworkConfiguration[] {\n  return Object.values(state.networkConfigurationsByChainId);\n}\n\n/**\n * Redux selector for getting a list of all network configurations from\n * NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport const selectNetworkConfigurations = createSelector(\n  selectNetworkConfigurationsByChainId,\n  (networkConfigurationsByChainId) =>\n    Object.values(networkConfigurationsByChainId),\n);\n\n/**\n * Get a list of all available network client IDs from a list of network\n * configurations.\n *\n * @param networkConfigurations - The array of network configurations\n * @returns A list of all available client IDs\n */\nexport function getAvailableNetworkClientIds(\n  networkConfigurations: NetworkConfiguration[],\n): string[] {\n  return networkConfigurations.flatMap((networkConfiguration) =>\n    networkConfiguration.rpcEndpoints.map(\n      (rpcEndpoint) => rpcEndpoint.networkClientId,\n    ),\n  );\n}\n\n/**\n * Redux selector for getting a list of all available network client IDs\n * from NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network client IDs.\n */\nexport const selectAvailableNetworkClientIds = createSelector(\n  selectNetworkConfigurations,\n  getAvailableNetworkClientIds,\n);\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedBuiltInNetworkClientRegistry = Record<\n  BuiltInNetworkClientId,\n  AutoManagedNetworkClient<InfuraNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedCustomNetworkClientRegistry = Record<\n  CustomNetworkClientId,\n  AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks\n * as well as custom networks that users have added.\n */\nexport type AutoManagedNetworkClientRegistry = {\n  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;\n  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to create a network client for an\n * RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype AddNetworkClientOperation = {\n  type: 'add';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `updateNetwork` and `removeNetwork` to remove a network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype RemoveNetworkClientOperation = {\n  type: 'remove';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to replace the network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype ReplaceNetworkClientOperation = {\n  type: 'replace';\n  oldRpcEndpoint: RpcEndpoint;\n  newRpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC\n * endpoint, as far as the network client registry is concerned.\n *\n * @see {@link NetworkClientOperation}\n */\ntype NoopNetworkClientOperation = {\n  type: 'noop';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to\n * update the network client registry.\n *\n * - When `addNetwork` is called, represents a network client that should be\n * created for a new RPC endpoint.\n * - When `removeNetwork` is called, represents a network client that should be\n * destroyed for a previously existing RPC endpoint.\n * - When `updateNetwork` is called, represents either:\n *   - a network client that should be added for a new RPC endpoint\n *   - a network client that should be removed for a previously existing RPC\n *   endpoint\n *   - a network client that should be replaced for an RPC endpoint that was\n *   changed in a non-major way, or\n *   - a network client that should be unchanged for an RPC endpoint that was\n *   also unchanged.\n */\ntype NetworkClientOperation =\n  | AddNetworkClientOperation\n  | RemoveNetworkClientOperation\n  | ReplaceNetworkClientOperation\n  | NoopNetworkClientOperation;\n\n/**\n * Determines whether the given URL is valid by attempting to parse it.\n *\n * @param url - The URL to test.\n * @returns True if the URL is valid, false otherwise.\n */\nfunction isValidUrl(url: string): boolean {\n  const uri = URI.parse(url);\n  return (\n    uri.error === undefined && (uri.scheme === 'http' || uri.scheme === 'https')\n  );\n}\n\n/**\n * Given an Infura API URL, extracts the subdomain that identifies the Infura\n * network.\n *\n * @param rpcEndpointUrl - The URL to operate on.\n * @returns The Infura network name that the URL references.\n * @throws if the URL is not an Infura API URL, or if an Infura network is not\n * present in the URL.\n */\nfunction deriveInfuraNetworkNameFromRpcEndpointUrl(\n  rpcEndpointUrl: string,\n): InfuraNetworkType {\n  const match = INFURA_URL_REGEX.exec(rpcEndpointUrl);\n\n  if (match?.groups) {\n    if (isInfuraNetworkType(match.groups.networkName)) {\n      return match.groups.networkName;\n    }\n\n    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);\n  }\n\n  throw new Error('Could not derive Infura network from RPC endpoint URL');\n}\n\n/**\n * Performs a series of checks that the given NetworkController state is\n * internally consistent â€” that all parts of state that are supposed to match in\n * fact do â€” so that working with the state later on doesn't cause unexpected\n * errors.\n *\n * In the case of NetworkController, there are several parts of state that need\n * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry\n * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC\n * endpoint within a network configuration.\n *\n * @param state - The NetworkController state to verify.\n * @throws if the state is invalid in some way.\n */\nfunction validateInitialState(state: NetworkState): void {\n  const networkConfigurationEntries = Object.entries(\n    state.networkConfigurationsByChainId,\n  );\n  const networkClientIds = getAvailableNetworkClientIds(\n    getNetworkConfigurations(state),\n  );\n\n  if (networkConfigurationEntries.length === 0) {\n    throw new Error(\n      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',\n    );\n  }\n\n  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {\n    if (chainId !== networkConfiguration.chainId) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \\`chainId\\` of '${networkConfiguration.chainId}'`,\n      );\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkConfiguration.blockExplorerUrls.length > 0\n        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||\n          networkConfiguration.blockExplorerUrls[\n            networkConfiguration.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultBlockExplorerUrlIndex\\` that does not refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ] === undefined\n    ) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultRpcEndpointIndex\\` that does not refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n    throw new Error(\n      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',\n    );\n  }\n}\n\n/**\n * Checks that the given initial NetworkController state is internally\n * consistent similar to `validateInitialState`, but if an anomaly is detected,\n * it does its best to correct the state and logs an error to Sentry.\n *\n * @param state - The NetworkController state to verify.\n * @param messenger - The NetworkController messenger.\n * @returns The corrected state.\n */\nfunction correctInitialState(\n  state: NetworkState,\n  messenger: NetworkControllerMessenger,\n): NetworkState {\n  const networkConfigurationsSortedByChainId = getNetworkConfigurations(\n    state,\n  ).sort((a, b) => a.chainId.localeCompare(b.chainId));\n  const availableNetworkClientIds = getAvailableNetworkClientIds(\n    networkConfigurationsSortedByChainId,\n  );\n  const invalidNetworkClientIdsWithMetadata = Object.keys(\n    state.networksMetadata,\n  ).filter(\n    (networkClientId) => !availableNetworkClientIds.includes(networkClientId),\n  );\n\n  return produce(state, (newState) => {\n    if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {\n      const firstNetworkConfiguration = networkConfigurationsSortedByChainId[0];\n      const newSelectedNetworkClientId =\n        firstNetworkConfiguration.rpcEndpoints[\n          firstNetworkConfiguration.defaultRpcEndpointIndex\n        ].networkClientId;\n      messenger.captureException?.(\n        new Error(\n          `\\`selectedNetworkClientId\\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,\n        ),\n      );\n      newState.selectedNetworkClientId = newSelectedNetworkClientId;\n    }\n\n    if (invalidNetworkClientIdsWithMetadata.length > 0) {\n      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {\n        delete newState.networksMetadata[invalidNetworkClientId];\n      }\n      messenger.captureException?.(\n        new Error(\n          '`networksMetadata` had invalid network client IDs, which have been removed',\n        ),\n      );\n    }\n  });\n}\n\n/**\n * Transforms a map of chain ID to network configuration to a map of network\n * client ID to network configuration.\n *\n * @param networkConfigurationsByChainId - The network configurations, keyed by\n * chain ID.\n * @returns The network configurations, keyed by network client ID.\n */\nfunction buildNetworkConfigurationsByNetworkClientId(\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>,\n): Map<NetworkClientId, NetworkConfiguration> {\n  return new Map(\n    Object.values(networkConfigurationsByChainId).flatMap(\n      (networkConfiguration) => {\n        return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n          return [rpcEndpoint.networkClientId, networkConfiguration];\n        });\n      },\n    ),\n  );\n}\n\n/**\n * Controller that creates and manages an Ethereum network provider.\n */\nexport class NetworkController extends BaseController<\n  typeof controllerName,\n  NetworkState,\n  NetworkControllerMessenger\n> {\n  #ethQuery?: EthQuery;\n\n  readonly #infuraProjectId: string;\n\n  #previouslySelectedNetworkClientId: string;\n\n  #providerProxy: ProviderProxy | undefined;\n\n  #blockTrackerProxy: BlockTrackerProxy | undefined;\n\n  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;\n\n  #autoManagedNetworkClient?:\n    | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n    | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  readonly #log: Logger | undefined;\n\n  readonly #getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];\n\n  readonly #getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];\n\n  #networkConfigurationsByNetworkClientId: Map<\n    NetworkClientId,\n    NetworkConfiguration\n  >;\n\n  #isRpcFailoverEnabled: Exclude<\n    NetworkControllerOptions['isRpcFailoverEnabled'],\n    undefined\n  >;\n\n  /**\n   * Constructs a NetworkController.\n   *\n   * @param options - The options; see {@link NetworkControllerOptions}.\n   */\n  constructor(options: NetworkControllerOptions) {\n    const {\n      messenger,\n      state,\n      infuraProjectId,\n      log,\n      getRpcServiceOptions,\n      getBlockTrackerOptions,\n      additionalDefaultNetworks,\n      isRpcFailoverEnabled = false,\n    } = options;\n    const initialState = {\n      ...getDefaultNetworkControllerState(additionalDefaultNetworks),\n      ...state,\n    };\n    validateInitialState(initialState);\n    const correctedInitialState = correctInitialState(initialState, messenger);\n\n    if (!infuraProjectId || typeof infuraProjectId !== 'string') {\n      throw new Error('Invalid Infura project ID');\n    }\n\n    super({\n      name: controllerName,\n      metadata: {\n        selectedNetworkClientId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networksMetadata: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networkConfigurationsByChainId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n      },\n      messenger,\n      state: correctedInitialState,\n    });\n\n    this.#infuraProjectId = infuraProjectId;\n    this.#log = log;\n    this.#getRpcServiceOptions = getRpcServiceOptions;\n    this.#getBlockTrackerOptions = getBlockTrackerOptions;\n    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;\n\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        this.state.networkConfigurationsByChainId,\n      );\n\n    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, () => {\n      return this.#ethQuery;\n    });\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkClientById`,\n      this.getNetworkClientById.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getEIP1559Compatibility`,\n      this.getEIP1559Compatibility.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setActiveNetwork`,\n      this.setActiveNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setProviderType`,\n      this.setProviderType.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:findNetworkClientIdByChainId`,\n      this.findNetworkClientIdByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByChainId`,\n      this.getNetworkConfigurationByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByNetworkClientId`,\n      this.getNetworkConfigurationByNetworkClientId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedNetworkClient`,\n      this.getSelectedNetworkClient.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedChainId`,\n      this.getSelectedChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:addNetwork`,\n      this.addNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:removeNetwork`,\n      this.removeNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:updateNetwork`,\n      this.updateNetwork.bind(this),\n    );\n\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainUnavailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Unavailable,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainDegraded`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Degraded,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainAvailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Available,\n        });\n      },\n    );\n  }\n\n  /**\n   * Enables the RPC failover functionality. That is, if any RPC endpoints are\n   * configured with failover URLs, then traffic will automatically be diverted\n   * to them if those RPC endpoints are unavailable.\n   */\n  enableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(true);\n  }\n\n  /**\n   * Disables the RPC failover functionality. That is, even if any RPC endpoints\n   * are configured with failover URLs, then traffic will not automatically be\n   * diverted to them if those RPC endpoints are unavailable.\n   */\n  disableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(false);\n  }\n\n  /**\n   * Enables or disables the RPC failover functionality, depending on the\n   * boolean given. This is done by reconstructing all network clients that were\n   * originally configured with failover URLs so that those URLs are either\n   * honored or ignored. Network client IDs will be preserved so as not to\n   * invalidate state in other controllers.\n   *\n   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the\n   * RPC failover functionality.\n   */\n  #updateRpcFailoverEnabled(newIsRpcFailoverEnabled: boolean): void {\n    if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {\n      return;\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    for (const networkClientsById of Object.values(\n      autoManagedNetworkClientRegistry,\n    )) {\n      for (const networkClientId of Object.keys(networkClientsById)) {\n        // Type assertion: We can assume that `networkClientId` is valid here.\n        const networkClient =\n          networkClientsById[\n            networkClientId as keyof typeof networkClientsById\n          ];\n        if (\n          networkClient.configuration.failoverRpcUrls &&\n          networkClient.configuration.failoverRpcUrls.length > 0\n        ) {\n          newIsRpcFailoverEnabled\n            ? networkClient.enableRpcFailover()\n            : networkClient.disableRpcFailover();\n        }\n      }\n    }\n\n    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns The proxy and block tracker proxies.\n   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.\n   */\n  getProviderAndBlockTracker(): {\n    provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>> | undefined;\n    blockTracker:\n      | SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>\n      | undefined;\n  } {\n    return {\n      provider: this.#providerProxy,\n      blockTracker: this.#blockTrackerProxy,\n    };\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns an object with the provider and block tracker proxies for the currently selected network.\n   */\n  getSelectedNetworkClient():\n    | {\n        provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n        blockTracker: SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>;\n      }\n    | undefined {\n    if (this.#providerProxy && this.#blockTrackerProxy) {\n      return {\n        provider: this.#providerProxy,\n        blockTracker: this.#blockTrackerProxy,\n      };\n    }\n    return undefined;\n  }\n\n  /**\n   * Accesses the chain ID from the selected network client.\n   *\n   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.\n   */\n  getSelectedChainId(): Hex | undefined {\n    const networkConfiguration = this.getNetworkConfigurationByNetworkClientId(\n      this.state.selectedNetworkClientId,\n    );\n    return networkConfiguration?.chainId;\n  }\n\n  /**\n   * Internally, the Infura and custom network clients are categorized by type\n   * so that when accessing either kind of network client, TypeScript knows\n   * which type to assign to the network client. For some cases it's more useful\n   * to be able to access network clients by ID instead of by type and then ID,\n   * so this function makes that possible.\n   *\n   * @returns The network clients registered so far, keyed by ID.\n   */\n  getNetworkClientRegistry(): AutoManagedBuiltInNetworkClientRegistry &\n    AutoManagedCustomNetworkClientRegistry {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    return Object.assign(\n      {},\n      autoManagedNetworkClientRegistry[NetworkClientType.Infura],\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom],\n    );\n  }\n\n  /**\n   * Returns the Infura network client with the given ID.\n   *\n   * @param infuraNetworkClientId - An Infura network client ID.\n   * @returns The Infura network client.\n   * @throws If an Infura network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    infuraNetworkClientId: BuiltInNetworkClientId,\n  ): AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  /**\n   * Returns the custom network client with the given ID.\n   *\n   * @param customNetworkClientId - A custom network client ID.\n   * @returns The custom network client.\n   * @throws If a custom network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    customNetworkClientId: CustomNetworkClientId,\n  ): AutoManagedNetworkClient<CustomNetworkClientConfiguration>;\n\n  getNetworkClientById(\n    networkClientId: NetworkClientId,\n  ): AutoManagedNetworkClient<NetworkClientConfiguration> {\n    if (!networkClientId) {\n      throw new Error('No network client ID was provided.');\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const infuraNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!infuraNetworkClient) {\n        throw new Error(\n          `No Infura network client was found with the ID \"${networkClientId}\".`,\n        );\n      }\n      return infuraNetworkClient;\n    }\n\n    const customNetworkClient =\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n        networkClientId\n      ];\n    if (!customNetworkClient) {\n      throw new Error(\n        `No custom network client was found with the ID \"${networkClientId}\".`,\n      );\n    }\n    return customNetworkClient;\n  }\n\n  /**\n   * Executes a series of steps to switch the network:\n   *\n   * 1. Notifies subscribers via the messenger that the network is about to be\n   * switched (and, really, that the global provider and block tracker proxies\n   * will be re-pointed to a new network).\n   * 2. Looks up a known and preinitialized network client matching the given\n   * ID and uses it to re-point the aforementioned provider and block tracker\n   * proxies.\n   * 3. Notifies subscribers via the messenger that the network has switched.\n   * 4. Captures metadata for the newly switched network in state.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   */\n  async #refreshNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.messenger.publish('NetworkController:networkWillChange', this.state);\n    this.#applyNetworkSelection(networkClientId, options);\n    this.messenger.publish('NetworkController:networkDidChange', this.state);\n    await this.lookupNetwork();\n  }\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   */\n  initializeProvider(options: { lookupNetwork: false }): void;\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   * @returns A promise that resolves when the network lookup completes.\n   */\n  initializeProvider(options?: { lookupNetwork?: boolean }): Promise<void>;\n\n  initializeProvider({\n    lookupNetwork = true,\n  }: {\n    lookupNetwork?: boolean;\n  } = {}): Promise<void> | undefined {\n    this.#applyNetworkSelection(this.state.selectedNetworkClientId);\n\n    if (lookupNetwork) {\n      return this.lookupNetwork();\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   * @returns The resulting metadata for the network.\n   */\n  async #determineNetworkMetadata(networkClientId: NetworkClientId): Promise<{\n    isInfura: boolean;\n    networkStatus:\n      | NetworkStatus.Available\n      | NetworkStatus.Unknown\n      | NetworkStatus.Unavailable\n      | NetworkStatus.Blocked;\n    isEIP1559Compatible: undefined | boolean;\n  }> {\n    // Force TypeScript to use one of the two overloads explicitly\n    const networkClient = isInfuraNetworkType(networkClientId)\n      ? this.getNetworkClientById(networkClientId)\n      : this.getNetworkClientById(networkClientId);\n\n    const isInfura =\n      networkClient.configuration.type === NetworkClientType.Infura;\n    let networkStatus: NetworkStatus;\n    let isEIP1559Compatible: boolean | undefined;\n\n    try {\n      isEIP1559Compatible =\n        await this.#determineEIP1559Compatibility(networkClientId);\n      networkStatus = NetworkStatus.Available;\n    } catch (error) {\n      debugLog('NetworkController: lookupNetwork: ', error);\n\n      if (isErrorWithCode(error)) {\n        let responseBody;\n        if (\n          isInfura &&\n          hasProperty(error, 'message') &&\n          typeof error.message === 'string'\n        ) {\n          try {\n            responseBody = JSON.parse(error.message);\n          } catch {\n            // error.message must not be JSON\n            this.#log?.warn(\n              'NetworkController: lookupNetwork: json parse error: ',\n              error,\n            );\n          }\n        }\n\n        if (\n          isPlainObject(responseBody) &&\n          responseBody.error === INFURA_BLOCKED_KEY\n        ) {\n          networkStatus = NetworkStatus.Blocked;\n        } else if (error.code === errorCodes.rpc.internal) {\n          networkStatus = NetworkStatus.Unknown;\n          this.#log?.warn(\n            'NetworkController: lookupNetwork: rpc internal error: ',\n            error,\n          );\n        } else {\n          networkStatus = NetworkStatus.Unavailable;\n          this.#log?.warn('NetworkController: lookupNetwork: ', error);\n        }\n      } else {\n        debugLog(\n          'NetworkController - could not determine network status',\n          error,\n        );\n        networkStatus = NetworkStatus.Unknown;\n        this.#log?.warn('NetworkController: lookupNetwork: ', error);\n      }\n    }\n\n    return { isInfura, networkStatus, isEIP1559Compatible };\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given or selected network, persisting it to state:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   */\n  async lookupNetwork(networkClientId?: NetworkClientId): Promise<void> {\n    if (networkClientId) {\n      await this.#lookupGivenNetwork(networkClientId);\n    } else {\n      await this.#lookupSelectedNetwork();\n    }\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * @deprecated Please use `lookupNetwork` and pass a network client ID\n   * instead. This method will be removed in a future major version.\n   */\n  // We are planning on removing this so we aren't interested in testing this\n  // right now.\n  /* istanbul ignore next */\n  async lookupNetworkByClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<void> {\n    await this.#lookupGivenNetwork(networkClientId);\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   */\n  async #lookupGivenNetwork(networkClientId: NetworkClientId): Promise<void> {\n    const { networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(networkClientId);\n\n    this.#updateMetadataForNetwork(networkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the currently selected network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * Note that it is possible for the current network to be switched while this\n   * method is running. If that is the case, it will exit early (as this method\n   * will also run for the new network).\n   */\n  async #lookupSelectedNetwork(): Promise<void> {\n    if (!this.#ethQuery) {\n      return;\n    }\n\n    let networkChanged = false;\n    const listener = (): void => {\n      networkChanged = true;\n      try {\n        this.messenger.unsubscribe(\n          'NetworkController:networkDidChange',\n          listener,\n        );\n      } catch (error) {\n        // In theory, this `catch` should not be necessary given that this error\n        // would occur \"inside\" of the call to `#determineEIP1559Compatibility`\n        // below and so it should be caught by the `try`/`catch` below (it is\n        // impossible to reproduce in tests for that reason). However, somehow\n        // it occurs within Mobile and so we have to add our own `try`/`catch`\n        // here.\n        /* istanbul ignore next */\n        if (\n          !(error instanceof Error) ||\n          error.message !==\n            'Subscription not found for event: NetworkController:networkDidChange'\n        ) {\n          // Again, this error should not happen and is impossible to reproduce\n          // in tests.\n          /* istanbul ignore next */\n          throw error;\n        }\n      }\n    };\n    this.messenger.subscribe('NetworkController:networkDidChange', listener);\n\n    const { isInfura, networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);\n\n    if (networkChanged) {\n      // If the network has changed, then `lookupNetwork` either has been or is\n      // in the process of being called, so we don't need to go further.\n      return;\n    }\n\n    try {\n      this.messenger.unsubscribe(\n        'NetworkController:networkDidChange',\n        listener,\n      );\n    } catch (error) {\n      if (\n        !(error instanceof Error) ||\n        error.message !==\n          'Subscription not found for event: NetworkController:networkDidChange'\n      ) {\n        throw error;\n      }\n    }\n\n    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n\n    if (isInfura) {\n      if (networkStatus === NetworkStatus.Available) {\n        this.messenger.publish('NetworkController:infuraIsUnblocked');\n      } else if (networkStatus === NetworkStatus.Blocked) {\n        this.messenger.publish('NetworkController:infuraIsBlocked');\n      }\n    } else {\n      // Always publish infuraIsUnblocked regardless of network status to\n      // prevent consumers from being stuck in a blocked state if they were\n      // previously connected to an Infura network that was blocked\n      this.messenger.publish('NetworkController:infuraIsUnblocked');\n    }\n  }\n\n  /**\n   * Updates the metadata for the given network in state.\n   *\n   * @param networkClientId - The associated network client ID.\n   * @param metadata - The metadata to store in state.\n   * @param metadata.networkStatus - The network status to store in state.\n   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to\n   * store in state.\n   */\n  #updateMetadataForNetwork(\n    networkClientId: NetworkClientId,\n    metadata: {\n      networkStatus: NetworkStatus;\n      isEIP1559Compatible?: boolean | undefined;\n    },\n  ): void {\n    this.update((state) => {\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      const newMetadata = state.networksMetadata[networkClientId];\n      newMetadata.status = metadata.networkStatus;\n\n      if ('isEIP1559Compatible' in metadata) {\n        if (metadata.isEIP1559Compatible === undefined) {\n          delete newMetadata.EIPS[1559];\n        } else {\n          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;\n        }\n      }\n    });\n  }\n\n  /**\n   * Convenience method to update provider network type settings.\n   *\n   * @param type - Human readable network name.\n   * @deprecated This has been replaced by `setActiveNetwork`, and will be\n   * removed in a future release\n   */\n  async setProviderType(type: InfuraNetworkType): Promise<void> {\n    if ((type as unknown) === NetworkType.rpc) {\n      throw new Error(\n        `NetworkController - cannot call \"setProviderType\" with type \"${NetworkType.rpc}\". Use \"setActiveNetwork\"`,\n      );\n    }\n    if (!isInfuraNetworkType(type)) {\n      throw new Error(`Unknown Infura provider type \"${String(type)}\".`);\n    }\n\n    await this.setActiveNetwork(type);\n  }\n\n  /**\n   * Changes the selected network.\n   *\n   * @param networkClientId - The ID of a network client that will be used to\n   * make requests.\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client is associated with the given\n   * network client ID.\n   */\n  async setActiveNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n\n    await this.#refreshNetwork(networkClientId, options);\n  }\n\n  /**\n   * Fetches the latest block for the network.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.\n   * @returns A promise that either resolves to the block header or null if\n   * there is no latest block, or rejects with an error.\n   */\n  #getLatestBlock(\n    networkClientId: NetworkClientId = this.state.selectedNetworkClientId,\n  ): Promise<Block> {\n    const networkClient = this.getNetworkClientById(networkClientId);\n    const ethQuery = new EthQuery(networkClient.provider);\n\n    return new Promise((resolve, reject) => {\n      ethQuery.sendAsync(\n        { method: 'eth_getBlockByNumber', params: ['latest', false] },\n        (error: unknown, block?: unknown) => {\n          if (error) {\n            // This error comes from JsonRpcEngine, we don't control it.\n            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n            reject(error);\n          } else {\n            // TODO: Validate this type\n            resolve(block as Block);\n          }\n        },\n      );\n    });\n  }\n\n  /**\n   * Determines whether the network supports EIP-1559 by checking whether the\n   * latest block has a `baseFeePerGas` property, then updates state\n   * appropriately.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.\n   * @returns A promise that resolves to true if the network supports EIP-1559\n   * , false otherwise, or `undefined` if unable to determine the compatibility.\n   */\n  async getEIP1559Compatibility(\n    networkClientId?: NetworkClientId,\n  ): Promise<undefined | boolean> {\n    if (networkClientId) {\n      return this.get1559CompatibilityWithNetworkClientId(networkClientId);\n    }\n    if (!this.#ethQuery) {\n      return false;\n    }\n\n    const { EIPS } =\n      this.state.networksMetadata[this.state.selectedNetworkClientId];\n\n    if (EIPS[1559] !== undefined) {\n      return EIPS[1559];\n    }\n\n    const isEIP1559Compatible = await this.#determineEIP1559Compatibility(\n      this.state.selectedNetworkClientId,\n    );\n    this.update((state) => {\n      if (isEIP1559Compatible !== undefined) {\n        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =\n          isEIP1559Compatible;\n      }\n    });\n    return isEIP1559Compatible;\n  }\n\n  async get1559CompatibilityWithNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean> {\n    let metadata = this.state.networksMetadata[networkClientId];\n    if (metadata?.EIPS[1559] === undefined) {\n      await this.lookupNetwork(networkClientId);\n      metadata = this.state.networksMetadata[networkClientId];\n    }\n    const { EIPS } = metadata;\n\n    // may want to include some 'freshness' value - something to make sure we refetch this from time to time\n    return EIPS[1559];\n  }\n\n  /**\n   * Retrieves and checks the latest block from the currently selected\n   * network; if the block has a `baseFeePerGas` property, then we know\n   * that the network supports EIP-1559; otherwise it doesn't.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility\n   * @returns A promise that resolves to `true` if the network supports EIP-1559,\n   * `false` otherwise, or `undefined` if unable to retrieve the last block.\n   */\n  async #determineEIP1559Compatibility(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean | undefined> {\n    const latestBlock = await this.#getLatestBlock(networkClientId);\n\n    if (!latestBlock) {\n      return undefined;\n    }\n\n    return latestBlock.baseFeePerGas !== undefined;\n  }\n\n  /**\n   * Ensures that the provider and block tracker proxies are pointed to the\n   * currently selected network and refreshes the metadata for the\n   */\n  async resetConnection(): Promise<void> {\n    await this.#refreshNetwork(this.state.selectedNetworkClientId);\n  }\n\n  /**\n   * Returns the network configuration that has been filed under the given chain\n   * ID.\n   *\n   * @param chainId - The chain ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByChainId(\n    chainId: Hex,\n  ): NetworkConfiguration | undefined {\n    return this.state.networkConfigurationsByChainId[chainId];\n  }\n\n  /**\n   * Returns the network configuration that contains an RPC endpoint with the\n   * given network client ID.\n   *\n   * @param networkClientId - The network client ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): NetworkConfiguration | undefined {\n    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);\n  }\n\n  /**\n   * Creates and registers network clients for the collection of Infura and\n   * custom RPC endpoints that can be used to make requests for a particular\n   * chain, storing the given configuration object in state for later reference.\n   *\n   * @param fields - The object that describes the new network/chain and lists\n   * the RPC endpoints which front that chain.\n   * @returns The newly added network configuration.\n   * @throws if any part of `fields` would produce invalid state.\n   * @see {@link NetworkConfiguration}\n   */\n  addNetwork(fields: AddNetworkFields): NetworkConfiguration {\n    const { rpcEndpoints: setOfRpcEndpointFields } = fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'add',\n      networkFields: fields,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations = setOfRpcEndpointFields.map(\n      (defaultOrCustomRpcEndpointFields) => {\n        const rpcEndpoint =\n          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom\n            ? {\n                ...defaultOrCustomRpcEndpointFields,\n                networkClientId: uuidV4(),\n              }\n            : defaultOrCustomRpcEndpointFields;\n        return {\n          type: 'add' as const,\n          rpcEndpoint,\n        };\n      },\n    );\n\n    const newNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'add',\n        networkFields: fields,\n        networkConfigurationToPersist: newNetworkConfiguration,\n      });\n    });\n\n    this.messenger.publish(\n      `${controllerName}:networkAdded`,\n      newNetworkConfiguration,\n    );\n\n    return newNetworkConfiguration;\n  }\n\n  /**\n   * Updates the configuration for a previously stored network filed under the\n   * given chain ID, creating + registering new network clients to represent RPC\n   * endpoints that have been added and destroying + unregistering existing\n   * network clients for RPC endpoints that have been removed.\n   *\n   * Note that if `chainId` is changed, then all network clients associated with\n   * that chain will be removed and re-added, even if none of the RPC endpoints\n   * have changed.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @param fields - The object that describes the updates to the network/chain,\n   * including the new set of RPC endpoints which should front that chain.\n   * @param options - Options to provide.\n   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot\n   * remove an RPC endpoint that is being represented by the currently selected\n   * network client. This option allows you to specify another RPC endpoint\n   * (either an existing one or a new one) that should be used to select a new\n   * network instead.\n   * @returns The updated network configuration.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * if any part of `fields` would produce invalid state, etc.\n   * @see {@link NetworkConfiguration}\n   */\n  async updateNetwork(\n    chainId: Hex,\n    fields: UpdateNetworkFields,\n    {\n      replacementSelectedRpcEndpointIndex,\n    }: { replacementSelectedRpcEndpointIndex?: number } = {},\n  ): Promise<NetworkConfiguration> {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Could not update network: Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    const existingChainId = chainId;\n    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =\n      fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'update',\n      networkFields: fields,\n      existingNetworkConfiguration,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations: NetworkClientOperation[] = [];\n\n    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {\n      const existingRpcEndpointForNoop =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            rpcEndpoint.url === newRpcEndpointFields.url &&\n            (rpcEndpoint.networkClientId ===\n              newRpcEndpointFields.networkClientId ||\n              newRpcEndpointFields.networkClientId === undefined)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            (rpcEndpoint.type === RpcEndpointType.Infura &&\n              newRpcEndpointFields.type === RpcEndpointType.Infura) ||\n            (rpcEndpoint.type === newRpcEndpointFields.type &&\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId &&\n              rpcEndpoint.url === newRpcEndpointFields.url)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainNotChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            (rpcEndpoint.url === newRpcEndpointFields.url ||\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId)\n          );\n        });\n\n      if (\n        newChainId !== existingChainId &&\n        existingRpcEndpointForReplaceWhenChainChanged !== undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,\n          newRpcEndpoint,\n        });\n      } else if (existingRpcEndpointForNoop !== undefined) {\n        let newRpcEndpoint;\n        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {\n          newRpcEndpoint = existingRpcEndpointForNoop;\n        } else {\n          // `networkClientId` shouldn't be missing at this point; if it is,\n          // that's a mistake, so fill it back in\n          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {\n            networkClientId: existingRpcEndpointForNoop.networkClientId,\n          });\n        }\n        networkClientOperations.push({\n          type: 'noop' as const,\n          rpcEndpoint: newRpcEndpoint,\n        });\n      } else if (\n        existingRpcEndpointForReplaceWhenChainNotChanged === undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n        const networkClientOperation = {\n          type: 'add' as const,\n          rpcEndpoint: newRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      } else {\n        let newRpcEndpoint;\n        /* istanbul ignore if */\n        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {\n          // This case can't actually happen. If we're here, it means that some\n          // part of the RPC endpoint changed. But there is no part of an Infura\n          // RPC endpoint that can be changed (as it would immediately make that\n          // RPC endpoint self-inconsistent). This is just here to appease\n          // TypeScript.\n          newRpcEndpoint = newRpcEndpointFields;\n        } else {\n          newRpcEndpoint = {\n            ...newRpcEndpointFields,\n            networkClientId: uuidV4(),\n          };\n        }\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,\n          newRpcEndpoint,\n        });\n      }\n    }\n\n    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n      if (\n        !networkClientOperations.some((networkClientOperation) => {\n          const otherRpcEndpoint =\n            networkClientOperation.type === 'replace'\n              ? networkClientOperation.oldRpcEndpoint\n              : networkClientOperation.rpcEndpoint;\n          return (\n            otherRpcEndpoint.type === existingRpcEndpoint.type &&\n            otherRpcEndpoint.networkClientId ===\n              existingRpcEndpoint.networkClientId &&\n            otherRpcEndpoint.url === existingRpcEndpoint.url\n          );\n        })\n      ) {\n        const networkClientOperation = {\n          type: 'remove' as const,\n          rpcEndpoint: existingRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      }\n    }\n\n    const updatedNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n\n    if (\n      replacementSelectedRpcEndpointIndex === undefined &&\n      networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'remove' &&\n          networkClientOperation.rpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      }) &&\n      !networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      })\n    ) {\n      throw new Error(\n        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \\`replacementSelectedRpcEndpointIndex\\` option.`,\n      );\n    }\n\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const replacementSelectedRpcEndpointWithIndex = networkClientOperations\n      .map(\n        (networkClientOperation, index) =>\n          [networkClientOperation, index] as const,\n      )\n      .find(([networkClientOperation, _index]) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      });\n    const correctedReplacementSelectedRpcEndpointIndex =\n      replacementSelectedRpcEndpointIndex ??\n      replacementSelectedRpcEndpointWithIndex?.[1];\n\n    let rpcEndpointToSelect: RpcEndpoint | undefined;\n    if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {\n      rpcEndpointToSelect =\n        updatedNetworkConfiguration.rpcEndpoints[\n          correctedReplacementSelectedRpcEndpointIndex\n        ];\n\n      if (rpcEndpointToSelect === undefined) {\n        throw new Error(\n          `Could not update network: \\`replacementSelectedRpcEndpointIndex\\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \\`rpcEndpoints\\``,\n        );\n      }\n    }\n\n    if (\n      rpcEndpointToSelect &&\n      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId\n    ) {\n      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {\n        updateState: (state) => {\n          this.#updateNetworkConfigurations({\n            state,\n            mode: 'update',\n            networkFields: fields,\n            networkConfigurationToPersist: updatedNetworkConfiguration,\n            existingNetworkConfiguration,\n          });\n        },\n      });\n    } else {\n      this.update((state) => {\n        this.#updateNetworkConfigurations({\n          state,\n          mode: 'update',\n          networkFields: fields,\n          networkConfigurationToPersist: updatedNetworkConfiguration,\n          existingNetworkConfiguration,\n        });\n      });\n    }\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    return updatedNetworkConfiguration;\n  }\n\n  /**\n   * Destroys and unregisters the network identified by the given chain ID, also\n   * removing the associated network configuration from state.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * or if the currently selected network is being removed.\n   * @see {@link NetworkConfiguration}\n   */\n  removeNetwork(chainId: Hex): void {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration.rpcEndpoints.some(\n        (rpcEndpoint) =>\n          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,\n      )\n    ) {\n      throw new Error(`Cannot remove the currently selected network`);\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    const networkClientOperations =\n      existingNetworkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        return {\n          type: 'remove' as const,\n          rpcEndpoint,\n        };\n      });\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'remove',\n        existingNetworkConfiguration,\n      });\n\n      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n        delete state.networksMetadata[rpcEndpoint.networkClientId];\n      }\n    });\n\n    this.messenger.publish(\n      'NetworkController:networkRemoved',\n      existingNetworkConfiguration,\n    );\n  }\n\n  /**\n   * Assuming that the network has been previously switched, switches to this\n   * new network.\n   *\n   * If the network has not been previously switched, this method is equivalent\n   * to {@link resetConnection}.\n   */\n  async rollbackToPreviousProvider(): Promise<void> {\n    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);\n  }\n\n  /**\n   * Deactivates the controller, stopping any ongoing polling.\n   *\n   * In-progress requests will not be aborted.\n   */\n  // We're intentionally changing the signature of an extended method.\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  async destroy(): Promise<void> {\n    await this.#blockTrackerProxy?.destroy();\n  }\n\n  /**\n   * Merges the given backup data into controller state.\n   *\n   * @param backup - The data that has been backed up.\n   * @param backup.networkConfigurationsByChainId - Network configurations,\n   * keyed by chain ID.\n   */\n  loadBackup({\n    networkConfigurationsByChainId,\n  }: Pick<NetworkState, 'networkConfigurationsByChainId'>): void {\n    this.update((state) => {\n      state.networkConfigurationsByChainId = {\n        ...state.networkConfigurationsByChainId,\n        ...networkConfigurationsByChainId,\n      };\n    });\n  }\n\n  /**\n   * Searches for the default RPC endpoint configured for the given chain and\n   * returns its network client ID. This can then be passed to\n   * {@link getNetworkClientById} to retrieve the network client.\n   *\n   * @param chainId - Chain ID to search for.\n   * @returns The ID of the network client created for the chain's default RPC\n   * endpoint.\n   */\n  findNetworkClientIdByChainId(chainId: Hex): NetworkClientId {\n    const networkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (!networkConfiguration) {\n      throw new Error(`Invalid chain ID \"${chainId}\"`);\n    }\n\n    const { networkClientId } =\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ];\n    return networkClientId;\n  }\n\n  /**\n   * Ensure that the given fields which will be used to either add or update a\n   * network are valid.\n   *\n   * @param args - The arguments.\n   */\n  #validateNetworkFields(\n    args: {\n      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n    } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n        }\n      | {\n          mode: 'update';\n          existingNetworkConfiguration: NetworkConfiguration;\n          networkFields: UpdateNetworkFields;\n        }\n    ),\n  ): void {\n    const { mode, networkFields, autoManagedNetworkClientRegistry } = args;\n    const existingNetworkConfiguration =\n      'existingNetworkConfiguration' in args\n        ? args.existingNetworkConfiguration\n        : null;\n\n    const errorMessagePrefix =\n      mode === 'update' ? 'Could not update network' : 'Could not add network';\n\n    if (\n      !isStrictHexString(networkFields.chainId) ||\n      !isSafeChainId(networkFields.chainId)\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Invalid \\`chainId\\` '${networkFields.chainId}' (must start with \"0x\" and not exceed the maximum)`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration === null ||\n      networkFields.chainId !== existingNetworkConfiguration.chainId\n    ) {\n      const existingNetworkConfigurationViaChainId =\n        this.state.networkConfigurationsByChainId[networkFields.chainId];\n      if (existingNetworkConfigurationViaChainId !== undefined) {\n        if (existingNetworkConfiguration === null) {\n          throw new Error(\n            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        } else {\n          throw new Error(\n            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        }\n      }\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkFields.blockExplorerUrls.length > 0\n        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||\n          networkFields.blockExplorerUrls[\n            networkFields.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkFields.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultBlockExplorerUrlIndex\\` must refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (networkFields.rpcEndpoints.length === 0) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`rpcEndpoints\\` must be a non-empty array`,\n      );\n    }\n    for (const rpcEndpointFields of networkFields.rpcEndpoints) {\n      if (!isValidUrl(rpcEndpointFields.url)) {\n        throw new Error(\n          `${errorMessagePrefix}: An entry in \\`rpcEndpoints\\` has invalid URL '${rpcEndpointFields.url}'`,\n        );\n      }\n      const networkClientId =\n        'networkClientId' in rpcEndpointFields\n          ? rpcEndpointFields.networkClientId\n          : undefined;\n\n      if (\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        networkClientId !== undefined &&\n        isInfuraNetworkType(networkClientId)\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,\n        );\n      }\n\n      if (\n        mode === 'update' &&\n        networkClientId !== undefined &&\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        !Object.values(autoManagedNetworkClientRegistry).some(\n          (networkClientsById) => networkClientId in networkClientsById,\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,\n        );\n      }\n\n      if (\n        networkFields.rpcEndpoints.some(\n          (otherRpcEndpointFields) =>\n            otherRpcEndpointFields !== rpcEndpointFields &&\n            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,\n        );\n      }\n\n      const networkConfigurationsForOtherChains = Object.values(\n        this.state.networkConfigurationsByChainId,\n      ).filter((networkConfiguration) =>\n        existingNetworkConfiguration\n          ? networkConfiguration.chainId !==\n            existingNetworkConfiguration.chainId\n          : true,\n      );\n      for (const networkConfiguration of networkConfigurationsForOtherChains) {\n        const rpcEndpoint = networkConfiguration.rpcEndpoints.find(\n          (existingRpcEndpoint) =>\n            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),\n        );\n        if (rpcEndpoint) {\n          if (mode === 'update') {\n            throw new Error(\n              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          } else {\n            throw new Error(\n              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          }\n        }\n      }\n    }\n\n    if (\n      [...new Set(networkFields.rpcEndpoints)].length <\n      networkFields.rpcEndpoints.length\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,\n      );\n    }\n\n    const networkClientIds = networkFields.rpcEndpoints\n      .map((rpcEndpoint) =>\n        'networkClientId' in rpcEndpoint\n          ? rpcEndpoint.networkClientId\n          : undefined,\n      )\n      .filter(\n        (networkClientId): networkClientId is NetworkClientId =>\n          networkClientId !== undefined,\n      );\n    if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,\n      );\n    }\n\n    const infuraRpcEndpoints = networkFields.rpcEndpoints.filter(\n      (rpcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =>\n        rpcEndpointFields.type === RpcEndpointType.Infura,\n    );\n    if (infuraRpcEndpoints.length > 1) {\n      throw new Error(\n        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,\n      );\n    }\n\n    const soleInfuraRpcEndpoint = infuraRpcEndpoints[0];\n    if (soleInfuraRpcEndpoint) {\n      const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n        soleInfuraRpcEndpoint.url,\n      );\n      const infuraNetworkNickname = NetworkNickname[infuraNetworkName];\n      const infuraChainId = ChainId[infuraNetworkName];\n      if (networkFields.chainId !== infuraChainId) {\n        throw new Error(\n          mode === 'add'\n            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`\n            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,\n        );\n      }\n    }\n\n    if (\n      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===\n      undefined\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultRpcEndpointIndex\\` must refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  /**\n   * Constructs a network configuration that will be persisted to state when\n   * adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Operations which were calculated for\n   * updating the network client registry but which also map back to RPC\n   * endpoints (and so can be used to save those RPC endpoints).\n   * @returns The network configuration to persist.\n   */\n  #determineNetworkConfigurationToPersist({\n    networkFields,\n    networkClientOperations,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n  }): NetworkConfiguration {\n    const rpcEndpointsToPersist = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is\n          | AddNetworkClientOperation\n          | NoopNetworkClientOperation => {\n          return (\n            networkClientOperation.type === 'add' ||\n            networkClientOperation.type === 'noop'\n          );\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };\n  }\n\n  /**\n   * Creates and registers network clients using the given operations calculated\n   * as a part of adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Dictate which network clients need to\n   * be created.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #registerNetworkClientsAsNeeded({\n    networkFields,\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const addedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is AddNetworkClientOperation => {\n          return networkClientOperation.type === 'add';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    for (const addedRpcEndpoint of addedRpcEndpoints) {\n      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Infura,\n            chainId: networkFields.chainId,\n            network: addedRpcEndpoint.networkClientId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            infuraProjectId: this.#infuraProjectId,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      } else {\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Custom,\n            chainId: networkFields.chainId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            rpcUrl: addedRpcEndpoint.url,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      }\n    }\n  }\n\n  /**\n   * Destroys and removes network clients using the given operations calculated\n   * as a part of updating or removing a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkClientOperations - Dictate which network clients to\n   * remove.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #unregisterNetworkClientsAsNeeded({\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const removedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is RemoveNetworkClientOperation => {\n          return networkClientOperation.type === 'remove';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.oldRpcEndpoint,\n          ),\n      );\n\n    for (const rpcEndpoint of removedRpcEndpoints) {\n      const networkClient = this.getNetworkClientById(\n        rpcEndpoint.networkClientId,\n      );\n      networkClient.destroy();\n      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][\n        rpcEndpoint.networkClientId\n      ];\n    }\n  }\n\n  /**\n   * Updates `networkConfigurationsByChainId` in state depending on whether a\n   * network is being added, updated, or removed.\n   *\n   * - The existing network configuration will be removed when a network is\n   * being filed under a different chain or removed.\n   * - A network configuration will be stored when a network is being added or\n   * when a network is being updated.\n   *\n   * @param args - The arguments to this function.\n   */\n  #updateNetworkConfigurations(\n    args: { state: Draft<NetworkState> } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n        }\n      | {\n          mode: 'update';\n          networkFields: UpdateNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n      | {\n          mode: 'remove';\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n    ),\n  ): void {\n    const { state, mode } = args;\n\n    if (\n      mode === 'remove' ||\n      (mode === 'update' &&\n        args.networkFields.chainId !==\n          args.existingNetworkConfiguration.chainId)\n    ) {\n      delete state.networkConfigurationsByChainId[\n        args.existingNetworkConfiguration.chainId\n      ];\n    }\n\n    if (mode === 'add' || mode === 'update') {\n      if (\n        !deepEqual(\n          state.networkConfigurationsByChainId[args.networkFields.chainId],\n          args.networkConfigurationToPersist,\n        )\n      ) {\n        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();\n      }\n      state.networkConfigurationsByChainId[args.networkFields.chainId] =\n        args.networkConfigurationToPersist;\n    }\n\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        cloneDeep(state.networkConfigurationsByChainId),\n      );\n  }\n\n  /**\n   * Before accessing or switching the network, the registry of network clients\n   * needs to be populated. Otherwise, `#applyNetworkSelection` and\n   * `getNetworkClientRegistry` will throw an error. This method checks to see if the\n   * population step has happened yet, and if not, makes it happen.\n   *\n   * @returns The populated network client registry.\n   */\n  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {\n    return (this.#autoManagedNetworkClientRegistry ??=\n      this.#createAutoManagedNetworkClientRegistry());\n  }\n\n  /**\n   * Constructs the registry of network clients based on the set of default\n   * and custom networks in state.\n   *\n   * @returns The network clients keyed by ID.\n   */\n  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {\n    const chainIds = knownKeysOf(this.state.networkConfigurationsByChainId);\n    const networkClientsWithIds = chainIds.flatMap((chainId) => {\n      const networkConfiguration =\n        this.state.networkConfigurationsByChainId[chainId];\n      return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        if (rpcEndpoint.type === RpcEndpointType.Infura) {\n          const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n            rpcEndpoint.url,\n          );\n          return [\n            rpcEndpoint.networkClientId,\n            createAutoManagedNetworkClient({\n              networkClientId: rpcEndpoint.networkClientId,\n              networkClientConfiguration: {\n                type: NetworkClientType.Infura,\n                network: infuraNetworkName,\n                failoverRpcUrls: rpcEndpoint.failoverUrls,\n                infuraProjectId: this.#infuraProjectId,\n                chainId: networkConfiguration.chainId,\n                ticker: networkConfiguration.nativeCurrency,\n              },\n              getRpcServiceOptions: this.#getRpcServiceOptions,\n              getBlockTrackerOptions: this.#getBlockTrackerOptions,\n              messenger: this.messenger,\n              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n              logger: this.#log,\n            }),\n          ] as const;\n        }\n        return [\n          rpcEndpoint.networkClientId,\n          createAutoManagedNetworkClient({\n            networkClientId: rpcEndpoint.networkClientId,\n            networkClientConfiguration: {\n              type: NetworkClientType.Custom,\n              chainId: networkConfiguration.chainId,\n              failoverRpcUrls: rpcEndpoint.failoverUrls,\n              rpcUrl: rpcEndpoint.url,\n              ticker: networkConfiguration.nativeCurrency,\n            },\n            getRpcServiceOptions: this.#getRpcServiceOptions,\n            getBlockTrackerOptions: this.#getBlockTrackerOptions,\n            messenger: this.messenger,\n            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n            logger: this.#log,\n          }),\n        ] as const;\n      });\n    });\n\n    return networkClientsWithIds.reduce(\n      (\n        obj: {\n          [NetworkClientType.Custom]: Partial<AutoManagedCustomNetworkClientRegistry>;\n          [NetworkClientType.Infura]: Partial<AutoManagedBuiltInNetworkClientRegistry>;\n        },\n        [networkClientId, networkClient],\n      ) => {\n        return {\n          ...obj,\n          [networkClient.configuration.type]: {\n            ...obj[networkClient.configuration.type],\n            [networkClientId]: networkClient,\n          },\n        };\n      },\n      {\n        [NetworkClientType.Custom]: {},\n        [NetworkClientType.Infura]: {},\n      },\n    ) as AutoManagedNetworkClientRegistry;\n  }\n\n  /**\n   * Updates the global provider and block tracker proxies (accessible via\n   * {@link getSelectedNetworkClient}) to point to the same ones within the\n   * given network client, thereby magically switching any consumers using these\n   * proxies to use the new network.\n   *\n   * Also refreshes the EthQuery instance accessible via the `getEthQuery`\n   * action to wrap the provider from the new network client. Note that this is\n   * not a proxy, so consumers will need to call `getEthQuery` again after the\n   * network switch.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client could be found matching the given ID.\n   */\n  #applyNetworkSelection(\n    networkClientId: string,\n    {\n      updateState,\n    }: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): void {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    let autoManagedNetworkClient:\n      | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n      | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(\n          `No Infura network client found with ID '${networkClientId}'`,\n        );\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    } else {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          networkClientId\n        ];\n\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(`No network client found with ID '${networkClientId}'`);\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    }\n\n    this.#autoManagedNetworkClient = autoManagedNetworkClient;\n\n    this.update((state) => {\n      state.selectedNetworkClientId = networkClientId;\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      updateState?.(state);\n    });\n\n    if (this.#providerProxy) {\n      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);\n    } else {\n      this.#providerProxy = createSwappableProxy(\n        this.#autoManagedNetworkClient.provider,\n      );\n    }\n\n    if (this.#blockTrackerProxy) {\n      this.#blockTrackerProxy.setTarget(\n        this.#autoManagedNetworkClient.blockTracker,\n      );\n    } else {\n      this.#blockTrackerProxy = createEventEmitterProxy(\n        this.#autoManagedNetworkClient.blockTracker,\n        {\n          eventFilter: 'skipInternal',\n        },\n      );\n    }\n\n    this.#ethQuery = new EthQuery(this.#providerProxy);\n  }\n}\n"]}
\ No newline at end of file
diff --git a/dist/NetworkController.d.cts b/dist/NetworkController.d.cts
index 78bdd55d2ad6ea55226e8c5bf9b9af7b4fb4e35b..4908a7a9eec9b0971ceb5e3c363f8725feeae795 100644
--- a/dist/NetworkController.d.cts
+++ b/dist/NetworkController.d.cts
@@ -1,5 +1,6 @@
 import type { ControllerGetStateAction, ControllerStateChangeEvent } from "@metamask/base-controller";
 import { BaseController } from "@metamask/base-controller";
+import type { ConnectivityControllerGetStateAction } from "@metamask/connectivity-controller";
 import type { Partialize } from "@metamask/controller-utils";
 import { InfuraNetworkType } from "@metamask/controller-utils";
 import type { PollingBlockTrackerOptions } from "@metamask/eth-block-tracker";
@@ -569,7 +570,7 @@ export type NetworkControllerActions = NetworkControllerGetStateAction | Network
 /**
  * All actions that {@link NetworkController} calls internally.
  */
-type AllowedActions = never;
+type AllowedActions = ConnectivityControllerGetStateAction;
 export type NetworkControllerMessenger = Messenger<typeof controllerName, NetworkControllerActions | AllowedActions, NetworkControllerEvents | AllowedEvents>;
 /**
  * Options for the NetworkController constructor.
diff --git a/dist/NetworkController.d.cts.map b/dist/NetworkController.d.cts.map
index 3b675df88c49ed3741e218772749a024f83181b8..d32fac13da6e0fc82debdf8cd88e135606ec83f1 100644
--- a/dist/NetworkController.d.cts.map
+++ b/dist/NetworkController.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"NetworkController.d.cts","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"NetworkController.d.cts","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/NetworkController.d.mts b/dist/NetworkController.d.mts
index f0c5202edb98ad53d73ed95b44745a1ad224bc20..16dcbfbe8f2b8b1d02abcc21886f51feba07d546 100644
--- a/dist/NetworkController.d.mts
+++ b/dist/NetworkController.d.mts
@@ -1,5 +1,6 @@
 import type { ControllerGetStateAction, ControllerStateChangeEvent } from "@metamask/base-controller";
 import { BaseController } from "@metamask/base-controller";
+import type { ConnectivityControllerGetStateAction } from "@metamask/connectivity-controller";
 import type { Partialize } from "@metamask/controller-utils";
 import { InfuraNetworkType } from "@metamask/controller-utils";
 import type { PollingBlockTrackerOptions } from "@metamask/eth-block-tracker";
@@ -569,7 +570,7 @@ export type NetworkControllerActions = NetworkControllerGetStateAction | Network
 /**
  * All actions that {@link NetworkController} calls internally.
  */
-type AllowedActions = never;
+type AllowedActions = ConnectivityControllerGetStateAction;
 export type NetworkControllerMessenger = Messenger<typeof controllerName, NetworkControllerActions | AllowedActions, NetworkControllerEvents | AllowedEvents>;
 /**
  * Options for the NetworkController constructor.
diff --git a/dist/NetworkController.d.mts.map b/dist/NetworkController.d.mts.map
index bde3bbfe028d6a7c9326434cd72fc2eda90f1a56..3bb139676a6ff544c7f3230712abff4577949193 100644
--- a/dist/NetworkController.d.mts.map
+++ b/dist/NetworkController.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"NetworkController.d.mts","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"NetworkController.d.mts","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/NetworkController.mjs b/dist/NetworkController.mjs
index 82d00b719436b655f39f57bdf2cc6c36bba14e49..0bc9fec69b38adfba6661a642b1b428a64ff4a3c 100644
--- a/dist/NetworkController.mjs
+++ b/dist/NetworkController.mjs
@@ -143,6 +143,12 @@ function getDefaultCustomNetworkConfigurationsByChainId() {
         [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(CustomNetworkType['megaeth-testnet']),
         [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(CustomNetworkType['megaeth-testnet-v2']),
         [ChainId['monad-testnet']]: getCustomNetworkConfiguration(CustomNetworkType['monad-testnet']),
+        // Environment 3: Power User test networks
+        [ChainId['fantom-mainnet']]: getCustomNetworkConfiguration(CustomNetworkType['fantom-mainnet']),
+        [ChainId['gnosis-mainnet']]: getCustomNetworkConfiguration(CustomNetworkType['gnosis-mainnet']),
+        [ChainId['cronos-mainnet']]: getCustomNetworkConfiguration(CustomNetworkType['cronos-mainnet']),
+        [ChainId['moonbeam-mainnet']]: getCustomNetworkConfiguration(CustomNetworkType['moonbeam-mainnet']),
+        [ChainId['moonriver-mainnet']]: getCustomNetworkConfiguration(CustomNetworkType['moonriver-mainnet']),
     };
 }
 /**
diff --git a/dist/NetworkController.mjs.map b/dist/NetworkController.mjs.map
index ff897295b426e4a25986d6d138ad007d04aadbc9..aec49a0eed83a404c263aaca8e249bc4405395eb 100644
--- a/dist/NetworkController.mjs.map
+++ b/dist/NetworkController.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"NetworkController.mjs","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport { BaseController } from '@metamask/base-controller';\nimport type { Partialize } from '@metamask/controller-utils';\nimport {\n  InfuraNetworkType,\n  CustomNetworkType,\n  NetworkType,\n  isSafeChainId,\n  isInfuraNetworkType,\n  ChainId,\n  NetworksTicker,\n  NetworkNickname,\n  BUILT_IN_CUSTOM_NETWORKS_RPC,\n  BUILT_IN_NETWORKS,\n} from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport EthQuery from '@metamask/eth-query';\nimport type { Messenger } from '@metamask/messenger';\nimport { errorCodes } from '@metamask/rpc-errors';\nimport {\n  createEventEmitterProxy,\n  createSwappableProxy,\n} from '@metamask/swappable-obj-proxy';\nimport type { SwappableProxy } from '@metamask/swappable-obj-proxy';\nimport type { Hex } from '@metamask/utils';\nimport { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';\nimport deepEqual from 'fast-deep-equal';\nimport type { Draft } from 'immer';\nimport { produce } from 'immer';\nimport { cloneDeep } from 'lodash';\nimport type { Logger } from 'loglevel';\nimport { createSelector } from 'reselect';\nimport * as URI from 'uri-js';\nimport { v4 as uuidV4 } from 'uuid';\n\nimport {\n  DEPRECATED_NETWORKS,\n  INFURA_BLOCKED_KEY,\n  NetworkStatus,\n} from './constants';\nimport type {\n  AutoManagedNetworkClient,\n  ProxyWithAccessibleTarget,\n} from './create-auto-managed-network-client';\nimport { createAutoManagedNetworkClient } from './create-auto-managed-network-client';\nimport { projectLogger, createModuleLogger } from './logger';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { NetworkClientType } from './types';\nimport type {\n  BlockTracker,\n  Provider,\n  CustomNetworkClientConfiguration,\n  InfuraNetworkClientConfiguration,\n  NetworkClientConfiguration,\n  AdditionalDefaultNetwork,\n} from './types';\n\nconst debugLog = createModuleLogger(projectLogger, 'NetworkController');\n\nconst INFURA_URL_REGEX =\n  /^https:\\/\\/(?<networkName>[^.]+)\\.infura\\.io\\/v\\d+\\/(?<apiKey>.+)$/u;\n\nexport type Block = {\n  baseFeePerGas?: string;\n};\n\n/**\n * Information about a network not held by any other part of state.\n */\nexport type NetworkMetadata = {\n  /**\n   * EIPs supported by the network.\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  EIPS: {\n    [eipNumber: number]: boolean;\n  };\n  /**\n   * Indicates the availability of the network\n   */\n  status: NetworkStatus;\n};\n\n/**\n * The type of an RPC endpoint.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport enum RpcEndpointType {\n  Custom = 'custom',\n  Infura = 'infura',\n}\n\n/**\n * An Infura RPC endpoint is a reference to a specific network that Infura\n * supports as well as an Infura account we own that we allow users to make use\n * of for free. We need to disambiguate these endpoints from custom RPC\n * endpoints, because while the types for these kinds of object both have the\n * same interface, the URL for an Infura endpoint contains the Infura project\n * ID, and we don't want this to be present in state. We therefore hide it by\n * representing it in the URL as `{infuraProjectId}`, which we replace this when\n * create network clients. But we need to know somehow that we only need to do\n * this replacement for Infura endpoints and not custom endpoints â€” hence the\n * separate type.\n */\nexport type InfuraRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: BuiltInNetworkClientId;\n  /**\n   * The type of this endpoint, always \"default\".\n   */\n  type: RpcEndpointType.Infura;\n  /**\n   * The URL of the endpoint. Expected to be a template with the string\n   * `{infuraProjectId}`, which will get replaced with the Infura project ID\n   * when the network client is created.\n   */\n  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;\n};\n\n/**\n * A custom RPC endpoint is a reference to a user-defined server which fronts an\n * EVM chain. It may refer to an Infura network, but only by coincidence.\n */\nexport type CustomRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: CustomNetworkClientId;\n  /**\n   * The type of this endpoint, always \"custom\".\n   */\n  type: RpcEndpointType.Custom;\n  /**\n   * The URL of the endpoint.\n   */\n  url: string;\n};\n\n/**\n * An RPC endpoint is a reference to a server which fronts an EVM chain. There\n * are two varieties of RPC endpoints: Infura and custom.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;\n\n/**\n * From a user perspective, a network configuration holds information about a\n * network that a user can select through the client. A \"network\" in this sense\n * can explicitly refer to an EVM chain that the user explicitly adds or doesn't\n * need to add (because it comes shipped with the client). The properties here\n * therefore directly map to fields that a user sees and can edit for a network\n * within the client.\n *\n * Internally, a network configuration represents a single conceptual EVM chain,\n * which is represented tangibly via multiple RPC endpoints. A \"network\" is then\n * something for which a network client object is created automatically or\n * created on demand when it is added to the client.\n */\nexport type NetworkConfiguration = {\n  /**\n   * A set of URLs that allows the user to view activity that has occurred on\n   * the chain.\n   */\n  blockExplorerUrls: string[];\n  /**\n   * The ID of the chain. Represented in hexadecimal format with a leading \"0x\"\n   * instead of decimal format so that when viewed out of context it can be\n   * unambiguously interpreted.\n   */\n  chainId: Hex;\n  /**\n   * A reference to a URL that the client will use by default to allow the user\n   * to view activity that has occurred on the chain. This index must refer to\n   * an item in `blockExplorerUrls`.\n   */\n  defaultBlockExplorerUrlIndex?: number;\n  /**\n   * A reference to an RPC endpoint that all requests will use by default in order to\n   * interact with the chain. This index must refer to an item in\n   * `rpcEndpoints`.\n   */\n  defaultRpcEndpointIndex: number;\n  /**\n   * The user-facing nickname assigned to the chain.\n   */\n  name: string;\n  /**\n   * The name of the currency to use for the chain.\n   */\n  nativeCurrency: string;\n  /**\n   * The collection of possible RPC endpoints that the client can use to\n   * interact with the chain.\n   */\n  rpcEndpoints: RpcEndpoint[];\n  /**\n   * Profile Sync - Network Sync field.\n   * Allows comparison of local network state with state to sync.\n   */\n  lastUpdatedAt?: number;\n};\n\n/**\n * A custom RPC endpoint in a new network configuration, meant to be used in\n * conjunction with `AddNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type AddNetworkCustomRpcEndpointFields = Omit<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * A new network configuration that `addNetwork` takes.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and are not represented by\n * network clients yet.\n */\nexport type AddNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * A custom RPC endpoint in an updated representation of a network\n * configuration, meant to be used in conjunction with `UpdateNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type UpdateNetworkCustomRpcEndpointFields = Partialize<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * An updated representation of an existing network configuration that\n * `updateNetwork` takes.\n *\n * Custom RPC endpoints may or may not have a `networkClientId` property; if\n * they do, then it is assumed that they already exist, and if not, then it is\n * assumed that they are new and are not represented by network clients yet.\n */\nexport type UpdateNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * `Object.keys()` is intentionally generic: it returns the keys of an object,\n * but it cannot make guarantees about the contents of that object, so the type\n * of the keys is merely `string[]`. While this is technically accurate, it is\n * also unnecessary if we have an object that we own and whose contents are\n * known exactly.\n *\n * TODO: Move to @metamask/utils.\n *\n * @param object - The object.\n * @returns The keys of an object, typed according to the type of the object\n * itself.\n */\nexport function knownKeysOf<Key extends PropertyKey>(\n  // TODO: Replace `any` with type\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  object: Partial<Record<Key, any>>,\n): Key[] {\n  return Object.keys(object) as Key[];\n}\n\n/**\n * Type guard for determining whether the given value is an error object with a\n * `code` property, such as an instance of Error.\n *\n * TODO: Move this to @metamask/utils.\n *\n * @param error - The object to check.\n * @returns True if `error` has a `code`, false otherwise.\n */\nfunction isErrorWithCode(error: unknown): error is { code: string | number } {\n  return typeof error === 'object' && error !== null && 'code' in error;\n}\n\n/**\n * The string that uniquely identifies an Infura network client.\n */\nexport type BuiltInNetworkClientId = InfuraNetworkType;\n\n/**\n * The string that uniquely identifies a custom network client.\n */\nexport type CustomNetworkClientId = string;\n\n/**\n * The string that uniquely identifies a network client.\n */\nexport type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;\n\n/**\n * Extra information about each network, such as whether it is accessible or\n * blocked and whether it supports EIP-1559, keyed by network client ID.\n */\nexport type NetworksMetadata = Record<NetworkClientId, NetworkMetadata>;\n\n/**\n * The state that NetworkController stores.\n */\nexport type NetworkState = {\n  /**\n   * The ID of the network client that the proxies returned by\n   * `getSelectedNetworkClient` currently point to.\n   */\n  selectedNetworkClientId: NetworkClientId;\n  /**\n   * The registry of networks and corresponding RPC endpoints that the\n   * controller can use to make requests for various chains.\n   *\n   * @see {@link NetworkConfiguration}\n   */\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>;\n  /**\n   * Extra information about each network, such as whether it is accessible or\n   * blocked and whether it supports EIP-1559, keyed by network client ID.\n   */\n  networksMetadata: NetworksMetadata;\n};\n\nconst controllerName = 'NetworkController';\n\n/**\n * Represents the block tracker for the currently selected network. (Note that\n * this is a proxy around a proxy: the inner one exists so that the block\n * tracker doesn't have to exist until it's used, and the outer one exists so\n * that the currently selected network can change without consumers needing to\n * refresh the object reference to that network.)\n */\nexport type BlockTrackerProxy = SwappableProxy<\n  ProxyWithAccessibleTarget<BlockTracker>\n>;\n\n/**\n * Represents the provider for the currently selected network. (Note that this\n * is a proxy around a proxy: the inner one exists so that the provider doesn't\n * have to exist until it's used, and the outer one exists so that the currently\n * selected network can change without consumers needing to refresh the object\n * reference to that network.)\n */\nexport type ProviderProxy = SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n\nexport type NetworkControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof controllerName,\n  NetworkState\n>;\n\n/**\n * `networkWillChange` is published when the current network is about to be\n * switched, but the new provider has not been created and no state changes have\n * occurred yet.\n */\nexport type NetworkControllerNetworkWillChangeEvent = {\n  type: 'NetworkController:networkWillChange';\n  payload: [NetworkState];\n};\n\n/**\n * `networkDidChange` is published after a provider has been created for a newly\n * switched network (but before the network has been confirmed to be available).\n */\nexport type NetworkControllerNetworkDidChangeEvent = {\n  type: 'NetworkController:networkDidChange';\n  payload: [NetworkState];\n};\n\n/**\n * `infuraIsBlocked` is published after the network is switched to an Infura\n * network, but when Infura returns an error blocking the user based on their\n * location.\n */\nexport type NetworkControllerInfuraIsBlockedEvent = {\n  type: 'NetworkController:infuraIsBlocked';\n  payload: [];\n};\n\n/**\n * `infuraIsBlocked` is published either after the network is switched to an\n * Infura network and Infura does not return an error blocking the user based on\n * their location, or the network is switched to a non-Infura network.\n */\nexport type NetworkControllerInfuraIsUnblockedEvent = {\n  type: 'NetworkController:infuraIsUnblocked';\n  payload: [];\n};\n\n/**\n * `networkAdded` is published after a network configuration is added to the\n * network configuration registry and network clients are created for it.\n */\nexport type NetworkControllerNetworkAddedEvent = {\n  type: 'NetworkController:networkAdded';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `networkRemoved` is published after a network configuration is removed from the\n * network configuration registry and once the network clients have been removed.\n */\nexport type NetworkControllerNetworkRemovedEvent = {\n  type: 'NetworkController:networkRemoved';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `NetworkController:rpcEndpointChainUnavailable` is published when, after\n * trying all endpoints in an endpoint chain, the last failover reaches a\n * maximum number of consecutive 5xx responses, breaking the underlying circuit.\n *\n * In other words, this event will not be published if a failover is available,\n * even if the primary is not.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the last failover in the\n * endpoint chain.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointChainUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointUnavailable` is published when any\n * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx\n * responses, breaking the underlying circuit.\n *\n * In other words, this event will be published if a primary is not available,\n * even if a failover is.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint which reached the\n * maximum number of consecutive 5xx responses. You can compare this to\n * `primaryEndpointUrl` to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainDegraded` is published for any of the\n * endpoints in an endpoint chain when one of the following two conditions hold\n * (and the chain is not already in a degraded state):\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainDegradedEvent = {\n  type: 'NetworkController:rpcEndpointChainDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n *\n * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints\n * in an endpoint chain when:\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint for which requests\n * failed or were slow to complete. You can compare this to `primaryEndpointUrl`\n * to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointDegradedEvent = {\n  type: 'NetworkController:rpcEndpointDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainAvailable` is published in one of two\n * cases:\n *\n * 1. The first time that a 2xx request is made to any of the endpoints in an\n * endpoint chain.\n * 2. When requests to any of the endpoints previously failed (placing the\n * endpoint in a degraded or unavailable status), but are now succeeding again.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainAvailableEvent = {\n  type: 'NetworkController:rpcEndpointChainAvailable';\n  payload: [\n    {\n      chainId: Hex;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointRetried` is published before a request to any\n * endpoint in an endpoint chain is retried.\n *\n * This is mainly useful for tests.\n *\n * @param payload - The event payload.\n * @param payload.attempt - The current attempt counter for the endpoint\n * (starting from 0).\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint being retried.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n * @see {@link RpcService} for the list of retriable errors.\n */\nexport type NetworkControllerRpcEndpointRetriedEvent = {\n  type: 'NetworkController:rpcEndpointRetried';\n  payload: [\n    {\n      attempt: number;\n      chainId: Hex;\n      endpointUrl: string;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\nexport type NetworkControllerEvents =\n  | NetworkControllerStateChangeEvent\n  | NetworkControllerNetworkWillChangeEvent\n  | NetworkControllerNetworkDidChangeEvent\n  | NetworkControllerInfuraIsBlockedEvent\n  | NetworkControllerInfuraIsUnblockedEvent\n  | NetworkControllerNetworkAddedEvent\n  | NetworkControllerNetworkRemovedEvent\n  | NetworkControllerRpcEndpointChainUnavailableEvent\n  | NetworkControllerRpcEndpointUnavailableEvent\n  | NetworkControllerRpcEndpointChainDegradedEvent\n  | NetworkControllerRpcEndpointDegradedEvent\n  | NetworkControllerRpcEndpointChainAvailableEvent\n  | NetworkControllerRpcEndpointRetriedEvent;\n\n/**\n * All events that {@link NetworkController} calls internally.\n */\ntype AllowedEvents = never;\n\nexport type NetworkControllerGetStateAction = ControllerGetStateAction<\n  typeof controllerName,\n  NetworkState\n>;\n\nexport type NetworkControllerGetEthQueryAction = {\n  type: `NetworkController:getEthQuery`;\n  handler: () => EthQuery | undefined;\n};\n\nexport type NetworkControllerGetNetworkClientByIdAction = {\n  type: `NetworkController:getNetworkClientById`;\n  handler: NetworkController['getNetworkClientById'];\n};\n\nexport type NetworkControllerGetSelectedNetworkClientAction = {\n  type: `NetworkController:getSelectedNetworkClient`;\n  handler: NetworkController['getSelectedNetworkClient'];\n};\n\nexport type NetworkControllerGetSelectedChainIdAction = {\n  type: 'NetworkController:getSelectedChainId';\n  handler: NetworkController['getSelectedChainId'];\n};\n\nexport type NetworkControllerGetEIP1559CompatibilityAction = {\n  type: `NetworkController:getEIP1559Compatibility`;\n  handler: NetworkController['getEIP1559Compatibility'];\n};\n\nexport type NetworkControllerFindNetworkClientIdByChainIdAction = {\n  type: `NetworkController:findNetworkClientIdByChainId`;\n  handler: NetworkController['findNetworkClientIdByChainId'];\n};\n\n/**\n * Change the currently selected network to the given built-in network type.\n *\n * @deprecated This action has been replaced by `setActiveNetwork`, and will be\n * removed in a future release.\n */\nexport type NetworkControllerSetProviderTypeAction = {\n  type: `NetworkController:setProviderType`;\n  handler: NetworkController['setProviderType'];\n};\n\nexport type NetworkControllerSetActiveNetworkAction = {\n  type: `NetworkController:setActiveNetwork`;\n  handler: NetworkController['setActiveNetwork'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByChainId = {\n  type: `NetworkController:getNetworkConfigurationByChainId`;\n  handler: NetworkController['getNetworkConfigurationByChainId'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByNetworkClientId = {\n  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;\n  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];\n};\n\nexport type NetworkControllerAddNetworkAction = {\n  type: 'NetworkController:addNetwork';\n  handler: NetworkController['addNetwork'];\n};\n\nexport type NetworkControllerRemoveNetworkAction = {\n  type: 'NetworkController:removeNetwork';\n  handler: NetworkController['removeNetwork'];\n};\n\nexport type NetworkControllerUpdateNetworkAction = {\n  type: 'NetworkController:updateNetwork';\n  handler: NetworkController['updateNetwork'];\n};\n\nexport type NetworkControllerActions =\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetEthQueryAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | NetworkControllerGetSelectedNetworkClientAction\n  | NetworkControllerGetSelectedChainIdAction\n  | NetworkControllerGetEIP1559CompatibilityAction\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerSetActiveNetworkAction\n  | NetworkControllerSetProviderTypeAction\n  | NetworkControllerGetNetworkConfigurationByChainId\n  | NetworkControllerGetNetworkConfigurationByNetworkClientId\n  | NetworkControllerAddNetworkAction\n  | NetworkControllerRemoveNetworkAction\n  | NetworkControllerUpdateNetworkAction;\n\n/**\n * All actions that {@link NetworkController} calls internally.\n */\ntype AllowedActions = never;\n\nexport type NetworkControllerMessenger = Messenger<\n  typeof controllerName,\n  NetworkControllerActions | AllowedActions,\n  NetworkControllerEvents | AllowedEvents\n>;\n\n/**\n * Options for the NetworkController constructor.\n */\nexport type NetworkControllerOptions = {\n  /**\n   * The messenger suited for this controller.\n   */\n  messenger: NetworkControllerMessenger;\n  /**\n   * The API key for Infura, used to make requests to Infura.\n   */\n  infuraProjectId: string;\n  /**\n   * The desired state with which to initialize this controller.\n   * Missing properties will be filled in with defaults. For instance, if not\n   * specified, `networkConfigurationsByChainId` will default to a basic set of\n   * network configurations (see {@link InfuraNetworkType} for the list).\n   */\n  state?: Partial<NetworkState>;\n  /**\n   * A `loglevel` logger object.\n   */\n  log?: Logger;\n  /**\n   * A function that can be used to customize a RPC service constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object with type {@link RpcServiceOptions}, minus `failoverService`\n   * and `endpointUrl` (as they are filled in automatically).\n   */\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  /**\n   * A function that can be used to customize a block tracker constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as\n   * it is filled in automatically).\n   */\n  getBlockTrackerOptions?: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  /**\n   * An array of Hex Chain IDs representing the additional networks to be included as default.\n   */\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[];\n  /**\n   * Whether or not requests sent to unavailable RPC endpoints should be\n   * automatically diverted to configured failover RPC endpoints.\n   */\n  isRpcFailoverEnabled?: boolean;\n};\n\n/**\n * Constructs a value for the state property `networkConfigurationsByChainId`\n * which will be used if it has not been provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default value for `networkConfigurationsByChainId`.\n */\nfunction getDefaultNetworkConfigurationsByChainId(\n  additionalDefaultNetworks: AdditionalDefaultNetwork[] = [],\n): Record<Hex, NetworkConfiguration> {\n  const infuraNetworks = getDefaultInfuraNetworkConfigurationsByChainId();\n  const customNetworks = getDefaultCustomNetworkConfigurationsByChainId();\n\n  return additionalDefaultNetworks.reduce<Record<Hex, NetworkConfiguration>>(\n    (obj, chainId) => {\n      if (hasProperty(customNetworks, chainId)) {\n        obj[chainId] = customNetworks[chainId];\n      }\n      return obj;\n    },\n    // Always include the infura networks in the default networks\n    infuraNetworks,\n  );\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all Infura networks.\n */\nfunction getDefaultInfuraNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  return Object.values(InfuraNetworkType).reduce<\n    Record<Hex, NetworkConfiguration>\n  >((obj, infuraNetworkType) => {\n    const chainId = ChainId[infuraNetworkType];\n\n    // Skip deprecated network as default network.\n    if (DEPRECATED_NETWORKS.has(chainId)) {\n      return obj;\n    }\n\n    const rpcEndpointUrl =\n      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;\n\n    const networkConfiguration: NetworkConfiguration = {\n      blockExplorerUrls: [],\n      chainId,\n      defaultRpcEndpointIndex: 0,\n      name: NetworkNickname[infuraNetworkType],\n      nativeCurrency: NetworksTicker[infuraNetworkType],\n      rpcEndpoints: [\n        {\n          failoverUrls: [],\n          networkClientId: infuraNetworkType,\n          type: RpcEndpointType.Infura,\n          url: rpcEndpointUrl,\n        },\n      ],\n    };\n\n    return { ...obj, [chainId]: networkConfiguration };\n  }, {});\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default custom networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all custom networks.\n */\nfunction getDefaultCustomNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  // Create the `networkConfigurationsByChainId` objects explicitly,\n  // Because it is not always guaranteed that the custom networks are included in the\n  // default networks.\n  return {\n    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet'],\n    ),\n    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet-v2'],\n    ),\n    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['monad-testnet'],\n    ),\n  };\n}\n\n/**\n * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.\n *\n * @param customNetworkType - The type of the custom network.\n * @returns The `NetworkConfiguration` object.\n */\nfunction getCustomNetworkConfiguration(\n  customNetworkType: CustomNetworkType,\n): NetworkConfiguration {\n  const { ticker, rpcPrefs } = BUILT_IN_NETWORKS[customNetworkType];\n  const rpcEndpointUrl = BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];\n\n  return {\n    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],\n    chainId: ChainId[customNetworkType],\n    defaultRpcEndpointIndex: 0,\n    defaultBlockExplorerUrlIndex: 0,\n    name: NetworkNickname[customNetworkType],\n    nativeCurrency: ticker,\n    rpcEndpoints: [\n      {\n        failoverUrls: [],\n        networkClientId: customNetworkType,\n        type: RpcEndpointType.Custom,\n        url: rpcEndpointUrl,\n      },\n    ],\n  };\n}\n\n/**\n * Constructs properties for the NetworkController state whose values will be\n * used if not provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default NetworkController state.\n */\nexport function getDefaultNetworkControllerState(\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[],\n): NetworkState {\n  const networksMetadata = {};\n  const networkConfigurationsByChainId =\n    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);\n\n  return {\n    selectedNetworkClientId: InfuraNetworkType.mainnet,\n    networksMetadata,\n    networkConfigurationsByChainId,\n  };\n}\n\n/**\n * Redux selector for getting all network configurations from NetworkController\n * state, keyed by chain ID.\n *\n * @param state - NetworkController state\n * @returns All registered network configurations, keyed by chain ID.\n */\nconst selectNetworkConfigurationsByChainId = (\n  state: NetworkState,\n): Record<`0x${string}`, NetworkConfiguration> =>\n  state.networkConfigurationsByChainId;\n\n/**\n * Get a list of all network configurations.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport function getNetworkConfigurations(\n  state: NetworkState,\n): NetworkConfiguration[] {\n  return Object.values(state.networkConfigurationsByChainId);\n}\n\n/**\n * Redux selector for getting a list of all network configurations from\n * NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport const selectNetworkConfigurations = createSelector(\n  selectNetworkConfigurationsByChainId,\n  (networkConfigurationsByChainId) =>\n    Object.values(networkConfigurationsByChainId),\n);\n\n/**\n * Get a list of all available network client IDs from a list of network\n * configurations.\n *\n * @param networkConfigurations - The array of network configurations\n * @returns A list of all available client IDs\n */\nexport function getAvailableNetworkClientIds(\n  networkConfigurations: NetworkConfiguration[],\n): string[] {\n  return networkConfigurations.flatMap((networkConfiguration) =>\n    networkConfiguration.rpcEndpoints.map(\n      (rpcEndpoint) => rpcEndpoint.networkClientId,\n    ),\n  );\n}\n\n/**\n * Redux selector for getting a list of all available network client IDs\n * from NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network client IDs.\n */\nexport const selectAvailableNetworkClientIds = createSelector(\n  selectNetworkConfigurations,\n  getAvailableNetworkClientIds,\n);\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedBuiltInNetworkClientRegistry = Record<\n  BuiltInNetworkClientId,\n  AutoManagedNetworkClient<InfuraNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedCustomNetworkClientRegistry = Record<\n  CustomNetworkClientId,\n  AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks\n * as well as custom networks that users have added.\n */\nexport type AutoManagedNetworkClientRegistry = {\n  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;\n  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to create a network client for an\n * RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype AddNetworkClientOperation = {\n  type: 'add';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `updateNetwork` and `removeNetwork` to remove a network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype RemoveNetworkClientOperation = {\n  type: 'remove';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to replace the network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype ReplaceNetworkClientOperation = {\n  type: 'replace';\n  oldRpcEndpoint: RpcEndpoint;\n  newRpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC\n * endpoint, as far as the network client registry is concerned.\n *\n * @see {@link NetworkClientOperation}\n */\ntype NoopNetworkClientOperation = {\n  type: 'noop';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to\n * update the network client registry.\n *\n * - When `addNetwork` is called, represents a network client that should be\n * created for a new RPC endpoint.\n * - When `removeNetwork` is called, represents a network client that should be\n * destroyed for a previously existing RPC endpoint.\n * - When `updateNetwork` is called, represents either:\n *   - a network client that should be added for a new RPC endpoint\n *   - a network client that should be removed for a previously existing RPC\n *   endpoint\n *   - a network client that should be replaced for an RPC endpoint that was\n *   changed in a non-major way, or\n *   - a network client that should be unchanged for an RPC endpoint that was\n *   also unchanged.\n */\ntype NetworkClientOperation =\n  | AddNetworkClientOperation\n  | RemoveNetworkClientOperation\n  | ReplaceNetworkClientOperation\n  | NoopNetworkClientOperation;\n\n/**\n * Determines whether the given URL is valid by attempting to parse it.\n *\n * @param url - The URL to test.\n * @returns True if the URL is valid, false otherwise.\n */\nfunction isValidUrl(url: string): boolean {\n  const uri = URI.parse(url);\n  return (\n    uri.error === undefined && (uri.scheme === 'http' || uri.scheme === 'https')\n  );\n}\n\n/**\n * Given an Infura API URL, extracts the subdomain that identifies the Infura\n * network.\n *\n * @param rpcEndpointUrl - The URL to operate on.\n * @returns The Infura network name that the URL references.\n * @throws if the URL is not an Infura API URL, or if an Infura network is not\n * present in the URL.\n */\nfunction deriveInfuraNetworkNameFromRpcEndpointUrl(\n  rpcEndpointUrl: string,\n): InfuraNetworkType {\n  const match = INFURA_URL_REGEX.exec(rpcEndpointUrl);\n\n  if (match?.groups) {\n    if (isInfuraNetworkType(match.groups.networkName)) {\n      return match.groups.networkName;\n    }\n\n    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);\n  }\n\n  throw new Error('Could not derive Infura network from RPC endpoint URL');\n}\n\n/**\n * Performs a series of checks that the given NetworkController state is\n * internally consistent â€” that all parts of state that are supposed to match in\n * fact do â€” so that working with the state later on doesn't cause unexpected\n * errors.\n *\n * In the case of NetworkController, there are several parts of state that need\n * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry\n * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC\n * endpoint within a network configuration.\n *\n * @param state - The NetworkController state to verify.\n * @throws if the state is invalid in some way.\n */\nfunction validateInitialState(state: NetworkState): void {\n  const networkConfigurationEntries = Object.entries(\n    state.networkConfigurationsByChainId,\n  );\n  const networkClientIds = getAvailableNetworkClientIds(\n    getNetworkConfigurations(state),\n  );\n\n  if (networkConfigurationEntries.length === 0) {\n    throw new Error(\n      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',\n    );\n  }\n\n  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {\n    if (chainId !== networkConfiguration.chainId) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \\`chainId\\` of '${networkConfiguration.chainId}'`,\n      );\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkConfiguration.blockExplorerUrls.length > 0\n        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||\n          networkConfiguration.blockExplorerUrls[\n            networkConfiguration.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultBlockExplorerUrlIndex\\` that does not refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ] === undefined\n    ) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultRpcEndpointIndex\\` that does not refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n    throw new Error(\n      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',\n    );\n  }\n}\n\n/**\n * Checks that the given initial NetworkController state is internally\n * consistent similar to `validateInitialState`, but if an anomaly is detected,\n * it does its best to correct the state and logs an error to Sentry.\n *\n * @param state - The NetworkController state to verify.\n * @param messenger - The NetworkController messenger.\n * @returns The corrected state.\n */\nfunction correctInitialState(\n  state: NetworkState,\n  messenger: NetworkControllerMessenger,\n): NetworkState {\n  const networkConfigurationsSortedByChainId = getNetworkConfigurations(\n    state,\n  ).sort((a, b) => a.chainId.localeCompare(b.chainId));\n  const availableNetworkClientIds = getAvailableNetworkClientIds(\n    networkConfigurationsSortedByChainId,\n  );\n  const invalidNetworkClientIdsWithMetadata = Object.keys(\n    state.networksMetadata,\n  ).filter(\n    (networkClientId) => !availableNetworkClientIds.includes(networkClientId),\n  );\n\n  return produce(state, (newState) => {\n    if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {\n      const firstNetworkConfiguration = networkConfigurationsSortedByChainId[0];\n      const newSelectedNetworkClientId =\n        firstNetworkConfiguration.rpcEndpoints[\n          firstNetworkConfiguration.defaultRpcEndpointIndex\n        ].networkClientId;\n      messenger.captureException?.(\n        new Error(\n          `\\`selectedNetworkClientId\\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,\n        ),\n      );\n      newState.selectedNetworkClientId = newSelectedNetworkClientId;\n    }\n\n    if (invalidNetworkClientIdsWithMetadata.length > 0) {\n      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {\n        delete newState.networksMetadata[invalidNetworkClientId];\n      }\n      messenger.captureException?.(\n        new Error(\n          '`networksMetadata` had invalid network client IDs, which have been removed',\n        ),\n      );\n    }\n  });\n}\n\n/**\n * Transforms a map of chain ID to network configuration to a map of network\n * client ID to network configuration.\n *\n * @param networkConfigurationsByChainId - The network configurations, keyed by\n * chain ID.\n * @returns The network configurations, keyed by network client ID.\n */\nfunction buildNetworkConfigurationsByNetworkClientId(\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>,\n): Map<NetworkClientId, NetworkConfiguration> {\n  return new Map(\n    Object.values(networkConfigurationsByChainId).flatMap(\n      (networkConfiguration) => {\n        return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n          return [rpcEndpoint.networkClientId, networkConfiguration];\n        });\n      },\n    ),\n  );\n}\n\n/**\n * Controller that creates and manages an Ethereum network provider.\n */\nexport class NetworkController extends BaseController<\n  typeof controllerName,\n  NetworkState,\n  NetworkControllerMessenger\n> {\n  #ethQuery?: EthQuery;\n\n  readonly #infuraProjectId: string;\n\n  #previouslySelectedNetworkClientId: string;\n\n  #providerProxy: ProviderProxy | undefined;\n\n  #blockTrackerProxy: BlockTrackerProxy | undefined;\n\n  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;\n\n  #autoManagedNetworkClient?:\n    | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n    | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  readonly #log: Logger | undefined;\n\n  readonly #getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];\n\n  readonly #getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];\n\n  #networkConfigurationsByNetworkClientId: Map<\n    NetworkClientId,\n    NetworkConfiguration\n  >;\n\n  #isRpcFailoverEnabled: Exclude<\n    NetworkControllerOptions['isRpcFailoverEnabled'],\n    undefined\n  >;\n\n  /**\n   * Constructs a NetworkController.\n   *\n   * @param options - The options; see {@link NetworkControllerOptions}.\n   */\n  constructor(options: NetworkControllerOptions) {\n    const {\n      messenger,\n      state,\n      infuraProjectId,\n      log,\n      getRpcServiceOptions,\n      getBlockTrackerOptions,\n      additionalDefaultNetworks,\n      isRpcFailoverEnabled = false,\n    } = options;\n    const initialState = {\n      ...getDefaultNetworkControllerState(additionalDefaultNetworks),\n      ...state,\n    };\n    validateInitialState(initialState);\n    const correctedInitialState = correctInitialState(initialState, messenger);\n\n    if (!infuraProjectId || typeof infuraProjectId !== 'string') {\n      throw new Error('Invalid Infura project ID');\n    }\n\n    super({\n      name: controllerName,\n      metadata: {\n        selectedNetworkClientId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networksMetadata: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networkConfigurationsByChainId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n      },\n      messenger,\n      state: correctedInitialState,\n    });\n\n    this.#infuraProjectId = infuraProjectId;\n    this.#log = log;\n    this.#getRpcServiceOptions = getRpcServiceOptions;\n    this.#getBlockTrackerOptions = getBlockTrackerOptions;\n    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;\n\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        this.state.networkConfigurationsByChainId,\n      );\n\n    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, () => {\n      return this.#ethQuery;\n    });\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkClientById`,\n      this.getNetworkClientById.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getEIP1559Compatibility`,\n      this.getEIP1559Compatibility.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setActiveNetwork`,\n      this.setActiveNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setProviderType`,\n      this.setProviderType.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:findNetworkClientIdByChainId`,\n      this.findNetworkClientIdByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByChainId`,\n      this.getNetworkConfigurationByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByNetworkClientId`,\n      this.getNetworkConfigurationByNetworkClientId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedNetworkClient`,\n      this.getSelectedNetworkClient.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedChainId`,\n      this.getSelectedChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:addNetwork`,\n      this.addNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:removeNetwork`,\n      this.removeNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:updateNetwork`,\n      this.updateNetwork.bind(this),\n    );\n\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainUnavailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Unavailable,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainDegraded`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Degraded,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainAvailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Available,\n        });\n      },\n    );\n  }\n\n  /**\n   * Enables the RPC failover functionality. That is, if any RPC endpoints are\n   * configured with failover URLs, then traffic will automatically be diverted\n   * to them if those RPC endpoints are unavailable.\n   */\n  enableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(true);\n  }\n\n  /**\n   * Disables the RPC failover functionality. That is, even if any RPC endpoints\n   * are configured with failover URLs, then traffic will not automatically be\n   * diverted to them if those RPC endpoints are unavailable.\n   */\n  disableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(false);\n  }\n\n  /**\n   * Enables or disables the RPC failover functionality, depending on the\n   * boolean given. This is done by reconstructing all network clients that were\n   * originally configured with failover URLs so that those URLs are either\n   * honored or ignored. Network client IDs will be preserved so as not to\n   * invalidate state in other controllers.\n   *\n   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the\n   * RPC failover functionality.\n   */\n  #updateRpcFailoverEnabled(newIsRpcFailoverEnabled: boolean): void {\n    if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {\n      return;\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    for (const networkClientsById of Object.values(\n      autoManagedNetworkClientRegistry,\n    )) {\n      for (const networkClientId of Object.keys(networkClientsById)) {\n        // Type assertion: We can assume that `networkClientId` is valid here.\n        const networkClient =\n          networkClientsById[\n            networkClientId as keyof typeof networkClientsById\n          ];\n        if (\n          networkClient.configuration.failoverRpcUrls &&\n          networkClient.configuration.failoverRpcUrls.length > 0\n        ) {\n          newIsRpcFailoverEnabled\n            ? networkClient.enableRpcFailover()\n            : networkClient.disableRpcFailover();\n        }\n      }\n    }\n\n    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns The proxy and block tracker proxies.\n   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.\n   */\n  getProviderAndBlockTracker(): {\n    provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>> | undefined;\n    blockTracker:\n      | SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>\n      | undefined;\n  } {\n    return {\n      provider: this.#providerProxy,\n      blockTracker: this.#blockTrackerProxy,\n    };\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns an object with the provider and block tracker proxies for the currently selected network.\n   */\n  getSelectedNetworkClient():\n    | {\n        provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n        blockTracker: SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>;\n      }\n    | undefined {\n    if (this.#providerProxy && this.#blockTrackerProxy) {\n      return {\n        provider: this.#providerProxy,\n        blockTracker: this.#blockTrackerProxy,\n      };\n    }\n    return undefined;\n  }\n\n  /**\n   * Accesses the chain ID from the selected network client.\n   *\n   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.\n   */\n  getSelectedChainId(): Hex | undefined {\n    const networkConfiguration = this.getNetworkConfigurationByNetworkClientId(\n      this.state.selectedNetworkClientId,\n    );\n    return networkConfiguration?.chainId;\n  }\n\n  /**\n   * Internally, the Infura and custom network clients are categorized by type\n   * so that when accessing either kind of network client, TypeScript knows\n   * which type to assign to the network client. For some cases it's more useful\n   * to be able to access network clients by ID instead of by type and then ID,\n   * so this function makes that possible.\n   *\n   * @returns The network clients registered so far, keyed by ID.\n   */\n  getNetworkClientRegistry(): AutoManagedBuiltInNetworkClientRegistry &\n    AutoManagedCustomNetworkClientRegistry {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    return Object.assign(\n      {},\n      autoManagedNetworkClientRegistry[NetworkClientType.Infura],\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom],\n    );\n  }\n\n  /**\n   * Returns the Infura network client with the given ID.\n   *\n   * @param infuraNetworkClientId - An Infura network client ID.\n   * @returns The Infura network client.\n   * @throws If an Infura network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    infuraNetworkClientId: BuiltInNetworkClientId,\n  ): AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  /**\n   * Returns the custom network client with the given ID.\n   *\n   * @param customNetworkClientId - A custom network client ID.\n   * @returns The custom network client.\n   * @throws If a custom network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    customNetworkClientId: CustomNetworkClientId,\n  ): AutoManagedNetworkClient<CustomNetworkClientConfiguration>;\n\n  getNetworkClientById(\n    networkClientId: NetworkClientId,\n  ): AutoManagedNetworkClient<NetworkClientConfiguration> {\n    if (!networkClientId) {\n      throw new Error('No network client ID was provided.');\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const infuraNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!infuraNetworkClient) {\n        throw new Error(\n          `No Infura network client was found with the ID \"${networkClientId}\".`,\n        );\n      }\n      return infuraNetworkClient;\n    }\n\n    const customNetworkClient =\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n        networkClientId\n      ];\n    if (!customNetworkClient) {\n      throw new Error(\n        `No custom network client was found with the ID \"${networkClientId}\".`,\n      );\n    }\n    return customNetworkClient;\n  }\n\n  /**\n   * Executes a series of steps to switch the network:\n   *\n   * 1. Notifies subscribers via the messenger that the network is about to be\n   * switched (and, really, that the global provider and block tracker proxies\n   * will be re-pointed to a new network).\n   * 2. Looks up a known and preinitialized network client matching the given\n   * ID and uses it to re-point the aforementioned provider and block tracker\n   * proxies.\n   * 3. Notifies subscribers via the messenger that the network has switched.\n   * 4. Captures metadata for the newly switched network in state.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   */\n  async #refreshNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.messenger.publish('NetworkController:networkWillChange', this.state);\n    this.#applyNetworkSelection(networkClientId, options);\n    this.messenger.publish('NetworkController:networkDidChange', this.state);\n    await this.lookupNetwork();\n  }\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   */\n  initializeProvider(options: { lookupNetwork: false }): void;\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   * @returns A promise that resolves when the network lookup completes.\n   */\n  initializeProvider(options?: { lookupNetwork?: boolean }): Promise<void>;\n\n  initializeProvider({\n    lookupNetwork = true,\n  }: {\n    lookupNetwork?: boolean;\n  } = {}): Promise<void> | undefined {\n    this.#applyNetworkSelection(this.state.selectedNetworkClientId);\n\n    if (lookupNetwork) {\n      return this.lookupNetwork();\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   * @returns The resulting metadata for the network.\n   */\n  async #determineNetworkMetadata(networkClientId: NetworkClientId): Promise<{\n    isInfura: boolean;\n    networkStatus:\n      | NetworkStatus.Available\n      | NetworkStatus.Unknown\n      | NetworkStatus.Unavailable\n      | NetworkStatus.Blocked;\n    isEIP1559Compatible: undefined | boolean;\n  }> {\n    // Force TypeScript to use one of the two overloads explicitly\n    const networkClient = isInfuraNetworkType(networkClientId)\n      ? this.getNetworkClientById(networkClientId)\n      : this.getNetworkClientById(networkClientId);\n\n    const isInfura =\n      networkClient.configuration.type === NetworkClientType.Infura;\n    let networkStatus: NetworkStatus;\n    let isEIP1559Compatible: boolean | undefined;\n\n    try {\n      isEIP1559Compatible =\n        await this.#determineEIP1559Compatibility(networkClientId);\n      networkStatus = NetworkStatus.Available;\n    } catch (error) {\n      debugLog('NetworkController: lookupNetwork: ', error);\n\n      if (isErrorWithCode(error)) {\n        let responseBody;\n        if (\n          isInfura &&\n          hasProperty(error, 'message') &&\n          typeof error.message === 'string'\n        ) {\n          try {\n            responseBody = JSON.parse(error.message);\n          } catch {\n            // error.message must not be JSON\n            this.#log?.warn(\n              'NetworkController: lookupNetwork: json parse error: ',\n              error,\n            );\n          }\n        }\n\n        if (\n          isPlainObject(responseBody) &&\n          responseBody.error === INFURA_BLOCKED_KEY\n        ) {\n          networkStatus = NetworkStatus.Blocked;\n        } else if (error.code === errorCodes.rpc.internal) {\n          networkStatus = NetworkStatus.Unknown;\n          this.#log?.warn(\n            'NetworkController: lookupNetwork: rpc internal error: ',\n            error,\n          );\n        } else {\n          networkStatus = NetworkStatus.Unavailable;\n          this.#log?.warn('NetworkController: lookupNetwork: ', error);\n        }\n      } else {\n        debugLog(\n          'NetworkController - could not determine network status',\n          error,\n        );\n        networkStatus = NetworkStatus.Unknown;\n        this.#log?.warn('NetworkController: lookupNetwork: ', error);\n      }\n    }\n\n    return { isInfura, networkStatus, isEIP1559Compatible };\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given or selected network, persisting it to state:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   */\n  async lookupNetwork(networkClientId?: NetworkClientId): Promise<void> {\n    if (networkClientId) {\n      await this.#lookupGivenNetwork(networkClientId);\n    } else {\n      await this.#lookupSelectedNetwork();\n    }\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * @deprecated Please use `lookupNetwork` and pass a network client ID\n   * instead. This method will be removed in a future major version.\n   */\n  // We are planning on removing this so we aren't interested in testing this\n  // right now.\n  /* istanbul ignore next */\n  async lookupNetworkByClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<void> {\n    await this.#lookupGivenNetwork(networkClientId);\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   */\n  async #lookupGivenNetwork(networkClientId: NetworkClientId): Promise<void> {\n    const { networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(networkClientId);\n\n    this.#updateMetadataForNetwork(networkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the currently selected network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * Note that it is possible for the current network to be switched while this\n   * method is running. If that is the case, it will exit early (as this method\n   * will also run for the new network).\n   */\n  async #lookupSelectedNetwork(): Promise<void> {\n    if (!this.#ethQuery) {\n      return;\n    }\n\n    let networkChanged = false;\n    const listener = (): void => {\n      networkChanged = true;\n      try {\n        this.messenger.unsubscribe(\n          'NetworkController:networkDidChange',\n          listener,\n        );\n      } catch (error) {\n        // In theory, this `catch` should not be necessary given that this error\n        // would occur \"inside\" of the call to `#determineEIP1559Compatibility`\n        // below and so it should be caught by the `try`/`catch` below (it is\n        // impossible to reproduce in tests for that reason). However, somehow\n        // it occurs within Mobile and so we have to add our own `try`/`catch`\n        // here.\n        /* istanbul ignore next */\n        if (\n          !(error instanceof Error) ||\n          error.message !==\n            'Subscription not found for event: NetworkController:networkDidChange'\n        ) {\n          // Again, this error should not happen and is impossible to reproduce\n          // in tests.\n          /* istanbul ignore next */\n          throw error;\n        }\n      }\n    };\n    this.messenger.subscribe('NetworkController:networkDidChange', listener);\n\n    const { isInfura, networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);\n\n    if (networkChanged) {\n      // If the network has changed, then `lookupNetwork` either has been or is\n      // in the process of being called, so we don't need to go further.\n      return;\n    }\n\n    try {\n      this.messenger.unsubscribe(\n        'NetworkController:networkDidChange',\n        listener,\n      );\n    } catch (error) {\n      if (\n        !(error instanceof Error) ||\n        error.message !==\n          'Subscription not found for event: NetworkController:networkDidChange'\n      ) {\n        throw error;\n      }\n    }\n\n    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n\n    if (isInfura) {\n      if (networkStatus === NetworkStatus.Available) {\n        this.messenger.publish('NetworkController:infuraIsUnblocked');\n      } else if (networkStatus === NetworkStatus.Blocked) {\n        this.messenger.publish('NetworkController:infuraIsBlocked');\n      }\n    } else {\n      // Always publish infuraIsUnblocked regardless of network status to\n      // prevent consumers from being stuck in a blocked state if they were\n      // previously connected to an Infura network that was blocked\n      this.messenger.publish('NetworkController:infuraIsUnblocked');\n    }\n  }\n\n  /**\n   * Updates the metadata for the given network in state.\n   *\n   * @param networkClientId - The associated network client ID.\n   * @param metadata - The metadata to store in state.\n   * @param metadata.networkStatus - The network status to store in state.\n   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to\n   * store in state.\n   */\n  #updateMetadataForNetwork(\n    networkClientId: NetworkClientId,\n    metadata: {\n      networkStatus: NetworkStatus;\n      isEIP1559Compatible?: boolean | undefined;\n    },\n  ): void {\n    this.update((state) => {\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      const newMetadata = state.networksMetadata[networkClientId];\n      newMetadata.status = metadata.networkStatus;\n\n      if ('isEIP1559Compatible' in metadata) {\n        if (metadata.isEIP1559Compatible === undefined) {\n          delete newMetadata.EIPS[1559];\n        } else {\n          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;\n        }\n      }\n    });\n  }\n\n  /**\n   * Convenience method to update provider network type settings.\n   *\n   * @param type - Human readable network name.\n   * @deprecated This has been replaced by `setActiveNetwork`, and will be\n   * removed in a future release\n   */\n  async setProviderType(type: InfuraNetworkType): Promise<void> {\n    if ((type as unknown) === NetworkType.rpc) {\n      throw new Error(\n        `NetworkController - cannot call \"setProviderType\" with type \"${NetworkType.rpc}\". Use \"setActiveNetwork\"`,\n      );\n    }\n    if (!isInfuraNetworkType(type)) {\n      throw new Error(`Unknown Infura provider type \"${String(type)}\".`);\n    }\n\n    await this.setActiveNetwork(type);\n  }\n\n  /**\n   * Changes the selected network.\n   *\n   * @param networkClientId - The ID of a network client that will be used to\n   * make requests.\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client is associated with the given\n   * network client ID.\n   */\n  async setActiveNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n\n    await this.#refreshNetwork(networkClientId, options);\n  }\n\n  /**\n   * Fetches the latest block for the network.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.\n   * @returns A promise that either resolves to the block header or null if\n   * there is no latest block, or rejects with an error.\n   */\n  #getLatestBlock(\n    networkClientId: NetworkClientId = this.state.selectedNetworkClientId,\n  ): Promise<Block> {\n    const networkClient = this.getNetworkClientById(networkClientId);\n    const ethQuery = new EthQuery(networkClient.provider);\n\n    return new Promise((resolve, reject) => {\n      ethQuery.sendAsync(\n        { method: 'eth_getBlockByNumber', params: ['latest', false] },\n        (error: unknown, block?: unknown) => {\n          if (error) {\n            // This error comes from JsonRpcEngine, we don't control it.\n            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n            reject(error);\n          } else {\n            // TODO: Validate this type\n            resolve(block as Block);\n          }\n        },\n      );\n    });\n  }\n\n  /**\n   * Determines whether the network supports EIP-1559 by checking whether the\n   * latest block has a `baseFeePerGas` property, then updates state\n   * appropriately.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.\n   * @returns A promise that resolves to true if the network supports EIP-1559\n   * , false otherwise, or `undefined` if unable to determine the compatibility.\n   */\n  async getEIP1559Compatibility(\n    networkClientId?: NetworkClientId,\n  ): Promise<undefined | boolean> {\n    if (networkClientId) {\n      return this.get1559CompatibilityWithNetworkClientId(networkClientId);\n    }\n    if (!this.#ethQuery) {\n      return false;\n    }\n\n    const { EIPS } =\n      this.state.networksMetadata[this.state.selectedNetworkClientId];\n\n    if (EIPS[1559] !== undefined) {\n      return EIPS[1559];\n    }\n\n    const isEIP1559Compatible = await this.#determineEIP1559Compatibility(\n      this.state.selectedNetworkClientId,\n    );\n    this.update((state) => {\n      if (isEIP1559Compatible !== undefined) {\n        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =\n          isEIP1559Compatible;\n      }\n    });\n    return isEIP1559Compatible;\n  }\n\n  async get1559CompatibilityWithNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean> {\n    let metadata = this.state.networksMetadata[networkClientId];\n    if (metadata?.EIPS[1559] === undefined) {\n      await this.lookupNetwork(networkClientId);\n      metadata = this.state.networksMetadata[networkClientId];\n    }\n    const { EIPS } = metadata;\n\n    // may want to include some 'freshness' value - something to make sure we refetch this from time to time\n    return EIPS[1559];\n  }\n\n  /**\n   * Retrieves and checks the latest block from the currently selected\n   * network; if the block has a `baseFeePerGas` property, then we know\n   * that the network supports EIP-1559; otherwise it doesn't.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility\n   * @returns A promise that resolves to `true` if the network supports EIP-1559,\n   * `false` otherwise, or `undefined` if unable to retrieve the last block.\n   */\n  async #determineEIP1559Compatibility(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean | undefined> {\n    const latestBlock = await this.#getLatestBlock(networkClientId);\n\n    if (!latestBlock) {\n      return undefined;\n    }\n\n    return latestBlock.baseFeePerGas !== undefined;\n  }\n\n  /**\n   * Ensures that the provider and block tracker proxies are pointed to the\n   * currently selected network and refreshes the metadata for the\n   */\n  async resetConnection(): Promise<void> {\n    await this.#refreshNetwork(this.state.selectedNetworkClientId);\n  }\n\n  /**\n   * Returns the network configuration that has been filed under the given chain\n   * ID.\n   *\n   * @param chainId - The chain ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByChainId(\n    chainId: Hex,\n  ): NetworkConfiguration | undefined {\n    return this.state.networkConfigurationsByChainId[chainId];\n  }\n\n  /**\n   * Returns the network configuration that contains an RPC endpoint with the\n   * given network client ID.\n   *\n   * @param networkClientId - The network client ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): NetworkConfiguration | undefined {\n    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);\n  }\n\n  /**\n   * Creates and registers network clients for the collection of Infura and\n   * custom RPC endpoints that can be used to make requests for a particular\n   * chain, storing the given configuration object in state for later reference.\n   *\n   * @param fields - The object that describes the new network/chain and lists\n   * the RPC endpoints which front that chain.\n   * @returns The newly added network configuration.\n   * @throws if any part of `fields` would produce invalid state.\n   * @see {@link NetworkConfiguration}\n   */\n  addNetwork(fields: AddNetworkFields): NetworkConfiguration {\n    const { rpcEndpoints: setOfRpcEndpointFields } = fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'add',\n      networkFields: fields,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations = setOfRpcEndpointFields.map(\n      (defaultOrCustomRpcEndpointFields) => {\n        const rpcEndpoint =\n          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom\n            ? {\n                ...defaultOrCustomRpcEndpointFields,\n                networkClientId: uuidV4(),\n              }\n            : defaultOrCustomRpcEndpointFields;\n        return {\n          type: 'add' as const,\n          rpcEndpoint,\n        };\n      },\n    );\n\n    const newNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'add',\n        networkFields: fields,\n        networkConfigurationToPersist: newNetworkConfiguration,\n      });\n    });\n\n    this.messenger.publish(\n      `${controllerName}:networkAdded`,\n      newNetworkConfiguration,\n    );\n\n    return newNetworkConfiguration;\n  }\n\n  /**\n   * Updates the configuration for a previously stored network filed under the\n   * given chain ID, creating + registering new network clients to represent RPC\n   * endpoints that have been added and destroying + unregistering existing\n   * network clients for RPC endpoints that have been removed.\n   *\n   * Note that if `chainId` is changed, then all network clients associated with\n   * that chain will be removed and re-added, even if none of the RPC endpoints\n   * have changed.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @param fields - The object that describes the updates to the network/chain,\n   * including the new set of RPC endpoints which should front that chain.\n   * @param options - Options to provide.\n   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot\n   * remove an RPC endpoint that is being represented by the currently selected\n   * network client. This option allows you to specify another RPC endpoint\n   * (either an existing one or a new one) that should be used to select a new\n   * network instead.\n   * @returns The updated network configuration.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * if any part of `fields` would produce invalid state, etc.\n   * @see {@link NetworkConfiguration}\n   */\n  async updateNetwork(\n    chainId: Hex,\n    fields: UpdateNetworkFields,\n    {\n      replacementSelectedRpcEndpointIndex,\n    }: { replacementSelectedRpcEndpointIndex?: number } = {},\n  ): Promise<NetworkConfiguration> {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Could not update network: Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    const existingChainId = chainId;\n    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =\n      fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'update',\n      networkFields: fields,\n      existingNetworkConfiguration,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations: NetworkClientOperation[] = [];\n\n    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {\n      const existingRpcEndpointForNoop =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            rpcEndpoint.url === newRpcEndpointFields.url &&\n            (rpcEndpoint.networkClientId ===\n              newRpcEndpointFields.networkClientId ||\n              newRpcEndpointFields.networkClientId === undefined)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            (rpcEndpoint.type === RpcEndpointType.Infura &&\n              newRpcEndpointFields.type === RpcEndpointType.Infura) ||\n            (rpcEndpoint.type === newRpcEndpointFields.type &&\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId &&\n              rpcEndpoint.url === newRpcEndpointFields.url)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainNotChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            (rpcEndpoint.url === newRpcEndpointFields.url ||\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId)\n          );\n        });\n\n      if (\n        newChainId !== existingChainId &&\n        existingRpcEndpointForReplaceWhenChainChanged !== undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,\n          newRpcEndpoint,\n        });\n      } else if (existingRpcEndpointForNoop !== undefined) {\n        let newRpcEndpoint;\n        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {\n          newRpcEndpoint = existingRpcEndpointForNoop;\n        } else {\n          // `networkClientId` shouldn't be missing at this point; if it is,\n          // that's a mistake, so fill it back in\n          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {\n            networkClientId: existingRpcEndpointForNoop.networkClientId,\n          });\n        }\n        networkClientOperations.push({\n          type: 'noop' as const,\n          rpcEndpoint: newRpcEndpoint,\n        });\n      } else if (\n        existingRpcEndpointForReplaceWhenChainNotChanged === undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n        const networkClientOperation = {\n          type: 'add' as const,\n          rpcEndpoint: newRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      } else {\n        let newRpcEndpoint;\n        /* istanbul ignore if */\n        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {\n          // This case can't actually happen. If we're here, it means that some\n          // part of the RPC endpoint changed. But there is no part of an Infura\n          // RPC endpoint that can be changed (as it would immediately make that\n          // RPC endpoint self-inconsistent). This is just here to appease\n          // TypeScript.\n          newRpcEndpoint = newRpcEndpointFields;\n        } else {\n          newRpcEndpoint = {\n            ...newRpcEndpointFields,\n            networkClientId: uuidV4(),\n          };\n        }\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,\n          newRpcEndpoint,\n        });\n      }\n    }\n\n    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n      if (\n        !networkClientOperations.some((networkClientOperation) => {\n          const otherRpcEndpoint =\n            networkClientOperation.type === 'replace'\n              ? networkClientOperation.oldRpcEndpoint\n              : networkClientOperation.rpcEndpoint;\n          return (\n            otherRpcEndpoint.type === existingRpcEndpoint.type &&\n            otherRpcEndpoint.networkClientId ===\n              existingRpcEndpoint.networkClientId &&\n            otherRpcEndpoint.url === existingRpcEndpoint.url\n          );\n        })\n      ) {\n        const networkClientOperation = {\n          type: 'remove' as const,\n          rpcEndpoint: existingRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      }\n    }\n\n    const updatedNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n\n    if (\n      replacementSelectedRpcEndpointIndex === undefined &&\n      networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'remove' &&\n          networkClientOperation.rpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      }) &&\n      !networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      })\n    ) {\n      throw new Error(\n        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \\`replacementSelectedRpcEndpointIndex\\` option.`,\n      );\n    }\n\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const replacementSelectedRpcEndpointWithIndex = networkClientOperations\n      .map(\n        (networkClientOperation, index) =>\n          [networkClientOperation, index] as const,\n      )\n      .find(([networkClientOperation, _index]) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      });\n    const correctedReplacementSelectedRpcEndpointIndex =\n      replacementSelectedRpcEndpointIndex ??\n      replacementSelectedRpcEndpointWithIndex?.[1];\n\n    let rpcEndpointToSelect: RpcEndpoint | undefined;\n    if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {\n      rpcEndpointToSelect =\n        updatedNetworkConfiguration.rpcEndpoints[\n          correctedReplacementSelectedRpcEndpointIndex\n        ];\n\n      if (rpcEndpointToSelect === undefined) {\n        throw new Error(\n          `Could not update network: \\`replacementSelectedRpcEndpointIndex\\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \\`rpcEndpoints\\``,\n        );\n      }\n    }\n\n    if (\n      rpcEndpointToSelect &&\n      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId\n    ) {\n      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {\n        updateState: (state) => {\n          this.#updateNetworkConfigurations({\n            state,\n            mode: 'update',\n            networkFields: fields,\n            networkConfigurationToPersist: updatedNetworkConfiguration,\n            existingNetworkConfiguration,\n          });\n        },\n      });\n    } else {\n      this.update((state) => {\n        this.#updateNetworkConfigurations({\n          state,\n          mode: 'update',\n          networkFields: fields,\n          networkConfigurationToPersist: updatedNetworkConfiguration,\n          existingNetworkConfiguration,\n        });\n      });\n    }\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    return updatedNetworkConfiguration;\n  }\n\n  /**\n   * Destroys and unregisters the network identified by the given chain ID, also\n   * removing the associated network configuration from state.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * or if the currently selected network is being removed.\n   * @see {@link NetworkConfiguration}\n   */\n  removeNetwork(chainId: Hex): void {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration.rpcEndpoints.some(\n        (rpcEndpoint) =>\n          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,\n      )\n    ) {\n      throw new Error(`Cannot remove the currently selected network`);\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    const networkClientOperations =\n      existingNetworkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        return {\n          type: 'remove' as const,\n          rpcEndpoint,\n        };\n      });\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'remove',\n        existingNetworkConfiguration,\n      });\n\n      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n        delete state.networksMetadata[rpcEndpoint.networkClientId];\n      }\n    });\n\n    this.messenger.publish(\n      'NetworkController:networkRemoved',\n      existingNetworkConfiguration,\n    );\n  }\n\n  /**\n   * Assuming that the network has been previously switched, switches to this\n   * new network.\n   *\n   * If the network has not been previously switched, this method is equivalent\n   * to {@link resetConnection}.\n   */\n  async rollbackToPreviousProvider(): Promise<void> {\n    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);\n  }\n\n  /**\n   * Deactivates the controller, stopping any ongoing polling.\n   *\n   * In-progress requests will not be aborted.\n   */\n  // We're intentionally changing the signature of an extended method.\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  async destroy(): Promise<void> {\n    await this.#blockTrackerProxy?.destroy();\n  }\n\n  /**\n   * Merges the given backup data into controller state.\n   *\n   * @param backup - The data that has been backed up.\n   * @param backup.networkConfigurationsByChainId - Network configurations,\n   * keyed by chain ID.\n   */\n  loadBackup({\n    networkConfigurationsByChainId,\n  }: Pick<NetworkState, 'networkConfigurationsByChainId'>): void {\n    this.update((state) => {\n      state.networkConfigurationsByChainId = {\n        ...state.networkConfigurationsByChainId,\n        ...networkConfigurationsByChainId,\n      };\n    });\n  }\n\n  /**\n   * Searches for the default RPC endpoint configured for the given chain and\n   * returns its network client ID. This can then be passed to\n   * {@link getNetworkClientById} to retrieve the network client.\n   *\n   * @param chainId - Chain ID to search for.\n   * @returns The ID of the network client created for the chain's default RPC\n   * endpoint.\n   */\n  findNetworkClientIdByChainId(chainId: Hex): NetworkClientId {\n    const networkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (!networkConfiguration) {\n      throw new Error(`Invalid chain ID \"${chainId}\"`);\n    }\n\n    const { networkClientId } =\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ];\n    return networkClientId;\n  }\n\n  /**\n   * Ensure that the given fields which will be used to either add or update a\n   * network are valid.\n   *\n   * @param args - The arguments.\n   */\n  #validateNetworkFields(\n    args: {\n      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n    } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n        }\n      | {\n          mode: 'update';\n          existingNetworkConfiguration: NetworkConfiguration;\n          networkFields: UpdateNetworkFields;\n        }\n    ),\n  ): void {\n    const { mode, networkFields, autoManagedNetworkClientRegistry } = args;\n    const existingNetworkConfiguration =\n      'existingNetworkConfiguration' in args\n        ? args.existingNetworkConfiguration\n        : null;\n\n    const errorMessagePrefix =\n      mode === 'update' ? 'Could not update network' : 'Could not add network';\n\n    if (\n      !isStrictHexString(networkFields.chainId) ||\n      !isSafeChainId(networkFields.chainId)\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Invalid \\`chainId\\` '${networkFields.chainId}' (must start with \"0x\" and not exceed the maximum)`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration === null ||\n      networkFields.chainId !== existingNetworkConfiguration.chainId\n    ) {\n      const existingNetworkConfigurationViaChainId =\n        this.state.networkConfigurationsByChainId[networkFields.chainId];\n      if (existingNetworkConfigurationViaChainId !== undefined) {\n        if (existingNetworkConfiguration === null) {\n          throw new Error(\n            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        } else {\n          throw new Error(\n            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        }\n      }\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkFields.blockExplorerUrls.length > 0\n        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||\n          networkFields.blockExplorerUrls[\n            networkFields.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkFields.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultBlockExplorerUrlIndex\\` must refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (networkFields.rpcEndpoints.length === 0) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`rpcEndpoints\\` must be a non-empty array`,\n      );\n    }\n    for (const rpcEndpointFields of networkFields.rpcEndpoints) {\n      if (!isValidUrl(rpcEndpointFields.url)) {\n        throw new Error(\n          `${errorMessagePrefix}: An entry in \\`rpcEndpoints\\` has invalid URL '${rpcEndpointFields.url}'`,\n        );\n      }\n      const networkClientId =\n        'networkClientId' in rpcEndpointFields\n          ? rpcEndpointFields.networkClientId\n          : undefined;\n\n      if (\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        networkClientId !== undefined &&\n        isInfuraNetworkType(networkClientId)\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,\n        );\n      }\n\n      if (\n        mode === 'update' &&\n        networkClientId !== undefined &&\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        !Object.values(autoManagedNetworkClientRegistry).some(\n          (networkClientsById) => networkClientId in networkClientsById,\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,\n        );\n      }\n\n      if (\n        networkFields.rpcEndpoints.some(\n          (otherRpcEndpointFields) =>\n            otherRpcEndpointFields !== rpcEndpointFields &&\n            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,\n        );\n      }\n\n      const networkConfigurationsForOtherChains = Object.values(\n        this.state.networkConfigurationsByChainId,\n      ).filter((networkConfiguration) =>\n        existingNetworkConfiguration\n          ? networkConfiguration.chainId !==\n            existingNetworkConfiguration.chainId\n          : true,\n      );\n      for (const networkConfiguration of networkConfigurationsForOtherChains) {\n        const rpcEndpoint = networkConfiguration.rpcEndpoints.find(\n          (existingRpcEndpoint) =>\n            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),\n        );\n        if (rpcEndpoint) {\n          if (mode === 'update') {\n            throw new Error(\n              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          } else {\n            throw new Error(\n              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          }\n        }\n      }\n    }\n\n    if (\n      [...new Set(networkFields.rpcEndpoints)].length <\n      networkFields.rpcEndpoints.length\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,\n      );\n    }\n\n    const networkClientIds = networkFields.rpcEndpoints\n      .map((rpcEndpoint) =>\n        'networkClientId' in rpcEndpoint\n          ? rpcEndpoint.networkClientId\n          : undefined,\n      )\n      .filter(\n        (networkClientId): networkClientId is NetworkClientId =>\n          networkClientId !== undefined,\n      );\n    if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,\n      );\n    }\n\n    const infuraRpcEndpoints = networkFields.rpcEndpoints.filter(\n      (rpcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =>\n        rpcEndpointFields.type === RpcEndpointType.Infura,\n    );\n    if (infuraRpcEndpoints.length > 1) {\n      throw new Error(\n        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,\n      );\n    }\n\n    const soleInfuraRpcEndpoint = infuraRpcEndpoints[0];\n    if (soleInfuraRpcEndpoint) {\n      const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n        soleInfuraRpcEndpoint.url,\n      );\n      const infuraNetworkNickname = NetworkNickname[infuraNetworkName];\n      const infuraChainId = ChainId[infuraNetworkName];\n      if (networkFields.chainId !== infuraChainId) {\n        throw new Error(\n          mode === 'add'\n            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`\n            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,\n        );\n      }\n    }\n\n    if (\n      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===\n      undefined\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultRpcEndpointIndex\\` must refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  /**\n   * Constructs a network configuration that will be persisted to state when\n   * adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Operations which were calculated for\n   * updating the network client registry but which also map back to RPC\n   * endpoints (and so can be used to save those RPC endpoints).\n   * @returns The network configuration to persist.\n   */\n  #determineNetworkConfigurationToPersist({\n    networkFields,\n    networkClientOperations,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n  }): NetworkConfiguration {\n    const rpcEndpointsToPersist = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is\n          | AddNetworkClientOperation\n          | NoopNetworkClientOperation => {\n          return (\n            networkClientOperation.type === 'add' ||\n            networkClientOperation.type === 'noop'\n          );\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };\n  }\n\n  /**\n   * Creates and registers network clients using the given operations calculated\n   * as a part of adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Dictate which network clients need to\n   * be created.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #registerNetworkClientsAsNeeded({\n    networkFields,\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const addedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is AddNetworkClientOperation => {\n          return networkClientOperation.type === 'add';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    for (const addedRpcEndpoint of addedRpcEndpoints) {\n      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Infura,\n            chainId: networkFields.chainId,\n            network: addedRpcEndpoint.networkClientId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            infuraProjectId: this.#infuraProjectId,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      } else {\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Custom,\n            chainId: networkFields.chainId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            rpcUrl: addedRpcEndpoint.url,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      }\n    }\n  }\n\n  /**\n   * Destroys and removes network clients using the given operations calculated\n   * as a part of updating or removing a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkClientOperations - Dictate which network clients to\n   * remove.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #unregisterNetworkClientsAsNeeded({\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const removedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is RemoveNetworkClientOperation => {\n          return networkClientOperation.type === 'remove';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.oldRpcEndpoint,\n          ),\n      );\n\n    for (const rpcEndpoint of removedRpcEndpoints) {\n      const networkClient = this.getNetworkClientById(\n        rpcEndpoint.networkClientId,\n      );\n      networkClient.destroy();\n      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][\n        rpcEndpoint.networkClientId\n      ];\n    }\n  }\n\n  /**\n   * Updates `networkConfigurationsByChainId` in state depending on whether a\n   * network is being added, updated, or removed.\n   *\n   * - The existing network configuration will be removed when a network is\n   * being filed under a different chain or removed.\n   * - A network configuration will be stored when a network is being added or\n   * when a network is being updated.\n   *\n   * @param args - The arguments to this function.\n   */\n  #updateNetworkConfigurations(\n    args: { state: Draft<NetworkState> } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n        }\n      | {\n          mode: 'update';\n          networkFields: UpdateNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n      | {\n          mode: 'remove';\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n    ),\n  ): void {\n    const { state, mode } = args;\n\n    if (\n      mode === 'remove' ||\n      (mode === 'update' &&\n        args.networkFields.chainId !==\n          args.existingNetworkConfiguration.chainId)\n    ) {\n      delete state.networkConfigurationsByChainId[\n        args.existingNetworkConfiguration.chainId\n      ];\n    }\n\n    if (mode === 'add' || mode === 'update') {\n      if (\n        !deepEqual(\n          state.networkConfigurationsByChainId[args.networkFields.chainId],\n          args.networkConfigurationToPersist,\n        )\n      ) {\n        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();\n      }\n      state.networkConfigurationsByChainId[args.networkFields.chainId] =\n        args.networkConfigurationToPersist;\n    }\n\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        cloneDeep(state.networkConfigurationsByChainId),\n      );\n  }\n\n  /**\n   * Before accessing or switching the network, the registry of network clients\n   * needs to be populated. Otherwise, `#applyNetworkSelection` and\n   * `getNetworkClientRegistry` will throw an error. This method checks to see if the\n   * population step has happened yet, and if not, makes it happen.\n   *\n   * @returns The populated network client registry.\n   */\n  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {\n    return (this.#autoManagedNetworkClientRegistry ??=\n      this.#createAutoManagedNetworkClientRegistry());\n  }\n\n  /**\n   * Constructs the registry of network clients based on the set of default\n   * and custom networks in state.\n   *\n   * @returns The network clients keyed by ID.\n   */\n  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {\n    const chainIds = knownKeysOf(this.state.networkConfigurationsByChainId);\n    const networkClientsWithIds = chainIds.flatMap((chainId) => {\n      const networkConfiguration =\n        this.state.networkConfigurationsByChainId[chainId];\n      return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        if (rpcEndpoint.type === RpcEndpointType.Infura) {\n          const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n            rpcEndpoint.url,\n          );\n          return [\n            rpcEndpoint.networkClientId,\n            createAutoManagedNetworkClient({\n              networkClientId: rpcEndpoint.networkClientId,\n              networkClientConfiguration: {\n                type: NetworkClientType.Infura,\n                network: infuraNetworkName,\n                failoverRpcUrls: rpcEndpoint.failoverUrls,\n                infuraProjectId: this.#infuraProjectId,\n                chainId: networkConfiguration.chainId,\n                ticker: networkConfiguration.nativeCurrency,\n              },\n              getRpcServiceOptions: this.#getRpcServiceOptions,\n              getBlockTrackerOptions: this.#getBlockTrackerOptions,\n              messenger: this.messenger,\n              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n              logger: this.#log,\n            }),\n          ] as const;\n        }\n        return [\n          rpcEndpoint.networkClientId,\n          createAutoManagedNetworkClient({\n            networkClientId: rpcEndpoint.networkClientId,\n            networkClientConfiguration: {\n              type: NetworkClientType.Custom,\n              chainId: networkConfiguration.chainId,\n              failoverRpcUrls: rpcEndpoint.failoverUrls,\n              rpcUrl: rpcEndpoint.url,\n              ticker: networkConfiguration.nativeCurrency,\n            },\n            getRpcServiceOptions: this.#getRpcServiceOptions,\n            getBlockTrackerOptions: this.#getBlockTrackerOptions,\n            messenger: this.messenger,\n            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n            logger: this.#log,\n          }),\n        ] as const;\n      });\n    });\n\n    return networkClientsWithIds.reduce(\n      (\n        obj: {\n          [NetworkClientType.Custom]: Partial<AutoManagedCustomNetworkClientRegistry>;\n          [NetworkClientType.Infura]: Partial<AutoManagedBuiltInNetworkClientRegistry>;\n        },\n        [networkClientId, networkClient],\n      ) => {\n        return {\n          ...obj,\n          [networkClient.configuration.type]: {\n            ...obj[networkClient.configuration.type],\n            [networkClientId]: networkClient,\n          },\n        };\n      },\n      {\n        [NetworkClientType.Custom]: {},\n        [NetworkClientType.Infura]: {},\n      },\n    ) as AutoManagedNetworkClientRegistry;\n  }\n\n  /**\n   * Updates the global provider and block tracker proxies (accessible via\n   * {@link getSelectedNetworkClient}) to point to the same ones within the\n   * given network client, thereby magically switching any consumers using these\n   * proxies to use the new network.\n   *\n   * Also refreshes the EthQuery instance accessible via the `getEthQuery`\n   * action to wrap the provider from the new network client. Note that this is\n   * not a proxy, so consumers will need to call `getEthQuery` again after the\n   * network switch.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client could be found matching the given ID.\n   */\n  #applyNetworkSelection(\n    networkClientId: string,\n    {\n      updateState,\n    }: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): void {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    let autoManagedNetworkClient:\n      | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n      | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(\n          `No Infura network client found with ID '${networkClientId}'`,\n        );\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    } else {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          networkClientId\n        ];\n\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(`No network client found with ID '${networkClientId}'`);\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    }\n\n    this.#autoManagedNetworkClient = autoManagedNetworkClient;\n\n    this.update((state) => {\n      state.selectedNetworkClientId = networkClientId;\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      updateState?.(state);\n    });\n\n    if (this.#providerProxy) {\n      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);\n    } else {\n      this.#providerProxy = createSwappableProxy(\n        this.#autoManagedNetworkClient.provider,\n      );\n    }\n\n    if (this.#blockTrackerProxy) {\n      this.#blockTrackerProxy.setTarget(\n        this.#autoManagedNetworkClient.blockTracker,\n      );\n    } else {\n      this.#blockTrackerProxy = createEventEmitterProxy(\n        this.#autoManagedNetworkClient.blockTracker,\n        {\n          eventFilter: 'skipInternal',\n        },\n      );\n    }\n\n    this.#ethQuery = new EthQuery(this.#providerProxy);\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"NetworkController.mjs","sourceRoot":"","sources":["../src/NetworkController.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport { BaseController } from '@metamask/base-controller';\nimport type { ConnectivityControllerGetStateAction } from '@metamask/connectivity-controller';\nimport type { Partialize } from '@metamask/controller-utils';\nimport {\n  InfuraNetworkType,\n  CustomNetworkType,\n  NetworkType,\n  isSafeChainId,\n  isInfuraNetworkType,\n  ChainId,\n  NetworksTicker,\n  NetworkNickname,\n  BUILT_IN_CUSTOM_NETWORKS_RPC,\n  BUILT_IN_NETWORKS,\n} from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport EthQuery from '@metamask/eth-query';\nimport type { Messenger } from '@metamask/messenger';\nimport { errorCodes } from '@metamask/rpc-errors';\nimport {\n  createEventEmitterProxy,\n  createSwappableProxy,\n} from '@metamask/swappable-obj-proxy';\nimport type { SwappableProxy } from '@metamask/swappable-obj-proxy';\nimport type { Hex } from '@metamask/utils';\nimport { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';\nimport deepEqual from 'fast-deep-equal';\nimport type { Draft } from 'immer';\nimport { produce } from 'immer';\nimport { cloneDeep } from 'lodash';\nimport type { Logger } from 'loglevel';\nimport { createSelector } from 'reselect';\nimport * as URI from 'uri-js';\nimport { v4 as uuidV4 } from 'uuid';\n\nimport {\n  DEPRECATED_NETWORKS,\n  INFURA_BLOCKED_KEY,\n  NetworkStatus,\n} from './constants';\nimport type {\n  AutoManagedNetworkClient,\n  ProxyWithAccessibleTarget,\n} from './create-auto-managed-network-client';\nimport { createAutoManagedNetworkClient } from './create-auto-managed-network-client';\nimport { projectLogger, createModuleLogger } from './logger';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { NetworkClientType } from './types';\nimport type {\n  BlockTracker,\n  Provider,\n  CustomNetworkClientConfiguration,\n  InfuraNetworkClientConfiguration,\n  NetworkClientConfiguration,\n  AdditionalDefaultNetwork,\n} from './types';\n\nconst debugLog = createModuleLogger(projectLogger, 'NetworkController');\n\nconst INFURA_URL_REGEX =\n  /^https:\\/\\/(?<networkName>[^.]+)\\.infura\\.io\\/v\\d+\\/(?<apiKey>.+)$/u;\n\nexport type Block = {\n  baseFeePerGas?: string;\n};\n\n/**\n * Information about a network not held by any other part of state.\n */\nexport type NetworkMetadata = {\n  /**\n   * EIPs supported by the network.\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  EIPS: {\n    [eipNumber: number]: boolean;\n  };\n  /**\n   * Indicates the availability of the network\n   */\n  status: NetworkStatus;\n};\n\n/**\n * The type of an RPC endpoint.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport enum RpcEndpointType {\n  Custom = 'custom',\n  Infura = 'infura',\n}\n\n/**\n * An Infura RPC endpoint is a reference to a specific network that Infura\n * supports as well as an Infura account we own that we allow users to make use\n * of for free. We need to disambiguate these endpoints from custom RPC\n * endpoints, because while the types for these kinds of object both have the\n * same interface, the URL for an Infura endpoint contains the Infura project\n * ID, and we don't want this to be present in state. We therefore hide it by\n * representing it in the URL as `{infuraProjectId}`, which we replace this when\n * create network clients. But we need to know somehow that we only need to do\n * this replacement for Infura endpoints and not custom endpoints â€” hence the\n * separate type.\n */\nexport type InfuraRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: BuiltInNetworkClientId;\n  /**\n   * The type of this endpoint, always \"default\".\n   */\n  type: RpcEndpointType.Infura;\n  /**\n   * The URL of the endpoint. Expected to be a template with the string\n   * `{infuraProjectId}`, which will get replaced with the Infura project ID\n   * when the network client is created.\n   */\n  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;\n};\n\n/**\n * A custom RPC endpoint is a reference to a user-defined server which fronts an\n * EVM chain. It may refer to an Infura network, but only by coincidence.\n */\nexport type CustomRpcEndpoint = {\n  /**\n   * Alternate RPC endpoints to use when this endpoint is down.\n   */\n  failoverUrls?: string[];\n  /**\n   * The optional user-facing nickname of the endpoint.\n   */\n  name?: string;\n  /**\n   * The identifier for the network client that has been created for this RPC\n   * endpoint. This is also used to uniquely identify the RPC endpoint in a\n   * set of RPC endpoints as well: once assigned, it is used to determine\n   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.\n   */\n  networkClientId: CustomNetworkClientId;\n  /**\n   * The type of this endpoint, always \"custom\".\n   */\n  type: RpcEndpointType.Custom;\n  /**\n   * The URL of the endpoint.\n   */\n  url: string;\n};\n\n/**\n * An RPC endpoint is a reference to a server which fronts an EVM chain. There\n * are two varieties of RPC endpoints: Infura and custom.\n *\n * @see {@link CustomRpcEndpoint}\n * @see {@link InfuraRpcEndpoint}\n */\nexport type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;\n\n/**\n * From a user perspective, a network configuration holds information about a\n * network that a user can select through the client. A \"network\" in this sense\n * can explicitly refer to an EVM chain that the user explicitly adds or doesn't\n * need to add (because it comes shipped with the client). The properties here\n * therefore directly map to fields that a user sees and can edit for a network\n * within the client.\n *\n * Internally, a network configuration represents a single conceptual EVM chain,\n * which is represented tangibly via multiple RPC endpoints. A \"network\" is then\n * something for which a network client object is created automatically or\n * created on demand when it is added to the client.\n */\nexport type NetworkConfiguration = {\n  /**\n   * A set of URLs that allows the user to view activity that has occurred on\n   * the chain.\n   */\n  blockExplorerUrls: string[];\n  /**\n   * The ID of the chain. Represented in hexadecimal format with a leading \"0x\"\n   * instead of decimal format so that when viewed out of context it can be\n   * unambiguously interpreted.\n   */\n  chainId: Hex;\n  /**\n   * A reference to a URL that the client will use by default to allow the user\n   * to view activity that has occurred on the chain. This index must refer to\n   * an item in `blockExplorerUrls`.\n   */\n  defaultBlockExplorerUrlIndex?: number;\n  /**\n   * A reference to an RPC endpoint that all requests will use by default in order to\n   * interact with the chain. This index must refer to an item in\n   * `rpcEndpoints`.\n   */\n  defaultRpcEndpointIndex: number;\n  /**\n   * The user-facing nickname assigned to the chain.\n   */\n  name: string;\n  /**\n   * The name of the currency to use for the chain.\n   */\n  nativeCurrency: string;\n  /**\n   * The collection of possible RPC endpoints that the client can use to\n   * interact with the chain.\n   */\n  rpcEndpoints: RpcEndpoint[];\n  /**\n   * Profile Sync - Network Sync field.\n   * Allows comparison of local network state with state to sync.\n   */\n  lastUpdatedAt?: number;\n};\n\n/**\n * A custom RPC endpoint in a new network configuration, meant to be used in\n * conjunction with `AddNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type AddNetworkCustomRpcEndpointFields = Omit<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * A new network configuration that `addNetwork` takes.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and are not represented by\n * network clients yet.\n */\nexport type AddNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * A custom RPC endpoint in an updated representation of a network\n * configuration, meant to be used in conjunction with `UpdateNetworkFields`.\n *\n * Custom RPC endpoints do not need a `networkClientId` property because it is\n * assumed that they have not already been added and therefore network clients\n * do not exist for them yet (and hence IDs need to be generated).\n */\nexport type UpdateNetworkCustomRpcEndpointFields = Partialize<\n  CustomRpcEndpoint,\n  'networkClientId'\n>;\n\n/**\n * An updated representation of an existing network configuration that\n * `updateNetwork` takes.\n *\n * Custom RPC endpoints may or may not have a `networkClientId` property; if\n * they do, then it is assumed that they already exist, and if not, then it is\n * assumed that they are new and are not represented by network clients yet.\n */\nexport type UpdateNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {\n  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];\n};\n\n/**\n * `Object.keys()` is intentionally generic: it returns the keys of an object,\n * but it cannot make guarantees about the contents of that object, so the type\n * of the keys is merely `string[]`. While this is technically accurate, it is\n * also unnecessary if we have an object that we own and whose contents are\n * known exactly.\n *\n * TODO: Move to @metamask/utils.\n *\n * @param object - The object.\n * @returns The keys of an object, typed according to the type of the object\n * itself.\n */\nexport function knownKeysOf<Key extends PropertyKey>(\n  // TODO: Replace `any` with type\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  object: Partial<Record<Key, any>>,\n): Key[] {\n  return Object.keys(object) as Key[];\n}\n\n/**\n * Type guard for determining whether the given value is an error object with a\n * `code` property, such as an instance of Error.\n *\n * TODO: Move this to @metamask/utils.\n *\n * @param error - The object to check.\n * @returns True if `error` has a `code`, false otherwise.\n */\nfunction isErrorWithCode(error: unknown): error is { code: string | number } {\n  return typeof error === 'object' && error !== null && 'code' in error;\n}\n\n/**\n * The string that uniquely identifies an Infura network client.\n */\nexport type BuiltInNetworkClientId = InfuraNetworkType;\n\n/**\n * The string that uniquely identifies a custom network client.\n */\nexport type CustomNetworkClientId = string;\n\n/**\n * The string that uniquely identifies a network client.\n */\nexport type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;\n\n/**\n * Extra information about each network, such as whether it is accessible or\n * blocked and whether it supports EIP-1559, keyed by network client ID.\n */\nexport type NetworksMetadata = Record<NetworkClientId, NetworkMetadata>;\n\n/**\n * The state that NetworkController stores.\n */\nexport type NetworkState = {\n  /**\n   * The ID of the network client that the proxies returned by\n   * `getSelectedNetworkClient` currently point to.\n   */\n  selectedNetworkClientId: NetworkClientId;\n  /**\n   * The registry of networks and corresponding RPC endpoints that the\n   * controller can use to make requests for various chains.\n   *\n   * @see {@link NetworkConfiguration}\n   */\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>;\n  /**\n   * Extra information about each network, such as whether it is accessible or\n   * blocked and whether it supports EIP-1559, keyed by network client ID.\n   */\n  networksMetadata: NetworksMetadata;\n};\n\nconst controllerName = 'NetworkController';\n\n/**\n * Represents the block tracker for the currently selected network. (Note that\n * this is a proxy around a proxy: the inner one exists so that the block\n * tracker doesn't have to exist until it's used, and the outer one exists so\n * that the currently selected network can change without consumers needing to\n * refresh the object reference to that network.)\n */\nexport type BlockTrackerProxy = SwappableProxy<\n  ProxyWithAccessibleTarget<BlockTracker>\n>;\n\n/**\n * Represents the provider for the currently selected network. (Note that this\n * is a proxy around a proxy: the inner one exists so that the provider doesn't\n * have to exist until it's used, and the outer one exists so that the currently\n * selected network can change without consumers needing to refresh the object\n * reference to that network.)\n */\nexport type ProviderProxy = SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n\nexport type NetworkControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof controllerName,\n  NetworkState\n>;\n\n/**\n * `networkWillChange` is published when the current network is about to be\n * switched, but the new provider has not been created and no state changes have\n * occurred yet.\n */\nexport type NetworkControllerNetworkWillChangeEvent = {\n  type: 'NetworkController:networkWillChange';\n  payload: [NetworkState];\n};\n\n/**\n * `networkDidChange` is published after a provider has been created for a newly\n * switched network (but before the network has been confirmed to be available).\n */\nexport type NetworkControllerNetworkDidChangeEvent = {\n  type: 'NetworkController:networkDidChange';\n  payload: [NetworkState];\n};\n\n/**\n * `infuraIsBlocked` is published after the network is switched to an Infura\n * network, but when Infura returns an error blocking the user based on their\n * location.\n */\nexport type NetworkControllerInfuraIsBlockedEvent = {\n  type: 'NetworkController:infuraIsBlocked';\n  payload: [];\n};\n\n/**\n * `infuraIsBlocked` is published either after the network is switched to an\n * Infura network and Infura does not return an error blocking the user based on\n * their location, or the network is switched to a non-Infura network.\n */\nexport type NetworkControllerInfuraIsUnblockedEvent = {\n  type: 'NetworkController:infuraIsUnblocked';\n  payload: [];\n};\n\n/**\n * `networkAdded` is published after a network configuration is added to the\n * network configuration registry and network clients are created for it.\n */\nexport type NetworkControllerNetworkAddedEvent = {\n  type: 'NetworkController:networkAdded';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `networkRemoved` is published after a network configuration is removed from the\n * network configuration registry and once the network clients have been removed.\n */\nexport type NetworkControllerNetworkRemovedEvent = {\n  type: 'NetworkController:networkRemoved';\n  payload: [networkConfiguration: NetworkConfiguration];\n};\n\n/**\n * `NetworkController:rpcEndpointChainUnavailable` is published when, after\n * trying all endpoints in an endpoint chain, the last failover reaches a\n * maximum number of consecutive 5xx responses, breaking the underlying circuit.\n *\n * In other words, this event will not be published if a failover is available,\n * even if the primary is not.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the last failover in the\n * endpoint chain.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointChainUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointUnavailable` is published when any\n * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx\n * responses, breaking the underlying circuit.\n *\n * In other words, this event will be published if a primary is not available,\n * even if a failover is.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint which reached the\n * maximum number of consecutive 5xx responses. You can compare this to\n * `primaryEndpointUrl` to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointUnavailableEvent = {\n  type: 'NetworkController:rpcEndpointUnavailable';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainDegraded` is published for any of the\n * endpoints in an endpoint chain when one of the following two conditions hold\n * (and the chain is not already in a degraded state):\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainDegradedEvent = {\n  type: 'NetworkController:rpcEndpointChainDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      error: unknown;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n *\n * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints\n * in an endpoint chain when:\n *\n * 1. A successful (2xx) request, even after being retried, cannot be made to\n * the endpoint.\n * 2. A successful (2xx) request can be made to the endpoint, but it takes\n * longer than expected to complete.\n *\n * Note that this event will be published even if there are local connectivity\n * issues which prevent requests from being initiated. This is intentional.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint for which requests\n * failed or were slow to complete. You can compare this to `primaryEndpointUrl`\n * to know whether it was a failover or a primary.\n * @param payload.error - The last error produced by the endpoint (or\n * `undefined` if the request was slow).\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n */\nexport type NetworkControllerRpcEndpointDegradedEvent = {\n  type: 'NetworkController:rpcEndpointDegraded';\n  payload: [\n    {\n      chainId: Hex;\n      endpointUrl: string;\n      error: unknown;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointChainAvailable` is published in one of two\n * cases:\n *\n * 1. The first time that a 2xx request is made to any of the endpoints in an\n * endpoint chain.\n * 2. When requests to any of the endpoints previously failed (placing the\n * endpoint in a degraded or unavailable status), but are now succeeding again.\n *\n * @param payload - The event payload.\n * @param payload.chainId - The target network's chain ID.\n * @param payload.networkClientId - The target network's client ID.\n */\nexport type NetworkControllerRpcEndpointChainAvailableEvent = {\n  type: 'NetworkController:rpcEndpointChainAvailable';\n  payload: [\n    {\n      chainId: Hex;\n      networkClientId: NetworkClientId;\n    },\n  ];\n};\n\n/**\n * `NetworkController:rpcEndpointRetried` is published before a request to any\n * endpoint in an endpoint chain is retried.\n *\n * This is mainly useful for tests.\n *\n * @param payload - The event payload.\n * @param payload.attempt - The current attempt counter for the endpoint\n * (starting from 0).\n * @param payload.chainId - The target network's chain ID.\n * @param payload.endpointUrl - The URL of the endpoint being retried.\n * @param payload.networkClientId - The target network's client ID.\n * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.\n * @see {@link RpcService} for the list of retriable errors.\n */\nexport type NetworkControllerRpcEndpointRetriedEvent = {\n  type: 'NetworkController:rpcEndpointRetried';\n  payload: [\n    {\n      attempt: number;\n      chainId: Hex;\n      endpointUrl: string;\n      networkClientId: NetworkClientId;\n      primaryEndpointUrl: string;\n    },\n  ];\n};\n\nexport type NetworkControllerEvents =\n  | NetworkControllerStateChangeEvent\n  | NetworkControllerNetworkWillChangeEvent\n  | NetworkControllerNetworkDidChangeEvent\n  | NetworkControllerInfuraIsBlockedEvent\n  | NetworkControllerInfuraIsUnblockedEvent\n  | NetworkControllerNetworkAddedEvent\n  | NetworkControllerNetworkRemovedEvent\n  | NetworkControllerRpcEndpointChainUnavailableEvent\n  | NetworkControllerRpcEndpointUnavailableEvent\n  | NetworkControllerRpcEndpointChainDegradedEvent\n  | NetworkControllerRpcEndpointDegradedEvent\n  | NetworkControllerRpcEndpointChainAvailableEvent\n  | NetworkControllerRpcEndpointRetriedEvent;\n\n/**\n * All events that {@link NetworkController} calls internally.\n */\ntype AllowedEvents = never;\n\nexport type NetworkControllerGetStateAction = ControllerGetStateAction<\n  typeof controllerName,\n  NetworkState\n>;\n\nexport type NetworkControllerGetEthQueryAction = {\n  type: `NetworkController:getEthQuery`;\n  handler: () => EthQuery | undefined;\n};\n\nexport type NetworkControllerGetNetworkClientByIdAction = {\n  type: `NetworkController:getNetworkClientById`;\n  handler: NetworkController['getNetworkClientById'];\n};\n\nexport type NetworkControllerGetSelectedNetworkClientAction = {\n  type: `NetworkController:getSelectedNetworkClient`;\n  handler: NetworkController['getSelectedNetworkClient'];\n};\n\nexport type NetworkControllerGetSelectedChainIdAction = {\n  type: 'NetworkController:getSelectedChainId';\n  handler: NetworkController['getSelectedChainId'];\n};\n\nexport type NetworkControllerGetEIP1559CompatibilityAction = {\n  type: `NetworkController:getEIP1559Compatibility`;\n  handler: NetworkController['getEIP1559Compatibility'];\n};\n\nexport type NetworkControllerFindNetworkClientIdByChainIdAction = {\n  type: `NetworkController:findNetworkClientIdByChainId`;\n  handler: NetworkController['findNetworkClientIdByChainId'];\n};\n\n/**\n * Change the currently selected network to the given built-in network type.\n *\n * @deprecated This action has been replaced by `setActiveNetwork`, and will be\n * removed in a future release.\n */\nexport type NetworkControllerSetProviderTypeAction = {\n  type: `NetworkController:setProviderType`;\n  handler: NetworkController['setProviderType'];\n};\n\nexport type NetworkControllerSetActiveNetworkAction = {\n  type: `NetworkController:setActiveNetwork`;\n  handler: NetworkController['setActiveNetwork'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByChainId = {\n  type: `NetworkController:getNetworkConfigurationByChainId`;\n  handler: NetworkController['getNetworkConfigurationByChainId'];\n};\n\nexport type NetworkControllerGetNetworkConfigurationByNetworkClientId = {\n  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;\n  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];\n};\n\nexport type NetworkControllerAddNetworkAction = {\n  type: 'NetworkController:addNetwork';\n  handler: NetworkController['addNetwork'];\n};\n\nexport type NetworkControllerRemoveNetworkAction = {\n  type: 'NetworkController:removeNetwork';\n  handler: NetworkController['removeNetwork'];\n};\n\nexport type NetworkControllerUpdateNetworkAction = {\n  type: 'NetworkController:updateNetwork';\n  handler: NetworkController['updateNetwork'];\n};\n\nexport type NetworkControllerActions =\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetEthQueryAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | NetworkControllerGetSelectedNetworkClientAction\n  | NetworkControllerGetSelectedChainIdAction\n  | NetworkControllerGetEIP1559CompatibilityAction\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerSetActiveNetworkAction\n  | NetworkControllerSetProviderTypeAction\n  | NetworkControllerGetNetworkConfigurationByChainId\n  | NetworkControllerGetNetworkConfigurationByNetworkClientId\n  | NetworkControllerAddNetworkAction\n  | NetworkControllerRemoveNetworkAction\n  | NetworkControllerUpdateNetworkAction;\n\n/**\n * All actions that {@link NetworkController} calls internally.\n */\ntype AllowedActions = ConnectivityControllerGetStateAction;\n\nexport type NetworkControllerMessenger = Messenger<\n  typeof controllerName,\n  NetworkControllerActions | AllowedActions,\n  NetworkControllerEvents | AllowedEvents\n>;\n\n/**\n * Options for the NetworkController constructor.\n */\nexport type NetworkControllerOptions = {\n  /**\n   * The messenger suited for this controller.\n   */\n  messenger: NetworkControllerMessenger;\n  /**\n   * The API key for Infura, used to make requests to Infura.\n   */\n  infuraProjectId: string;\n  /**\n   * The desired state with which to initialize this controller.\n   * Missing properties will be filled in with defaults. For instance, if not\n   * specified, `networkConfigurationsByChainId` will default to a basic set of\n   * network configurations (see {@link InfuraNetworkType} for the list).\n   */\n  state?: Partial<NetworkState>;\n  /**\n   * A `loglevel` logger object.\n   */\n  log?: Logger;\n  /**\n   * A function that can be used to customize a RPC service constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object with type {@link RpcServiceOptions}, minus `failoverService`\n   * and `endpointUrl` (as they are filled in automatically).\n   */\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  /**\n   * A function that can be used to customize a block tracker constructed for an\n   * RPC endpoint. The function takes the URL of the endpoint and should return\n   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as\n   * it is filled in automatically).\n   */\n  getBlockTrackerOptions?: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  /**\n   * An array of Hex Chain IDs representing the additional networks to be included as default.\n   */\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[];\n  /**\n   * Whether or not requests sent to unavailable RPC endpoints should be\n   * automatically diverted to configured failover RPC endpoints.\n   */\n  isRpcFailoverEnabled?: boolean;\n};\n\n/**\n * Constructs a value for the state property `networkConfigurationsByChainId`\n * which will be used if it has not been provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default value for `networkConfigurationsByChainId`.\n */\nfunction getDefaultNetworkConfigurationsByChainId(\n  additionalDefaultNetworks: AdditionalDefaultNetwork[] = [],\n): Record<Hex, NetworkConfiguration> {\n  const infuraNetworks = getDefaultInfuraNetworkConfigurationsByChainId();\n  const customNetworks = getDefaultCustomNetworkConfigurationsByChainId();\n\n  return additionalDefaultNetworks.reduce<Record<Hex, NetworkConfiguration>>(\n    (obj, chainId) => {\n      if (hasProperty(customNetworks, chainId)) {\n        obj[chainId] = customNetworks[chainId];\n      }\n      return obj;\n    },\n    // Always include the infura networks in the default networks\n    infuraNetworks,\n  );\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all Infura networks.\n */\nfunction getDefaultInfuraNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  return Object.values(InfuraNetworkType).reduce<\n    Record<Hex, NetworkConfiguration>\n  >((obj, infuraNetworkType) => {\n    const chainId = ChainId[infuraNetworkType];\n\n    // Skip deprecated network as default network.\n    if (DEPRECATED_NETWORKS.has(chainId)) {\n      return obj;\n    }\n\n    const rpcEndpointUrl =\n      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;\n\n    const networkConfiguration: NetworkConfiguration = {\n      blockExplorerUrls: [],\n      chainId,\n      defaultRpcEndpointIndex: 0,\n      name: NetworkNickname[infuraNetworkType],\n      nativeCurrency: NetworksTicker[infuraNetworkType],\n      rpcEndpoints: [\n        {\n          failoverUrls: [],\n          networkClientId: infuraNetworkType,\n          type: RpcEndpointType.Infura,\n          url: rpcEndpointUrl,\n        },\n      ],\n    };\n\n    return { ...obj, [chainId]: networkConfiguration };\n  }, {});\n}\n\n/**\n * Constructs a `networkConfigurationsByChainId` object for all default custom networks.\n *\n * @returns The `networkConfigurationsByChainId` object of all custom networks.\n */\nfunction getDefaultCustomNetworkConfigurationsByChainId(): Record<\n  Hex,\n  NetworkConfiguration\n> {\n  // Create the `networkConfigurationsByChainId` objects explicitly,\n  // Because it is not always guaranteed that the custom networks are included in the\n  // default networks.\n  return {\n    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet'],\n    ),\n    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(\n      CustomNetworkType['megaeth-testnet-v2'],\n    ),\n    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['monad-testnet'],\n    ),\n    // Environment 3: Power User test networks\n    [ChainId['fantom-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['fantom-mainnet'],\n    ),\n    [ChainId['gnosis-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['gnosis-mainnet'],\n    ),\n    [ChainId['cronos-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['cronos-mainnet'],\n    ),\n    [ChainId['moonbeam-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['moonbeam-mainnet'],\n    ),\n    [ChainId['moonriver-mainnet']]: getCustomNetworkConfiguration(\n      CustomNetworkType['moonriver-mainnet'],\n    ),\n  };\n}\n\n/**\n * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.\n *\n * @param customNetworkType - The type of the custom network.\n * @returns The `NetworkConfiguration` object.\n */\nfunction getCustomNetworkConfiguration(\n  customNetworkType: CustomNetworkType,\n): NetworkConfiguration {\n  const { ticker, rpcPrefs } = BUILT_IN_NETWORKS[customNetworkType];\n  const rpcEndpointUrl = BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];\n\n  return {\n    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],\n    chainId: ChainId[customNetworkType],\n    defaultRpcEndpointIndex: 0,\n    defaultBlockExplorerUrlIndex: 0,\n    name: NetworkNickname[customNetworkType],\n    nativeCurrency: ticker,\n    rpcEndpoints: [\n      {\n        failoverUrls: [],\n        networkClientId: customNetworkType,\n        type: RpcEndpointType.Custom,\n        url: rpcEndpointUrl,\n      },\n    ],\n  };\n}\n\n/**\n * Constructs properties for the NetworkController state whose values will be\n * used if not provided to the constructor.\n *\n * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.\n * @returns The default NetworkController state.\n */\nexport function getDefaultNetworkControllerState(\n  additionalDefaultNetworks?: AdditionalDefaultNetwork[],\n): NetworkState {\n  const networksMetadata = {};\n  const networkConfigurationsByChainId =\n    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);\n\n  return {\n    selectedNetworkClientId: InfuraNetworkType.mainnet,\n    networksMetadata,\n    networkConfigurationsByChainId,\n  };\n}\n\n/**\n * Redux selector for getting all network configurations from NetworkController\n * state, keyed by chain ID.\n *\n * @param state - NetworkController state\n * @returns All registered network configurations, keyed by chain ID.\n */\nconst selectNetworkConfigurationsByChainId = (\n  state: NetworkState,\n): Record<`0x${string}`, NetworkConfiguration> =>\n  state.networkConfigurationsByChainId;\n\n/**\n * Get a list of all network configurations.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport function getNetworkConfigurations(\n  state: NetworkState,\n): NetworkConfiguration[] {\n  return Object.values(state.networkConfigurationsByChainId);\n}\n\n/**\n * Redux selector for getting a list of all network configurations from\n * NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network configurations\n */\nexport const selectNetworkConfigurations = createSelector(\n  selectNetworkConfigurationsByChainId,\n  (networkConfigurationsByChainId) =>\n    Object.values(networkConfigurationsByChainId),\n);\n\n/**\n * Get a list of all available network client IDs from a list of network\n * configurations.\n *\n * @param networkConfigurations - The array of network configurations\n * @returns A list of all available client IDs\n */\nexport function getAvailableNetworkClientIds(\n  networkConfigurations: NetworkConfiguration[],\n): string[] {\n  return networkConfigurations.flatMap((networkConfiguration) =>\n    networkConfiguration.rpcEndpoints.map(\n      (rpcEndpoint) => rpcEndpoint.networkClientId,\n    ),\n  );\n}\n\n/**\n * Redux selector for getting a list of all available network client IDs\n * from NetworkController state.\n *\n * @param state - NetworkController state\n * @returns A list of all available network client IDs.\n */\nexport const selectAvailableNetworkClientIds = createSelector(\n  selectNetworkConfigurations,\n  getAvailableNetworkClientIds,\n);\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedBuiltInNetworkClientRegistry = Record<\n  BuiltInNetworkClientId,\n  AutoManagedNetworkClient<InfuraNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks.\n */\nexport type AutoManagedCustomNetworkClientRegistry = Record<\n  CustomNetworkClientId,\n  AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n>;\n\n/**\n * The collection of auto-managed network clients that map to Infura networks\n * as well as custom networks that users have added.\n */\nexport type AutoManagedNetworkClientRegistry = {\n  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;\n  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to create a network client for an\n * RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype AddNetworkClientOperation = {\n  type: 'add';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `updateNetwork` and `removeNetwork` to remove a network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype RemoveNetworkClientOperation = {\n  type: 'remove';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` to replace the network client for\n * an RPC endpoint.\n *\n * @see {@link NetworkClientOperation}\n */\ntype ReplaceNetworkClientOperation = {\n  type: 'replace';\n  oldRpcEndpoint: RpcEndpoint;\n  newRpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC\n * endpoint, as far as the network client registry is concerned.\n *\n * @see {@link NetworkClientOperation}\n */\ntype NoopNetworkClientOperation = {\n  type: 'noop';\n  rpcEndpoint: RpcEndpoint;\n};\n\n/**\n * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to\n * update the network client registry.\n *\n * - When `addNetwork` is called, represents a network client that should be\n * created for a new RPC endpoint.\n * - When `removeNetwork` is called, represents a network client that should be\n * destroyed for a previously existing RPC endpoint.\n * - When `updateNetwork` is called, represents either:\n *   - a network client that should be added for a new RPC endpoint\n *   - a network client that should be removed for a previously existing RPC\n *   endpoint\n *   - a network client that should be replaced for an RPC endpoint that was\n *   changed in a non-major way, or\n *   - a network client that should be unchanged for an RPC endpoint that was\n *   also unchanged.\n */\ntype NetworkClientOperation =\n  | AddNetworkClientOperation\n  | RemoveNetworkClientOperation\n  | ReplaceNetworkClientOperation\n  | NoopNetworkClientOperation;\n\n/**\n * Determines whether the given URL is valid by attempting to parse it.\n *\n * @param url - The URL to test.\n * @returns True if the URL is valid, false otherwise.\n */\nfunction isValidUrl(url: string): boolean {\n  const uri = URI.parse(url);\n  return (\n    uri.error === undefined && (uri.scheme === 'http' || uri.scheme === 'https')\n  );\n}\n\n/**\n * Given an Infura API URL, extracts the subdomain that identifies the Infura\n * network.\n *\n * @param rpcEndpointUrl - The URL to operate on.\n * @returns The Infura network name that the URL references.\n * @throws if the URL is not an Infura API URL, or if an Infura network is not\n * present in the URL.\n */\nfunction deriveInfuraNetworkNameFromRpcEndpointUrl(\n  rpcEndpointUrl: string,\n): InfuraNetworkType {\n  const match = INFURA_URL_REGEX.exec(rpcEndpointUrl);\n\n  if (match?.groups) {\n    if (isInfuraNetworkType(match.groups.networkName)) {\n      return match.groups.networkName;\n    }\n\n    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);\n  }\n\n  throw new Error('Could not derive Infura network from RPC endpoint URL');\n}\n\n/**\n * Performs a series of checks that the given NetworkController state is\n * internally consistent â€” that all parts of state that are supposed to match in\n * fact do â€” so that working with the state later on doesn't cause unexpected\n * errors.\n *\n * In the case of NetworkController, there are several parts of state that need\n * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry\n * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC\n * endpoint within a network configuration.\n *\n * @param state - The NetworkController state to verify.\n * @throws if the state is invalid in some way.\n */\nfunction validateInitialState(state: NetworkState): void {\n  const networkConfigurationEntries = Object.entries(\n    state.networkConfigurationsByChainId,\n  );\n  const networkClientIds = getAvailableNetworkClientIds(\n    getNetworkConfigurations(state),\n  );\n\n  if (networkConfigurationEntries.length === 0) {\n    throw new Error(\n      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',\n    );\n  }\n\n  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {\n    if (chainId !== networkConfiguration.chainId) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \\`chainId\\` of '${networkConfiguration.chainId}'`,\n      );\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkConfiguration.blockExplorerUrls.length > 0\n        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||\n          networkConfiguration.blockExplorerUrls[\n            networkConfiguration.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultBlockExplorerUrlIndex\\` that does not refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ] === undefined\n    ) {\n      throw new Error(\n        `NetworkController state has invalid \\`networkConfigurationsByChainId\\`: Network configuration '${networkConfiguration.name}' has a \\`defaultRpcEndpointIndex\\` that does not refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n    throw new Error(\n      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',\n    );\n  }\n}\n\n/**\n * Checks that the given initial NetworkController state is internally\n * consistent similar to `validateInitialState`, but if an anomaly is detected,\n * it does its best to correct the state and logs an error to Sentry.\n *\n * @param state - The NetworkController state to verify.\n * @param messenger - The NetworkController messenger.\n * @returns The corrected state.\n */\nfunction correctInitialState(\n  state: NetworkState,\n  messenger: NetworkControllerMessenger,\n): NetworkState {\n  const networkConfigurationsSortedByChainId = getNetworkConfigurations(\n    state,\n  ).sort((a, b) => a.chainId.localeCompare(b.chainId));\n  const availableNetworkClientIds = getAvailableNetworkClientIds(\n    networkConfigurationsSortedByChainId,\n  );\n  const invalidNetworkClientIdsWithMetadata = Object.keys(\n    state.networksMetadata,\n  ).filter(\n    (networkClientId) => !availableNetworkClientIds.includes(networkClientId),\n  );\n\n  return produce(state, (newState) => {\n    if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {\n      const firstNetworkConfiguration = networkConfigurationsSortedByChainId[0];\n      const newSelectedNetworkClientId =\n        firstNetworkConfiguration.rpcEndpoints[\n          firstNetworkConfiguration.defaultRpcEndpointIndex\n        ].networkClientId;\n      messenger.captureException?.(\n        new Error(\n          `\\`selectedNetworkClientId\\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,\n        ),\n      );\n      newState.selectedNetworkClientId = newSelectedNetworkClientId;\n    }\n\n    if (invalidNetworkClientIdsWithMetadata.length > 0) {\n      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {\n        delete newState.networksMetadata[invalidNetworkClientId];\n      }\n      messenger.captureException?.(\n        new Error(\n          '`networksMetadata` had invalid network client IDs, which have been removed',\n        ),\n      );\n    }\n  });\n}\n\n/**\n * Transforms a map of chain ID to network configuration to a map of network\n * client ID to network configuration.\n *\n * @param networkConfigurationsByChainId - The network configurations, keyed by\n * chain ID.\n * @returns The network configurations, keyed by network client ID.\n */\nfunction buildNetworkConfigurationsByNetworkClientId(\n  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>,\n): Map<NetworkClientId, NetworkConfiguration> {\n  return new Map(\n    Object.values(networkConfigurationsByChainId).flatMap(\n      (networkConfiguration) => {\n        return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n          return [rpcEndpoint.networkClientId, networkConfiguration];\n        });\n      },\n    ),\n  );\n}\n\n/**\n * Controller that creates and manages an Ethereum network provider.\n */\nexport class NetworkController extends BaseController<\n  typeof controllerName,\n  NetworkState,\n  NetworkControllerMessenger\n> {\n  #ethQuery?: EthQuery;\n\n  readonly #infuraProjectId: string;\n\n  #previouslySelectedNetworkClientId: string;\n\n  #providerProxy: ProviderProxy | undefined;\n\n  #blockTrackerProxy: BlockTrackerProxy | undefined;\n\n  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;\n\n  #autoManagedNetworkClient?:\n    | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n    | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  readonly #log: Logger | undefined;\n\n  readonly #getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];\n\n  readonly #getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];\n\n  #networkConfigurationsByNetworkClientId: Map<\n    NetworkClientId,\n    NetworkConfiguration\n  >;\n\n  #isRpcFailoverEnabled: Exclude<\n    NetworkControllerOptions['isRpcFailoverEnabled'],\n    undefined\n  >;\n\n  /**\n   * Constructs a NetworkController.\n   *\n   * @param options - The options; see {@link NetworkControllerOptions}.\n   */\n  constructor(options: NetworkControllerOptions) {\n    const {\n      messenger,\n      state,\n      infuraProjectId,\n      log,\n      getRpcServiceOptions,\n      getBlockTrackerOptions,\n      additionalDefaultNetworks,\n      isRpcFailoverEnabled = false,\n    } = options;\n    const initialState = {\n      ...getDefaultNetworkControllerState(additionalDefaultNetworks),\n      ...state,\n    };\n    validateInitialState(initialState);\n    const correctedInitialState = correctInitialState(initialState, messenger);\n\n    if (!infuraProjectId || typeof infuraProjectId !== 'string') {\n      throw new Error('Invalid Infura project ID');\n    }\n\n    super({\n      name: controllerName,\n      metadata: {\n        selectedNetworkClientId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networksMetadata: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n        networkConfigurationsByChainId: {\n          includeInStateLogs: true,\n          persist: true,\n          includeInDebugSnapshot: false,\n          usedInUi: true,\n        },\n      },\n      messenger,\n      state: correctedInitialState,\n    });\n\n    this.#infuraProjectId = infuraProjectId;\n    this.#log = log;\n    this.#getRpcServiceOptions = getRpcServiceOptions;\n    this.#getBlockTrackerOptions = getBlockTrackerOptions;\n    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;\n\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        this.state.networkConfigurationsByChainId,\n      );\n\n    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, () => {\n      return this.#ethQuery;\n    });\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkClientById`,\n      this.getNetworkClientById.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getEIP1559Compatibility`,\n      this.getEIP1559Compatibility.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setActiveNetwork`,\n      this.setActiveNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:setProviderType`,\n      this.setProviderType.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:findNetworkClientIdByChainId`,\n      this.findNetworkClientIdByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByChainId`,\n      this.getNetworkConfigurationByChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getNetworkConfigurationByNetworkClientId`,\n      this.getNetworkConfigurationByNetworkClientId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedNetworkClient`,\n      this.getSelectedNetworkClient.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:getSelectedChainId`,\n      this.getSelectedChainId.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:addNetwork`,\n      this.addNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:removeNetwork`,\n      this.removeNetwork.bind(this),\n    );\n\n    this.messenger.registerActionHandler(\n      `${this.name}:updateNetwork`,\n      this.updateNetwork.bind(this),\n    );\n\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainUnavailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Unavailable,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainDegraded`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Degraded,\n        });\n      },\n    );\n    this.messenger.subscribe(\n      `${this.name}:rpcEndpointChainAvailable`,\n      ({ networkClientId }) => {\n        this.#updateMetadataForNetwork(networkClientId, {\n          networkStatus: NetworkStatus.Available,\n        });\n      },\n    );\n  }\n\n  /**\n   * Enables the RPC failover functionality. That is, if any RPC endpoints are\n   * configured with failover URLs, then traffic will automatically be diverted\n   * to them if those RPC endpoints are unavailable.\n   */\n  enableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(true);\n  }\n\n  /**\n   * Disables the RPC failover functionality. That is, even if any RPC endpoints\n   * are configured with failover URLs, then traffic will not automatically be\n   * diverted to them if those RPC endpoints are unavailable.\n   */\n  disableRpcFailover(): void {\n    this.#updateRpcFailoverEnabled(false);\n  }\n\n  /**\n   * Enables or disables the RPC failover functionality, depending on the\n   * boolean given. This is done by reconstructing all network clients that were\n   * originally configured with failover URLs so that those URLs are either\n   * honored or ignored. Network client IDs will be preserved so as not to\n   * invalidate state in other controllers.\n   *\n   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the\n   * RPC failover functionality.\n   */\n  #updateRpcFailoverEnabled(newIsRpcFailoverEnabled: boolean): void {\n    if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {\n      return;\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    for (const networkClientsById of Object.values(\n      autoManagedNetworkClientRegistry,\n    )) {\n      for (const networkClientId of Object.keys(networkClientsById)) {\n        // Type assertion: We can assume that `networkClientId` is valid here.\n        const networkClient =\n          networkClientsById[\n            networkClientId as keyof typeof networkClientsById\n          ];\n        if (\n          networkClient.configuration.failoverRpcUrls &&\n          networkClient.configuration.failoverRpcUrls.length > 0\n        ) {\n          newIsRpcFailoverEnabled\n            ? networkClient.enableRpcFailover()\n            : networkClient.disableRpcFailover();\n        }\n      }\n    }\n\n    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns The proxy and block tracker proxies.\n   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.\n   */\n  getProviderAndBlockTracker(): {\n    provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>> | undefined;\n    blockTracker:\n      | SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>\n      | undefined;\n  } {\n    return {\n      provider: this.#providerProxy,\n      blockTracker: this.#blockTrackerProxy,\n    };\n  }\n\n  /**\n   * Accesses the provider and block tracker for the currently selected network.\n   *\n   * @returns an object with the provider and block tracker proxies for the currently selected network.\n   */\n  getSelectedNetworkClient():\n    | {\n        provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>>;\n        blockTracker: SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>;\n      }\n    | undefined {\n    if (this.#providerProxy && this.#blockTrackerProxy) {\n      return {\n        provider: this.#providerProxy,\n        blockTracker: this.#blockTrackerProxy,\n      };\n    }\n    return undefined;\n  }\n\n  /**\n   * Accesses the chain ID from the selected network client.\n   *\n   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.\n   */\n  getSelectedChainId(): Hex | undefined {\n    const networkConfiguration = this.getNetworkConfigurationByNetworkClientId(\n      this.state.selectedNetworkClientId,\n    );\n    return networkConfiguration?.chainId;\n  }\n\n  /**\n   * Internally, the Infura and custom network clients are categorized by type\n   * so that when accessing either kind of network client, TypeScript knows\n   * which type to assign to the network client. For some cases it's more useful\n   * to be able to access network clients by ID instead of by type and then ID,\n   * so this function makes that possible.\n   *\n   * @returns The network clients registered so far, keyed by ID.\n   */\n  getNetworkClientRegistry(): AutoManagedBuiltInNetworkClientRegistry &\n    AutoManagedCustomNetworkClientRegistry {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    return Object.assign(\n      {},\n      autoManagedNetworkClientRegistry[NetworkClientType.Infura],\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom],\n    );\n  }\n\n  /**\n   * Returns the Infura network client with the given ID.\n   *\n   * @param infuraNetworkClientId - An Infura network client ID.\n   * @returns The Infura network client.\n   * @throws If an Infura network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    infuraNetworkClientId: BuiltInNetworkClientId,\n  ): AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n  /**\n   * Returns the custom network client with the given ID.\n   *\n   * @param customNetworkClientId - A custom network client ID.\n   * @returns The custom network client.\n   * @throws If a custom network client does not exist with the given ID.\n   */\n  getNetworkClientById(\n    customNetworkClientId: CustomNetworkClientId,\n  ): AutoManagedNetworkClient<CustomNetworkClientConfiguration>;\n\n  getNetworkClientById(\n    networkClientId: NetworkClientId,\n  ): AutoManagedNetworkClient<NetworkClientConfiguration> {\n    if (!networkClientId) {\n      throw new Error('No network client ID was provided.');\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const infuraNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!infuraNetworkClient) {\n        throw new Error(\n          `No Infura network client was found with the ID \"${networkClientId}\".`,\n        );\n      }\n      return infuraNetworkClient;\n    }\n\n    const customNetworkClient =\n      autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n        networkClientId\n      ];\n    if (!customNetworkClient) {\n      throw new Error(\n        `No custom network client was found with the ID \"${networkClientId}\".`,\n      );\n    }\n    return customNetworkClient;\n  }\n\n  /**\n   * Executes a series of steps to switch the network:\n   *\n   * 1. Notifies subscribers via the messenger that the network is about to be\n   * switched (and, really, that the global provider and block tracker proxies\n   * will be re-pointed to a new network).\n   * 2. Looks up a known and preinitialized network client matching the given\n   * ID and uses it to re-point the aforementioned provider and block tracker\n   * proxies.\n   * 3. Notifies subscribers via the messenger that the network has switched.\n   * 4. Captures metadata for the newly switched network in state.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   */\n  async #refreshNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.messenger.publish('NetworkController:networkWillChange', this.state);\n    this.#applyNetworkSelection(networkClientId, options);\n    this.messenger.publish('NetworkController:networkDidChange', this.state);\n    await this.lookupNetwork();\n  }\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   */\n  initializeProvider(options: { lookupNetwork: false }): void;\n\n  /**\n   * Creates proxies for accessing the global network client and its block\n   * tracker. You must call this method in order to use\n   * `getProviderAndBlockTracker` (or its replacement,\n   * `getSelectedNetworkClient`).\n   *\n   * @param options - Optional arguments.\n   * @param options.lookupNetwork - Usually, metadata for the global network\n   * will be populated via a call to `lookupNetwork` after creating the provider\n   * and block tracker proxies. This allows for responding to the status of the\n   * global network after initializing this controller; however, it requires\n   * making a request to the network to do so. In the clients, where controllers\n   * are initialized before the UI is shown, this may be undesirable, as it\n   * means that if the user has just installed MetaMask, their IP address may be\n   * shared with a third party before they have a chance to finish onboarding.\n   * You can pass `false` if you'd like to disable this request and call\n   * `lookupNetwork` yourself.\n   * @returns A promise that resolves when the network lookup completes.\n   */\n  initializeProvider(options?: { lookupNetwork?: boolean }): Promise<void>;\n\n  initializeProvider({\n    lookupNetwork = true,\n  }: {\n    lookupNetwork?: boolean;\n  } = {}): Promise<void> | undefined {\n    this.#applyNetworkSelection(this.state.selectedNetworkClientId);\n\n    if (lookupNetwork) {\n      return this.lookupNetwork();\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   * @returns The resulting metadata for the network.\n   */\n  async #determineNetworkMetadata(networkClientId: NetworkClientId): Promise<{\n    isInfura: boolean;\n    networkStatus:\n      | NetworkStatus.Available\n      | NetworkStatus.Unknown\n      | NetworkStatus.Unavailable\n      | NetworkStatus.Blocked;\n    isEIP1559Compatible: undefined | boolean;\n  }> {\n    // Force TypeScript to use one of the two overloads explicitly\n    const networkClient = isInfuraNetworkType(networkClientId)\n      ? this.getNetworkClientById(networkClientId)\n      : this.getNetworkClientById(networkClientId);\n\n    const isInfura =\n      networkClient.configuration.type === NetworkClientType.Infura;\n    let networkStatus: NetworkStatus;\n    let isEIP1559Compatible: boolean | undefined;\n\n    try {\n      isEIP1559Compatible =\n        await this.#determineEIP1559Compatibility(networkClientId);\n      networkStatus = NetworkStatus.Available;\n    } catch (error) {\n      debugLog('NetworkController: lookupNetwork: ', error);\n\n      if (isErrorWithCode(error)) {\n        let responseBody;\n        if (\n          isInfura &&\n          hasProperty(error, 'message') &&\n          typeof error.message === 'string'\n        ) {\n          try {\n            responseBody = JSON.parse(error.message);\n          } catch {\n            // error.message must not be JSON\n            this.#log?.warn(\n              'NetworkController: lookupNetwork: json parse error: ',\n              error,\n            );\n          }\n        }\n\n        if (\n          isPlainObject(responseBody) &&\n          responseBody.error === INFURA_BLOCKED_KEY\n        ) {\n          networkStatus = NetworkStatus.Blocked;\n        } else if (error.code === errorCodes.rpc.internal) {\n          networkStatus = NetworkStatus.Unknown;\n          this.#log?.warn(\n            'NetworkController: lookupNetwork: rpc internal error: ',\n            error,\n          );\n        } else {\n          networkStatus = NetworkStatus.Unavailable;\n          this.#log?.warn('NetworkController: lookupNetwork: ', error);\n        }\n      } else {\n        debugLog(\n          'NetworkController - could not determine network status',\n          error,\n        );\n        networkStatus = NetworkStatus.Unknown;\n        this.#log?.warn('NetworkController: lookupNetwork: ', error);\n      }\n    }\n\n    return { isInfura, networkStatus, isEIP1559Compatible };\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given or selected network, persisting it to state:\n   *\n   * - The connectivity status: whether it is available, geo-blocked (Infura\n   * only), unavailable, or unknown\n   * - The capabilities status: whether it supports EIP-1559, whether it does\n   * not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * If no ID is provided, uses the currently selected network.\n   */\n  async lookupNetwork(networkClientId?: NetworkClientId): Promise<void> {\n    if (networkClientId) {\n      await this.#lookupGivenNetwork(networkClientId);\n    } else {\n      await this.#lookupSelectedNetwork();\n    }\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   * @deprecated Please use `lookupNetwork` and pass a network client ID\n   * instead. This method will be removed in a future major version.\n   */\n  // We are planning on removing this so we aren't interested in testing this\n  // right now.\n  /* istanbul ignore next */\n  async lookupNetworkByClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<void> {\n    await this.#lookupGivenNetwork(networkClientId);\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the given network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * @param networkClientId - The ID of the network client to inspect.\n   */\n  async #lookupGivenNetwork(networkClientId: NetworkClientId): Promise<void> {\n    const { networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(networkClientId);\n\n    this.#updateMetadataForNetwork(networkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n  }\n\n  /**\n   * Uses a request for the latest block to gather the following information on\n   * the currently selected network, persisting it to state:\n   *\n   * - The connectivity status: whether the network is available, geo-blocked\n   * (Infura only), unavailable, or unknown\n   * - The feature compatibility status: whether the network supports EIP-1559,\n   * whether it does not, or whether it is unknown\n   *\n   * Note that it is possible for the current network to be switched while this\n   * method is running. If that is the case, it will exit early (as this method\n   * will also run for the new network).\n   */\n  async #lookupSelectedNetwork(): Promise<void> {\n    if (!this.#ethQuery) {\n      return;\n    }\n\n    let networkChanged = false;\n    const listener = (): void => {\n      networkChanged = true;\n      try {\n        this.messenger.unsubscribe(\n          'NetworkController:networkDidChange',\n          listener,\n        );\n      } catch (error) {\n        // In theory, this `catch` should not be necessary given that this error\n        // would occur \"inside\" of the call to `#determineEIP1559Compatibility`\n        // below and so it should be caught by the `try`/`catch` below (it is\n        // impossible to reproduce in tests for that reason). However, somehow\n        // it occurs within Mobile and so we have to add our own `try`/`catch`\n        // here.\n        /* istanbul ignore next */\n        if (\n          !(error instanceof Error) ||\n          error.message !==\n            'Subscription not found for event: NetworkController:networkDidChange'\n        ) {\n          // Again, this error should not happen and is impossible to reproduce\n          // in tests.\n          /* istanbul ignore next */\n          throw error;\n        }\n      }\n    };\n    this.messenger.subscribe('NetworkController:networkDidChange', listener);\n\n    const { isInfura, networkStatus, isEIP1559Compatible } =\n      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);\n\n    if (networkChanged) {\n      // If the network has changed, then `lookupNetwork` either has been or is\n      // in the process of being called, so we don't need to go further.\n      return;\n    }\n\n    try {\n      this.messenger.unsubscribe(\n        'NetworkController:networkDidChange',\n        listener,\n      );\n    } catch (error) {\n      if (\n        !(error instanceof Error) ||\n        error.message !==\n          'Subscription not found for event: NetworkController:networkDidChange'\n      ) {\n        throw error;\n      }\n    }\n\n    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {\n      networkStatus,\n      isEIP1559Compatible,\n    });\n\n    if (isInfura) {\n      if (networkStatus === NetworkStatus.Available) {\n        this.messenger.publish('NetworkController:infuraIsUnblocked');\n      } else if (networkStatus === NetworkStatus.Blocked) {\n        this.messenger.publish('NetworkController:infuraIsBlocked');\n      }\n    } else {\n      // Always publish infuraIsUnblocked regardless of network status to\n      // prevent consumers from being stuck in a blocked state if they were\n      // previously connected to an Infura network that was blocked\n      this.messenger.publish('NetworkController:infuraIsUnblocked');\n    }\n  }\n\n  /**\n   * Updates the metadata for the given network in state.\n   *\n   * @param networkClientId - The associated network client ID.\n   * @param metadata - The metadata to store in state.\n   * @param metadata.networkStatus - The network status to store in state.\n   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to\n   * store in state.\n   */\n  #updateMetadataForNetwork(\n    networkClientId: NetworkClientId,\n    metadata: {\n      networkStatus: NetworkStatus;\n      isEIP1559Compatible?: boolean | undefined;\n    },\n  ): void {\n    this.update((state) => {\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      const newMetadata = state.networksMetadata[networkClientId];\n      newMetadata.status = metadata.networkStatus;\n\n      if ('isEIP1559Compatible' in metadata) {\n        if (metadata.isEIP1559Compatible === undefined) {\n          delete newMetadata.EIPS[1559];\n        } else {\n          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;\n        }\n      }\n    });\n  }\n\n  /**\n   * Convenience method to update provider network type settings.\n   *\n   * @param type - Human readable network name.\n   * @deprecated This has been replaced by `setActiveNetwork`, and will be\n   * removed in a future release\n   */\n  async setProviderType(type: InfuraNetworkType): Promise<void> {\n    if ((type as unknown) === NetworkType.rpc) {\n      throw new Error(\n        `NetworkController - cannot call \"setProviderType\" with type \"${NetworkType.rpc}\". Use \"setActiveNetwork\"`,\n      );\n    }\n    if (!isInfuraNetworkType(type)) {\n      throw new Error(`Unknown Infura provider type \"${String(type)}\".`);\n    }\n\n    await this.setActiveNetwork(type);\n  }\n\n  /**\n   * Changes the selected network.\n   *\n   * @param networkClientId - The ID of a network client that will be used to\n   * make requests.\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client is associated with the given\n   * network client ID.\n   */\n  async setActiveNetwork(\n    networkClientId: string,\n    options: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): Promise<void> {\n    this.#previouslySelectedNetworkClientId =\n      this.state.selectedNetworkClientId;\n\n    await this.#refreshNetwork(networkClientId, options);\n  }\n\n  /**\n   * Fetches the latest block for the network.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.\n   * @returns A promise that either resolves to the block header or null if\n   * there is no latest block, or rejects with an error.\n   */\n  #getLatestBlock(\n    networkClientId: NetworkClientId = this.state.selectedNetworkClientId,\n  ): Promise<Block> {\n    const networkClient = this.getNetworkClientById(networkClientId);\n    const ethQuery = new EthQuery(networkClient.provider);\n\n    return new Promise((resolve, reject) => {\n      ethQuery.sendAsync(\n        { method: 'eth_getBlockByNumber', params: ['latest', false] },\n        (error: unknown, block?: unknown) => {\n          if (error) {\n            // This error comes from JsonRpcEngine, we don't control it.\n            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n            reject(error);\n          } else {\n            // TODO: Validate this type\n            resolve(block as Block);\n          }\n        },\n      );\n    });\n  }\n\n  /**\n   * Determines whether the network supports EIP-1559 by checking whether the\n   * latest block has a `baseFeePerGas` property, then updates state\n   * appropriately.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.\n   * @returns A promise that resolves to true if the network supports EIP-1559\n   * , false otherwise, or `undefined` if unable to determine the compatibility.\n   */\n  async getEIP1559Compatibility(\n    networkClientId?: NetworkClientId,\n  ): Promise<undefined | boolean> {\n    if (networkClientId) {\n      return this.get1559CompatibilityWithNetworkClientId(networkClientId);\n    }\n    if (!this.#ethQuery) {\n      return false;\n    }\n\n    const { EIPS } =\n      this.state.networksMetadata[this.state.selectedNetworkClientId];\n\n    if (EIPS[1559] !== undefined) {\n      return EIPS[1559];\n    }\n\n    const isEIP1559Compatible = await this.#determineEIP1559Compatibility(\n      this.state.selectedNetworkClientId,\n    );\n    this.update((state) => {\n      if (isEIP1559Compatible !== undefined) {\n        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =\n          isEIP1559Compatible;\n      }\n    });\n    return isEIP1559Compatible;\n  }\n\n  async get1559CompatibilityWithNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean> {\n    let metadata = this.state.networksMetadata[networkClientId];\n    if (metadata?.EIPS[1559] === undefined) {\n      await this.lookupNetwork(networkClientId);\n      metadata = this.state.networksMetadata[networkClientId];\n    }\n    const { EIPS } = metadata;\n\n    // may want to include some 'freshness' value - something to make sure we refetch this from time to time\n    return EIPS[1559];\n  }\n\n  /**\n   * Retrieves and checks the latest block from the currently selected\n   * network; if the block has a `baseFeePerGas` property, then we know\n   * that the network supports EIP-1559; otherwise it doesn't.\n   *\n   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility\n   * @returns A promise that resolves to `true` if the network supports EIP-1559,\n   * `false` otherwise, or `undefined` if unable to retrieve the last block.\n   */\n  async #determineEIP1559Compatibility(\n    networkClientId: NetworkClientId,\n  ): Promise<boolean | undefined> {\n    const latestBlock = await this.#getLatestBlock(networkClientId);\n\n    if (!latestBlock) {\n      return undefined;\n    }\n\n    return latestBlock.baseFeePerGas !== undefined;\n  }\n\n  /**\n   * Ensures that the provider and block tracker proxies are pointed to the\n   * currently selected network and refreshes the metadata for the\n   */\n  async resetConnection(): Promise<void> {\n    await this.#refreshNetwork(this.state.selectedNetworkClientId);\n  }\n\n  /**\n   * Returns the network configuration that has been filed under the given chain\n   * ID.\n   *\n   * @param chainId - The chain ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByChainId(\n    chainId: Hex,\n  ): NetworkConfiguration | undefined {\n    return this.state.networkConfigurationsByChainId[chainId];\n  }\n\n  /**\n   * Returns the network configuration that contains an RPC endpoint with the\n   * given network client ID.\n   *\n   * @param networkClientId - The network client ID to use as a key.\n   * @returns The network configuration if one exists, or undefined.\n   */\n  getNetworkConfigurationByNetworkClientId(\n    networkClientId: NetworkClientId,\n  ): NetworkConfiguration | undefined {\n    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);\n  }\n\n  /**\n   * Creates and registers network clients for the collection of Infura and\n   * custom RPC endpoints that can be used to make requests for a particular\n   * chain, storing the given configuration object in state for later reference.\n   *\n   * @param fields - The object that describes the new network/chain and lists\n   * the RPC endpoints which front that chain.\n   * @returns The newly added network configuration.\n   * @throws if any part of `fields` would produce invalid state.\n   * @see {@link NetworkConfiguration}\n   */\n  addNetwork(fields: AddNetworkFields): NetworkConfiguration {\n    const { rpcEndpoints: setOfRpcEndpointFields } = fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'add',\n      networkFields: fields,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations = setOfRpcEndpointFields.map(\n      (defaultOrCustomRpcEndpointFields) => {\n        const rpcEndpoint =\n          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom\n            ? {\n                ...defaultOrCustomRpcEndpointFields,\n                networkClientId: uuidV4(),\n              }\n            : defaultOrCustomRpcEndpointFields;\n        return {\n          type: 'add' as const,\n          rpcEndpoint,\n        };\n      },\n    );\n\n    const newNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'add',\n        networkFields: fields,\n        networkConfigurationToPersist: newNetworkConfiguration,\n      });\n    });\n\n    this.messenger.publish(\n      `${controllerName}:networkAdded`,\n      newNetworkConfiguration,\n    );\n\n    return newNetworkConfiguration;\n  }\n\n  /**\n   * Updates the configuration for a previously stored network filed under the\n   * given chain ID, creating + registering new network clients to represent RPC\n   * endpoints that have been added and destroying + unregistering existing\n   * network clients for RPC endpoints that have been removed.\n   *\n   * Note that if `chainId` is changed, then all network clients associated with\n   * that chain will be removed and re-added, even if none of the RPC endpoints\n   * have changed.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @param fields - The object that describes the updates to the network/chain,\n   * including the new set of RPC endpoints which should front that chain.\n   * @param options - Options to provide.\n   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot\n   * remove an RPC endpoint that is being represented by the currently selected\n   * network client. This option allows you to specify another RPC endpoint\n   * (either an existing one or a new one) that should be used to select a new\n   * network instead.\n   * @returns The updated network configuration.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * if any part of `fields` would produce invalid state, etc.\n   * @see {@link NetworkConfiguration}\n   */\n  async updateNetwork(\n    chainId: Hex,\n    fields: UpdateNetworkFields,\n    {\n      replacementSelectedRpcEndpointIndex,\n    }: { replacementSelectedRpcEndpointIndex?: number } = {},\n  ): Promise<NetworkConfiguration> {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Could not update network: Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    const existingChainId = chainId;\n    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =\n      fields;\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    this.#validateNetworkFields({\n      mode: 'update',\n      networkFields: fields,\n      existingNetworkConfiguration,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const networkClientOperations: NetworkClientOperation[] = [];\n\n    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {\n      const existingRpcEndpointForNoop =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            rpcEndpoint.url === newRpcEndpointFields.url &&\n            (rpcEndpoint.networkClientId ===\n              newRpcEndpointFields.networkClientId ||\n              newRpcEndpointFields.networkClientId === undefined)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            (rpcEndpoint.type === RpcEndpointType.Infura &&\n              newRpcEndpointFields.type === RpcEndpointType.Infura) ||\n            (rpcEndpoint.type === newRpcEndpointFields.type &&\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId &&\n              rpcEndpoint.url === newRpcEndpointFields.url)\n          );\n        });\n      const existingRpcEndpointForReplaceWhenChainNotChanged =\n        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {\n          return (\n            rpcEndpoint.type === newRpcEndpointFields.type &&\n            (rpcEndpoint.url === newRpcEndpointFields.url ||\n              rpcEndpoint.networkClientId ===\n                newRpcEndpointFields.networkClientId)\n          );\n        });\n\n      if (\n        newChainId !== existingChainId &&\n        existingRpcEndpointForReplaceWhenChainChanged !== undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,\n          newRpcEndpoint,\n        });\n      } else if (existingRpcEndpointForNoop !== undefined) {\n        let newRpcEndpoint;\n        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {\n          newRpcEndpoint = existingRpcEndpointForNoop;\n        } else {\n          // `networkClientId` shouldn't be missing at this point; if it is,\n          // that's a mistake, so fill it back in\n          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {\n            networkClientId: existingRpcEndpointForNoop.networkClientId,\n          });\n        }\n        networkClientOperations.push({\n          type: 'noop' as const,\n          rpcEndpoint: newRpcEndpoint,\n        });\n      } else if (\n        existingRpcEndpointForReplaceWhenChainNotChanged === undefined\n      ) {\n        const newRpcEndpoint =\n          newRpcEndpointFields.type === RpcEndpointType.Infura\n            ? newRpcEndpointFields\n            : { ...newRpcEndpointFields, networkClientId: uuidV4() };\n        const networkClientOperation = {\n          type: 'add' as const,\n          rpcEndpoint: newRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      } else {\n        let newRpcEndpoint;\n        /* istanbul ignore if */\n        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {\n          // This case can't actually happen. If we're here, it means that some\n          // part of the RPC endpoint changed. But there is no part of an Infura\n          // RPC endpoint that can be changed (as it would immediately make that\n          // RPC endpoint self-inconsistent). This is just here to appease\n          // TypeScript.\n          newRpcEndpoint = newRpcEndpointFields;\n        } else {\n          newRpcEndpoint = {\n            ...newRpcEndpointFields,\n            networkClientId: uuidV4(),\n          };\n        }\n\n        networkClientOperations.push({\n          type: 'replace' as const,\n          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,\n          newRpcEndpoint,\n        });\n      }\n    }\n\n    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n      if (\n        !networkClientOperations.some((networkClientOperation) => {\n          const otherRpcEndpoint =\n            networkClientOperation.type === 'replace'\n              ? networkClientOperation.oldRpcEndpoint\n              : networkClientOperation.rpcEndpoint;\n          return (\n            otherRpcEndpoint.type === existingRpcEndpoint.type &&\n            otherRpcEndpoint.networkClientId ===\n              existingRpcEndpoint.networkClientId &&\n            otherRpcEndpoint.url === existingRpcEndpoint.url\n          );\n        })\n      ) {\n        const networkClientOperation = {\n          type: 'remove' as const,\n          rpcEndpoint: existingRpcEndpoint,\n        };\n        networkClientOperations.push(networkClientOperation);\n      }\n    }\n\n    const updatedNetworkConfiguration =\n      this.#determineNetworkConfigurationToPersist({\n        networkFields: fields,\n        networkClientOperations,\n      });\n\n    if (\n      replacementSelectedRpcEndpointIndex === undefined &&\n      networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'remove' &&\n          networkClientOperation.rpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      }) &&\n      !networkClientOperations.some((networkClientOperation) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      })\n    ) {\n      throw new Error(\n        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \\`replacementSelectedRpcEndpointIndex\\` option.`,\n      );\n    }\n\n    this.#registerNetworkClientsAsNeeded({\n      networkFields: fields,\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    const replacementSelectedRpcEndpointWithIndex = networkClientOperations\n      .map(\n        (networkClientOperation, index) =>\n          [networkClientOperation, index] as const,\n      )\n      .find(([networkClientOperation, _index]) => {\n        return (\n          networkClientOperation.type === 'replace' &&\n          networkClientOperation.oldRpcEndpoint.networkClientId ===\n            this.state.selectedNetworkClientId\n        );\n      });\n    const correctedReplacementSelectedRpcEndpointIndex =\n      replacementSelectedRpcEndpointIndex ??\n      replacementSelectedRpcEndpointWithIndex?.[1];\n\n    let rpcEndpointToSelect: RpcEndpoint | undefined;\n    if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {\n      rpcEndpointToSelect =\n        updatedNetworkConfiguration.rpcEndpoints[\n          correctedReplacementSelectedRpcEndpointIndex\n        ];\n\n      if (rpcEndpointToSelect === undefined) {\n        throw new Error(\n          `Could not update network: \\`replacementSelectedRpcEndpointIndex\\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \\`rpcEndpoints\\``,\n        );\n      }\n    }\n\n    if (\n      rpcEndpointToSelect &&\n      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId\n    ) {\n      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {\n        updateState: (state) => {\n          this.#updateNetworkConfigurations({\n            state,\n            mode: 'update',\n            networkFields: fields,\n            networkConfigurationToPersist: updatedNetworkConfiguration,\n            existingNetworkConfiguration,\n          });\n        },\n      });\n    } else {\n      this.update((state) => {\n        this.#updateNetworkConfigurations({\n          state,\n          mode: 'update',\n          networkFields: fields,\n          networkConfigurationToPersist: updatedNetworkConfiguration,\n          existingNetworkConfiguration,\n        });\n      });\n    }\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n\n    return updatedNetworkConfiguration;\n  }\n\n  /**\n   * Destroys and unregisters the network identified by the given chain ID, also\n   * removing the associated network configuration from state.\n   *\n   * @param chainId - The chain ID associated with an existing network.\n   * @throws if `chainId` does not refer to an existing network configuration,\n   * or if the currently selected network is being removed.\n   * @see {@link NetworkConfiguration}\n   */\n  removeNetwork(chainId: Hex): void {\n    const existingNetworkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (existingNetworkConfiguration === undefined) {\n      throw new Error(\n        `Cannot find network configuration for chain '${chainId}'`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration.rpcEndpoints.some(\n        (rpcEndpoint) =>\n          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,\n      )\n    ) {\n      throw new Error(`Cannot remove the currently selected network`);\n    }\n\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    const networkClientOperations =\n      existingNetworkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        return {\n          type: 'remove' as const,\n          rpcEndpoint,\n        };\n      });\n\n    this.#unregisterNetworkClientsAsNeeded({\n      networkClientOperations,\n      autoManagedNetworkClientRegistry,\n    });\n    this.update((state) => {\n      this.#updateNetworkConfigurations({\n        state,\n        mode: 'remove',\n        existingNetworkConfiguration,\n      });\n\n      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {\n        delete state.networksMetadata[rpcEndpoint.networkClientId];\n      }\n    });\n\n    this.messenger.publish(\n      'NetworkController:networkRemoved',\n      existingNetworkConfiguration,\n    );\n  }\n\n  /**\n   * Assuming that the network has been previously switched, switches to this\n   * new network.\n   *\n   * If the network has not been previously switched, this method is equivalent\n   * to {@link resetConnection}.\n   */\n  async rollbackToPreviousProvider(): Promise<void> {\n    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);\n  }\n\n  /**\n   * Deactivates the controller, stopping any ongoing polling.\n   *\n   * In-progress requests will not be aborted.\n   */\n  // We're intentionally changing the signature of an extended method.\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  async destroy(): Promise<void> {\n    await this.#blockTrackerProxy?.destroy();\n  }\n\n  /**\n   * Merges the given backup data into controller state.\n   *\n   * @param backup - The data that has been backed up.\n   * @param backup.networkConfigurationsByChainId - Network configurations,\n   * keyed by chain ID.\n   */\n  loadBackup({\n    networkConfigurationsByChainId,\n  }: Pick<NetworkState, 'networkConfigurationsByChainId'>): void {\n    this.update((state) => {\n      state.networkConfigurationsByChainId = {\n        ...state.networkConfigurationsByChainId,\n        ...networkConfigurationsByChainId,\n      };\n    });\n  }\n\n  /**\n   * Searches for the default RPC endpoint configured for the given chain and\n   * returns its network client ID. This can then be passed to\n   * {@link getNetworkClientById} to retrieve the network client.\n   *\n   * @param chainId - Chain ID to search for.\n   * @returns The ID of the network client created for the chain's default RPC\n   * endpoint.\n   */\n  findNetworkClientIdByChainId(chainId: Hex): NetworkClientId {\n    const networkConfiguration =\n      this.state.networkConfigurationsByChainId[chainId];\n\n    if (!networkConfiguration) {\n      throw new Error(`Invalid chain ID \"${chainId}\"`);\n    }\n\n    const { networkClientId } =\n      networkConfiguration.rpcEndpoints[\n        networkConfiguration.defaultRpcEndpointIndex\n      ];\n    return networkClientId;\n  }\n\n  /**\n   * Ensure that the given fields which will be used to either add or update a\n   * network are valid.\n   *\n   * @param args - The arguments.\n   */\n  #validateNetworkFields(\n    args: {\n      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n    } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n        }\n      | {\n          mode: 'update';\n          existingNetworkConfiguration: NetworkConfiguration;\n          networkFields: UpdateNetworkFields;\n        }\n    ),\n  ): void {\n    const { mode, networkFields, autoManagedNetworkClientRegistry } = args;\n    const existingNetworkConfiguration =\n      'existingNetworkConfiguration' in args\n        ? args.existingNetworkConfiguration\n        : null;\n\n    const errorMessagePrefix =\n      mode === 'update' ? 'Could not update network' : 'Could not add network';\n\n    if (\n      !isStrictHexString(networkFields.chainId) ||\n      !isSafeChainId(networkFields.chainId)\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Invalid \\`chainId\\` '${networkFields.chainId}' (must start with \"0x\" and not exceed the maximum)`,\n      );\n    }\n\n    if (\n      existingNetworkConfiguration === null ||\n      networkFields.chainId !== existingNetworkConfiguration.chainId\n    ) {\n      const existingNetworkConfigurationViaChainId =\n        this.state.networkConfigurationsByChainId[networkFields.chainId];\n      if (existingNetworkConfigurationViaChainId !== undefined) {\n        if (existingNetworkConfiguration === null) {\n          throw new Error(\n            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        } else {\n          throw new Error(\n            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,\n          );\n        }\n      }\n    }\n\n    const isInvalidDefaultBlockExplorerUrlIndex =\n      networkFields.blockExplorerUrls.length > 0\n        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||\n          networkFields.blockExplorerUrls[\n            networkFields.defaultBlockExplorerUrlIndex\n          ] === undefined\n        : networkFields.defaultBlockExplorerUrlIndex !== undefined;\n\n    if (isInvalidDefaultBlockExplorerUrlIndex) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultBlockExplorerUrlIndex\\` must refer to an entry in \\`blockExplorerUrls\\``,\n      );\n    }\n\n    if (networkFields.rpcEndpoints.length === 0) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`rpcEndpoints\\` must be a non-empty array`,\n      );\n    }\n    for (const rpcEndpointFields of networkFields.rpcEndpoints) {\n      if (!isValidUrl(rpcEndpointFields.url)) {\n        throw new Error(\n          `${errorMessagePrefix}: An entry in \\`rpcEndpoints\\` has invalid URL '${rpcEndpointFields.url}'`,\n        );\n      }\n      const networkClientId =\n        'networkClientId' in rpcEndpointFields\n          ? rpcEndpointFields.networkClientId\n          : undefined;\n\n      if (\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        networkClientId !== undefined &&\n        isInfuraNetworkType(networkClientId)\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,\n        );\n      }\n\n      if (\n        mode === 'update' &&\n        networkClientId !== undefined &&\n        rpcEndpointFields.type === RpcEndpointType.Custom &&\n        !Object.values(autoManagedNetworkClientRegistry).some(\n          (networkClientsById) => networkClientId in networkClientsById,\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,\n        );\n      }\n\n      if (\n        networkFields.rpcEndpoints.some(\n          (otherRpcEndpointFields) =>\n            otherRpcEndpointFields !== rpcEndpointFields &&\n            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),\n        )\n      ) {\n        throw new Error(\n          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,\n        );\n      }\n\n      const networkConfigurationsForOtherChains = Object.values(\n        this.state.networkConfigurationsByChainId,\n      ).filter((networkConfiguration) =>\n        existingNetworkConfiguration\n          ? networkConfiguration.chainId !==\n            existingNetworkConfiguration.chainId\n          : true,\n      );\n      for (const networkConfiguration of networkConfigurationsForOtherChains) {\n        const rpcEndpoint = networkConfiguration.rpcEndpoints.find(\n          (existingRpcEndpoint) =>\n            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),\n        );\n        if (rpcEndpoint) {\n          if (mode === 'update') {\n            throw new Error(\n              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          } else {\n            throw new Error(\n              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,\n            );\n          }\n        }\n      }\n    }\n\n    if (\n      [...new Set(networkFields.rpcEndpoints)].length <\n      networkFields.rpcEndpoints.length\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,\n      );\n    }\n\n    const networkClientIds = networkFields.rpcEndpoints\n      .map((rpcEndpoint) =>\n        'networkClientId' in rpcEndpoint\n          ? rpcEndpoint.networkClientId\n          : undefined,\n      )\n      .filter(\n        (networkClientId): networkClientId is NetworkClientId =>\n          networkClientId !== undefined,\n      );\n    if ([...new Set(networkClientIds)].length < networkClientIds.length) {\n      throw new Error(\n        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,\n      );\n    }\n\n    const infuraRpcEndpoints = networkFields.rpcEndpoints.filter(\n      (rpcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =>\n        rpcEndpointFields.type === RpcEndpointType.Infura,\n    );\n    if (infuraRpcEndpoints.length > 1) {\n      throw new Error(\n        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,\n      );\n    }\n\n    const soleInfuraRpcEndpoint = infuraRpcEndpoints[0];\n    if (soleInfuraRpcEndpoint) {\n      const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n        soleInfuraRpcEndpoint.url,\n      );\n      const infuraNetworkNickname = NetworkNickname[infuraNetworkName];\n      const infuraChainId = ChainId[infuraNetworkName];\n      if (networkFields.chainId !== infuraChainId) {\n        throw new Error(\n          mode === 'add'\n            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`\n            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,\n        );\n      }\n    }\n\n    if (\n      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===\n      undefined\n    ) {\n      throw new Error(\n        `${errorMessagePrefix}: \\`defaultRpcEndpointIndex\\` must refer to an entry in \\`rpcEndpoints\\``,\n      );\n    }\n  }\n\n  /**\n   * Constructs a network configuration that will be persisted to state when\n   * adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Operations which were calculated for\n   * updating the network client registry but which also map back to RPC\n   * endpoints (and so can be used to save those RPC endpoints).\n   * @returns The network configuration to persist.\n   */\n  #determineNetworkConfigurationToPersist({\n    networkFields,\n    networkClientOperations,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n  }): NetworkConfiguration {\n    const rpcEndpointsToPersist = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is\n          | AddNetworkClientOperation\n          | NoopNetworkClientOperation => {\n          return (\n            networkClientOperation.type === 'add' ||\n            networkClientOperation.type === 'noop'\n          );\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };\n  }\n\n  /**\n   * Creates and registers network clients using the given operations calculated\n   * as a part of adding or updating a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkFields - The fields used to add or update a network.\n   * @param args.networkClientOperations - Dictate which network clients need to\n   * be created.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #registerNetworkClientsAsNeeded({\n    networkFields,\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkFields: AddNetworkFields | UpdateNetworkFields;\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const addedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is AddNetworkClientOperation => {\n          return networkClientOperation.type === 'add';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.newRpcEndpoint,\n          ),\n      );\n\n    for (const addedRpcEndpoint of addedRpcEndpoints) {\n      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Infura,\n            chainId: networkFields.chainId,\n            network: addedRpcEndpoint.networkClientId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            infuraProjectId: this.#infuraProjectId,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      } else {\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          addedRpcEndpoint.networkClientId\n        ] = createAutoManagedNetworkClient({\n          networkClientId: addedRpcEndpoint.networkClientId,\n          networkClientConfiguration: {\n            type: NetworkClientType.Custom,\n            chainId: networkFields.chainId,\n            failoverRpcUrls: addedRpcEndpoint.failoverUrls,\n            rpcUrl: addedRpcEndpoint.url,\n            ticker: networkFields.nativeCurrency,\n          },\n          getRpcServiceOptions: this.#getRpcServiceOptions,\n          getBlockTrackerOptions: this.#getBlockTrackerOptions,\n          messenger: this.messenger,\n          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n          logger: this.#log,\n        });\n      }\n    }\n  }\n\n  /**\n   * Destroys and removes network clients using the given operations calculated\n   * as a part of updating or removing a network.\n   *\n   * @param args - The arguments to this function.\n   * @param args.networkClientOperations - Dictate which network clients to\n   * remove.\n   * @param args.autoManagedNetworkClientRegistry - The network client registry\n   * to update.\n   */\n  #unregisterNetworkClientsAsNeeded({\n    networkClientOperations,\n    autoManagedNetworkClientRegistry,\n  }: {\n    networkClientOperations: NetworkClientOperation[];\n    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;\n  }): void {\n    const removedRpcEndpoints = networkClientOperations\n      .filter(\n        (\n          networkClientOperation,\n        ): networkClientOperation is RemoveNetworkClientOperation => {\n          return networkClientOperation.type === 'remove';\n        },\n      )\n      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)\n      .concat(\n        networkClientOperations\n          .filter(\n            (\n              networkClientOperation,\n            ): networkClientOperation is ReplaceNetworkClientOperation => {\n              return networkClientOperation.type === 'replace';\n            },\n          )\n          .map(\n            (networkClientOperation) => networkClientOperation.oldRpcEndpoint,\n          ),\n      );\n\n    for (const rpcEndpoint of removedRpcEndpoints) {\n      const networkClient = this.getNetworkClientById(\n        rpcEndpoint.networkClientId,\n      );\n      networkClient.destroy();\n      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][\n        rpcEndpoint.networkClientId\n      ];\n    }\n  }\n\n  /**\n   * Updates `networkConfigurationsByChainId` in state depending on whether a\n   * network is being added, updated, or removed.\n   *\n   * - The existing network configuration will be removed when a network is\n   * being filed under a different chain or removed.\n   * - A network configuration will be stored when a network is being added or\n   * when a network is being updated.\n   *\n   * @param args - The arguments to this function.\n   */\n  #updateNetworkConfigurations(\n    args: { state: Draft<NetworkState> } & (\n      | {\n          mode: 'add';\n          networkFields: AddNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n        }\n      | {\n          mode: 'update';\n          networkFields: UpdateNetworkFields;\n          networkConfigurationToPersist: NetworkConfiguration;\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n      | {\n          mode: 'remove';\n          existingNetworkConfiguration: NetworkConfiguration;\n        }\n    ),\n  ): void {\n    const { state, mode } = args;\n\n    if (\n      mode === 'remove' ||\n      (mode === 'update' &&\n        args.networkFields.chainId !==\n          args.existingNetworkConfiguration.chainId)\n    ) {\n      delete state.networkConfigurationsByChainId[\n        args.existingNetworkConfiguration.chainId\n      ];\n    }\n\n    if (mode === 'add' || mode === 'update') {\n      if (\n        !deepEqual(\n          state.networkConfigurationsByChainId[args.networkFields.chainId],\n          args.networkConfigurationToPersist,\n        )\n      ) {\n        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();\n      }\n      state.networkConfigurationsByChainId[args.networkFields.chainId] =\n        args.networkConfigurationToPersist;\n    }\n\n    this.#networkConfigurationsByNetworkClientId =\n      buildNetworkConfigurationsByNetworkClientId(\n        cloneDeep(state.networkConfigurationsByChainId),\n      );\n  }\n\n  /**\n   * Before accessing or switching the network, the registry of network clients\n   * needs to be populated. Otherwise, `#applyNetworkSelection` and\n   * `getNetworkClientRegistry` will throw an error. This method checks to see if the\n   * population step has happened yet, and if not, makes it happen.\n   *\n   * @returns The populated network client registry.\n   */\n  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {\n    return (this.#autoManagedNetworkClientRegistry ??=\n      this.#createAutoManagedNetworkClientRegistry());\n  }\n\n  /**\n   * Constructs the registry of network clients based on the set of default\n   * and custom networks in state.\n   *\n   * @returns The network clients keyed by ID.\n   */\n  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {\n    const chainIds = knownKeysOf(this.state.networkConfigurationsByChainId);\n    const networkClientsWithIds = chainIds.flatMap((chainId) => {\n      const networkConfiguration =\n        this.state.networkConfigurationsByChainId[chainId];\n      return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {\n        if (rpcEndpoint.type === RpcEndpointType.Infura) {\n          const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(\n            rpcEndpoint.url,\n          );\n          return [\n            rpcEndpoint.networkClientId,\n            createAutoManagedNetworkClient({\n              networkClientId: rpcEndpoint.networkClientId,\n              networkClientConfiguration: {\n                type: NetworkClientType.Infura,\n                network: infuraNetworkName,\n                failoverRpcUrls: rpcEndpoint.failoverUrls,\n                infuraProjectId: this.#infuraProjectId,\n                chainId: networkConfiguration.chainId,\n                ticker: networkConfiguration.nativeCurrency,\n              },\n              getRpcServiceOptions: this.#getRpcServiceOptions,\n              getBlockTrackerOptions: this.#getBlockTrackerOptions,\n              messenger: this.messenger,\n              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n              logger: this.#log,\n            }),\n          ] as const;\n        }\n        return [\n          rpcEndpoint.networkClientId,\n          createAutoManagedNetworkClient({\n            networkClientId: rpcEndpoint.networkClientId,\n            networkClientConfiguration: {\n              type: NetworkClientType.Custom,\n              chainId: networkConfiguration.chainId,\n              failoverRpcUrls: rpcEndpoint.failoverUrls,\n              rpcUrl: rpcEndpoint.url,\n              ticker: networkConfiguration.nativeCurrency,\n            },\n            getRpcServiceOptions: this.#getRpcServiceOptions,\n            getBlockTrackerOptions: this.#getBlockTrackerOptions,\n            messenger: this.messenger,\n            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,\n            logger: this.#log,\n          }),\n        ] as const;\n      });\n    });\n\n    return networkClientsWithIds.reduce(\n      (\n        obj: {\n          [NetworkClientType.Custom]: Partial<AutoManagedCustomNetworkClientRegistry>;\n          [NetworkClientType.Infura]: Partial<AutoManagedBuiltInNetworkClientRegistry>;\n        },\n        [networkClientId, networkClient],\n      ) => {\n        return {\n          ...obj,\n          [networkClient.configuration.type]: {\n            ...obj[networkClient.configuration.type],\n            [networkClientId]: networkClient,\n          },\n        };\n      },\n      {\n        [NetworkClientType.Custom]: {},\n        [NetworkClientType.Infura]: {},\n      },\n    ) as AutoManagedNetworkClientRegistry;\n  }\n\n  /**\n   * Updates the global provider and block tracker proxies (accessible via\n   * {@link getSelectedNetworkClient}) to point to the same ones within the\n   * given network client, thereby magically switching any consumers using these\n   * proxies to use the new network.\n   *\n   * Also refreshes the EthQuery instance accessible via the `getEthQuery`\n   * action to wrap the provider from the new network client. Note that this is\n   * not a proxy, so consumers will need to call `getEthQuery` again after the\n   * network switch.\n   *\n   * @param networkClientId - The ID of a network client that requests will be\n   * routed through (either the name of an Infura network or the ID of a custom\n   * network configuration).\n   * @param options - Options for this method.\n   * @param options.updateState - Allows for updating state.\n   * @throws if no network client could be found matching the given ID.\n   */\n  #applyNetworkSelection(\n    networkClientId: string,\n    {\n      updateState,\n    }: {\n      updateState?: (state: Draft<NetworkState>) => void;\n    } = {},\n  ): void {\n    const autoManagedNetworkClientRegistry =\n      this.#ensureAutoManagedNetworkClientRegistryPopulated();\n\n    let autoManagedNetworkClient:\n      | AutoManagedNetworkClient<CustomNetworkClientConfiguration>\n      | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;\n\n    if (isInfuraNetworkType(networkClientId)) {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Infura][\n          networkClientId\n        ];\n\n      // This is impossible to reach\n      /* istanbul ignore if */\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(\n          `No Infura network client found with ID '${networkClientId}'`,\n        );\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    } else {\n      const possibleAutoManagedNetworkClient =\n        autoManagedNetworkClientRegistry[NetworkClientType.Custom][\n          networkClientId\n        ];\n\n      if (!possibleAutoManagedNetworkClient) {\n        throw new Error(`No network client found with ID '${networkClientId}'`);\n      }\n\n      autoManagedNetworkClient = possibleAutoManagedNetworkClient;\n    }\n\n    this.#autoManagedNetworkClient = autoManagedNetworkClient;\n\n    this.update((state) => {\n      state.selectedNetworkClientId = networkClientId;\n      state.networksMetadata[networkClientId] ??= {\n        status: NetworkStatus.Unknown,\n        EIPS: {},\n      };\n\n      updateState?.(state);\n    });\n\n    if (this.#providerProxy) {\n      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);\n    } else {\n      this.#providerProxy = createSwappableProxy(\n        this.#autoManagedNetworkClient.provider,\n      );\n    }\n\n    if (this.#blockTrackerProxy) {\n      this.#blockTrackerProxy.setTarget(\n        this.#autoManagedNetworkClient.blockTracker,\n      );\n    } else {\n      this.#blockTrackerProxy = createEventEmitterProxy(\n        this.#autoManagedNetworkClient.blockTracker,\n        {\n          eventFilter: 'skipInternal',\n        },\n      );\n    }\n\n    this.#ethQuery = new EthQuery(this.#providerProxy);\n  }\n}\n"]}
\ No newline at end of file
diff --git a/dist/create-network-client.cjs b/dist/create-network-client.cjs
index 7a640d681f814dc4d5dd0a84ee63b18af183d847..381eb22643dd2d14fc55621a65bc6fa140441dd7 100644
--- a/dist/create-network-client.cjs
+++ b/dist/create-network-client.cjs
@@ -1,6 +1,7 @@
 "use strict";
 Object.defineProperty(exports, "__esModule", { value: true });
 exports.createNetworkClient = void 0;
+const connectivity_controller_1 = require("@metamask/connectivity-controller");
 const controller_utils_1 = require("@metamask/controller-utils");
 const eth_block_tracker_1 = require("@metamask/eth-block-tracker");
 const eth_json_rpc_infura_1 = require("@metamask/eth-json-rpc-infura");
@@ -113,10 +114,15 @@ function createRpcServiceChain({ id, primaryEndpointUrl, configuration, getRpcSe
     const availableEndpointUrls = isRpcFailoverEnabled
         ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]
         : [primaryEndpointUrl];
+    const isOffline = () => {
+        const connectivityState = messenger.call('ConnectivityController:getState');
+        return (connectivityState.connectivityStatus === connectivity_controller_1.CONNECTIVITY_STATUSES.Offline);
+    };
     const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({
         ...getRpcServiceOptions(endpointUrl),
         endpointUrl,
         logger,
+        isOffline,
     }));
     /**
      * Extracts the error from Cockatiel's `FailureReason` type received in
diff --git a/dist/create-network-client.cjs.map b/dist/create-network-client.cjs.map
index 9a7d894024ef24a0dd60e6394c491ae026eb829f..ea08d554dc9b69079b59a131f8842a3ecd0fb80f 100644
--- a/dist/create-network-client.cjs.map
+++ b/dist/create-network-client.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"create-network-client.cjs","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  CockatielFailureReason,\n  InfuraNetworkType,\n} from '@metamask/controller-utils';\nimport { ChainId } from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport { PollingBlockTracker } from '@metamask/eth-block-tracker';\nimport { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';\nimport {\n  createBlockCacheMiddleware,\n  createBlockRefMiddleware,\n  createBlockRefRewriteMiddleware,\n  createBlockTrackerInspectorMiddleware,\n  createInflightCacheMiddleware,\n  createFetchMiddleware,\n  createRetryOnEmptyMiddleware,\n} from '@metamask/eth-json-rpc-middleware';\nimport { InternalProvider } from '@metamask/eth-json-rpc-provider';\nimport { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';\nimport { asV2Middleware } from '@metamask/json-rpc-engine';\nimport {\n  createScaffoldMiddleware,\n  JsonRpcEngineV2,\n} from '@metamask/json-rpc-engine/v2';\nimport type {\n  JsonRpcMiddleware,\n  MiddlewareContext,\n} from '@metamask/json-rpc-engine/v2';\nimport type { Hex, Json, JsonRpcRequest } from '@metamask/utils';\nimport type { Logger } from 'loglevel';\n\nimport type {\n  NetworkClientId,\n  NetworkControllerMessenger,\n} from './NetworkController';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { RpcServiceChain } from './rpc-service/rpc-service-chain';\nimport type {\n  BlockTracker,\n  NetworkClientConfiguration,\n  Provider,\n} from './types';\nimport { NetworkClientType } from './types';\n\nconst SECOND = 1000;\n\n/**\n * The pair of provider / block tracker that can be used to interface with the\n * network and respond to new activity.\n */\nexport type NetworkClient = {\n  configuration: NetworkClientConfiguration;\n  provider: Provider;\n  blockTracker: BlockTracker;\n  destroy: () => void;\n};\n\ntype RpcApiMiddleware = JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string }>\n>;\n\n/**\n * Create a JSON RPC network client for a specific network.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.getBlockTrackerOptions - Factory for constructing block tracker\n * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The network client.\n */\nexport function createNetworkClient({\n  id,\n  configuration,\n  getRpcServiceOptions,\n  getBlockTrackerOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  getBlockTrackerOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): NetworkClient {\n  const primaryEndpointUrl =\n    configuration.type === NetworkClientType.Infura\n      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`\n      : configuration.rpcUrl;\n  const rpcServiceChain = createRpcServiceChain({\n    id,\n    primaryEndpointUrl,\n    configuration,\n    getRpcServiceOptions,\n    messenger,\n    isRpcFailoverEnabled,\n    logger,\n  });\n\n  let rpcApiMiddleware: RpcApiMiddleware;\n  if (configuration.type === NetworkClientType.Infura) {\n    rpcApiMiddleware = asV2Middleware(\n      createInfuraMiddleware({\n        rpcService: rpcServiceChain,\n        options: {\n          source: 'metamask',\n        },\n      }),\n    );\n  } else {\n    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });\n  }\n\n  const rpcProvider = providerFromMiddlewareV2(rpcApiMiddleware);\n\n  const blockTracker = createBlockTracker({\n    networkClientType: configuration.type,\n    endpointUrl: primaryEndpointUrl,\n    getOptions: getBlockTrackerOptions,\n    provider: rpcProvider,\n  });\n\n  const networkMiddleware =\n    configuration.type === NetworkClientType.Infura\n      ? createInfuraNetworkMiddleware({\n          blockTracker,\n          network: configuration.network,\n          rpcProvider,\n          rpcApiMiddleware,\n        })\n      : createCustomNetworkMiddleware({\n          blockTracker,\n          chainId: configuration.chainId,\n          rpcApiMiddleware,\n        });\n\n  const provider: Provider = new InternalProvider({\n    engine: JsonRpcEngineV2.create({\n      middleware: [networkMiddleware],\n    }),\n  });\n\n  const destroy = (): void => {\n    // TODO: Either fix this lint violation or explain why it's necessary to ignore.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    blockTracker.destroy();\n  };\n\n  return { configuration, provider, blockTracker, destroy };\n}\n\n/**\n * Creates an RPC service chain, which represents the primary endpoint URL for\n * the network as well as its failover URLs.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.primaryEndpointUrl - The primary endpoint URL.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The RPC service chain.\n */\nfunction createRpcServiceChain({\n  id,\n  primaryEndpointUrl,\n  configuration,\n  getRpcServiceOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  primaryEndpointUrl: string;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): RpcServiceChain {\n  const availableEndpointUrls: [string, ...string[]] = isRpcFailoverEnabled\n    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]\n    : [primaryEndpointUrl];\n  const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({\n    ...getRpcServiceOptions(endpointUrl),\n    endpointUrl,\n    logger,\n  }));\n\n  /**\n   * Extracts the error from Cockatiel's `FailureReason` type received in\n   * circuit breaker event handlers.\n   *\n   * The `FailureReason` object can have two possible shapes:\n   * - `{ error: Error }` - When the RPC service throws an error (the common\n   * case for RPC failures).\n   * - `{ value: T }` - When the RPC service returns a value that the retry\n   * filter policy considers a failure.\n   *\n   * @param value - The event data object from the circuit breaker event\n   * listener (after destructuring known properties like `endpointUrl`). This\n   * represents Cockatiel's `FailureReason` type.\n   * @returns The error or failure value, or `undefined` if neither property\n   * exists (which shouldn't happen in practice unless the circuit breaker is\n   * manually isolated).\n   */\n  const getError = (\n    value: CockatielFailureReason<unknown> | Record<never, never>,\n  ): Error | unknown | undefined => {\n    if ('error' in value) {\n      return value.error;\n    } else if ('value' in value) {\n      return value.value;\n    }\n    return undefined;\n  };\n\n  const rpcServiceChain = new RpcServiceChain([\n    rpcServiceConfigurations[0],\n    ...rpcServiceConfigurations.slice(1),\n  ]);\n\n  rpcServiceChain.onBreak((data) => {\n    const error = getError(data);\n\n    if (error === undefined) {\n      // This error shouldn't happen in practice because we never call `.isolate`\n      // on the circuit breaker policy, but we need to appease TypeScript.\n      throw new Error('Could not make request to endpoint.');\n    }\n\n    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceBreak(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n\n      if (error === undefined) {\n        // This error shouldn't happen in practice because we never call `.isolate`\n        // on the circuit breaker policy, but we need to appease TypeScript.\n        throw new Error('Could not make request to endpoint.');\n      }\n\n      messenger.publish('NetworkController:rpcEndpointUnavailable', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onDegraded((data) => {\n    const error = getError(data);\n    messenger.publish('NetworkController:rpcEndpointChainDegraded', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceDegraded(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n      messenger.publish('NetworkController:rpcEndpointDegraded', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onAvailable(() => {\n    messenger.publish('NetworkController:rpcEndpointChainAvailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n    });\n  });\n\n  rpcServiceChain.onServiceRetry(\n    ({\n      attempt,\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n    }) => {\n      messenger.publish('NetworkController:rpcEndpointRetried', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        attempt,\n      });\n    },\n  );\n\n  return rpcServiceChain;\n}\n\n/**\n * Create the block tracker for the network.\n *\n * @param args - The arguments.\n * @param args.networkClientType - The type of the network client (\"infura\" or\n * \"custom\").\n * @param args.endpointUrl - The URL of the endpoint.\n * @param args.getOptions - Factory for the block tracker options.\n * @param args.provider - The EIP-1193 provider for the network's JSON-RPC\n * middleware stack.\n * @returns The created block tracker.\n */\nfunction createBlockTracker({\n  networkClientType,\n  endpointUrl,\n  getOptions,\n  provider,\n}: {\n  networkClientType: NetworkClientType;\n  endpointUrl: string;\n  getOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  provider: InternalProvider;\n}): PollingBlockTracker {\n  const testOptions =\n    // Needed for testing.\n    // eslint-disable-next-line no-restricted-globals\n    process.env.IN_TEST && networkClientType === NetworkClientType.Custom\n      ? { pollingInterval: SECOND }\n      : {};\n\n  return new PollingBlockTracker({\n    ...testOptions,\n    ...getOptions(endpointUrl),\n    provider,\n  });\n}\n\n/**\n * Create middleware for infura.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.network - The Infura network to use.\n * @param args.rpcProvider - The RPC provider to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createInfuraNetworkMiddleware({\n  blockTracker,\n  network,\n  rpcProvider,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  network: InfuraNetworkType;\n  rpcProvider: InternalProvider;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  return JsonRpcEngineV2.create({\n    middleware: [\n      createNetworkAndChainIdMiddleware({ network }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),\n      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * Creates static method middleware.\n *\n * @param args - The Arguments.\n * @param args.network - The Infura network to use.\n * @returns The middleware that implements the eth_chainId method.\n */\nfunction createNetworkAndChainIdMiddleware({\n  network,\n}: {\n  network: InfuraNetworkType;\n}): JsonRpcMiddleware<JsonRpcRequest> {\n  return createScaffoldMiddleware({\n    eth_chainId: ChainId[network],\n  });\n}\n\nconst createChainIdMiddleware = (\n  chainId: Hex,\n): JsonRpcMiddleware<JsonRpcRequest, Json> => {\n  return ({ request, next }) => {\n    if (request.method === 'eth_chainId') {\n      return chainId;\n    }\n    return next();\n  };\n};\n\n/**\n * Creates custom middleware.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.chainId - The chain id to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createCustomNetworkMiddleware({\n  blockTracker,\n  chainId,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  chainId: Hex;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  // Needed for testing.\n  // eslint-disable-next-line no-restricted-globals\n  const testMiddlewares = process.env.IN_TEST\n    ? [createEstimateGasDelayTestMiddleware()]\n    : [];\n\n  return JsonRpcEngineV2.create({\n    middleware: [\n      ...testMiddlewares,\n      createChainIdMiddleware(chainId),\n      createBlockRefRewriteMiddleware({ blockTracker }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * For use in tests only.\n * Adds a delay to `eth_estimateGas` calls.\n *\n * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.\n */\nfunction createEstimateGasDelayTestMiddleware(): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json\n> {\n  return async ({ request, next }) => {\n    if (request.method === 'eth_estimateGas') {\n      await new Promise((resolve) => setTimeout(resolve, SECOND * 2));\n    }\n    return next();\n  };\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"create-network-client.cjs","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"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","sourcesContent":["import { CONNECTIVITY_STATUSES } from '@metamask/connectivity-controller';\nimport type {\n  CockatielFailureReason,\n  InfuraNetworkType,\n} from '@metamask/controller-utils';\nimport { ChainId } from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport { PollingBlockTracker } from '@metamask/eth-block-tracker';\nimport { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';\nimport {\n  createBlockCacheMiddleware,\n  createBlockRefMiddleware,\n  createBlockRefRewriteMiddleware,\n  createBlockTrackerInspectorMiddleware,\n  createInflightCacheMiddleware,\n  createFetchMiddleware,\n  createRetryOnEmptyMiddleware,\n} from '@metamask/eth-json-rpc-middleware';\nimport { InternalProvider } from '@metamask/eth-json-rpc-provider';\nimport { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';\nimport { asV2Middleware } from '@metamask/json-rpc-engine';\nimport {\n  createScaffoldMiddleware,\n  JsonRpcEngineV2,\n} from '@metamask/json-rpc-engine/v2';\nimport type {\n  JsonRpcMiddleware,\n  MiddlewareContext,\n} from '@metamask/json-rpc-engine/v2';\nimport type { Hex, Json, JsonRpcRequest } from '@metamask/utils';\nimport type { Logger } from 'loglevel';\n\nimport type {\n  NetworkClientId,\n  NetworkControllerMessenger,\n} from './NetworkController';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { RpcServiceChain } from './rpc-service/rpc-service-chain';\nimport type {\n  BlockTracker,\n  NetworkClientConfiguration,\n  Provider,\n} from './types';\nimport { NetworkClientType } from './types';\n\nconst SECOND = 1000;\n\n/**\n * The pair of provider / block tracker that can be used to interface with the\n * network and respond to new activity.\n */\nexport type NetworkClient = {\n  configuration: NetworkClientConfiguration;\n  provider: Provider;\n  blockTracker: BlockTracker;\n  destroy: () => void;\n};\n\ntype RpcApiMiddleware = JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string }>\n>;\n\n/**\n * Create a JSON RPC network client for a specific network.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.getBlockTrackerOptions - Factory for constructing block tracker\n * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The network client.\n */\nexport function createNetworkClient({\n  id,\n  configuration,\n  getRpcServiceOptions,\n  getBlockTrackerOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  getBlockTrackerOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): NetworkClient {\n  const primaryEndpointUrl =\n    configuration.type === NetworkClientType.Infura\n      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`\n      : configuration.rpcUrl;\n  const rpcServiceChain = createRpcServiceChain({\n    id,\n    primaryEndpointUrl,\n    configuration,\n    getRpcServiceOptions,\n    messenger,\n    isRpcFailoverEnabled,\n    logger,\n  });\n\n  let rpcApiMiddleware: RpcApiMiddleware;\n  if (configuration.type === NetworkClientType.Infura) {\n    rpcApiMiddleware = asV2Middleware(\n      createInfuraMiddleware({\n        rpcService: rpcServiceChain,\n        options: {\n          source: 'metamask',\n        },\n      }),\n    );\n  } else {\n    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });\n  }\n\n  const rpcProvider = providerFromMiddlewareV2(rpcApiMiddleware);\n\n  const blockTracker = createBlockTracker({\n    networkClientType: configuration.type,\n    endpointUrl: primaryEndpointUrl,\n    getOptions: getBlockTrackerOptions,\n    provider: rpcProvider,\n  });\n\n  const networkMiddleware =\n    configuration.type === NetworkClientType.Infura\n      ? createInfuraNetworkMiddleware({\n          blockTracker,\n          network: configuration.network,\n          rpcProvider,\n          rpcApiMiddleware,\n        })\n      : createCustomNetworkMiddleware({\n          blockTracker,\n          chainId: configuration.chainId,\n          rpcApiMiddleware,\n        });\n\n  const provider: Provider = new InternalProvider({\n    engine: JsonRpcEngineV2.create({\n      middleware: [networkMiddleware],\n    }),\n  });\n\n  const destroy = (): void => {\n    // TODO: Either fix this lint violation or explain why it's necessary to ignore.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    blockTracker.destroy();\n  };\n\n  return { configuration, provider, blockTracker, destroy };\n}\n\n/**\n * Creates an RPC service chain, which represents the primary endpoint URL for\n * the network as well as its failover URLs.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.primaryEndpointUrl - The primary endpoint URL.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The RPC service chain.\n */\nfunction createRpcServiceChain({\n  id,\n  primaryEndpointUrl,\n  configuration,\n  getRpcServiceOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  primaryEndpointUrl: string;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): RpcServiceChain {\n  const availableEndpointUrls: [string, ...string[]] = isRpcFailoverEnabled\n    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]\n    : [primaryEndpointUrl];\n\n  const isOffline = (): boolean => {\n    const connectivityState = messenger.call('ConnectivityController:getState');\n    return (\n      connectivityState.connectivityStatus === CONNECTIVITY_STATUSES.Offline\n    );\n  };\n\n  const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({\n    ...getRpcServiceOptions(endpointUrl),\n    endpointUrl,\n    logger,\n    isOffline,\n  }));\n\n  /**\n   * Extracts the error from Cockatiel's `FailureReason` type received in\n   * circuit breaker event handlers.\n   *\n   * The `FailureReason` object can have two possible shapes:\n   * - `{ error: Error }` - When the RPC service throws an error (the common\n   * case for RPC failures).\n   * - `{ value: T }` - When the RPC service returns a value that the retry\n   * filter policy considers a failure.\n   *\n   * @param value - The event data object from the circuit breaker event\n   * listener (after destructuring known properties like `endpointUrl`). This\n   * represents Cockatiel's `FailureReason` type.\n   * @returns The error or failure value, or `undefined` if neither property\n   * exists (which shouldn't happen in practice unless the circuit breaker is\n   * manually isolated).\n   */\n  const getError = (\n    value: CockatielFailureReason<unknown> | Record<never, never>,\n  ): Error | unknown | undefined => {\n    if ('error' in value) {\n      return value.error;\n    } else if ('value' in value) {\n      return value.value;\n    }\n    return undefined;\n  };\n\n  const rpcServiceChain = new RpcServiceChain([\n    rpcServiceConfigurations[0],\n    ...rpcServiceConfigurations.slice(1),\n  ]);\n\n  rpcServiceChain.onBreak((data) => {\n    const error = getError(data);\n\n    if (error === undefined) {\n      // This error shouldn't happen in practice because we never call `.isolate`\n      // on the circuit breaker policy, but we need to appease TypeScript.\n      throw new Error('Could not make request to endpoint.');\n    }\n\n    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceBreak(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n\n      if (error === undefined) {\n        // This error shouldn't happen in practice because we never call `.isolate`\n        // on the circuit breaker policy, but we need to appease TypeScript.\n        throw new Error('Could not make request to endpoint.');\n      }\n\n      messenger.publish('NetworkController:rpcEndpointUnavailable', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onDegraded((data) => {\n    const error = getError(data);\n    messenger.publish('NetworkController:rpcEndpointChainDegraded', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceDegraded(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n\n      messenger.publish('NetworkController:rpcEndpointDegraded', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onAvailable(() => {\n    messenger.publish('NetworkController:rpcEndpointChainAvailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n    });\n  });\n\n  rpcServiceChain.onServiceRetry(\n    ({\n      attempt,\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n    }) => {\n      messenger.publish('NetworkController:rpcEndpointRetried', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        attempt,\n      });\n    },\n  );\n\n  return rpcServiceChain;\n}\n\n/**\n * Create the block tracker for the network.\n *\n * @param args - The arguments.\n * @param args.networkClientType - The type of the network client (\"infura\" or\n * \"custom\").\n * @param args.endpointUrl - The URL of the endpoint.\n * @param args.getOptions - Factory for the block tracker options.\n * @param args.provider - The EIP-1193 provider for the network's JSON-RPC\n * middleware stack.\n * @returns The created block tracker.\n */\nfunction createBlockTracker({\n  networkClientType,\n  endpointUrl,\n  getOptions,\n  provider,\n}: {\n  networkClientType: NetworkClientType;\n  endpointUrl: string;\n  getOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  provider: InternalProvider;\n}): PollingBlockTracker {\n  const testOptions =\n    // Needed for testing.\n    // eslint-disable-next-line no-restricted-globals\n    process.env.IN_TEST && networkClientType === NetworkClientType.Custom\n      ? { pollingInterval: SECOND }\n      : {};\n\n  return new PollingBlockTracker({\n    ...testOptions,\n    ...getOptions(endpointUrl),\n    provider,\n  });\n}\n\n/**\n * Create middleware for infura.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.network - The Infura network to use.\n * @param args.rpcProvider - The RPC provider to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createInfuraNetworkMiddleware({\n  blockTracker,\n  network,\n  rpcProvider,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  network: InfuraNetworkType;\n  rpcProvider: InternalProvider;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  return JsonRpcEngineV2.create({\n    middleware: [\n      createNetworkAndChainIdMiddleware({ network }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),\n      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * Creates static method middleware.\n *\n * @param args - The Arguments.\n * @param args.network - The Infura network to use.\n * @returns The middleware that implements the eth_chainId method.\n */\nfunction createNetworkAndChainIdMiddleware({\n  network,\n}: {\n  network: InfuraNetworkType;\n}): JsonRpcMiddleware<JsonRpcRequest> {\n  return createScaffoldMiddleware({\n    eth_chainId: ChainId[network],\n  });\n}\n\nconst createChainIdMiddleware = (\n  chainId: Hex,\n): JsonRpcMiddleware<JsonRpcRequest, Json> => {\n  return ({ request, next }) => {\n    if (request.method === 'eth_chainId') {\n      return chainId;\n    }\n    return next();\n  };\n};\n\n/**\n * Creates custom middleware.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.chainId - The chain id to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createCustomNetworkMiddleware({\n  blockTracker,\n  chainId,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  chainId: Hex;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  // Needed for testing.\n  // eslint-disable-next-line no-restricted-globals\n  const testMiddlewares = process.env.IN_TEST\n    ? [createEstimateGasDelayTestMiddleware()]\n    : [];\n\n  return JsonRpcEngineV2.create({\n    middleware: [\n      ...testMiddlewares,\n      createChainIdMiddleware(chainId),\n      createBlockRefRewriteMiddleware({ blockTracker }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * For use in tests only.\n * Adds a delay to `eth_estimateGas` calls.\n *\n * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.\n */\nfunction createEstimateGasDelayTestMiddleware(): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json\n> {\n  return async ({ request, next }) => {\n    if (request.method === 'eth_estimateGas') {\n      await new Promise((resolve) => setTimeout(resolve, SECOND * 2));\n    }\n    return next();\n  };\n}\n"]}
\ No newline at end of file
diff --git a/dist/create-network-client.d.cts.map b/dist/create-network-client.d.cts.map
index cf8a8c190da7b0f0208ce2ba9bcc95890a56b8ee..39d53e116ad5f6e162f3c8495da59d32eca5637c 100644
--- a/dist/create-network-client.d.cts.map
+++ b/dist/create-network-client.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"create-network-client.d.cts","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,EAAE,0BAA0B,EAAE,oCAAoC;AAwB9E,OAAO,KAAK,EAAE,MAAM,EAAE,iBAAiB;AAEvC,OAAO,KAAK,EACV,eAAe,EACf,0BAA0B,EAC3B,gCAA4B;AAC7B,OAAO,KAAK,EAAE,iBAAiB,EAAE,sCAAkC;AAEnE,OAAO,KAAK,EACV,YAAY,EACZ,0BAA0B,EAC1B,QAAQ,EACT,oBAAgB;AAKjB;;;GAGG;AACH,MAAM,MAAM,aAAa,GAAG;IAC1B,aAAa,EAAE,0BAA0B,CAAC;IAC1C,QAAQ,EAAE,QAAQ,CAAC;IACnB,YAAY,EAAE,YAAY,CAAC;IAC3B,OAAO,EAAE,MAAM,IAAI,CAAC;CACrB,CAAC;AAQF;;;;;;;;;;;;;;;;;;;GAmBG;AACH,wBAAgB,mBAAmB,CAAC,EAClC,EAAE,EACF,aAAa,EACb,oBAAoB,EACpB,sBAAsB,EACtB,SAAS,EACT,oBAAoB,EACpB,MAAM,GACP,EAAE;IACD,EAAE,EAAE,eAAe,CAAC;IACpB,aAAa,EAAE,0BAA0B,CAAC;IAC1C,oBAAoB,EAAE,CACpB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,iBAAiB,EAAE,iBAAiB,GAAG,aAAa,CAAC,CAAC;IAChE,sBAAsB,EAAE,CACtB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,0BAA0B,EAAE,UAAU,CAAC,CAAC;IAClD,SAAS,EAAE,0BAA0B,CAAC;IACtC,oBAAoB,EAAE,OAAO,CAAC;IAC9B,MAAM,CAAC,EAAE,MAAM,CAAC;CACjB,GAAG,aAAa,CAiEhB"}
\ No newline at end of file
+{"version":3,"file":"create-network-client.d.cts","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"AAMA,OAAO,KAAK,EAAE,0BAA0B,EAAE,oCAAoC;AAwB9E,OAAO,KAAK,EAAE,MAAM,EAAE,iBAAiB;AAEvC,OAAO,KAAK,EACV,eAAe,EACf,0BAA0B,EAC3B,gCAA4B;AAC7B,OAAO,KAAK,EAAE,iBAAiB,EAAE,sCAAkC;AAEnE,OAAO,KAAK,EACV,YAAY,EACZ,0BAA0B,EAC1B,QAAQ,EACT,oBAAgB;AAKjB;;;GAGG;AACH,MAAM,MAAM,aAAa,GAAG;IAC1B,aAAa,EAAE,0BAA0B,CAAC;IAC1C,QAAQ,EAAE,QAAQ,CAAC;IACnB,YAAY,EAAE,YAAY,CAAC;IAC3B,OAAO,EAAE,MAAM,IAAI,CAAC;CACrB,CAAC;AAQF;;;;;;;;;;;;;;;;;;;GAmBG;AACH,wBAAgB,mBAAmB,CAAC,EAClC,EAAE,EACF,aAAa,EACb,oBAAoB,EACpB,sBAAsB,EACtB,SAAS,EACT,oBAAoB,EACpB,MAAM,GACP,EAAE;IACD,EAAE,EAAE,eAAe,CAAC;IACpB,aAAa,EAAE,0BAA0B,CAAC;IAC1C,oBAAoB,EAAE,CACpB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,iBAAiB,EAAE,iBAAiB,GAAG,aAAa,CAAC,CAAC;IAChE,sBAAsB,EAAE,CACtB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,0BAA0B,EAAE,UAAU,CAAC,CAAC;IAClD,SAAS,EAAE,0BAA0B,CAAC;IACtC,oBAAoB,EAAE,OAAO,CAAC;IAC9B,MAAM,CAAC,EAAE,MAAM,CAAC;CACjB,GAAG,aAAa,CAiEhB"}
\ No newline at end of file
diff --git a/dist/create-network-client.d.mts.map b/dist/create-network-client.d.mts.map
index 85b897be53f80a49bd20a8202bcdbb4f18d37437..e11b5b8813f7efa69361c238310c7ff4803bac46 100644
--- a/dist/create-network-client.d.mts.map
+++ b/dist/create-network-client.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"create-network-client.d.mts","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,EAAE,0BAA0B,EAAE,oCAAoC;AAwB9E,OAAO,KAAK,EAAE,MAAM,EAAE,iBAAiB;AAEvC,OAAO,KAAK,EACV,eAAe,EACf,0BAA0B,EAC3B,gCAA4B;AAC7B,OAAO,KAAK,EAAE,iBAAiB,EAAE,sCAAkC;AAEnE,OAAO,KAAK,EACV,YAAY,EACZ,0BAA0B,EAC1B,QAAQ,EACT,oBAAgB;AAKjB;;;GAGG;AACH,MAAM,MAAM,aAAa,GAAG;IAC1B,aAAa,EAAE,0BAA0B,CAAC;IAC1C,QAAQ,EAAE,QAAQ,CAAC;IACnB,YAAY,EAAE,YAAY,CAAC;IAC3B,OAAO,EAAE,MAAM,IAAI,CAAC;CACrB,CAAC;AAQF;;;;;;;;;;;;;;;;;;;GAmBG;AACH,wBAAgB,mBAAmB,CAAC,EAClC,EAAE,EACF,aAAa,EACb,oBAAoB,EACpB,sBAAsB,EACtB,SAAS,EACT,oBAAoB,EACpB,MAAM,GACP,EAAE;IACD,EAAE,EAAE,eAAe,CAAC;IACpB,aAAa,EAAE,0BAA0B,CAAC;IAC1C,oBAAoB,EAAE,CACpB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,iBAAiB,EAAE,iBAAiB,GAAG,aAAa,CAAC,CAAC;IAChE,sBAAsB,EAAE,CACtB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,0BAA0B,EAAE,UAAU,CAAC,CAAC;IAClD,SAAS,EAAE,0BAA0B,CAAC;IACtC,oBAAoB,EAAE,OAAO,CAAC;IAC9B,MAAM,CAAC,EAAE,MAAM,CAAC;CACjB,GAAG,aAAa,CAiEhB"}
\ No newline at end of file
+{"version":3,"file":"create-network-client.d.mts","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"AAMA,OAAO,KAAK,EAAE,0BAA0B,EAAE,oCAAoC;AAwB9E,OAAO,KAAK,EAAE,MAAM,EAAE,iBAAiB;AAEvC,OAAO,KAAK,EACV,eAAe,EACf,0BAA0B,EAC3B,gCAA4B;AAC7B,OAAO,KAAK,EAAE,iBAAiB,EAAE,sCAAkC;AAEnE,OAAO,KAAK,EACV,YAAY,EACZ,0BAA0B,EAC1B,QAAQ,EACT,oBAAgB;AAKjB;;;GAGG;AACH,MAAM,MAAM,aAAa,GAAG;IAC1B,aAAa,EAAE,0BAA0B,CAAC;IAC1C,QAAQ,EAAE,QAAQ,CAAC;IACnB,YAAY,EAAE,YAAY,CAAC;IAC3B,OAAO,EAAE,MAAM,IAAI,CAAC;CACrB,CAAC;AAQF;;;;;;;;;;;;;;;;;;;GAmBG;AACH,wBAAgB,mBAAmB,CAAC,EAClC,EAAE,EACF,aAAa,EACb,oBAAoB,EACpB,sBAAsB,EACtB,SAAS,EACT,oBAAoB,EACpB,MAAM,GACP,EAAE;IACD,EAAE,EAAE,eAAe,CAAC;IACpB,aAAa,EAAE,0BAA0B,CAAC;IAC1C,oBAAoB,EAAE,CACpB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,iBAAiB,EAAE,iBAAiB,GAAG,aAAa,CAAC,CAAC;IAChE,sBAAsB,EAAE,CACtB,cAAc,EAAE,MAAM,KACnB,IAAI,CAAC,0BAA0B,EAAE,UAAU,CAAC,CAAC;IAClD,SAAS,EAAE,0BAA0B,CAAC;IACtC,oBAAoB,EAAE,OAAO,CAAC;IAC9B,MAAM,CAAC,EAAE,MAAM,CAAC;CACjB,GAAG,aAAa,CAiEhB"}
\ No newline at end of file
diff --git a/dist/create-network-client.mjs b/dist/create-network-client.mjs
index 50ee224b853f4aef1af3ba8f84b5dca56abbbfe7..d125d3e9f19e22f5e53adfb1305e2f4cb1d6dae8 100644
--- a/dist/create-network-client.mjs
+++ b/dist/create-network-client.mjs
@@ -1,3 +1,4 @@
+import { CONNECTIVITY_STATUSES } from "@metamask/connectivity-controller";
 import { ChainId } from "@metamask/controller-utils";
 import { PollingBlockTracker } from "@metamask/eth-block-tracker";
 import { createInfuraMiddleware } from "@metamask/eth-json-rpc-infura";
@@ -109,10 +110,15 @@ function createRpcServiceChain({ id, primaryEndpointUrl, configuration, getRpcSe
     const availableEndpointUrls = isRpcFailoverEnabled
         ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]
         : [primaryEndpointUrl];
+    const isOffline = () => {
+        const connectivityState = messenger.call('ConnectivityController:getState');
+        return (connectivityState.connectivityStatus === CONNECTIVITY_STATUSES.Offline);
+    };
     const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({
         ...getRpcServiceOptions(endpointUrl),
         endpointUrl,
         logger,
+        isOffline,
     }));
     /**
      * Extracts the error from Cockatiel's `FailureReason` type received in
diff --git a/dist/create-network-client.mjs.map b/dist/create-network-client.mjs.map
index 46a5c3bfcbbdc757f70305f6de279dac88962dad..c4d35964f7b3a7c60715f3e57c4ef0bfc12de54d 100644
--- a/dist/create-network-client.mjs.map
+++ b/dist/create-network-client.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"create-network-client.mjs","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  CockatielFailureReason,\n  InfuraNetworkType,\n} from '@metamask/controller-utils';\nimport { ChainId } from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport { PollingBlockTracker } from '@metamask/eth-block-tracker';\nimport { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';\nimport {\n  createBlockCacheMiddleware,\n  createBlockRefMiddleware,\n  createBlockRefRewriteMiddleware,\n  createBlockTrackerInspectorMiddleware,\n  createInflightCacheMiddleware,\n  createFetchMiddleware,\n  createRetryOnEmptyMiddleware,\n} from '@metamask/eth-json-rpc-middleware';\nimport { InternalProvider } from '@metamask/eth-json-rpc-provider';\nimport { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';\nimport { asV2Middleware } from '@metamask/json-rpc-engine';\nimport {\n  createScaffoldMiddleware,\n  JsonRpcEngineV2,\n} from '@metamask/json-rpc-engine/v2';\nimport type {\n  JsonRpcMiddleware,\n  MiddlewareContext,\n} from '@metamask/json-rpc-engine/v2';\nimport type { Hex, Json, JsonRpcRequest } from '@metamask/utils';\nimport type { Logger } from 'loglevel';\n\nimport type {\n  NetworkClientId,\n  NetworkControllerMessenger,\n} from './NetworkController';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { RpcServiceChain } from './rpc-service/rpc-service-chain';\nimport type {\n  BlockTracker,\n  NetworkClientConfiguration,\n  Provider,\n} from './types';\nimport { NetworkClientType } from './types';\n\nconst SECOND = 1000;\n\n/**\n * The pair of provider / block tracker that can be used to interface with the\n * network and respond to new activity.\n */\nexport type NetworkClient = {\n  configuration: NetworkClientConfiguration;\n  provider: Provider;\n  blockTracker: BlockTracker;\n  destroy: () => void;\n};\n\ntype RpcApiMiddleware = JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string }>\n>;\n\n/**\n * Create a JSON RPC network client for a specific network.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.getBlockTrackerOptions - Factory for constructing block tracker\n * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The network client.\n */\nexport function createNetworkClient({\n  id,\n  configuration,\n  getRpcServiceOptions,\n  getBlockTrackerOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  getBlockTrackerOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): NetworkClient {\n  const primaryEndpointUrl =\n    configuration.type === NetworkClientType.Infura\n      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`\n      : configuration.rpcUrl;\n  const rpcServiceChain = createRpcServiceChain({\n    id,\n    primaryEndpointUrl,\n    configuration,\n    getRpcServiceOptions,\n    messenger,\n    isRpcFailoverEnabled,\n    logger,\n  });\n\n  let rpcApiMiddleware: RpcApiMiddleware;\n  if (configuration.type === NetworkClientType.Infura) {\n    rpcApiMiddleware = asV2Middleware(\n      createInfuraMiddleware({\n        rpcService: rpcServiceChain,\n        options: {\n          source: 'metamask',\n        },\n      }),\n    );\n  } else {\n    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });\n  }\n\n  const rpcProvider = providerFromMiddlewareV2(rpcApiMiddleware);\n\n  const blockTracker = createBlockTracker({\n    networkClientType: configuration.type,\n    endpointUrl: primaryEndpointUrl,\n    getOptions: getBlockTrackerOptions,\n    provider: rpcProvider,\n  });\n\n  const networkMiddleware =\n    configuration.type === NetworkClientType.Infura\n      ? createInfuraNetworkMiddleware({\n          blockTracker,\n          network: configuration.network,\n          rpcProvider,\n          rpcApiMiddleware,\n        })\n      : createCustomNetworkMiddleware({\n          blockTracker,\n          chainId: configuration.chainId,\n          rpcApiMiddleware,\n        });\n\n  const provider: Provider = new InternalProvider({\n    engine: JsonRpcEngineV2.create({\n      middleware: [networkMiddleware],\n    }),\n  });\n\n  const destroy = (): void => {\n    // TODO: Either fix this lint violation or explain why it's necessary to ignore.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    blockTracker.destroy();\n  };\n\n  return { configuration, provider, blockTracker, destroy };\n}\n\n/**\n * Creates an RPC service chain, which represents the primary endpoint URL for\n * the network as well as its failover URLs.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.primaryEndpointUrl - The primary endpoint URL.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The RPC service chain.\n */\nfunction createRpcServiceChain({\n  id,\n  primaryEndpointUrl,\n  configuration,\n  getRpcServiceOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  primaryEndpointUrl: string;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): RpcServiceChain {\n  const availableEndpointUrls: [string, ...string[]] = isRpcFailoverEnabled\n    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]\n    : [primaryEndpointUrl];\n  const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({\n    ...getRpcServiceOptions(endpointUrl),\n    endpointUrl,\n    logger,\n  }));\n\n  /**\n   * Extracts the error from Cockatiel's `FailureReason` type received in\n   * circuit breaker event handlers.\n   *\n   * The `FailureReason` object can have two possible shapes:\n   * - `{ error: Error }` - When the RPC service throws an error (the common\n   * case for RPC failures).\n   * - `{ value: T }` - When the RPC service returns a value that the retry\n   * filter policy considers a failure.\n   *\n   * @param value - The event data object from the circuit breaker event\n   * listener (after destructuring known properties like `endpointUrl`). This\n   * represents Cockatiel's `FailureReason` type.\n   * @returns The error or failure value, or `undefined` if neither property\n   * exists (which shouldn't happen in practice unless the circuit breaker is\n   * manually isolated).\n   */\n  const getError = (\n    value: CockatielFailureReason<unknown> | Record<never, never>,\n  ): Error | unknown | undefined => {\n    if ('error' in value) {\n      return value.error;\n    } else if ('value' in value) {\n      return value.value;\n    }\n    return undefined;\n  };\n\n  const rpcServiceChain = new RpcServiceChain([\n    rpcServiceConfigurations[0],\n    ...rpcServiceConfigurations.slice(1),\n  ]);\n\n  rpcServiceChain.onBreak((data) => {\n    const error = getError(data);\n\n    if (error === undefined) {\n      // This error shouldn't happen in practice because we never call `.isolate`\n      // on the circuit breaker policy, but we need to appease TypeScript.\n      throw new Error('Could not make request to endpoint.');\n    }\n\n    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceBreak(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n\n      if (error === undefined) {\n        // This error shouldn't happen in practice because we never call `.isolate`\n        // on the circuit breaker policy, but we need to appease TypeScript.\n        throw new Error('Could not make request to endpoint.');\n      }\n\n      messenger.publish('NetworkController:rpcEndpointUnavailable', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onDegraded((data) => {\n    const error = getError(data);\n    messenger.publish('NetworkController:rpcEndpointChainDegraded', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceDegraded(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n      messenger.publish('NetworkController:rpcEndpointDegraded', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onAvailable(() => {\n    messenger.publish('NetworkController:rpcEndpointChainAvailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n    });\n  });\n\n  rpcServiceChain.onServiceRetry(\n    ({\n      attempt,\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n    }) => {\n      messenger.publish('NetworkController:rpcEndpointRetried', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        attempt,\n      });\n    },\n  );\n\n  return rpcServiceChain;\n}\n\n/**\n * Create the block tracker for the network.\n *\n * @param args - The arguments.\n * @param args.networkClientType - The type of the network client (\"infura\" or\n * \"custom\").\n * @param args.endpointUrl - The URL of the endpoint.\n * @param args.getOptions - Factory for the block tracker options.\n * @param args.provider - The EIP-1193 provider for the network's JSON-RPC\n * middleware stack.\n * @returns The created block tracker.\n */\nfunction createBlockTracker({\n  networkClientType,\n  endpointUrl,\n  getOptions,\n  provider,\n}: {\n  networkClientType: NetworkClientType;\n  endpointUrl: string;\n  getOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  provider: InternalProvider;\n}): PollingBlockTracker {\n  const testOptions =\n    // Needed for testing.\n    // eslint-disable-next-line no-restricted-globals\n    process.env.IN_TEST && networkClientType === NetworkClientType.Custom\n      ? { pollingInterval: SECOND }\n      : {};\n\n  return new PollingBlockTracker({\n    ...testOptions,\n    ...getOptions(endpointUrl),\n    provider,\n  });\n}\n\n/**\n * Create middleware for infura.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.network - The Infura network to use.\n * @param args.rpcProvider - The RPC provider to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createInfuraNetworkMiddleware({\n  blockTracker,\n  network,\n  rpcProvider,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  network: InfuraNetworkType;\n  rpcProvider: InternalProvider;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  return JsonRpcEngineV2.create({\n    middleware: [\n      createNetworkAndChainIdMiddleware({ network }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),\n      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * Creates static method middleware.\n *\n * @param args - The Arguments.\n * @param args.network - The Infura network to use.\n * @returns The middleware that implements the eth_chainId method.\n */\nfunction createNetworkAndChainIdMiddleware({\n  network,\n}: {\n  network: InfuraNetworkType;\n}): JsonRpcMiddleware<JsonRpcRequest> {\n  return createScaffoldMiddleware({\n    eth_chainId: ChainId[network],\n  });\n}\n\nconst createChainIdMiddleware = (\n  chainId: Hex,\n): JsonRpcMiddleware<JsonRpcRequest, Json> => {\n  return ({ request, next }) => {\n    if (request.method === 'eth_chainId') {\n      return chainId;\n    }\n    return next();\n  };\n};\n\n/**\n * Creates custom middleware.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.chainId - The chain id to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createCustomNetworkMiddleware({\n  blockTracker,\n  chainId,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  chainId: Hex;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  // Needed for testing.\n  // eslint-disable-next-line no-restricted-globals\n  const testMiddlewares = process.env.IN_TEST\n    ? [createEstimateGasDelayTestMiddleware()]\n    : [];\n\n  return JsonRpcEngineV2.create({\n    middleware: [\n      ...testMiddlewares,\n      createChainIdMiddleware(chainId),\n      createBlockRefRewriteMiddleware({ blockTracker }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * For use in tests only.\n * Adds a delay to `eth_estimateGas` calls.\n *\n * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.\n */\nfunction createEstimateGasDelayTestMiddleware(): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json\n> {\n  return async ({ request, next }) => {\n    if (request.method === 'eth_estimateGas') {\n      await new Promise((resolve) => setTimeout(resolve, SECOND * 2));\n    }\n    return next();\n  };\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"create-network-client.mjs","sourceRoot":"","sources":["../src/create-network-client.ts"],"names":[],"mappings":"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","sourcesContent":["import { CONNECTIVITY_STATUSES } from '@metamask/connectivity-controller';\nimport type {\n  CockatielFailureReason,\n  InfuraNetworkType,\n} from '@metamask/controller-utils';\nimport { ChainId } from '@metamask/controller-utils';\nimport type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';\nimport { PollingBlockTracker } from '@metamask/eth-block-tracker';\nimport { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';\nimport {\n  createBlockCacheMiddleware,\n  createBlockRefMiddleware,\n  createBlockRefRewriteMiddleware,\n  createBlockTrackerInspectorMiddleware,\n  createInflightCacheMiddleware,\n  createFetchMiddleware,\n  createRetryOnEmptyMiddleware,\n} from '@metamask/eth-json-rpc-middleware';\nimport { InternalProvider } from '@metamask/eth-json-rpc-provider';\nimport { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';\nimport { asV2Middleware } from '@metamask/json-rpc-engine';\nimport {\n  createScaffoldMiddleware,\n  JsonRpcEngineV2,\n} from '@metamask/json-rpc-engine/v2';\nimport type {\n  JsonRpcMiddleware,\n  MiddlewareContext,\n} from '@metamask/json-rpc-engine/v2';\nimport type { Hex, Json, JsonRpcRequest } from '@metamask/utils';\nimport type { Logger } from 'loglevel';\n\nimport type {\n  NetworkClientId,\n  NetworkControllerMessenger,\n} from './NetworkController';\nimport type { RpcServiceOptions } from './rpc-service/rpc-service';\nimport { RpcServiceChain } from './rpc-service/rpc-service-chain';\nimport type {\n  BlockTracker,\n  NetworkClientConfiguration,\n  Provider,\n} from './types';\nimport { NetworkClientType } from './types';\n\nconst SECOND = 1000;\n\n/**\n * The pair of provider / block tracker that can be used to interface with the\n * network and respond to new activity.\n */\nexport type NetworkClient = {\n  configuration: NetworkClientConfiguration;\n  provider: Provider;\n  blockTracker: BlockTracker;\n  destroy: () => void;\n};\n\ntype RpcApiMiddleware = JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string }>\n>;\n\n/**\n * Create a JSON RPC network client for a specific network.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.getBlockTrackerOptions - Factory for constructing block tracker\n * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The network client.\n */\nexport function createNetworkClient({\n  id,\n  configuration,\n  getRpcServiceOptions,\n  getBlockTrackerOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  getBlockTrackerOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): NetworkClient {\n  const primaryEndpointUrl =\n    configuration.type === NetworkClientType.Infura\n      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`\n      : configuration.rpcUrl;\n  const rpcServiceChain = createRpcServiceChain({\n    id,\n    primaryEndpointUrl,\n    configuration,\n    getRpcServiceOptions,\n    messenger,\n    isRpcFailoverEnabled,\n    logger,\n  });\n\n  let rpcApiMiddleware: RpcApiMiddleware;\n  if (configuration.type === NetworkClientType.Infura) {\n    rpcApiMiddleware = asV2Middleware(\n      createInfuraMiddleware({\n        rpcService: rpcServiceChain,\n        options: {\n          source: 'metamask',\n        },\n      }),\n    );\n  } else {\n    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });\n  }\n\n  const rpcProvider = providerFromMiddlewareV2(rpcApiMiddleware);\n\n  const blockTracker = createBlockTracker({\n    networkClientType: configuration.type,\n    endpointUrl: primaryEndpointUrl,\n    getOptions: getBlockTrackerOptions,\n    provider: rpcProvider,\n  });\n\n  const networkMiddleware =\n    configuration.type === NetworkClientType.Infura\n      ? createInfuraNetworkMiddleware({\n          blockTracker,\n          network: configuration.network,\n          rpcProvider,\n          rpcApiMiddleware,\n        })\n      : createCustomNetworkMiddleware({\n          blockTracker,\n          chainId: configuration.chainId,\n          rpcApiMiddleware,\n        });\n\n  const provider: Provider = new InternalProvider({\n    engine: JsonRpcEngineV2.create({\n      middleware: [networkMiddleware],\n    }),\n  });\n\n  const destroy = (): void => {\n    // TODO: Either fix this lint violation or explain why it's necessary to ignore.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    blockTracker.destroy();\n  };\n\n  return { configuration, provider, blockTracker, destroy };\n}\n\n/**\n * Creates an RPC service chain, which represents the primary endpoint URL for\n * the network as well as its failover URLs.\n *\n * @param args - The arguments.\n * @param args.id - The ID that will be assigned to the new network client in\n * the registry.\n * @param args.primaryEndpointUrl - The primary endpoint URL.\n * @param args.configuration - The network configuration.\n * @param args.getRpcServiceOptions - Factory for constructing RPC service\n * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.\n * @param args.messenger - The network controller messenger.\n * @param args.isRpcFailoverEnabled - Whether or not requests sent to the\n * primary RPC endpoint for this network should be automatically diverted to\n * provided failover endpoints if the primary is unavailable. This effectively\n * causes the `failoverRpcUrls` property of the network client configuration\n * to be honored or ignored.\n * @param args.logger - A `loglevel` logger.\n * @returns The RPC service chain.\n */\nfunction createRpcServiceChain({\n  id,\n  primaryEndpointUrl,\n  configuration,\n  getRpcServiceOptions,\n  messenger,\n  isRpcFailoverEnabled,\n  logger,\n}: {\n  id: NetworkClientId;\n  primaryEndpointUrl: string;\n  configuration: NetworkClientConfiguration;\n  getRpcServiceOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;\n  messenger: NetworkControllerMessenger;\n  isRpcFailoverEnabled: boolean;\n  logger?: Logger;\n}): RpcServiceChain {\n  const availableEndpointUrls: [string, ...string[]] = isRpcFailoverEnabled\n    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]\n    : [primaryEndpointUrl];\n\n  const isOffline = (): boolean => {\n    const connectivityState = messenger.call('ConnectivityController:getState');\n    return (\n      connectivityState.connectivityStatus === CONNECTIVITY_STATUSES.Offline\n    );\n  };\n\n  const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({\n    ...getRpcServiceOptions(endpointUrl),\n    endpointUrl,\n    logger,\n    isOffline,\n  }));\n\n  /**\n   * Extracts the error from Cockatiel's `FailureReason` type received in\n   * circuit breaker event handlers.\n   *\n   * The `FailureReason` object can have two possible shapes:\n   * - `{ error: Error }` - When the RPC service throws an error (the common\n   * case for RPC failures).\n   * - `{ value: T }` - When the RPC service returns a value that the retry\n   * filter policy considers a failure.\n   *\n   * @param value - The event data object from the circuit breaker event\n   * listener (after destructuring known properties like `endpointUrl`). This\n   * represents Cockatiel's `FailureReason` type.\n   * @returns The error or failure value, or `undefined` if neither property\n   * exists (which shouldn't happen in practice unless the circuit breaker is\n   * manually isolated).\n   */\n  const getError = (\n    value: CockatielFailureReason<unknown> | Record<never, never>,\n  ): Error | unknown | undefined => {\n    if ('error' in value) {\n      return value.error;\n    } else if ('value' in value) {\n      return value.value;\n    }\n    return undefined;\n  };\n\n  const rpcServiceChain = new RpcServiceChain([\n    rpcServiceConfigurations[0],\n    ...rpcServiceConfigurations.slice(1),\n  ]);\n\n  rpcServiceChain.onBreak((data) => {\n    const error = getError(data);\n\n    if (error === undefined) {\n      // This error shouldn't happen in practice because we never call `.isolate`\n      // on the circuit breaker policy, but we need to appease TypeScript.\n      throw new Error('Could not make request to endpoint.');\n    }\n\n    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceBreak(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n\n      if (error === undefined) {\n        // This error shouldn't happen in practice because we never call `.isolate`\n        // on the circuit breaker policy, but we need to appease TypeScript.\n        throw new Error('Could not make request to endpoint.');\n      }\n\n      messenger.publish('NetworkController:rpcEndpointUnavailable', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onDegraded((data) => {\n    const error = getError(data);\n    messenger.publish('NetworkController:rpcEndpointChainDegraded', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n      error,\n    });\n  });\n\n  rpcServiceChain.onServiceDegraded(\n    ({\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n      ...rest\n    }) => {\n      const error = getError(rest);\n\n      messenger.publish('NetworkController:rpcEndpointDegraded', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        error,\n      });\n    },\n  );\n\n  rpcServiceChain.onAvailable(() => {\n    messenger.publish('NetworkController:rpcEndpointChainAvailable', {\n      chainId: configuration.chainId,\n      networkClientId: id,\n    });\n  });\n\n  rpcServiceChain.onServiceRetry(\n    ({\n      attempt,\n      endpointUrl,\n      primaryEndpointUrl: primaryEndpointUrlFromEvent,\n    }) => {\n      messenger.publish('NetworkController:rpcEndpointRetried', {\n        chainId: configuration.chainId,\n        networkClientId: id,\n        primaryEndpointUrl: primaryEndpointUrlFromEvent,\n        endpointUrl,\n        attempt,\n      });\n    },\n  );\n\n  return rpcServiceChain;\n}\n\n/**\n * Create the block tracker for the network.\n *\n * @param args - The arguments.\n * @param args.networkClientType - The type of the network client (\"infura\" or\n * \"custom\").\n * @param args.endpointUrl - The URL of the endpoint.\n * @param args.getOptions - Factory for the block tracker options.\n * @param args.provider - The EIP-1193 provider for the network's JSON-RPC\n * middleware stack.\n * @returns The created block tracker.\n */\nfunction createBlockTracker({\n  networkClientType,\n  endpointUrl,\n  getOptions,\n  provider,\n}: {\n  networkClientType: NetworkClientType;\n  endpointUrl: string;\n  getOptions: (\n    rpcEndpointUrl: string,\n  ) => Omit<PollingBlockTrackerOptions, 'provider'>;\n  provider: InternalProvider;\n}): PollingBlockTracker {\n  const testOptions =\n    // Needed for testing.\n    // eslint-disable-next-line no-restricted-globals\n    process.env.IN_TEST && networkClientType === NetworkClientType.Custom\n      ? { pollingInterval: SECOND }\n      : {};\n\n  return new PollingBlockTracker({\n    ...testOptions,\n    ...getOptions(endpointUrl),\n    provider,\n  });\n}\n\n/**\n * Create middleware for infura.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.network - The Infura network to use.\n * @param args.rpcProvider - The RPC provider to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createInfuraNetworkMiddleware({\n  blockTracker,\n  network,\n  rpcProvider,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  network: InfuraNetworkType;\n  rpcProvider: InternalProvider;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  return JsonRpcEngineV2.create({\n    middleware: [\n      createNetworkAndChainIdMiddleware({ network }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),\n      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * Creates static method middleware.\n *\n * @param args - The Arguments.\n * @param args.network - The Infura network to use.\n * @returns The middleware that implements the eth_chainId method.\n */\nfunction createNetworkAndChainIdMiddleware({\n  network,\n}: {\n  network: InfuraNetworkType;\n}): JsonRpcMiddleware<JsonRpcRequest> {\n  return createScaffoldMiddleware({\n    eth_chainId: ChainId[network],\n  });\n}\n\nconst createChainIdMiddleware = (\n  chainId: Hex,\n): JsonRpcMiddleware<JsonRpcRequest, Json> => {\n  return ({ request, next }) => {\n    if (request.method === 'eth_chainId') {\n      return chainId;\n    }\n    return next();\n  };\n};\n\n/**\n * Creates custom middleware.\n *\n * @param args - The arguments.\n * @param args.blockTracker - The block tracker to use.\n * @param args.chainId - The chain id to use.\n * @param args.rpcApiMiddleware - Additional middleware.\n * @returns The collection of middleware that makes up the Infura client.\n */\nfunction createCustomNetworkMiddleware({\n  blockTracker,\n  chainId,\n  rpcApiMiddleware,\n}: {\n  blockTracker: PollingBlockTracker;\n  chainId: Hex;\n  rpcApiMiddleware: RpcApiMiddleware;\n}): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json,\n  MiddlewareContext<{ origin: string; skipCache: boolean }>\n> {\n  // Needed for testing.\n  // eslint-disable-next-line no-restricted-globals\n  const testMiddlewares = process.env.IN_TEST\n    ? [createEstimateGasDelayTestMiddleware()]\n    : [];\n\n  return JsonRpcEngineV2.create({\n    middleware: [\n      ...testMiddlewares,\n      createChainIdMiddleware(chainId),\n      createBlockRefRewriteMiddleware({ blockTracker }),\n      createBlockCacheMiddleware({ blockTracker }),\n      createInflightCacheMiddleware(),\n      createBlockTrackerInspectorMiddleware({ blockTracker }),\n      rpcApiMiddleware,\n    ],\n  }).asMiddleware();\n}\n\n/**\n * For use in tests only.\n * Adds a delay to `eth_estimateGas` calls.\n *\n * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.\n */\nfunction createEstimateGasDelayTestMiddleware(): JsonRpcMiddleware<\n  JsonRpcRequest,\n  Json\n> {\n  return async ({ request, next }) => {\n    if (request.method === 'eth_estimateGas') {\n      await new Promise((resolve) => setTimeout(resolve, SECOND * 2));\n    }\n    return next();\n  };\n}\n"]}
\ No newline at end of file
diff --git a/dist/rpc-service/rpc-service.cjs b/dist/rpc-service/rpc-service.cjs
index 1f510f0220ac18da46eefea85edbaa460308035e..be706fe8f0308c00e59e816d7aba53680b637e76 100644
--- a/dist/rpc-service/rpc-service.cjs
+++ b/dist/rpc-service/rpc-service.cjs
@@ -202,7 +202,7 @@ class RpcService {
          * The policy that wraps the request.
          */
         _RpcService_policy.set(this, void 0);
-        const { btoa: givenBtoa, endpointUrl, fetch: givenFetch, logger, fetchOptions = {}, policyOptions = {}, } = options;
+        const { btoa: givenBtoa, endpointUrl, fetch: givenFetch, logger, fetchOptions = {}, policyOptions = {}, isOffline, } = options;
         __classPrivateFieldSet(this, _RpcService_fetch, givenFetch, "f");
         const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);
         __classPrivateFieldSet(this, _RpcService_fetchOptions, __classPrivateFieldGet(this, _RpcService_instances, "m", _RpcService_getDefaultFetchOptions).call(this, normalizedUrl, fetchOptions, givenBtoa), "f");
@@ -213,6 +213,11 @@ class RpcService {
             maxConsecutiveFailures: exports.DEFAULT_MAX_CONSECUTIVE_FAILURES,
             ...policyOptions,
             retryFilterPolicy: (0, controller_utils_1.handleWhen)((error) => {
+                // If user is offline, don't retry any errors
+                // This prevents degraded/break callbacks from being triggered
+                if (isOffline()) {
+                    return false;
+                }
                 return (
                 // Ignore errors where the request failed to establish
                 isConnectionError(error) ||
diff --git a/dist/rpc-service/rpc-service.cjs.map b/dist/rpc-service/rpc-service.cjs.map
index 9c49bed46d2ba2d6320f1b2ecf6b2e17696740f1..296d029b69e205d4c0e1579e9a4a9805cf03830a 100644
--- a/dist/rpc-service/rpc-service.cjs.map
+++ b/dist/rpc-service/rpc-service.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"rpc-service.cjs","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  CreateServicePolicyOptions,\n  ServicePolicy,\n} from '@metamask/controller-utils';\nimport {\n  BrokenCircuitError,\n  HttpError,\n  createServicePolicy,\n  handleWhen,\n} from '@metamask/controller-utils';\nimport { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';\nimport { Duration, getErrorMessage, hasProperty } from '@metamask/utils';\nimport type {\n  Json,\n  JsonRpcParams,\n  JsonRpcRequest,\n  JsonRpcResponse,\n} from '@metamask/utils';\nimport { CircuitState, IDisposable } from 'cockatiel';\nimport deepmerge from 'deepmerge';\nimport type { Logger } from 'loglevel';\n\nimport type { AbstractRpcService } from './abstract-rpc-service';\nimport type { FetchOptions } from './shared';\nimport { projectLogger, createModuleLogger } from '../logger';\n\n/**\n * Options for the RpcService constructor.\n */\nexport type RpcServiceOptions = {\n  /**\n   * A function that can be used to convert a binary string into a\n   * base64-encoded ASCII string. Used to encode authorization credentials.\n   */\n  btoa: typeof btoa;\n  /**\n   * The URL of the RPC endpoint to hit.\n   */\n  endpointUrl: URL | string;\n  /**\n   * A function that can be used to make an HTTP request. If your JavaScript\n   * environment supports `fetch` natively, you'll probably want to pass that;\n   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).\n   */\n  fetch: typeof fetch;\n  /**\n   * A common set of options that will be used to make every request. Can be\n   * overridden on the request level (e.g. to add headers).\n   */\n  fetchOptions?: FetchOptions;\n  /**\n   * A `loglevel` logger.\n   */\n  logger?: Pick<Logger, 'warn'>;\n  /**\n   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is\n   * not accepted, as it is overwritten. See {@link createServicePolicy}.\n   */\n  policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;\n};\n\nconst log = createModuleLogger(projectLogger, 'RpcService');\n\n/**\n * The maximum number of times that a failing service should be re-run before\n * giving up.\n */\nexport const DEFAULT_MAX_RETRIES = 4;\n\n/**\n * The maximum number of times that the service is allowed to fail before\n * pausing further retries. This is set to a value such that if given a\n * service that continually fails, the policy needs to be executed 3 times\n * before further retries are paused.\n */\nexport const DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;\n\n/**\n * The list of error messages that represent a failure to connect to the network.\n *\n * This list was derived from Sindre Sorhus's `is-network-error` package:\n * <https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js>\n */\nexport const CONNECTION_ERRORS = [\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /network error/u,\n  },\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /Failed to fetch/u,\n  },\n  // Firefox\n  {\n    constructorName: 'TypeError',\n    pattern: /NetworkError when attempting to fetch resource\\./u,\n  },\n  // Safari 16\n  {\n    constructorName: 'TypeError',\n    pattern: /The Internet connection appears to be offline\\./u,\n  },\n  // Safari 17+\n  {\n    constructorName: 'TypeError',\n    pattern: /Load failed/u,\n  },\n  // `cross-fetch`\n  {\n    constructorName: 'TypeError',\n    pattern: /Network request failed/u,\n  },\n  // `node-fetch`\n  {\n    constructorName: 'FetchError',\n    pattern: /request to (.+) failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /fetch failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /terminated/u,\n  },\n];\n\n/**\n * Custom JSON-RPC error codes for specific cases.\n *\n * These should be moved to `@metamask/rpc-errors` eventually.\n */\nexport const CUSTOM_RPC_ERRORS = {\n  unauthorized: -32006,\n  httpClientError: -32080,\n} as const;\n\n/**\n * Determines whether the given error represents a failure to reach the network\n * after request parameters have been validated.\n *\n * This is somewhat difficult to verify because JavaScript engines (and in\n * some cases libraries) produce slightly different error messages for this\n * particular scenario, and we need to account for this.\n *\n * @param error - The error.\n * @returns True if the error indicates that the network cannot be connected to,\n * and false otherwise.\n */\nexport function isConnectionError(error: unknown): boolean {\n  if (!(typeof error === 'object' && error !== null && 'message' in error)) {\n    return false;\n  }\n\n  const { message } = error;\n\n  return (\n    typeof message === 'string' &&\n    !isNockError(message) &&\n    CONNECTION_ERRORS.some(({ constructorName, pattern }) => {\n      return (\n        error.constructor.name === constructorName && pattern.test(message)\n      );\n    })\n  );\n}\n\n/**\n * Determines whether the given error message refers to a Nock error.\n *\n * It's important that if we failed to mock a request in a test, the resulting\n * error does not cause the request to be retried so that we can see it right\n * away.\n *\n * @param message - The error message to test.\n * @returns True if the message indicates a missing Nock mock, false otherwise.\n */\nfunction isNockError(message: string): boolean {\n  return message.includes('Nock:');\n}\n\n/**\n * Determine whether the given error message indicates a failure to parse JSON.\n *\n * This is different in tests vs. implementation code because it may manifest as\n * a FetchError or a SyntaxError.\n *\n * @param error - The error object to test.\n * @returns True if the error indicates a JSON parse error, false otherwise.\n */\nfunction isJsonParseError(error: unknown): boolean {\n  return (\n    error instanceof SyntaxError ||\n    /invalid json/iu.test(getErrorMessage(error))\n  );\n}\n\n/**\n * Guarantees a URL, even given a string. This is useful for checking components\n * of that URL.\n *\n * @param endpointUrlOrUrlString - Either a URL object or a string that\n * represents the URL of an endpoint.\n * @returns A URL object.\n */\nfunction getNormalizedEndpointUrl(endpointUrlOrUrlString: URL | string): URL {\n  return endpointUrlOrUrlString instanceof URL\n    ? endpointUrlOrUrlString\n    : new URL(endpointUrlOrUrlString);\n}\n\n/**\n * Strips username and password from a URL.\n *\n * @param url - The URL to strip credentials from.\n * @returns A new URL object with credentials removed.\n */\nfunction stripCredentialsFromUrl(url: URL): URL {\n  const strippedUrl = new URL(url.toString());\n  strippedUrl.username = '';\n  strippedUrl.password = '';\n  return strippedUrl;\n}\n\n/**\n * This class is responsible for making a request to an endpoint that implements\n * the JSON-RPC protocol. It is designed to gracefully handle network and server\n * failures, retrying requests using exponential backoff. It also offers a hook\n * which can used to respond to slow requests.\n */\nexport class RpcService implements AbstractRpcService {\n  /**\n   * The URL of the RPC endpoint.\n   */\n  readonly endpointUrl: URL;\n\n  /**\n   * The last error that the retry policy captured (or `undefined` if the last\n   * execution of the service was successful).\n   */\n  lastError: Error | undefined;\n\n  /**\n   * The function used to make an HTTP request.\n   */\n  readonly #fetch: typeof fetch;\n\n  /**\n   * A common set of options that the request options will extend.\n   */\n  readonly #fetchOptions: FetchOptions;\n\n  /**\n   * A `loglevel` logger.\n   */\n  readonly #logger: RpcServiceOptions['logger'];\n\n  /**\n   * The policy that wraps the request.\n   */\n  readonly #policy: ServicePolicy;\n\n  /**\n   * Constructs a new RpcService object.\n   *\n   * @param options - The options. See {@link RpcServiceOptions}.\n   */\n  constructor(options: RpcServiceOptions) {\n    const {\n      btoa: givenBtoa,\n      endpointUrl,\n      fetch: givenFetch,\n      logger,\n      fetchOptions = {},\n      policyOptions = {},\n    } = options;\n\n    this.#fetch = givenFetch;\n    const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);\n    this.#fetchOptions = this.#getDefaultFetchOptions(\n      normalizedUrl,\n      fetchOptions,\n      givenBtoa,\n    );\n    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);\n    this.#logger = logger;\n\n    this.#policy = createServicePolicy({\n      maxRetries: DEFAULT_MAX_RETRIES,\n      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,\n      ...policyOptions,\n      retryFilterPolicy: handleWhen((error) => {\n        return (\n          // Ignore errors where the request failed to establish\n          isConnectionError(error) ||\n          // Ignore server sent HTML error pages or truncated JSON responses\n          isJsonParseError(error) ||\n          // Ignore server overload errors\n          ('httpStatus' in error &&\n            (error.httpStatus === 502 ||\n              error.httpStatus === 503 ||\n              error.httpStatus === 504)) ||\n          (hasProperty(error, 'code') &&\n            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))\n        );\n      }),\n    });\n  }\n\n  /**\n   * Resets the underlying composite Cockatiel policy.\n   *\n   * This is useful in a collection of RpcServices where some act as failovers\n   * for others where you effectively want to invalidate the failovers when the\n   * primary recovers.\n   */\n  resetPolicy(): void {\n    this.#policy.reset();\n  }\n\n  /**\n   * @returns The state of the underlying circuit.\n   */\n  getCircuitState(): CircuitState {\n    return this.#policy.getCircuitState();\n  }\n\n  /**\n   * Listens for when the RPC service retries the request.\n   *\n   * @param listener - The callback to be called when the retry occurs.\n   * @returns What {@link ServicePolicy.onRetry} returns.\n   * @see {@link createServicePolicy}\n   */\n  onRetry(listener: Parameters<AbstractRpcService['onRetry']>[0]): IDisposable {\n    return this.#policy.onRetry((data) => {\n      listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the RPC service retries the request too many times in a\n   * row, causing the underlying circuit to break.\n   *\n   * @param listener - The callback to be called when the circuit is broken.\n   * @returns What {@link ServicePolicy.onBreak} returns.\n   * @see {@link createServicePolicy}\n   */\n  onBreak(listener: Parameters<AbstractRpcService['onBreak']>[0]): IDisposable {\n    return this.#policy.onBreak((data) => {\n      // `{ isolated: true }` is a special object that shows up when `isolate`\n      // is called on the circuit breaker. Usually `isolate` is used to hold the\n      // circuit open, but we (ab)use this method in `createServicePolicy` to\n      // reset the circuit breaker policy. When we do this, we don't want to\n      // call `onBreak` handlers, because then it causes\n      // `NetworkController:rpcEndpointUnavailable` and\n      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we\n      // have to ignore that object here. The consequence is that `isolate`\n      // doesn't function the way it is intended, at least in the context of an\n      // RpcService. However, we are making a bet that we won't need to use it\n      // other than how we are already using it.\n      if (!('isolated' in data)) {\n        listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n      }\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service detects a slow\n   * request.\n   *\n   * @param listener - The callback to be called when the request is slow.\n   * @returns What {@link ServicePolicy.onDegraded} returns.\n   * @see {@link createServicePolicy}\n   */\n  onDegraded(\n    listener: Parameters<AbstractRpcService['onDegraded']>[0],\n  ): IDisposable {\n    return this.#policy.onDegraded((data) => {\n      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service is available.\n   *\n   * @param listener - The callback to be called when the request is available.\n   * @returns What {@link ServicePolicy.onAvailable} returns.\n   * @see {@link createServicePolicy}\n   */\n  onAvailable(\n    listener: Parameters<AbstractRpcService['onAvailable']>[0],\n  ): IDisposable {\n    return this.#policy.onAvailable(() => {\n      listener({ endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is specifically designed for `eth_getBlockByNumber`, which\n   * can return a `result` of `null` despite an expected `Result` being\n   * provided.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params> & { method: 'eth_getBlockByNumber' },\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>>;\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is designed for all RPC methods except for\n   * `eth_getBlockByNumber`, which are expected to return a `result` of the\n   * expected `Result`.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params>,\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result>>;\n\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    // The request object may be frozen and must not be mutated.\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions = {},\n  ): Promise<JsonRpcResponse<Result | null>> {\n    const completeFetchOptions = this.#getCompleteFetchOptions(\n      jsonRpcRequest,\n      fetchOptions,\n    );\n    return await this.#executeAndProcessRequest<Result>(completeFetchOptions);\n  }\n\n  /**\n   * Constructs a default set of options to `fetch`.\n   *\n   * If a username and password are present in the URL, they are extracted to an\n   * Authorization header.\n   *\n   * @param endpointUrl - The endpoint URL.\n   * @param fetchOptions - The options to `fetch`.\n   * @param givenBtoa - An implementation of `btoa`.\n   * @returns The default fetch options.\n   */\n  #getDefaultFetchOptions(\n    endpointUrl: URL,\n    fetchOptions: FetchOptions,\n    givenBtoa: (stringToEncode: string) => string,\n  ): FetchOptions {\n    if (endpointUrl.username && endpointUrl.password) {\n      const authString = `${endpointUrl.username}:${endpointUrl.password}`;\n      const encodedCredentials = givenBtoa(authString);\n      return deepmerge(fetchOptions, {\n        headers: { Authorization: `Basic ${encodedCredentials}` },\n      });\n    }\n\n    return fetchOptions;\n  }\n\n  /**\n   * Constructs a final set of options to pass to `fetch`. Note that the method\n   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request.\n   * @param fetchOptions - Custom `fetch` options.\n   * @returns The complete set of `fetch` options.\n   */\n  #getCompleteFetchOptions<Params extends JsonRpcParams>(\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions,\n  ): FetchOptions {\n    const defaultOptions = {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n    };\n    const mergedOptions = deepmerge(\n      defaultOptions,\n      deepmerge(this.#fetchOptions, fetchOptions),\n    );\n\n    const { id, jsonrpc, method, params } = jsonRpcRequest;\n    const body = JSON.stringify({\n      id,\n      jsonrpc,\n      method,\n      params,\n    });\n\n    return { ...mergedOptions, body };\n  }\n\n  /**\n   * Makes the request using the Cockatiel policy that this service creates.\n   *\n   * @param fetchOptions - The options for `fetch`; will be combined with the\n   * fetch options passed to the constructor\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async #executeAndProcessRequest<Result extends Json>(\n    fetchOptions: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>> {\n    let response: Response | undefined;\n    try {\n      log(\n        `[${this.endpointUrl}] Circuit state`,\n        this.#policy.getCircuitState(),\n      );\n      const jsonDecodedResponse = await this.#policy.execute(\n        async (context) => {\n          log(\n            'REQUEST INITIATED:',\n            this.endpointUrl.toString(),\n            '::',\n            fetchOptions,\n            // @ts-expect-error This property _is_ here, the type of\n            // ServicePolicy is just wrong.\n            `(attempt ${context.attempt + 1})`,\n          );\n          response = await this.#fetch(this.endpointUrl, fetchOptions);\n          if (!response.ok) {\n            throw new HttpError(response.status);\n          }\n          log(\n            'REQUEST SUCCESSFUL:',\n            this.endpointUrl.toString(),\n            response.status,\n          );\n          return await response.json();\n        },\n      );\n      this.lastError = undefined;\n      return jsonDecodedResponse;\n    } catch (error) {\n      log('REQUEST ERROR:', this.endpointUrl.toString(), error);\n\n      this.lastError =\n        error instanceof Error ? error : new Error(getErrorMessage(error));\n\n      if (error instanceof HttpError) {\n        const status = error.httpStatus;\n        if (status === 401) {\n          throw new JsonRpcError(\n            CUSTOM_RPC_ERRORS.unauthorized,\n            'Unauthorized.',\n            {\n              httpStatus: status,\n            },\n          );\n        }\n        if (status === 429) {\n          throw rpcErrors.limitExceeded({\n            message: 'Request is being rate limited.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n        if (status >= 500 || status === 402 || status === 404) {\n          throw rpcErrors.resourceUnavailable({\n            message: 'RPC endpoint not found or unavailable.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n\n        // Handle all other 4xx errors as generic HTTP client errors\n        throw new JsonRpcError(\n          CUSTOM_RPC_ERRORS.httpClientError,\n          'RPC endpoint returned HTTP client error.',\n          {\n            httpStatus: status,\n          },\n        );\n      } else if (isJsonParseError(error)) {\n        throw rpcErrors.parse({\n          message: 'RPC endpoint did not return JSON.',\n        });\n      } else if (error instanceof BrokenCircuitError) {\n        this.#logger?.warn(error);\n        const remainingCircuitOpenDuration =\n          this.#policy.getRemainingCircuitOpenDuration();\n        const formattedRemainingCircuitOpenDuration = Intl.NumberFormat(\n          undefined,\n          { maximumFractionDigits: 2 },\n        ).format(\n          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /\n            Duration.Minute,\n        );\n        throw rpcErrors.resourceUnavailable({\n          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,\n        });\n      }\n      throw error;\n    }\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"rpc-service.cjs","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  CreateServicePolicyOptions,\n  ServicePolicy,\n} from '@metamask/controller-utils';\nimport {\n  BrokenCircuitError,\n  HttpError,\n  createServicePolicy,\n  handleWhen,\n} from '@metamask/controller-utils';\nimport { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';\nimport { Duration, getErrorMessage, hasProperty } from '@metamask/utils';\nimport type {\n  Json,\n  JsonRpcParams,\n  JsonRpcRequest,\n  JsonRpcResponse,\n} from '@metamask/utils';\nimport { CircuitState, IDisposable } from 'cockatiel';\nimport deepmerge from 'deepmerge';\nimport type { Logger } from 'loglevel';\n\nimport type { AbstractRpcService } from './abstract-rpc-service';\nimport type { FetchOptions } from './shared';\nimport { projectLogger, createModuleLogger } from '../logger';\n\n/**\n * Options for the RpcService constructor.\n */\nexport type RpcServiceOptions = {\n  /**\n   * A function that can be used to convert a binary string into a\n   * base64-encoded ASCII string. Used to encode authorization credentials.\n   */\n  btoa: typeof btoa;\n  /**\n   * The URL of the RPC endpoint to hit.\n   */\n  endpointUrl: URL | string;\n  /**\n   * A function that can be used to make an HTTP request. If your JavaScript\n   * environment supports `fetch` natively, you'll probably want to pass that;\n   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).\n   */\n  fetch: typeof fetch;\n  /**\n   * A common set of options that will be used to make every request. Can be\n   * overridden on the request level (e.g. to add headers).\n   */\n  fetchOptions?: FetchOptions;\n  /**\n   * A `loglevel` logger.\n   */\n  logger?: Pick<Logger, 'warn'>;\n  /**\n   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is\n   * not accepted, as it is overwritten. See {@link createServicePolicy}.\n   */\n  policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;\n  /**\n   * A function that checks if the user is currently offline. If it returns true,\n   * connection errors will not be retried, preventing degraded and break\n   * callbacks from being triggered.\n   */\n  isOffline: () => boolean;\n};\n\nconst log = createModuleLogger(projectLogger, 'RpcService');\n\n/**\n * The maximum number of times that a failing service should be re-run before\n * giving up.\n */\nexport const DEFAULT_MAX_RETRIES = 4;\n\n/**\n * The maximum number of times that the service is allowed to fail before\n * pausing further retries. This is set to a value such that if given a\n * service that continually fails, the policy needs to be executed 3 times\n * before further retries are paused.\n */\nexport const DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;\n\n/**\n * The list of error messages that represent a failure to connect to the network.\n *\n * This list was derived from Sindre Sorhus's `is-network-error` package:\n * <https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js>\n */\nexport const CONNECTION_ERRORS = [\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /network error/u,\n  },\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /Failed to fetch/u,\n  },\n  // Firefox\n  {\n    constructorName: 'TypeError',\n    pattern: /NetworkError when attempting to fetch resource\\./u,\n  },\n  // Safari 16\n  {\n    constructorName: 'TypeError',\n    pattern: /The Internet connection appears to be offline\\./u,\n  },\n  // Safari 17+\n  {\n    constructorName: 'TypeError',\n    pattern: /Load failed/u,\n  },\n  // `cross-fetch`\n  {\n    constructorName: 'TypeError',\n    pattern: /Network request failed/u,\n  },\n  // `node-fetch`\n  {\n    constructorName: 'FetchError',\n    pattern: /request to (.+) failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /fetch failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /terminated/u,\n  },\n];\n\n/**\n * Custom JSON-RPC error codes for specific cases.\n *\n * These should be moved to `@metamask/rpc-errors` eventually.\n */\nexport const CUSTOM_RPC_ERRORS = {\n  unauthorized: -32006,\n  httpClientError: -32080,\n} as const;\n\n/**\n * Determines whether the given error represents a failure to reach the network\n * after request parameters have been validated.\n *\n * This is somewhat difficult to verify because JavaScript engines (and in\n * some cases libraries) produce slightly different error messages for this\n * particular scenario, and we need to account for this.\n *\n * @param error - The error.\n * @returns True if the error indicates that the network cannot be connected to,\n * and false otherwise.\n */\nexport function isConnectionError(error: unknown): boolean {\n  if (!(typeof error === 'object' && error !== null && 'message' in error)) {\n    return false;\n  }\n\n  const { message } = error;\n\n  return (\n    typeof message === 'string' &&\n    !isNockError(message) &&\n    CONNECTION_ERRORS.some(({ constructorName, pattern }) => {\n      return (\n        error.constructor.name === constructorName && pattern.test(message)\n      );\n    })\n  );\n}\n\n/**\n * Determines whether the given error message refers to a Nock error.\n *\n * It's important that if we failed to mock a request in a test, the resulting\n * error does not cause the request to be retried so that we can see it right\n * away.\n *\n * @param message - The error message to test.\n * @returns True if the message indicates a missing Nock mock, false otherwise.\n */\nfunction isNockError(message: string): boolean {\n  return message.includes('Nock:');\n}\n\n/**\n * Determine whether the given error message indicates a failure to parse JSON.\n *\n * This is different in tests vs. implementation code because it may manifest as\n * a FetchError or a SyntaxError.\n *\n * @param error - The error object to test.\n * @returns True if the error indicates a JSON parse error, false otherwise.\n */\nfunction isJsonParseError(error: unknown): boolean {\n  return (\n    error instanceof SyntaxError ||\n    /invalid json/iu.test(getErrorMessage(error))\n  );\n}\n\n/**\n * Guarantees a URL, even given a string. This is useful for checking components\n * of that URL.\n *\n * @param endpointUrlOrUrlString - Either a URL object or a string that\n * represents the URL of an endpoint.\n * @returns A URL object.\n */\nfunction getNormalizedEndpointUrl(endpointUrlOrUrlString: URL | string): URL {\n  return endpointUrlOrUrlString instanceof URL\n    ? endpointUrlOrUrlString\n    : new URL(endpointUrlOrUrlString);\n}\n\n/**\n * Strips username and password from a URL.\n *\n * @param url - The URL to strip credentials from.\n * @returns A new URL object with credentials removed.\n */\nfunction stripCredentialsFromUrl(url: URL): URL {\n  const strippedUrl = new URL(url.toString());\n  strippedUrl.username = '';\n  strippedUrl.password = '';\n  return strippedUrl;\n}\n\n/**\n * This class is responsible for making a request to an endpoint that implements\n * the JSON-RPC protocol. It is designed to gracefully handle network and server\n * failures, retrying requests using exponential backoff. It also offers a hook\n * which can used to respond to slow requests.\n */\nexport class RpcService implements AbstractRpcService {\n  /**\n   * The URL of the RPC endpoint.\n   */\n  readonly endpointUrl: URL;\n\n  /**\n   * The last error that the retry policy captured (or `undefined` if the last\n   * execution of the service was successful).\n   */\n  lastError: Error | undefined;\n\n  /**\n   * The function used to make an HTTP request.\n   */\n  readonly #fetch: typeof fetch;\n\n  /**\n   * A common set of options that the request options will extend.\n   */\n  readonly #fetchOptions: FetchOptions;\n\n  /**\n   * A `loglevel` logger.\n   */\n  readonly #logger: RpcServiceOptions['logger'];\n\n  /**\n   * The policy that wraps the request.\n   */\n  readonly #policy: ServicePolicy;\n\n  /**\n   * Constructs a new RpcService object.\n   *\n   * @param options - The options. See {@link RpcServiceOptions}.\n   */\n  constructor(options: RpcServiceOptions) {\n    const {\n      btoa: givenBtoa,\n      endpointUrl,\n      fetch: givenFetch,\n      logger,\n      fetchOptions = {},\n      policyOptions = {},\n      isOffline,\n    } = options;\n\n    this.#fetch = givenFetch;\n    const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);\n    this.#fetchOptions = this.#getDefaultFetchOptions(\n      normalizedUrl,\n      fetchOptions,\n      givenBtoa,\n    );\n    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);\n    this.#logger = logger;\n\n    this.#policy = createServicePolicy({\n      maxRetries: DEFAULT_MAX_RETRIES,\n      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,\n      ...policyOptions,\n      retryFilterPolicy: handleWhen((error) => {\n        // If user is offline, don't retry any errors\n        // This prevents degraded/break callbacks from being triggered\n        if (isOffline()) {\n          return false;\n        }\n\n        return (\n          // Ignore errors where the request failed to establish\n          isConnectionError(error) ||\n          // Ignore server sent HTML error pages or truncated JSON responses\n          isJsonParseError(error) ||\n          // Ignore server overload errors\n          ('httpStatus' in error &&\n            (error.httpStatus === 502 ||\n              error.httpStatus === 503 ||\n              error.httpStatus === 504)) ||\n          (hasProperty(error, 'code') &&\n            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))\n        );\n      }),\n    });\n  }\n\n  /**\n   * Resets the underlying composite Cockatiel policy.\n   *\n   * This is useful in a collection of RpcServices where some act as failovers\n   * for others where you effectively want to invalidate the failovers when the\n   * primary recovers.\n   */\n  resetPolicy(): void {\n    this.#policy.reset();\n  }\n\n  /**\n   * @returns The state of the underlying circuit.\n   */\n  getCircuitState(): CircuitState {\n    return this.#policy.getCircuitState();\n  }\n\n  /**\n   * Listens for when the RPC service retries the request.\n   *\n   * @param listener - The callback to be called when the retry occurs.\n   * @returns What {@link ServicePolicy.onRetry} returns.\n   * @see {@link createServicePolicy}\n   */\n  onRetry(listener: Parameters<AbstractRpcService['onRetry']>[0]): IDisposable {\n    return this.#policy.onRetry((data) => {\n      listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the RPC service retries the request too many times in a\n   * row, causing the underlying circuit to break.\n   *\n   * @param listener - The callback to be called when the circuit is broken.\n   * @returns What {@link ServicePolicy.onBreak} returns.\n   * @see {@link createServicePolicy}\n   */\n  onBreak(listener: Parameters<AbstractRpcService['onBreak']>[0]): IDisposable {\n    return this.#policy.onBreak((data) => {\n      // `{ isolated: true }` is a special object that shows up when `isolate`\n      // is called on the circuit breaker. Usually `isolate` is used to hold the\n      // circuit open, but we (ab)use this method in `createServicePolicy` to\n      // reset the circuit breaker policy. When we do this, we don't want to\n      // call `onBreak` handlers, because then it causes\n      // `NetworkController:rpcEndpointUnavailable` and\n      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we\n      // have to ignore that object here. The consequence is that `isolate`\n      // doesn't function the way it is intended, at least in the context of an\n      // RpcService. However, we are making a bet that we won't need to use it\n      // other than how we are already using it.\n      if (!('isolated' in data)) {\n        listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n      }\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service detects a slow\n   * request.\n   *\n   * @param listener - The callback to be called when the request is slow.\n   * @returns What {@link ServicePolicy.onDegraded} returns.\n   * @see {@link createServicePolicy}\n   */\n  onDegraded(\n    listener: Parameters<AbstractRpcService['onDegraded']>[0],\n  ): IDisposable {\n    return this.#policy.onDegraded((data) => {\n      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service is available.\n   *\n   * @param listener - The callback to be called when the request is available.\n   * @returns What {@link ServicePolicy.onAvailable} returns.\n   * @see {@link createServicePolicy}\n   */\n  onAvailable(\n    listener: Parameters<AbstractRpcService['onAvailable']>[0],\n  ): IDisposable {\n    return this.#policy.onAvailable(() => {\n      listener({ endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is specifically designed for `eth_getBlockByNumber`, which\n   * can return a `result` of `null` despite an expected `Result` being\n   * provided.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params> & { method: 'eth_getBlockByNumber' },\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>>;\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is designed for all RPC methods except for\n   * `eth_getBlockByNumber`, which are expected to return a `result` of the\n   * expected `Result`.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params>,\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result>>;\n\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    // The request object may be frozen and must not be mutated.\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions = {},\n  ): Promise<JsonRpcResponse<Result | null>> {\n    const completeFetchOptions = this.#getCompleteFetchOptions(\n      jsonRpcRequest,\n      fetchOptions,\n    );\n    return await this.#executeAndProcessRequest<Result>(completeFetchOptions);\n  }\n\n  /**\n   * Constructs a default set of options to `fetch`.\n   *\n   * If a username and password are present in the URL, they are extracted to an\n   * Authorization header.\n   *\n   * @param endpointUrl - The endpoint URL.\n   * @param fetchOptions - The options to `fetch`.\n   * @param givenBtoa - An implementation of `btoa`.\n   * @returns The default fetch options.\n   */\n  #getDefaultFetchOptions(\n    endpointUrl: URL,\n    fetchOptions: FetchOptions,\n    givenBtoa: (stringToEncode: string) => string,\n  ): FetchOptions {\n    if (endpointUrl.username && endpointUrl.password) {\n      const authString = `${endpointUrl.username}:${endpointUrl.password}`;\n      const encodedCredentials = givenBtoa(authString);\n      return deepmerge(fetchOptions, {\n        headers: { Authorization: `Basic ${encodedCredentials}` },\n      });\n    }\n\n    return fetchOptions;\n  }\n\n  /**\n   * Constructs a final set of options to pass to `fetch`. Note that the method\n   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request.\n   * @param fetchOptions - Custom `fetch` options.\n   * @returns The complete set of `fetch` options.\n   */\n  #getCompleteFetchOptions<Params extends JsonRpcParams>(\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions,\n  ): FetchOptions {\n    const defaultOptions = {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n    };\n    const mergedOptions = deepmerge(\n      defaultOptions,\n      deepmerge(this.#fetchOptions, fetchOptions),\n    );\n\n    const { id, jsonrpc, method, params } = jsonRpcRequest;\n    const body = JSON.stringify({\n      id,\n      jsonrpc,\n      method,\n      params,\n    });\n\n    return { ...mergedOptions, body };\n  }\n\n  /**\n   * Makes the request using the Cockatiel policy that this service creates.\n   *\n   * @param fetchOptions - The options for `fetch`; will be combined with the\n   * fetch options passed to the constructor\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async #executeAndProcessRequest<Result extends Json>(\n    fetchOptions: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>> {\n    let response: Response | undefined;\n    try {\n      log(\n        `[${this.endpointUrl}] Circuit state`,\n        this.#policy.getCircuitState(),\n      );\n      const jsonDecodedResponse = await this.#policy.execute(\n        async (context) => {\n          log(\n            'REQUEST INITIATED:',\n            this.endpointUrl.toString(),\n            '::',\n            fetchOptions,\n            // @ts-expect-error This property _is_ here, the type of\n            // ServicePolicy is just wrong.\n            `(attempt ${context.attempt + 1})`,\n          );\n          response = await this.#fetch(this.endpointUrl, fetchOptions);\n          if (!response.ok) {\n            throw new HttpError(response.status);\n          }\n          log(\n            'REQUEST SUCCESSFUL:',\n            this.endpointUrl.toString(),\n            response.status,\n          );\n          return await response.json();\n        },\n      );\n      this.lastError = undefined;\n      return jsonDecodedResponse;\n    } catch (error) {\n      log('REQUEST ERROR:', this.endpointUrl.toString(), error);\n\n      this.lastError =\n        error instanceof Error ? error : new Error(getErrorMessage(error));\n\n      if (error instanceof HttpError) {\n        const status = error.httpStatus;\n        if (status === 401) {\n          throw new JsonRpcError(\n            CUSTOM_RPC_ERRORS.unauthorized,\n            'Unauthorized.',\n            {\n              httpStatus: status,\n            },\n          );\n        }\n        if (status === 429) {\n          throw rpcErrors.limitExceeded({\n            message: 'Request is being rate limited.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n        if (status >= 500 || status === 402 || status === 404) {\n          throw rpcErrors.resourceUnavailable({\n            message: 'RPC endpoint not found or unavailable.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n\n        // Handle all other 4xx errors as generic HTTP client errors\n        throw new JsonRpcError(\n          CUSTOM_RPC_ERRORS.httpClientError,\n          'RPC endpoint returned HTTP client error.',\n          {\n            httpStatus: status,\n          },\n        );\n      } else if (isJsonParseError(error)) {\n        throw rpcErrors.parse({\n          message: 'RPC endpoint did not return JSON.',\n        });\n      } else if (error instanceof BrokenCircuitError) {\n        this.#logger?.warn(error);\n        const remainingCircuitOpenDuration =\n          this.#policy.getRemainingCircuitOpenDuration();\n        const formattedRemainingCircuitOpenDuration = Intl.NumberFormat(\n          undefined,\n          { maximumFractionDigits: 2 },\n        ).format(\n          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /\n            Duration.Minute,\n        );\n        throw rpcErrors.resourceUnavailable({\n          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,\n        });\n      }\n      throw error;\n    }\n  }\n}\n"]}
\ No newline at end of file
diff --git a/dist/rpc-service/rpc-service.d.cts b/dist/rpc-service/rpc-service.d.cts
index 0b7ad92a3bd959dc067585e1a289688e6c5d9395..5753ba3b2fe2e7e54bd5f89fec74ebd743ee21cf 100644
--- a/dist/rpc-service/rpc-service.d.cts
+++ b/dist/rpc-service/rpc-service.d.cts
@@ -37,6 +37,12 @@ export type RpcServiceOptions = {
      * not accepted, as it is overwritten. See {@link createServicePolicy}.
      */
     policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;
+    /**
+     * A function that checks if the user is currently offline. If it returns true,
+     * connection errors will not be retried, preventing degraded and break
+     * callbacks from being triggered.
+     */
+    isOffline: () => boolean;
 };
 /**
  * The maximum number of times that a failing service should be re-run before
diff --git a/dist/rpc-service/rpc-service.d.cts.map b/dist/rpc-service/rpc-service.d.cts.map
index 235245d033c0850df40c3c6de9e84c95993ccd74..b2e0ad2581f6faa9cada1598941cf4b5ea12c5a0 100644
--- a/dist/rpc-service/rpc-service.d.cts.map
+++ b/dist/rpc-service/rpc-service.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"rpc-service.d.cts","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EACV,0BAA0B,EAE3B,mCAAmC;AASpC,OAAO,KAAK,EACV,IAAI,EACJ,aAAa,EACb,cAAc,EACd,eAAe,EAChB,wBAAwB;AACzB,OAAO,EAAE,YAAY,EAAE,WAAW,EAAE,kBAAkB;AAEtD,OAAO,KAAK,EAAE,MAAM,EAAE,iBAAiB;AAEvC,OAAO,KAAK,EAAE,kBAAkB,EAAE,mCAA+B;AACjE,OAAO,KAAK,EAAE,YAAY,EAAE,qBAAiB;AAG7C;;GAEG;AACH,MAAM,MAAM,iBAAiB,GAAG;IAC9B;;;OAGG;IACH,IAAI,EAAE,OAAO,IAAI,CAAC;IAClB;;OAEG;IACH,WAAW,EAAE,GAAG,GAAG,MAAM,CAAC;IAC1B;;;;OAIG;IACH,KAAK,EAAE,OAAO,KAAK,CAAC;IACpB;;;OAGG;IACH,YAAY,CAAC,EAAE,YAAY,CAAC;IAC5B;;OAEG;IACH,MAAM,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;IAC9B;;;OAGG;IACH,aAAa,CAAC,EAAE,IAAI,CAAC,0BAA0B,EAAE,mBAAmB,CAAC,CAAC;CACvE,CAAC;AAIF;;;GAGG;AACH,eAAO,MAAM,mBAAmB,IAAI,CAAC;AAErC;;;;;GAKG;AACH,eAAO,MAAM,gCAAgC,QAAgC,CAAC;AAE9E;;;;;GAKG;AACH,eAAO,MAAM,iBAAiB;;;GA8C7B,CAAC;AAEF;;;;GAIG;AACH,eAAO,MAAM,iBAAiB;;;CAGpB,CAAC;AAEX;;;;;;;;;;;GAWG;AACH,wBAAgB,iBAAiB,CAAC,KAAK,EAAE,OAAO,GAAG,OAAO,CAgBzD;AA2DD;;;;;GAKG;AACH,qBAAa,UAAW,YAAW,kBAAkB;;IACnD;;OAEG;IACH,QAAQ,CAAC,WAAW,EAAE,GAAG,CAAC;IAE1B;;;OAGG;IACH,SAAS,EAAE,KAAK,GAAG,SAAS,CAAC;IAsB7B;;;;OAIG;gBACS,OAAO,EAAE,iBAAiB;IA0CtC;;;;;;OAMG;IACH,WAAW,IAAI,IAAI;IAInB;;OAEG;IACH,eAAe,IAAI,YAAY;IAI/B;;;;;;OAMG;IACH,OAAO,CAAC,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW;IAM5E;;;;;;;OAOG;IACH,OAAO,CAAC,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW;IAmB5E;;;;;;;OAOG;IACH,UAAU,CACR,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,GACxD,WAAW;IAMd;;;;;;OAMG;IACH,WAAW,CACT,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,GACzD,WAAW;IAMd;;;;;;;;;;;;;;;;OAgBG;IACG,OAAO,CAAC,MAAM,SAAS,aAAa,EAAE,MAAM,SAAS,IAAI,EAC7D,cAAc,EAAE,cAAc,CAAC,MAAM,CAAC,GAAG;QAAE,MAAM,EAAE,sBAAsB,CAAA;KAAE,EAC3E,YAAY,CAAC,EAAE,YAAY,GAC1B,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC;IAE3D;;;;;;;;;;;;;;;;OAgBG;IACG,OAAO,CAAC,MAAM,SAAS,aAAa,EAAE,MAAM,SAAS,IAAI,EAC7D,cAAc,EAAE,cAAc,CAAC,MAAM,CAAC,EACtC,YAAY,CAAC,EAAE,YAAY,GAC1B,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;CA0LpC"}
\ No newline at end of file
+{"version":3,"file":"rpc-service.d.cts","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/rpc-service/rpc-service.d.mts b/dist/rpc-service/rpc-service.d.mts
index 9cf5a09039b9bb34d3fb17bce158fcdae5a36aea..533f24ff1d9ca953496dd8cf84697573d55b7dc5 100644
--- a/dist/rpc-service/rpc-service.d.mts
+++ b/dist/rpc-service/rpc-service.d.mts
@@ -37,6 +37,12 @@ export type RpcServiceOptions = {
      * not accepted, as it is overwritten. See {@link createServicePolicy}.
      */
     policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;
+    /**
+     * A function that checks if the user is currently offline. If it returns true,
+     * connection errors will not be retried, preventing degraded and break
+     * callbacks from being triggered.
+     */
+    isOffline: () => boolean;
 };
 /**
  * The maximum number of times that a failing service should be re-run before
diff --git a/dist/rpc-service/rpc-service.d.mts.map b/dist/rpc-service/rpc-service.d.mts.map
index fc448c50e64ab5ee692336b78a2d33ee8344e97c..3165f98664d88e8639d5d460c4f764df9e0f627b 100644
--- a/dist/rpc-service/rpc-service.d.mts.map
+++ b/dist/rpc-service/rpc-service.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"rpc-service.d.mts","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EACV,0BAA0B,EAE3B,mCAAmC;AASpC,OAAO,KAAK,EACV,IAAI,EACJ,aAAa,EACb,cAAc,EACd,eAAe,EAChB,wBAAwB;AACzB,OAAO,EAAE,YAAY,EAAE,WAAW,EAAE,kBAAkB;AAEtD,OAAO,KAAK,EAAE,MAAM,EAAE,iBAAiB;AAEvC,OAAO,KAAK,EAAE,kBAAkB,EAAE,mCAA+B;AACjE,OAAO,KAAK,EAAE,YAAY,EAAE,qBAAiB;AAG7C;;GAEG;AACH,MAAM,MAAM,iBAAiB,GAAG;IAC9B;;;OAGG;IACH,IAAI,EAAE,OAAO,IAAI,CAAC;IAClB;;OAEG;IACH,WAAW,EAAE,GAAG,GAAG,MAAM,CAAC;IAC1B;;;;OAIG;IACH,KAAK,EAAE,OAAO,KAAK,CAAC;IACpB;;;OAGG;IACH,YAAY,CAAC,EAAE,YAAY,CAAC;IAC5B;;OAEG;IACH,MAAM,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;IAC9B;;;OAGG;IACH,aAAa,CAAC,EAAE,IAAI,CAAC,0BAA0B,EAAE,mBAAmB,CAAC,CAAC;CACvE,CAAC;AAIF;;;GAGG;AACH,eAAO,MAAM,mBAAmB,IAAI,CAAC;AAErC;;;;;GAKG;AACH,eAAO,MAAM,gCAAgC,QAAgC,CAAC;AAE9E;;;;;GAKG;AACH,eAAO,MAAM,iBAAiB;;;GA8C7B,CAAC;AAEF;;;;GAIG;AACH,eAAO,MAAM,iBAAiB;;;CAGpB,CAAC;AAEX;;;;;;;;;;;GAWG;AACH,wBAAgB,iBAAiB,CAAC,KAAK,EAAE,OAAO,GAAG,OAAO,CAgBzD;AA2DD;;;;;GAKG;AACH,qBAAa,UAAW,YAAW,kBAAkB;;IACnD;;OAEG;IACH,QAAQ,CAAC,WAAW,EAAE,GAAG,CAAC;IAE1B;;;OAGG;IACH,SAAS,EAAE,KAAK,GAAG,SAAS,CAAC;IAsB7B;;;;OAIG;gBACS,OAAO,EAAE,iBAAiB;IA0CtC;;;;;;OAMG;IACH,WAAW,IAAI,IAAI;IAInB;;OAEG;IACH,eAAe,IAAI,YAAY;IAI/B;;;;;;OAMG;IACH,OAAO,CAAC,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW;IAM5E;;;;;;;OAOG;IACH,OAAO,CAAC,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW;IAmB5E;;;;;;;OAOG;IACH,UAAU,CACR,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,GACxD,WAAW;IAMd;;;;;;OAMG;IACH,WAAW,CACT,QAAQ,EAAE,UAAU,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,GACzD,WAAW;IAMd;;;;;;;;;;;;;;;;OAgBG;IACG,OAAO,CAAC,MAAM,SAAS,aAAa,EAAE,MAAM,SAAS,IAAI,EAC7D,cAAc,EAAE,cAAc,CAAC,MAAM,CAAC,GAAG;QAAE,MAAM,EAAE,sBAAsB,CAAA;KAAE,EAC3E,YAAY,CAAC,EAAE,YAAY,GAC1B,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC;IAE3D;;;;;;;;;;;;;;;;OAgBG;IACG,OAAO,CAAC,MAAM,SAAS,aAAa,EAAE,MAAM,SAAS,IAAI,EAC7D,cAAc,EAAE,cAAc,CAAC,MAAM,CAAC,EACtC,YAAY,CAAC,EAAE,YAAY,GAC1B,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;CA0LpC"}
\ No newline at end of file
+{"version":3,"file":"rpc-service.d.mts","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/rpc-service/rpc-service.mjs b/dist/rpc-service/rpc-service.mjs
index 7ff80b10d29ac172b3acdb9efeb5a880f7c63071..c982fe7cf00aec624e3a3573cd112356f948e0bf 100644
--- a/dist/rpc-service/rpc-service.mjs
+++ b/dist/rpc-service/rpc-service.mjs
@@ -202,7 +202,7 @@ export class RpcService {
          * The policy that wraps the request.
          */
         _RpcService_policy.set(this, void 0);
-        const { btoa: givenBtoa, endpointUrl, fetch: givenFetch, logger, fetchOptions = {}, policyOptions = {}, } = options;
+        const { btoa: givenBtoa, endpointUrl, fetch: givenFetch, logger, fetchOptions = {}, policyOptions = {}, isOffline, } = options;
         __classPrivateFieldSet(this, _RpcService_fetch, givenFetch, "f");
         const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);
         __classPrivateFieldSet(this, _RpcService_fetchOptions, __classPrivateFieldGet(this, _RpcService_instances, "m", _RpcService_getDefaultFetchOptions).call(this, normalizedUrl, fetchOptions, givenBtoa), "f");
@@ -213,6 +213,11 @@ export class RpcService {
             maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,
             ...policyOptions,
             retryFilterPolicy: handleWhen((error) => {
+                // If user is offline, don't retry any errors
+                // This prevents degraded/break callbacks from being triggered
+                if (isOffline()) {
+                    return false;
+                }
                 return (
                 // Ignore errors where the request failed to establish
                 isConnectionError(error) ||
diff --git a/dist/rpc-service/rpc-service.mjs.map b/dist/rpc-service/rpc-service.mjs.map
index 43dff9e5cb83a3e5ea0796b50cbd61e97b2f1f40..db852370a1a31e5b43d1da1dfc70031497ac4484 100644
--- a/dist/rpc-service/rpc-service.mjs.map
+++ b/dist/rpc-service/rpc-service.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"rpc-service.mjs","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  CreateServicePolicyOptions,\n  ServicePolicy,\n} from '@metamask/controller-utils';\nimport {\n  BrokenCircuitError,\n  HttpError,\n  createServicePolicy,\n  handleWhen,\n} from '@metamask/controller-utils';\nimport { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';\nimport { Duration, getErrorMessage, hasProperty } from '@metamask/utils';\nimport type {\n  Json,\n  JsonRpcParams,\n  JsonRpcRequest,\n  JsonRpcResponse,\n} from '@metamask/utils';\nimport { CircuitState, IDisposable } from 'cockatiel';\nimport deepmerge from 'deepmerge';\nimport type { Logger } from 'loglevel';\n\nimport type { AbstractRpcService } from './abstract-rpc-service';\nimport type { FetchOptions } from './shared';\nimport { projectLogger, createModuleLogger } from '../logger';\n\n/**\n * Options for the RpcService constructor.\n */\nexport type RpcServiceOptions = {\n  /**\n   * A function that can be used to convert a binary string into a\n   * base64-encoded ASCII string. Used to encode authorization credentials.\n   */\n  btoa: typeof btoa;\n  /**\n   * The URL of the RPC endpoint to hit.\n   */\n  endpointUrl: URL | string;\n  /**\n   * A function that can be used to make an HTTP request. If your JavaScript\n   * environment supports `fetch` natively, you'll probably want to pass that;\n   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).\n   */\n  fetch: typeof fetch;\n  /**\n   * A common set of options that will be used to make every request. Can be\n   * overridden on the request level (e.g. to add headers).\n   */\n  fetchOptions?: FetchOptions;\n  /**\n   * A `loglevel` logger.\n   */\n  logger?: Pick<Logger, 'warn'>;\n  /**\n   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is\n   * not accepted, as it is overwritten. See {@link createServicePolicy}.\n   */\n  policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;\n};\n\nconst log = createModuleLogger(projectLogger, 'RpcService');\n\n/**\n * The maximum number of times that a failing service should be re-run before\n * giving up.\n */\nexport const DEFAULT_MAX_RETRIES = 4;\n\n/**\n * The maximum number of times that the service is allowed to fail before\n * pausing further retries. This is set to a value such that if given a\n * service that continually fails, the policy needs to be executed 3 times\n * before further retries are paused.\n */\nexport const DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;\n\n/**\n * The list of error messages that represent a failure to connect to the network.\n *\n * This list was derived from Sindre Sorhus's `is-network-error` package:\n * <https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js>\n */\nexport const CONNECTION_ERRORS = [\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /network error/u,\n  },\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /Failed to fetch/u,\n  },\n  // Firefox\n  {\n    constructorName: 'TypeError',\n    pattern: /NetworkError when attempting to fetch resource\\./u,\n  },\n  // Safari 16\n  {\n    constructorName: 'TypeError',\n    pattern: /The Internet connection appears to be offline\\./u,\n  },\n  // Safari 17+\n  {\n    constructorName: 'TypeError',\n    pattern: /Load failed/u,\n  },\n  // `cross-fetch`\n  {\n    constructorName: 'TypeError',\n    pattern: /Network request failed/u,\n  },\n  // `node-fetch`\n  {\n    constructorName: 'FetchError',\n    pattern: /request to (.+) failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /fetch failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /terminated/u,\n  },\n];\n\n/**\n * Custom JSON-RPC error codes for specific cases.\n *\n * These should be moved to `@metamask/rpc-errors` eventually.\n */\nexport const CUSTOM_RPC_ERRORS = {\n  unauthorized: -32006,\n  httpClientError: -32080,\n} as const;\n\n/**\n * Determines whether the given error represents a failure to reach the network\n * after request parameters have been validated.\n *\n * This is somewhat difficult to verify because JavaScript engines (and in\n * some cases libraries) produce slightly different error messages for this\n * particular scenario, and we need to account for this.\n *\n * @param error - The error.\n * @returns True if the error indicates that the network cannot be connected to,\n * and false otherwise.\n */\nexport function isConnectionError(error: unknown): boolean {\n  if (!(typeof error === 'object' && error !== null && 'message' in error)) {\n    return false;\n  }\n\n  const { message } = error;\n\n  return (\n    typeof message === 'string' &&\n    !isNockError(message) &&\n    CONNECTION_ERRORS.some(({ constructorName, pattern }) => {\n      return (\n        error.constructor.name === constructorName && pattern.test(message)\n      );\n    })\n  );\n}\n\n/**\n * Determines whether the given error message refers to a Nock error.\n *\n * It's important that if we failed to mock a request in a test, the resulting\n * error does not cause the request to be retried so that we can see it right\n * away.\n *\n * @param message - The error message to test.\n * @returns True if the message indicates a missing Nock mock, false otherwise.\n */\nfunction isNockError(message: string): boolean {\n  return message.includes('Nock:');\n}\n\n/**\n * Determine whether the given error message indicates a failure to parse JSON.\n *\n * This is different in tests vs. implementation code because it may manifest as\n * a FetchError or a SyntaxError.\n *\n * @param error - The error object to test.\n * @returns True if the error indicates a JSON parse error, false otherwise.\n */\nfunction isJsonParseError(error: unknown): boolean {\n  return (\n    error instanceof SyntaxError ||\n    /invalid json/iu.test(getErrorMessage(error))\n  );\n}\n\n/**\n * Guarantees a URL, even given a string. This is useful for checking components\n * of that URL.\n *\n * @param endpointUrlOrUrlString - Either a URL object or a string that\n * represents the URL of an endpoint.\n * @returns A URL object.\n */\nfunction getNormalizedEndpointUrl(endpointUrlOrUrlString: URL | string): URL {\n  return endpointUrlOrUrlString instanceof URL\n    ? endpointUrlOrUrlString\n    : new URL(endpointUrlOrUrlString);\n}\n\n/**\n * Strips username and password from a URL.\n *\n * @param url - The URL to strip credentials from.\n * @returns A new URL object with credentials removed.\n */\nfunction stripCredentialsFromUrl(url: URL): URL {\n  const strippedUrl = new URL(url.toString());\n  strippedUrl.username = '';\n  strippedUrl.password = '';\n  return strippedUrl;\n}\n\n/**\n * This class is responsible for making a request to an endpoint that implements\n * the JSON-RPC protocol. It is designed to gracefully handle network and server\n * failures, retrying requests using exponential backoff. It also offers a hook\n * which can used to respond to slow requests.\n */\nexport class RpcService implements AbstractRpcService {\n  /**\n   * The URL of the RPC endpoint.\n   */\n  readonly endpointUrl: URL;\n\n  /**\n   * The last error that the retry policy captured (or `undefined` if the last\n   * execution of the service was successful).\n   */\n  lastError: Error | undefined;\n\n  /**\n   * The function used to make an HTTP request.\n   */\n  readonly #fetch: typeof fetch;\n\n  /**\n   * A common set of options that the request options will extend.\n   */\n  readonly #fetchOptions: FetchOptions;\n\n  /**\n   * A `loglevel` logger.\n   */\n  readonly #logger: RpcServiceOptions['logger'];\n\n  /**\n   * The policy that wraps the request.\n   */\n  readonly #policy: ServicePolicy;\n\n  /**\n   * Constructs a new RpcService object.\n   *\n   * @param options - The options. See {@link RpcServiceOptions}.\n   */\n  constructor(options: RpcServiceOptions) {\n    const {\n      btoa: givenBtoa,\n      endpointUrl,\n      fetch: givenFetch,\n      logger,\n      fetchOptions = {},\n      policyOptions = {},\n    } = options;\n\n    this.#fetch = givenFetch;\n    const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);\n    this.#fetchOptions = this.#getDefaultFetchOptions(\n      normalizedUrl,\n      fetchOptions,\n      givenBtoa,\n    );\n    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);\n    this.#logger = logger;\n\n    this.#policy = createServicePolicy({\n      maxRetries: DEFAULT_MAX_RETRIES,\n      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,\n      ...policyOptions,\n      retryFilterPolicy: handleWhen((error) => {\n        return (\n          // Ignore errors where the request failed to establish\n          isConnectionError(error) ||\n          // Ignore server sent HTML error pages or truncated JSON responses\n          isJsonParseError(error) ||\n          // Ignore server overload errors\n          ('httpStatus' in error &&\n            (error.httpStatus === 502 ||\n              error.httpStatus === 503 ||\n              error.httpStatus === 504)) ||\n          (hasProperty(error, 'code') &&\n            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))\n        );\n      }),\n    });\n  }\n\n  /**\n   * Resets the underlying composite Cockatiel policy.\n   *\n   * This is useful in a collection of RpcServices where some act as failovers\n   * for others where you effectively want to invalidate the failovers when the\n   * primary recovers.\n   */\n  resetPolicy(): void {\n    this.#policy.reset();\n  }\n\n  /**\n   * @returns The state of the underlying circuit.\n   */\n  getCircuitState(): CircuitState {\n    return this.#policy.getCircuitState();\n  }\n\n  /**\n   * Listens for when the RPC service retries the request.\n   *\n   * @param listener - The callback to be called when the retry occurs.\n   * @returns What {@link ServicePolicy.onRetry} returns.\n   * @see {@link createServicePolicy}\n   */\n  onRetry(listener: Parameters<AbstractRpcService['onRetry']>[0]): IDisposable {\n    return this.#policy.onRetry((data) => {\n      listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the RPC service retries the request too many times in a\n   * row, causing the underlying circuit to break.\n   *\n   * @param listener - The callback to be called when the circuit is broken.\n   * @returns What {@link ServicePolicy.onBreak} returns.\n   * @see {@link createServicePolicy}\n   */\n  onBreak(listener: Parameters<AbstractRpcService['onBreak']>[0]): IDisposable {\n    return this.#policy.onBreak((data) => {\n      // `{ isolated: true }` is a special object that shows up when `isolate`\n      // is called on the circuit breaker. Usually `isolate` is used to hold the\n      // circuit open, but we (ab)use this method in `createServicePolicy` to\n      // reset the circuit breaker policy. When we do this, we don't want to\n      // call `onBreak` handlers, because then it causes\n      // `NetworkController:rpcEndpointUnavailable` and\n      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we\n      // have to ignore that object here. The consequence is that `isolate`\n      // doesn't function the way it is intended, at least in the context of an\n      // RpcService. However, we are making a bet that we won't need to use it\n      // other than how we are already using it.\n      if (!('isolated' in data)) {\n        listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n      }\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service detects a slow\n   * request.\n   *\n   * @param listener - The callback to be called when the request is slow.\n   * @returns What {@link ServicePolicy.onDegraded} returns.\n   * @see {@link createServicePolicy}\n   */\n  onDegraded(\n    listener: Parameters<AbstractRpcService['onDegraded']>[0],\n  ): IDisposable {\n    return this.#policy.onDegraded((data) => {\n      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service is available.\n   *\n   * @param listener - The callback to be called when the request is available.\n   * @returns What {@link ServicePolicy.onAvailable} returns.\n   * @see {@link createServicePolicy}\n   */\n  onAvailable(\n    listener: Parameters<AbstractRpcService['onAvailable']>[0],\n  ): IDisposable {\n    return this.#policy.onAvailable(() => {\n      listener({ endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is specifically designed for `eth_getBlockByNumber`, which\n   * can return a `result` of `null` despite an expected `Result` being\n   * provided.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params> & { method: 'eth_getBlockByNumber' },\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>>;\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is designed for all RPC methods except for\n   * `eth_getBlockByNumber`, which are expected to return a `result` of the\n   * expected `Result`.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params>,\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result>>;\n\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    // The request object may be frozen and must not be mutated.\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions = {},\n  ): Promise<JsonRpcResponse<Result | null>> {\n    const completeFetchOptions = this.#getCompleteFetchOptions(\n      jsonRpcRequest,\n      fetchOptions,\n    );\n    return await this.#executeAndProcessRequest<Result>(completeFetchOptions);\n  }\n\n  /**\n   * Constructs a default set of options to `fetch`.\n   *\n   * If a username and password are present in the URL, they are extracted to an\n   * Authorization header.\n   *\n   * @param endpointUrl - The endpoint URL.\n   * @param fetchOptions - The options to `fetch`.\n   * @param givenBtoa - An implementation of `btoa`.\n   * @returns The default fetch options.\n   */\n  #getDefaultFetchOptions(\n    endpointUrl: URL,\n    fetchOptions: FetchOptions,\n    givenBtoa: (stringToEncode: string) => string,\n  ): FetchOptions {\n    if (endpointUrl.username && endpointUrl.password) {\n      const authString = `${endpointUrl.username}:${endpointUrl.password}`;\n      const encodedCredentials = givenBtoa(authString);\n      return deepmerge(fetchOptions, {\n        headers: { Authorization: `Basic ${encodedCredentials}` },\n      });\n    }\n\n    return fetchOptions;\n  }\n\n  /**\n   * Constructs a final set of options to pass to `fetch`. Note that the method\n   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request.\n   * @param fetchOptions - Custom `fetch` options.\n   * @returns The complete set of `fetch` options.\n   */\n  #getCompleteFetchOptions<Params extends JsonRpcParams>(\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions,\n  ): FetchOptions {\n    const defaultOptions = {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n    };\n    const mergedOptions = deepmerge(\n      defaultOptions,\n      deepmerge(this.#fetchOptions, fetchOptions),\n    );\n\n    const { id, jsonrpc, method, params } = jsonRpcRequest;\n    const body = JSON.stringify({\n      id,\n      jsonrpc,\n      method,\n      params,\n    });\n\n    return { ...mergedOptions, body };\n  }\n\n  /**\n   * Makes the request using the Cockatiel policy that this service creates.\n   *\n   * @param fetchOptions - The options for `fetch`; will be combined with the\n   * fetch options passed to the constructor\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async #executeAndProcessRequest<Result extends Json>(\n    fetchOptions: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>> {\n    let response: Response | undefined;\n    try {\n      log(\n        `[${this.endpointUrl}] Circuit state`,\n        this.#policy.getCircuitState(),\n      );\n      const jsonDecodedResponse = await this.#policy.execute(\n        async (context) => {\n          log(\n            'REQUEST INITIATED:',\n            this.endpointUrl.toString(),\n            '::',\n            fetchOptions,\n            // @ts-expect-error This property _is_ here, the type of\n            // ServicePolicy is just wrong.\n            `(attempt ${context.attempt + 1})`,\n          );\n          response = await this.#fetch(this.endpointUrl, fetchOptions);\n          if (!response.ok) {\n            throw new HttpError(response.status);\n          }\n          log(\n            'REQUEST SUCCESSFUL:',\n            this.endpointUrl.toString(),\n            response.status,\n          );\n          return await response.json();\n        },\n      );\n      this.lastError = undefined;\n      return jsonDecodedResponse;\n    } catch (error) {\n      log('REQUEST ERROR:', this.endpointUrl.toString(), error);\n\n      this.lastError =\n        error instanceof Error ? error : new Error(getErrorMessage(error));\n\n      if (error instanceof HttpError) {\n        const status = error.httpStatus;\n        if (status === 401) {\n          throw new JsonRpcError(\n            CUSTOM_RPC_ERRORS.unauthorized,\n            'Unauthorized.',\n            {\n              httpStatus: status,\n            },\n          );\n        }\n        if (status === 429) {\n          throw rpcErrors.limitExceeded({\n            message: 'Request is being rate limited.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n        if (status >= 500 || status === 402 || status === 404) {\n          throw rpcErrors.resourceUnavailable({\n            message: 'RPC endpoint not found or unavailable.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n\n        // Handle all other 4xx errors as generic HTTP client errors\n        throw new JsonRpcError(\n          CUSTOM_RPC_ERRORS.httpClientError,\n          'RPC endpoint returned HTTP client error.',\n          {\n            httpStatus: status,\n          },\n        );\n      } else if (isJsonParseError(error)) {\n        throw rpcErrors.parse({\n          message: 'RPC endpoint did not return JSON.',\n        });\n      } else if (error instanceof BrokenCircuitError) {\n        this.#logger?.warn(error);\n        const remainingCircuitOpenDuration =\n          this.#policy.getRemainingCircuitOpenDuration();\n        const formattedRemainingCircuitOpenDuration = Intl.NumberFormat(\n          undefined,\n          { maximumFractionDigits: 2 },\n        ).format(\n          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /\n            Duration.Minute,\n        );\n        throw rpcErrors.resourceUnavailable({\n          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,\n        });\n      }\n      throw error;\n    }\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"rpc-service.mjs","sourceRoot":"","sources":["../../src/rpc-service/rpc-service.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  CreateServicePolicyOptions,\n  ServicePolicy,\n} from '@metamask/controller-utils';\nimport {\n  BrokenCircuitError,\n  HttpError,\n  createServicePolicy,\n  handleWhen,\n} from '@metamask/controller-utils';\nimport { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';\nimport { Duration, getErrorMessage, hasProperty } from '@metamask/utils';\nimport type {\n  Json,\n  JsonRpcParams,\n  JsonRpcRequest,\n  JsonRpcResponse,\n} from '@metamask/utils';\nimport { CircuitState, IDisposable } from 'cockatiel';\nimport deepmerge from 'deepmerge';\nimport type { Logger } from 'loglevel';\n\nimport type { AbstractRpcService } from './abstract-rpc-service';\nimport type { FetchOptions } from './shared';\nimport { projectLogger, createModuleLogger } from '../logger';\n\n/**\n * Options for the RpcService constructor.\n */\nexport type RpcServiceOptions = {\n  /**\n   * A function that can be used to convert a binary string into a\n   * base64-encoded ASCII string. Used to encode authorization credentials.\n   */\n  btoa: typeof btoa;\n  /**\n   * The URL of the RPC endpoint to hit.\n   */\n  endpointUrl: URL | string;\n  /**\n   * A function that can be used to make an HTTP request. If your JavaScript\n   * environment supports `fetch` natively, you'll probably want to pass that;\n   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).\n   */\n  fetch: typeof fetch;\n  /**\n   * A common set of options that will be used to make every request. Can be\n   * overridden on the request level (e.g. to add headers).\n   */\n  fetchOptions?: FetchOptions;\n  /**\n   * A `loglevel` logger.\n   */\n  logger?: Pick<Logger, 'warn'>;\n  /**\n   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is\n   * not accepted, as it is overwritten. See {@link createServicePolicy}.\n   */\n  policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;\n  /**\n   * A function that checks if the user is currently offline. If it returns true,\n   * connection errors will not be retried, preventing degraded and break\n   * callbacks from being triggered.\n   */\n  isOffline: () => boolean;\n};\n\nconst log = createModuleLogger(projectLogger, 'RpcService');\n\n/**\n * The maximum number of times that a failing service should be re-run before\n * giving up.\n */\nexport const DEFAULT_MAX_RETRIES = 4;\n\n/**\n * The maximum number of times that the service is allowed to fail before\n * pausing further retries. This is set to a value such that if given a\n * service that continually fails, the policy needs to be executed 3 times\n * before further retries are paused.\n */\nexport const DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;\n\n/**\n * The list of error messages that represent a failure to connect to the network.\n *\n * This list was derived from Sindre Sorhus's `is-network-error` package:\n * <https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js>\n */\nexport const CONNECTION_ERRORS = [\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /network error/u,\n  },\n  // Chrome\n  {\n    constructorName: 'TypeError',\n    pattern: /Failed to fetch/u,\n  },\n  // Firefox\n  {\n    constructorName: 'TypeError',\n    pattern: /NetworkError when attempting to fetch resource\\./u,\n  },\n  // Safari 16\n  {\n    constructorName: 'TypeError',\n    pattern: /The Internet connection appears to be offline\\./u,\n  },\n  // Safari 17+\n  {\n    constructorName: 'TypeError',\n    pattern: /Load failed/u,\n  },\n  // `cross-fetch`\n  {\n    constructorName: 'TypeError',\n    pattern: /Network request failed/u,\n  },\n  // `node-fetch`\n  {\n    constructorName: 'FetchError',\n    pattern: /request to (.+) failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /fetch failed/u,\n  },\n  // Undici (Node.js)\n  {\n    constructorName: 'TypeError',\n    pattern: /terminated/u,\n  },\n];\n\n/**\n * Custom JSON-RPC error codes for specific cases.\n *\n * These should be moved to `@metamask/rpc-errors` eventually.\n */\nexport const CUSTOM_RPC_ERRORS = {\n  unauthorized: -32006,\n  httpClientError: -32080,\n} as const;\n\n/**\n * Determines whether the given error represents a failure to reach the network\n * after request parameters have been validated.\n *\n * This is somewhat difficult to verify because JavaScript engines (and in\n * some cases libraries) produce slightly different error messages for this\n * particular scenario, and we need to account for this.\n *\n * @param error - The error.\n * @returns True if the error indicates that the network cannot be connected to,\n * and false otherwise.\n */\nexport function isConnectionError(error: unknown): boolean {\n  if (!(typeof error === 'object' && error !== null && 'message' in error)) {\n    return false;\n  }\n\n  const { message } = error;\n\n  return (\n    typeof message === 'string' &&\n    !isNockError(message) &&\n    CONNECTION_ERRORS.some(({ constructorName, pattern }) => {\n      return (\n        error.constructor.name === constructorName && pattern.test(message)\n      );\n    })\n  );\n}\n\n/**\n * Determines whether the given error message refers to a Nock error.\n *\n * It's important that if we failed to mock a request in a test, the resulting\n * error does not cause the request to be retried so that we can see it right\n * away.\n *\n * @param message - The error message to test.\n * @returns True if the message indicates a missing Nock mock, false otherwise.\n */\nfunction isNockError(message: string): boolean {\n  return message.includes('Nock:');\n}\n\n/**\n * Determine whether the given error message indicates a failure to parse JSON.\n *\n * This is different in tests vs. implementation code because it may manifest as\n * a FetchError or a SyntaxError.\n *\n * @param error - The error object to test.\n * @returns True if the error indicates a JSON parse error, false otherwise.\n */\nfunction isJsonParseError(error: unknown): boolean {\n  return (\n    error instanceof SyntaxError ||\n    /invalid json/iu.test(getErrorMessage(error))\n  );\n}\n\n/**\n * Guarantees a URL, even given a string. This is useful for checking components\n * of that URL.\n *\n * @param endpointUrlOrUrlString - Either a URL object or a string that\n * represents the URL of an endpoint.\n * @returns A URL object.\n */\nfunction getNormalizedEndpointUrl(endpointUrlOrUrlString: URL | string): URL {\n  return endpointUrlOrUrlString instanceof URL\n    ? endpointUrlOrUrlString\n    : new URL(endpointUrlOrUrlString);\n}\n\n/**\n * Strips username and password from a URL.\n *\n * @param url - The URL to strip credentials from.\n * @returns A new URL object with credentials removed.\n */\nfunction stripCredentialsFromUrl(url: URL): URL {\n  const strippedUrl = new URL(url.toString());\n  strippedUrl.username = '';\n  strippedUrl.password = '';\n  return strippedUrl;\n}\n\n/**\n * This class is responsible for making a request to an endpoint that implements\n * the JSON-RPC protocol. It is designed to gracefully handle network and server\n * failures, retrying requests using exponential backoff. It also offers a hook\n * which can used to respond to slow requests.\n */\nexport class RpcService implements AbstractRpcService {\n  /**\n   * The URL of the RPC endpoint.\n   */\n  readonly endpointUrl: URL;\n\n  /**\n   * The last error that the retry policy captured (or `undefined` if the last\n   * execution of the service was successful).\n   */\n  lastError: Error | undefined;\n\n  /**\n   * The function used to make an HTTP request.\n   */\n  readonly #fetch: typeof fetch;\n\n  /**\n   * A common set of options that the request options will extend.\n   */\n  readonly #fetchOptions: FetchOptions;\n\n  /**\n   * A `loglevel` logger.\n   */\n  readonly #logger: RpcServiceOptions['logger'];\n\n  /**\n   * The policy that wraps the request.\n   */\n  readonly #policy: ServicePolicy;\n\n  /**\n   * Constructs a new RpcService object.\n   *\n   * @param options - The options. See {@link RpcServiceOptions}.\n   */\n  constructor(options: RpcServiceOptions) {\n    const {\n      btoa: givenBtoa,\n      endpointUrl,\n      fetch: givenFetch,\n      logger,\n      fetchOptions = {},\n      policyOptions = {},\n      isOffline,\n    } = options;\n\n    this.#fetch = givenFetch;\n    const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);\n    this.#fetchOptions = this.#getDefaultFetchOptions(\n      normalizedUrl,\n      fetchOptions,\n      givenBtoa,\n    );\n    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);\n    this.#logger = logger;\n\n    this.#policy = createServicePolicy({\n      maxRetries: DEFAULT_MAX_RETRIES,\n      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,\n      ...policyOptions,\n      retryFilterPolicy: handleWhen((error) => {\n        // If user is offline, don't retry any errors\n        // This prevents degraded/break callbacks from being triggered\n        if (isOffline()) {\n          return false;\n        }\n\n        return (\n          // Ignore errors where the request failed to establish\n          isConnectionError(error) ||\n          // Ignore server sent HTML error pages or truncated JSON responses\n          isJsonParseError(error) ||\n          // Ignore server overload errors\n          ('httpStatus' in error &&\n            (error.httpStatus === 502 ||\n              error.httpStatus === 503 ||\n              error.httpStatus === 504)) ||\n          (hasProperty(error, 'code') &&\n            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))\n        );\n      }),\n    });\n  }\n\n  /**\n   * Resets the underlying composite Cockatiel policy.\n   *\n   * This is useful in a collection of RpcServices where some act as failovers\n   * for others where you effectively want to invalidate the failovers when the\n   * primary recovers.\n   */\n  resetPolicy(): void {\n    this.#policy.reset();\n  }\n\n  /**\n   * @returns The state of the underlying circuit.\n   */\n  getCircuitState(): CircuitState {\n    return this.#policy.getCircuitState();\n  }\n\n  /**\n   * Listens for when the RPC service retries the request.\n   *\n   * @param listener - The callback to be called when the retry occurs.\n   * @returns What {@link ServicePolicy.onRetry} returns.\n   * @see {@link createServicePolicy}\n   */\n  onRetry(listener: Parameters<AbstractRpcService['onRetry']>[0]): IDisposable {\n    return this.#policy.onRetry((data) => {\n      listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the RPC service retries the request too many times in a\n   * row, causing the underlying circuit to break.\n   *\n   * @param listener - The callback to be called when the circuit is broken.\n   * @returns What {@link ServicePolicy.onBreak} returns.\n   * @see {@link createServicePolicy}\n   */\n  onBreak(listener: Parameters<AbstractRpcService['onBreak']>[0]): IDisposable {\n    return this.#policy.onBreak((data) => {\n      // `{ isolated: true }` is a special object that shows up when `isolate`\n      // is called on the circuit breaker. Usually `isolate` is used to hold the\n      // circuit open, but we (ab)use this method in `createServicePolicy` to\n      // reset the circuit breaker policy. When we do this, we don't want to\n      // call `onBreak` handlers, because then it causes\n      // `NetworkController:rpcEndpointUnavailable` and\n      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we\n      // have to ignore that object here. The consequence is that `isolate`\n      // doesn't function the way it is intended, at least in the context of an\n      // RpcService. However, we are making a bet that we won't need to use it\n      // other than how we are already using it.\n      if (!('isolated' in data)) {\n        listener({ ...data, endpointUrl: this.endpointUrl.toString() });\n      }\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service detects a slow\n   * request.\n   *\n   * @param listener - The callback to be called when the request is slow.\n   * @returns What {@link ServicePolicy.onDegraded} returns.\n   * @see {@link createServicePolicy}\n   */\n  onDegraded(\n    listener: Parameters<AbstractRpcService['onDegraded']>[0],\n  ): IDisposable {\n    return this.#policy.onDegraded((data) => {\n      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Listens for when the policy underlying this RPC service is available.\n   *\n   * @param listener - The callback to be called when the request is available.\n   * @returns What {@link ServicePolicy.onAvailable} returns.\n   * @see {@link createServicePolicy}\n   */\n  onAvailable(\n    listener: Parameters<AbstractRpcService['onAvailable']>[0],\n  ): IDisposable {\n    return this.#policy.onAvailable(() => {\n      listener({ endpointUrl: this.endpointUrl.toString() });\n    });\n  }\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is specifically designed for `eth_getBlockByNumber`, which\n   * can return a `result` of `null` despite an expected `Result` being\n   * provided.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params> & { method: 'eth_getBlockByNumber' },\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>>;\n\n  /**\n   * Makes a request to the RPC endpoint.\n   *\n   * This overload is designed for all RPC methods except for\n   * `eth_getBlockByNumber`, which are expected to return a `result` of the\n   * expected `Result`.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.\n   * @param fetchOptions - An options bag for {@link fetch} which further\n   * specifies the request.\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    jsonRpcRequest: JsonRpcRequest<Params>,\n    fetchOptions?: FetchOptions,\n  ): Promise<JsonRpcResponse<Result>>;\n\n  async request<Params extends JsonRpcParams, Result extends Json>(\n    // The request object may be frozen and must not be mutated.\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions = {},\n  ): Promise<JsonRpcResponse<Result | null>> {\n    const completeFetchOptions = this.#getCompleteFetchOptions(\n      jsonRpcRequest,\n      fetchOptions,\n    );\n    return await this.#executeAndProcessRequest<Result>(completeFetchOptions);\n  }\n\n  /**\n   * Constructs a default set of options to `fetch`.\n   *\n   * If a username and password are present in the URL, they are extracted to an\n   * Authorization header.\n   *\n   * @param endpointUrl - The endpoint URL.\n   * @param fetchOptions - The options to `fetch`.\n   * @param givenBtoa - An implementation of `btoa`.\n   * @returns The default fetch options.\n   */\n  #getDefaultFetchOptions(\n    endpointUrl: URL,\n    fetchOptions: FetchOptions,\n    givenBtoa: (stringToEncode: string) => string,\n  ): FetchOptions {\n    if (endpointUrl.username && endpointUrl.password) {\n      const authString = `${endpointUrl.username}:${endpointUrl.password}`;\n      const encodedCredentials = givenBtoa(authString);\n      return deepmerge(fetchOptions, {\n        headers: { Authorization: `Basic ${encodedCredentials}` },\n      });\n    }\n\n    return fetchOptions;\n  }\n\n  /**\n   * Constructs a final set of options to pass to `fetch`. Note that the method\n   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.\n   *\n   * @param jsonRpcRequest - The JSON-RPC request.\n   * @param fetchOptions - Custom `fetch` options.\n   * @returns The complete set of `fetch` options.\n   */\n  #getCompleteFetchOptions<Params extends JsonRpcParams>(\n    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,\n    fetchOptions: FetchOptions,\n  ): FetchOptions {\n    const defaultOptions = {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n    };\n    const mergedOptions = deepmerge(\n      defaultOptions,\n      deepmerge(this.#fetchOptions, fetchOptions),\n    );\n\n    const { id, jsonrpc, method, params } = jsonRpcRequest;\n    const body = JSON.stringify({\n      id,\n      jsonrpc,\n      method,\n      params,\n    });\n\n    return { ...mergedOptions, body };\n  }\n\n  /**\n   * Makes the request using the Cockatiel policy that this service creates.\n   *\n   * @param fetchOptions - The options for `fetch`; will be combined with the\n   * fetch options passed to the constructor\n   * @returns The decoded JSON-RPC response from the endpoint.\n   * @throws An \"authorized\" JSON-RPC error (code -32006) if the response HTTP status is 401.\n   * @throws A \"rate limiting\" JSON-RPC error (code -32005) if the response HTTP status is 429.\n   * @throws A \"resource unavailable\" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.\n   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.\n   * @throws A \"parse\" JSON-RPC error (code -32700) if the response is not valid JSON.\n   */\n  async #executeAndProcessRequest<Result extends Json>(\n    fetchOptions: FetchOptions,\n  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>> {\n    let response: Response | undefined;\n    try {\n      log(\n        `[${this.endpointUrl}] Circuit state`,\n        this.#policy.getCircuitState(),\n      );\n      const jsonDecodedResponse = await this.#policy.execute(\n        async (context) => {\n          log(\n            'REQUEST INITIATED:',\n            this.endpointUrl.toString(),\n            '::',\n            fetchOptions,\n            // @ts-expect-error This property _is_ here, the type of\n            // ServicePolicy is just wrong.\n            `(attempt ${context.attempt + 1})`,\n          );\n          response = await this.#fetch(this.endpointUrl, fetchOptions);\n          if (!response.ok) {\n            throw new HttpError(response.status);\n          }\n          log(\n            'REQUEST SUCCESSFUL:',\n            this.endpointUrl.toString(),\n            response.status,\n          );\n          return await response.json();\n        },\n      );\n      this.lastError = undefined;\n      return jsonDecodedResponse;\n    } catch (error) {\n      log('REQUEST ERROR:', this.endpointUrl.toString(), error);\n\n      this.lastError =\n        error instanceof Error ? error : new Error(getErrorMessage(error));\n\n      if (error instanceof HttpError) {\n        const status = error.httpStatus;\n        if (status === 401) {\n          throw new JsonRpcError(\n            CUSTOM_RPC_ERRORS.unauthorized,\n            'Unauthorized.',\n            {\n              httpStatus: status,\n            },\n          );\n        }\n        if (status === 429) {\n          throw rpcErrors.limitExceeded({\n            message: 'Request is being rate limited.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n        if (status >= 500 || status === 402 || status === 404) {\n          throw rpcErrors.resourceUnavailable({\n            message: 'RPC endpoint not found or unavailable.',\n            data: {\n              httpStatus: status,\n            },\n          });\n        }\n\n        // Handle all other 4xx errors as generic HTTP client errors\n        throw new JsonRpcError(\n          CUSTOM_RPC_ERRORS.httpClientError,\n          'RPC endpoint returned HTTP client error.',\n          {\n            httpStatus: status,\n          },\n        );\n      } else if (isJsonParseError(error)) {\n        throw rpcErrors.parse({\n          message: 'RPC endpoint did not return JSON.',\n        });\n      } else if (error instanceof BrokenCircuitError) {\n        this.#logger?.warn(error);\n        const remainingCircuitOpenDuration =\n          this.#policy.getRemainingCircuitOpenDuration();\n        const formattedRemainingCircuitOpenDuration = Intl.NumberFormat(\n          undefined,\n          { maximumFractionDigits: 2 },\n        ).format(\n          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /\n            Duration.Minute,\n        );\n        throw rpcErrors.resourceUnavailable({\n          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,\n        });\n      }\n      throw error;\n    }\n  }\n}\n"]}
\ No newline at end of file
diff --git a/jest.config.js b/jest.config.js
new file mode 100644
index 0000000000000000000000000000000000000000..621e01529f537e2d795cec969c41beb15a015a2c
--- /dev/null
+++ b/jest.config.js
@@ -0,0 +1,30 @@
+/*
+ * For a detailed explanation regarding each configuration property and type check, visit:
+ * https://jestjs.io/docs/configuration
+ */
+
+const merge = require('deepmerge');
+const path = require('path');
+
+const baseConfig = require('../../jest.config.packages');
+
+const displayName = path.basename(__dirname);
+
+module.exports = merge(baseConfig, {
+  // The display name when running multiple projects
+  displayName,
+
+  // An object that configures minimum threshold enforcement for coverage results
+  coverageThreshold: {
+    global: {
+      branches: 88.47,
+      functions: 97.43,
+      lines: 94.47,
+      statements: 94.29,
+    },
+  },
+
+  // Currently the tests for NetworkController have a race condition which
+  // causes intermittent failures. This seems to fix it.
+  testEnvironment: 'jsdom',
+});
diff --git a/package.json b/package.json
index 689c50d0ab6dc91c34f1d75f76cdf29717b32c26..636a881c123115fd984e295e223492e9319d57cc 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@metamask/network-controller",
-  "version": "28.0.0",
+  "version": "29.0.0",
   "description": "Provides an interface to the currently selected network via a MetaMask-compatible provider object",
   "keywords": [
     "MetaMask",
@@ -49,13 +49,14 @@
   },
   "dependencies": {
     "@metamask/base-controller": "^9.0.0",
+    "@metamask/connectivity-controller": "^0.1.0",
     "@metamask/controller-utils": "^11.18.0",
-    "@metamask/eth-block-tracker": "^15.0.0",
+    "@metamask/eth-block-tracker": "^15.0.1",
     "@metamask/eth-json-rpc-infura": "^10.3.0",
-    "@metamask/eth-json-rpc-middleware": "^22.0.1",
+    "@metamask/eth-json-rpc-middleware": "^23.0.0",
     "@metamask/eth-json-rpc-provider": "^6.0.0",
     "@metamask/eth-query": "^4.0.0",
-    "@metamask/json-rpc-engine": "^10.2.0",
+    "@metamask/json-rpc-engine": "^10.2.1",
     "@metamask/messenger": "^0.3.0",
     "@metamask/rpc-errors": "^7.0.2",
     "@metamask/swappable-obj-proxy": "^2.3.0",
diff --git a/src/NetworkController.ts b/src/NetworkController.ts
new file mode 100644
index 0000000000000000000000000000000000000000..88f0910ace474bca9f63ba60a03bb725e33f1904
--- /dev/null
+++ b/src/NetworkController.ts
@@ -0,0 +1,3328 @@
+import type {
+  ControllerGetStateAction,
+  ControllerStateChangeEvent,
+} from '@metamask/base-controller';
+import { BaseController } from '@metamask/base-controller';
+import type { ConnectivityControllerGetStateAction } from '@metamask/connectivity-controller';
+import type { Partialize } from '@metamask/controller-utils';
+import {
+  InfuraNetworkType,
+  CustomNetworkType,
+  NetworkType,
+  isSafeChainId,
+  isInfuraNetworkType,
+  ChainId,
+  NetworksTicker,
+  NetworkNickname,
+  BUILT_IN_CUSTOM_NETWORKS_RPC,
+  BUILT_IN_NETWORKS,
+} from '@metamask/controller-utils';
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+import EthQuery from '@metamask/eth-query';
+import type { Messenger } from '@metamask/messenger';
+import { errorCodes } from '@metamask/rpc-errors';
+import {
+  createEventEmitterProxy,
+  createSwappableProxy,
+} from '@metamask/swappable-obj-proxy';
+import type { SwappableProxy } from '@metamask/swappable-obj-proxy';
+import type { Hex } from '@metamask/utils';
+import { hasProperty, isPlainObject, isStrictHexString } from '@metamask/utils';
+import deepEqual from 'fast-deep-equal';
+import type { Draft } from 'immer';
+import { produce } from 'immer';
+import { cloneDeep } from 'lodash';
+import type { Logger } from 'loglevel';
+import { createSelector } from 'reselect';
+import * as URI from 'uri-js';
+import { v4 as uuidV4 } from 'uuid';
+
+import {
+  DEPRECATED_NETWORKS,
+  INFURA_BLOCKED_KEY,
+  NetworkStatus,
+} from './constants';
+import type {
+  AutoManagedNetworkClient,
+  ProxyWithAccessibleTarget,
+} from './create-auto-managed-network-client';
+import { createAutoManagedNetworkClient } from './create-auto-managed-network-client';
+import { projectLogger, createModuleLogger } from './logger';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+import { NetworkClientType } from './types';
+import type {
+  BlockTracker,
+  Provider,
+  CustomNetworkClientConfiguration,
+  InfuraNetworkClientConfiguration,
+  NetworkClientConfiguration,
+  AdditionalDefaultNetwork,
+} from './types';
+
+const debugLog = createModuleLogger(projectLogger, 'NetworkController');
+
+const INFURA_URL_REGEX =
+  /^https:\/\/(?<networkName>[^.]+)\.infura\.io\/v\d+\/(?<apiKey>.+)$/u;
+
+export type Block = {
+  baseFeePerGas?: string;
+};
+
+/**
+ * Information about a network not held by any other part of state.
+ */
+export type NetworkMetadata = {
+  /**
+   * EIPs supported by the network.
+   */
+  // eslint-disable-next-line @typescript-eslint/naming-convention
+  EIPS: {
+    [eipNumber: number]: boolean;
+  };
+  /**
+   * Indicates the availability of the network
+   */
+  status: NetworkStatus;
+};
+
+/**
+ * The type of an RPC endpoint.
+ *
+ * @see {@link CustomRpcEndpoint}
+ * @see {@link InfuraRpcEndpoint}
+ */
+export enum RpcEndpointType {
+  Custom = 'custom',
+  Infura = 'infura',
+}
+
+/**
+ * An Infura RPC endpoint is a reference to a specific network that Infura
+ * supports as well as an Infura account we own that we allow users to make use
+ * of for free. We need to disambiguate these endpoints from custom RPC
+ * endpoints, because while the types for these kinds of object both have the
+ * same interface, the URL for an Infura endpoint contains the Infura project
+ * ID, and we don't want this to be present in state. We therefore hide it by
+ * representing it in the URL as `{infuraProjectId}`, which we replace this when
+ * create network clients. But we need to know somehow that we only need to do
+ * this replacement for Infura endpoints and not custom endpoints â€” hence the
+ * separate type.
+ */
+export type InfuraRpcEndpoint = {
+  /**
+   * Alternate RPC endpoints to use when this endpoint is down.
+   */
+  failoverUrls?: string[];
+  /**
+   * The optional user-facing nickname of the endpoint.
+   */
+  name?: string;
+  /**
+   * The identifier for the network client that has been created for this RPC
+   * endpoint. This is also used to uniquely identify the RPC endpoint in a
+   * set of RPC endpoints as well: once assigned, it is used to determine
+   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.
+   */
+  networkClientId: BuiltInNetworkClientId;
+  /**
+   * The type of this endpoint, always "default".
+   */
+  type: RpcEndpointType.Infura;
+  /**
+   * The URL of the endpoint. Expected to be a template with the string
+   * `{infuraProjectId}`, which will get replaced with the Infura project ID
+   * when the network client is created.
+   */
+  url: `https://${InfuraNetworkType}.infura.io/v3/{infuraProjectId}`;
+};
+
+/**
+ * A custom RPC endpoint is a reference to a user-defined server which fronts an
+ * EVM chain. It may refer to an Infura network, but only by coincidence.
+ */
+export type CustomRpcEndpoint = {
+  /**
+   * Alternate RPC endpoints to use when this endpoint is down.
+   */
+  failoverUrls?: string[];
+  /**
+   * The optional user-facing nickname of the endpoint.
+   */
+  name?: string;
+  /**
+   * The identifier for the network client that has been created for this RPC
+   * endpoint. This is also used to uniquely identify the RPC endpoint in a
+   * set of RPC endpoints as well: once assigned, it is used to determine
+   * whether the `name`, `type`, or `url` of the RPC endpoint has changed.
+   */
+  networkClientId: CustomNetworkClientId;
+  /**
+   * The type of this endpoint, always "custom".
+   */
+  type: RpcEndpointType.Custom;
+  /**
+   * The URL of the endpoint.
+   */
+  url: string;
+};
+
+/**
+ * An RPC endpoint is a reference to a server which fronts an EVM chain. There
+ * are two varieties of RPC endpoints: Infura and custom.
+ *
+ * @see {@link CustomRpcEndpoint}
+ * @see {@link InfuraRpcEndpoint}
+ */
+export type RpcEndpoint = InfuraRpcEndpoint | CustomRpcEndpoint;
+
+/**
+ * From a user perspective, a network configuration holds information about a
+ * network that a user can select through the client. A "network" in this sense
+ * can explicitly refer to an EVM chain that the user explicitly adds or doesn't
+ * need to add (because it comes shipped with the client). The properties here
+ * therefore directly map to fields that a user sees and can edit for a network
+ * within the client.
+ *
+ * Internally, a network configuration represents a single conceptual EVM chain,
+ * which is represented tangibly via multiple RPC endpoints. A "network" is then
+ * something for which a network client object is created automatically or
+ * created on demand when it is added to the client.
+ */
+export type NetworkConfiguration = {
+  /**
+   * A set of URLs that allows the user to view activity that has occurred on
+   * the chain.
+   */
+  blockExplorerUrls: string[];
+  /**
+   * The ID of the chain. Represented in hexadecimal format with a leading "0x"
+   * instead of decimal format so that when viewed out of context it can be
+   * unambiguously interpreted.
+   */
+  chainId: Hex;
+  /**
+   * A reference to a URL that the client will use by default to allow the user
+   * to view activity that has occurred on the chain. This index must refer to
+   * an item in `blockExplorerUrls`.
+   */
+  defaultBlockExplorerUrlIndex?: number;
+  /**
+   * A reference to an RPC endpoint that all requests will use by default in order to
+   * interact with the chain. This index must refer to an item in
+   * `rpcEndpoints`.
+   */
+  defaultRpcEndpointIndex: number;
+  /**
+   * The user-facing nickname assigned to the chain.
+   */
+  name: string;
+  /**
+   * The name of the currency to use for the chain.
+   */
+  nativeCurrency: string;
+  /**
+   * The collection of possible RPC endpoints that the client can use to
+   * interact with the chain.
+   */
+  rpcEndpoints: RpcEndpoint[];
+  /**
+   * Profile Sync - Network Sync field.
+   * Allows comparison of local network state with state to sync.
+   */
+  lastUpdatedAt?: number;
+};
+
+/**
+ * A custom RPC endpoint in a new network configuration, meant to be used in
+ * conjunction with `AddNetworkFields`.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and therefore network clients
+ * do not exist for them yet (and hence IDs need to be generated).
+ */
+export type AddNetworkCustomRpcEndpointFields = Omit<
+  CustomRpcEndpoint,
+  'networkClientId'
+>;
+
+/**
+ * A new network configuration that `addNetwork` takes.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and are not represented by
+ * network clients yet.
+ */
+export type AddNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {
+  rpcEndpoints: (InfuraRpcEndpoint | AddNetworkCustomRpcEndpointFields)[];
+};
+
+/**
+ * A custom RPC endpoint in an updated representation of a network
+ * configuration, meant to be used in conjunction with `UpdateNetworkFields`.
+ *
+ * Custom RPC endpoints do not need a `networkClientId` property because it is
+ * assumed that they have not already been added and therefore network clients
+ * do not exist for them yet (and hence IDs need to be generated).
+ */
+export type UpdateNetworkCustomRpcEndpointFields = Partialize<
+  CustomRpcEndpoint,
+  'networkClientId'
+>;
+
+/**
+ * An updated representation of an existing network configuration that
+ * `updateNetwork` takes.
+ *
+ * Custom RPC endpoints may or may not have a `networkClientId` property; if
+ * they do, then it is assumed that they already exist, and if not, then it is
+ * assumed that they are new and are not represented by network clients yet.
+ */
+export type UpdateNetworkFields = Omit<NetworkConfiguration, 'rpcEndpoints'> & {
+  rpcEndpoints: (InfuraRpcEndpoint | UpdateNetworkCustomRpcEndpointFields)[];
+};
+
+/**
+ * `Object.keys()` is intentionally generic: it returns the keys of an object,
+ * but it cannot make guarantees about the contents of that object, so the type
+ * of the keys is merely `string[]`. While this is technically accurate, it is
+ * also unnecessary if we have an object that we own and whose contents are
+ * known exactly.
+ *
+ * TODO: Move to @metamask/utils.
+ *
+ * @param object - The object.
+ * @returns The keys of an object, typed according to the type of the object
+ * itself.
+ */
+export function knownKeysOf<Key extends PropertyKey>(
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  object: Partial<Record<Key, any>>,
+): Key[] {
+  return Object.keys(object) as Key[];
+}
+
+/**
+ * Type guard for determining whether the given value is an error object with a
+ * `code` property, such as an instance of Error.
+ *
+ * TODO: Move this to @metamask/utils.
+ *
+ * @param error - The object to check.
+ * @returns True if `error` has a `code`, false otherwise.
+ */
+function isErrorWithCode(error: unknown): error is { code: string | number } {
+  return typeof error === 'object' && error !== null && 'code' in error;
+}
+
+/**
+ * The string that uniquely identifies an Infura network client.
+ */
+export type BuiltInNetworkClientId = InfuraNetworkType;
+
+/**
+ * The string that uniquely identifies a custom network client.
+ */
+export type CustomNetworkClientId = string;
+
+/**
+ * The string that uniquely identifies a network client.
+ */
+export type NetworkClientId = BuiltInNetworkClientId | CustomNetworkClientId;
+
+/**
+ * Extra information about each network, such as whether it is accessible or
+ * blocked and whether it supports EIP-1559, keyed by network client ID.
+ */
+export type NetworksMetadata = Record<NetworkClientId, NetworkMetadata>;
+
+/**
+ * The state that NetworkController stores.
+ */
+export type NetworkState = {
+  /**
+   * The ID of the network client that the proxies returned by
+   * `getSelectedNetworkClient` currently point to.
+   */
+  selectedNetworkClientId: NetworkClientId;
+  /**
+   * The registry of networks and corresponding RPC endpoints that the
+   * controller can use to make requests for various chains.
+   *
+   * @see {@link NetworkConfiguration}
+   */
+  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>;
+  /**
+   * Extra information about each network, such as whether it is accessible or
+   * blocked and whether it supports EIP-1559, keyed by network client ID.
+   */
+  networksMetadata: NetworksMetadata;
+};
+
+const controllerName = 'NetworkController';
+
+/**
+ * Represents the block tracker for the currently selected network. (Note that
+ * this is a proxy around a proxy: the inner one exists so that the block
+ * tracker doesn't have to exist until it's used, and the outer one exists so
+ * that the currently selected network can change without consumers needing to
+ * refresh the object reference to that network.)
+ */
+export type BlockTrackerProxy = SwappableProxy<
+  ProxyWithAccessibleTarget<BlockTracker>
+>;
+
+/**
+ * Represents the provider for the currently selected network. (Note that this
+ * is a proxy around a proxy: the inner one exists so that the provider doesn't
+ * have to exist until it's used, and the outer one exists so that the currently
+ * selected network can change without consumers needing to refresh the object
+ * reference to that network.)
+ */
+export type ProviderProxy = SwappableProxy<ProxyWithAccessibleTarget<Provider>>;
+
+export type NetworkControllerStateChangeEvent = ControllerStateChangeEvent<
+  typeof controllerName,
+  NetworkState
+>;
+
+/**
+ * `networkWillChange` is published when the current network is about to be
+ * switched, but the new provider has not been created and no state changes have
+ * occurred yet.
+ */
+export type NetworkControllerNetworkWillChangeEvent = {
+  type: 'NetworkController:networkWillChange';
+  payload: [NetworkState];
+};
+
+/**
+ * `networkDidChange` is published after a provider has been created for a newly
+ * switched network (but before the network has been confirmed to be available).
+ */
+export type NetworkControllerNetworkDidChangeEvent = {
+  type: 'NetworkController:networkDidChange';
+  payload: [NetworkState];
+};
+
+/**
+ * `infuraIsBlocked` is published after the network is switched to an Infura
+ * network, but when Infura returns an error blocking the user based on their
+ * location.
+ */
+export type NetworkControllerInfuraIsBlockedEvent = {
+  type: 'NetworkController:infuraIsBlocked';
+  payload: [];
+};
+
+/**
+ * `infuraIsBlocked` is published either after the network is switched to an
+ * Infura network and Infura does not return an error blocking the user based on
+ * their location, or the network is switched to a non-Infura network.
+ */
+export type NetworkControllerInfuraIsUnblockedEvent = {
+  type: 'NetworkController:infuraIsUnblocked';
+  payload: [];
+};
+
+/**
+ * `networkAdded` is published after a network configuration is added to the
+ * network configuration registry and network clients are created for it.
+ */
+export type NetworkControllerNetworkAddedEvent = {
+  type: 'NetworkController:networkAdded';
+  payload: [networkConfiguration: NetworkConfiguration];
+};
+
+/**
+ * `networkRemoved` is published after a network configuration is removed from the
+ * network configuration registry and once the network clients have been removed.
+ */
+export type NetworkControllerNetworkRemovedEvent = {
+  type: 'NetworkController:networkRemoved';
+  payload: [networkConfiguration: NetworkConfiguration];
+};
+
+/**
+ * `NetworkController:rpcEndpointChainUnavailable` is published when, after
+ * trying all endpoints in an endpoint chain, the last failover reaches a
+ * maximum number of consecutive 5xx responses, breaking the underlying circuit.
+ *
+ * In other words, this event will not be published if a failover is available,
+ * even if the primary is not.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.error - The last error produced by the last failover in the
+ * endpoint chain.
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainUnavailableEvent = {
+  type: 'NetworkController:rpcEndpointChainUnavailable';
+  payload: [
+    {
+      chainId: Hex;
+      error: unknown;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+
+/**
+ * `NetworkController:rpcEndpointUnavailable` is published when any
+ * endpoint in an endpoint chain reaches a maximum number of consecutive 5xx
+ * responses, breaking the underlying circuit.
+ *
+ * In other words, this event will be published if a primary is not available,
+ * even if a failover is.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint which reached the
+ * maximum number of consecutive 5xx responses. You can compare this to
+ * `primaryEndpointUrl` to know whether it was a failover or a primary.
+ * @param payload.error - The last error produced by the endpoint.
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ */
+export type NetworkControllerRpcEndpointUnavailableEvent = {
+  type: 'NetworkController:rpcEndpointUnavailable';
+  payload: [
+    {
+      chainId: Hex;
+      endpointUrl: string;
+      error: unknown;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+
+/**
+ * `NetworkController:rpcEndpointChainDegraded` is published for any of the
+ * endpoints in an endpoint chain when one of the following two conditions hold
+ * (and the chain is not already in a degraded state):
+ *
+ * 1. A successful (2xx) request, even after being retried, cannot be made to
+ * the endpoint.
+ * 2. A successful (2xx) request can be made to the endpoint, but it takes
+ * longer than expected to complete.
+ *
+ * Note that this event will be published even if there are local connectivity
+ * issues which prevent requests from being initiated. This is intentional.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.error - The last error produced by the endpoint (or
+ * `undefined` if the request was slow).
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainDegradedEvent = {
+  type: 'NetworkController:rpcEndpointChainDegraded';
+  payload: [
+    {
+      chainId: Hex;
+      error: unknown;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+
+/**
+ *
+ * `NetworkController:rpcEndpointDegraded` is published for any of the endpoints
+ * in an endpoint chain when:
+ *
+ * 1. A successful (2xx) request, even after being retried, cannot be made to
+ * the endpoint.
+ * 2. A successful (2xx) request can be made to the endpoint, but it takes
+ * longer than expected to complete.
+ *
+ * Note that this event will be published even if there are local connectivity
+ * issues which prevent requests from being initiated. This is intentional.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint for which requests
+ * failed or were slow to complete. You can compare this to `primaryEndpointUrl`
+ * to know whether it was a failover or a primary.
+ * @param payload.error - The last error produced by the endpoint (or
+ * `undefined` if the request was slow).
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ */
+export type NetworkControllerRpcEndpointDegradedEvent = {
+  type: 'NetworkController:rpcEndpointDegraded';
+  payload: [
+    {
+      chainId: Hex;
+      endpointUrl: string;
+      error: unknown;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+
+/**
+ * `NetworkController:rpcEndpointChainAvailable` is published in one of two
+ * cases:
+ *
+ * 1. The first time that a 2xx request is made to any of the endpoints in an
+ * endpoint chain.
+ * 2. When requests to any of the endpoints previously failed (placing the
+ * endpoint in a degraded or unavailable status), but are now succeeding again.
+ *
+ * @param payload - The event payload.
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.networkClientId - The target network's client ID.
+ */
+export type NetworkControllerRpcEndpointChainAvailableEvent = {
+  type: 'NetworkController:rpcEndpointChainAvailable';
+  payload: [
+    {
+      chainId: Hex;
+      networkClientId: NetworkClientId;
+    },
+  ];
+};
+
+/**
+ * `NetworkController:rpcEndpointRetried` is published before a request to any
+ * endpoint in an endpoint chain is retried.
+ *
+ * This is mainly useful for tests.
+ *
+ * @param payload - The event payload.
+ * @param payload.attempt - The current attempt counter for the endpoint
+ * (starting from 0).
+ * @param payload.chainId - The target network's chain ID.
+ * @param payload.endpointUrl - The URL of the endpoint being retried.
+ * @param payload.networkClientId - The target network's client ID.
+ * @param payload.primaryEndpointUrl - The endpoint chain's primary URL.
+ * @see {@link RpcService} for the list of retriable errors.
+ */
+export type NetworkControllerRpcEndpointRetriedEvent = {
+  type: 'NetworkController:rpcEndpointRetried';
+  payload: [
+    {
+      attempt: number;
+      chainId: Hex;
+      endpointUrl: string;
+      networkClientId: NetworkClientId;
+      primaryEndpointUrl: string;
+    },
+  ];
+};
+
+export type NetworkControllerEvents =
+  | NetworkControllerStateChangeEvent
+  | NetworkControllerNetworkWillChangeEvent
+  | NetworkControllerNetworkDidChangeEvent
+  | NetworkControllerInfuraIsBlockedEvent
+  | NetworkControllerInfuraIsUnblockedEvent
+  | NetworkControllerNetworkAddedEvent
+  | NetworkControllerNetworkRemovedEvent
+  | NetworkControllerRpcEndpointChainUnavailableEvent
+  | NetworkControllerRpcEndpointUnavailableEvent
+  | NetworkControllerRpcEndpointChainDegradedEvent
+  | NetworkControllerRpcEndpointDegradedEvent
+  | NetworkControllerRpcEndpointChainAvailableEvent
+  | NetworkControllerRpcEndpointRetriedEvent;
+
+/**
+ * All events that {@link NetworkController} calls internally.
+ */
+type AllowedEvents = never;
+
+export type NetworkControllerGetStateAction = ControllerGetStateAction<
+  typeof controllerName,
+  NetworkState
+>;
+
+export type NetworkControllerGetEthQueryAction = {
+  type: `NetworkController:getEthQuery`;
+  handler: () => EthQuery | undefined;
+};
+
+export type NetworkControllerGetNetworkClientByIdAction = {
+  type: `NetworkController:getNetworkClientById`;
+  handler: NetworkController['getNetworkClientById'];
+};
+
+export type NetworkControllerGetSelectedNetworkClientAction = {
+  type: `NetworkController:getSelectedNetworkClient`;
+  handler: NetworkController['getSelectedNetworkClient'];
+};
+
+export type NetworkControllerGetSelectedChainIdAction = {
+  type: 'NetworkController:getSelectedChainId';
+  handler: NetworkController['getSelectedChainId'];
+};
+
+export type NetworkControllerGetEIP1559CompatibilityAction = {
+  type: `NetworkController:getEIP1559Compatibility`;
+  handler: NetworkController['getEIP1559Compatibility'];
+};
+
+export type NetworkControllerFindNetworkClientIdByChainIdAction = {
+  type: `NetworkController:findNetworkClientIdByChainId`;
+  handler: NetworkController['findNetworkClientIdByChainId'];
+};
+
+/**
+ * Change the currently selected network to the given built-in network type.
+ *
+ * @deprecated This action has been replaced by `setActiveNetwork`, and will be
+ * removed in a future release.
+ */
+export type NetworkControllerSetProviderTypeAction = {
+  type: `NetworkController:setProviderType`;
+  handler: NetworkController['setProviderType'];
+};
+
+export type NetworkControllerSetActiveNetworkAction = {
+  type: `NetworkController:setActiveNetwork`;
+  handler: NetworkController['setActiveNetwork'];
+};
+
+export type NetworkControllerGetNetworkConfigurationByChainId = {
+  type: `NetworkController:getNetworkConfigurationByChainId`;
+  handler: NetworkController['getNetworkConfigurationByChainId'];
+};
+
+export type NetworkControllerGetNetworkConfigurationByNetworkClientId = {
+  type: `NetworkController:getNetworkConfigurationByNetworkClientId`;
+  handler: NetworkController['getNetworkConfigurationByNetworkClientId'];
+};
+
+export type NetworkControllerAddNetworkAction = {
+  type: 'NetworkController:addNetwork';
+  handler: NetworkController['addNetwork'];
+};
+
+export type NetworkControllerRemoveNetworkAction = {
+  type: 'NetworkController:removeNetwork';
+  handler: NetworkController['removeNetwork'];
+};
+
+export type NetworkControllerUpdateNetworkAction = {
+  type: 'NetworkController:updateNetwork';
+  handler: NetworkController['updateNetwork'];
+};
+
+export type NetworkControllerActions =
+  | NetworkControllerGetStateAction
+  | NetworkControllerGetEthQueryAction
+  | NetworkControllerGetNetworkClientByIdAction
+  | NetworkControllerGetSelectedNetworkClientAction
+  | NetworkControllerGetSelectedChainIdAction
+  | NetworkControllerGetEIP1559CompatibilityAction
+  | NetworkControllerFindNetworkClientIdByChainIdAction
+  | NetworkControllerSetActiveNetworkAction
+  | NetworkControllerSetProviderTypeAction
+  | NetworkControllerGetNetworkConfigurationByChainId
+  | NetworkControllerGetNetworkConfigurationByNetworkClientId
+  | NetworkControllerAddNetworkAction
+  | NetworkControllerRemoveNetworkAction
+  | NetworkControllerUpdateNetworkAction;
+
+/**
+ * All actions that {@link NetworkController} calls internally.
+ */
+type AllowedActions = ConnectivityControllerGetStateAction;
+
+export type NetworkControllerMessenger = Messenger<
+  typeof controllerName,
+  NetworkControllerActions | AllowedActions,
+  NetworkControllerEvents | AllowedEvents
+>;
+
+/**
+ * Options for the NetworkController constructor.
+ */
+export type NetworkControllerOptions = {
+  /**
+   * The messenger suited for this controller.
+   */
+  messenger: NetworkControllerMessenger;
+  /**
+   * The API key for Infura, used to make requests to Infura.
+   */
+  infuraProjectId: string;
+  /**
+   * The desired state with which to initialize this controller.
+   * Missing properties will be filled in with defaults. For instance, if not
+   * specified, `networkConfigurationsByChainId` will default to a basic set of
+   * network configurations (see {@link InfuraNetworkType} for the list).
+   */
+  state?: Partial<NetworkState>;
+  /**
+   * A `loglevel` logger object.
+   */
+  log?: Logger;
+  /**
+   * A function that can be used to customize a RPC service constructed for an
+   * RPC endpoint. The function takes the URL of the endpoint and should return
+   * an object with type {@link RpcServiceOptions}, minus `failoverService`
+   * and `endpointUrl` (as they are filled in automatically).
+   */
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;
+  /**
+   * A function that can be used to customize a block tracker constructed for an
+   * RPC endpoint. The function takes the URL of the endpoint and should return
+   * an object of type {@link PollingBlockTrackerOptions}, minus `provider` (as
+   * it is filled in automatically).
+   */
+  getBlockTrackerOptions?: (
+    rpcEndpointUrl: string,
+  ) => Omit<PollingBlockTrackerOptions, 'provider'>;
+  /**
+   * An array of Hex Chain IDs representing the additional networks to be included as default.
+   */
+  additionalDefaultNetworks?: AdditionalDefaultNetwork[];
+  /**
+   * Whether or not requests sent to unavailable RPC endpoints should be
+   * automatically diverted to configured failover RPC endpoints.
+   */
+  isRpcFailoverEnabled?: boolean;
+};
+
+/**
+ * Constructs a value for the state property `networkConfigurationsByChainId`
+ * which will be used if it has not been provided to the constructor.
+ *
+ * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.
+ * @returns The default value for `networkConfigurationsByChainId`.
+ */
+function getDefaultNetworkConfigurationsByChainId(
+  additionalDefaultNetworks: AdditionalDefaultNetwork[] = [],
+): Record<Hex, NetworkConfiguration> {
+  const infuraNetworks = getDefaultInfuraNetworkConfigurationsByChainId();
+  const customNetworks = getDefaultCustomNetworkConfigurationsByChainId();
+
+  return additionalDefaultNetworks.reduce<Record<Hex, NetworkConfiguration>>(
+    (obj, chainId) => {
+      if (hasProperty(customNetworks, chainId)) {
+        obj[chainId] = customNetworks[chainId];
+      }
+      return obj;
+    },
+    // Always include the infura networks in the default networks
+    infuraNetworks,
+  );
+}
+
+/**
+ * Constructs a `networkConfigurationsByChainId` object for all default Infura networks.
+ *
+ * @returns The `networkConfigurationsByChainId` object of all Infura networks.
+ */
+function getDefaultInfuraNetworkConfigurationsByChainId(): Record<
+  Hex,
+  NetworkConfiguration
+> {
+  return Object.values(InfuraNetworkType).reduce<
+    Record<Hex, NetworkConfiguration>
+  >((obj, infuraNetworkType) => {
+    const chainId = ChainId[infuraNetworkType];
+
+    // Skip deprecated network as default network.
+    if (DEPRECATED_NETWORKS.has(chainId)) {
+      return obj;
+    }
+
+    const rpcEndpointUrl =
+      `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const;
+
+    const networkConfiguration: NetworkConfiguration = {
+      blockExplorerUrls: [],
+      chainId,
+      defaultRpcEndpointIndex: 0,
+      name: NetworkNickname[infuraNetworkType],
+      nativeCurrency: NetworksTicker[infuraNetworkType],
+      rpcEndpoints: [
+        {
+          failoverUrls: [],
+          networkClientId: infuraNetworkType,
+          type: RpcEndpointType.Infura,
+          url: rpcEndpointUrl,
+        },
+      ],
+    };
+
+    return { ...obj, [chainId]: networkConfiguration };
+  }, {});
+}
+
+/**
+ * Constructs a `networkConfigurationsByChainId` object for all default custom networks.
+ *
+ * @returns The `networkConfigurationsByChainId` object of all custom networks.
+ */
+function getDefaultCustomNetworkConfigurationsByChainId(): Record<
+  Hex,
+  NetworkConfiguration
+> {
+  // Create the `networkConfigurationsByChainId` objects explicitly,
+  // Because it is not always guaranteed that the custom networks are included in the
+  // default networks.
+  return {
+    [ChainId['megaeth-testnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['megaeth-testnet'],
+    ),
+    [ChainId['megaeth-testnet-v2']]: getCustomNetworkConfiguration(
+      CustomNetworkType['megaeth-testnet-v2'],
+    ),
+    [ChainId['monad-testnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['monad-testnet'],
+    ),
+    // Environment 3: Power User test networks
+    [ChainId['fantom-mainnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['fantom-mainnet'],
+    ),
+    [ChainId['gnosis-mainnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['gnosis-mainnet'],
+    ),
+    [ChainId['cronos-mainnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['cronos-mainnet'],
+    ),
+    [ChainId['moonbeam-mainnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['moonbeam-mainnet'],
+    ),
+    [ChainId['moonriver-mainnet']]: getCustomNetworkConfiguration(
+      CustomNetworkType['moonriver-mainnet'],
+    ),
+  };
+}
+
+/**
+ * Constructs a `NetworkConfiguration` object by `CustomNetworkType`.
+ *
+ * @param customNetworkType - The type of the custom network.
+ * @returns The `NetworkConfiguration` object.
+ */
+function getCustomNetworkConfiguration(
+  customNetworkType: CustomNetworkType,
+): NetworkConfiguration {
+  const { ticker, rpcPrefs } = BUILT_IN_NETWORKS[customNetworkType];
+  const rpcEndpointUrl = BUILT_IN_CUSTOM_NETWORKS_RPC[customNetworkType];
+
+  return {
+    blockExplorerUrls: [rpcPrefs.blockExplorerUrl],
+    chainId: ChainId[customNetworkType],
+    defaultRpcEndpointIndex: 0,
+    defaultBlockExplorerUrlIndex: 0,
+    name: NetworkNickname[customNetworkType],
+    nativeCurrency: ticker,
+    rpcEndpoints: [
+      {
+        failoverUrls: [],
+        networkClientId: customNetworkType,
+        type: RpcEndpointType.Custom,
+        url: rpcEndpointUrl,
+      },
+    ],
+  };
+}
+
+/**
+ * Constructs properties for the NetworkController state whose values will be
+ * used if not provided to the constructor.
+ *
+ * @param [additionalDefaultNetworks] - An array of Hex Chain IDs representing the additional networks to be included as default.
+ * @returns The default NetworkController state.
+ */
+export function getDefaultNetworkControllerState(
+  additionalDefaultNetworks?: AdditionalDefaultNetwork[],
+): NetworkState {
+  const networksMetadata = {};
+  const networkConfigurationsByChainId =
+    getDefaultNetworkConfigurationsByChainId(additionalDefaultNetworks);
+
+  return {
+    selectedNetworkClientId: InfuraNetworkType.mainnet,
+    networksMetadata,
+    networkConfigurationsByChainId,
+  };
+}
+
+/**
+ * Redux selector for getting all network configurations from NetworkController
+ * state, keyed by chain ID.
+ *
+ * @param state - NetworkController state
+ * @returns All registered network configurations, keyed by chain ID.
+ */
+const selectNetworkConfigurationsByChainId = (
+  state: NetworkState,
+): Record<`0x${string}`, NetworkConfiguration> =>
+  state.networkConfigurationsByChainId;
+
+/**
+ * Get a list of all network configurations.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network configurations
+ */
+export function getNetworkConfigurations(
+  state: NetworkState,
+): NetworkConfiguration[] {
+  return Object.values(state.networkConfigurationsByChainId);
+}
+
+/**
+ * Redux selector for getting a list of all network configurations from
+ * NetworkController state.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network configurations
+ */
+export const selectNetworkConfigurations = createSelector(
+  selectNetworkConfigurationsByChainId,
+  (networkConfigurationsByChainId) =>
+    Object.values(networkConfigurationsByChainId),
+);
+
+/**
+ * Get a list of all available network client IDs from a list of network
+ * configurations.
+ *
+ * @param networkConfigurations - The array of network configurations
+ * @returns A list of all available client IDs
+ */
+export function getAvailableNetworkClientIds(
+  networkConfigurations: NetworkConfiguration[],
+): string[] {
+  return networkConfigurations.flatMap((networkConfiguration) =>
+    networkConfiguration.rpcEndpoints.map(
+      (rpcEndpoint) => rpcEndpoint.networkClientId,
+    ),
+  );
+}
+
+/**
+ * Redux selector for getting a list of all available network client IDs
+ * from NetworkController state.
+ *
+ * @param state - NetworkController state
+ * @returns A list of all available network client IDs.
+ */
+export const selectAvailableNetworkClientIds = createSelector(
+  selectNetworkConfigurations,
+  getAvailableNetworkClientIds,
+);
+
+/**
+ * The collection of auto-managed network clients that map to Infura networks.
+ */
+export type AutoManagedBuiltInNetworkClientRegistry = Record<
+  BuiltInNetworkClientId,
+  AutoManagedNetworkClient<InfuraNetworkClientConfiguration>
+>;
+
+/**
+ * The collection of auto-managed network clients that map to Infura networks.
+ */
+export type AutoManagedCustomNetworkClientRegistry = Record<
+  CustomNetworkClientId,
+  AutoManagedNetworkClient<CustomNetworkClientConfiguration>
+>;
+
+/**
+ * The collection of auto-managed network clients that map to Infura networks
+ * as well as custom networks that users have added.
+ */
+export type AutoManagedNetworkClientRegistry = {
+  [NetworkClientType.Infura]: AutoManagedBuiltInNetworkClientRegistry;
+  [NetworkClientType.Custom]: AutoManagedCustomNetworkClientRegistry;
+};
+
+/**
+ * Instructs `addNetwork` and `updateNetwork` to create a network client for an
+ * RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type AddNetworkClientOperation = {
+  type: 'add';
+  rpcEndpoint: RpcEndpoint;
+};
+
+/**
+ * Instructs `updateNetwork` and `removeNetwork` to remove a network client for
+ * an RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type RemoveNetworkClientOperation = {
+  type: 'remove';
+  rpcEndpoint: RpcEndpoint;
+};
+
+/**
+ * Instructs `addNetwork` and `updateNetwork` to replace the network client for
+ * an RPC endpoint.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type ReplaceNetworkClientOperation = {
+  type: 'replace';
+  oldRpcEndpoint: RpcEndpoint;
+  newRpcEndpoint: RpcEndpoint;
+};
+
+/**
+ * Instructs `addNetwork` and `updateNetwork` not to do anything with an RPC
+ * endpoint, as far as the network client registry is concerned.
+ *
+ * @see {@link NetworkClientOperation}
+ */
+type NoopNetworkClientOperation = {
+  type: 'noop';
+  rpcEndpoint: RpcEndpoint;
+};
+
+/**
+ * Instructs `addNetwork`, `updateNetwork`, and `removeNetwork` how to
+ * update the network client registry.
+ *
+ * - When `addNetwork` is called, represents a network client that should be
+ * created for a new RPC endpoint.
+ * - When `removeNetwork` is called, represents a network client that should be
+ * destroyed for a previously existing RPC endpoint.
+ * - When `updateNetwork` is called, represents either:
+ *   - a network client that should be added for a new RPC endpoint
+ *   - a network client that should be removed for a previously existing RPC
+ *   endpoint
+ *   - a network client that should be replaced for an RPC endpoint that was
+ *   changed in a non-major way, or
+ *   - a network client that should be unchanged for an RPC endpoint that was
+ *   also unchanged.
+ */
+type NetworkClientOperation =
+  | AddNetworkClientOperation
+  | RemoveNetworkClientOperation
+  | ReplaceNetworkClientOperation
+  | NoopNetworkClientOperation;
+
+/**
+ * Determines whether the given URL is valid by attempting to parse it.
+ *
+ * @param url - The URL to test.
+ * @returns True if the URL is valid, false otherwise.
+ */
+function isValidUrl(url: string): boolean {
+  const uri = URI.parse(url);
+  return (
+    uri.error === undefined && (uri.scheme === 'http' || uri.scheme === 'https')
+  );
+}
+
+/**
+ * Given an Infura API URL, extracts the subdomain that identifies the Infura
+ * network.
+ *
+ * @param rpcEndpointUrl - The URL to operate on.
+ * @returns The Infura network name that the URL references.
+ * @throws if the URL is not an Infura API URL, or if an Infura network is not
+ * present in the URL.
+ */
+function deriveInfuraNetworkNameFromRpcEndpointUrl(
+  rpcEndpointUrl: string,
+): InfuraNetworkType {
+  const match = INFURA_URL_REGEX.exec(rpcEndpointUrl);
+
+  if (match?.groups) {
+    if (isInfuraNetworkType(match.groups.networkName)) {
+      return match.groups.networkName;
+    }
+
+    throw new Error(`Unknown Infura network '${match.groups.networkName}'`);
+  }
+
+  throw new Error('Could not derive Infura network from RPC endpoint URL');
+}
+
+/**
+ * Performs a series of checks that the given NetworkController state is
+ * internally consistent â€” that all parts of state that are supposed to match in
+ * fact do â€” so that working with the state later on doesn't cause unexpected
+ * errors.
+ *
+ * In the case of NetworkController, there are several parts of state that need
+ * to match. For instance, `defaultRpcEndpointIndex` needs to match an entry
+ * within `rpcEndpoints`, and `selectedNetworkClientId` needs to point to an RPC
+ * endpoint within a network configuration.
+ *
+ * @param state - The NetworkController state to verify.
+ * @throws if the state is invalid in some way.
+ */
+function validateInitialState(state: NetworkState): void {
+  const networkConfigurationEntries = Object.entries(
+    state.networkConfigurationsByChainId,
+  );
+  const networkClientIds = getAvailableNetworkClientIds(
+    getNetworkConfigurations(state),
+  );
+
+  if (networkConfigurationEntries.length === 0) {
+    throw new Error(
+      'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',
+    );
+  }
+
+  for (const [chainId, networkConfiguration] of networkConfigurationEntries) {
+    if (chainId !== networkConfiguration.chainId) {
+      throw new Error(
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' is filed under '${chainId}' which does not match its \`chainId\` of '${networkConfiguration.chainId}'`,
+      );
+    }
+
+    const isInvalidDefaultBlockExplorerUrlIndex =
+      networkConfiguration.blockExplorerUrls.length > 0
+        ? networkConfiguration.defaultBlockExplorerUrlIndex === undefined ||
+          networkConfiguration.blockExplorerUrls[
+            networkConfiguration.defaultBlockExplorerUrlIndex
+          ] === undefined
+        : networkConfiguration.defaultBlockExplorerUrlIndex !== undefined;
+
+    if (isInvalidDefaultBlockExplorerUrlIndex) {
+      throw new Error(
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' has a \`defaultBlockExplorerUrlIndex\` that does not refer to an entry in \`blockExplorerUrls\``,
+      );
+    }
+
+    if (
+      networkConfiguration.rpcEndpoints[
+        networkConfiguration.defaultRpcEndpointIndex
+      ] === undefined
+    ) {
+      throw new Error(
+        `NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${networkConfiguration.name}' has a \`defaultRpcEndpointIndex\` that does not refer to an entry in \`rpcEndpoints\``,
+      );
+    }
+  }
+
+  if ([...new Set(networkClientIds)].length < networkClientIds.length) {
+    throw new Error(
+      'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',
+    );
+  }
+}
+
+/**
+ * Checks that the given initial NetworkController state is internally
+ * consistent similar to `validateInitialState`, but if an anomaly is detected,
+ * it does its best to correct the state and logs an error to Sentry.
+ *
+ * @param state - The NetworkController state to verify.
+ * @param messenger - The NetworkController messenger.
+ * @returns The corrected state.
+ */
+function correctInitialState(
+  state: NetworkState,
+  messenger: NetworkControllerMessenger,
+): NetworkState {
+  const networkConfigurationsSortedByChainId = getNetworkConfigurations(
+    state,
+  ).sort((a, b) => a.chainId.localeCompare(b.chainId));
+  const availableNetworkClientIds = getAvailableNetworkClientIds(
+    networkConfigurationsSortedByChainId,
+  );
+  const invalidNetworkClientIdsWithMetadata = Object.keys(
+    state.networksMetadata,
+  ).filter(
+    (networkClientId) => !availableNetworkClientIds.includes(networkClientId),
+  );
+
+  return produce(state, (newState) => {
+    if (!availableNetworkClientIds.includes(state.selectedNetworkClientId)) {
+      const firstNetworkConfiguration = networkConfigurationsSortedByChainId[0];
+      const newSelectedNetworkClientId =
+        firstNetworkConfiguration.rpcEndpoints[
+          firstNetworkConfiguration.defaultRpcEndpointIndex
+        ].networkClientId;
+      messenger.captureException?.(
+        new Error(
+          `\`selectedNetworkClientId\` '${state.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${newSelectedNetworkClientId}'`,
+        ),
+      );
+      newState.selectedNetworkClientId = newSelectedNetworkClientId;
+    }
+
+    if (invalidNetworkClientIdsWithMetadata.length > 0) {
+      for (const invalidNetworkClientId of invalidNetworkClientIdsWithMetadata) {
+        delete newState.networksMetadata[invalidNetworkClientId];
+      }
+      messenger.captureException?.(
+        new Error(
+          '`networksMetadata` had invalid network client IDs, which have been removed',
+        ),
+      );
+    }
+  });
+}
+
+/**
+ * Transforms a map of chain ID to network configuration to a map of network
+ * client ID to network configuration.
+ *
+ * @param networkConfigurationsByChainId - The network configurations, keyed by
+ * chain ID.
+ * @returns The network configurations, keyed by network client ID.
+ */
+function buildNetworkConfigurationsByNetworkClientId(
+  networkConfigurationsByChainId: Record<Hex, NetworkConfiguration>,
+): Map<NetworkClientId, NetworkConfiguration> {
+  return new Map(
+    Object.values(networkConfigurationsByChainId).flatMap(
+      (networkConfiguration) => {
+        return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {
+          return [rpcEndpoint.networkClientId, networkConfiguration];
+        });
+      },
+    ),
+  );
+}
+
+/**
+ * Controller that creates and manages an Ethereum network provider.
+ */
+export class NetworkController extends BaseController<
+  typeof controllerName,
+  NetworkState,
+  NetworkControllerMessenger
+> {
+  #ethQuery?: EthQuery;
+
+  readonly #infuraProjectId: string;
+
+  #previouslySelectedNetworkClientId: string;
+
+  #providerProxy: ProviderProxy | undefined;
+
+  #blockTrackerProxy: BlockTrackerProxy | undefined;
+
+  #autoManagedNetworkClientRegistry?: AutoManagedNetworkClientRegistry;
+
+  #autoManagedNetworkClient?:
+    | AutoManagedNetworkClient<CustomNetworkClientConfiguration>
+    | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;
+
+  readonly #log: Logger | undefined;
+
+  readonly #getRpcServiceOptions: NetworkControllerOptions['getRpcServiceOptions'];
+
+  readonly #getBlockTrackerOptions: NetworkControllerOptions['getBlockTrackerOptions'];
+
+  #networkConfigurationsByNetworkClientId: Map<
+    NetworkClientId,
+    NetworkConfiguration
+  >;
+
+  #isRpcFailoverEnabled: Exclude<
+    NetworkControllerOptions['isRpcFailoverEnabled'],
+    undefined
+  >;
+
+  /**
+   * Constructs a NetworkController.
+   *
+   * @param options - The options; see {@link NetworkControllerOptions}.
+   */
+  constructor(options: NetworkControllerOptions) {
+    const {
+      messenger,
+      state,
+      infuraProjectId,
+      log,
+      getRpcServiceOptions,
+      getBlockTrackerOptions,
+      additionalDefaultNetworks,
+      isRpcFailoverEnabled = false,
+    } = options;
+    const initialState = {
+      ...getDefaultNetworkControllerState(additionalDefaultNetworks),
+      ...state,
+    };
+    validateInitialState(initialState);
+    const correctedInitialState = correctInitialState(initialState, messenger);
+
+    if (!infuraProjectId || typeof infuraProjectId !== 'string') {
+      throw new Error('Invalid Infura project ID');
+    }
+
+    super({
+      name: controllerName,
+      metadata: {
+        selectedNetworkClientId: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+        networksMetadata: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+        networkConfigurationsByChainId: {
+          includeInStateLogs: true,
+          persist: true,
+          includeInDebugSnapshot: false,
+          usedInUi: true,
+        },
+      },
+      messenger,
+      state: correctedInitialState,
+    });
+
+    this.#infuraProjectId = infuraProjectId;
+    this.#log = log;
+    this.#getRpcServiceOptions = getRpcServiceOptions;
+    this.#getBlockTrackerOptions = getBlockTrackerOptions;
+    this.#isRpcFailoverEnabled = isRpcFailoverEnabled;
+
+    this.#previouslySelectedNetworkClientId =
+      this.state.selectedNetworkClientId;
+    this.#networkConfigurationsByNetworkClientId =
+      buildNetworkConfigurationsByNetworkClientId(
+        this.state.networkConfigurationsByChainId,
+      );
+
+    this.messenger.registerActionHandler(`${this.name}:getEthQuery`, () => {
+      return this.#ethQuery;
+    });
+
+    this.messenger.registerActionHandler(
+      `${this.name}:getNetworkClientById`,
+      this.getNetworkClientById.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:getEIP1559Compatibility`,
+      this.getEIP1559Compatibility.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:setActiveNetwork`,
+      this.setActiveNetwork.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:setProviderType`,
+      this.setProviderType.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:findNetworkClientIdByChainId`,
+      this.findNetworkClientIdByChainId.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:getNetworkConfigurationByChainId`,
+      this.getNetworkConfigurationByChainId.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:getNetworkConfigurationByNetworkClientId`,
+      this.getNetworkConfigurationByNetworkClientId.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:getSelectedNetworkClient`,
+      this.getSelectedNetworkClient.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:getSelectedChainId`,
+      this.getSelectedChainId.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:addNetwork`,
+      this.addNetwork.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:removeNetwork`,
+      this.removeNetwork.bind(this),
+    );
+
+    this.messenger.registerActionHandler(
+      `${this.name}:updateNetwork`,
+      this.updateNetwork.bind(this),
+    );
+
+    this.messenger.subscribe(
+      `${this.name}:rpcEndpointChainUnavailable`,
+      ({ networkClientId }) => {
+        this.#updateMetadataForNetwork(networkClientId, {
+          networkStatus: NetworkStatus.Unavailable,
+        });
+      },
+    );
+    this.messenger.subscribe(
+      `${this.name}:rpcEndpointChainDegraded`,
+      ({ networkClientId }) => {
+        this.#updateMetadataForNetwork(networkClientId, {
+          networkStatus: NetworkStatus.Degraded,
+        });
+      },
+    );
+    this.messenger.subscribe(
+      `${this.name}:rpcEndpointChainAvailable`,
+      ({ networkClientId }) => {
+        this.#updateMetadataForNetwork(networkClientId, {
+          networkStatus: NetworkStatus.Available,
+        });
+      },
+    );
+  }
+
+  /**
+   * Enables the RPC failover functionality. That is, if any RPC endpoints are
+   * configured with failover URLs, then traffic will automatically be diverted
+   * to them if those RPC endpoints are unavailable.
+   */
+  enableRpcFailover(): void {
+    this.#updateRpcFailoverEnabled(true);
+  }
+
+  /**
+   * Disables the RPC failover functionality. That is, even if any RPC endpoints
+   * are configured with failover URLs, then traffic will not automatically be
+   * diverted to them if those RPC endpoints are unavailable.
+   */
+  disableRpcFailover(): void {
+    this.#updateRpcFailoverEnabled(false);
+  }
+
+  /**
+   * Enables or disables the RPC failover functionality, depending on the
+   * boolean given. This is done by reconstructing all network clients that were
+   * originally configured with failover URLs so that those URLs are either
+   * honored or ignored. Network client IDs will be preserved so as not to
+   * invalidate state in other controllers.
+   *
+   * @param newIsRpcFailoverEnabled - Whether or not to enable or disable the
+   * RPC failover functionality.
+   */
+  #updateRpcFailoverEnabled(newIsRpcFailoverEnabled: boolean): void {
+    if (this.#isRpcFailoverEnabled === newIsRpcFailoverEnabled) {
+      return;
+    }
+
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    for (const networkClientsById of Object.values(
+      autoManagedNetworkClientRegistry,
+    )) {
+      for (const networkClientId of Object.keys(networkClientsById)) {
+        // Type assertion: We can assume that `networkClientId` is valid here.
+        const networkClient =
+          networkClientsById[
+            networkClientId as keyof typeof networkClientsById
+          ];
+        if (
+          networkClient.configuration.failoverRpcUrls &&
+          networkClient.configuration.failoverRpcUrls.length > 0
+        ) {
+          newIsRpcFailoverEnabled
+            ? networkClient.enableRpcFailover()
+            : networkClient.disableRpcFailover();
+        }
+      }
+    }
+
+    this.#isRpcFailoverEnabled = newIsRpcFailoverEnabled;
+  }
+
+  /**
+   * Accesses the provider and block tracker for the currently selected network.
+   *
+   * @returns The proxy and block tracker proxies.
+   * @deprecated This method has been replaced by `getSelectedNetworkClient` (which has a more easily used return type) and will be removed in a future release.
+   */
+  getProviderAndBlockTracker(): {
+    provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>> | undefined;
+    blockTracker:
+      | SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>
+      | undefined;
+  } {
+    return {
+      provider: this.#providerProxy,
+      blockTracker: this.#blockTrackerProxy,
+    };
+  }
+
+  /**
+   * Accesses the provider and block tracker for the currently selected network.
+   *
+   * @returns an object with the provider and block tracker proxies for the currently selected network.
+   */
+  getSelectedNetworkClient():
+    | {
+        provider: SwappableProxy<ProxyWithAccessibleTarget<Provider>>;
+        blockTracker: SwappableProxy<ProxyWithAccessibleTarget<BlockTracker>>;
+      }
+    | undefined {
+    if (this.#providerProxy && this.#blockTrackerProxy) {
+      return {
+        provider: this.#providerProxy,
+        blockTracker: this.#blockTrackerProxy,
+      };
+    }
+    return undefined;
+  }
+
+  /**
+   * Accesses the chain ID from the selected network client.
+   *
+   * @returns The chain ID of the selected network client in hex format or undefined if there is no network client.
+   */
+  getSelectedChainId(): Hex | undefined {
+    const networkConfiguration = this.getNetworkConfigurationByNetworkClientId(
+      this.state.selectedNetworkClientId,
+    );
+    return networkConfiguration?.chainId;
+  }
+
+  /**
+   * Internally, the Infura and custom network clients are categorized by type
+   * so that when accessing either kind of network client, TypeScript knows
+   * which type to assign to the network client. For some cases it's more useful
+   * to be able to access network clients by ID instead of by type and then ID,
+   * so this function makes that possible.
+   *
+   * @returns The network clients registered so far, keyed by ID.
+   */
+  getNetworkClientRegistry(): AutoManagedBuiltInNetworkClientRegistry &
+    AutoManagedCustomNetworkClientRegistry {
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    return Object.assign(
+      {},
+      autoManagedNetworkClientRegistry[NetworkClientType.Infura],
+      autoManagedNetworkClientRegistry[NetworkClientType.Custom],
+    );
+  }
+
+  /**
+   * Returns the Infura network client with the given ID.
+   *
+   * @param infuraNetworkClientId - An Infura network client ID.
+   * @returns The Infura network client.
+   * @throws If an Infura network client does not exist with the given ID.
+   */
+  getNetworkClientById(
+    infuraNetworkClientId: BuiltInNetworkClientId,
+  ): AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;
+
+  /**
+   * Returns the custom network client with the given ID.
+   *
+   * @param customNetworkClientId - A custom network client ID.
+   * @returns The custom network client.
+   * @throws If a custom network client does not exist with the given ID.
+   */
+  getNetworkClientById(
+    customNetworkClientId: CustomNetworkClientId,
+  ): AutoManagedNetworkClient<CustomNetworkClientConfiguration>;
+
+  getNetworkClientById(
+    networkClientId: NetworkClientId,
+  ): AutoManagedNetworkClient<NetworkClientConfiguration> {
+    if (!networkClientId) {
+      throw new Error('No network client ID was provided.');
+    }
+
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    if (isInfuraNetworkType(networkClientId)) {
+      const infuraNetworkClient =
+        autoManagedNetworkClientRegistry[NetworkClientType.Infura][
+          networkClientId
+        ];
+      // This is impossible to reach
+      /* istanbul ignore if */
+      if (!infuraNetworkClient) {
+        throw new Error(
+          `No Infura network client was found with the ID "${networkClientId}".`,
+        );
+      }
+      return infuraNetworkClient;
+    }
+
+    const customNetworkClient =
+      autoManagedNetworkClientRegistry[NetworkClientType.Custom][
+        networkClientId
+      ];
+    if (!customNetworkClient) {
+      throw new Error(
+        `No custom network client was found with the ID "${networkClientId}".`,
+      );
+    }
+    return customNetworkClient;
+  }
+
+  /**
+   * Executes a series of steps to switch the network:
+   *
+   * 1. Notifies subscribers via the messenger that the network is about to be
+   * switched (and, really, that the global provider and block tracker proxies
+   * will be re-pointed to a new network).
+   * 2. Looks up a known and preinitialized network client matching the given
+   * ID and uses it to re-point the aforementioned provider and block tracker
+   * proxies.
+   * 3. Notifies subscribers via the messenger that the network has switched.
+   * 4. Captures metadata for the newly switched network in state.
+   *
+   * @param networkClientId - The ID of a network client that requests will be
+   * routed through (either the name of an Infura network or the ID of a custom
+   * network configuration).
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   */
+  async #refreshNetwork(
+    networkClientId: string,
+    options: {
+      updateState?: (state: Draft<NetworkState>) => void;
+    } = {},
+  ): Promise<void> {
+    this.messenger.publish('NetworkController:networkWillChange', this.state);
+    this.#applyNetworkSelection(networkClientId, options);
+    this.messenger.publish('NetworkController:networkDidChange', this.state);
+    await this.lookupNetwork();
+  }
+
+  /**
+   * Creates proxies for accessing the global network client and its block
+   * tracker. You must call this method in order to use
+   * `getProviderAndBlockTracker` (or its replacement,
+   * `getSelectedNetworkClient`).
+   *
+   * @param options - Optional arguments.
+   * @param options.lookupNetwork - Usually, metadata for the global network
+   * will be populated via a call to `lookupNetwork` after creating the provider
+   * and block tracker proxies. This allows for responding to the status of the
+   * global network after initializing this controller; however, it requires
+   * making a request to the network to do so. In the clients, where controllers
+   * are initialized before the UI is shown, this may be undesirable, as it
+   * means that if the user has just installed MetaMask, their IP address may be
+   * shared with a third party before they have a chance to finish onboarding.
+   * You can pass `false` if you'd like to disable this request and call
+   * `lookupNetwork` yourself.
+   */
+  initializeProvider(options: { lookupNetwork: false }): void;
+
+  /**
+   * Creates proxies for accessing the global network client and its block
+   * tracker. You must call this method in order to use
+   * `getProviderAndBlockTracker` (or its replacement,
+   * `getSelectedNetworkClient`).
+   *
+   * @param options - Optional arguments.
+   * @param options.lookupNetwork - Usually, metadata for the global network
+   * will be populated via a call to `lookupNetwork` after creating the provider
+   * and block tracker proxies. This allows for responding to the status of the
+   * global network after initializing this controller; however, it requires
+   * making a request to the network to do so. In the clients, where controllers
+   * are initialized before the UI is shown, this may be undesirable, as it
+   * means that if the user has just installed MetaMask, their IP address may be
+   * shared with a third party before they have a chance to finish onboarding.
+   * You can pass `false` if you'd like to disable this request and call
+   * `lookupNetwork` yourself.
+   * @returns A promise that resolves when the network lookup completes.
+   */
+  initializeProvider(options?: { lookupNetwork?: boolean }): Promise<void>;
+
+  initializeProvider({
+    lookupNetwork = true,
+  }: {
+    lookupNetwork?: boolean;
+  } = {}): Promise<void> | undefined {
+    this.#applyNetworkSelection(this.state.selectedNetworkClientId);
+
+    if (lookupNetwork) {
+      return this.lookupNetwork();
+    }
+
+    return undefined;
+  }
+
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network:
+   *
+   * - The connectivity status: whether it is available, geo-blocked (Infura
+   * only), unavailable, or unknown
+   * - The capabilities status: whether it supports EIP-1559, whether it does
+   * not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * If no ID is provided, uses the currently selected network.
+   * @returns The resulting metadata for the network.
+   */
+  async #determineNetworkMetadata(networkClientId: NetworkClientId): Promise<{
+    isInfura: boolean;
+    networkStatus:
+      | NetworkStatus.Available
+      | NetworkStatus.Unknown
+      | NetworkStatus.Unavailable
+      | NetworkStatus.Blocked;
+    isEIP1559Compatible: undefined | boolean;
+  }> {
+    // Force TypeScript to use one of the two overloads explicitly
+    const networkClient = isInfuraNetworkType(networkClientId)
+      ? this.getNetworkClientById(networkClientId)
+      : this.getNetworkClientById(networkClientId);
+
+    const isInfura =
+      networkClient.configuration.type === NetworkClientType.Infura;
+    let networkStatus: NetworkStatus;
+    let isEIP1559Compatible: boolean | undefined;
+
+    try {
+      isEIP1559Compatible =
+        await this.#determineEIP1559Compatibility(networkClientId);
+      networkStatus = NetworkStatus.Available;
+    } catch (error) {
+      debugLog('NetworkController: lookupNetwork: ', error);
+
+      if (isErrorWithCode(error)) {
+        let responseBody;
+        if (
+          isInfura &&
+          hasProperty(error, 'message') &&
+          typeof error.message === 'string'
+        ) {
+          try {
+            responseBody = JSON.parse(error.message);
+          } catch {
+            // error.message must not be JSON
+            this.#log?.warn(
+              'NetworkController: lookupNetwork: json parse error: ',
+              error,
+            );
+          }
+        }
+
+        if (
+          isPlainObject(responseBody) &&
+          responseBody.error === INFURA_BLOCKED_KEY
+        ) {
+          networkStatus = NetworkStatus.Blocked;
+        } else if (error.code === errorCodes.rpc.internal) {
+          networkStatus = NetworkStatus.Unknown;
+          this.#log?.warn(
+            'NetworkController: lookupNetwork: rpc internal error: ',
+            error,
+          );
+        } else {
+          networkStatus = NetworkStatus.Unavailable;
+          this.#log?.warn('NetworkController: lookupNetwork: ', error);
+        }
+      } else {
+        debugLog(
+          'NetworkController - could not determine network status',
+          error,
+        );
+        networkStatus = NetworkStatus.Unknown;
+        this.#log?.warn('NetworkController: lookupNetwork: ', error);
+      }
+    }
+
+    return { isInfura, networkStatus, isEIP1559Compatible };
+  }
+
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given or selected network, persisting it to state:
+   *
+   * - The connectivity status: whether it is available, geo-blocked (Infura
+   * only), unavailable, or unknown
+   * - The capabilities status: whether it supports EIP-1559, whether it does
+   * not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * If no ID is provided, uses the currently selected network.
+   */
+  async lookupNetwork(networkClientId?: NetworkClientId): Promise<void> {
+    if (networkClientId) {
+      await this.#lookupGivenNetwork(networkClientId);
+    } else {
+      await this.#lookupSelectedNetwork();
+    }
+  }
+
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   * @deprecated Please use `lookupNetwork` and pass a network client ID
+   * instead. This method will be removed in a future major version.
+   */
+  // We are planning on removing this so we aren't interested in testing this
+  // right now.
+  /* istanbul ignore next */
+  async lookupNetworkByClientId(
+    networkClientId: NetworkClientId,
+  ): Promise<void> {
+    await this.#lookupGivenNetwork(networkClientId);
+  }
+
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the given network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * @param networkClientId - The ID of the network client to inspect.
+   */
+  async #lookupGivenNetwork(networkClientId: NetworkClientId): Promise<void> {
+    const { networkStatus, isEIP1559Compatible } =
+      await this.#determineNetworkMetadata(networkClientId);
+
+    this.#updateMetadataForNetwork(networkClientId, {
+      networkStatus,
+      isEIP1559Compatible,
+    });
+  }
+
+  /**
+   * Uses a request for the latest block to gather the following information on
+   * the currently selected network, persisting it to state:
+   *
+   * - The connectivity status: whether the network is available, geo-blocked
+   * (Infura only), unavailable, or unknown
+   * - The feature compatibility status: whether the network supports EIP-1559,
+   * whether it does not, or whether it is unknown
+   *
+   * Note that it is possible for the current network to be switched while this
+   * method is running. If that is the case, it will exit early (as this method
+   * will also run for the new network).
+   */
+  async #lookupSelectedNetwork(): Promise<void> {
+    if (!this.#ethQuery) {
+      return;
+    }
+
+    let networkChanged = false;
+    const listener = (): void => {
+      networkChanged = true;
+      try {
+        this.messenger.unsubscribe(
+          'NetworkController:networkDidChange',
+          listener,
+        );
+      } catch (error) {
+        // In theory, this `catch` should not be necessary given that this error
+        // would occur "inside" of the call to `#determineEIP1559Compatibility`
+        // below and so it should be caught by the `try`/`catch` below (it is
+        // impossible to reproduce in tests for that reason). However, somehow
+        // it occurs within Mobile and so we have to add our own `try`/`catch`
+        // here.
+        /* istanbul ignore next */
+        if (
+          !(error instanceof Error) ||
+          error.message !==
+            'Subscription not found for event: NetworkController:networkDidChange'
+        ) {
+          // Again, this error should not happen and is impossible to reproduce
+          // in tests.
+          /* istanbul ignore next */
+          throw error;
+        }
+      }
+    };
+    this.messenger.subscribe('NetworkController:networkDidChange', listener);
+
+    const { isInfura, networkStatus, isEIP1559Compatible } =
+      await this.#determineNetworkMetadata(this.state.selectedNetworkClientId);
+
+    if (networkChanged) {
+      // If the network has changed, then `lookupNetwork` either has been or is
+      // in the process of being called, so we don't need to go further.
+      return;
+    }
+
+    try {
+      this.messenger.unsubscribe(
+        'NetworkController:networkDidChange',
+        listener,
+      );
+    } catch (error) {
+      if (
+        !(error instanceof Error) ||
+        error.message !==
+          'Subscription not found for event: NetworkController:networkDidChange'
+      ) {
+        throw error;
+      }
+    }
+
+    this.#updateMetadataForNetwork(this.state.selectedNetworkClientId, {
+      networkStatus,
+      isEIP1559Compatible,
+    });
+
+    if (isInfura) {
+      if (networkStatus === NetworkStatus.Available) {
+        this.messenger.publish('NetworkController:infuraIsUnblocked');
+      } else if (networkStatus === NetworkStatus.Blocked) {
+        this.messenger.publish('NetworkController:infuraIsBlocked');
+      }
+    } else {
+      // Always publish infuraIsUnblocked regardless of network status to
+      // prevent consumers from being stuck in a blocked state if they were
+      // previously connected to an Infura network that was blocked
+      this.messenger.publish('NetworkController:infuraIsUnblocked');
+    }
+  }
+
+  /**
+   * Updates the metadata for the given network in state.
+   *
+   * @param networkClientId - The associated network client ID.
+   * @param metadata - The metadata to store in state.
+   * @param metadata.networkStatus - The network status to store in state.
+   * @param metadata.isEIP1559Compatible - The EIP-1559 compatibility status to
+   * store in state.
+   */
+  #updateMetadataForNetwork(
+    networkClientId: NetworkClientId,
+    metadata: {
+      networkStatus: NetworkStatus;
+      isEIP1559Compatible?: boolean | undefined;
+    },
+  ): void {
+    this.update((state) => {
+      state.networksMetadata[networkClientId] ??= {
+        status: NetworkStatus.Unknown,
+        EIPS: {},
+      };
+
+      const newMetadata = state.networksMetadata[networkClientId];
+      newMetadata.status = metadata.networkStatus;
+
+      if ('isEIP1559Compatible' in metadata) {
+        if (metadata.isEIP1559Compatible === undefined) {
+          delete newMetadata.EIPS[1559];
+        } else {
+          newMetadata.EIPS[1559] = metadata.isEIP1559Compatible;
+        }
+      }
+    });
+  }
+
+  /**
+   * Convenience method to update provider network type settings.
+   *
+   * @param type - Human readable network name.
+   * @deprecated This has been replaced by `setActiveNetwork`, and will be
+   * removed in a future release
+   */
+  async setProviderType(type: InfuraNetworkType): Promise<void> {
+    if ((type as unknown) === NetworkType.rpc) {
+      throw new Error(
+        `NetworkController - cannot call "setProviderType" with type "${NetworkType.rpc}". Use "setActiveNetwork"`,
+      );
+    }
+    if (!isInfuraNetworkType(type)) {
+      throw new Error(`Unknown Infura provider type "${String(type)}".`);
+    }
+
+    await this.setActiveNetwork(type);
+  }
+
+  /**
+   * Changes the selected network.
+   *
+   * @param networkClientId - The ID of a network client that will be used to
+   * make requests.
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   * @throws if no network client is associated with the given
+   * network client ID.
+   */
+  async setActiveNetwork(
+    networkClientId: string,
+    options: {
+      updateState?: (state: Draft<NetworkState>) => void;
+    } = {},
+  ): Promise<void> {
+    this.#previouslySelectedNetworkClientId =
+      this.state.selectedNetworkClientId;
+
+    await this.#refreshNetwork(networkClientId, options);
+  }
+
+  /**
+   * Fetches the latest block for the network.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check the latest block. Defaults to the selectedNetworkClientId.
+   * @returns A promise that either resolves to the block header or null if
+   * there is no latest block, or rejects with an error.
+   */
+  #getLatestBlock(
+    networkClientId: NetworkClientId = this.state.selectedNetworkClientId,
+  ): Promise<Block> {
+    const networkClient = this.getNetworkClientById(networkClientId);
+    const ethQuery = new EthQuery(networkClient.provider);
+
+    return new Promise((resolve, reject) => {
+      ethQuery.sendAsync(
+        { method: 'eth_getBlockByNumber', params: ['latest', false] },
+        (error: unknown, block?: unknown) => {
+          if (error) {
+            // This error comes from JsonRpcEngine, we don't control it.
+            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors
+            reject(error);
+          } else {
+            // TODO: Validate this type
+            resolve(block as Block);
+          }
+        },
+      );
+    });
+  }
+
+  /**
+   * Determines whether the network supports EIP-1559 by checking whether the
+   * latest block has a `baseFeePerGas` property, then updates state
+   * appropriately.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility.
+   * @returns A promise that resolves to true if the network supports EIP-1559
+   * , false otherwise, or `undefined` if unable to determine the compatibility.
+   */
+  async getEIP1559Compatibility(
+    networkClientId?: NetworkClientId,
+  ): Promise<undefined | boolean> {
+    if (networkClientId) {
+      return this.get1559CompatibilityWithNetworkClientId(networkClientId);
+    }
+    if (!this.#ethQuery) {
+      return false;
+    }
+
+    const { EIPS } =
+      this.state.networksMetadata[this.state.selectedNetworkClientId];
+
+    if (EIPS[1559] !== undefined) {
+      return EIPS[1559];
+    }
+
+    const isEIP1559Compatible = await this.#determineEIP1559Compatibility(
+      this.state.selectedNetworkClientId,
+    );
+    this.update((state) => {
+      if (isEIP1559Compatible !== undefined) {
+        state.networksMetadata[state.selectedNetworkClientId].EIPS[1559] =
+          isEIP1559Compatible;
+      }
+    });
+    return isEIP1559Compatible;
+  }
+
+  async get1559CompatibilityWithNetworkClientId(
+    networkClientId: NetworkClientId,
+  ): Promise<boolean> {
+    let metadata = this.state.networksMetadata[networkClientId];
+    if (metadata?.EIPS[1559] === undefined) {
+      await this.lookupNetwork(networkClientId);
+      metadata = this.state.networksMetadata[networkClientId];
+    }
+    const { EIPS } = metadata;
+
+    // may want to include some 'freshness' value - something to make sure we refetch this from time to time
+    return EIPS[1559];
+  }
+
+  /**
+   * Retrieves and checks the latest block from the currently selected
+   * network; if the block has a `baseFeePerGas` property, then we know
+   * that the network supports EIP-1559; otherwise it doesn't.
+   *
+   * @param networkClientId - The networkClientId to fetch the correct provider against which to check 1559 compatibility
+   * @returns A promise that resolves to `true` if the network supports EIP-1559,
+   * `false` otherwise, or `undefined` if unable to retrieve the last block.
+   */
+  async #determineEIP1559Compatibility(
+    networkClientId: NetworkClientId,
+  ): Promise<boolean | undefined> {
+    const latestBlock = await this.#getLatestBlock(networkClientId);
+
+    if (!latestBlock) {
+      return undefined;
+    }
+
+    return latestBlock.baseFeePerGas !== undefined;
+  }
+
+  /**
+   * Ensures that the provider and block tracker proxies are pointed to the
+   * currently selected network and refreshes the metadata for the
+   */
+  async resetConnection(): Promise<void> {
+    await this.#refreshNetwork(this.state.selectedNetworkClientId);
+  }
+
+  /**
+   * Returns the network configuration that has been filed under the given chain
+   * ID.
+   *
+   * @param chainId - The chain ID to use as a key.
+   * @returns The network configuration if one exists, or undefined.
+   */
+  getNetworkConfigurationByChainId(
+    chainId: Hex,
+  ): NetworkConfiguration | undefined {
+    return this.state.networkConfigurationsByChainId[chainId];
+  }
+
+  /**
+   * Returns the network configuration that contains an RPC endpoint with the
+   * given network client ID.
+   *
+   * @param networkClientId - The network client ID to use as a key.
+   * @returns The network configuration if one exists, or undefined.
+   */
+  getNetworkConfigurationByNetworkClientId(
+    networkClientId: NetworkClientId,
+  ): NetworkConfiguration | undefined {
+    return this.#networkConfigurationsByNetworkClientId.get(networkClientId);
+  }
+
+  /**
+   * Creates and registers network clients for the collection of Infura and
+   * custom RPC endpoints that can be used to make requests for a particular
+   * chain, storing the given configuration object in state for later reference.
+   *
+   * @param fields - The object that describes the new network/chain and lists
+   * the RPC endpoints which front that chain.
+   * @returns The newly added network configuration.
+   * @throws if any part of `fields` would produce invalid state.
+   * @see {@link NetworkConfiguration}
+   */
+  addNetwork(fields: AddNetworkFields): NetworkConfiguration {
+    const { rpcEndpoints: setOfRpcEndpointFields } = fields;
+
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    this.#validateNetworkFields({
+      mode: 'add',
+      networkFields: fields,
+      autoManagedNetworkClientRegistry,
+    });
+
+    const networkClientOperations = setOfRpcEndpointFields.map(
+      (defaultOrCustomRpcEndpointFields) => {
+        const rpcEndpoint =
+          defaultOrCustomRpcEndpointFields.type === RpcEndpointType.Custom
+            ? {
+                ...defaultOrCustomRpcEndpointFields,
+                networkClientId: uuidV4(),
+              }
+            : defaultOrCustomRpcEndpointFields;
+        return {
+          type: 'add' as const,
+          rpcEndpoint,
+        };
+      },
+    );
+
+    const newNetworkConfiguration =
+      this.#determineNetworkConfigurationToPersist({
+        networkFields: fields,
+        networkClientOperations,
+      });
+    this.#registerNetworkClientsAsNeeded({
+      networkFields: fields,
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+    this.update((state) => {
+      this.#updateNetworkConfigurations({
+        state,
+        mode: 'add',
+        networkFields: fields,
+        networkConfigurationToPersist: newNetworkConfiguration,
+      });
+    });
+
+    this.messenger.publish(
+      `${controllerName}:networkAdded`,
+      newNetworkConfiguration,
+    );
+
+    return newNetworkConfiguration;
+  }
+
+  /**
+   * Updates the configuration for a previously stored network filed under the
+   * given chain ID, creating + registering new network clients to represent RPC
+   * endpoints that have been added and destroying + unregistering existing
+   * network clients for RPC endpoints that have been removed.
+   *
+   * Note that if `chainId` is changed, then all network clients associated with
+   * that chain will be removed and re-added, even if none of the RPC endpoints
+   * have changed.
+   *
+   * @param chainId - The chain ID associated with an existing network.
+   * @param fields - The object that describes the updates to the network/chain,
+   * including the new set of RPC endpoints which should front that chain.
+   * @param options - Options to provide.
+   * @param options.replacementSelectedRpcEndpointIndex - Usually you cannot
+   * remove an RPC endpoint that is being represented by the currently selected
+   * network client. This option allows you to specify another RPC endpoint
+   * (either an existing one or a new one) that should be used to select a new
+   * network instead.
+   * @returns The updated network configuration.
+   * @throws if `chainId` does not refer to an existing network configuration,
+   * if any part of `fields` would produce invalid state, etc.
+   * @see {@link NetworkConfiguration}
+   */
+  async updateNetwork(
+    chainId: Hex,
+    fields: UpdateNetworkFields,
+    {
+      replacementSelectedRpcEndpointIndex,
+    }: { replacementSelectedRpcEndpointIndex?: number } = {},
+  ): Promise<NetworkConfiguration> {
+    const existingNetworkConfiguration =
+      this.state.networkConfigurationsByChainId[chainId];
+
+    if (existingNetworkConfiguration === undefined) {
+      throw new Error(
+        `Could not update network: Cannot find network configuration for chain '${chainId}'`,
+      );
+    }
+
+    const existingChainId = chainId;
+    const { chainId: newChainId, rpcEndpoints: setOfNewRpcEndpointFields } =
+      fields;
+
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    this.#validateNetworkFields({
+      mode: 'update',
+      networkFields: fields,
+      existingNetworkConfiguration,
+      autoManagedNetworkClientRegistry,
+    });
+
+    const networkClientOperations: NetworkClientOperation[] = [];
+
+    for (const newRpcEndpointFields of setOfNewRpcEndpointFields) {
+      const existingRpcEndpointForNoop =
+        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {
+          return (
+            rpcEndpoint.type === newRpcEndpointFields.type &&
+            rpcEndpoint.url === newRpcEndpointFields.url &&
+            (rpcEndpoint.networkClientId ===
+              newRpcEndpointFields.networkClientId ||
+              newRpcEndpointFields.networkClientId === undefined)
+          );
+        });
+      const existingRpcEndpointForReplaceWhenChainChanged =
+        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {
+          return (
+            (rpcEndpoint.type === RpcEndpointType.Infura &&
+              newRpcEndpointFields.type === RpcEndpointType.Infura) ||
+            (rpcEndpoint.type === newRpcEndpointFields.type &&
+              rpcEndpoint.networkClientId ===
+                newRpcEndpointFields.networkClientId &&
+              rpcEndpoint.url === newRpcEndpointFields.url)
+          );
+        });
+      const existingRpcEndpointForReplaceWhenChainNotChanged =
+        existingNetworkConfiguration.rpcEndpoints.find((rpcEndpoint) => {
+          return (
+            rpcEndpoint.type === newRpcEndpointFields.type &&
+            (rpcEndpoint.url === newRpcEndpointFields.url ||
+              rpcEndpoint.networkClientId ===
+                newRpcEndpointFields.networkClientId)
+          );
+        });
+
+      if (
+        newChainId !== existingChainId &&
+        existingRpcEndpointForReplaceWhenChainChanged !== undefined
+      ) {
+        const newRpcEndpoint =
+          newRpcEndpointFields.type === RpcEndpointType.Infura
+            ? newRpcEndpointFields
+            : { ...newRpcEndpointFields, networkClientId: uuidV4() };
+
+        networkClientOperations.push({
+          type: 'replace' as const,
+          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainChanged,
+          newRpcEndpoint,
+        });
+      } else if (existingRpcEndpointForNoop !== undefined) {
+        let newRpcEndpoint;
+        if (existingRpcEndpointForNoop.type === RpcEndpointType.Infura) {
+          newRpcEndpoint = existingRpcEndpointForNoop;
+        } else {
+          // `networkClientId` shouldn't be missing at this point; if it is,
+          // that's a mistake, so fill it back in
+          newRpcEndpoint = Object.assign({}, newRpcEndpointFields, {
+            networkClientId: existingRpcEndpointForNoop.networkClientId,
+          });
+        }
+        networkClientOperations.push({
+          type: 'noop' as const,
+          rpcEndpoint: newRpcEndpoint,
+        });
+      } else if (
+        existingRpcEndpointForReplaceWhenChainNotChanged === undefined
+      ) {
+        const newRpcEndpoint =
+          newRpcEndpointFields.type === RpcEndpointType.Infura
+            ? newRpcEndpointFields
+            : { ...newRpcEndpointFields, networkClientId: uuidV4() };
+        const networkClientOperation = {
+          type: 'add' as const,
+          rpcEndpoint: newRpcEndpoint,
+        };
+        networkClientOperations.push(networkClientOperation);
+      } else {
+        let newRpcEndpoint;
+        /* istanbul ignore if */
+        if (newRpcEndpointFields.type === RpcEndpointType.Infura) {
+          // This case can't actually happen. If we're here, it means that some
+          // part of the RPC endpoint changed. But there is no part of an Infura
+          // RPC endpoint that can be changed (as it would immediately make that
+          // RPC endpoint self-inconsistent). This is just here to appease
+          // TypeScript.
+          newRpcEndpoint = newRpcEndpointFields;
+        } else {
+          newRpcEndpoint = {
+            ...newRpcEndpointFields,
+            networkClientId: uuidV4(),
+          };
+        }
+
+        networkClientOperations.push({
+          type: 'replace' as const,
+          oldRpcEndpoint: existingRpcEndpointForReplaceWhenChainNotChanged,
+          newRpcEndpoint,
+        });
+      }
+    }
+
+    for (const existingRpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {
+      if (
+        !networkClientOperations.some((networkClientOperation) => {
+          const otherRpcEndpoint =
+            networkClientOperation.type === 'replace'
+              ? networkClientOperation.oldRpcEndpoint
+              : networkClientOperation.rpcEndpoint;
+          return (
+            otherRpcEndpoint.type === existingRpcEndpoint.type &&
+            otherRpcEndpoint.networkClientId ===
+              existingRpcEndpoint.networkClientId &&
+            otherRpcEndpoint.url === existingRpcEndpoint.url
+          );
+        })
+      ) {
+        const networkClientOperation = {
+          type: 'remove' as const,
+          rpcEndpoint: existingRpcEndpoint,
+        };
+        networkClientOperations.push(networkClientOperation);
+      }
+    }
+
+    const updatedNetworkConfiguration =
+      this.#determineNetworkConfigurationToPersist({
+        networkFields: fields,
+        networkClientOperations,
+      });
+
+    if (
+      replacementSelectedRpcEndpointIndex === undefined &&
+      networkClientOperations.some((networkClientOperation) => {
+        return (
+          networkClientOperation.type === 'remove' &&
+          networkClientOperation.rpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      }) &&
+      !networkClientOperations.some((networkClientOperation) => {
+        return (
+          networkClientOperation.type === 'replace' &&
+          networkClientOperation.oldRpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      })
+    ) {
+      throw new Error(
+        `Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \`replacementSelectedRpcEndpointIndex\` option.`,
+      );
+    }
+
+    this.#registerNetworkClientsAsNeeded({
+      networkFields: fields,
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+
+    const replacementSelectedRpcEndpointWithIndex = networkClientOperations
+      .map(
+        (networkClientOperation, index) =>
+          [networkClientOperation, index] as const,
+      )
+      .find(([networkClientOperation, _index]) => {
+        return (
+          networkClientOperation.type === 'replace' &&
+          networkClientOperation.oldRpcEndpoint.networkClientId ===
+            this.state.selectedNetworkClientId
+        );
+      });
+    const correctedReplacementSelectedRpcEndpointIndex =
+      replacementSelectedRpcEndpointIndex ??
+      replacementSelectedRpcEndpointWithIndex?.[1];
+
+    let rpcEndpointToSelect: RpcEndpoint | undefined;
+    if (correctedReplacementSelectedRpcEndpointIndex !== undefined) {
+      rpcEndpointToSelect =
+        updatedNetworkConfiguration.rpcEndpoints[
+          correctedReplacementSelectedRpcEndpointIndex
+        ];
+
+      if (rpcEndpointToSelect === undefined) {
+        throw new Error(
+          `Could not update network: \`replacementSelectedRpcEndpointIndex\` ${correctedReplacementSelectedRpcEndpointIndex} does not refer to an entry in \`rpcEndpoints\``,
+        );
+      }
+    }
+
+    if (
+      rpcEndpointToSelect &&
+      rpcEndpointToSelect.networkClientId !== this.state.selectedNetworkClientId
+    ) {
+      await this.setActiveNetwork(rpcEndpointToSelect.networkClientId, {
+        updateState: (state) => {
+          this.#updateNetworkConfigurations({
+            state,
+            mode: 'update',
+            networkFields: fields,
+            networkConfigurationToPersist: updatedNetworkConfiguration,
+            existingNetworkConfiguration,
+          });
+        },
+      });
+    } else {
+      this.update((state) => {
+        this.#updateNetworkConfigurations({
+          state,
+          mode: 'update',
+          networkFields: fields,
+          networkConfigurationToPersist: updatedNetworkConfiguration,
+          existingNetworkConfiguration,
+        });
+      });
+    }
+
+    this.#unregisterNetworkClientsAsNeeded({
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+
+    return updatedNetworkConfiguration;
+  }
+
+  /**
+   * Destroys and unregisters the network identified by the given chain ID, also
+   * removing the associated network configuration from state.
+   *
+   * @param chainId - The chain ID associated with an existing network.
+   * @throws if `chainId` does not refer to an existing network configuration,
+   * or if the currently selected network is being removed.
+   * @see {@link NetworkConfiguration}
+   */
+  removeNetwork(chainId: Hex): void {
+    const existingNetworkConfiguration =
+      this.state.networkConfigurationsByChainId[chainId];
+
+    if (existingNetworkConfiguration === undefined) {
+      throw new Error(
+        `Cannot find network configuration for chain '${chainId}'`,
+      );
+    }
+
+    if (
+      existingNetworkConfiguration.rpcEndpoints.some(
+        (rpcEndpoint) =>
+          rpcEndpoint.networkClientId === this.state.selectedNetworkClientId,
+      )
+    ) {
+      throw new Error(`Cannot remove the currently selected network`);
+    }
+
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    const networkClientOperations =
+      existingNetworkConfiguration.rpcEndpoints.map((rpcEndpoint) => {
+        return {
+          type: 'remove' as const,
+          rpcEndpoint,
+        };
+      });
+
+    this.#unregisterNetworkClientsAsNeeded({
+      networkClientOperations,
+      autoManagedNetworkClientRegistry,
+    });
+    this.update((state) => {
+      this.#updateNetworkConfigurations({
+        state,
+        mode: 'remove',
+        existingNetworkConfiguration,
+      });
+
+      for (const rpcEndpoint of existingNetworkConfiguration.rpcEndpoints) {
+        delete state.networksMetadata[rpcEndpoint.networkClientId];
+      }
+    });
+
+    this.messenger.publish(
+      'NetworkController:networkRemoved',
+      existingNetworkConfiguration,
+    );
+  }
+
+  /**
+   * Assuming that the network has been previously switched, switches to this
+   * new network.
+   *
+   * If the network has not been previously switched, this method is equivalent
+   * to {@link resetConnection}.
+   */
+  async rollbackToPreviousProvider(): Promise<void> {
+    await this.#refreshNetwork(this.#previouslySelectedNetworkClientId);
+  }
+
+  /**
+   * Deactivates the controller, stopping any ongoing polling.
+   *
+   * In-progress requests will not be aborted.
+   */
+  // We're intentionally changing the signature of an extended method.
+  // eslint-disable-next-line @typescript-eslint/no-misused-promises
+  async destroy(): Promise<void> {
+    await this.#blockTrackerProxy?.destroy();
+  }
+
+  /**
+   * Merges the given backup data into controller state.
+   *
+   * @param backup - The data that has been backed up.
+   * @param backup.networkConfigurationsByChainId - Network configurations,
+   * keyed by chain ID.
+   */
+  loadBackup({
+    networkConfigurationsByChainId,
+  }: Pick<NetworkState, 'networkConfigurationsByChainId'>): void {
+    this.update((state) => {
+      state.networkConfigurationsByChainId = {
+        ...state.networkConfigurationsByChainId,
+        ...networkConfigurationsByChainId,
+      };
+    });
+  }
+
+  /**
+   * Searches for the default RPC endpoint configured for the given chain and
+   * returns its network client ID. This can then be passed to
+   * {@link getNetworkClientById} to retrieve the network client.
+   *
+   * @param chainId - Chain ID to search for.
+   * @returns The ID of the network client created for the chain's default RPC
+   * endpoint.
+   */
+  findNetworkClientIdByChainId(chainId: Hex): NetworkClientId {
+    const networkConfiguration =
+      this.state.networkConfigurationsByChainId[chainId];
+
+    if (!networkConfiguration) {
+      throw new Error(`Invalid chain ID "${chainId}"`);
+    }
+
+    const { networkClientId } =
+      networkConfiguration.rpcEndpoints[
+        networkConfiguration.defaultRpcEndpointIndex
+      ];
+    return networkClientId;
+  }
+
+  /**
+   * Ensure that the given fields which will be used to either add or update a
+   * network are valid.
+   *
+   * @param args - The arguments.
+   */
+  #validateNetworkFields(
+    args: {
+      autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+    } & (
+      | {
+          mode: 'add';
+          networkFields: AddNetworkFields;
+        }
+      | {
+          mode: 'update';
+          existingNetworkConfiguration: NetworkConfiguration;
+          networkFields: UpdateNetworkFields;
+        }
+    ),
+  ): void {
+    const { mode, networkFields, autoManagedNetworkClientRegistry } = args;
+    const existingNetworkConfiguration =
+      'existingNetworkConfiguration' in args
+        ? args.existingNetworkConfiguration
+        : null;
+
+    const errorMessagePrefix =
+      mode === 'update' ? 'Could not update network' : 'Could not add network';
+
+    if (
+      !isStrictHexString(networkFields.chainId) ||
+      !isSafeChainId(networkFields.chainId)
+    ) {
+      throw new Error(
+        `${errorMessagePrefix}: Invalid \`chainId\` '${networkFields.chainId}' (must start with "0x" and not exceed the maximum)`,
+      );
+    }
+
+    if (
+      existingNetworkConfiguration === null ||
+      networkFields.chainId !== existingNetworkConfiguration.chainId
+    ) {
+      const existingNetworkConfigurationViaChainId =
+        this.state.networkConfigurationsByChainId[networkFields.chainId];
+      if (existingNetworkConfigurationViaChainId !== undefined) {
+        if (existingNetworkConfiguration === null) {
+          throw new Error(
+            `Could not add network for chain ${args.networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,
+          );
+        } else {
+          throw new Error(
+            `Cannot move network from chain ${existingNetworkConfiguration.chainId} to ${networkFields.chainId} as another network for that chain already exists ('${existingNetworkConfigurationViaChainId.name}')`,
+          );
+        }
+      }
+    }
+
+    const isInvalidDefaultBlockExplorerUrlIndex =
+      networkFields.blockExplorerUrls.length > 0
+        ? networkFields.defaultBlockExplorerUrlIndex === undefined ||
+          networkFields.blockExplorerUrls[
+            networkFields.defaultBlockExplorerUrlIndex
+          ] === undefined
+        : networkFields.defaultBlockExplorerUrlIndex !== undefined;
+
+    if (isInvalidDefaultBlockExplorerUrlIndex) {
+      throw new Error(
+        `${errorMessagePrefix}: \`defaultBlockExplorerUrlIndex\` must refer to an entry in \`blockExplorerUrls\``,
+      );
+    }
+
+    if (networkFields.rpcEndpoints.length === 0) {
+      throw new Error(
+        `${errorMessagePrefix}: \`rpcEndpoints\` must be a non-empty array`,
+      );
+    }
+    for (const rpcEndpointFields of networkFields.rpcEndpoints) {
+      if (!isValidUrl(rpcEndpointFields.url)) {
+        throw new Error(
+          `${errorMessagePrefix}: An entry in \`rpcEndpoints\` has invalid URL '${rpcEndpointFields.url}'`,
+        );
+      }
+      const networkClientId =
+        'networkClientId' in rpcEndpointFields
+          ? rpcEndpointFields.networkClientId
+          : undefined;
+
+      if (
+        rpcEndpointFields.type === RpcEndpointType.Custom &&
+        networkClientId !== undefined &&
+        isInfuraNetworkType(networkClientId)
+      ) {
+        throw new Error(
+          `${errorMessagePrefix}: Custom RPC endpoint '${rpcEndpointFields.url}' has invalid network client ID '${networkClientId}'`,
+        );
+      }
+
+      if (
+        mode === 'update' &&
+        networkClientId !== undefined &&
+        rpcEndpointFields.type === RpcEndpointType.Custom &&
+        !Object.values(autoManagedNetworkClientRegistry).some(
+          (networkClientsById) => networkClientId in networkClientsById,
+        )
+      ) {
+        throw new Error(
+          `${errorMessagePrefix}: RPC endpoint '${rpcEndpointFields.url}' refers to network client '${networkClientId}' that does not exist`,
+        );
+      }
+
+      if (
+        networkFields.rpcEndpoints.some(
+          (otherRpcEndpointFields) =>
+            otherRpcEndpointFields !== rpcEndpointFields &&
+            URI.equal(otherRpcEndpointFields.url, rpcEndpointFields.url),
+        )
+      ) {
+        throw new Error(
+          `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique URL`,
+        );
+      }
+
+      const networkConfigurationsForOtherChains = Object.values(
+        this.state.networkConfigurationsByChainId,
+      ).filter((networkConfiguration) =>
+        existingNetworkConfiguration
+          ? networkConfiguration.chainId !==
+            existingNetworkConfiguration.chainId
+          : true,
+      );
+      for (const networkConfiguration of networkConfigurationsForOtherChains) {
+        const rpcEndpoint = networkConfiguration.rpcEndpoints.find(
+          (existingRpcEndpoint) =>
+            URI.equal(rpcEndpointFields.url, existingRpcEndpoint.url),
+        );
+        if (rpcEndpoint) {
+          if (mode === 'update') {
+            throw new Error(
+              `Could not update network to point to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,
+            );
+          } else {
+            throw new Error(
+              `Could not add network that points to same RPC endpoint as existing network for chain ${networkConfiguration.chainId} ('${networkConfiguration.name}')`,
+            );
+          }
+        }
+      }
+    }
+
+    if (
+      [...new Set(networkFields.rpcEndpoints)].length <
+      networkFields.rpcEndpoints.length
+    ) {
+      throw new Error(
+        `${errorMessagePrefix}: Each entry in rpcEndpoints must be unique`,
+      );
+    }
+
+    const networkClientIds = networkFields.rpcEndpoints
+      .map((rpcEndpoint) =>
+        'networkClientId' in rpcEndpoint
+          ? rpcEndpoint.networkClientId
+          : undefined,
+      )
+      .filter(
+        (networkClientId): networkClientId is NetworkClientId =>
+          networkClientId !== undefined,
+      );
+    if ([...new Set(networkClientIds)].length < networkClientIds.length) {
+      throw new Error(
+        `${errorMessagePrefix}: Each entry in rpcEndpoints must have a unique networkClientId`,
+      );
+    }
+
+    const infuraRpcEndpoints = networkFields.rpcEndpoints.filter(
+      (rpcEndpointFields): rpcEndpointFields is InfuraRpcEndpoint =>
+        rpcEndpointFields.type === RpcEndpointType.Infura,
+    );
+    if (infuraRpcEndpoints.length > 1) {
+      throw new Error(
+        `${errorMessagePrefix}: There cannot be more than one Infura RPC endpoint`,
+      );
+    }
+
+    const soleInfuraRpcEndpoint = infuraRpcEndpoints[0];
+    if (soleInfuraRpcEndpoint) {
+      const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(
+        soleInfuraRpcEndpoint.url,
+      );
+      const infuraNetworkNickname = NetworkNickname[infuraNetworkName];
+      const infuraChainId = ChainId[infuraNetworkName];
+      if (networkFields.chainId !== infuraChainId) {
+        throw new Error(
+          mode === 'add'
+            ? `Could not add network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`
+            : `Could not update network with chain ID ${networkFields.chainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,
+        );
+      }
+    }
+
+    if (
+      networkFields.rpcEndpoints[networkFields.defaultRpcEndpointIndex] ===
+      undefined
+    ) {
+      throw new Error(
+        `${errorMessagePrefix}: \`defaultRpcEndpointIndex\` must refer to an entry in \`rpcEndpoints\``,
+      );
+    }
+  }
+
+  /**
+   * Constructs a network configuration that will be persisted to state when
+   * adding or updating a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkFields - The fields used to add or update a network.
+   * @param args.networkClientOperations - Operations which were calculated for
+   * updating the network client registry but which also map back to RPC
+   * endpoints (and so can be used to save those RPC endpoints).
+   * @returns The network configuration to persist.
+   */
+  #determineNetworkConfigurationToPersist({
+    networkFields,
+    networkClientOperations,
+  }: {
+    networkFields: AddNetworkFields | UpdateNetworkFields;
+    networkClientOperations: NetworkClientOperation[];
+  }): NetworkConfiguration {
+    const rpcEndpointsToPersist = networkClientOperations
+      .filter(
+        (
+          networkClientOperation,
+        ): networkClientOperation is
+          | AddNetworkClientOperation
+          | NoopNetworkClientOperation => {
+          return (
+            networkClientOperation.type === 'add' ||
+            networkClientOperation.type === 'noop'
+          );
+        },
+      )
+      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)
+      .concat(
+        networkClientOperations
+          .filter(
+            (
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation => {
+              return networkClientOperation.type === 'replace';
+            },
+          )
+          .map(
+            (networkClientOperation) => networkClientOperation.newRpcEndpoint,
+          ),
+      );
+
+    return { ...networkFields, rpcEndpoints: rpcEndpointsToPersist };
+  }
+
+  /**
+   * Creates and registers network clients using the given operations calculated
+   * as a part of adding or updating a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkFields - The fields used to add or update a network.
+   * @param args.networkClientOperations - Dictate which network clients need to
+   * be created.
+   * @param args.autoManagedNetworkClientRegistry - The network client registry
+   * to update.
+   */
+  #registerNetworkClientsAsNeeded({
+    networkFields,
+    networkClientOperations,
+    autoManagedNetworkClientRegistry,
+  }: {
+    networkFields: AddNetworkFields | UpdateNetworkFields;
+    networkClientOperations: NetworkClientOperation[];
+    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+  }): void {
+    const addedRpcEndpoints = networkClientOperations
+      .filter(
+        (
+          networkClientOperation,
+        ): networkClientOperation is AddNetworkClientOperation => {
+          return networkClientOperation.type === 'add';
+        },
+      )
+      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)
+      .concat(
+        networkClientOperations
+          .filter(
+            (
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation => {
+              return networkClientOperation.type === 'replace';
+            },
+          )
+          .map(
+            (networkClientOperation) => networkClientOperation.newRpcEndpoint,
+          ),
+      );
+
+    for (const addedRpcEndpoint of addedRpcEndpoints) {
+      if (addedRpcEndpoint.type === RpcEndpointType.Infura) {
+        autoManagedNetworkClientRegistry[NetworkClientType.Infura][
+          addedRpcEndpoint.networkClientId
+        ] = createAutoManagedNetworkClient({
+          networkClientId: addedRpcEndpoint.networkClientId,
+          networkClientConfiguration: {
+            type: NetworkClientType.Infura,
+            chainId: networkFields.chainId,
+            network: addedRpcEndpoint.networkClientId,
+            failoverRpcUrls: addedRpcEndpoint.failoverUrls,
+            infuraProjectId: this.#infuraProjectId,
+            ticker: networkFields.nativeCurrency,
+          },
+          getRpcServiceOptions: this.#getRpcServiceOptions,
+          getBlockTrackerOptions: this.#getBlockTrackerOptions,
+          messenger: this.messenger,
+          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+          logger: this.#log,
+        });
+      } else {
+        autoManagedNetworkClientRegistry[NetworkClientType.Custom][
+          addedRpcEndpoint.networkClientId
+        ] = createAutoManagedNetworkClient({
+          networkClientId: addedRpcEndpoint.networkClientId,
+          networkClientConfiguration: {
+            type: NetworkClientType.Custom,
+            chainId: networkFields.chainId,
+            failoverRpcUrls: addedRpcEndpoint.failoverUrls,
+            rpcUrl: addedRpcEndpoint.url,
+            ticker: networkFields.nativeCurrency,
+          },
+          getRpcServiceOptions: this.#getRpcServiceOptions,
+          getBlockTrackerOptions: this.#getBlockTrackerOptions,
+          messenger: this.messenger,
+          isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+          logger: this.#log,
+        });
+      }
+    }
+  }
+
+  /**
+   * Destroys and removes network clients using the given operations calculated
+   * as a part of updating or removing a network.
+   *
+   * @param args - The arguments to this function.
+   * @param args.networkClientOperations - Dictate which network clients to
+   * remove.
+   * @param args.autoManagedNetworkClientRegistry - The network client registry
+   * to update.
+   */
+  #unregisterNetworkClientsAsNeeded({
+    networkClientOperations,
+    autoManagedNetworkClientRegistry,
+  }: {
+    networkClientOperations: NetworkClientOperation[];
+    autoManagedNetworkClientRegistry: AutoManagedNetworkClientRegistry;
+  }): void {
+    const removedRpcEndpoints = networkClientOperations
+      .filter(
+        (
+          networkClientOperation,
+        ): networkClientOperation is RemoveNetworkClientOperation => {
+          return networkClientOperation.type === 'remove';
+        },
+      )
+      .map((networkClientOperation) => networkClientOperation.rpcEndpoint)
+      .concat(
+        networkClientOperations
+          .filter(
+            (
+              networkClientOperation,
+            ): networkClientOperation is ReplaceNetworkClientOperation => {
+              return networkClientOperation.type === 'replace';
+            },
+          )
+          .map(
+            (networkClientOperation) => networkClientOperation.oldRpcEndpoint,
+          ),
+      );
+
+    for (const rpcEndpoint of removedRpcEndpoints) {
+      const networkClient = this.getNetworkClientById(
+        rpcEndpoint.networkClientId,
+      );
+      networkClient.destroy();
+      delete autoManagedNetworkClientRegistry[networkClient.configuration.type][
+        rpcEndpoint.networkClientId
+      ];
+    }
+  }
+
+  /**
+   * Updates `networkConfigurationsByChainId` in state depending on whether a
+   * network is being added, updated, or removed.
+   *
+   * - The existing network configuration will be removed when a network is
+   * being filed under a different chain or removed.
+   * - A network configuration will be stored when a network is being added or
+   * when a network is being updated.
+   *
+   * @param args - The arguments to this function.
+   */
+  #updateNetworkConfigurations(
+    args: { state: Draft<NetworkState> } & (
+      | {
+          mode: 'add';
+          networkFields: AddNetworkFields;
+          networkConfigurationToPersist: NetworkConfiguration;
+        }
+      | {
+          mode: 'update';
+          networkFields: UpdateNetworkFields;
+          networkConfigurationToPersist: NetworkConfiguration;
+          existingNetworkConfiguration: NetworkConfiguration;
+        }
+      | {
+          mode: 'remove';
+          existingNetworkConfiguration: NetworkConfiguration;
+        }
+    ),
+  ): void {
+    const { state, mode } = args;
+
+    if (
+      mode === 'remove' ||
+      (mode === 'update' &&
+        args.networkFields.chainId !==
+          args.existingNetworkConfiguration.chainId)
+    ) {
+      delete state.networkConfigurationsByChainId[
+        args.existingNetworkConfiguration.chainId
+      ];
+    }
+
+    if (mode === 'add' || mode === 'update') {
+      if (
+        !deepEqual(
+          state.networkConfigurationsByChainId[args.networkFields.chainId],
+          args.networkConfigurationToPersist,
+        )
+      ) {
+        args.networkConfigurationToPersist.lastUpdatedAt = Date.now();
+      }
+      state.networkConfigurationsByChainId[args.networkFields.chainId] =
+        args.networkConfigurationToPersist;
+    }
+
+    this.#networkConfigurationsByNetworkClientId =
+      buildNetworkConfigurationsByNetworkClientId(
+        cloneDeep(state.networkConfigurationsByChainId),
+      );
+  }
+
+  /**
+   * Before accessing or switching the network, the registry of network clients
+   * needs to be populated. Otherwise, `#applyNetworkSelection` and
+   * `getNetworkClientRegistry` will throw an error. This method checks to see if the
+   * population step has happened yet, and if not, makes it happen.
+   *
+   * @returns The populated network client registry.
+   */
+  #ensureAutoManagedNetworkClientRegistryPopulated(): AutoManagedNetworkClientRegistry {
+    return (this.#autoManagedNetworkClientRegistry ??=
+      this.#createAutoManagedNetworkClientRegistry());
+  }
+
+  /**
+   * Constructs the registry of network clients based on the set of default
+   * and custom networks in state.
+   *
+   * @returns The network clients keyed by ID.
+   */
+  #createAutoManagedNetworkClientRegistry(): AutoManagedNetworkClientRegistry {
+    const chainIds = knownKeysOf(this.state.networkConfigurationsByChainId);
+    const networkClientsWithIds = chainIds.flatMap((chainId) => {
+      const networkConfiguration =
+        this.state.networkConfigurationsByChainId[chainId];
+      return networkConfiguration.rpcEndpoints.map((rpcEndpoint) => {
+        if (rpcEndpoint.type === RpcEndpointType.Infura) {
+          const infuraNetworkName = deriveInfuraNetworkNameFromRpcEndpointUrl(
+            rpcEndpoint.url,
+          );
+          return [
+            rpcEndpoint.networkClientId,
+            createAutoManagedNetworkClient({
+              networkClientId: rpcEndpoint.networkClientId,
+              networkClientConfiguration: {
+                type: NetworkClientType.Infura,
+                network: infuraNetworkName,
+                failoverRpcUrls: rpcEndpoint.failoverUrls,
+                infuraProjectId: this.#infuraProjectId,
+                chainId: networkConfiguration.chainId,
+                ticker: networkConfiguration.nativeCurrency,
+              },
+              getRpcServiceOptions: this.#getRpcServiceOptions,
+              getBlockTrackerOptions: this.#getBlockTrackerOptions,
+              messenger: this.messenger,
+              isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+              logger: this.#log,
+            }),
+          ] as const;
+        }
+        return [
+          rpcEndpoint.networkClientId,
+          createAutoManagedNetworkClient({
+            networkClientId: rpcEndpoint.networkClientId,
+            networkClientConfiguration: {
+              type: NetworkClientType.Custom,
+              chainId: networkConfiguration.chainId,
+              failoverRpcUrls: rpcEndpoint.failoverUrls,
+              rpcUrl: rpcEndpoint.url,
+              ticker: networkConfiguration.nativeCurrency,
+            },
+            getRpcServiceOptions: this.#getRpcServiceOptions,
+            getBlockTrackerOptions: this.#getBlockTrackerOptions,
+            messenger: this.messenger,
+            isRpcFailoverEnabled: this.#isRpcFailoverEnabled,
+            logger: this.#log,
+          }),
+        ] as const;
+      });
+    });
+
+    return networkClientsWithIds.reduce(
+      (
+        obj: {
+          [NetworkClientType.Custom]: Partial<AutoManagedCustomNetworkClientRegistry>;
+          [NetworkClientType.Infura]: Partial<AutoManagedBuiltInNetworkClientRegistry>;
+        },
+        [networkClientId, networkClient],
+      ) => {
+        return {
+          ...obj,
+          [networkClient.configuration.type]: {
+            ...obj[networkClient.configuration.type],
+            [networkClientId]: networkClient,
+          },
+        };
+      },
+      {
+        [NetworkClientType.Custom]: {},
+        [NetworkClientType.Infura]: {},
+      },
+    ) as AutoManagedNetworkClientRegistry;
+  }
+
+  /**
+   * Updates the global provider and block tracker proxies (accessible via
+   * {@link getSelectedNetworkClient}) to point to the same ones within the
+   * given network client, thereby magically switching any consumers using these
+   * proxies to use the new network.
+   *
+   * Also refreshes the EthQuery instance accessible via the `getEthQuery`
+   * action to wrap the provider from the new network client. Note that this is
+   * not a proxy, so consumers will need to call `getEthQuery` again after the
+   * network switch.
+   *
+   * @param networkClientId - The ID of a network client that requests will be
+   * routed through (either the name of an Infura network or the ID of a custom
+   * network configuration).
+   * @param options - Options for this method.
+   * @param options.updateState - Allows for updating state.
+   * @throws if no network client could be found matching the given ID.
+   */
+  #applyNetworkSelection(
+    networkClientId: string,
+    {
+      updateState,
+    }: {
+      updateState?: (state: Draft<NetworkState>) => void;
+    } = {},
+  ): void {
+    const autoManagedNetworkClientRegistry =
+      this.#ensureAutoManagedNetworkClientRegistryPopulated();
+
+    let autoManagedNetworkClient:
+      | AutoManagedNetworkClient<CustomNetworkClientConfiguration>
+      | AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;
+
+    if (isInfuraNetworkType(networkClientId)) {
+      const possibleAutoManagedNetworkClient =
+        autoManagedNetworkClientRegistry[NetworkClientType.Infura][
+          networkClientId
+        ];
+
+      // This is impossible to reach
+      /* istanbul ignore if */
+      if (!possibleAutoManagedNetworkClient) {
+        throw new Error(
+          `No Infura network client found with ID '${networkClientId}'`,
+        );
+      }
+
+      autoManagedNetworkClient = possibleAutoManagedNetworkClient;
+    } else {
+      const possibleAutoManagedNetworkClient =
+        autoManagedNetworkClientRegistry[NetworkClientType.Custom][
+          networkClientId
+        ];
+
+      if (!possibleAutoManagedNetworkClient) {
+        throw new Error(`No network client found with ID '${networkClientId}'`);
+      }
+
+      autoManagedNetworkClient = possibleAutoManagedNetworkClient;
+    }
+
+    this.#autoManagedNetworkClient = autoManagedNetworkClient;
+
+    this.update((state) => {
+      state.selectedNetworkClientId = networkClientId;
+      state.networksMetadata[networkClientId] ??= {
+        status: NetworkStatus.Unknown,
+        EIPS: {},
+      };
+
+      updateState?.(state);
+    });
+
+    if (this.#providerProxy) {
+      this.#providerProxy.setTarget(this.#autoManagedNetworkClient.provider);
+    } else {
+      this.#providerProxy = createSwappableProxy(
+        this.#autoManagedNetworkClient.provider,
+      );
+    }
+
+    if (this.#blockTrackerProxy) {
+      this.#blockTrackerProxy.setTarget(
+        this.#autoManagedNetworkClient.blockTracker,
+      );
+    } else {
+      this.#blockTrackerProxy = createEventEmitterProxy(
+        this.#autoManagedNetworkClient.blockTracker,
+        {
+          eventFilter: 'skipInternal',
+        },
+      );
+    }
+
+    this.#ethQuery = new EthQuery(this.#providerProxy);
+  }
+}
diff --git a/src/constants.ts b/src/constants.ts
new file mode 100644
index 0000000000000000000000000000000000000000..1708cc2ebf638cc976ac1f08e67b494177907a77
--- /dev/null
+++ b/src/constants.ts
@@ -0,0 +1,43 @@
+/**
+ * Represents the availability status of an RPC endpoint. (Regrettably, the
+ * name of this type is a misnomer.)
+ *
+ * The availability status is set both automatically (as requests are made) and
+ * manually (when `lookupNetwork` is called).
+ */
+export enum NetworkStatus {
+  /**
+   * Either the availability status of the RPC endpoint has not been determined,
+   * or request that `lookupNetwork` performed returned an unknown error.
+   */
+  Unknown = 'unknown',
+  /**
+   * The RPC endpoint is consistently returning successful (2xx) responses.
+   */
+  Available = 'available',
+  /**
+   * Either the last request to the RPC endpoint was either too slow, or the
+   * endpoint is consistently returning errors and the number of retries has
+   * been reached.
+   */
+  Degraded = 'degraded',
+  /**
+   * The RPC endpoint is consistently returning enough 5xx errors that requests
+   * have been paused.
+   */
+  Unavailable = 'unavailable',
+  /**
+   * The RPC endpoint is inaccessible for the user based on their location. This
+   * status only applies to Infura networks.
+   */
+  Blocked = 'blocked',
+}
+
+export const INFURA_BLOCKED_KEY = 'countryBlocked';
+
+/**
+ * A set of deprecated network ChainId.
+ * The network controller will exclude those the networks begin as default network,
+ * without the need to remove the network from constant list of controller-utils.
+ */
+export const DEPRECATED_NETWORKS = new Set<string>(['0xe704', '0x5']);
diff --git a/src/create-auto-managed-network-client.test.ts b/src/create-auto-managed-network-client.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..07927cbbceebf20076dde45220029a163e40c16f
--- /dev/null
+++ b/src/create-auto-managed-network-client.test.ts
@@ -0,0 +1,687 @@
+import { BUILT_IN_NETWORKS, NetworkType } from '@metamask/controller-utils';
+import { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+
+import { createAutoManagedNetworkClient } from './create-auto-managed-network-client';
+import * as createNetworkClientModule from './create-network-client';
+import { RpcServiceOptions } from './rpc-service/rpc-service';
+import type {
+  CustomNetworkClientConfiguration,
+  InfuraNetworkClientConfiguration,
+} from './types';
+import { NetworkClientType } from './types';
+import { mockNetwork } from '../../../tests/mock-network';
+import { buildNetworkControllerMessenger } from '../tests/helpers';
+
+describe('createAutoManagedNetworkClient', () => {
+  const networkClientConfigurations: [
+    CustomNetworkClientConfiguration,
+    InfuraNetworkClientConfiguration,
+  ] = [
+    {
+      type: NetworkClientType.Custom,
+      failoverRpcUrls: [],
+      rpcUrl: 'https://test.chain',
+      chainId: '0x1337',
+      ticker: 'ETH',
+    },
+    {
+      type: NetworkClientType.Infura,
+      network: NetworkType.mainnet,
+      chainId: BUILT_IN_NETWORKS[NetworkType.mainnet].chainId,
+      infuraProjectId: 'some-infura-project-id',
+      ticker: BUILT_IN_NETWORKS[NetworkType.mainnet].ticker,
+      failoverRpcUrls: [],
+    },
+  ];
+  for (const networkClientConfiguration of networkClientConfigurations) {
+    describe(`given configuration for a ${networkClientConfiguration.type} network client`, () => {
+      it('allows the network client configuration to be accessed', () => {
+        const { configuration } = createAutoManagedNetworkClient({
+          networkClientId: 'some-network-client-id',
+          networkClientConfiguration,
+          getRpcServiceOptions: () => ({
+            fetch,
+            btoa,
+            isOffline: (): boolean => false,
+          }),
+          messenger: buildNetworkControllerMessenger(),
+          isRpcFailoverEnabled: false,
+        });
+
+        expect(configuration).toStrictEqual(networkClientConfiguration);
+      });
+
+      it('does not make any network requests initially', () => {
+        // If unexpected requests occurred, then Nock would throw
+        expect(() => {
+          createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions: () => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+            messenger: buildNetworkControllerMessenger(),
+            isRpcFailoverEnabled: false,
+          });
+        }).not.toThrow();
+      });
+
+      it('returns a provider proxy that has the same interface as a provider', () => {
+        const { provider } = createAutoManagedNetworkClient({
+          networkClientId: 'some-network-client-id',
+          networkClientConfiguration,
+          getRpcServiceOptions: () => ({
+            fetch,
+            btoa,
+            isOffline: (): boolean => false,
+          }),
+          messenger: buildNetworkControllerMessenger(),
+          isRpcFailoverEnabled: false,
+        });
+
+        // This also tests the `has` trap in the proxy
+        expect('send' in provider).toBe(true);
+        expect('sendAsync' in provider).toBe(true);
+        expect('request' in provider).toBe(true);
+      });
+
+      describe('when accessing the provider proxy', () => {
+        it('forwards requests to the network', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'test_method',
+                  params: [],
+                },
+                response: {
+                  result: 'test response',
+                },
+              },
+            ],
+          });
+
+          const { provider } = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions: () => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+            messenger: buildNetworkControllerMessenger(),
+            isRpcFailoverEnabled: false,
+          });
+
+          const result = await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+          expect(result).toBe('test response');
+        });
+
+        it('creates the network client only once, even when the provider proxy is used to make requests multiple times', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'test_method',
+                  params: [],
+                },
+                response: {
+                  result: 'test response',
+                },
+                discardAfterMatching: false,
+              },
+            ],
+          });
+          const createNetworkClientMock = jest.spyOn(
+            createNetworkClientModule,
+            'createNetworkClient',
+          );
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 5000,
+          });
+          const messenger = buildNetworkControllerMessenger();
+
+          const { provider } = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+
+          await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+          await provider.request({
+            id: 2,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+          expect(createNetworkClientMock).toHaveBeenCalledTimes(1);
+          expect(createNetworkClientMock).toHaveBeenCalledWith({
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+        });
+
+        it('allows for enabling the RPC failover behavior, even after having already accessed the provider', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'test_method',
+                  params: [],
+                },
+                response: {
+                  result: 'test response',
+                },
+                discardAfterMatching: false,
+              },
+            ],
+          });
+          const createNetworkClientMock = jest.spyOn(
+            createNetworkClientModule,
+            'createNetworkClient',
+          );
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 5000,
+          });
+          const messenger = buildNetworkControllerMessenger();
+
+          const autoManagedNetworkClient = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: false,
+          });
+          const { provider } = autoManagedNetworkClient;
+
+          await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+          autoManagedNetworkClient.enableRpcFailover();
+          await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(1, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: false,
+          });
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(2, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+        });
+
+        it('allows for disabling the RPC failover behavior, even after having accessed the provider', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'test_method',
+                  params: [],
+                },
+                response: {
+                  result: 'test response',
+                },
+                discardAfterMatching: false,
+              },
+            ],
+          });
+          const createNetworkClientMock = jest.spyOn(
+            createNetworkClientModule,
+            'createNetworkClient',
+          );
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 5000,
+          });
+          const messenger = buildNetworkControllerMessenger();
+
+          const autoManagedNetworkClient = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+          const { provider } = autoManagedNetworkClient;
+
+          await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+          autoManagedNetworkClient.disableRpcFailover();
+          await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'test_method',
+            params: [],
+          });
+
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(1, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(2, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: false,
+          });
+        });
+      });
+
+      it('returns a block tracker proxy that has the same interface as a block tracker', () => {
+        const { blockTracker } = createAutoManagedNetworkClient({
+          networkClientId: 'some-network-client-id',
+          networkClientConfiguration,
+          getRpcServiceOptions: () => ({
+            fetch,
+            btoa,
+            isOffline: (): boolean => false,
+          }),
+          messenger: buildNetworkControllerMessenger(),
+          isRpcFailoverEnabled: false,
+        });
+
+        // This also tests the `has` trap in the proxy
+        expect('addListener' in blockTracker).toBe(true);
+        expect('on' in blockTracker).toBe(true);
+        expect('once' in blockTracker).toBe(true);
+        expect('removeListener' in blockTracker).toBe(true);
+        expect('off' in blockTracker).toBe(true);
+        expect('removeAllListeners' in blockTracker).toBe(true);
+        expect('setMaxListeners' in blockTracker).toBe(true);
+        expect('getMaxListeners' in blockTracker).toBe(true);
+        expect('listeners' in blockTracker).toBe(true);
+        expect('rawListeners' in blockTracker).toBe(true);
+        expect('emit' in blockTracker).toBe(true);
+        expect('listenerCount' in blockTracker).toBe(true);
+        expect('prependListener' in blockTracker).toBe(true);
+        expect('prependOnceListener' in blockTracker).toBe(true);
+        expect('eventNames' in blockTracker).toBe(true);
+        expect('destroy' in blockTracker).toBe(true);
+        expect('isRunning' in blockTracker).toBe(true);
+        expect('getCurrentBlock' in blockTracker).toBe(true);
+        expect('getLatestBlock' in blockTracker).toBe(true);
+        expect('checkForLatestBlock' in blockTracker).toBe(true);
+      });
+
+      describe('when accessing the block tracker proxy', () => {
+        it('exposes events to be listened to', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x1',
+                },
+              },
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x2',
+                },
+              },
+            ],
+          });
+
+          const { blockTracker } = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions: () => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+            messenger: buildNetworkControllerMessenger(),
+            isRpcFailoverEnabled: false,
+          });
+
+          const blockNumberViaLatest = await new Promise((resolve) => {
+            blockTracker.once('latest', resolve);
+          });
+          expect(blockNumberViaLatest).toBe('0x1');
+          const blockNumberViaSync = await new Promise((resolve) => {
+            blockTracker.once('sync', resolve);
+          });
+          // False positive.
+          // eslint-disable-next-line n/no-sync
+          expect(blockNumberViaSync).toStrictEqual({
+            oldBlock: '0x1',
+            newBlock: '0x2',
+          });
+        });
+
+        it('creates the network client only once, even when the block tracker proxy is used multiple times', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x1',
+                },
+              },
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x2',
+                },
+              },
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x3',
+                },
+              },
+            ],
+          });
+          const createNetworkClientMock = jest.spyOn(
+            createNetworkClientModule,
+            'createNetworkClient',
+          );
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 5000,
+          });
+          const messenger = buildNetworkControllerMessenger();
+
+          const { blockTracker } = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+
+          await new Promise((resolve) => {
+            blockTracker.once('latest', resolve);
+          });
+          await new Promise((resolve) => {
+            blockTracker.once('sync', resolve);
+          });
+          await blockTracker.getLatestBlock();
+          await blockTracker.checkForLatestBlock();
+          expect(createNetworkClientMock).toHaveBeenCalledTimes(1);
+          expect(createNetworkClientMock).toHaveBeenCalledWith({
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+        });
+
+        it('allows for enabling the RPC failover behavior, even after having already accessed the provider', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x1',
+                },
+                discardAfterMatching: false,
+              },
+            ],
+          });
+          const createNetworkClientMock = jest.spyOn(
+            createNetworkClientModule,
+            'createNetworkClient',
+          );
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 5000,
+          });
+          const messenger = buildNetworkControllerMessenger();
+
+          const autoManagedNetworkClient = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: false,
+          });
+          const { blockTracker } = autoManagedNetworkClient;
+
+          await new Promise((resolve) => {
+            blockTracker.once('latest', resolve);
+          });
+          autoManagedNetworkClient.enableRpcFailover();
+          await new Promise((resolve) => {
+            blockTracker.once('latest', resolve);
+          });
+
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(1, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: false,
+          });
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(2, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+        });
+
+        it('allows for disabling the RPC failover behavior, even after having already accessed the provider', async () => {
+          mockNetwork({
+            networkClientConfiguration,
+            mocks: [
+              {
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                response: {
+                  result: '0x1',
+                },
+                discardAfterMatching: false,
+              },
+            ],
+          });
+          const createNetworkClientMock = jest.spyOn(
+            createNetworkClientModule,
+            'createNetworkClient',
+          );
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 5000,
+          });
+          const messenger = buildNetworkControllerMessenger();
+
+          const autoManagedNetworkClient = createAutoManagedNetworkClient({
+            networkClientId: 'some-network-client-id',
+            networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+          const { blockTracker } = autoManagedNetworkClient;
+
+          await new Promise((resolve) => {
+            blockTracker.once('latest', resolve);
+          });
+          autoManagedNetworkClient.disableRpcFailover();
+          await new Promise((resolve) => {
+            blockTracker.once('latest', resolve);
+          });
+
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(1, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: true,
+          });
+          expect(createNetworkClientMock).toHaveBeenNthCalledWith(2, {
+            id: 'some-network-client-id',
+            configuration: networkClientConfiguration,
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            messenger,
+            isRpcFailoverEnabled: false,
+          });
+        });
+      });
+    });
+
+    it('destroys the block tracker when destroyed', () => {
+      mockNetwork({
+        networkClientConfiguration,
+        mocks: [
+          {
+            request: {
+              method: 'eth_blockNumber',
+              params: [],
+            },
+            response: {
+              result: '0x1',
+            },
+          },
+        ],
+      });
+      const { blockTracker, destroy } = createAutoManagedNetworkClient({
+        networkClientId: 'some-network-client-id',
+        networkClientConfiguration,
+        getRpcServiceOptions: () => ({
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+        }),
+        messenger: buildNetworkControllerMessenger(),
+        isRpcFailoverEnabled: false,
+      });
+      // Start the block tracker
+      blockTracker.on('latest', () => {
+        // do nothing
+      });
+
+      destroy();
+
+      expect(blockTracker.isRunning()).toBe(false);
+    });
+  }
+});
diff --git a/src/create-auto-managed-network-client.ts b/src/create-auto-managed-network-client.ts
new file mode 100644
index 0000000000000000000000000000000000000000..bb1fda83aeb777b2562dd1e033686435a7e9d1a7
--- /dev/null
+++ b/src/create-auto-managed-network-client.ts
@@ -0,0 +1,257 @@
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+import { Json } from '@metamask/utils';
+import type { Logger } from 'loglevel';
+
+import type { NetworkClient } from './create-network-client';
+import { createNetworkClient } from './create-network-client';
+import type {
+  NetworkClientId,
+  NetworkControllerMessenger,
+} from './NetworkController';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+import type {
+  BlockTracker,
+  NetworkClientConfiguration,
+  Provider,
+} from './types';
+
+/**
+ * The name of the method on both the provider and block tracker proxy which can
+ * be used to get the underlying provider or block tracker from the network
+ * client, when it is initialized.
+ */
+const REFLECTIVE_PROPERTY_NAME = '__target__';
+
+/**
+ * Represents a proxy object which wraps a target object. As a proxy, it allows
+ * for accessing and setting all of the properties that the target object
+ * supports, but also supports an extra propertyName (`__target__`) to access
+ * the target itself.
+ *
+ * @template Type - The type of the target object. It is assumed that this type
+ * will be constant even when the target is swapped.
+ */
+export type ProxyWithAccessibleTarget<TargetType> = TargetType & {
+  [REFLECTIVE_PROPERTY_NAME]: TargetType;
+};
+
+/**
+ * An object that provides the same interface as a network client but where the
+ * network client is not initialized until either the provider or block tracker
+ * is first accessed.
+ */
+export type AutoManagedNetworkClient<
+  Configuration extends NetworkClientConfiguration,
+> = {
+  configuration: Configuration;
+  provider: ProxyWithAccessibleTarget<Provider>;
+  blockTracker: ProxyWithAccessibleTarget<BlockTracker>;
+  destroy: () => void;
+  enableRpcFailover: () => void;
+  disableRpcFailover: () => void;
+};
+
+/**
+ * By default, the provider and block provider proxies will point to nothing.
+ * This is impossible when using the Proxy API, as the target object has to be
+ * something, so this object represents that "something".
+ */
+const UNINITIALIZED_TARGET = { __UNINITIALIZED__: true };
+
+/**
+ * This function creates two proxies, one that wraps a provider and another that
+ * wraps a block tracker. These proxies are unique in that both will be "empty"
+ * at first; that is, neither will point to a functional provider or block
+ * tracker. Instead, as soon as a method or event is accessed on either object
+ * that requires a network request to function, a network client is created on
+ * the fly and the method or event in question is then forwarded to whichever
+ * part of the network client is serving as the receiver. The network client is
+ * then cached for subsequent usages.
+ *
+ * @param args - The arguments.
+ * @param args.networkClientId - The ID that will be assigned to the new network
+ * client in the registry.
+ * @param args.networkClientConfiguration - The configuration object that will be
+ * used to instantiate the network client when it is needed.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.getBlockTrackerOptions - Factory for constructing block tracker
+ * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The auto-managed network client.
+ */
+export function createAutoManagedNetworkClient<
+  Configuration extends NetworkClientConfiguration,
+>({
+  networkClientId,
+  networkClientConfiguration,
+  getRpcServiceOptions,
+  getBlockTrackerOptions = (): Omit<
+    PollingBlockTrackerOptions,
+    'provider'
+  > => ({}),
+  messenger,
+  isRpcFailoverEnabled: givenIsRpcFailoverEnabled,
+  logger,
+}: {
+  networkClientId: NetworkClientId;
+  networkClientConfiguration: Configuration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;
+  getBlockTrackerOptions?: (
+    rpcEndpointUrl: string,
+  ) => Omit<PollingBlockTrackerOptions, 'provider'>;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): AutoManagedNetworkClient<Configuration> {
+  let isRpcFailoverEnabled = givenIsRpcFailoverEnabled;
+  let networkClient: NetworkClient | undefined;
+
+  const ensureNetworkClientCreated = (): NetworkClient => {
+    networkClient ??= createNetworkClient({
+      id: networkClientId,
+      configuration: networkClientConfiguration,
+      getRpcServiceOptions,
+      getBlockTrackerOptions,
+      messenger,
+      isRpcFailoverEnabled,
+      logger,
+    });
+
+    if (networkClient === undefined) {
+      throw new Error(
+        "It looks like `createNetworkClient` didn't return anything. Perhaps it's being mocked?",
+      );
+    }
+
+    return networkClient;
+  };
+
+  const providerProxy = new Proxy(UNINITIALIZED_TARGET, {
+    get(
+      _target: unknown,
+      propertyName: PropertyKey,
+      receiver: unknown,
+    ):
+      | Provider
+      | ((this: unknown, ...args: unknown[]) => Promise<Json> | undefined)
+      | undefined {
+      if (propertyName === REFLECTIVE_PROPERTY_NAME) {
+        return networkClient?.provider;
+      }
+
+      const { provider } = ensureNetworkClientCreated();
+
+      if (propertyName in provider) {
+        // Typecast: We know that `[propertyName]` is a propertyName on
+        // `provider`.
+        const value = provider[propertyName as keyof typeof provider];
+        if (typeof value === 'function') {
+          // Ensure that the method on the provider is called with `this` as
+          // the target, *not* the proxy (which happens by default) â€”
+          // this allows private properties to be accessed
+          return function (this: unknown, ...args: unknown[]): Promise<Json> {
+            // @ts-expect-error We don't care that `this` may not be compatible
+            // with the signature of the method being called, as technically
+            // it can be anything.
+            return value.apply(this === receiver ? provider : this, args);
+          };
+        }
+        return value;
+      }
+
+      return undefined;
+    },
+
+    // TODO: Replace `any` with type
+    // eslint-disable-next-line @typescript-eslint/no-explicit-any
+    has(_target: any, propertyName: PropertyKey): boolean {
+      if (propertyName === REFLECTIVE_PROPERTY_NAME) {
+        return true;
+      }
+      const { provider } = ensureNetworkClientCreated();
+      return propertyName in provider;
+    },
+  });
+
+  const blockTrackerProxy: ProxyWithAccessibleTarget<BlockTracker> = new Proxy(
+    UNINITIALIZED_TARGET,
+    {
+      get(
+        _target: unknown,
+        propertyName: PropertyKey,
+        receiver: unknown,
+      ):
+        | BlockTracker
+        | ((this: unknown, ...args: unknown[]) => unknown)
+        | undefined {
+        if (propertyName === REFLECTIVE_PROPERTY_NAME) {
+          return networkClient?.blockTracker;
+        }
+
+        const { blockTracker } = ensureNetworkClientCreated();
+
+        if (propertyName in blockTracker) {
+          // Typecast: We know that `[propertyName]` is a propertyName on
+          // `provider`.
+          const value = blockTracker[propertyName as keyof typeof blockTracker];
+          if (typeof value === 'function') {
+            // Ensure that the method on the provider is called with `this` as
+            // the target, *not* the proxy (which happens by default) â€”
+            // this allows private properties to be accessed
+            return function (this: unknown, ...args: unknown[]) {
+              // @ts-expect-error We don't care that `this` may not be
+              // compatible with the signature of the method being called, as
+              // technically it can be anything.
+              return value.apply(this === receiver ? blockTracker : this, args);
+            };
+          }
+          return value;
+        }
+
+        return undefined;
+      },
+
+      // TODO: Replace `any` with type
+      // eslint-disable-next-line @typescript-eslint/no-explicit-any
+      has(_target: any, propertyName: PropertyKey): boolean {
+        if (propertyName === REFLECTIVE_PROPERTY_NAME) {
+          return true;
+        }
+        const { blockTracker } = ensureNetworkClientCreated();
+        return propertyName in blockTracker;
+      },
+    },
+  );
+
+  const destroy = (): void => {
+    networkClient?.destroy();
+  };
+
+  const enableRpcFailover = (): void => {
+    isRpcFailoverEnabled = true;
+    destroy();
+    networkClient = undefined;
+  };
+
+  const disableRpcFailover = (): void => {
+    isRpcFailoverEnabled = false;
+    destroy();
+    networkClient = undefined;
+  };
+
+  return {
+    configuration: networkClientConfiguration,
+    provider: providerProxy,
+    blockTracker: blockTrackerProxy,
+    destroy,
+    enableRpcFailover,
+    disableRpcFailover,
+  };
+}
diff --git a/src/create-network-client-tests/ethereum-spec/block-hash-in-response.test.ts b/src/create-network-client-tests/ethereum-spec/block-hash-in-response.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..caab1b529b8f009c357aab5fecb6222fe6d6cd79
--- /dev/null
+++ b/src/create-network-client-tests/ethereum-spec/block-hash-in-response.test.ts
@@ -0,0 +1,21 @@
+import { testsForRpcMethodsThatCheckForBlockHashInResponse } from '../../../tests/network-client/block-hash-in-response';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods included in the Ethereum JSON-RPC spec - methods with block hashes in their result', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const methodsWithBlockHashInResponse = [
+        { name: 'eth_getTransactionByHash', numberOfParameters: 1 },
+        { name: 'eth_getTransactionReceipt', numberOfParameters: 1 },
+      ];
+      methodsWithBlockHashInResponse.forEach(({ name, numberOfParameters }) => {
+        describe(`${name}`, () => {
+          testsForRpcMethodsThatCheckForBlockHashInResponse(name, {
+            numberOfParameters,
+            providerType: networkClientType,
+          });
+        });
+      });
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ethereum-spec/block-param.test.ts b/src/create-network-client-tests/ethereum-spec/block-param.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..503397aec8a82fe59b8e5c35ba5d5088ebe30b1d
--- /dev/null
+++ b/src/create-network-client-tests/ethereum-spec/block-param.test.ts
@@ -0,0 +1,48 @@
+import { testsForRpcMethodSupportingBlockParam } from '../../../tests/network-client/block-param';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods included in the Ethereum JSON-RPC spec - methods that have a param to specify the block', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const supportingBlockParam = [
+        {
+          name: 'eth_call',
+          blockParamIndex: 1,
+          numberOfParameters: 2,
+        },
+        {
+          name: 'eth_getBalance',
+          blockParamIndex: 1,
+          numberOfParameters: 2,
+        },
+        {
+          name: 'eth_getBlockByNumber',
+          blockParamIndex: 0,
+          numberOfParameters: 2,
+        },
+        { name: 'eth_getCode', blockParamIndex: 1, numberOfParameters: 2 },
+        {
+          name: 'eth_getStorageAt',
+          blockParamIndex: 2,
+          numberOfParameters: 3,
+        },
+        {
+          name: 'eth_getTransactionCount',
+          blockParamIndex: 1,
+          numberOfParameters: 2,
+        },
+      ];
+      supportingBlockParam.forEach(
+        ({ name, blockParamIndex, numberOfParameters }) => {
+          describe(`method name: ${name}`, () => {
+            testsForRpcMethodSupportingBlockParam(name, {
+              providerType: networkClientType,
+              blockParamIndex,
+              numberOfParameters,
+            });
+          });
+        },
+      );
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ethereum-spec/no-block-param.test.ts b/src/create-network-client-tests/ethereum-spec/no-block-param.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..0ef4fb4b55a55c322817f97f96f49b4685013d69
--- /dev/null
+++ b/src/create-network-client-tests/ethereum-spec/no-block-param.test.ts
@@ -0,0 +1,48 @@
+import { testsForRpcMethodAssumingNoBlockParam } from '../../../tests/network-client/no-block-param';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods included in the Ethereum JSON-RPC spec - methods that assume there is no block param', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const assumingNoBlockParam = [
+        { name: 'eth_getFilterLogs', numberOfParameters: 1 },
+        { name: 'eth_blockNumber', numberOfParameters: 0 },
+        { name: 'eth_estimateGas', numberOfParameters: 2 },
+        { name: 'eth_gasPrice', numberOfParameters: 0 },
+        { name: 'eth_getBlockByHash', numberOfParameters: 2 },
+        {
+          name: 'eth_getBlockTransactionCountByHash',
+          numberOfParameters: 1,
+        },
+        {
+          name: 'eth_getTransactionByBlockHashAndIndex',
+          numberOfParameters: 2,
+        },
+        { name: 'eth_getUncleByBlockHashAndIndex', numberOfParameters: 2 },
+        { name: 'eth_getUncleCountByBlockHash', numberOfParameters: 1 },
+      ];
+      const blockParamIgnored = [
+        { name: 'eth_getUncleCountByBlockNumber', numberOfParameters: 1 },
+        { name: 'eth_getUncleByBlockNumberAndIndex', numberOfParameters: 2 },
+        {
+          name: 'eth_getTransactionByBlockNumberAndIndex',
+          numberOfParameters: 2,
+        },
+        {
+          name: 'eth_getBlockTransactionCountByNumber',
+          numberOfParameters: 1,
+        },
+      ];
+      assumingNoBlockParam
+        .concat(blockParamIgnored)
+        .forEach(({ name, numberOfParameters }) =>
+          describe(`${name}`, () => {
+            testsForRpcMethodAssumingNoBlockParam(name, {
+              providerType: networkClientType,
+              numberOfParameters,
+            });
+          }),
+        );
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ethereum-spec/not-handled-by-middleware.test.ts b/src/create-network-client-tests/ethereum-spec/not-handled-by-middleware.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..f3b799f3f18c98e587b5e54b945263b7352e004b
--- /dev/null
+++ b/src/create-network-client-tests/ethereum-spec/not-handled-by-middleware.test.ts
@@ -0,0 +1,48 @@
+import { testsForRpcMethodNotHandledByMiddleware } from '../../../tests/network-client/not-handled-by-middleware';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods included in the Ethereum JSON-RPC spec - methods not handled by middleware', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const notHandledByMiddleware = [
+        { name: 'eth_newFilter', numberOfParameters: 1 },
+        { name: 'eth_getFilterChanges', numberOfParameters: 1 },
+        { name: 'eth_newBlockFilter', numberOfParameters: 0 },
+        { name: 'eth_newPendingTransactionFilter', numberOfParameters: 0 },
+        { name: 'eth_uninstallFilter', numberOfParameters: 1 },
+
+        { name: 'eth_sendRawTransaction', numberOfParameters: 1 },
+        { name: 'eth_sendTransaction', numberOfParameters: 1 },
+        { name: 'eth_createAccessList', numberOfParameters: 2 },
+        { name: 'eth_getLogs', numberOfParameters: 1 },
+        { name: 'eth_getProof', numberOfParameters: 3 },
+        { name: 'eth_getWork', numberOfParameters: 0 },
+        { name: 'eth_maxPriorityFeePerGas', numberOfParameters: 0 },
+        { name: 'eth_submitHashRate', numberOfParameters: 2 },
+        { name: 'eth_submitWork', numberOfParameters: 3 },
+        { name: 'eth_syncing', numberOfParameters: 0 },
+        { name: 'eth_feeHistory', numberOfParameters: 3 },
+        { name: 'debug_getRawHeader', numberOfParameters: 1 },
+        { name: 'debug_getRawBlock', numberOfParameters: 1 },
+        { name: 'debug_getRawTransaction', numberOfParameters: 1 },
+        { name: 'debug_getRawReceipts', numberOfParameters: 1 },
+        { name: 'debug_getBadBlocks', numberOfParameters: 0 },
+
+        { name: 'eth_accounts', numberOfParameters: 0 },
+        { name: 'eth_coinbase', numberOfParameters: 0 },
+        { name: 'eth_hashrate', numberOfParameters: 0 },
+        { name: 'eth_mining', numberOfParameters: 0 },
+
+        { name: 'eth_signTransaction', numberOfParameters: 1 },
+      ];
+      notHandledByMiddleware.forEach(({ name, numberOfParameters }) => {
+        describe(`${name}`, () => {
+          testsForRpcMethodNotHandledByMiddleware(name, {
+            providerType: networkClientType,
+            numberOfParameters,
+          });
+        });
+      });
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ethereum-spec/other-methods.test.ts b/src/create-network-client-tests/ethereum-spec/other-methods.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..fa412274e67556d856857e64919b29537186dfac
--- /dev/null
+++ b/src/create-network-client-tests/ethereum-spec/other-methods.test.ts
@@ -0,0 +1,92 @@
+import {
+  withMockedCommunications,
+  withNetworkClient,
+} from '../../../tests/network-client/helpers';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods included in the Ethereum JSON-RPC spec - other methods', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      describe('eth_getTransactionByHash', () => {
+        it("refreshes the block tracker's current block if it is less than the block number that comes back in the response", async () => {
+          const method = 'eth_getTransactionByHash';
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              const request = { method };
+
+              comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+              // This is our request.
+              comms.mockRpcCall({
+                request,
+                response: {
+                  result: {
+                    blockNumber: '0x200',
+                  },
+                },
+              });
+              comms.mockNextBlockTrackerRequest({ blockNumber: '0x300' });
+
+              await withNetworkClient(
+                { providerType: networkClientType },
+                async ({ makeRpcCall, blockTracker }) => {
+                  await makeRpcCall(request);
+                  expect(blockTracker.getCurrentBlock()).toBe('0x300');
+                },
+              );
+            },
+          );
+        });
+      });
+
+      describe('eth_getTransactionReceipt', () => {
+        it("refreshes the block tracker's current block if it is less than the block number that comes back in the response", async () => {
+          const method = 'eth_getTransactionReceipt';
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              const request = { method };
+
+              comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+              // This is our request.
+              comms.mockRpcCall({
+                request,
+                response: {
+                  result: {
+                    blockNumber: '0x200',
+                  },
+                },
+              });
+              comms.mockNextBlockTrackerRequest({ blockNumber: '0x300' });
+
+              await withNetworkClient(
+                { providerType: networkClientType },
+                async ({ makeRpcCall, blockTracker }) => {
+                  await makeRpcCall(request);
+                  expect(blockTracker.getCurrentBlock()).toBe('0x300');
+                },
+              );
+            },
+          );
+        });
+      });
+
+      if (networkClientType === NetworkClientType.Custom) {
+        describe('eth_chainId', () => {
+          it('does not hit the RPC endpoint, instead returning the configured chain id', async () => {
+            const chainId = await withNetworkClient(
+              { providerType: networkClientType, customChainId: '0x1' },
+              ({ makeRpcCall }) => {
+                return makeRpcCall({ method: 'eth_chainId' });
+              },
+            );
+
+            expect(chainId).toBe('0x1');
+          });
+        });
+      }
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ex-ethereum-spec/no-block-param.test.ts b/src/create-network-client-tests/ex-ethereum-spec/no-block-param.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..0819318602e0e8ca473d3969c953470d094c8cc1
--- /dev/null
+++ b/src/create-network-client-tests/ex-ethereum-spec/no-block-param.test.ts
@@ -0,0 +1,21 @@
+import { testsForRpcMethodAssumingNoBlockParam } from '../../../tests/network-client/no-block-param';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods not included in the Ethereum JSON-RPC spec - methods that assume there is no block param', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const assumingNoBlockParam = [
+        { name: 'web3_clientVersion', numberOfParameters: 0 },
+        { name: 'eth_protocolVersion', numberOfParameters: 0 },
+      ];
+      assumingNoBlockParam.forEach(({ name, numberOfParameters }) =>
+        describe(`${name}`, () => {
+          testsForRpcMethodAssumingNoBlockParam(name, {
+            providerType: networkClientType,
+            numberOfParameters,
+          });
+        }),
+      );
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ex-ethereum-spec/not-handled-by-middleware.test.ts b/src/create-network-client-tests/ex-ethereum-spec/not-handled-by-middleware.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..42fee0efd375203d6c0f5fad737e80cd759e8b22
--- /dev/null
+++ b/src/create-network-client-tests/ex-ethereum-spec/not-handled-by-middleware.test.ts
@@ -0,0 +1,25 @@
+import { testsForRpcMethodNotHandledByMiddleware } from '../../../tests/network-client/not-handled-by-middleware';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods not included in the Ethereum JSON-RPC spec - methods not handled by middleware', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const notHandledByMiddleware = [
+        { name: 'net_listening', numberOfParameters: 0 },
+        { name: 'eth_subscribe', numberOfParameters: 1 },
+        { name: 'eth_unsubscribe', numberOfParameters: 1 },
+        { name: 'custom_rpc_method', numberOfParameters: 1 },
+        { name: 'net_peerCount', numberOfParameters: 0 },
+        { name: 'parity_nextNonce', numberOfParameters: 1 },
+      ];
+      notHandledByMiddleware.forEach(({ name, numberOfParameters }) => {
+        describe(`${name}`, () => {
+          testsForRpcMethodNotHandledByMiddleware(name, {
+            providerType: networkClientType,
+            numberOfParameters,
+          });
+        });
+      });
+    });
+  }
+});
diff --git a/src/create-network-client-tests/ex-ethereum-spec/other-methods.test.ts b/src/create-network-client-tests/ex-ethereum-spec/other-methods.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..50c7363ffb43b4d2f6da3a853808daefffded30e
--- /dev/null
+++ b/src/create-network-client-tests/ex-ethereum-spec/other-methods.test.ts
@@ -0,0 +1,42 @@
+import { TESTNET } from '../../../tests/helpers';
+import {
+  withMockedCommunications,
+  withNetworkClient,
+} from '../../../tests/network-client/helpers';
+import { NetworkClientType } from '../../types';
+
+describe('createNetworkClient - methods not included in the Ethereum JSON-RPC spec - other methods', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      describe('net_version', () => {
+        const networkArgs = {
+          providerType: networkClientType,
+          infuraNetwork:
+            networkClientType === NetworkClientType.Infura
+              ? TESTNET.networkType
+              : undefined,
+        } as const;
+
+        it('hits the RPC endpoint', async () => {
+          await withMockedCommunications(networkArgs, async (comms) => {
+            comms.mockRpcCall({
+              request: { method: 'net_version' },
+              response: { result: '1' },
+            });
+
+            const networkId = await withNetworkClient(
+              networkArgs,
+              ({ makeRpcCall }) => {
+                return makeRpcCall({
+                  method: 'net_version',
+                });
+              },
+            );
+
+            expect(networkId).toBe('1');
+          });
+        });
+      });
+    });
+  }
+});
diff --git a/src/create-network-client-tests/rpc-endpoint-events.test.ts b/src/create-network-client-tests/rpc-endpoint-events.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..a4f9cfdbb65afc0781c0716e4f2dec4bc6400ffd
--- /dev/null
+++ b/src/create-network-client-tests/rpc-endpoint-events.test.ts
@@ -0,0 +1,1622 @@
+import { CONNECTIVITY_STATUSES } from '@metamask/connectivity-controller';
+import {
+  ConstantBackoff,
+  DEFAULT_DEGRADED_THRESHOLD,
+  HttpError,
+} from '@metamask/controller-utils';
+import { errorCodes } from '@metamask/rpc-errors';
+
+import { buildRootMessenger } from '../../tests/helpers';
+import {
+  withMockedCommunications,
+  withNetworkClient,
+} from '../../tests/network-client/helpers';
+import { DEFAULT_MAX_CONSECUTIVE_FAILURES } from '../rpc-service/rpc-service';
+import { NetworkClientType } from '../types';
+
+describe('createNetworkClient - RPC endpoint events', () => {
+  for (const networkClientType of Object.values(NetworkClientType)) {
+    describe(`${networkClientType}`, () => {
+      const blockNumber = '0x100';
+      const backoffDuration = 100;
+
+      describe('with RPC failover', () => {
+        it('publishes the NetworkController:rpcEndpointChainUnavailable event only when the max number of consecutive request failures is reached for all of the endpoints in a chain of endpoints', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedUnavailableError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  // The first time a block-cacheable request is made, the
+                  // latest block number is retrieved through the block
+                  // tracker first.
+                  primaryComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+                  failoverComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointChainUnavailableEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointChainUnavailable',
+                    rpcEndpointChainUnavailableEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      providerType: networkClientType,
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId }) => {
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries,
+                      // breaking the circuit; then hit the failover and exceed
+                      // the max of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the failover and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the failover and exceed the max number of retries,
+                      // breaking the circuit
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+
+                      expect(
+                        rpcEndpointChainUnavailableEventHandler,
+                      ).toHaveBeenCalledTimes(1);
+                      expect(
+                        rpcEndpointChainUnavailableEventHandler,
+                      ).toHaveBeenCalledWith({
+                        chainId,
+                        error: expectedUnavailableError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointUnavailable event each time the max number of consecutive request failures is reached for any of the endpoints in a chain of endpoints', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedUnavailableError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  // The first time a block-cacheable request is made, the
+                  // latest block number is retrieved through the block
+                  // tracker first.
+                  primaryComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+                  failoverComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointUnavailableEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointUnavailable',
+                    rpcEndpointUnavailableEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId, rpcUrl }) => {
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries,
+                      // breaking the circuit; then hit the failover and exceed
+                      // the max of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the failover and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the failover and exceed the max number of retries,
+                      // breaking the circuit
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+
+                      expect(
+                        rpcEndpointUnavailableEventHandler,
+                      ).toHaveBeenCalledTimes(2);
+                      expect(
+                        rpcEndpointUnavailableEventHandler,
+                      ).toHaveBeenCalledWith({
+                        chainId,
+                        endpointUrl: rpcUrl,
+                        error: expectedUnavailableError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                      expect(
+                        rpcEndpointUnavailableEventHandler,
+                      ).toHaveBeenCalledWith({
+                        chainId,
+                        endpointUrl: failoverEndpointUrl,
+                        error: expectedUnavailableError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('does not retry requests when user is offline', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async () => {
+                  // Mock only one failure - if retries were happening, we'd need more
+                  primaryComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: 1,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+
+                  const rootMessenger = buildRootMessenger({
+                    connectivityStatus: CONNECTIVITY_STATUSES.Offline,
+                  });
+
+                  const rpcEndpointRetriedEventHandler = jest.fn();
+                  rootMessenger.subscribe(
+                    'NetworkController:rpcEndpointRetried',
+                    rpcEndpointRetriedEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger: rootMessenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall }) => {
+                      // When offline, errors are not retried, so the request
+                      // should fail immediately without retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+
+                      // Verify that retry event was not published
+                      expect(
+                        rpcEndpointRetriedEventHandler,
+                      ).not.toHaveBeenCalled();
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('suppresses the NetworkController:rpcEndpointUnavailable event when user is offline', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  // The first time a block-cacheable request is made, the
+                  // latest block number is retrieved through the block
+                  // tracker first.
+                  primaryComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+                  failoverComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+
+                  const rootMessenger = buildRootMessenger({
+                    connectivityStatus: CONNECTIVITY_STATUSES.Offline,
+                  });
+
+                  const rpcEndpointUnavailableEventHandler = jest.fn();
+                  rootMessenger.subscribe(
+                    'NetworkController:rpcEndpointUnavailable',
+                    rpcEndpointUnavailableEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger: rootMessenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock }) => {
+                      rootMessenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // When offline, errors are not retried, so the circuit
+                      // won't break and onServiceBreak won't be called
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+
+                      // Event should be suppressed when offline because retries
+                      // are prevented, so onServiceBreak is never called
+                      expect(
+                        rpcEndpointUnavailableEventHandler,
+                      ).not.toHaveBeenCalled();
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('does not publish the NetworkController:rpcEndpointChainDegraded event again if the max number of retries is reached in making requests to a failover endpoint', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedDegradedError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointChainDegradedEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointChainDegraded',
+                    rpcEndpointChainDegradedEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId }) => {
+                      // The first time a block-cacheable request is made, the
+                      // latest block number is retrieved through the block
+                      // tracker first.
+                      primaryComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                        response: {
+                          httpStatus: 503,
+                        },
+                      });
+                      failoverComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        times: 5,
+                        response: {
+                          httpStatus: 503,
+                        },
+                      });
+
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries,
+                      // break the circuit; hit the failover and exceed the max
+                      // number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+
+                      expect(
+                        rpcEndpointChainDegradedEventHandler,
+                      ).toHaveBeenCalledTimes(1);
+                      expect(
+                        rpcEndpointChainDegradedEventHandler,
+                      ).toHaveBeenCalledWith({
+                        chainId,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('does not publish the NetworkController:rpcEndpointChainDegraded event again when the time to complete a request to a failover endpoint is too long', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedDegradedError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointChainDegradedEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointChainDegraded',
+                    rpcEndpointChainDegradedEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId }) => {
+                      // The first time a block-cacheable request is made, the
+                      // latest block number is retrieved through the block
+                      // tracker first.
+                      primaryComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                        response: {
+                          httpStatus: 503,
+                        },
+                      });
+                      failoverComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        response: () => {
+                          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                          return {
+                            result: '0x1',
+                          };
+                        },
+                      });
+                      failoverComms.mockRpcCall({
+                        request,
+                        response: () => {
+                          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                          return {
+                            result: 'ok',
+                          };
+                        },
+                      });
+
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries,
+                      // break the circuit; hit the failover
+                      await makeRpcCall(request);
+
+                      expect(
+                        rpcEndpointChainDegradedEventHandler,
+                      ).toHaveBeenCalledTimes(1);
+                      expect(
+                        rpcEndpointChainDegradedEventHandler,
+                      ).toHaveBeenCalledWith({
+                        chainId,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointDegraded event again if the max number of retries is reached in making requests to a failover endpoint', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedDegradedError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointDegradedEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointDegraded',
+                    rpcEndpointDegradedEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId, rpcUrl }) => {
+                      // The first time a block-cacheable request is made, the
+                      // latest block number is retrieved through the block
+                      // tracker first.
+                      primaryComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                        response: {
+                          httpStatus: 503,
+                        },
+                      });
+                      failoverComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        times: 5,
+                        response: {
+                          httpStatus: 503,
+                        },
+                      });
+
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries,
+                      // break the circuit; hit the failover and exceed the max
+                      // number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenCalledTimes(3);
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(1, {
+                        chainId,
+                        endpointUrl: rpcUrl,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(2, {
+                        chainId,
+                        endpointUrl: rpcUrl,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(3, {
+                        chainId,
+                        endpointUrl: failoverEndpointUrl,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointDegraded event again when the time to complete a request to a failover endpoint is too long', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedDegradedError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointDegradedEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointDegraded',
+                    rpcEndpointDegradedEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId, rpcUrl }) => {
+                      // The first time a block-cacheable request is made, the
+                      // latest block number is retrieved through the block
+                      // tracker first.
+                      primaryComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                        response: {
+                          httpStatus: 503,
+                        },
+                      });
+                      failoverComms.mockRpcCall({
+                        request: {
+                          method: 'eth_blockNumber',
+                          params: [],
+                        },
+                        response: () => {
+                          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                          return {
+                            result: '0x1',
+                          };
+                        },
+                      });
+                      failoverComms.mockRpcCall({
+                        request,
+                        response: () => {
+                          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                          return {
+                            result: 'ok',
+                          };
+                        },
+                      });
+
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the primary and exceed the max number of retries,
+                      // break the circuit; hit the failover
+                      await makeRpcCall(request);
+
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenCalledTimes(4);
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(1, {
+                        chainId,
+                        endpointUrl: rpcUrl,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(2, {
+                        chainId,
+                        endpointUrl: rpcUrl,
+                        error: expectedDegradedError,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(3, {
+                        chainId,
+                        endpointUrl: failoverEndpointUrl,
+                        error: undefined,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                      expect(
+                        rpcEndpointDegradedEventHandler,
+                      ).toHaveBeenNthCalledWith(4, {
+                        chainId,
+                        endpointUrl: failoverEndpointUrl,
+                        error: undefined,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        primaryEndpointUrl: rpcUrl,
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointChainAvailable event the first time a successful request to a failover endpoint is made', async () => {
+          const failoverEndpointUrl = 'https://failover.endpoint/';
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (primaryComms) => {
+              await withMockedCommunications(
+                {
+                  providerType: 'custom',
+                  customRpcUrl: failoverEndpointUrl,
+                },
+                async (failoverComms) => {
+                  // The first time a block-cacheable request is made, the
+                  // latest block number is retrieved through the block
+                  // tracker first.
+                  primaryComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                    response: {
+                      httpStatus: 503,
+                    },
+                  });
+                  failoverComms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    response: {
+                      result: '0x1',
+                    },
+                  });
+                  failoverComms.mockRpcCall({
+                    request,
+                    response: {
+                      result: 'ok',
+                    },
+                  });
+
+                  const messenger = buildRootMessenger();
+                  const rpcEndpointChainAvailableEventHandler = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointChainAvailable',
+                    rpcEndpointChainAvailableEventHandler,
+                  );
+
+                  await withNetworkClient(
+                    {
+                      providerType: networkClientType,
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      isRpcFailoverEnabled: true,
+                      failoverRpcUrls: [failoverEndpointUrl],
+                      messenger,
+                      getRpcServiceOptions: () => ({
+                        fetch,
+                        btoa,
+                        policyOptions: {
+                          backoff: new ConstantBackoff(backoffDuration),
+                        },
+                        isOffline: (): boolean => false,
+                      }),
+                    },
+                    async ({ makeRpcCall, clock, chainId }) => {
+                      messenger.subscribe(
+                        'NetworkController:rpcEndpointRetried',
+                        () => {
+                          // Ensure that we advance to the next RPC request
+                          // retry, not the next block tracker request.
+                          clock.tick(backoffDuration);
+                        },
+                      );
+
+                      // Hit the endpoint and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the endpoint and exceed the max number of retries
+                      await expect(makeRpcCall(request)).rejects.toThrow(
+                        expectedError,
+                      );
+                      // Hit the endpoint and exceed the max number of retries,
+                      // breaking the circuit; hit the failover
+                      await makeRpcCall(request);
+
+                      expect(
+                        rpcEndpointChainAvailableEventHandler,
+                      ).toHaveBeenCalledTimes(1);
+                      expect(
+                        rpcEndpointChainAvailableEventHandler,
+                      ).toHaveBeenCalledWith({
+                        chainId,
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      });
+                    },
+                  );
+                },
+              );
+            },
+          );
+        });
+      });
+
+      describe('without RPC failover', () => {
+        it('publishes the NetworkController:rpcEndpointChainDegraded event only once, even if the max number of retries is continually reached in making requests to a primary endpoint', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedDegradedError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              // The first time a block-cacheable request is made, the
+              // latest block number is retrieved through the block
+              // tracker first.
+              comms.mockRpcCall({
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                response: {
+                  httpStatus: 503,
+                },
+              });
+
+              const messenger = buildRootMessenger();
+              const rpcEndpointChainDegradedEventHandler = jest.fn();
+              messenger.subscribe(
+                'NetworkController:rpcEndpointChainDegraded',
+                rpcEndpointChainDegradedEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger,
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall, clock, chainId }) => {
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointRetried',
+                    () => {
+                      // Ensure that we advance to the next RPC request
+                      // retry, not the next block tracker request.
+                      clock.tick(backoffDuration);
+                    },
+                  );
+
+                  // Hit the endpoint and exceed the max number of retries
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+                  // Hit the endpoint and exceed the max number of retries
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+                  // Hit the endpoint and exceed the max number of retries,
+                  // breaking the circuit
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+
+                  expect(
+                    rpcEndpointChainDegradedEventHandler,
+                  ).toHaveBeenCalledTimes(1);
+                  expect(
+                    rpcEndpointChainDegradedEventHandler,
+                  ).toHaveBeenCalledWith({
+                    chainId,
+                    error: expectedDegradedError,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  });
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointChainDegraded event only once, even if the time to complete a request to a primary endpoint is continually too long', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              const messenger = buildRootMessenger();
+              const rpcEndpointChainDegradedEventHandler = jest.fn();
+              messenger.subscribe(
+                'NetworkController:rpcEndpointChainDegraded',
+                rpcEndpointChainDegradedEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger,
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall, clock, chainId }) => {
+                  // The first time a block-cacheable request is made, the
+                  // latest block number is retrieved through the block
+                  // tracker first.
+                  comms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    response: () => {
+                      clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                      return {
+                        result: '0x1',
+                      };
+                    },
+                  });
+                  comms.mockRpcCall({
+                    request,
+                    response: () => {
+                      clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                      return {
+                        result: 'ok',
+                      };
+                    },
+                    times: 2,
+                  });
+
+                  await makeRpcCall(request);
+                  await makeRpcCall(request);
+
+                  expect(
+                    rpcEndpointChainDegradedEventHandler,
+                  ).toHaveBeenCalledTimes(1);
+                  expect(
+                    rpcEndpointChainDegradedEventHandler,
+                  ).toHaveBeenCalledWith({
+                    chainId,
+                    error: undefined,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  });
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointDegraded event each time the max number of retries is reached in making requests to a primary endpoint', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+          const expectedDegradedError = new HttpError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              // The first time a block-cacheable request is made, the
+              // latest block number is retrieved through the block
+              // tracker first.
+              comms.mockRpcCall({
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                response: {
+                  httpStatus: 503,
+                },
+              });
+
+              const messenger = buildRootMessenger();
+              const rpcEndpointDegradedEventHandler = jest.fn();
+              messenger.subscribe(
+                'NetworkController:rpcEndpointDegraded',
+                rpcEndpointDegradedEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger,
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall, clock, chainId, rpcUrl }) => {
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointRetried',
+                    () => {
+                      // Ensure that we advance to the next RPC request
+                      // retry, not the next block tracker request.
+                      clock.tick(backoffDuration);
+                    },
+                  );
+
+                  // Hit the endpoint and exceed the max number of retries
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+                  // Hit the endpoint and exceed the max number of retries
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+                  // Hit the endpoint and exceed the max number of retries,
+                  // breaking the circuit
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+
+                  expect(rpcEndpointDegradedEventHandler).toHaveBeenCalledTimes(
+                    2,
+                  );
+                  expect(rpcEndpointDegradedEventHandler).toHaveBeenCalledWith({
+                    chainId,
+                    endpointUrl: rpcUrl,
+                    error: expectedDegradedError,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    primaryEndpointUrl: rpcUrl,
+                  });
+                  expect(rpcEndpointDegradedEventHandler).toHaveBeenCalledWith({
+                    chainId,
+                    endpointUrl: rpcUrl,
+                    error: expectedDegradedError,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    primaryEndpointUrl: rpcUrl,
+                  });
+                },
+              );
+            },
+          );
+        });
+
+        it('does not retry requests when user is offline (degraded scenario)', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              // Mock only one failure - if retries were happening, we'd need more
+              comms.mockRpcCall({
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                times: 1,
+                response: {
+                  httpStatus: 503,
+                },
+              });
+              comms.mockRpcCall({
+                request: {
+                  method: 'eth_gasPrice',
+                  params: [],
+                },
+                times: 1,
+                response: {
+                  httpStatus: 503,
+                },
+              });
+
+              const rootMessenger = buildRootMessenger({
+                connectivityStatus: CONNECTIVITY_STATUSES.Offline,
+              });
+
+              const rpcEndpointRetriedEventHandler = jest.fn();
+              rootMessenger.subscribe(
+                'NetworkController:rpcEndpointRetried',
+                rpcEndpointRetriedEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger: rootMessenger,
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall }) => {
+                  // When offline, errors are not retried, so the request
+                  // should fail immediately without retries
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+
+                  // Verify that retry event was not published
+                  expect(rpcEndpointRetriedEventHandler).not.toHaveBeenCalled();
+                },
+              );
+            },
+          );
+        });
+
+        it('suppresses the NetworkController:rpcEndpointDegraded event when user is offline', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+          const expectedError = createResourceUnavailableError(503);
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              // The first time a block-cacheable request is made, the
+              // latest block number is retrieved through the block
+              // tracker first.
+              comms.mockRpcCall({
+                request: {
+                  method: 'eth_blockNumber',
+                  params: [],
+                },
+                times: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+                response: {
+                  httpStatus: 503,
+                },
+              });
+
+              const rootMessenger = buildRootMessenger({
+                connectivityStatus: CONNECTIVITY_STATUSES.Offline,
+              });
+
+              const rpcEndpointDegradedEventHandler = jest.fn();
+              rootMessenger.subscribe(
+                'NetworkController:rpcEndpointDegraded',
+                rpcEndpointDegradedEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger: rootMessenger,
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall, clock }) => {
+                  rootMessenger.subscribe(
+                    'NetworkController:rpcEndpointRetried',
+                    () => {
+                      // Ensure that we advance to the next RPC request
+                      // retry, not the next block tracker request.
+                      clock.tick(backoffDuration);
+                    },
+                  );
+
+                  // When offline, errors are not retried, so the circuit
+                  // won't accumulate failures and onServiceDegraded won't be called
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+                  await expect(makeRpcCall(request)).rejects.toThrow(
+                    expectedError,
+                  );
+
+                  // Event should be suppressed when offline because retries
+                  // are prevented, so onServiceDegraded is never called
+                  expect(
+                    rpcEndpointDegradedEventHandler,
+                  ).not.toHaveBeenCalled();
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointDegraded event when the time to complete a request to a primary endpoint is continually too long', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              const messenger = buildRootMessenger();
+              const rpcEndpointDegradedEventHandler = jest.fn();
+              messenger.subscribe(
+                'NetworkController:rpcEndpointDegraded',
+                rpcEndpointDegradedEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger,
+                  getBlockTrackerOptions: () => ({
+                    pollingInterval: 10000,
+                  }),
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall, clock, chainId, rpcUrl }) => {
+                  // The first time a block-cacheable request is made, the
+                  // latest block number is retrieved through the block
+                  // tracker first.
+                  comms.mockRpcCall({
+                    request: {
+                      method: 'eth_blockNumber',
+                      params: [],
+                    },
+                    response: () => {
+                      clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                      return {
+                        result: '0x1',
+                      };
+                    },
+                  });
+                  comms.mockRpcCall({
+                    request,
+                    response: () => {
+                      clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+                      return {
+                        result: 'ok',
+                      };
+                    },
+                  });
+
+                  await makeRpcCall(request);
+
+                  expect(rpcEndpointDegradedEventHandler).toHaveBeenCalledTimes(
+                    2,
+                  );
+                  expect(rpcEndpointDegradedEventHandler).toHaveBeenCalledWith({
+                    chainId,
+                    endpointUrl: rpcUrl,
+                    error: undefined,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    primaryEndpointUrl: rpcUrl,
+                  });
+                  expect(rpcEndpointDegradedEventHandler).toHaveBeenCalledWith({
+                    chainId,
+                    endpointUrl: rpcUrl,
+                    error: undefined,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    primaryEndpointUrl: rpcUrl,
+                  });
+                },
+              );
+            },
+          );
+        });
+
+        it('publishes the NetworkController:rpcEndpointChainAvailable event the first time a successful request to a (primary) RPC endpoint is made', async () => {
+          const request = {
+            method: 'eth_gasPrice',
+            params: [],
+          };
+
+          await withMockedCommunications(
+            { providerType: networkClientType },
+            async (comms) => {
+              // The first time a block-cacheable request is made, the
+              // latest block number is retrieved through the block
+              // tracker first.
+              comms.mockNextBlockTrackerRequest({
+                blockNumber,
+              });
+              comms.mockRpcCall({
+                request,
+                response: {
+                  result: 'ok',
+                },
+              });
+
+              const messenger = buildRootMessenger();
+              const rpcEndpointChainAvailableEventHandler = jest.fn();
+              messenger.subscribe(
+                'NetworkController:rpcEndpointChainAvailable',
+                rpcEndpointChainAvailableEventHandler,
+              );
+
+              await withNetworkClient(
+                {
+                  providerType: networkClientType,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  messenger,
+                  getRpcServiceOptions: () => ({
+                    fetch,
+                    btoa,
+                    policyOptions: {
+                      backoff: new ConstantBackoff(backoffDuration),
+                    },
+                    isOffline: (): boolean => false,
+                  }),
+                },
+                async ({ makeRpcCall, chainId }) => {
+                  await makeRpcCall(request);
+
+                  expect(
+                    rpcEndpointChainAvailableEventHandler,
+                  ).toHaveBeenCalledTimes(1);
+                  expect(
+                    rpcEndpointChainAvailableEventHandler,
+                  ).toHaveBeenCalledWith({
+                    chainId,
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  });
+                },
+              );
+            },
+          );
+        });
+      });
+    });
+  }
+});
+
+/**
+ * Creates a "resource unavailable" RPC error for testing.
+ *
+ * @param httpStatus - The HTTP status that the error represents.
+ * @returns The RPC error.
+ */
+function createResourceUnavailableError(httpStatus: number): Error {
+  return expect.objectContaining({
+    code: errorCodes.rpc.resourceUnavailable,
+    message: 'RPC endpoint not found or unavailable.',
+    data: {
+      httpStatus,
+    },
+  });
+}
diff --git a/src/create-network-client.ts b/src/create-network-client.ts
new file mode 100644
index 0000000000000000000000000000000000000000..6a0a78c9148bf59ce53be4623170657cb9cea02d
--- /dev/null
+++ b/src/create-network-client.ts
@@ -0,0 +1,517 @@
+import { CONNECTIVITY_STATUSES } from '@metamask/connectivity-controller';
+import type {
+  CockatielFailureReason,
+  InfuraNetworkType,
+} from '@metamask/controller-utils';
+import { ChainId } from '@metamask/controller-utils';
+import type { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+import { PollingBlockTracker } from '@metamask/eth-block-tracker';
+import { createInfuraMiddleware } from '@metamask/eth-json-rpc-infura';
+import {
+  createBlockCacheMiddleware,
+  createBlockRefMiddleware,
+  createBlockRefRewriteMiddleware,
+  createBlockTrackerInspectorMiddleware,
+  createInflightCacheMiddleware,
+  createFetchMiddleware,
+  createRetryOnEmptyMiddleware,
+} from '@metamask/eth-json-rpc-middleware';
+import { InternalProvider } from '@metamask/eth-json-rpc-provider';
+import { providerFromMiddlewareV2 } from '@metamask/eth-json-rpc-provider';
+import { asV2Middleware } from '@metamask/json-rpc-engine';
+import {
+  createScaffoldMiddleware,
+  JsonRpcEngineV2,
+} from '@metamask/json-rpc-engine/v2';
+import type {
+  JsonRpcMiddleware,
+  MiddlewareContext,
+} from '@metamask/json-rpc-engine/v2';
+import type { Hex, Json, JsonRpcRequest } from '@metamask/utils';
+import type { Logger } from 'loglevel';
+
+import type {
+  NetworkClientId,
+  NetworkControllerMessenger,
+} from './NetworkController';
+import type { RpcServiceOptions } from './rpc-service/rpc-service';
+import { RpcServiceChain } from './rpc-service/rpc-service-chain';
+import type {
+  BlockTracker,
+  NetworkClientConfiguration,
+  Provider,
+} from './types';
+import { NetworkClientType } from './types';
+
+const SECOND = 1000;
+
+/**
+ * The pair of provider / block tracker that can be used to interface with the
+ * network and respond to new activity.
+ */
+export type NetworkClient = {
+  configuration: NetworkClientConfiguration;
+  provider: Provider;
+  blockTracker: BlockTracker;
+  destroy: () => void;
+};
+
+type RpcApiMiddleware = JsonRpcMiddleware<
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext<{ origin: string }>
+>;
+
+/**
+ * Create a JSON RPC network client for a specific network.
+ *
+ * @param args - The arguments.
+ * @param args.id - The ID that will be assigned to the new network client in
+ * the registry.
+ * @param args.configuration - The network configuration.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.getBlockTrackerOptions - Factory for constructing block tracker
+ * options. See {@link NetworkControllerOptions.getBlockTrackerOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable. This effectively
+ * causes the `failoverRpcUrls` property of the network client configuration
+ * to be honored or ignored.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The network client.
+ */
+export function createNetworkClient({
+  id,
+  configuration,
+  getRpcServiceOptions,
+  getBlockTrackerOptions,
+  messenger,
+  isRpcFailoverEnabled,
+  logger,
+}: {
+  id: NetworkClientId;
+  configuration: NetworkClientConfiguration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;
+  getBlockTrackerOptions: (
+    rpcEndpointUrl: string,
+  ) => Omit<PollingBlockTrackerOptions, 'provider'>;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): NetworkClient {
+  const primaryEndpointUrl =
+    configuration.type === NetworkClientType.Infura
+      ? `https://${configuration.network}.infura.io/v3/${configuration.infuraProjectId}`
+      : configuration.rpcUrl;
+  const rpcServiceChain = createRpcServiceChain({
+    id,
+    primaryEndpointUrl,
+    configuration,
+    getRpcServiceOptions,
+    messenger,
+    isRpcFailoverEnabled,
+    logger,
+  });
+
+  let rpcApiMiddleware: RpcApiMiddleware;
+  if (configuration.type === NetworkClientType.Infura) {
+    rpcApiMiddleware = asV2Middleware(
+      createInfuraMiddleware({
+        rpcService: rpcServiceChain,
+        options: {
+          source: 'metamask',
+        },
+      }),
+    );
+  } else {
+    rpcApiMiddleware = createFetchMiddleware({ rpcService: rpcServiceChain });
+  }
+
+  const rpcProvider = providerFromMiddlewareV2(rpcApiMiddleware);
+
+  const blockTracker = createBlockTracker({
+    networkClientType: configuration.type,
+    endpointUrl: primaryEndpointUrl,
+    getOptions: getBlockTrackerOptions,
+    provider: rpcProvider,
+  });
+
+  const networkMiddleware =
+    configuration.type === NetworkClientType.Infura
+      ? createInfuraNetworkMiddleware({
+          blockTracker,
+          network: configuration.network,
+          rpcProvider,
+          rpcApiMiddleware,
+        })
+      : createCustomNetworkMiddleware({
+          blockTracker,
+          chainId: configuration.chainId,
+          rpcApiMiddleware,
+        });
+
+  const provider: Provider = new InternalProvider({
+    engine: JsonRpcEngineV2.create({
+      middleware: [networkMiddleware],
+    }),
+  });
+
+  const destroy = (): void => {
+    // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+    // eslint-disable-next-line @typescript-eslint/no-floating-promises
+    blockTracker.destroy();
+  };
+
+  return { configuration, provider, blockTracker, destroy };
+}
+
+/**
+ * Creates an RPC service chain, which represents the primary endpoint URL for
+ * the network as well as its failover URLs.
+ *
+ * @param args - The arguments.
+ * @param args.id - The ID that will be assigned to the new network client in
+ * the registry.
+ * @param args.primaryEndpointUrl - The primary endpoint URL.
+ * @param args.configuration - The network configuration.
+ * @param args.getRpcServiceOptions - Factory for constructing RPC service
+ * options. See {@link NetworkControllerOptions.getRpcServiceOptions}.
+ * @param args.messenger - The network controller messenger.
+ * @param args.isRpcFailoverEnabled - Whether or not requests sent to the
+ * primary RPC endpoint for this network should be automatically diverted to
+ * provided failover endpoints if the primary is unavailable. This effectively
+ * causes the `failoverRpcUrls` property of the network client configuration
+ * to be honored or ignored.
+ * @param args.logger - A `loglevel` logger.
+ * @returns The RPC service chain.
+ */
+function createRpcServiceChain({
+  id,
+  primaryEndpointUrl,
+  configuration,
+  getRpcServiceOptions,
+  messenger,
+  isRpcFailoverEnabled,
+  logger,
+}: {
+  id: NetworkClientId;
+  primaryEndpointUrl: string;
+  configuration: NetworkClientConfiguration;
+  getRpcServiceOptions: (
+    rpcEndpointUrl: string,
+  ) => Omit<RpcServiceOptions, 'failoverService' | 'endpointUrl'>;
+  messenger: NetworkControllerMessenger;
+  isRpcFailoverEnabled: boolean;
+  logger?: Logger;
+}): RpcServiceChain {
+  const availableEndpointUrls: [string, ...string[]] = isRpcFailoverEnabled
+    ? [primaryEndpointUrl, ...(configuration.failoverRpcUrls ?? [])]
+    : [primaryEndpointUrl];
+
+  const isOffline = (): boolean => {
+    const connectivityState = messenger.call('ConnectivityController:getState');
+    return (
+      connectivityState.connectivityStatus === CONNECTIVITY_STATUSES.Offline
+    );
+  };
+
+  const rpcServiceConfigurations = availableEndpointUrls.map((endpointUrl) => ({
+    ...getRpcServiceOptions(endpointUrl),
+    endpointUrl,
+    logger,
+    isOffline,
+  }));
+
+  /**
+   * Extracts the error from Cockatiel's `FailureReason` type received in
+   * circuit breaker event handlers.
+   *
+   * The `FailureReason` object can have two possible shapes:
+   * - `{ error: Error }` - When the RPC service throws an error (the common
+   * case for RPC failures).
+   * - `{ value: T }` - When the RPC service returns a value that the retry
+   * filter policy considers a failure.
+   *
+   * @param value - The event data object from the circuit breaker event
+   * listener (after destructuring known properties like `endpointUrl`). This
+   * represents Cockatiel's `FailureReason` type.
+   * @returns The error or failure value, or `undefined` if neither property
+   * exists (which shouldn't happen in practice unless the circuit breaker is
+   * manually isolated).
+   */
+  const getError = (
+    value: CockatielFailureReason<unknown> | Record<never, never>,
+  ): Error | unknown | undefined => {
+    if ('error' in value) {
+      return value.error;
+    } else if ('value' in value) {
+      return value.value;
+    }
+    return undefined;
+  };
+
+  const rpcServiceChain = new RpcServiceChain([
+    rpcServiceConfigurations[0],
+    ...rpcServiceConfigurations.slice(1),
+  ]);
+
+  rpcServiceChain.onBreak((data) => {
+    const error = getError(data);
+
+    if (error === undefined) {
+      // This error shouldn't happen in practice because we never call `.isolate`
+      // on the circuit breaker policy, but we need to appease TypeScript.
+      throw new Error('Could not make request to endpoint.');
+    }
+
+    messenger.publish('NetworkController:rpcEndpointChainUnavailable', {
+      chainId: configuration.chainId,
+      networkClientId: id,
+      error,
+    });
+  });
+
+  rpcServiceChain.onServiceBreak(
+    ({
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+      ...rest
+    }) => {
+      const error = getError(rest);
+
+      if (error === undefined) {
+        // This error shouldn't happen in practice because we never call `.isolate`
+        // on the circuit breaker policy, but we need to appease TypeScript.
+        throw new Error('Could not make request to endpoint.');
+      }
+
+      messenger.publish('NetworkController:rpcEndpointUnavailable', {
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        error,
+      });
+    },
+  );
+
+  rpcServiceChain.onDegraded((data) => {
+    const error = getError(data);
+    messenger.publish('NetworkController:rpcEndpointChainDegraded', {
+      chainId: configuration.chainId,
+      networkClientId: id,
+      error,
+    });
+  });
+
+  rpcServiceChain.onServiceDegraded(
+    ({
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+      ...rest
+    }) => {
+      const error = getError(rest);
+
+      messenger.publish('NetworkController:rpcEndpointDegraded', {
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        error,
+      });
+    },
+  );
+
+  rpcServiceChain.onAvailable(() => {
+    messenger.publish('NetworkController:rpcEndpointChainAvailable', {
+      chainId: configuration.chainId,
+      networkClientId: id,
+    });
+  });
+
+  rpcServiceChain.onServiceRetry(
+    ({
+      attempt,
+      endpointUrl,
+      primaryEndpointUrl: primaryEndpointUrlFromEvent,
+    }) => {
+      messenger.publish('NetworkController:rpcEndpointRetried', {
+        chainId: configuration.chainId,
+        networkClientId: id,
+        primaryEndpointUrl: primaryEndpointUrlFromEvent,
+        endpointUrl,
+        attempt,
+      });
+    },
+  );
+
+  return rpcServiceChain;
+}
+
+/**
+ * Create the block tracker for the network.
+ *
+ * @param args - The arguments.
+ * @param args.networkClientType - The type of the network client ("infura" or
+ * "custom").
+ * @param args.endpointUrl - The URL of the endpoint.
+ * @param args.getOptions - Factory for the block tracker options.
+ * @param args.provider - The EIP-1193 provider for the network's JSON-RPC
+ * middleware stack.
+ * @returns The created block tracker.
+ */
+function createBlockTracker({
+  networkClientType,
+  endpointUrl,
+  getOptions,
+  provider,
+}: {
+  networkClientType: NetworkClientType;
+  endpointUrl: string;
+  getOptions: (
+    rpcEndpointUrl: string,
+  ) => Omit<PollingBlockTrackerOptions, 'provider'>;
+  provider: InternalProvider;
+}): PollingBlockTracker {
+  const testOptions =
+    // Needed for testing.
+    // eslint-disable-next-line no-restricted-globals
+    process.env.IN_TEST && networkClientType === NetworkClientType.Custom
+      ? { pollingInterval: SECOND }
+      : {};
+
+  return new PollingBlockTracker({
+    ...testOptions,
+    ...getOptions(endpointUrl),
+    provider,
+  });
+}
+
+/**
+ * Create middleware for infura.
+ *
+ * @param args - The arguments.
+ * @param args.blockTracker - The block tracker to use.
+ * @param args.network - The Infura network to use.
+ * @param args.rpcProvider - The RPC provider to use.
+ * @param args.rpcApiMiddleware - Additional middleware.
+ * @returns The collection of middleware that makes up the Infura client.
+ */
+function createInfuraNetworkMiddleware({
+  blockTracker,
+  network,
+  rpcProvider,
+  rpcApiMiddleware,
+}: {
+  blockTracker: PollingBlockTracker;
+  network: InfuraNetworkType;
+  rpcProvider: InternalProvider;
+  rpcApiMiddleware: RpcApiMiddleware;
+}): JsonRpcMiddleware<
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext<{ origin: string; skipCache: boolean }>
+> {
+  return JsonRpcEngineV2.create({
+    middleware: [
+      createNetworkAndChainIdMiddleware({ network }),
+      createBlockCacheMiddleware({ blockTracker }),
+      createInflightCacheMiddleware(),
+      createBlockRefMiddleware({ blockTracker, provider: rpcProvider }),
+      createRetryOnEmptyMiddleware({ blockTracker, provider: rpcProvider }),
+      createBlockTrackerInspectorMiddleware({ blockTracker }),
+      rpcApiMiddleware,
+    ],
+  }).asMiddleware();
+}
+
+/**
+ * Creates static method middleware.
+ *
+ * @param args - The Arguments.
+ * @param args.network - The Infura network to use.
+ * @returns The middleware that implements the eth_chainId method.
+ */
+function createNetworkAndChainIdMiddleware({
+  network,
+}: {
+  network: InfuraNetworkType;
+}): JsonRpcMiddleware<JsonRpcRequest> {
+  return createScaffoldMiddleware({
+    eth_chainId: ChainId[network],
+  });
+}
+
+const createChainIdMiddleware = (
+  chainId: Hex,
+): JsonRpcMiddleware<JsonRpcRequest, Json> => {
+  return ({ request, next }) => {
+    if (request.method === 'eth_chainId') {
+      return chainId;
+    }
+    return next();
+  };
+};
+
+/**
+ * Creates custom middleware.
+ *
+ * @param args - The arguments.
+ * @param args.blockTracker - The block tracker to use.
+ * @param args.chainId - The chain id to use.
+ * @param args.rpcApiMiddleware - Additional middleware.
+ * @returns The collection of middleware that makes up the Infura client.
+ */
+function createCustomNetworkMiddleware({
+  blockTracker,
+  chainId,
+  rpcApiMiddleware,
+}: {
+  blockTracker: PollingBlockTracker;
+  chainId: Hex;
+  rpcApiMiddleware: RpcApiMiddleware;
+}): JsonRpcMiddleware<
+  JsonRpcRequest,
+  Json,
+  MiddlewareContext<{ origin: string; skipCache: boolean }>
+> {
+  // Needed for testing.
+  // eslint-disable-next-line no-restricted-globals
+  const testMiddlewares = process.env.IN_TEST
+    ? [createEstimateGasDelayTestMiddleware()]
+    : [];
+
+  return JsonRpcEngineV2.create({
+    middleware: [
+      ...testMiddlewares,
+      createChainIdMiddleware(chainId),
+      createBlockRefRewriteMiddleware({ blockTracker }),
+      createBlockCacheMiddleware({ blockTracker }),
+      createInflightCacheMiddleware(),
+      createBlockTrackerInspectorMiddleware({ blockTracker }),
+      rpcApiMiddleware,
+    ],
+  }).asMiddleware();
+}
+
+/**
+ * For use in tests only.
+ * Adds a delay to `eth_estimateGas` calls.
+ *
+ * @returns The middleware for delaying gas estimation calls by 2 seconds when in test.
+ */
+function createEstimateGasDelayTestMiddleware(): JsonRpcMiddleware<
+  JsonRpcRequest,
+  Json
+> {
+  return async ({ request, next }) => {
+    if (request.method === 'eth_estimateGas') {
+      await new Promise((resolve) => setTimeout(resolve, SECOND * 2));
+    }
+    return next();
+  };
+}
diff --git a/src/index.ts b/src/index.ts
new file mode 100644
index 0000000000000000000000000000000000000000..98153162fe799912066d67d851bc7f27ef37fba9
--- /dev/null
+++ b/src/index.ts
@@ -0,0 +1,64 @@
+export type { AutoManagedNetworkClient } from './create-auto-managed-network-client';
+export type {
+  Block,
+  NetworkMetadata,
+  NetworkConfiguration,
+  BuiltInNetworkClientId,
+  CustomNetworkClientId,
+  NetworkClientId,
+  NetworksMetadata,
+  NetworkState,
+  BlockTrackerProxy,
+  ProviderProxy,
+  AddNetworkFields,
+  UpdateNetworkFields,
+  NetworkControllerStateChangeEvent,
+  NetworkControllerNetworkWillChangeEvent,
+  NetworkControllerNetworkDidChangeEvent,
+  NetworkControllerInfuraIsBlockedEvent,
+  NetworkControllerInfuraIsUnblockedEvent,
+  NetworkControllerNetworkAddedEvent,
+  NetworkControllerNetworkRemovedEvent,
+  NetworkControllerEvents,
+  NetworkControllerGetStateAction,
+  NetworkControllerGetEthQueryAction,
+  NetworkControllerGetNetworkClientByIdAction,
+  NetworkControllerGetSelectedNetworkClientAction,
+  NetworkControllerGetSelectedChainIdAction,
+  NetworkControllerGetEIP1559CompatibilityAction,
+  NetworkControllerFindNetworkClientIdByChainIdAction,
+  NetworkControllerSetProviderTypeAction,
+  NetworkControllerSetActiveNetworkAction,
+  NetworkControllerAddNetworkAction,
+  NetworkControllerRemoveNetworkAction,
+  NetworkControllerUpdateNetworkAction,
+  NetworkControllerGetNetworkConfigurationByNetworkClientId,
+  NetworkControllerActions,
+  NetworkControllerMessenger,
+  NetworkControllerOptions,
+  NetworkControllerRpcEndpointChainUnavailableEvent,
+  NetworkControllerRpcEndpointUnavailableEvent,
+  NetworkControllerRpcEndpointChainDegradedEvent,
+  NetworkControllerRpcEndpointDegradedEvent,
+  NetworkControllerRpcEndpointChainAvailableEvent,
+  NetworkControllerRpcEndpointRetriedEvent,
+} from './NetworkController';
+export {
+  getDefaultNetworkControllerState,
+  selectAvailableNetworkClientIds,
+  knownKeysOf,
+  NetworkController,
+  RpcEndpointType,
+} from './NetworkController';
+export * from './constants';
+export type { BlockTracker, Provider } from './types';
+export type {
+  NetworkClientConfiguration,
+  InfuraNetworkClientConfiguration,
+  CustomNetworkClientConfiguration,
+} from './types';
+export { NetworkClientType } from './types';
+export type { NetworkClient } from './create-network-client';
+export type { AbstractRpcService } from './rpc-service/abstract-rpc-service';
+export type { RpcServiceRequestable } from './rpc-service/rpc-service-requestable';
+export { isConnectionError } from './rpc-service/rpc-service';
diff --git a/src/logger.ts b/src/logger.ts
new file mode 100644
index 0000000000000000000000000000000000000000..8b1af8ca8b792c22383e130569afa3bdcfe9e7af
--- /dev/null
+++ b/src/logger.ts
@@ -0,0 +1,5 @@
+import { createProjectLogger, createModuleLogger } from '@metamask/utils';
+
+export const projectLogger = createProjectLogger('network-controller');
+
+export { createModuleLogger };
diff --git a/src/rpc-service/abstract-rpc-service.ts b/src/rpc-service/abstract-rpc-service.ts
new file mode 100644
index 0000000000000000000000000000000000000000..81d78442918aa535461dac7a00e589357c82b1be
--- /dev/null
+++ b/src/rpc-service/abstract-rpc-service.ts
@@ -0,0 +1,12 @@
+import type { RpcServiceRequestable } from './rpc-service-requestable';
+
+/**
+ * The interface for a service class responsible for making a request to an RPC
+ * endpoint or a group of RPC endpoints.
+ */
+export type AbstractRpcService = RpcServiceRequestable & {
+  /**
+   * The URL of the RPC endpoint.
+   */
+  endpointUrl: URL;
+};
diff --git a/src/rpc-service/rpc-service-chain.test.ts b/src/rpc-service/rpc-service-chain.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..6e1508a6e0a7df406312727266639487106082d6
--- /dev/null
+++ b/src/rpc-service/rpc-service-chain.test.ts
@@ -0,0 +1,2149 @@
+import {
+  DEFAULT_CIRCUIT_BREAK_DURATION,
+  DEFAULT_DEGRADED_THRESHOLD,
+  HttpError,
+} from '@metamask/controller-utils';
+import { errorCodes } from '@metamask/rpc-errors';
+import nock from 'nock';
+import { useFakeTimers } from 'sinon';
+import type { SinonFakeTimers } from 'sinon';
+
+import {
+  DEFAULT_MAX_CONSECUTIVE_FAILURES,
+  DEFAULT_MAX_RETRIES,
+} from './rpc-service';
+import { RpcServiceChain } from './rpc-service-chain';
+
+/**
+ * The number of fetch requests made for a single request to an RPC service, using default max
+ * retry attempts.
+ */
+const DEFAULT_REQUEST_ATTEMPTS = 1 + DEFAULT_MAX_RETRIES;
+
+/**
+ * Number of attempts required to break the circuit of an RPC service using default retry attempts
+ * and max consecutive failures.
+ *
+ * Note: This calculation and later ones assume that there is no remainder.
+ */
+const DEFAULT_RPC_SERVICE_ATTEMPTS_UNTIL_BREAK =
+  DEFAULT_MAX_CONSECUTIVE_FAILURES / DEFAULT_REQUEST_ATTEMPTS;
+
+/**
+ * Number of attempts required to break the circuit of an RPC service chain (with a single
+ * failover) that uses default retry attempts and max consecutive failures.
+ *
+ * The value is one less than double the number of attempts needed to break a single circuit
+ * because on failure of the primary, the request gets forwarded to the failover immediately.
+ */
+const DEFAULT_RPC_CHAIN_ATTEMPTS_UNTIL_BREAK =
+  2 * DEFAULT_RPC_SERVICE_ATTEMPTS_UNTIL_BREAK - 1;
+
+describe('RpcServiceChain', () => {
+  let clock: SinonFakeTimers;
+
+  beforeEach(() => {
+    clock = useFakeTimers();
+  });
+
+  afterEach(() => {
+    clock.restore();
+  });
+
+  describe('onServiceRetry', () => {
+    it('returns a listener which can be disposed', () => {
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://rpc.example.chain',
+        },
+      ]);
+
+      const onServiceRetryListener = rpcServiceChain.onServiceRetry(() => {
+        // do whatever
+      });
+      expect(onServiceRetryListener.dispose()).toBeUndefined();
+    });
+  });
+
+  describe('onBreak', () => {
+    it('returns a listener which can be disposed', () => {
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://rpc.example.chain',
+        },
+      ]);
+
+      const onBreakListener = rpcServiceChain.onBreak(() => {
+        // do whatever
+      });
+      expect(onBreakListener.dispose()).toBeUndefined();
+    });
+  });
+
+  describe('onServiceBreak', () => {
+    it('returns a listener which can be disposed', () => {
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://rpc.example.chain',
+        },
+      ]);
+
+      const onServiceBreakListener = rpcServiceChain.onServiceBreak(() => {
+        // do whatever
+      });
+      expect(onServiceBreakListener.dispose()).toBeUndefined();
+    });
+  });
+
+  describe('onDegraded', () => {
+    it('returns a listener which can be disposed', () => {
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://rpc.example.chain',
+        },
+      ]);
+
+      const onDegradedListener = rpcServiceChain.onDegraded(() => {
+        // do whatever
+      });
+      expect(onDegradedListener.dispose()).toBeUndefined();
+    });
+  });
+
+  describe('onServiceDegraded', () => {
+    it('returns a listener which can be disposed', () => {
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://rpc.example.chain',
+        },
+      ]);
+
+      const onServiceDegradedListener = rpcServiceChain.onServiceDegraded(
+        () => {
+          // do whatever
+        },
+      );
+      expect(onServiceDegradedListener.dispose()).toBeUndefined();
+    });
+  });
+
+  describe('onAvailable', () => {
+    it('returns a listener which can be disposed', () => {
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://rpc.example.chain',
+        },
+      ]);
+
+      const onAvailableListener = rpcServiceChain.onAvailable(() => {
+        // do whatever
+      });
+      expect(onAvailableListener.dispose()).toBeUndefined();
+    });
+  });
+
+  describe('request', () => {
+    it('returns what the first RPC service in the chain returns, if it succeeds', async () => {
+      nock('https://first.endpoint')
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://first.endpoint',
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://second.endpoint',
+          fetchOptions: {
+            headers: {
+              'X-Foo': 'Bar',
+            },
+          },
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://third.chain',
+        },
+      ]);
+
+      const response = await rpcServiceChain.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+    });
+
+    it('returns what a failover service returns, if the primary is unavailable and the failover is not', async () => {
+      nock('https://first.endpoint')
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock('https://second.endpoint')
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock('https://third.chain')
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://first.endpoint',
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://second.endpoint',
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://third.chain',
+        },
+      ]);
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be retried, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      // The circuit will break on the last time, and the third endpoint will
+      // be hit. This is finally a success.
+      const response = await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+    });
+
+    it("allows each RPC service's fetch options to be configured separately, yet passes the fetch options given to request to all of them", async () => {
+      const firstEndpointScope = nock('https://first.endpoint', {
+        reqheaders: {
+          'X-Fizz': 'Buzz',
+        },
+      })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const secondEndpointScope = nock('https://second.endpoint', {
+        reqheaders: {
+          'X-Fizz': 'Buzz',
+        },
+      })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const thirdEndpointScope = nock('https://third.chain', {
+        reqheaders: {
+          'X-Fizz': 'Buzz',
+        },
+      })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://first.endpoint',
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://second.endpoint',
+          fetchOptions: {
+            headers: {
+              'X-Foo': 'Bar',
+            },
+          },
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: 'https://third.chain',
+          fetchOptions: {
+            referrer: 'https://some.referrer',
+          },
+        },
+      ]);
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      const fetchOptions = {
+        headers: {
+          'X-Fizz': 'Buzz',
+        },
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(
+        rpcServiceChain.request(jsonRpcRequest, fetchOptions),
+      ).rejects.toThrow(expectedError);
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(
+        rpcServiceChain.request(jsonRpcRequest, fetchOptions),
+      ).rejects.toThrow(expectedError);
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be retried, until max retries is hit.
+      await expect(
+        rpcServiceChain.request(jsonRpcRequest, fetchOptions),
+      ).rejects.toThrow(expectedError);
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      await expect(
+        rpcServiceChain.request(jsonRpcRequest, fetchOptions),
+      ).rejects.toThrow(expectedError);
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      // The circuit will break on the last time, and the third endpoint will
+      // be hit. This is finally a success.
+      await rpcServiceChain.request(jsonRpcRequest, fetchOptions);
+
+      expect(firstEndpointScope.isDone()).toBe(true);
+      expect(secondEndpointScope.isDone()).toBe(true);
+      expect(thirdEndpointScope.isDone()).toBe(true);
+    });
+
+    it("throws a custom error if a request is attempted while a service's circuit is open", async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Attempt the endpoint again.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        'RPC endpoint returned too many errors',
+      );
+    });
+
+    it('calls onServiceRetry each time an RPC service in the chain retries its request', async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      const tertiaryEndpointUrl = 'https://third.chain';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(tertiaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const expectedRetryError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+          fetchOptions: {
+            headers: {
+              'X-Foo': 'Bar',
+            },
+          },
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: tertiaryEndpointUrl,
+        },
+      ]);
+      const onServiceRetryListener = jest.fn(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceRetry(onServiceRetryListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be retried, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      // The circuit will break on the last time, and the third endpoint will
+      // be hit. This is finally a success.
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      for (let attempt = 0; attempt < 24; attempt++) {
+        expect(onServiceRetryListener).toHaveBeenNthCalledWith(attempt + 1, {
+          primaryEndpointUrl: `${primaryEndpointUrl}/`,
+          endpointUrl:
+            attempt >= 12
+              ? `${secondaryEndpointUrl}/`
+              : `${primaryEndpointUrl}/`,
+          attempt: (attempt % 4) + 1,
+          delay: expect.any(Number),
+          error: expectedRetryError,
+        });
+      }
+    });
+
+    it('does not call onBreak if the primary service circuit breaks and the request to its failover fails but its circuit has not broken yet', async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(500);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        createResourceUnavailableError(503),
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        createResourceUnavailableError(503),
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit (unsuccessfully).
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        createResourceUnavailableError(500),
+      );
+
+      expect(onBreakListener).not.toHaveBeenCalled();
+    });
+
+    it("calls onBreak when all of the RPC services' circuits have broken", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be retried, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the first endpoint, see that the circuit is broken, and retry the
+      // second endpoint, until max retries is hit. The circuit will break on
+      // the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+
+      expect(onBreakListener).toHaveBeenCalledTimes(1);
+      expect(onBreakListener).toHaveBeenCalledWith({
+        error: new Error("Fetch failed with status '503'"),
+      });
+    });
+
+    it("calls onBreak again if all services' circuits break, the primary service responds successfully, and all services' circuits break again", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(30)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      const onAvailableListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+      rpcServiceChain.onAvailable(onAvailableListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until its circuit breaks, then retry the
+      // second endpoint until *its* circuit breaks.
+      for (let i = 0; i < DEFAULT_RPC_CHAIN_ATTEMPTS_UNTIL_BREAK; i++) {
+        await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+      }
+      // Wait until the circuit break duration passes, try the first endpoint
+      // and see that it succeeds.
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      await rpcServiceChain.request(jsonRpcRequest);
+      // Do it again: retry the first endpoint until its circuit breaks, then
+      // retry the second endpoint until *its* circuit breaks.
+      for (let i = 0; i < DEFAULT_RPC_CHAIN_ATTEMPTS_UNTIL_BREAK; i++) {
+        await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+      }
+
+      expect(onBreakListener).toHaveBeenCalledTimes(2);
+      expect(onBreakListener).toHaveBeenNthCalledWith(1, {
+        error: new Error("Fetch failed with status '503'"),
+      });
+      expect(onBreakListener).toHaveBeenNthCalledWith(2, {
+        error: new Error("Fetch failed with status '503'"),
+      });
+    });
+
+    it("calls onBreak again if all services' circuits break, the primary service responds successfully but slowly, and all circuits break again", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(30)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until its circuit breaks, then retry the
+      // second endpoint until *its* circuit breaks.
+      for (let i = 0; i < DEFAULT_RPC_CHAIN_ATTEMPTS_UNTIL_BREAK; i++) {
+        await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+      }
+      // Wait until the circuit break duration passes, try the first endpoint
+      // and see that it succeeds.
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      await rpcServiceChain.request(jsonRpcRequest);
+      // Do it again: retry the first endpoint until its circuit breaks, then
+      // retry the second endpoint until *its* circuit breaks.
+      for (let i = 0; i < DEFAULT_RPC_CHAIN_ATTEMPTS_UNTIL_BREAK; i++) {
+        await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+      }
+
+      expect(onBreakListener).toHaveBeenCalledTimes(2);
+      expect(onBreakListener).toHaveBeenNthCalledWith(1, {
+        error: new Error("Fetch failed with status '503'"),
+      });
+      expect(onBreakListener).toHaveBeenNthCalledWith(2, {
+        error: new Error("Fetch failed with status '503'"),
+      });
+    });
+
+    it('calls onServiceBreak each time the circuit of an RPC service in the chain breaks', async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      const tertiaryEndpointUrl = 'https://third.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(tertiaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: tertiaryEndpointUrl,
+        },
+      ]);
+      const onServiceBreakListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceBreak(onServiceBreakListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the second endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the second endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the third endpoint will
+      // be hit, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the third endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the third endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+
+      expect(onServiceBreakListener).toHaveBeenCalledTimes(3);
+      expect(onServiceBreakListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${primaryEndpointUrl}/`,
+        error: new Error("Fetch failed with status '503'"),
+      });
+      expect(onServiceBreakListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${secondaryEndpointUrl}/`,
+        error: new Error("Fetch failed with status '503'"),
+      });
+      expect(onServiceBreakListener).toHaveBeenNthCalledWith(3, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${tertiaryEndpointUrl}/`,
+        error: new Error("Fetch failed with status '503'"),
+      });
+    });
+
+    it("calls onDegraded only once even if a service's maximum number of retries is reached multiple times", async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onDegraded(onDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(1);
+      expect(onDegradedListener).toHaveBeenCalledWith({
+        error: expectedDegradedError,
+      });
+    });
+
+    it('calls onDegraded only once even if the time to complete a request via a service is continually slow', async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(2)
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onDegraded(onDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      await rpcServiceChain.request(jsonRpcRequest);
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(1);
+      expect(onDegradedListener).toHaveBeenCalledWith({});
+    });
+
+    it('calls onDegraded only once even if a service runs out of retries and then responds successfully but slowly, or vice versa', async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(5)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(5)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onDegraded(onDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the endpoint again, and see that it succeeds.
+      await rpcServiceChain.request(jsonRpcRequest);
+      // Retry the endpoint again until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(1);
+      expect(onDegradedListener).toHaveBeenCalledWith({
+        error: expectedDegradedError,
+      });
+    });
+
+    it("does not call onDegraded again when the primary service's circuit breaks and its failover responds successfully but slowly", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      const onDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+      rpcServiceChain.onDegraded(onDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit, albeit slowly.
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(1);
+      expect(onDegradedListener).toHaveBeenCalledWith({
+        error: expectedDegradedError,
+      });
+    });
+
+    it("calls onDegraded again when a service's underlying circuit breaks, and then after waiting, the service responds successfully but slowly", async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onDegraded(onDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Wait until the circuit break duration passes, try the endpoint again,
+      // and see that it succeeds, but slowly.
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(2);
+      expect(onDegradedListener).toHaveBeenNthCalledWith(1, {
+        error: expectedDegradedError,
+      });
+      expect(onDegradedListener).toHaveBeenNthCalledWith(2, {});
+    });
+
+    it("calls onDegraded again when a failover service's underlying circuit breaks, and then after waiting, the primary responds successfully but slowly", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onDegraded(onDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the second endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the second endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      // Hit the first endpoint again, and see that it succeeds, but slowly
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(2);
+      expect(onDegradedListener).toHaveBeenNthCalledWith(1, {
+        error: expectedDegradedError,
+      });
+      expect(onDegradedListener).toHaveBeenNthCalledWith(2, {});
+    });
+
+    it('calls onServiceDegraded each time a service continually runs out of retries (but before its circuit breaks)', async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onServiceDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceDegraded(onServiceDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+
+      expect(onServiceDegradedListener).toHaveBeenCalledTimes(2);
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+        error: expectedDegradedError,
+      });
+    });
+
+    it('calls onServiceDegraded each time a service continually responds slowly', async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(2)
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onServiceDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceDegraded(onServiceDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      await rpcServiceChain.request(jsonRpcRequest);
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onServiceDegradedListener).toHaveBeenCalledTimes(2);
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+      });
+    });
+
+    it('calls onServiceDegraded each time a service runs out of retries and then responds successfully but slowly, or vice versa', async () => {
+      const endpointUrl = 'https://some.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(5)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(5)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onServiceDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceDegraded(onServiceDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Try the endpoint again, and see that it succeeds.
+      await rpcServiceChain.request(jsonRpcRequest);
+      // Retry the endpoint again until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+
+      expect(onServiceDegradedListener).toHaveBeenCalledTimes(3);
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(3, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+        error: expectedDegradedError,
+      });
+    });
+
+    it("calls onServiceDegraded again when the primary service's circuit breaks and its failover responds successfully but slowly", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onBreakListener = jest.fn();
+      const onServiceDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onBreak(onBreakListener);
+      rpcServiceChain.onServiceDegraded(onServiceDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit, albeit slowly.
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onServiceDegradedListener).toHaveBeenCalledTimes(3);
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${primaryEndpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${primaryEndpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(3, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${secondaryEndpointUrl}/`,
+      });
+    });
+
+    it("calls onServiceDegraded again when a service's underlying circuit breaks, and then after waiting, the service responds successfully but slowly", async () => {
+      const endpointUrl = 'https://first.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onServiceDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceDegraded(onServiceDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Wait until the circuit break duration passes, try the endpoint again,
+      // and see that it succeeds, but slowly.
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onServiceDegradedListener).toHaveBeenCalledTimes(3);
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(3, {
+        primaryEndpointUrl: `${endpointUrl}/`,
+        endpointUrl: `${endpointUrl}/`,
+      });
+    });
+
+    it("calls onServiceDegraded again when a failover service's underlying circuit breaks, and then after waiting, the primary responds successfully but slowly", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      const expectedError = createResourceUnavailableError(503);
+      const expectedDegradedError = new HttpError(503);
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onServiceDegradedListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onServiceDegraded(onServiceDegradedListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the second endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      // Retry the second endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        expectedError,
+      );
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      // Hit the first endpoint again, and see that it succeeds, but slowly
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onServiceDegradedListener).toHaveBeenCalledTimes(5);
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(1, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${primaryEndpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(2, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${primaryEndpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(3, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${secondaryEndpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(4, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${secondaryEndpointUrl}/`,
+        error: expectedDegradedError,
+      });
+      expect(onServiceDegradedListener).toHaveBeenNthCalledWith(5, {
+        primaryEndpointUrl: `${primaryEndpointUrl}/`,
+        endpointUrl: `${primaryEndpointUrl}/`,
+      });
+    });
+
+    it('calls onAvailable only once, even if a service continually responds successfully', async () => {
+      const endpointUrl = 'https://first.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(3)
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onAvailableListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onAvailable(onAvailableListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      await rpcServiceChain.request(jsonRpcRequest);
+      await rpcServiceChain.request(jsonRpcRequest);
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onAvailableListener).toHaveBeenCalledTimes(1);
+      expect(onAvailableListener).toHaveBeenCalledWith({});
+    });
+
+    it("calls onAvailable once, after the primary service's circuit has broken, the request to the failover succeeds", async () => {
+      const primaryEndpointUrl = 'https://first.endpoint';
+      const secondaryEndpointUrl = 'https://second.endpoint';
+      nock(primaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(DEFAULT_MAX_CONSECUTIVE_FAILURES)
+        .reply(503);
+      nock(secondaryEndpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: primaryEndpointUrl,
+        },
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl: secondaryEndpointUrl,
+        },
+      ]);
+      const onAvailableListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onAvailable(onAvailableListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Retry the first endpoint until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        createResourceUnavailableError(503),
+      );
+      // Retry the first endpoint again, until max retries is hit.
+      await expect(rpcServiceChain.request(jsonRpcRequest)).rejects.toThrow(
+        createResourceUnavailableError(503),
+      );
+      // Retry the first endpoint for a third time, until max retries is hit.
+      // The circuit will break on the last time, and the second endpoint will
+      // be hit.
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      expect(onAvailableListener).toHaveBeenCalledTimes(1);
+      expect(onAvailableListener).toHaveBeenNthCalledWith(1, {});
+    });
+
+    it('calls onAvailable when a service becomes degraded by responding slowly, and then recovers', async () => {
+      const endpointUrl = 'https://first.endpoint';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const rpcServiceChain = new RpcServiceChain([
+        {
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+          endpointUrl,
+        },
+      ]);
+      const onDegradedListener = jest.fn();
+      const onAvailableListener = jest.fn();
+      rpcServiceChain.onServiceRetry(() => {
+        clock.next();
+      });
+      rpcServiceChain.onDegraded(onDegradedListener);
+      rpcServiceChain.onAvailable(onAvailableListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      await rpcServiceChain.request(jsonRpcRequest);
+      await rpcServiceChain.request(jsonRpcRequest);
+
+      // Verify degradation occurred after the first (slow) request
+      expect(onDegradedListener).toHaveBeenCalledTimes(1);
+      expect(onDegradedListener).toHaveBeenCalledWith({});
+
+      // Verify recovery occurred after the second (fast) request
+      expect(onAvailableListener).toHaveBeenCalledTimes(1);
+      expect(onAvailableListener).toHaveBeenCalledWith({});
+
+      // Verify onDegraded was called before onAvailable (degradation then recovery)
+      expect(onDegradedListener.mock.invocationCallOrder[0]).toBeLessThan(
+        onAvailableListener.mock.invocationCallOrder[0],
+      );
+    });
+  });
+});
+
+/**
+ * Creates a "resource unavailable" RPC error for testing.
+ *
+ * @param httpStatus - The HTTP status that the error represents.
+ * @returns The RPC error.
+ */
+function createResourceUnavailableError(httpStatus: number): Error {
+  return expect.objectContaining({
+    code: errorCodes.rpc.resourceUnavailable,
+    message: 'RPC endpoint not found or unavailable.',
+    data: {
+      httpStatus,
+    },
+  });
+}
diff --git a/src/rpc-service/rpc-service-chain.ts b/src/rpc-service/rpc-service-chain.ts
new file mode 100644
index 0000000000000000000000000000000000000000..77e2e20e4c27605dafeaecb7b2b945573308f4d9
--- /dev/null
+++ b/src/rpc-service/rpc-service-chain.ts
@@ -0,0 +1,481 @@
+import {
+  CircuitState,
+  CockatielEventEmitter,
+} from '@metamask/controller-utils';
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+import { IDisposable } from 'cockatiel';
+
+import { RpcService } from './rpc-service';
+import type { RpcServiceOptions } from './rpc-service';
+import type {
+  CockatielEventToEventListenerWithData,
+  ExcludeCockatielEventData,
+  ExtractCockatielEventData,
+  FetchOptions,
+} from './shared';
+import { projectLogger, createModuleLogger } from '../logger';
+
+const log = createModuleLogger(projectLogger, 'RpcServiceChain');
+
+/**
+ * Statuses that the RPC service chain can be in.
+ */
+const STATUSES = {
+  Available: 'available',
+  Degraded: 'degraded',
+  Unknown: 'unknown',
+  Unavailable: 'unavailable',
+} as const;
+
+/**
+ * Statuses that the RPC service chain can be in.
+ */
+type Status = (typeof STATUSES)[keyof typeof STATUSES];
+
+/**
+ * This class constructs and manages requests to a chain of RpcService objects
+ * which represent RPC endpoints with which to access a particular network. The
+ * first service in the chain is intended to be the primary way of hitting the
+ * network and the remaining services are used as failovers.
+ */
+export class RpcServiceChain {
+  /**
+   * The event emitter for the `onAvailable` event.
+   */
+  readonly #onAvailableEventEmitter: CockatielEventEmitter<
+    ExcludeCockatielEventData<
+      ExtractCockatielEventData<RpcService['onAvailable']>,
+      'endpointUrl'
+    >
+  >;
+
+  /**
+   * The event emitter for the `onBreak` event.
+   */
+  readonly #onBreakEventEmitter: CockatielEventEmitter<
+    ExcludeCockatielEventData<
+      ExtractCockatielEventData<RpcService['onBreak']>,
+      'endpointUrl'
+    >
+  >;
+
+  /**
+   * The event emitter for the `onDegraded` event.
+   */
+  readonly #onDegradedEventEmitter: CockatielEventEmitter<
+    ExcludeCockatielEventData<
+      ExtractCockatielEventData<RpcService['onDegraded']>,
+      'endpointUrl'
+    >
+  >;
+
+  /**
+   * The first RPC service that requests will be sent to.
+   */
+  readonly #primaryService: RpcService;
+
+  /**
+   * The RPC services in the chain.
+   */
+  readonly #services: RpcService[];
+
+  /**
+   * The status of the RPC service chain.
+   */
+  #status: Status;
+
+  /**
+   * Constructs a new RpcServiceChain object.
+   *
+   * @param rpcServiceConfigurations - The options for the RPC services
+   * that you want to construct. Each object in this array is the same as
+   * {@link RpcServiceOptions}.
+   */
+  constructor(
+    rpcServiceConfigurations: [RpcServiceOptions, ...RpcServiceOptions[]],
+  ) {
+    this.#services = rpcServiceConfigurations.map(
+      (rpcServiceConfiguration) => new RpcService(rpcServiceConfiguration),
+    );
+    this.#primaryService = this.#services[0];
+
+    this.#status = STATUSES.Unknown;
+    this.#onBreakEventEmitter = new CockatielEventEmitter<
+      ExcludeCockatielEventData<
+        ExtractCockatielEventData<RpcService['onBreak']>,
+        'endpointUrl'
+      >
+    >();
+
+    this.#onDegradedEventEmitter = new CockatielEventEmitter<
+      ExcludeCockatielEventData<
+        ExtractCockatielEventData<RpcService['onDegraded']>,
+        'endpointUrl'
+      >
+    >();
+    for (const service of this.#services) {
+      service.onDegraded((data) => {
+        if (this.#status !== STATUSES.Degraded) {
+          log('Updating status to "degraded"', data);
+          this.#status = STATUSES.Degraded;
+          const { endpointUrl, ...rest } = data;
+          this.#onDegradedEventEmitter.emit(rest);
+        }
+      });
+    }
+
+    this.#onAvailableEventEmitter = new CockatielEventEmitter<
+      ExcludeCockatielEventData<
+        ExtractCockatielEventData<RpcService['onAvailable']>,
+        'endpointUrl'
+      >
+    >();
+    for (const service of this.#services) {
+      service.onAvailable((data) => {
+        if (this.#status !== STATUSES.Available) {
+          log('Updating status to "available"', data);
+          this.#status = STATUSES.Available;
+          const { endpointUrl, ...rest } = data;
+          this.#onAvailableEventEmitter.emit(rest);
+        }
+      });
+    }
+  }
+
+  /**
+   * Calls the provided callback when any of the RPC services is retried.
+   *
+   * This is mainly useful for tests.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the event listener.
+   */
+  onServiceRetry(
+    listener: CockatielEventToEventListenerWithData<
+      RpcService['onRetry'],
+      { primaryEndpointUrl: string }
+    >,
+  ): { dispose(): void } {
+    const disposables = this.#services.map((service) =>
+      service.onRetry((data) => {
+        listener({
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+
+    return {
+      dispose(): void {
+        disposables.forEach((disposable) => disposable.dispose());
+      },
+    };
+  }
+
+  /**
+   * Calls the provided callback only when the maximum number of failed
+   * consecutive attempts to receive a 2xx response has been reached for all
+   * RPC services in the chain, and all services' underlying circuits have
+   * broken.
+   *
+   * The callback will not be called if a service's circuit breaks but its
+   * failover does not. Use `onServiceBreak` if you'd like a lower level of
+   * granularity.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+  onBreak(
+    listener: (
+      data: ExcludeCockatielEventData<
+        ExtractCockatielEventData<RpcService['onBreak']>,
+        'endpointUrl'
+      >,
+    ) => void,
+  ): IDisposable {
+    return this.#onBreakEventEmitter.addListener(listener);
+  }
+
+  /**
+   * Calls the provided callback each time when, for *any* of the RPC services
+   * in this chain, the maximum number of failed consecutive attempts to receive
+   * a 2xx response has been reached and the underlying circuit has broken. A
+   * more granular version of `onBreak`.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+  onServiceBreak(
+    listener: CockatielEventToEventListenerWithData<
+      RpcService['onBreak'],
+      { primaryEndpointUrl: string }
+    >,
+  ): IDisposable {
+    const disposables = this.#services.map((service) =>
+      service.onBreak((data) => {
+        listener({
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+
+    return {
+      dispose(): void {
+        disposables.forEach((disposable) => disposable.dispose());
+      },
+    };
+  }
+
+  /**
+   * Calls the provided callback if no requests have been initiated yet or
+   * all requests to RPC services in this chain have responded successfully in a
+   * timely fashion, and then one of the two conditions apply:
+   *
+   * 1. When a retriable error is encountered making a request to an RPC
+   * service, and the request is retried until a set maximum is reached.
+   * 2. When a RPC service responds successfully, but the request takes longer
+   * than a set number of seconds to complete.
+   *
+   * Note that the callback will be called even if there are local connectivity
+   * issues which prevent requests from being initiated. This is intentional.
+   *
+   * Also note this callback will only be called if the RPC service chain as a
+   * whole is in a "degraded" state, and will then only be called once (e.g., it
+   * will not be called if a failover service falls into a degraded state, then
+   * the primary comes back online, but it is slow). Use `onServiceDegraded` if
+   * you'd like a lower level of granularity.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+  onDegraded(
+    listener: (
+      data: ExcludeCockatielEventData<
+        ExtractCockatielEventData<RpcService['onDegraded']>,
+        'endpointUrl'
+      >,
+    ) => void,
+  ): IDisposable {
+    return this.#onDegradedEventEmitter.addListener(listener);
+  }
+
+  /**
+   * Calls the provided callback each time one of the two conditions apply:
+   *
+   * 1. When a retriable error is encountered making a request to an RPC
+   * service, and the request is retried until a set maximum is reached.
+   * 2. When a RPC service responds successfully, but the request takes longer
+   * than a set number of seconds to complete.
+   *
+   * Note that the callback will be called even if there are local connectivity
+   * issues which prevent requests from being initiated. This is intentional.
+   *
+   * This is a more granular version of `onDegraded`. The callback will be
+   * called for each slow request to an RPC service. It may also be called again
+   * if a failover service falls into a degraded state, then the primary comes
+   * back online, but it is slow.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+  onServiceDegraded(
+    listener: CockatielEventToEventListenerWithData<
+      RpcService['onDegraded'],
+      { primaryEndpointUrl: string }
+    >,
+  ): IDisposable {
+    const disposables = this.#services.map((service) =>
+      service.onDegraded((data) => {
+        listener({
+          ...data,
+          primaryEndpointUrl: this.#primaryService.endpointUrl.toString(),
+        });
+      }),
+    );
+
+    return {
+      dispose(): void {
+        disposables.forEach((disposable) => disposable.dispose());
+      },
+    };
+  }
+
+  /**
+   * Calls the provided callback in one of the following two conditions:
+   *
+   * 1. The first time that a 2xx request is made to any of the RPC services in
+   * this chain.
+   * 2. When requests to any the failover RPC services in this chain were
+   * failing such that they were degraded or their underyling circuits broke,
+   * but the first request to the primary succeeds again.
+   *
+   * Note this callback will only be called if the RPC service chain as a whole
+   * is in an "available" state.
+   *
+   * @param listener - The callback to be called.
+   * @returns An object with a `dispose` method which can be used to unregister
+   * the callback.
+   */
+  onAvailable(
+    listener: (
+      data: ExcludeCockatielEventData<
+        ExtractCockatielEventData<RpcService['onAvailable']>,
+        'endpointUrl'
+      >,
+    ) => void,
+  ): IDisposable {
+    return this.#onAvailableEventEmitter.addListener(listener);
+  }
+
+  /**
+   * Uses the RPC services in the chain to make a request, using each service
+   * after the first as a fallback to the previous one as necessary.
+   *
+   * This overload is specifically designed for `eth_getBlockByNumber`, which
+   * can return a `result` of `null` despite an expected `Result` being
+   * provided.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws A 401 error if the response status is 401.
+   * @throws A "rate limiting" error if the response HTTP status is 429.
+   * @throws A "resource unavailable" error if the response status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client error (-32100) for any other 4xx status codes.
+   * @throws A "parse" error if the response is not valid JSON.
+   */
+  async request<Params extends JsonRpcParams, Result extends Json>(
+    jsonRpcRequest: Readonly<JsonRpcRequest<Params>> & {
+      method: 'eth_getBlockByNumber';
+    },
+    fetchOptions?: FetchOptions,
+  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>>;
+
+  /**
+   * Uses the RPC services in the chain to make a request, using each service
+   * after the first as a fallback to the previous one as necessary.
+   *
+   * This overload is designed for all RPC methods except for
+   * `eth_getBlockByNumber`, which are expected to return a `result` of the
+   * expected `Result`.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws A 401 error if the response status is 401.
+   * @throws A "rate limiting" error if the response HTTP status is 429.
+   * @throws A "resource unavailable" error if the response status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client error (-32100) for any other 4xx status codes.
+   * @throws A "parse" error if the response is not valid JSON.
+   */
+  async request<Params extends JsonRpcParams, Result extends Json>(
+    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,
+    fetchOptions?: FetchOptions,
+  ): Promise<JsonRpcResponse<Result>>;
+
+  async request<Params extends JsonRpcParams, Result extends Json>(
+    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,
+    fetchOptions: FetchOptions = {},
+  ): Promise<JsonRpcResponse<Result | null>> {
+    // Start with the primary (first) service and switch to failovers as the
+    // need arises. This is a bit confusing, so keep reading for more on how
+    // this works.
+
+    let availableServiceIndex: number | undefined;
+    let response: JsonRpcResponse<Result> | undefined;
+
+    for (const [i, service] of this.#services.entries()) {
+      log(`Trying service #${i + 1}...`);
+      const previousCircuitState = service.getCircuitState();
+
+      try {
+        // Try making the request through the service.
+        response = await service.request<Params, Result>(
+          jsonRpcRequest,
+          fetchOptions,
+        );
+        log('Service successfully received request.');
+        availableServiceIndex = i;
+        break;
+      } catch (error) {
+        // Oops, that didn't work.
+        // Capture this error so that we can handle it later.
+
+        const { lastError } = service;
+        const isCircuitOpen = service.getCircuitState() === CircuitState.Open;
+
+        log('Service failed! error =', error, 'lastError = ', lastError);
+
+        if (isCircuitOpen) {
+          if (i < this.#services.length - 1) {
+            log(
+              "This service's circuit is open. Proceeding to next service...",
+            );
+            continue;
+          }
+
+          if (
+            previousCircuitState !== CircuitState.Open &&
+            this.#status !== STATUSES.Unavailable &&
+            lastError !== undefined
+          ) {
+            // If the service's circuit just broke and it's the last one in the
+            // chain, then trigger the onBreak event. (But if for some reason we
+            // have already done this, then don't do it.)
+            log(
+              'This service\'s circuit just opened and it is the last service. Updating status to "unavailable" and triggering onBreak.',
+            );
+            this.#status = STATUSES.Unavailable;
+            this.#onBreakEventEmitter.emit({
+              error: lastError,
+            });
+          }
+        }
+
+        // The service failed, and we throw whatever the error is. The calling
+        // code can try again if it so desires.
+        log(
+          `${isCircuitOpen ? '' : "This service's circuit is closed. "}Re-throwing error.`,
+        );
+        throw error;
+      }
+    }
+
+    if (response) {
+      // If one of the services is available, reset all of the circuits of the
+      // following services. If we didn't do this and the service became
+      // unavailable in the future, and any of the failovers' circuits were
+      // open (due to previous failures), we would receive a "circuit broken"
+      // error when we attempted to divert traffic to the failovers again.
+      //
+      if (availableServiceIndex !== undefined) {
+        for (const [i, service] of [...this.#services.entries()].slice(
+          availableServiceIndex + 1,
+        )) {
+          log(`Resetting policy for service #${i + 1}.`);
+          service.resetPolicy();
+        }
+      }
+
+      return response;
+    }
+
+    // The only way we can end up here is if there are no services to loop over.
+    // That is not possible due to the types on the constructor, but TypeScript
+    // doesn't know this, so we have to appease it.
+    throw new Error('Nothing to return');
+  }
+}
diff --git a/src/rpc-service/rpc-service-requestable.ts b/src/rpc-service/rpc-service-requestable.ts
new file mode 100644
index 0000000000000000000000000000000000000000..85ff60e176c48b6ea723b0fcfb585bff30449665
--- /dev/null
+++ b/src/rpc-service/rpc-service-requestable.ts
@@ -0,0 +1,93 @@
+import type { ServicePolicy } from '@metamask/controller-utils';
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+
+import type {
+  CockatielEventToEventListenerWithData,
+  ExcludeCockatielEventData,
+  ExtendCockatielEventData,
+  ExtractCockatielEventData,
+  FetchOptions,
+} from './shared';
+
+/**
+ * The interface for a service class responsible for making a request to a
+ * target, whether that is a single RPC endpoint or an RPC endpoint in an RPC
+ * service chain.
+ */
+export type RpcServiceRequestable = {
+  /**
+   * Listens for when the RPC service retries the request.
+   *
+   * @param listener - The callback to be called when the retry occurs.
+   * @returns What {@link ServicePolicy.onRetry} returns.
+   * @see {@link createServicePolicy}
+   */
+  onRetry(
+    listener: CockatielEventToEventListenerWithData<
+      ServicePolicy['onRetry'],
+      { endpointUrl: string }
+    >,
+  ): ReturnType<ServicePolicy['onRetry']>;
+
+  /**
+   * Listens for when the RPC service retries the request too many times in a
+   * row.
+   *
+   * @param listener - The callback to be called when the circuit is broken.
+   * @returns What {@link ServicePolicy.onBreak} returns.
+   * @see {@link createServicePolicy}
+   */
+  onBreak(
+    listener: (
+      data: ExcludeCockatielEventData<
+        ExtendCockatielEventData<
+          ExtractCockatielEventData<ServicePolicy['onBreak']>,
+          { endpointUrl: string }
+        >,
+        'isolated'
+      >,
+    ) => void,
+  ): ReturnType<ServicePolicy['onBreak']>;
+
+  /**
+   * Listens for when the policy underlying this RPC service detects a slow
+   * request.
+   *
+   * @param listener - The callback to be called when the request is slow.
+   * @returns What {@link ServicePolicy.onDegraded} returns.
+   * @see {@link createServicePolicy}
+   */
+  onDegraded(
+    listener: CockatielEventToEventListenerWithData<
+      ServicePolicy['onDegraded'],
+      { endpointUrl: string }
+    >,
+  ): ReturnType<ServicePolicy['onDegraded']>;
+
+  /**
+   * Listens for when the policy underlying this RPC service is available.
+   *
+   * @param listener - The callback to be called when the request is available.
+   * @returns What {@link ServicePolicy.onDegraded} returns.
+   * @see {@link createServicePolicy}
+   */
+  onAvailable(
+    listener: CockatielEventToEventListenerWithData<
+      ServicePolicy['onAvailable'],
+      { endpointUrl: string }
+    >,
+  ): ReturnType<ServicePolicy['onAvailable']>;
+
+  /**
+   * Makes a request to the target.
+   */
+  request<Params extends JsonRpcParams, Result extends Json>(
+    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,
+    fetchOptions?: FetchOptions,
+  ): Promise<JsonRpcResponse<Result | null>>;
+};
diff --git a/src/rpc-service/rpc-service.test.ts b/src/rpc-service/rpc-service.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18edeb6c867e99cd2ec7f1096b4926fb17ea5403
--- /dev/null
+++ b/src/rpc-service/rpc-service.test.ts
@@ -0,0 +1,1877 @@
+import {
+  DEFAULT_CIRCUIT_BREAK_DURATION,
+  DEFAULT_DEGRADED_THRESHOLD,
+  HttpError,
+} from '@metamask/controller-utils';
+import { errorCodes } from '@metamask/rpc-errors';
+import { CircuitState } from 'cockatiel';
+import deepFreeze from 'deep-freeze-strict';
+import nock from 'nock';
+import { FetchError } from 'node-fetch';
+import { useFakeTimers } from 'sinon';
+import type { SinonFakeTimers } from 'sinon';
+
+import {
+  CUSTOM_RPC_ERRORS,
+  DEFAULT_MAX_RETRIES,
+  RpcService,
+} from './rpc-service';
+
+describe('RpcService', () => {
+  let clock: SinonFakeTimers;
+
+  beforeEach(() => {
+    clock = useFakeTimers();
+  });
+
+  afterEach(() => {
+    clock.restore();
+  });
+
+  describe('resetPolicy', () => {
+    it('resets the state of the circuit to "closed"', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(15)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onRetry(() => {
+        clock.next();
+      });
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Get through the first two rounds of retries
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      // The last retry breaks the circuit
+      await ignoreRejection(service.request(jsonRpcRequest));
+      expect(service.getCircuitState()).toBe(CircuitState.Open);
+
+      service.resetPolicy();
+
+      expect(service.getCircuitState()).toBe(CircuitState.Closed);
+    });
+
+    it('allows making a successful request to the service if its circuit has broken', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(15)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onRetry(() => {
+        clock.next();
+      });
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Get through the first two rounds of retries
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      // The last retry breaks the circuit
+      await ignoreRejection(service.request(jsonRpcRequest));
+
+      service.resetPolicy();
+
+      expect(await service.request(jsonRpcRequest)).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+    });
+
+    it('calls onAvailable listeners if the service was executed successfully, its circuit broke, it was reset, and executes successfully again', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(15)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: 'ok',
+        });
+      const onAvailableListener = jest.fn();
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onRetry(() => {
+        clock.next();
+      });
+      service.onAvailable(onAvailableListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+
+      // Make a successful requst
+      await service.request(jsonRpcRequest);
+      expect(onAvailableListener).toHaveBeenCalledTimes(1);
+
+      // Get through the first two rounds of retries
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      // The last retry breaks the circuit
+      await ignoreRejection(service.request(jsonRpcRequest));
+
+      service.resetPolicy();
+
+      // Make another successful requst
+      await service.request(jsonRpcRequest);
+      expect(onAvailableListener).toHaveBeenCalledTimes(2);
+    });
+
+    it('allows making an unsuccessful request to the service if its circuit has broken', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(15)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(500);
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onRetry(() => {
+        clock.next();
+      });
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      // Get through the first two rounds of retries
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      // The last retry breaks the circuit
+      await ignoreRejection(service.request(jsonRpcRequest));
+
+      service.resetPolicy();
+
+      await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+        'RPC endpoint not found or unavailable',
+      );
+    });
+
+    it('does not call onBreak listeners', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .times(15)
+        .reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(500);
+      const onBreakListener = jest.fn();
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onRetry(() => {
+        clock.next();
+      });
+      service.onBreak(onBreakListener);
+
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+
+      // Get through the first two rounds of retries
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      // The last retry breaks the circuit
+      await ignoreRejection(service.request(jsonRpcRequest));
+      expect(onBreakListener).toHaveBeenCalledTimes(1);
+
+      service.resetPolicy();
+      expect(onBreakListener).toHaveBeenCalledTimes(1);
+    });
+  });
+
+  describe('getCircuitState', () => {
+    it('returns the state of the underlying circuit', async () => {
+      const jsonRpcRequest = {
+        id: 1,
+        jsonrpc: '2.0' as const,
+        method: 'eth_chainId',
+        params: [],
+      };
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl).post('/', jsonRpcRequest).times(15).reply(503);
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(500);
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onRetry(() => {
+        clock.next();
+      });
+
+      expect(service.getCircuitState()).toBe(CircuitState.Closed);
+
+      // Retry until we break the circuit
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      await ignoreRejection(service.request(jsonRpcRequest));
+      expect(service.getCircuitState()).toBe(CircuitState.Open);
+
+      clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+      const promise = ignoreRejection(service.request(jsonRpcRequest));
+      expect(service.getCircuitState()).toBe(CircuitState.HalfOpen);
+      await promise;
+      expect(service.getCircuitState()).toBe(CircuitState.Open);
+    });
+  });
+
+  describe('request', () => {
+    // NOTE: Keep this list synced with CONNECTION_ERRORS
+    describe.each([
+      {
+        constructorName: 'TypeError',
+        message: 'network error',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'Failed to fetch',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'NetworkError when attempting to fetch resource.',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'The Internet connection appears to be offline.',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'Load failed',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'Network request failed',
+      },
+      {
+        constructorName: 'FetchError',
+        message: 'request to https://foo.com failed',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'fetch failed',
+      },
+      {
+        constructorName: 'TypeError',
+        message: 'terminated',
+      },
+    ])(
+      `if making the request throws the "$message" error`,
+      ({ constructorName, message }) => {
+        let error;
+        switch (constructorName) {
+          case 'FetchError':
+            error = new FetchError(message, 'system');
+            break;
+          case 'TypeError':
+            error = new TypeError(message);
+            break;
+          default:
+            throw new Error(`Unknown constructor ${constructorName}`);
+        }
+        testsForRetriableFetchErrors({
+          getClock: () => clock,
+          producedError: error,
+          expectedError: error,
+        });
+      },
+    );
+
+    describe.each(['ETIMEDOUT', 'ECONNRESET'])(
+      'if making the request throws a "%s" error',
+      (errorCode) => {
+        const error = new Error('timed out');
+        // @ts-expect-error `code` does not exist on the Error type, but is
+        // still used by Node.
+        error.code = errorCode;
+
+        testsForRetriableFetchErrors({
+          getClock: () => clock,
+          producedError: error,
+          expectedError: error,
+        });
+      },
+    );
+
+    describe('if the endpoint URL was not mocked via Nock', () => {
+      testsForNonRetriableErrors({
+        expectedError: 'Nock: Disallowed net connect',
+      });
+    });
+
+    describe('if the endpoint URL was mocked via Nock, but not the RPC method', () => {
+      testsForNonRetriableErrors({
+        beforeCreateService: ({ endpointUrl }) => {
+          nock(endpointUrl)
+            .post('/', {
+              id: 1,
+              jsonrpc: '2.0',
+              method: 'eth_incorrectMethod',
+              params: [],
+            })
+            .reply(500);
+        },
+        rpcMethod: 'eth_chainId',
+        expectedError: 'Nock: No match for request',
+      });
+    });
+
+    describe('if making the request throws an unknown error', () => {
+      testsForNonRetriableErrors({
+        createService: ({ endpointUrl, expectedError }) => {
+          return new RpcService({
+            fetch: (): never => {
+              // This error could be anything.
+              // eslint-disable-next-line @typescript-eslint/only-throw-error
+              throw expectedError;
+            },
+            btoa,
+            endpointUrl,
+            isOffline: (): boolean => false,
+          });
+        },
+        expectedError: new Error('oops'),
+      });
+    });
+
+    describe.each([502, 503, 504])(
+      'if the endpoint has a %d response',
+      (httpStatus) => {
+        testsForRetriableResponses({
+          getClock: () => clock,
+          httpStatus,
+          expectedError: expect.objectContaining({
+            code: errorCodes.rpc.resourceUnavailable,
+            message: 'RPC endpoint not found or unavailable.',
+            data: {
+              httpStatus,
+            },
+          }),
+          expectedOnBreakError: new HttpError(httpStatus),
+        });
+      },
+    );
+
+    describe('if the endpoint has a 401 response', () => {
+      testsForNonRetriableErrors({
+        beforeCreateService: ({ endpointUrl, rpcMethod }) => {
+          nock(endpointUrl)
+            .post('/', {
+              id: 1,
+              jsonrpc: '2.0',
+              method: rpcMethod,
+              params: [],
+            })
+            .reply(401);
+        },
+        expectedError: expect.objectContaining({
+          code: CUSTOM_RPC_ERRORS.unauthorized,
+          message: 'Unauthorized.',
+          data: {
+            httpStatus: 401,
+          },
+        }),
+      });
+    });
+
+    describe.each([402, 404, 500, 501, 505, 506, 507, 508, 510, 511])(
+      'if the endpoint has a %d response',
+      (httpStatus) => {
+        testsForNonRetriableErrors({
+          beforeCreateService: ({ endpointUrl, rpcMethod }) => {
+            nock(endpointUrl)
+              .post('/', {
+                id: 1,
+                jsonrpc: '2.0',
+                method: rpcMethod,
+                params: [],
+              })
+              .reply(httpStatus);
+          },
+          expectedError: expect.objectContaining({
+            code: errorCodes.rpc.resourceUnavailable,
+            message: 'RPC endpoint not found or unavailable.',
+            data: {
+              httpStatus,
+            },
+          }),
+        });
+      },
+    );
+
+    describe('if the endpoint has a 429 response', () => {
+      const httpStatus = 429;
+
+      testsForNonRetriableErrors({
+        beforeCreateService: ({ endpointUrl, rpcMethod }) => {
+          nock(endpointUrl)
+            .post('/', {
+              id: 1,
+              jsonrpc: '2.0',
+              method: rpcMethod,
+              params: [],
+            })
+            .reply(httpStatus);
+        },
+        expectedError: expect.objectContaining({
+          code: errorCodes.rpc.limitExceeded,
+          message: 'Request is being rate limited.',
+          data: {
+            httpStatus,
+          },
+        }),
+      });
+    });
+
+    describe('when the endpoint has a 4xx response that is not 401, 402, 404, or 429', () => {
+      const httpStatus = 422;
+
+      testsForNonRetriableErrors({
+        beforeCreateService: ({ endpointUrl, rpcMethod }) => {
+          nock(endpointUrl)
+            .post('/', {
+              id: 1,
+              jsonrpc: '2.0',
+              method: rpcMethod,
+              params: [],
+            })
+            .reply(httpStatus);
+        },
+        expectedError: expect.objectContaining({
+          code: CUSTOM_RPC_ERRORS.httpClientError,
+          message: 'RPC endpoint returned HTTP client error.',
+          data: {
+            httpStatus,
+          },
+        }),
+      });
+    });
+
+    describe.each([
+      'invalid JSON',
+      '{"foo": "ba',
+      '<p>Clearly an HTML response</p>',
+    ])(
+      'if the endpoint consistently responds with invalid JSON %o',
+      (responseBody) => {
+        testsForRetriableResponses({
+          getClock: () => clock,
+          httpStatus: 200,
+          responseBody,
+          expectedError: expect.objectContaining({
+            code: -32700,
+            message: 'RPC endpoint did not return JSON.',
+          }),
+          expectedOnBreakError: expect.objectContaining({
+            message: expect.stringContaining('invalid json'),
+          }),
+        });
+      },
+    );
+
+    describe('when offline', () => {
+      it('does not retry when offline, only makes one fetch call', async () => {
+        const expectedError = new TypeError('Failed to fetch');
+        const mockFetch = jest.fn(() => {
+          throw expectedError;
+        });
+        const service = new RpcService({
+          fetch: mockFetch,
+          btoa,
+          endpointUrl: 'https://rpc.example.chain',
+          isOffline: (): boolean => true,
+        });
+        service.onRetry(() => {
+          clock.next();
+        });
+
+        const jsonRpcRequest = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: 'eth_chainId',
+          params: [],
+        };
+        await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+        // When offline, no retries should happen, so only 1 fetch call
+        expect(mockFetch).toHaveBeenCalledTimes(1);
+      });
+
+      it('does not call onDegraded when offline', async () => {
+        const expectedError = new TypeError('Failed to fetch');
+        const mockFetch = jest.fn(() => {
+          throw expectedError;
+        });
+        const endpointUrl = 'https://rpc.example.chain';
+        const onDegradedListener = jest.fn();
+        const service = new RpcService({
+          fetch: mockFetch,
+          btoa,
+          endpointUrl,
+          isOffline: (): boolean => true,
+        });
+        service.onRetry(() => {
+          clock.next();
+        });
+        service.onDegraded(onDegradedListener);
+
+        const jsonRpcRequest = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: 'eth_chainId',
+          params: [],
+        };
+        await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+
+        // When offline, retries don't happen, so onDegraded should not be called
+        expect(onDegradedListener).not.toHaveBeenCalled();
+      });
+
+      it('does not call onBreak when offline', async () => {
+        const expectedError = new TypeError('Failed to fetch');
+        const mockFetch = jest.fn(() => {
+          throw expectedError;
+        });
+        const endpointUrl = 'https://rpc.example.chain';
+        const onBreakListener = jest.fn();
+        const service = new RpcService({
+          fetch: mockFetch,
+          btoa,
+          endpointUrl,
+          isOffline: (): boolean => true,
+        });
+        service.onRetry(() => {
+          clock.next();
+        });
+        service.onBreak(onBreakListener);
+
+        const jsonRpcRequest = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: 'eth_chainId',
+          params: [],
+        };
+        // Make multiple requests - even though we'd normally break the circuit,
+        // when offline, no retries happen so circuit won't break
+        await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+        await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+        await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+          expectedError,
+        );
+
+        // When offline, retries don't happen, so circuit won't break and onBreak
+        // should not be called
+        expect(onBreakListener).not.toHaveBeenCalled();
+      });
+    });
+
+    it('removes non-JSON-RPC-compliant properties from the request body before sending it to the endpoint', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+
+      // @ts-expect-error Intentionally passing bad input.
+      const response = await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+        some: 'extra',
+        properties: 'here',
+      });
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      });
+    });
+
+    it('extracts a username and password from the URL to the Authorization header', async () => {
+      const scope = nock('https://rpc.example.chain', {
+        reqheaders: {
+          Authorization: 'Basic dXNlcm5hbWU6cGFzc3dvcmQ=',
+        },
+      })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const promiseForRequestUrl = new Promise<string>((resolve) => {
+        scope.on('request', (request) => {
+          resolve(request.options.href);
+        });
+      });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl: 'https://username:password@rpc.example.chain',
+        isOffline: (): boolean => false,
+      });
+
+      const response = await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      });
+      expect(await promiseForRequestUrl).toBe('https://rpc.example.chain/');
+    });
+
+    it('makes the request with Accept and Content-Type headers by default', async () => {
+      const scope = nock('https://rpc.example.chain', {
+        reqheaders: {
+          Accept: 'application/json',
+          'Content-Type': 'application/json',
+        },
+      })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl: 'https://username:password@rpc.example.chain',
+        isOffline: (): boolean => false,
+      });
+
+      await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(scope.isDone()).toBe(true);
+    });
+
+    it('mixes the given request options into the default request options', async () => {
+      const scope = nock('https://rpc.example.chain', {
+        reqheaders: {
+          Accept: 'application/json',
+          'Content-Type': 'application/json',
+          'X-Foo': 'Bar',
+        },
+      })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl: 'https://username:password@rpc.example.chain',
+        isOffline: (): boolean => false,
+      });
+
+      await service.request(
+        {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        },
+        {
+          headers: {
+            'X-Foo': 'Bar',
+          },
+        },
+      );
+
+      expect(scope.isDone()).toBe(true);
+    });
+
+    it('returns the JSON-decoded response if the request succeeds', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_getBlockByNumber',
+          params: ['0x68b3', false],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: {
+            number: '0x68b3',
+            hash: '0xd5f1812548be429cbdc6376b29611fc49e06f1359758c4ceaaa3b393e2239f9c',
+            nonce: '0x378da40ff335b070',
+            gasLimit: '0x47e7c4',
+            gasUsed: '0x37993',
+            timestamp: '0x5835c54d',
+            transactions: [
+              '0xa0807e117a8dd124ab949f460f08c36c72b710188f01609595223b325e58e0fc',
+              '0xeae6d797af50cb62a596ec3939114d63967c374fa57de9bc0f4e2b576ed6639d',
+            ],
+            baseFeePerGas: '0x7',
+          },
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+
+      const response = await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_getBlockByNumber',
+        params: ['0x68b3', false],
+      });
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: {
+          number: '0x68b3',
+          hash: '0xd5f1812548be429cbdc6376b29611fc49e06f1359758c4ceaaa3b393e2239f9c',
+          nonce: '0x378da40ff335b070',
+          gasLimit: '0x47e7c4',
+          gasUsed: '0x37993',
+          timestamp: '0x5835c54d',
+          transactions: [
+            '0xa0807e117a8dd124ab949f460f08c36c72b710188f01609595223b325e58e0fc',
+            '0xeae6d797af50cb62a596ec3939114d63967c374fa57de9bc0f4e2b576ed6639d',
+          ],
+          baseFeePerGas: '0x7',
+        },
+      });
+    });
+
+    it('handles deeply frozen JSON-RPC requests', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_blockNumber',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          result: '0x1',
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+
+      const response = await service.request(
+        deepFreeze({
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_blockNumber',
+          params: [],
+        }),
+      );
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      });
+    });
+
+    it('does not throw if the endpoint returns an unsuccessful JSON-RPC response', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, {
+          id: 1,
+          jsonrpc: '2.0',
+          error: {
+            code: -32000,
+            message: 'oops',
+          },
+        });
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+
+      const response = await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(response).toStrictEqual({
+        id: 1,
+        jsonrpc: '2.0',
+        error: {
+          code: -32000,
+          message: 'oops',
+        },
+      });
+    });
+
+    it('calls the onDegraded callback if the endpoint takes more than 5 seconds to respond', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const onDegradedListener = jest.fn();
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onDegraded(onDegradedListener);
+
+      await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(onDegradedListener).toHaveBeenCalledTimes(1);
+      expect(onDegradedListener).toHaveBeenCalledWith({
+        endpointUrl: `${endpointUrl}/`,
+      });
+    });
+
+    it('calls the onAvailable callback the first time a successful request occurs', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const onAvailableListener = jest.fn();
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onAvailable(onAvailableListener);
+
+      await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(onAvailableListener).toHaveBeenCalledTimes(1);
+      expect(onAvailableListener).toHaveBeenCalledWith({
+        endpointUrl: `${endpointUrl}/`,
+      });
+    });
+
+    it('calls the onAvailable callback if the endpoint takes more than 5 seconds to respond and then speeds up again', async () => {
+      const endpointUrl = 'https://rpc.example.chain';
+      nock(endpointUrl)
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        })
+        .post('/', {
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'eth_chainId',
+          params: [],
+        })
+        .reply(200, () => {
+          return {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          };
+        });
+      const onAvailableListener = jest.fn();
+      const service = new RpcService({
+        fetch,
+        btoa,
+        endpointUrl,
+        isOffline: (): boolean => false,
+      });
+      service.onAvailable(onAvailableListener);
+
+      await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+      await service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      });
+
+      expect(onAvailableListener).toHaveBeenCalledTimes(1);
+      expect(onAvailableListener).toHaveBeenCalledWith({
+        endpointUrl: `${endpointUrl}/`,
+      });
+    });
+  });
+});
+
+/**
+ * Some tests involve a rejected promise that is not necessarily the focus of
+ * the test. In these cases we don't want to ignore the error in case the
+ * promise _isn't_ rejected, but we don't want to highlight the assertion,
+ * either.
+ *
+ * @param promiseOrFn - A promise that rejects, or a function that returns a
+ * promise that rejects.
+ */
+async function ignoreRejection<Type>(
+  promiseOrFn: Promise<Type> | (() => Type | Promise<Type>),
+): Promise<void> {
+  await expect(promiseOrFn).rejects.toThrow(expect.any(Error));
+}
+
+/**
+ * These are tests that exercise logic for cases in which the request cannot be
+ * made because some kind of error is thrown, and the request is not retried.
+ *
+ * @param args - The arguments.
+ * @param args.beforeCreateService - A function that is run before the service
+ * is created.
+ * @param args.createService - A function that is run to create the service.
+ * @param args.endpointUrl - The URL that is hit.
+ * @param args.rpcMethod - The RPC method that is used. (Defaults to
+ * `eth_chainId`).
+ * @param args.expectedError - The error that a call to the service's `request`
+ * method is expected to produce.
+ */
+function testsForNonRetriableErrors({
+  beforeCreateService = (): void => {
+    // do nothing
+  },
+  createService = (args): RpcService => {
+    return new RpcService({
+      fetch,
+      btoa,
+      endpointUrl: args.endpointUrl,
+      isOffline: (): boolean => false,
+    });
+  },
+  endpointUrl = 'https://rpc.example.chain',
+  rpcMethod = `eth_chainId`,
+  expectedError,
+}: {
+  beforeCreateService?: (args: {
+    endpointUrl: string;
+    rpcMethod: string;
+  }) => void;
+  createService?: (args: {
+    endpointUrl: string;
+    expectedError: string | RegExp | Error | jest.Constructable | undefined;
+  }) => RpcService;
+  endpointUrl?: string;
+  rpcMethod?: string;
+  expectedError: string | RegExp | Error | jest.Constructable | undefined;
+}): void {
+  /* eslint-disable jest/require-top-level-describe */
+
+  it('re-throws the error without retrying the request', async () => {
+    beforeCreateService({ endpointUrl, rpcMethod });
+    const service = createService({ endpointUrl, expectedError });
+
+    const promise = service.request({
+      id: 1,
+      jsonrpc: '2.0',
+      method: rpcMethod,
+      params: [],
+    });
+
+    await expect(promise).rejects.toThrow(expectedError);
+  });
+
+  it('does not call onRetry', async () => {
+    beforeCreateService({ endpointUrl, rpcMethod });
+    const onRetryListener = jest.fn();
+    const service = createService({ endpointUrl, expectedError });
+    service.onRetry(onRetryListener);
+
+    await ignoreRejection(
+      service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      }),
+    );
+    expect(onRetryListener).not.toHaveBeenCalled();
+  });
+
+  it('does not call onBreak', async () => {
+    beforeCreateService({ endpointUrl, rpcMethod });
+    const onBreakListener = jest.fn();
+    const service = createService({ endpointUrl, expectedError });
+    service.onBreak(onBreakListener);
+
+    await ignoreRejection(
+      service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      }),
+    );
+    expect(onBreakListener).not.toHaveBeenCalled();
+  });
+
+  it('does not call onDegraded', async () => {
+    beforeCreateService({ endpointUrl, rpcMethod });
+    const onDegradedListener = jest.fn();
+    const service = createService({ endpointUrl, expectedError });
+    service.onDegraded(onDegradedListener);
+
+    await ignoreRejection(
+      service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      }),
+    );
+    expect(onDegradedListener).not.toHaveBeenCalled();
+  });
+
+  it('does not call onAvailable', async () => {
+    beforeCreateService({ endpointUrl, rpcMethod });
+    const onAvailableListener = jest.fn();
+    const service = createService({ endpointUrl, expectedError });
+    service.onAvailable(onAvailableListener);
+
+    await ignoreRejection(
+      service.request({
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      }),
+    );
+    expect(onAvailableListener).not.toHaveBeenCalled();
+  });
+
+  /* eslint-enable jest/require-top-level-describe */
+}
+
+/**
+ * These are tests that exercise logic for cases in which the request cannot be
+ * made because the `fetch` calls throws a specific error.
+ *
+ * @param args - The arguments
+ * @param args.getClock - A function that returns the Sinon clock, set in
+ * `beforeEach`.
+ * @param args.producedError - The error produced when `fetch` is called.
+ * @param args.expectedError - The error that a call to the service's `request`
+ * method is expected to produce.
+ */
+function testsForRetriableFetchErrors({
+  getClock,
+  producedError,
+  expectedError,
+}: {
+  getClock: () => SinonFakeTimers;
+  producedError: Error;
+  expectedError: string | jest.Constructable | RegExp | Error;
+}): void {
+  // This function is designed to be used inside of a describe, so this won't be
+  // a problem in practice.
+  /* eslint-disable jest/require-top-level-describe */
+
+  it('retries a constantly failing request up to 4 more times before re-throwing the error, if `request` is only called once', async () => {
+    const clock = getClock();
+    const mockFetch = jest.fn(() => {
+      throw producedError;
+    });
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl: 'https://rpc.example.chain',
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+    expect(mockFetch).toHaveBeenCalledTimes(5);
+  });
+
+  it('calls the onDegraded callback once for each retry round', async () => {
+    const clock = getClock();
+    const mockFetch = jest.fn(() => {
+      throw producedError;
+    });
+    const endpointUrl = 'https://rpc.example.chain';
+    const onDegradedListener = jest.fn();
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    service.onDegraded(onDegradedListener);
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    expect(onDegradedListener).toHaveBeenCalledTimes(2);
+    expect(onDegradedListener).toHaveBeenCalledWith({
+      endpointUrl: `${endpointUrl}/`,
+      error: expectedError,
+    });
+  });
+
+  it('still re-throws the error even after the circuit breaks', async () => {
+    const clock = getClock();
+    const mockFetch = jest.fn(() => {
+      throw producedError;
+    });
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl: 'https://rpc.example.chain',
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+  });
+
+  it('calls the onBreak callback once after the circuit breaks', async () => {
+    const clock = getClock();
+    const mockFetch = jest.fn(() => {
+      throw producedError;
+    });
+    const endpointUrl = 'https://rpc.example.chain';
+    const onBreakListener = jest.fn();
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+    service.onBreak(onBreakListener);
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    expect(onBreakListener).toHaveBeenCalledTimes(1);
+    expect(onBreakListener).toHaveBeenCalledWith({
+      error: expectedError,
+      endpointUrl: `${endpointUrl}/`,
+    });
+  });
+
+  it('throws an error that includes the number of minutes until the circuit is re-closed if a request is attempted while the circuit is open', async () => {
+    const clock = getClock();
+    const mockFetch = jest.fn(() => {
+      throw producedError;
+    });
+    const endpointUrl = 'https://rpc.example.chain';
+    const logger = { warn: jest.fn() };
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl,
+      logger,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    // Get through the first two rounds of retries
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    // Advance a minute to test that the message updates dynamically as time passes
+    clock.tick(60000);
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expect.objectContaining({
+        code: errorCodes.rpc.resourceUnavailable,
+        message:
+          'RPC endpoint returned too many errors, retrying in 29 minutes. Consider using a different RPC endpoint.',
+      }),
+    );
+  });
+
+  it('logs the original CircuitBreakError if a request is attempted while the circuit is open', async () => {
+    const clock = getClock();
+    const mockFetch = jest.fn(() => {
+      throw producedError;
+    });
+    const endpointUrl = 'https://rpc.example.chain';
+    const logger = { warn: jest.fn() };
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl,
+      logger,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    expect(logger.warn).toHaveBeenCalledWith(
+      expect.objectContaining({
+        message: 'Execution prevented because the circuit breaker is open',
+      }),
+    );
+  });
+
+  it('calls the onAvailable callback if the endpoint becomes degraded via errors and then recovers', async () => {
+    const clock = getClock();
+    let invocationIndex = -1;
+    const mockFetch = jest.fn(async () => {
+      invocationIndex += 1;
+      if (invocationIndex === DEFAULT_MAX_RETRIES + 1) {
+        // Only used for testing.
+        // eslint-disable-next-line no-restricted-globals
+        return new Response(
+          JSON.stringify({
+            id: 1,
+            jsonrpc: '2.0',
+            result: { some: 'data' },
+          }),
+        );
+      }
+      throw producedError;
+    });
+    const endpointUrl = 'https://rpc.example.chain';
+    const onAvailableListener = jest.fn();
+    const service = new RpcService({
+      fetch: mockFetch,
+      btoa,
+      endpointUrl,
+      isOffline: (): boolean => false,
+    });
+    service.onAvailable(onAvailableListener);
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    // Cause the retry policy to give up
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await service.request(jsonRpcRequest);
+
+    expect(onAvailableListener).toHaveBeenCalledTimes(1);
+  });
+
+  /* eslint-enable jest/require-top-level-describe */
+}
+
+/**
+ * These are tests that exercise logic for cases in which the request returns a
+ * response that is retriable.
+ *
+ * @param args - The arguments
+ * @param args.getClock - A function that returns the Sinon clock, set in
+ * `beforeEach`.
+ * @param args.httpStatus - The HTTP status code that the response will have.
+ * @param args.responseBody - The body that the response will have.
+ * @param args.expectedError - The error that a call to the service's `request`
+ * method is expected to produce.
+ * @param args.expectedOnBreakError - The error expected by the `onBreak` handler when there is a
+ * circuit break. Defaults to `expectedError` if not provided.
+ */
+function testsForRetriableResponses({
+  getClock,
+  httpStatus,
+  responseBody = '',
+  expectedError,
+  expectedOnBreakError = expectedError,
+}: {
+  getClock: () => SinonFakeTimers;
+  httpStatus: number;
+  responseBody?: string;
+  expectedError: string | jest.Constructable | RegExp | Error;
+  expectedOnBreakError?: string | jest.Constructable | RegExp | Error;
+}): void {
+  // This function is designed to be used inside of a describe, so this won't be
+  // a problem in practice.
+  /* eslint-disable jest/require-top-level-describe,jest/no-identical-title */
+
+  it('retries a constantly failing request up to 4 more times before re-throwing the error, if `request` is only called once', async () => {
+    const clock = getClock();
+    const scope = nock('https://rpc.example.chain')
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(5)
+      .reply(httpStatus, responseBody);
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl: 'https://rpc.example.chain',
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+    expect(scope.isDone()).toBe(true);
+  });
+
+  it('still re-throws the error even after the circuit breaks', async () => {
+    const clock = getClock();
+    nock('https://rpc.example.chain')
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(15)
+      .reply(httpStatus, responseBody);
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl: 'https://rpc.example.chain',
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+  });
+
+  it('calls the onBreak callback once after the circuit breaks', async () => {
+    const clock = getClock();
+    const endpointUrl = 'https://rpc.example.chain';
+    nock(endpointUrl)
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(15)
+      .reply(httpStatus, responseBody);
+    const onBreakListener = jest.fn();
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+    service.onBreak(onBreakListener);
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    expect(onBreakListener).toHaveBeenCalledTimes(1);
+    expect(onBreakListener).toHaveBeenCalledWith({
+      error: expectedOnBreakError,
+      endpointUrl: `${endpointUrl}/`,
+    });
+  });
+
+  it('throws an error that includes the number of minutes until the circuit is re-closed if a request is attempted while the circuit is open', async () => {
+    const clock = getClock();
+    const endpointUrl = 'https://rpc.example.chain';
+    nock(endpointUrl)
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(15)
+      .reply(httpStatus, responseBody);
+    const onBreakListener = jest.fn();
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+    service.onBreak(onBreakListener);
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    // Get through the first two rounds of retries
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    // The last retry breaks the circuit
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    // Advance a minute to test that the message updates dynamically as time passes
+    clock.tick(60000);
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expect.objectContaining({
+        code: errorCodes.rpc.resourceUnavailable,
+        message:
+          'RPC endpoint returned too many errors, retrying in 29 minutes. Consider using a different RPC endpoint.',
+      }),
+    );
+  });
+
+  it('logs the original CircuitBreakError if a request is attempted while the circuit is open', async () => {
+    const clock = getClock();
+    const endpointUrl = 'https://rpc.example.chain';
+    nock(endpointUrl)
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(15)
+      .reply(httpStatus, responseBody);
+    const logger = { warn: jest.fn() };
+    const onBreakListener = jest.fn();
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl,
+      logger,
+      isOffline: (): boolean => false,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+    service.onBreak(onBreakListener);
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+    await ignoreRejection(service.request(jsonRpcRequest));
+
+    expect(logger.warn).toHaveBeenCalledWith(
+      expect.objectContaining({
+        message: 'Execution prevented because the circuit breaker is open',
+      }),
+    );
+  });
+
+  it('does not retry when offline, only makes one request', async () => {
+    const clock = getClock();
+    const scope = nock('https://rpc.example.chain')
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(1)
+      .reply(httpStatus, responseBody);
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl: 'https://rpc.example.chain',
+      isOffline: (): boolean => true,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+    // When offline, no retries should happen, so only 1 request
+    expect(scope.isDone()).toBe(true);
+  });
+
+  it('does not call onBreak when offline', async () => {
+    const clock = getClock();
+    const scope = nock('https://rpc.example.chain')
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: 'eth_chainId',
+        params: [],
+      })
+      .times(3)
+      .reply(httpStatus, responseBody);
+    const endpointUrl = 'https://rpc.example.chain';
+    const onBreakListener = jest.fn();
+    const service = new RpcService({
+      fetch,
+      btoa,
+      endpointUrl,
+      isOffline: (): boolean => true,
+    });
+    service.onRetry(() => {
+      clock.next();
+    });
+    service.onBreak(onBreakListener);
+
+    const jsonRpcRequest = {
+      id: 1,
+      jsonrpc: '2.0' as const,
+      method: 'eth_chainId',
+      params: [],
+    };
+    // Make multiple requests - even though we'd normally break the circuit,
+    // when offline, no retries happen so circuit won't break
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+    await expect(service.request(jsonRpcRequest)).rejects.toThrow(
+      expectedError,
+    );
+
+    // When offline, retries don't happen, so circuit won't break and onBreak
+    // should not be called
+    expect(onBreakListener).not.toHaveBeenCalled();
+    expect(scope.isDone()).toBe(true);
+  });
+
+  /* eslint-enable jest/require-top-level-describe,jest/no-identical-title */
+}
diff --git a/src/rpc-service/rpc-service.ts b/src/rpc-service/rpc-service.ts
new file mode 100644
index 0000000000000000000000000000000000000000..32e244945265ad797ad5b24af209d626f090c985
--- /dev/null
+++ b/src/rpc-service/rpc-service.ts
@@ -0,0 +1,644 @@
+import type {
+  CreateServicePolicyOptions,
+  ServicePolicy,
+} from '@metamask/controller-utils';
+import {
+  BrokenCircuitError,
+  HttpError,
+  createServicePolicy,
+  handleWhen,
+} from '@metamask/controller-utils';
+import { JsonRpcError, rpcErrors } from '@metamask/rpc-errors';
+import { Duration, getErrorMessage, hasProperty } from '@metamask/utils';
+import type {
+  Json,
+  JsonRpcParams,
+  JsonRpcRequest,
+  JsonRpcResponse,
+} from '@metamask/utils';
+import { CircuitState, IDisposable } from 'cockatiel';
+import deepmerge from 'deepmerge';
+import type { Logger } from 'loglevel';
+
+import type { AbstractRpcService } from './abstract-rpc-service';
+import type { FetchOptions } from './shared';
+import { projectLogger, createModuleLogger } from '../logger';
+
+/**
+ * Options for the RpcService constructor.
+ */
+export type RpcServiceOptions = {
+  /**
+   * A function that can be used to convert a binary string into a
+   * base64-encoded ASCII string. Used to encode authorization credentials.
+   */
+  btoa: typeof btoa;
+  /**
+   * The URL of the RPC endpoint to hit.
+   */
+  endpointUrl: URL | string;
+  /**
+   * A function that can be used to make an HTTP request. If your JavaScript
+   * environment supports `fetch` natively, you'll probably want to pass that;
+   * otherwise you can pass an equivalent (such as `fetch` via `node-fetch`).
+   */
+  fetch: typeof fetch;
+  /**
+   * A common set of options that will be used to make every request. Can be
+   * overridden on the request level (e.g. to add headers).
+   */
+  fetchOptions?: FetchOptions;
+  /**
+   * A `loglevel` logger.
+   */
+  logger?: Pick<Logger, 'warn'>;
+  /**
+   * Options to pass to `createServicePolicy`. Note that `retryFilterPolicy` is
+   * not accepted, as it is overwritten. See {@link createServicePolicy}.
+   */
+  policyOptions?: Omit<CreateServicePolicyOptions, 'retryFilterPolicy'>;
+  /**
+   * A function that checks if the user is currently offline. If it returns true,
+   * connection errors will not be retried, preventing degraded and break
+   * callbacks from being triggered.
+   */
+  isOffline: () => boolean;
+};
+
+const log = createModuleLogger(projectLogger, 'RpcService');
+
+/**
+ * The maximum number of times that a failing service should be re-run before
+ * giving up.
+ */
+export const DEFAULT_MAX_RETRIES = 4;
+
+/**
+ * The maximum number of times that the service is allowed to fail before
+ * pausing further retries. This is set to a value such that if given a
+ * service that continually fails, the policy needs to be executed 3 times
+ * before further retries are paused.
+ */
+export const DEFAULT_MAX_CONSECUTIVE_FAILURES = (1 + DEFAULT_MAX_RETRIES) * 3;
+
+/**
+ * The list of error messages that represent a failure to connect to the network.
+ *
+ * This list was derived from Sindre Sorhus's `is-network-error` package:
+ * <https://github.com/sindresorhus/is-network-error/blob/7bbfa8be9482ce1427a21fbff60e3ee1650dd091/index.js>
+ */
+export const CONNECTION_ERRORS = [
+  // Chrome
+  {
+    constructorName: 'TypeError',
+    pattern: /network error/u,
+  },
+  // Chrome
+  {
+    constructorName: 'TypeError',
+    pattern: /Failed to fetch/u,
+  },
+  // Firefox
+  {
+    constructorName: 'TypeError',
+    pattern: /NetworkError when attempting to fetch resource\./u,
+  },
+  // Safari 16
+  {
+    constructorName: 'TypeError',
+    pattern: /The Internet connection appears to be offline\./u,
+  },
+  // Safari 17+
+  {
+    constructorName: 'TypeError',
+    pattern: /Load failed/u,
+  },
+  // `cross-fetch`
+  {
+    constructorName: 'TypeError',
+    pattern: /Network request failed/u,
+  },
+  // `node-fetch`
+  {
+    constructorName: 'FetchError',
+    pattern: /request to (.+) failed/u,
+  },
+  // Undici (Node.js)
+  {
+    constructorName: 'TypeError',
+    pattern: /fetch failed/u,
+  },
+  // Undici (Node.js)
+  {
+    constructorName: 'TypeError',
+    pattern: /terminated/u,
+  },
+];
+
+/**
+ * Custom JSON-RPC error codes for specific cases.
+ *
+ * These should be moved to `@metamask/rpc-errors` eventually.
+ */
+export const CUSTOM_RPC_ERRORS = {
+  unauthorized: -32006,
+  httpClientError: -32080,
+} as const;
+
+/**
+ * Determines whether the given error represents a failure to reach the network
+ * after request parameters have been validated.
+ *
+ * This is somewhat difficult to verify because JavaScript engines (and in
+ * some cases libraries) produce slightly different error messages for this
+ * particular scenario, and we need to account for this.
+ *
+ * @param error - The error.
+ * @returns True if the error indicates that the network cannot be connected to,
+ * and false otherwise.
+ */
+export function isConnectionError(error: unknown): boolean {
+  if (!(typeof error === 'object' && error !== null && 'message' in error)) {
+    return false;
+  }
+
+  const { message } = error;
+
+  return (
+    typeof message === 'string' &&
+    !isNockError(message) &&
+    CONNECTION_ERRORS.some(({ constructorName, pattern }) => {
+      return (
+        error.constructor.name === constructorName && pattern.test(message)
+      );
+    })
+  );
+}
+
+/**
+ * Determines whether the given error message refers to a Nock error.
+ *
+ * It's important that if we failed to mock a request in a test, the resulting
+ * error does not cause the request to be retried so that we can see it right
+ * away.
+ *
+ * @param message - The error message to test.
+ * @returns True if the message indicates a missing Nock mock, false otherwise.
+ */
+function isNockError(message: string): boolean {
+  return message.includes('Nock:');
+}
+
+/**
+ * Determine whether the given error message indicates a failure to parse JSON.
+ *
+ * This is different in tests vs. implementation code because it may manifest as
+ * a FetchError or a SyntaxError.
+ *
+ * @param error - The error object to test.
+ * @returns True if the error indicates a JSON parse error, false otherwise.
+ */
+function isJsonParseError(error: unknown): boolean {
+  return (
+    error instanceof SyntaxError ||
+    /invalid json/iu.test(getErrorMessage(error))
+  );
+}
+
+/**
+ * Guarantees a URL, even given a string. This is useful for checking components
+ * of that URL.
+ *
+ * @param endpointUrlOrUrlString - Either a URL object or a string that
+ * represents the URL of an endpoint.
+ * @returns A URL object.
+ */
+function getNormalizedEndpointUrl(endpointUrlOrUrlString: URL | string): URL {
+  return endpointUrlOrUrlString instanceof URL
+    ? endpointUrlOrUrlString
+    : new URL(endpointUrlOrUrlString);
+}
+
+/**
+ * Strips username and password from a URL.
+ *
+ * @param url - The URL to strip credentials from.
+ * @returns A new URL object with credentials removed.
+ */
+function stripCredentialsFromUrl(url: URL): URL {
+  const strippedUrl = new URL(url.toString());
+  strippedUrl.username = '';
+  strippedUrl.password = '';
+  return strippedUrl;
+}
+
+/**
+ * This class is responsible for making a request to an endpoint that implements
+ * the JSON-RPC protocol. It is designed to gracefully handle network and server
+ * failures, retrying requests using exponential backoff. It also offers a hook
+ * which can used to respond to slow requests.
+ */
+export class RpcService implements AbstractRpcService {
+  /**
+   * The URL of the RPC endpoint.
+   */
+  readonly endpointUrl: URL;
+
+  /**
+   * The last error that the retry policy captured (or `undefined` if the last
+   * execution of the service was successful).
+   */
+  lastError: Error | undefined;
+
+  /**
+   * The function used to make an HTTP request.
+   */
+  readonly #fetch: typeof fetch;
+
+  /**
+   * A common set of options that the request options will extend.
+   */
+  readonly #fetchOptions: FetchOptions;
+
+  /**
+   * A `loglevel` logger.
+   */
+  readonly #logger: RpcServiceOptions['logger'];
+
+  /**
+   * The policy that wraps the request.
+   */
+  readonly #policy: ServicePolicy;
+
+  /**
+   * Constructs a new RpcService object.
+   *
+   * @param options - The options. See {@link RpcServiceOptions}.
+   */
+  constructor(options: RpcServiceOptions) {
+    const {
+      btoa: givenBtoa,
+      endpointUrl,
+      fetch: givenFetch,
+      logger,
+      fetchOptions = {},
+      policyOptions = {},
+      isOffline,
+    } = options;
+
+    this.#fetch = givenFetch;
+    const normalizedUrl = getNormalizedEndpointUrl(endpointUrl);
+    this.#fetchOptions = this.#getDefaultFetchOptions(
+      normalizedUrl,
+      fetchOptions,
+      givenBtoa,
+    );
+    this.endpointUrl = stripCredentialsFromUrl(normalizedUrl);
+    this.#logger = logger;
+
+    this.#policy = createServicePolicy({
+      maxRetries: DEFAULT_MAX_RETRIES,
+      maxConsecutiveFailures: DEFAULT_MAX_CONSECUTIVE_FAILURES,
+      ...policyOptions,
+      retryFilterPolicy: handleWhen((error) => {
+        // If user is offline, don't retry any errors
+        // This prevents degraded/break callbacks from being triggered
+        if (isOffline()) {
+          return false;
+        }
+
+        return (
+          // Ignore errors where the request failed to establish
+          isConnectionError(error) ||
+          // Ignore server sent HTML error pages or truncated JSON responses
+          isJsonParseError(error) ||
+          // Ignore server overload errors
+          ('httpStatus' in error &&
+            (error.httpStatus === 502 ||
+              error.httpStatus === 503 ||
+              error.httpStatus === 504)) ||
+          (hasProperty(error, 'code') &&
+            (error.code === 'ETIMEDOUT' || error.code === 'ECONNRESET'))
+        );
+      }),
+    });
+  }
+
+  /**
+   * Resets the underlying composite Cockatiel policy.
+   *
+   * This is useful in a collection of RpcServices where some act as failovers
+   * for others where you effectively want to invalidate the failovers when the
+   * primary recovers.
+   */
+  resetPolicy(): void {
+    this.#policy.reset();
+  }
+
+  /**
+   * @returns The state of the underlying circuit.
+   */
+  getCircuitState(): CircuitState {
+    return this.#policy.getCircuitState();
+  }
+
+  /**
+   * Listens for when the RPC service retries the request.
+   *
+   * @param listener - The callback to be called when the retry occurs.
+   * @returns What {@link ServicePolicy.onRetry} returns.
+   * @see {@link createServicePolicy}
+   */
+  onRetry(listener: Parameters<AbstractRpcService['onRetry']>[0]): IDisposable {
+    return this.#policy.onRetry((data) => {
+      listener({ ...data, endpointUrl: this.endpointUrl.toString() });
+    });
+  }
+
+  /**
+   * Listens for when the RPC service retries the request too many times in a
+   * row, causing the underlying circuit to break.
+   *
+   * @param listener - The callback to be called when the circuit is broken.
+   * @returns What {@link ServicePolicy.onBreak} returns.
+   * @see {@link createServicePolicy}
+   */
+  onBreak(listener: Parameters<AbstractRpcService['onBreak']>[0]): IDisposable {
+    return this.#policy.onBreak((data) => {
+      // `{ isolated: true }` is a special object that shows up when `isolate`
+      // is called on the circuit breaker. Usually `isolate` is used to hold the
+      // circuit open, but we (ab)use this method in `createServicePolicy` to
+      // reset the circuit breaker policy. When we do this, we don't want to
+      // call `onBreak` handlers, because then it causes
+      // `NetworkController:rpcEndpointUnavailable` and
+      // `NetworkController:rpcEndpointChainUnavailable` to be published. So we
+      // have to ignore that object here. The consequence is that `isolate`
+      // doesn't function the way it is intended, at least in the context of an
+      // RpcService. However, we are making a bet that we won't need to use it
+      // other than how we are already using it.
+      if (!('isolated' in data)) {
+        listener({ ...data, endpointUrl: this.endpointUrl.toString() });
+      }
+    });
+  }
+
+  /**
+   * Listens for when the policy underlying this RPC service detects a slow
+   * request.
+   *
+   * @param listener - The callback to be called when the request is slow.
+   * @returns What {@link ServicePolicy.onDegraded} returns.
+   * @see {@link createServicePolicy}
+   */
+  onDegraded(
+    listener: Parameters<AbstractRpcService['onDegraded']>[0],
+  ): IDisposable {
+    return this.#policy.onDegraded((data) => {
+      listener({ ...(data ?? {}), endpointUrl: this.endpointUrl.toString() });
+    });
+  }
+
+  /**
+   * Listens for when the policy underlying this RPC service is available.
+   *
+   * @param listener - The callback to be called when the request is available.
+   * @returns What {@link ServicePolicy.onAvailable} returns.
+   * @see {@link createServicePolicy}
+   */
+  onAvailable(
+    listener: Parameters<AbstractRpcService['onAvailable']>[0],
+  ): IDisposable {
+    return this.#policy.onAvailable(() => {
+      listener({ endpointUrl: this.endpointUrl.toString() });
+    });
+  }
+
+  /**
+   * Makes a request to the RPC endpoint.
+   *
+   * This overload is specifically designed for `eth_getBlockByNumber`, which
+   * can return a `result` of `null` despite an expected `Result` being
+   * provided.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async request<Params extends JsonRpcParams, Result extends Json>(
+    jsonRpcRequest: JsonRpcRequest<Params> & { method: 'eth_getBlockByNumber' },
+    fetchOptions?: FetchOptions,
+  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>>;
+
+  /**
+   * Makes a request to the RPC endpoint.
+   *
+   * This overload is designed for all RPC methods except for
+   * `eth_getBlockByNumber`, which are expected to return a `result` of the
+   * expected `Result`.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request to send to the endpoint.
+   * @param fetchOptions - An options bag for {@link fetch} which further
+   * specifies the request.
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async request<Params extends JsonRpcParams, Result extends Json>(
+    jsonRpcRequest: JsonRpcRequest<Params>,
+    fetchOptions?: FetchOptions,
+  ): Promise<JsonRpcResponse<Result>>;
+
+  async request<Params extends JsonRpcParams, Result extends Json>(
+    // The request object may be frozen and must not be mutated.
+    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,
+    fetchOptions: FetchOptions = {},
+  ): Promise<JsonRpcResponse<Result | null>> {
+    const completeFetchOptions = this.#getCompleteFetchOptions(
+      jsonRpcRequest,
+      fetchOptions,
+    );
+    return await this.#executeAndProcessRequest<Result>(completeFetchOptions);
+  }
+
+  /**
+   * Constructs a default set of options to `fetch`.
+   *
+   * If a username and password are present in the URL, they are extracted to an
+   * Authorization header.
+   *
+   * @param endpointUrl - The endpoint URL.
+   * @param fetchOptions - The options to `fetch`.
+   * @param givenBtoa - An implementation of `btoa`.
+   * @returns The default fetch options.
+   */
+  #getDefaultFetchOptions(
+    endpointUrl: URL,
+    fetchOptions: FetchOptions,
+    givenBtoa: (stringToEncode: string) => string,
+  ): FetchOptions {
+    if (endpointUrl.username && endpointUrl.password) {
+      const authString = `${endpointUrl.username}:${endpointUrl.password}`;
+      const encodedCredentials = givenBtoa(authString);
+      return deepmerge(fetchOptions, {
+        headers: { Authorization: `Basic ${encodedCredentials}` },
+      });
+    }
+
+    return fetchOptions;
+  }
+
+  /**
+   * Constructs a final set of options to pass to `fetch`. Note that the method
+   * defaults to `post`, and the JSON-RPC request is automatically JSON-encoded.
+   *
+   * @param jsonRpcRequest - The JSON-RPC request.
+   * @param fetchOptions - Custom `fetch` options.
+   * @returns The complete set of `fetch` options.
+   */
+  #getCompleteFetchOptions<Params extends JsonRpcParams>(
+    jsonRpcRequest: Readonly<JsonRpcRequest<Params>>,
+    fetchOptions: FetchOptions,
+  ): FetchOptions {
+    const defaultOptions = {
+      method: 'POST',
+      headers: {
+        Accept: 'application/json',
+        'Content-Type': 'application/json',
+      },
+    };
+    const mergedOptions = deepmerge(
+      defaultOptions,
+      deepmerge(this.#fetchOptions, fetchOptions),
+    );
+
+    const { id, jsonrpc, method, params } = jsonRpcRequest;
+    const body = JSON.stringify({
+      id,
+      jsonrpc,
+      method,
+      params,
+    });
+
+    return { ...mergedOptions, body };
+  }
+
+  /**
+   * Makes the request using the Cockatiel policy that this service creates.
+   *
+   * @param fetchOptions - The options for `fetch`; will be combined with the
+   * fetch options passed to the constructor
+   * @returns The decoded JSON-RPC response from the endpoint.
+   * @throws An "authorized" JSON-RPC error (code -32006) if the response HTTP status is 401.
+   * @throws A "rate limiting" JSON-RPC error (code -32005) if the response HTTP status is 429.
+   * @throws A "resource unavailable" JSON-RPC error (code -32002) if the response HTTP status is 402, 404, or any 5xx.
+   * @throws A generic HTTP client JSON-RPC error (code -32050) for any other 4xx HTTP status codes.
+   * @throws A "parse" JSON-RPC error (code -32700) if the response is not valid JSON.
+   */
+  async #executeAndProcessRequest<Result extends Json>(
+    fetchOptions: FetchOptions,
+  ): Promise<JsonRpcResponse<Result> | JsonRpcResponse<null>> {
+    let response: Response | undefined;
+    try {
+      log(
+        `[${this.endpointUrl}] Circuit state`,
+        this.#policy.getCircuitState(),
+      );
+      const jsonDecodedResponse = await this.#policy.execute(
+        async (context) => {
+          log(
+            'REQUEST INITIATED:',
+            this.endpointUrl.toString(),
+            '::',
+            fetchOptions,
+            // @ts-expect-error This property _is_ here, the type of
+            // ServicePolicy is just wrong.
+            `(attempt ${context.attempt + 1})`,
+          );
+          response = await this.#fetch(this.endpointUrl, fetchOptions);
+          if (!response.ok) {
+            throw new HttpError(response.status);
+          }
+          log(
+            'REQUEST SUCCESSFUL:',
+            this.endpointUrl.toString(),
+            response.status,
+          );
+          return await response.json();
+        },
+      );
+      this.lastError = undefined;
+      return jsonDecodedResponse;
+    } catch (error) {
+      log('REQUEST ERROR:', this.endpointUrl.toString(), error);
+
+      this.lastError =
+        error instanceof Error ? error : new Error(getErrorMessage(error));
+
+      if (error instanceof HttpError) {
+        const status = error.httpStatus;
+        if (status === 401) {
+          throw new JsonRpcError(
+            CUSTOM_RPC_ERRORS.unauthorized,
+            'Unauthorized.',
+            {
+              httpStatus: status,
+            },
+          );
+        }
+        if (status === 429) {
+          throw rpcErrors.limitExceeded({
+            message: 'Request is being rate limited.',
+            data: {
+              httpStatus: status,
+            },
+          });
+        }
+        if (status >= 500 || status === 402 || status === 404) {
+          throw rpcErrors.resourceUnavailable({
+            message: 'RPC endpoint not found or unavailable.',
+            data: {
+              httpStatus: status,
+            },
+          });
+        }
+
+        // Handle all other 4xx errors as generic HTTP client errors
+        throw new JsonRpcError(
+          CUSTOM_RPC_ERRORS.httpClientError,
+          'RPC endpoint returned HTTP client error.',
+          {
+            httpStatus: status,
+          },
+        );
+      } else if (isJsonParseError(error)) {
+        throw rpcErrors.parse({
+          message: 'RPC endpoint did not return JSON.',
+        });
+      } else if (error instanceof BrokenCircuitError) {
+        this.#logger?.warn(error);
+        const remainingCircuitOpenDuration =
+          this.#policy.getRemainingCircuitOpenDuration();
+        const formattedRemainingCircuitOpenDuration = Intl.NumberFormat(
+          undefined,
+          { maximumFractionDigits: 2 },
+        ).format(
+          (remainingCircuitOpenDuration ?? this.#policy.circuitBreakDuration) /
+            Duration.Minute,
+        );
+        throw rpcErrors.resourceUnavailable({
+          message: `RPC endpoint returned too many errors, retrying in ${formattedRemainingCircuitOpenDuration} minutes. Consider using a different RPC endpoint.`,
+        });
+      }
+      throw error;
+    }
+  }
+}
diff --git a/src/rpc-service/shared.ts b/src/rpc-service/shared.ts
new file mode 100644
index 0000000000000000000000000000000000000000..c66cb1082c8bdf43e54c579682216f05e461e2e3
--- /dev/null
+++ b/src/rpc-service/shared.ts
@@ -0,0 +1,58 @@
+import type {
+  CockatielEvent,
+  CockatielEventEmitter,
+} from '@metamask/controller-utils';
+
+/**
+ * Equivalent to the built-in `FetchOptions` type, but renamed for clarity.
+ */
+export type FetchOptions = RequestInit;
+
+/**
+ * Converts a Cockatiel event type to an event emitter type.
+ */
+export type CockatielEventToEventEmitter<Event> =
+  Event extends CockatielEvent<infer EventData>
+    ? CockatielEventEmitter<EventData>
+    : never;
+
+/**
+ * Obtains the event data type from a Cockatiel event or event listener type.
+ */
+export type ExtractCockatielEventData<CockatielEventOrEventListener> =
+  CockatielEventOrEventListener extends CockatielEvent<infer Data>
+    ? Data
+    : CockatielEventOrEventListener extends (data: infer Data) => void
+      ? Data
+      : never;
+
+/**
+ * Extends the data that a Cockatiel event listener is called with additional
+ * data.
+ */
+export type ExtendCockatielEventData<OriginalData, AdditionalData> =
+  OriginalData extends void ? AdditionalData : OriginalData & AdditionalData;
+
+/**
+ * Removes keys from the data that a Cockatiel event listner is called with.
+ */
+export type ExcludeCockatielEventData<
+  OriginalData,
+  Keys extends PropertyKey,
+> = OriginalData extends void ? void : Omit<OriginalData, Keys>;
+
+/**
+ * Converts a Cockatiel event type to an event listener type, but adding the
+ * requested data.
+ */
+export type CockatielEventToEventListenerWithData<Event, Data> = (
+  data: ExtendCockatielEventData<ExtractCockatielEventData<Event>, Data>,
+) => void;
+
+/**
+ * Converts a Cockatiel event listener type to an event emitter type.
+ */
+export type CockatielEventToEventEmitterWithData<Event, Data> =
+  CockatielEventEmitter<
+    ExtendCockatielEventData<ExtractCockatielEventData<Event>, Data>
+  >;
diff --git a/src/types.ts b/src/types.ts
new file mode 100644
index 0000000000000000000000000000000000000000..31afd9d3601c29f8723474c320afa64274ae7357
--- /dev/null
+++ b/src/types.ts
@@ -0,0 +1,68 @@
+import type { InfuraNetworkType, ChainId } from '@metamask/controller-utils';
+import type { BlockTracker as BaseBlockTracker } from '@metamask/eth-block-tracker';
+import type { InternalProvider } from '@metamask/eth-json-rpc-provider';
+import type { MiddlewareContext } from '@metamask/json-rpc-engine/v2';
+import type { Hex } from '@metamask/utils';
+
+export type Provider = InternalProvider<
+  MiddlewareContext<
+    { origin: string; skipCache: boolean } & Record<string, unknown>
+  >
+>;
+
+export type BlockTracker = BaseBlockTracker & {
+  checkForLatestBlock(): Promise<string>;
+};
+
+/**
+ * The type of network client that can be created.
+ */
+export enum NetworkClientType {
+  Custom = 'custom',
+  Infura = 'infura',
+}
+
+/**
+ * A configuration object that can be used to create a client for a network.
+ */
+type CommonNetworkClientConfiguration = {
+  chainId: Hex;
+  failoverRpcUrls?: string[];
+  ticker: string;
+};
+
+/**
+ * A configuration object that can be used to create a client for a custom
+ * network.
+ */
+export type CustomNetworkClientConfiguration =
+  CommonNetworkClientConfiguration & {
+    rpcUrl: string;
+    type: NetworkClientType.Custom;
+  };
+
+/**
+ * A configuration object that can be used to create a client for an Infura
+ * network.
+ */
+export type InfuraNetworkClientConfiguration =
+  CommonNetworkClientConfiguration & {
+    network: InfuraNetworkType;
+    infuraProjectId: string;
+    type: NetworkClientType.Infura;
+  };
+
+/**
+ * A configuration object that can be used to create a client for a network.
+ */
+export type NetworkClientConfiguration =
+  | CustomNetworkClientConfiguration
+  | InfuraNetworkClientConfiguration;
+
+/**
+ * The Chain ID representing the additional networks to be included as default.
+ */
+export type AdditionalDefaultNetwork = (typeof ChainId)[
+  | 'megaeth-testnet'
+  | 'megaeth-testnet-v2'
+  | 'monad-testnet'];
diff --git a/tests/NetworkController.provider.test.ts b/tests/NetworkController.provider.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..d2ad58a9c2e7d3d760847f66a8180bfcb28231fc
--- /dev/null
+++ b/tests/NetworkController.provider.test.ts
@@ -0,0 +1,894 @@
+import {
+  DEFAULT_CIRCUIT_BREAK_DURATION,
+  DEFAULT_DEGRADED_THRESHOLD,
+} from '@metamask/controller-utils';
+import nock from 'nock';
+import type { SinonFakeTimers } from 'sinon';
+import { useFakeTimers } from 'sinon';
+
+import {
+  buildCustomNetworkConfiguration,
+  buildCustomRpcEndpoint,
+  withController,
+} from './helpers';
+import { NetworkStatus } from '../src/constants';
+
+describe('NetworkController provider tests', () => {
+  let clock: SinonFakeTimers;
+
+  beforeEach(() => {
+    clock = useFakeTimers();
+  });
+
+  afterEach(() => {
+    clock.restore();
+  });
+
+  it('sets the status of a network client to "available" the first time its (sole) RPC endpoint returns a 2xx response', async () => {
+    const endpointUrl = 'https://some.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(endpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      })
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: endpointUrl,
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller }) => {
+        const { provider } = controller.getNetworkClientById(networkClientId);
+
+        await provider.request({
+          id: 1,
+          jsonrpc: '2.0',
+          method: rpcMethod,
+          params: [],
+        });
+
+        expect(controller.state.networksMetadata[networkClientId].status).toBe(
+          NetworkStatus.Available,
+        );
+      },
+    );
+  });
+
+  it('sets the status of a network client to "degraded" when its (sole) RPC endpoint responds with 2xx but slowly', async () => {
+    const endpointUrl = 'https://some.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(endpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .reply(() => {
+        clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+        return [
+          200,
+          {
+            id: 1,
+            jsonrpc: '2.0',
+            result: 'ok',
+          },
+        ];
+      })
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      })
+      .reply(() => {
+        clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+        return [
+          200,
+          {
+            id: 1,
+            jsonrpc: '2.0',
+            result: 'ok',
+          },
+        ];
+      });
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: endpointUrl,
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller }) => {
+        const { provider } = controller.getNetworkClientById(networkClientId);
+
+        await provider.request({
+          id: 1,
+          jsonrpc: '2.0',
+          method: rpcMethod,
+          params: [],
+        });
+
+        expect(controller.state.networksMetadata[networkClientId].status).toBe(
+          NetworkStatus.Degraded,
+        );
+      },
+    );
+  });
+
+  it('sets the status of a network client to "degraded" when failed requests to its (sole) RPC endpoint reach the max number of retries', async () => {
+    const endpointUrl = 'https://some.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(endpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(5)
+      .reply(503);
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: endpointUrl,
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const { provider } = controller.getNetworkClientById(networkClientId);
+
+        await expect(
+          provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: rpcMethod,
+            params: [],
+          }),
+        ).rejects.toThrow('RPC endpoint not found or unavailable');
+
+        expect(controller.state.networksMetadata[networkClientId].status).toBe(
+          NetworkStatus.Degraded,
+        );
+      },
+    );
+  });
+
+  it('transitions the status of a network client from "degraded" to "available" the first time a failover is activated and returns a 2xx response', async () => {
+    const primaryEndpointUrl = 'https://first.endpoint';
+    const secondaryEndpointUrl = 'https://second.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(primaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503);
+    nock(secondaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      })
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: primaryEndpointUrl,
+                  failoverUrls: [secondaryEndpointUrl],
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const stateChangeListener = jest.fn();
+        messenger.subscribe(
+          'NetworkController:stateChange',
+          stateChangeListener,
+        );
+        const { provider } = controller.getNetworkClientById(networkClientId);
+        const request = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: rpcMethod,
+          params: [],
+        };
+        const expectedError = 'RPC endpoint not found or unavailable';
+
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, break the circuit, fail over to the secondary.
+        await provider.request(request);
+
+        expect(stateChangeListener).toHaveBeenCalledTimes(2);
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          1,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'degraded',
+            },
+          ],
+        );
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          2,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'available',
+            },
+          ],
+        );
+      },
+    );
+  });
+
+  it('does not transition the status of a network client from "degraded" the first time a failover is activated if it returns a non-2xx response', async () => {
+    const primaryEndpointUrl = 'https://first.endpoint';
+    const secondaryEndpointUrl = 'https://second.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(primaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503);
+    nock(secondaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(5)
+      .reply(503);
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: primaryEndpointUrl,
+                  failoverUrls: [secondaryEndpointUrl],
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const stateChangeListener = jest.fn();
+        messenger.subscribe(
+          'NetworkController:stateChange',
+          stateChangeListener,
+        );
+        const { provider } = controller.getNetworkClientById(networkClientId);
+        const request = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: rpcMethod,
+          params: [],
+        };
+        const expectedError = 'RPC endpoint not found or unavailable';
+
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, break the circuit, fail over to the secondary,
+        // run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+
+        expect(controller.state.networksMetadata[networkClientId].status).toBe(
+          NetworkStatus.Degraded,
+        );
+      },
+    );
+  });
+
+  it('does not transition the status of a network client from "degraded" the first time a failover is activated if requests are slow to complete', async () => {
+    const primaryEndpointUrl = 'https://first.endpoint';
+    const secondaryEndpointUrl = 'https://second.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(primaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503);
+    nock(secondaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .reply(() => {
+        clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+        return [
+          200,
+          {
+            id: 1,
+            jsonrpc: '2.0',
+            result: '0x1',
+          },
+        ];
+      })
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      })
+      .reply(() => {
+        clock.tick(DEFAULT_DEGRADED_THRESHOLD + 1);
+        return [
+          200,
+          {
+            id: 1,
+            jsonrpc: '2.0',
+            result: 'ok',
+          },
+        ];
+      });
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: primaryEndpointUrl,
+                  failoverUrls: [secondaryEndpointUrl],
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const stateChangeListener = jest.fn();
+        messenger.subscribe(
+          'NetworkController:stateChange',
+          stateChangeListener,
+        );
+        const { provider } = controller.getNetworkClientById(networkClientId);
+        const request = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: rpcMethod,
+          params: [],
+        };
+        const expectedError = 'RPC endpoint not found or unavailable';
+
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, break the circuit, fail over to the secondary.
+        await provider.request(request);
+
+        expect(controller.state.networksMetadata[networkClientId].status).toBe(
+          NetworkStatus.Degraded,
+        );
+      },
+    );
+  });
+
+  it('sets the status of a network client to "unavailable" when all of its RPC endpoints consistently return 5xx errors, reaching the max consecutive number of failures', async () => {
+    const primaryEndpointUrl = 'https://first.endpoint';
+    const secondaryEndpointUrl = 'https://second.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(primaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503);
+    nock(secondaryEndpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503);
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: primaryEndpointUrl,
+                  failoverUrls: [secondaryEndpointUrl],
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const { provider } = controller.getNetworkClientById(networkClientId);
+        const request = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: rpcMethod,
+          params: [],
+        };
+        const expectedError = 'RPC endpoint not found or unavailable';
+
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the primary, break the circuit, fail over to the secondary,
+        // run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the secondary, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the secondary, break the circuit.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+
+        expect(controller.state.networksMetadata[networkClientId].status).toBe(
+          NetworkStatus.Unavailable,
+        );
+      },
+    );
+  });
+
+  it('transitions the status of a network client from "unavailable" to "available" when its (sole) RPC endpoint consistently returns 5xx errors for a while and then recovers', async () => {
+    const endpointUrl = 'https://some.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(endpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      })
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: endpointUrl,
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const stateChangeListener = jest.fn();
+        messenger.subscribe(
+          'NetworkController:stateChange',
+          stateChangeListener,
+        );
+        const { provider } = controller.getNetworkClientById(networkClientId);
+        const request = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: rpcMethod,
+          params: [],
+        };
+        const expectedError = 'RPC endpoint not found or unavailable';
+
+        // Hit the endpoint, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the endpoint, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the endpoint, break the circuit.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Wait until the circuit break duration passes and hit the endpoint
+        // again.
+        clock.tick(DEFAULT_CIRCUIT_BREAK_DURATION);
+        await provider.request(request);
+
+        expect(stateChangeListener).toHaveBeenCalledTimes(3);
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          1,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'degraded',
+            },
+          ],
+        );
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          2,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'unavailable',
+            },
+          ],
+        );
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          3,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'available',
+            },
+          ],
+        );
+      },
+    );
+  });
+
+  it('transitions the status of a network client from "available" to "unavailable" when its (sole) RPC endpoint responds with 2xx and then returns too many 5xx responses, reaching the max number of consecutive failures', async () => {
+    const endpointUrl = 'https://some.endpoint';
+    const networkClientId = 'AAAA-AAAA-AAAA-AAAA';
+    const rpcMethod = 'eth_gasPrice';
+
+    nock(endpointUrl)
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: '0x1',
+      })
+      .post('/', {
+        id: /^\d+$/u,
+        jsonrpc: '2.0',
+        method: 'eth_blockNumber',
+        params: [],
+      })
+      .times(15)
+      .reply(503)
+      .post('/', {
+        id: 1,
+        jsonrpc: '2.0',
+        method: rpcMethod,
+        params: [],
+      })
+      .reply(200, {
+        id: 1,
+        jsonrpc: '2.0',
+        result: 'ok',
+      });
+
+    await withController(
+      {
+        isRpcFailoverEnabled: true,
+        state: {
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              name: 'Test Network',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId,
+                  url: endpointUrl,
+                }),
+              ],
+            }),
+          },
+          networksMetadata: {
+            [networkClientId]: {
+              EIPS: {},
+              status: NetworkStatus.Unknown,
+            },
+          },
+          selectedNetworkClientId: networkClientId,
+        },
+      },
+      async ({ controller, messenger }) => {
+        messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+          clock.next();
+        });
+        const stateChangeListener = jest.fn();
+        messenger.subscribe(
+          'NetworkController:stateChange',
+          stateChangeListener,
+        );
+        const { provider } = controller.getNetworkClientById(networkClientId);
+        const request = {
+          id: 1,
+          jsonrpc: '2.0' as const,
+          method: rpcMethod,
+          params: [],
+        };
+        const expectedError = 'RPC endpoint not found or unavailable';
+
+        // Hit the endpoint and see that it is successful.
+        await provider.request(request);
+        // Wait for the block tracker to reset the cache. (For some reason,
+        // multiple timers exist.)
+        clock.runAll();
+        // Hit the endpoint, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the endpoint, run out of retries.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+        // Hit the endpoint, break the circuit.
+        await expect(provider.request(request)).rejects.toThrow(expectedError);
+
+        expect(stateChangeListener).toHaveBeenCalledTimes(3);
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          1,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'available',
+            },
+          ],
+        );
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          2,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'degraded',
+            },
+          ],
+        );
+        expect(stateChangeListener).toHaveBeenNthCalledWith(
+          3,
+          expect.any(Object),
+          [
+            {
+              op: 'replace',
+              path: ['networksMetadata', 'AAAA-AAAA-AAAA-AAAA', 'status'],
+              value: 'unavailable',
+            },
+          ],
+        );
+      },
+    );
+  });
+});
diff --git a/tests/NetworkController.test.ts b/tests/NetworkController.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..311333834ee6a0bbd42f7665aa78f709c681410a
--- /dev/null
+++ b/tests/NetworkController.test.ts
@@ -0,0 +1,17086 @@
+import { deriveStateFromMetadata } from '@metamask/base-controller';
+import {
+  BuiltInNetworkName,
+  ChainId,
+  InfuraNetworkType,
+  isInfuraNetworkType,
+  MAX_SAFE_CHAIN_ID,
+  NetworkNickname,
+  NetworksTicker,
+  NetworkType,
+  toHex,
+} from '@metamask/controller-utils';
+import { PollingBlockTrackerOptions } from '@metamask/eth-block-tracker';
+import { rpcErrors } from '@metamask/rpc-errors';
+import type { Hex } from '@metamask/utils';
+import assert from 'assert';
+import type { Patch } from 'immer';
+import { when, resetAllWhenMocks, WhenMock } from 'jest-when';
+import { inspect, isDeepStrictEqual, promisify } from 'util';
+import { v4 as uuidV4 } from 'uuid';
+
+import {
+  buildAddNetworkCustomRpcEndpointFields,
+  buildAddNetworkFields,
+  buildCustomNetworkClientConfiguration,
+  buildCustomNetworkConfiguration,
+  buildCustomRpcEndpoint,
+  buildInfuraNetworkClientConfiguration,
+  buildInfuraNetworkConfiguration,
+  buildInfuraRpcEndpoint,
+  buildNetworkConfiguration,
+  buildNetworkControllerMessenger,
+  buildRootMessenger,
+  buildUpdateNetworkCustomRpcEndpointFields,
+  INFURA_NETWORKS,
+  TESTNET,
+  withController,
+} from './helpers';
+import type { RootMessenger } from './helpers';
+import { FakeBlockTracker } from '../../../tests/fake-block-tracker';
+import type { FakeProviderStub } from '../../../tests/fake-provider';
+import { FakeProvider } from '../../../tests/fake-provider';
+import { NetworkStatus } from '../src/constants';
+import * as createAutoManagedNetworkClientModule from '../src/create-auto-managed-network-client';
+import type { AutoManagedNetworkClient } from '../src/create-auto-managed-network-client';
+import type { NetworkClient } from '../src/create-network-client';
+import { createNetworkClient } from '../src/create-network-client';
+import type {
+  AutoManagedBuiltInNetworkClientRegistry,
+  AutoManagedCustomNetworkClientRegistry,
+  InfuraRpcEndpoint,
+  NetworkClientId,
+  NetworkConfiguration,
+  NetworkControllerEvents,
+  NetworkControllerStateChangeEvent,
+  NetworkState,
+} from '../src/NetworkController';
+import {
+  getAvailableNetworkClientIds,
+  getDefaultNetworkControllerState,
+  getNetworkConfigurations,
+  NetworkController,
+  RpcEndpointType,
+  selectAvailableNetworkClientIds,
+  selectNetworkConfigurations,
+} from '../src/NetworkController';
+import type { RpcServiceOptions } from '../src/rpc-service/rpc-service';
+import type { NetworkClientConfiguration, Provider } from '../src/types';
+import { NetworkClientType } from '../src/types';
+
+jest.mock('../src/create-network-client');
+
+jest.mock('uuid', () => {
+  const actual = jest.requireActual('uuid');
+
+  return {
+    ...actual,
+    v4: jest.fn(),
+  };
+});
+
+/**
+ * A block header object that `eth_getBlockByNumber` can be mocked to return.
+ * Note that this type does not specify all of the properties present within the
+ * block header; within these tests, we are only interested in `number` and
+ * `baseFeePerGas`.
+ */
+type Block = {
+  number: string;
+  baseFeePerGas?: string;
+};
+
+const createNetworkClientMock = jest.mocked(createNetworkClient);
+const uuidV4Mock = jest.mocked(uuidV4);
+
+/**
+ * A dummy block that matches the pre-EIP-1559 format (i.e. it doesn't have the
+ * `baseFeePerGas` property).
+ */
+const PRE_1559_BLOCK: Block = {
+  number: '0x42',
+};
+
+/**
+ * A dummy block that matches the pre-EIP-1559 format (i.e. it has the
+ * `baseFeePerGas` property).
+ */
+const POST_1559_BLOCK: Block = {
+  ...PRE_1559_BLOCK,
+  baseFeePerGas: '0x63c498a46',
+};
+
+/**
+ * An alias for `POST_1559_BLOCK`, for tests that don't care about which kind of
+ * block they're looking for.
+ */
+const BLOCK: Block = POST_1559_BLOCK;
+
+/**
+ * A response object for a successful request to `eth_getBlockByNumber`. It is
+ * assumed that the block number here is insignificant to the test.
+ */
+const SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE = {
+  result: BLOCK,
+};
+
+/**
+ * A response object for a request that has been geoblocked by Infura.
+ */
+const BLOCKED_INFURA_JSON_RPC_ERROR = rpcErrors.internal(
+  JSON.stringify({ error: 'countryBlocked' }),
+);
+
+/**
+ * A response object for a unsuccessful request to any RPC method. It is assumed
+ * that the error here is insignificant to the test.
+ */
+const GENERIC_JSON_RPC_ERROR = rpcErrors.internal(
+  JSON.stringify({ error: 'oops' }),
+);
+
+/**
+ * We are mocking/faking `Date.now` calls for test consistency
+ */
+const FAKE_DATE_NOW_MS = 1732114339518;
+
+describe('NetworkController', () => {
+  let uuidCounter = 0;
+
+  beforeEach(() => {
+    uuidV4Mock.mockImplementation(() => {
+      const uuid = `UUID-${uuidCounter}`;
+      uuidCounter += 1;
+      return uuid;
+    });
+
+    jest.spyOn(Date, 'now').mockReturnValue(FAKE_DATE_NOW_MS);
+  });
+
+  afterEach(() => {
+    resetAllWhenMocks();
+  });
+
+  describe('constructor', () => {
+    it('throws given an empty networkConfigurationsByChainId collection', () => {
+      const messenger = buildRootMessenger();
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+      expect(
+        () =>
+          new NetworkController({
+            messenger: controllerMessenger,
+            state: {
+              networkConfigurationsByChainId: {},
+            },
+            infuraProjectId: 'infura-project-id',
+            getRpcServiceOptions: (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+          }),
+      ).toThrow(
+        'NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty',
+      );
+    });
+
+    it('throws if the key under which a network configuration is filed does not match the chain ID of that network configuration', () => {
+      const messenger = buildRootMessenger();
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+      expect(
+        () =>
+          new NetworkController({
+            messenger: controllerMessenger,
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1338',
+                  name: 'Test Network',
+                }),
+              },
+            },
+            infuraProjectId: 'infura-project-id',
+            getRpcServiceOptions: (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+          }),
+      ).toThrow(
+        "NetworkController state has invalid `networkConfigurationsByChainId`: Network configuration 'Test Network' is filed under '0x1337' which does not match its `chainId` of '0x1338'",
+      );
+    });
+
+    it('throws if a network configuration has a defaultBlockExplorerUrlIndex that does not refer to an entry in blockExplorerUrls', () => {
+      const messenger = buildRootMessenger();
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+      expect(
+        () =>
+          new NetworkController({
+            messenger: controllerMessenger,
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  blockExplorerUrls: [],
+                  defaultBlockExplorerUrlIndex: 99999,
+                  chainId: '0x1337',
+                  name: 'Test Network',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      url: 'https://some.endpoint',
+                    }),
+                  ],
+                }),
+              },
+            },
+            infuraProjectId: 'infura-project-id',
+            getRpcServiceOptions: (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+          }),
+      ).toThrow(
+        "NetworkController state has invalid `networkConfigurationsByChainId`: Network configuration 'Test Network' has a `defaultBlockExplorerUrlIndex` that does not refer to an entry in `blockExplorerUrls`",
+      );
+    });
+
+    it('throws if a network configuration has a non-empty blockExplorerUrls but an absent defaultBlockExplorerUrlIndex', () => {
+      const messenger = buildRootMessenger();
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+      expect(
+        () =>
+          new NetworkController({
+            messenger: controllerMessenger,
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  blockExplorerUrls: ['https://block.explorer'],
+                  chainId: '0x1337',
+                  name: 'Test Network',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      url: 'https://some.endpoint',
+                    }),
+                  ],
+                }),
+              },
+            },
+            infuraProjectId: 'infura-project-id',
+            getRpcServiceOptions: (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+          }),
+      ).toThrow(
+        "NetworkController state has invalid `networkConfigurationsByChainId`: Network configuration 'Test Network' has a `defaultBlockExplorerUrlIndex` that does not refer to an entry in `blockExplorerUrls`",
+      );
+    });
+
+    it('throws if a network configuration has an invalid defaultRpcEndpointIndex', () => {
+      const messenger = buildRootMessenger();
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+      expect(
+        () =>
+          new NetworkController({
+            messenger: controllerMessenger,
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  name: 'Test Network',
+                  defaultRpcEndpointIndex: 99999,
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      url: 'https://some.endpoint',
+                    }),
+                  ],
+                }),
+              },
+            },
+            infuraProjectId: 'infura-project-id',
+            getRpcServiceOptions: (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+          }),
+      ).toThrow(
+        "NetworkController state has invalid `networkConfigurationsByChainId`: Network configuration 'Test Network' has a `defaultRpcEndpointIndex` that does not refer to an entry in `rpcEndpoints`",
+      );
+    });
+
+    it('throws if more than one RPC endpoint across network configurations has the same networkClientId', () => {
+      const messenger = buildRootMessenger();
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+      expect(
+        () =>
+          new NetworkController({
+            messenger: controllerMessenger,
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  name: 'Test Network 1',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.endpoint/1',
+                    }),
+                  ],
+                }),
+                '0x2448': buildCustomNetworkConfiguration({
+                  chainId: '0x2448',
+                  name: 'Test Network 2',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.endpoint/2',
+                    }),
+                  ],
+                }),
+              },
+            },
+            infuraProjectId: 'infura-project-id',
+            getRpcServiceOptions: (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+            }),
+          }),
+      ).toThrow(
+        'NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`',
+      );
+    });
+
+    it('corrects an invalid selectedNetworkClientId to the default RPC endpoint of the first chain, logging this fact', () => {
+      const messenger = buildRootMessenger();
+      const captureExceptionSpy = jest.spyOn(messenger, 'captureException');
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+
+      const controller = new NetworkController({
+        messenger: controllerMessenger,
+        state: {
+          selectedNetworkClientId: 'nonexistent',
+          networkConfigurationsByChainId: {
+            '0x1': buildCustomNetworkConfiguration({
+              chainId: '0x1',
+              defaultRpcEndpointIndex: 1,
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                }),
+              ],
+            }),
+            '0x2': buildCustomNetworkConfiguration({ chainId: '0x2' }),
+            '0x3': buildCustomNetworkConfiguration({ chainId: '0x3' }),
+          },
+        },
+        infuraProjectId: 'infura-project-id',
+        getRpcServiceOptions: (): Omit<
+          RpcServiceOptions,
+          'failoverService' | 'endpointUrl'
+        > => ({
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+        }),
+      });
+
+      expect(controller.state.selectedNetworkClientId).toBe(
+        'BBBB-BBBB-BBBB-BBBB',
+      );
+      expect(captureExceptionSpy).toHaveBeenCalledWith(
+        new Error(
+          "`selectedNetworkClientId` 'nonexistent' does not refer to an RPC endpoint within a network configuration; correcting to 'BBBB-BBBB-BBBB-BBBB'",
+        ),
+      );
+    });
+
+    it('removes invalid network client IDs from networksMetadata, logging this fact', () => {
+      const messenger = buildRootMessenger();
+      const captureExceptionSpy = jest.spyOn(messenger, 'captureException');
+      const controllerMessenger = buildNetworkControllerMessenger(messenger);
+
+      const controller = new NetworkController({
+        messenger: controllerMessenger,
+        state: {
+          selectedNetworkClientId: InfuraNetworkType.sepolia,
+          networkConfigurationsByChainId: {
+            [ChainId.sepolia]: buildInfuraNetworkConfiguration(
+              InfuraNetworkType.sepolia,
+            ),
+          },
+          networksMetadata: {
+            [InfuraNetworkType.sepolia]: {
+              status: NetworkStatus.Available,
+              EIPS: {},
+            },
+            'AAAA-AAAA-AAAA-AAAA': {
+              status: NetworkStatus.Available,
+              EIPS: {},
+            },
+            'BBBB-BBBB-BBBB-BBBB': {
+              status: NetworkStatus.Available,
+              EIPS: {},
+            },
+            'CCCC-CCCC-CCCC-CCCC': {
+              status: NetworkStatus.Available,
+              EIPS: {},
+            },
+          },
+        },
+        infuraProjectId: 'infura-project-id',
+        getRpcServiceOptions: (): Omit<
+          RpcServiceOptions,
+          'failoverService' | 'endpointUrl'
+        > => ({
+          fetch,
+          btoa,
+          isOffline: (): boolean => false,
+        }),
+      });
+
+      expect(controller.state.networksMetadata).not.toHaveProperty(
+        'AAAA-AAAA-AAAA-AAAA',
+      );
+      expect(controller.state.networksMetadata).not.toHaveProperty(
+        'BBBB-BBBB-BBBB-BBBB',
+      );
+      expect(controller.state.networksMetadata).not.toHaveProperty(
+        'CCCC-CCCC-CCCC-CCCC',
+      );
+      expect(captureExceptionSpy).toHaveBeenCalledWith(
+        new Error(
+          '`networksMetadata` had invalid network client IDs, which have been removed',
+        ),
+      );
+    });
+
+    const invalidInfuraProjectIds = [undefined, null, {}, 1];
+    invalidInfuraProjectIds.forEach((invalidProjectId) => {
+      it(`throws given an invalid Infura ID of "${inspect(
+        invalidProjectId,
+      )}"`, () => {
+        const messenger = buildRootMessenger();
+        const controllerMessenger = buildNetworkControllerMessenger(messenger);
+        expect(
+          () =>
+            new NetworkController({
+              messenger: controllerMessenger,
+              state: {},
+              // @ts-expect-error We are intentionally passing bad input.
+              infuraProjectId: invalidProjectId,
+            }),
+        ).toThrow('Invalid Infura project ID');
+      });
+    });
+
+    it('initializes the state with some defaults', async () => {
+      await withController(({ controller }) => {
+        expect(controller.state).toMatchInlineSnapshot(`
+          Object {
+            "networkConfigurationsByChainId": Object {
+              "0x1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Ethereum Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "mainnet",
+                    "type": "infura",
+                    "url": "https://mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x2105": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x2105",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Base Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "base-mainnet",
+                    "type": "infura",
+                    "url": "https://base-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x38": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x38",
+                "defaultRpcEndpointIndex": 0,
+                "name": "BSC Mainnet",
+                "nativeCurrency": "BNB",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "bsc-mainnet",
+                    "type": "infura",
+                    "url": "https://bsc-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x531": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x531",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sei Mainnet",
+                "nativeCurrency": "SEI",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sei-mainnet",
+                    "type": "infura",
+                    "url": "https://sei-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x89": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x89",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Polygon Mainnet",
+                "nativeCurrency": "POL",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "polygon-mainnet",
+                    "type": "infura",
+                    "url": "https://polygon-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Optimism Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "optimism-mainnet",
+                    "type": "infura",
+                    "url": "https://optimism-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa4b1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa4b1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Arbitrum One",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "arbitrum-mainnet",
+                    "type": "infura",
+                    "url": "https://arbitrum-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xaa36a7": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xaa36a7",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sepolia",
+                "nativeCurrency": "SepoliaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sepolia",
+                    "type": "infura",
+                    "url": "https://sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe705": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe705",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea Sepolia",
+                "nativeCurrency": "LineaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-sepolia",
+                    "type": "infura",
+                    "url": "https://linea-sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe708": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe708",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-mainnet",
+                    "type": "infura",
+                    "url": "https://linea-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+            },
+            "networksMetadata": Object {},
+            "selectedNetworkClientId": "mainnet",
+          }
+        `);
+      });
+    });
+
+    it('initializes the state with the specified additional networks from the option `additionalDefaultNetworks` if provided', async () => {
+      await withController(
+        {
+          additionalDefaultNetworks: [
+            ChainId[BuiltInNetworkName.MegaETHTestnet],
+          ],
+        },
+        ({ controller }) => {
+          expect(controller.state).toMatchInlineSnapshot(`
+            Object {
+              "networkConfigurationsByChainId": Object {
+                "0x1": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0x1",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Ethereum Mainnet",
+                  "nativeCurrency": "ETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "mainnet",
+                      "type": "infura",
+                      "url": "https://mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0x18c6": Object {
+                  "blockExplorerUrls": Array [
+                    "https://megaexplorer.xyz",
+                  ],
+                  "chainId": "0x18c6",
+                  "defaultBlockExplorerUrlIndex": 0,
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Mega Testnet",
+                  "nativeCurrency": "MegaETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "megaeth-testnet",
+                      "type": "custom",
+                      "url": "https://carrot.megaeth.com/rpc",
+                    },
+                  ],
+                },
+                "0x2105": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0x2105",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Base Mainnet",
+                  "nativeCurrency": "ETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "base-mainnet",
+                      "type": "infura",
+                      "url": "https://base-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0x38": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0x38",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "BSC Mainnet",
+                  "nativeCurrency": "BNB",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "bsc-mainnet",
+                      "type": "infura",
+                      "url": "https://bsc-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0x531": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0x531",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Sei Mainnet",
+                  "nativeCurrency": "SEI",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "sei-mainnet",
+                      "type": "infura",
+                      "url": "https://sei-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0x89": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0x89",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Polygon Mainnet",
+                  "nativeCurrency": "POL",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "polygon-mainnet",
+                      "type": "infura",
+                      "url": "https://polygon-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0xa": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0xa",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Optimism Mainnet",
+                  "nativeCurrency": "ETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "optimism-mainnet",
+                      "type": "infura",
+                      "url": "https://optimism-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0xa4b1": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0xa4b1",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Arbitrum One",
+                  "nativeCurrency": "ETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "arbitrum-mainnet",
+                      "type": "infura",
+                      "url": "https://arbitrum-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0xaa36a7": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0xaa36a7",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Sepolia",
+                  "nativeCurrency": "SepoliaETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "sepolia",
+                      "type": "infura",
+                      "url": "https://sepolia.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0xe705": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0xe705",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Linea Sepolia",
+                  "nativeCurrency": "LineaETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "linea-sepolia",
+                      "type": "infura",
+                      "url": "https://linea-sepolia.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+                "0xe708": Object {
+                  "blockExplorerUrls": Array [],
+                  "chainId": "0xe708",
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Linea",
+                  "nativeCurrency": "ETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [],
+                      "networkClientId": "linea-mainnet",
+                      "type": "infura",
+                      "url": "https://linea-mainnet.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+              },
+              "networksMetadata": Object {},
+              "selectedNetworkClientId": "mainnet",
+            }
+          `);
+        },
+      );
+    });
+
+    it('merges the given state into the default state', async () => {
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: TESTNET.networkType,
+            networkConfigurationsByChainId: {
+              [TESTNET.chainId]: {
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: TESTNET.chainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: TESTNET.name,
+                nativeCurrency: TESTNET.nativeCurrency,
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://failover.endpoint'],
+                    name: TESTNET.name,
+                    networkClientId: TESTNET.networkType,
+                    type: RpcEndpointType.Infura,
+                    url: 'https://sepolia.infura.io/v3/{infuraProjectId}',
+                  },
+                ],
+              },
+            },
+            networksMetadata: {
+              [TESTNET.networkType]: {
+                EIPS: { 1559: true },
+                status: NetworkStatus.Unknown,
+              },
+            },
+          },
+        },
+        ({ controller }) => {
+          expect(controller.state).toMatchInlineSnapshot(`
+            Object {
+              "networkConfigurationsByChainId": Object {
+                "0xaa36a7": Object {
+                  "blockExplorerUrls": Array [
+                    "https://block.explorer",
+                  ],
+                  "chainId": "0xaa36a7",
+                  "defaultBlockExplorerUrlIndex": 0,
+                  "defaultRpcEndpointIndex": 0,
+                  "name": "Sepolia",
+                  "nativeCurrency": "SepoliaETH",
+                  "rpcEndpoints": Array [
+                    Object {
+                      "failoverUrls": Array [
+                        "https://failover.endpoint",
+                      ],
+                      "name": "Sepolia",
+                      "networkClientId": "sepolia",
+                      "type": "infura",
+                      "url": "https://sepolia.infura.io/v3/{infuraProjectId}",
+                    },
+                  ],
+                },
+              },
+              "networksMetadata": Object {
+                "sepolia": Object {
+                  "EIPS": Object {
+                    "1559": true,
+                  },
+                  "status": "unknown",
+                },
+              },
+              "selectedNetworkClientId": "sepolia",
+            }
+          `);
+        },
+      );
+    });
+  });
+
+  describe('enableRpcFailover', () => {
+    describe('if the controller was initialized with isRpcFailoverEnabled = false', () => {
+      it('calls enableRpcFailover on only the network clients whose RPC endpoints have configured failover URLs', async () => {
+        await withController(
+          {
+            isRpcFailoverEnabled: false,
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                  InfuraNetworkType.mainnet,
+                  {
+                    rpcEndpoints: [
+                      buildInfuraRpcEndpoint(InfuraNetworkType.mainnet, {
+                        failoverUrls: [],
+                      }),
+                    ],
+                  },
+                ),
+                '0x200': buildCustomNetworkConfiguration({
+                  chainId: '0x200',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                      failoverUrls: ['https://failover.endpoint/1'],
+                    }),
+                  ],
+                }),
+                '0x300': buildCustomNetworkConfiguration({
+                  chainId: '0x300',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                      failoverUrls: ['https://failover.endpoint/2'],
+                    }),
+                  ],
+                }),
+              },
+            },
+          },
+          async ({ controller }) => {
+            const originalCreateAutoManagedNetworkClient =
+              createAutoManagedNetworkClientModule.createAutoManagedNetworkClient;
+            const autoManagedNetworkClients: AutoManagedNetworkClient<NetworkClientConfiguration>[] =
+              [];
+            jest
+              .spyOn(
+                createAutoManagedNetworkClientModule,
+                'createAutoManagedNetworkClient',
+              )
+              .mockImplementation((...args) => {
+                const autoManagedNetworkClient =
+                  originalCreateAutoManagedNetworkClient(...args);
+                jest.spyOn(autoManagedNetworkClient, 'enableRpcFailover');
+                autoManagedNetworkClients.push(autoManagedNetworkClient);
+                return autoManagedNetworkClient;
+              });
+
+            controller.enableRpcFailover();
+
+            expect(autoManagedNetworkClients).toHaveLength(3);
+            expect(
+              autoManagedNetworkClients[0].enableRpcFailover,
+            ).not.toHaveBeenCalled();
+            expect(
+              autoManagedNetworkClients[1].enableRpcFailover,
+            ).toHaveBeenCalled();
+            expect(
+              autoManagedNetworkClients[2].enableRpcFailover,
+            ).toHaveBeenCalled();
+          },
+        );
+      });
+    });
+
+    describe('if the controller was initialized with isRpcFailoverEnabled = true', () => {
+      it('does not call createAutoManagedNetworkClient at all', async () => {
+        await withController(
+          {
+            isRpcFailoverEnabled: true,
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                  InfuraNetworkType.mainnet,
+                  {
+                    rpcEndpoints: [
+                      buildInfuraRpcEndpoint(InfuraNetworkType.mainnet, {
+                        failoverUrls: [],
+                      }),
+                    ],
+                  },
+                ),
+                '0x200': buildCustomNetworkConfiguration({
+                  chainId: '0x200',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                      failoverUrls: ['https://failover.endpoint/1'],
+                    }),
+                  ],
+                }),
+                '0x300': buildCustomNetworkConfiguration({
+                  chainId: '0x300',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                      failoverUrls: ['https://failover.endpoint/2'],
+                    }),
+                  ],
+                }),
+              },
+            },
+          },
+          async ({ controller }) => {
+            const originalCreateAutoManagedNetworkClient =
+              createAutoManagedNetworkClientModule.createAutoManagedNetworkClient;
+            const autoManagedNetworkClients: AutoManagedNetworkClient<NetworkClientConfiguration>[] =
+              [];
+            jest
+              .spyOn(
+                createAutoManagedNetworkClientModule,
+                'createAutoManagedNetworkClient',
+              )
+              .mockImplementation((...args) => {
+                const autoManagedNetworkClient =
+                  originalCreateAutoManagedNetworkClient(...args);
+                jest.spyOn(autoManagedNetworkClient, 'enableRpcFailover');
+                autoManagedNetworkClients.push(autoManagedNetworkClient);
+                return autoManagedNetworkClient;
+              });
+
+            controller.enableRpcFailover();
+
+            expect(autoManagedNetworkClients).toHaveLength(0);
+          },
+        );
+      });
+    });
+  });
+
+  describe('disableRpcFailover', () => {
+    describe('if the controller was initialized with isRpcFailoverEnabled = true', () => {
+      it('calls disableRpcFailover on only the network clients whose RPC endpoints have configured failover URLs', async () => {
+        await withController(
+          {
+            isRpcFailoverEnabled: true,
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                  InfuraNetworkType.mainnet,
+                  {
+                    rpcEndpoints: [
+                      buildInfuraRpcEndpoint(InfuraNetworkType.mainnet, {
+                        failoverUrls: [],
+                      }),
+                    ],
+                  },
+                ),
+                '0x200': buildCustomNetworkConfiguration({
+                  chainId: '0x200',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                      failoverUrls: ['https://failover.endpoint/1'],
+                    }),
+                  ],
+                }),
+                '0x300': buildCustomNetworkConfiguration({
+                  chainId: '0x300',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                      failoverUrls: ['https://failover.endpoint/2'],
+                    }),
+                  ],
+                }),
+              },
+            },
+          },
+          async ({ controller }) => {
+            const originalCreateAutoManagedNetworkClient =
+              createAutoManagedNetworkClientModule.createAutoManagedNetworkClient;
+            const autoManagedNetworkClients: AutoManagedNetworkClient<NetworkClientConfiguration>[] =
+              [];
+            jest
+              .spyOn(
+                createAutoManagedNetworkClientModule,
+                'createAutoManagedNetworkClient',
+              )
+              .mockImplementation((...args) => {
+                const autoManagedNetworkClient =
+                  originalCreateAutoManagedNetworkClient(...args);
+                jest.spyOn(autoManagedNetworkClient, 'disableRpcFailover');
+                autoManagedNetworkClients.push(autoManagedNetworkClient);
+                return autoManagedNetworkClient;
+              });
+
+            controller.disableRpcFailover();
+
+            expect(autoManagedNetworkClients).toHaveLength(3);
+            expect(
+              autoManagedNetworkClients[0].disableRpcFailover,
+            ).not.toHaveBeenCalled();
+            expect(
+              autoManagedNetworkClients[1].disableRpcFailover,
+            ).toHaveBeenCalled();
+            expect(
+              autoManagedNetworkClients[2].disableRpcFailover,
+            ).toHaveBeenCalled();
+          },
+        );
+      });
+    });
+
+    describe('if the controller was initialized with isRpcFailoverEnabled = false', () => {
+      it('does not call createAutoManagedNetworkClient at all', async () => {
+        await withController(
+          {
+            isRpcFailoverEnabled: false,
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                  InfuraNetworkType.mainnet,
+                  {
+                    rpcEndpoints: [
+                      buildInfuraRpcEndpoint(InfuraNetworkType.mainnet, {
+                        failoverUrls: [],
+                      }),
+                    ],
+                  },
+                ),
+                '0x200': buildCustomNetworkConfiguration({
+                  chainId: '0x200',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                      failoverUrls: ['https://failover.endpoint/1'],
+                    }),
+                  ],
+                }),
+                '0x300': buildCustomNetworkConfiguration({
+                  chainId: '0x300',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                      failoverUrls: ['https://failover.endpoint/2'],
+                    }),
+                  ],
+                }),
+              },
+            },
+          },
+          async ({ controller }) => {
+            const originalCreateAutoManagedNetworkClient =
+              createAutoManagedNetworkClientModule.createAutoManagedNetworkClient;
+            const autoManagedNetworkClients: AutoManagedNetworkClient<NetworkClientConfiguration>[] =
+              [];
+            jest
+              .spyOn(
+                createAutoManagedNetworkClientModule,
+                'createAutoManagedNetworkClient',
+              )
+              .mockImplementation((...args) => {
+                const autoManagedNetworkClient =
+                  originalCreateAutoManagedNetworkClient(...args);
+                jest.spyOn(autoManagedNetworkClient, 'disableRpcFailover');
+                autoManagedNetworkClients.push(autoManagedNetworkClient);
+                return autoManagedNetworkClient;
+              });
+
+            controller.disableRpcFailover();
+
+            expect(autoManagedNetworkClients).toHaveLength(0);
+          },
+        );
+      });
+    });
+  });
+
+  describe('destroy', () => {
+    it('does not throw if called before the provider is initialized', async () => {
+      await withController(async ({ controller }) => {
+        expect(await controller.destroy()).toBeUndefined();
+      });
+    });
+
+    it('stops the block tracker for the currently selected network as long as the provider has been initialized', async () => {
+      await withController(async ({ controller }) => {
+        const fakeProvider = buildFakeProvider([
+          {
+            request: { method: 'eth_blockNumber' },
+            response: { result: '0x1' },
+          },
+        ]);
+        const fakeNetworkClient = buildFakeClient(fakeProvider);
+        mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+        await controller.initializeProvider();
+        const { blockTracker } = controller.getProviderAndBlockTracker();
+        assert(blockTracker, 'Block tracker is somehow unset');
+        // The block tracker starts running after a listener is attached
+        blockTracker.addListener('latest', () => {
+          // do nothing
+        });
+        expect(blockTracker.isRunning()).toBe(true);
+
+        await controller.destroy();
+
+        expect(blockTracker.isRunning()).toBe(false);
+      });
+    });
+  });
+
+  describe('initializeProvider', () => {
+    describe.each([
+      ['given no options', []],
+      ['given lookupNetwork = true', [{ lookupNetwork: true }]],
+      ['given lookupNetwork = false', [{ lookupNetwork: false }]],
+    ])('%s', (_description, args) => {
+      for (const infuraNetworkType of INFURA_NETWORKS) {
+        const infuraChainId = ChainId[infuraNetworkType];
+
+        describe(`when the selected network client represents the Infura network "${infuraNetworkType}"`, () => {
+          it('sets the globally selected provider to the one from the corresponding network client', async () => {
+            const infuraProjectId = 'some-infura-project-id';
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: infuraNetworkType,
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]:
+                      buildInfuraNetworkConfiguration(infuraNetworkType),
+                  },
+                },
+                infuraProjectId,
+              },
+              async ({ controller }) => {
+                const fakeProvider = buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test_method',
+                      params: [],
+                    },
+                    response: {
+                      result: 'test response',
+                    },
+                  },
+                ]);
+                const fakeNetworkClient = buildFakeClient(fakeProvider);
+                createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+                await controller.initializeProvider(...args);
+
+                const networkClient = controller.getSelectedNetworkClient();
+                assert(networkClient, 'Network client not set');
+                const result = await networkClient.provider.request({
+                  id: 1,
+                  jsonrpc: '2.0',
+                  method: 'test_method',
+                  params: [],
+                });
+                expect(result).toBe('test response');
+              },
+            );
+          });
+
+          if (args.length === 0 || args[0].lookupNetwork) {
+            lookupNetworkTests({
+              expectedNetworkClientType: NetworkClientType.Infura,
+              expectedNetworkClientId: infuraNetworkType,
+              initialState: {
+                selectedNetworkClientId: infuraNetworkType,
+              },
+              operation: async (controller: NetworkController) => {
+                await controller.initializeProvider(...args);
+              },
+            });
+          } else {
+            it('does not update networksMetadata even if network details request would have resolved successfully', async () => {
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networksMetadata: {
+                      [infuraNetworkType]: {
+                        EIPS: { 1559: false },
+                        status: NetworkStatus.Unknown,
+                      },
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  await setFakeProvider(controller, {
+                    stubs: [
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                          params: ['latest', false],
+                        },
+                        response: {
+                          result: {
+                            baseFeePerGas: '0x1',
+                          },
+                        },
+                      },
+                    ],
+                    stubLookupNetworkWhileSetting: true,
+                  });
+
+                  await controller.initializeProvider(...args);
+
+                  expect(
+                    controller.state.networksMetadata[infuraNetworkType],
+                  ).toStrictEqual({
+                    EIPS: { 1559: false },
+                    status: NetworkStatus.Unknown,
+                  });
+                },
+              );
+            });
+          }
+        });
+      }
+
+      describe('when the selected network client represents a custom RPC endpoint', () => {
+        it('sets the globally selected provider to the one from the corresponding network client', async () => {
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+            },
+            async ({ controller }) => {
+              const fakeProvider = buildFakeProvider([
+                {
+                  request: {
+                    method: 'test_method',
+                    params: [],
+                  },
+                  response: {
+                    result: 'test response',
+                  },
+                },
+              ]);
+              const fakeNetworkClient = buildFakeClient(fakeProvider);
+              createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+              await controller.initializeProvider(...args);
+
+              const networkClient = controller.getSelectedNetworkClient();
+              assert(networkClient, 'Network client not set');
+              const { result } = await promisify(
+                networkClient.provider.sendAsync,
+              ).call(networkClient.provider, {
+                id: 1,
+                jsonrpc: '2.0',
+                method: 'test_method',
+                params: [],
+              });
+              expect(result).toBe('test response');
+            },
+          );
+        });
+
+        if (args.length === 0 || args[0].lookupNetwork) {
+          lookupNetworkTests({
+            expectedNetworkClientType: NetworkClientType.Custom,
+            expectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            initialState: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TEST',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network',
+                    }),
+                  ],
+                }),
+              },
+            },
+            operation: async (controller: NetworkController) => {
+              await controller.initializeProvider(...args);
+            },
+          });
+        } else {
+          it('does not update networksMetadata even if network details request would have resolved successfully', async () => {
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      nativeCurrency: 'TEST',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.network',
+                        }),
+                      ],
+                    }),
+                  },
+                  networksMetadata: {
+                    'AAAA-AAAA-AAAA-AAAA': {
+                      EIPS: { 1559: false },
+                      status: NetworkStatus.Unknown,
+                    },
+                  },
+                },
+              },
+              async ({ controller }) => {
+                await setFakeProvider(controller, {
+                  stubs: [
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                        params: ['latest', false],
+                      },
+                      response: {
+                        result: {
+                          baseFeePerGas: '0x1',
+                        },
+                      },
+                    },
+                  ],
+                  stubLookupNetworkWhileSetting: true,
+                });
+
+                await controller.initializeProvider(...args);
+
+                expect(
+                  controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA'],
+                ).toStrictEqual({
+                  EIPS: { 1559: false },
+                  status: NetworkStatus.Unknown,
+                });
+              },
+            );
+          });
+        }
+      });
+    });
+
+    it('initializes the provider synchronously if lookupNetwork is false', async () => {
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  }),
+                ],
+              }),
+            },
+          },
+        },
+        async ({ controller }) => {
+          const fakeProvider = buildFakeProvider([
+            {
+              request: {
+                method: 'test_method',
+                params: [],
+              },
+              response: {
+                result: 'test response',
+              },
+            },
+          ]);
+
+          const fakeNetworkClient = buildFakeClient(fakeProvider);
+          createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+
+          const result = controller.initializeProvider({
+            lookupNetwork: false,
+          });
+
+          expect(result).toBeUndefined();
+        },
+      );
+    });
+  });
+
+  describe('getProviderAndBlockTracker', () => {
+    it('returns objects that proxy to the provider and block tracker as long as the provider has been initialized', async () => {
+      await withController(async ({ controller }) => {
+        const fakeProvider = buildFakeProvider();
+        const fakeNetworkClient = buildFakeClient(fakeProvider);
+        mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+        await controller.initializeProvider();
+
+        const { provider, blockTracker } =
+          controller.getProviderAndBlockTracker();
+
+        expect(provider).toHaveProperty('request');
+        expect(blockTracker).toHaveProperty('checkForLatestBlock');
+      });
+    });
+
+    it("returns undefined for both the provider and block tracker if the provider hasn't been initialized yet", async () => {
+      await withController(async ({ controller }) => {
+        const { provider, blockTracker } =
+          controller.getProviderAndBlockTracker();
+
+        expect(provider).toBeUndefined();
+        expect(blockTracker).toBeUndefined();
+      });
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraChainId = ChainId[infuraNetworkType];
+      const infuraNetworkNickname = NetworkNickname[infuraNetworkType];
+
+      describe(`when the selectedNetworkClientId is changed to represent the Infura network "${infuraNetworkType}"`, () => {
+        it(`returns a provider object that was pointed to another network before the switch and is now pointed to ${infuraNetworkNickname} afterward`, async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  '0x1337': buildCustomNetworkConfiguration({
+                    nativeCurrency: 'TEST',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller }) => {
+              const fakeProviders = [
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test_method',
+                    },
+                    response: {
+                      result: 'test response 1',
+                    },
+                  },
+                ]),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test_method',
+                    },
+                    response: {
+                      result: 'test response 2',
+                    },
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.initializeProvider();
+              const { provider } = controller.getProviderAndBlockTracker();
+              assert(provider, 'Provider not set');
+
+              const result1 = await provider.request({
+                id: '1',
+                jsonrpc: '2.0',
+                method: 'test_method',
+              });
+              expect(result1).toBe('test response 1');
+
+              await controller.setActiveNetwork(infuraNetworkType);
+              const result2 = await provider.request({
+                id: '2',
+                jsonrpc: '2.0',
+                method: 'test_method',
+              });
+              expect(result2).toBe('test response 2');
+            },
+          );
+        });
+      });
+    }
+
+    describe('when the selectedNetworkClientId is changed to represent a custom RPC endpoint', () => {
+      it('returns a provider object that was pointed to another network before the switch and is now pointed to the new network', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            const fakeProviders = [
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'test_method',
+                  },
+                  response: {
+                    result: 'test response 1',
+                  },
+                },
+              ]),
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'test_method',
+                  },
+                  response: {
+                    result: 'test response 2',
+                  },
+                },
+              ]),
+            ];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.initializeProvider();
+            const { provider } = controller.getProviderAndBlockTracker();
+            assert(provider, 'Provider not set');
+
+            const result1 = await provider.request({
+              id: '1',
+              jsonrpc: '2.0',
+              method: 'test_method',
+            });
+            expect(result1).toBe('test response 1');
+
+            await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+            const result2 = await provider.request({
+              id: '2',
+              jsonrpc: '2.0',
+              method: 'test_method',
+            });
+            expect(result2).toBe('test response 2');
+          },
+        );
+      });
+    });
+  });
+
+  describe.each([
+    [
+      'findNetworkClientIdByChainId',
+      (
+        {
+          controller,
+        }: {
+          controller: NetworkController;
+        },
+        args: Parameters<NetworkController['findNetworkClientIdByChainId']>,
+      ): ReturnType<NetworkController['findNetworkClientIdByChainId']> =>
+        controller.findNetworkClientIdByChainId(...args),
+    ],
+    [
+      'NetworkController:findNetworkClientIdByChainId',
+      (
+        {
+          messenger,
+        }: {
+          messenger: RootMessenger;
+        },
+        args: Parameters<NetworkController['findNetworkClientIdByChainId']>,
+      ): ReturnType<NetworkController['findNetworkClientIdByChainId']> =>
+        messenger.call(
+          'NetworkController:findNetworkClientIdByChainId',
+          ...args,
+        ),
+    ],
+  ])('%s', (_desc, findNetworkClientIdByChainId) => {
+    it('returns the ID of the network client corresponding to the default RPC endpoint for the given chain', async () => {
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337' as const,
+                defaultRpcEndpointIndex: 1,
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  }),
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  }),
+                ],
+              }),
+            },
+          }),
+        },
+        ({ controller, messenger }) => {
+          const networkClientId = findNetworkClientIdByChainId(
+            { controller, messenger },
+            ['0x1337'],
+          );
+
+          expect(networkClientId).toBe('BBBB-BBBB-BBBB-BBBB');
+        },
+      );
+    });
+
+    it('throws if there are no network clients registered for the given chain', async () => {
+      await withController(({ controller, messenger }) => {
+        expect(() =>
+          findNetworkClientIdByChainId({ controller, messenger }, ['0x999999']),
+        ).toThrow('Invalid chain ID "0x999999"');
+      });
+    });
+  });
+
+  describe('getNetworkClientById', () => {
+    describe('if passed an Infura network client ID', () => {
+      describe('if the ID refers to an existing Infura network client', () => {
+        it('returns the network client', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              infuraProjectId,
+            },
+            async ({ controller }) => {
+              const networkClient = controller.getNetworkClientById(
+                NetworkType.mainnet,
+              );
+
+              expect(networkClient.configuration).toStrictEqual({
+                chainId: ChainId[InfuraNetworkType.mainnet],
+                failoverRpcUrls: [],
+                infuraProjectId,
+                network: InfuraNetworkType.mainnet,
+                ticker: NetworksTicker[InfuraNetworkType.mainnet],
+                type: NetworkClientType.Infura,
+              });
+            },
+          );
+        });
+      });
+
+      describe('if the ID does not refer to an existing Infura network client', () => {
+        it('throws', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration(),
+                  },
+                }),
+              infuraProjectId,
+            },
+            async ({ controller }) => {
+              expect(() =>
+                controller.getNetworkClientById(NetworkType.mainnet),
+              ).toThrow(
+                'No Infura network client was found with the ID "mainnet".',
+              );
+            },
+          );
+        });
+      });
+    });
+
+    describe('if passed a custom network client ID', () => {
+      describe('if the ID refers to an existing custom network client', () => {
+        it('returns the network client', async () => {
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      nativeCurrency: 'TEST',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          failoverUrls: ['https://failover.endpoint'],
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.network',
+                        }),
+                      ],
+                    }),
+                  },
+                }),
+              infuraProjectId: 'some-infura-project-id',
+            },
+            async ({ controller }) => {
+              const networkClient = controller.getNetworkClientById(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+
+              expect(networkClient.configuration).toStrictEqual({
+                chainId: '0x1337',
+                failoverRpcUrls: ['https://failover.endpoint'],
+                rpcUrl: 'https://test.network',
+                ticker: 'TEST',
+                type: NetworkClientType.Custom,
+              });
+            },
+          );
+        });
+      });
+
+      describe('if the ID does not refer to an existing custom network client', () => {
+        it('throws', async () => {
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x2448': buildCustomNetworkConfiguration({
+                      chainId: '0x2448',
+                    }),
+                  },
+                }),
+            },
+            async ({ controller }) => {
+              expect(() => controller.getNetworkClientById('0x1337')).toThrow(
+                'No custom network client was found with the ID "0x1337".',
+              );
+            },
+          );
+        });
+      });
+    });
+  });
+
+  describe('getNetworkClientRegistry', () => {
+    describe('if no network configurations were specified at initialization', () => {
+      it('returns network clients for default RPC endpoints, keyed by network client ID', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+
+            expect(controller.getNetworkClientRegistry()).toStrictEqual({
+              'arbitrum-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0xa4b1',
+                  ticker: 'ETH',
+                  network: InfuraNetworkType['arbitrum-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'base-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0x2105',
+                  ticker: 'ETH',
+                  network: InfuraNetworkType['base-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'bsc-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0x38',
+                  ticker: 'BNB',
+                  network: InfuraNetworkType['bsc-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'linea-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0xe708',
+                  ticker: 'ETH',
+                  network: InfuraNetworkType['linea-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'linea-sepolia': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0xe705',
+                  ticker: 'LineaETH',
+                  network: InfuraNetworkType['linea-sepolia'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              mainnet: {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0x1',
+                  ticker: 'ETH',
+                  network: InfuraNetworkType.mainnet,
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'optimism-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0xa',
+                  ticker: 'ETH',
+                  network: InfuraNetworkType['optimism-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'polygon-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0x89',
+                  ticker: 'POL',
+                  network: InfuraNetworkType['polygon-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'sei-mainnet': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0x531',
+                  ticker: 'SEI',
+                  network: InfuraNetworkType['sei-mainnet'],
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              sepolia: {
+                blockTracker: expect.anything(),
+                configuration: {
+                  type: NetworkClientType.Infura,
+                  failoverRpcUrls: [],
+                  infuraProjectId,
+                  chainId: '0xaa36a7',
+                  ticker: 'SepoliaETH',
+                  network: InfuraNetworkType.sepolia,
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+            });
+          },
+        );
+      });
+    });
+
+    describe('if some network configurations were specified at initialization', () => {
+      it('returns network clients for all RPC endpoints within any defined network configurations, keyed by network client ID, and does not include Infura-supported chains by default', async () => {
+        await withController(
+          {
+            state:
+              buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                networkConfigurationsByChainId: {
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    nativeCurrency: 'TOKEN1',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        failoverUrls: ['https://first.failover.endpoint'],
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://test.network/1',
+                      }),
+                    ],
+                  }),
+                  '0x2448': buildCustomNetworkConfiguration({
+                    chainId: '0x2448',
+                    nativeCurrency: 'TOKEN2',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        failoverUrls: ['https://second.failover.endpoint'],
+                        networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                        url: 'https://test.network/2',
+                      }),
+                    ],
+                  }),
+                },
+              }),
+          },
+          async ({ controller }) => {
+            mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+
+            expect(controller.getNetworkClientRegistry()).toStrictEqual({
+              'AAAA-AAAA-AAAA-AAAA': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  chainId: '0x1337',
+                  failoverRpcUrls: ['https://first.failover.endpoint'],
+                  rpcUrl: 'https://test.network/1',
+                  ticker: 'TOKEN1',
+                  type: NetworkClientType.Custom,
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+              'BBBB-BBBB-BBBB-BBBB': {
+                blockTracker: expect.anything(),
+                configuration: {
+                  chainId: '0x2448',
+                  failoverRpcUrls: ['https://second.failover.endpoint'],
+                  rpcUrl: 'https://test.network/2',
+                  ticker: 'TOKEN2',
+                  type: NetworkClientType.Custom,
+                },
+                provider: expect.anything(),
+                destroy: expect.any(Function),
+                enableRpcFailover: expect.any(Function),
+                disableRpcFailover: expect.any(Function),
+              },
+            });
+          },
+        );
+      });
+    });
+  });
+
+  describe('lookupNetwork', () => {
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      describe(`given a network client ID that represents the Infura network "${infuraNetworkType}"`, () => {
+        lookupNetworkTests({
+          expectedNetworkClientType: NetworkClientType.Infura,
+          expectedNetworkClientId: infuraNetworkType,
+          operation: async (controller) => {
+            await controller.lookupNetwork(infuraNetworkType);
+          },
+          shouldTestInfuraMessengerEvents: false,
+        });
+      });
+    }
+
+    describe('given a network client that represents a custom RPC endpoint', () => {
+      const networkClientId = 'BBBB-BBBB-BBBB-BBBB';
+
+      lookupNetworkTests({
+        expectedNetworkClientType: NetworkClientType.Custom,
+        expectedNetworkClientId: networkClientId,
+        initialState: {
+          selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              nativeCurrency: 'TEST',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.network/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.network/2',
+                }),
+              ],
+            }),
+          },
+        },
+        operation: async (controller) => {
+          await controller.lookupNetwork(networkClientId);
+        },
+        shouldTestInfuraMessengerEvents: false,
+      });
+    });
+
+    describe('given an invalid network client ID', () => {
+      it('throws an error', async () => {
+        await withController(async ({ controller }) => {
+          await expect(() =>
+            controller.lookupNetwork('non-existent-network-id'),
+          ).rejects.toThrow(
+            'No custom network client was found with the ID "non-existent-network-id".',
+          );
+        });
+      });
+    });
+
+    describe('not given a network client ID', () => {
+      for (const infuraNetworkType of INFURA_NETWORKS) {
+        const infuraChainId = ChainId[infuraNetworkType];
+
+        describe(`when the selected network client represents the Infura network "${infuraNetworkType}"`, () => {
+          describe('if the provider has been not been initialized yet', () => {
+            it('does not update state', async () => {
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]:
+                        buildInfuraNetworkConfiguration(infuraNetworkType),
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const stateChangeListener = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:stateChange',
+                    stateChangeListener,
+                  );
+
+                  await controller.lookupNetwork();
+
+                  expect(stateChangeListener).not.toHaveBeenCalled();
+                },
+              );
+            });
+
+            it('does not publish NetworkController:infuraIsUnblocked', async () => {
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]:
+                        buildInfuraNetworkConfiguration(infuraNetworkType),
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const infuraIsUnblockedListener = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:infuraIsUnblocked',
+                    infuraIsUnblockedListener,
+                  );
+
+                  await controller.lookupNetwork();
+
+                  expect(infuraIsUnblockedListener).not.toHaveBeenCalled();
+                },
+              );
+            });
+
+            it('does not publish NetworkController:infuraIsBlocked', async () => {
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]:
+                        buildInfuraNetworkConfiguration(infuraNetworkType),
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const infuraIsBlockedListener = jest.fn();
+                  messenger.subscribe(
+                    'NetworkController:infuraIsBlocked',
+                    infuraIsBlockedListener,
+                  );
+
+                  await controller.lookupNetwork();
+
+                  expect(infuraIsBlockedListener).not.toHaveBeenCalled();
+                },
+              );
+            });
+          });
+
+          describe('if the network was switched after the eth_getBlockByNumber request started but before it completed', () => {
+            it('stores the network status of the second network, not the first', async () => {
+              const infuraProjectId = 'some-infura-project-id';
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]:
+                        buildInfuraNetworkConfiguration(infuraNetworkType),
+                      '0x1337': buildCustomNetworkConfiguration({
+                        chainId: '0x1337',
+                        rpcEndpoints: [
+                          buildCustomRpcEndpoint({
+                            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          }),
+                        ],
+                      }),
+                    },
+                  },
+                  infuraProjectId,
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      // Called during provider initialization
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                      },
+                      // Called via `lookupNetwork` directly
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                        beforeCompleting: (): void => {
+                          // We are purposefully not awaiting this promise.
+                          // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                          controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      // Called when switching networks
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        error: GENERIC_JSON_RPC_ERROR,
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(
+                    controller.state.networksMetadata[infuraNetworkType].status,
+                  ).toBe('available');
+
+                  await controller.lookupNetwork();
+
+                  expect(
+                    controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                      .status,
+                  ).toBe('unknown');
+                },
+              );
+            });
+
+            it('stores the EIP-1559 support of the second network, not the first', async () => {
+              const infuraProjectId = 'some-infura-project-id';
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]:
+                        buildInfuraNetworkConfiguration(infuraNetworkType),
+                      '0x1337': buildCustomNetworkConfiguration({
+                        chainId: '0x1337',
+                        rpcEndpoints: [
+                          buildCustomRpcEndpoint({
+                            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          }),
+                        ],
+                      }),
+                    },
+                  },
+                  infuraProjectId,
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      // Called during provider initialization
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: {
+                          result: POST_1559_BLOCK,
+                        },
+                      },
+                      // Called via `lookupNetwork` directly
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: {
+                          result: POST_1559_BLOCK,
+                        },
+                        beforeCompleting: (): void => {
+                          // We are purposefully not awaiting this promise.
+                          // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                          controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      // Called when switching networks
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: {
+                          result: PRE_1559_BLOCK,
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(
+                    controller.state.networksMetadata[infuraNetworkType]
+                      .EIPS[1559],
+                  ).toBe(true);
+
+                  await controller.lookupNetwork();
+
+                  expect(
+                    controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                      .EIPS[1559],
+                  ).toBe(false);
+                },
+              );
+            });
+
+            it('emits infuraIsUnblocked, not infuraIsBlocked, assuming that the first network was blocked', async () => {
+              const infuraProjectId = 'some-infura-project-id';
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]:
+                        buildInfuraNetworkConfiguration(infuraNetworkType),
+                      '0x1337': buildCustomNetworkConfiguration({
+                        chainId: '0x1337',
+                        nativeCurrency: 'TEST',
+                        rpcEndpoints: [
+                          buildCustomRpcEndpoint({
+                            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                            url: 'https://test.network',
+                          }),
+                        ],
+                      }),
+                    },
+                  },
+                  infuraProjectId,
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      // Called during provider initialization
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                      },
+                      // Called via `lookupNetwork` directly
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                        beforeCompleting: (): void => {
+                          // We are purposefully not awaiting this promise.
+                          // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                          controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      // Called when switching networks
+                      {
+                        request: {
+                          method: 'eth_getBlockByNumber',
+                        },
+                        response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  const promiseForInfuraIsUnblockedEvents =
+                    waitForPublishedEvents({
+                      messenger,
+                      eventType: 'NetworkController:infuraIsUnblocked',
+                    });
+                  const promiseForNoInfuraIsBlockedEvents =
+                    waitForPublishedEvents({
+                      messenger,
+                      eventType: 'NetworkController:infuraIsBlocked',
+                      count: 0,
+                    });
+
+                  await waitForStateChanges({
+                    messenger,
+                    propertyPath: [
+                      'networksMetadata',
+                      'AAAA-AAAA-AAAA-AAAA',
+                      'status',
+                    ],
+                    operation: async () => {
+                      await controller.lookupNetwork();
+                    },
+                  });
+
+                  await expect(
+                    promiseForInfuraIsUnblockedEvents,
+                  ).toBeFulfilled();
+                  await expect(
+                    promiseForNoInfuraIsBlockedEvents,
+                  ).toBeFulfilled();
+                },
+              );
+            });
+          });
+
+          describe('if all subscriptions are removed from the messenger before the call to lookupNetwork completes', () => {
+            it('does not throw an error', async () => {
+              const infuraProjectId = 'some-infura-project-id';
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                  },
+                  infuraProjectId,
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProvider = buildFakeProvider([
+                    // Called during provider initialization
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                    },
+                    // Called via `lookupNetwork` directly
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                    },
+                  ]);
+                  const fakeNetworkClient = buildFakeClient(fakeProvider);
+                  createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+                  await controller.initializeProvider();
+
+                  const lookupNetworkPromise = controller.lookupNetwork();
+                  messenger.clearSubscriptions();
+                  expect(await lookupNetworkPromise).toBeUndefined();
+                },
+              );
+            });
+          });
+
+          describe('if removing the networkDidChange subscription fails for an unknown reason', () => {
+            it('re-throws the error', async () => {
+              const infuraProjectId = 'some-infura-project-id';
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: infuraNetworkType,
+                  },
+                  infuraProjectId,
+                },
+                async ({ controller, networkControllerMessenger }) => {
+                  const fakeProvider = buildFakeProvider([
+                    // Called during provider initialization
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                    },
+                    // Called via `lookupNetwork` directly
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                    },
+                  ]);
+                  const fakeNetworkClient = buildFakeClient(fakeProvider);
+                  createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+                  await controller.initializeProvider();
+
+                  const lookupNetworkPromise = controller.lookupNetwork();
+                  const error = new Error('oops');
+                  jest
+                    .spyOn(networkControllerMessenger, 'unsubscribe')
+                    .mockImplementation((eventType) => {
+                      if (eventType === 'NetworkController:networkDidChange') {
+                        throw error;
+                      }
+                    });
+                  await expect(lookupNetworkPromise).rejects.toThrow(error);
+                },
+              );
+            });
+          });
+
+          lookupNetworkTests({
+            expectedNetworkClientType: NetworkClientType.Infura,
+            expectedNetworkClientId: infuraNetworkType,
+            initialState: {
+              selectedNetworkClientId: infuraNetworkType,
+            },
+            operation: async (controller) => {
+              await controller.lookupNetwork();
+            },
+          });
+        });
+      }
+
+      describe('when the selected network client represents a custom RPC endpoint', () => {
+        describe('if the provider has been not been initialized yet', () => {
+          it('does not update state', async () => {
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+              },
+              async ({ controller, messenger }) => {
+                const stateChangeListener = jest.fn();
+                messenger.subscribe(
+                  'NetworkController:stateChange',
+                  stateChangeListener,
+                );
+
+                await controller.lookupNetwork();
+
+                expect(stateChangeListener).not.toHaveBeenCalled();
+              },
+            );
+          });
+
+          it('does not publish NetworkController:infuraIsUnblocked', async () => {
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+              },
+              async ({ controller, messenger }) => {
+                const infuraIsUnblockedListener = jest.fn();
+                messenger.subscribe(
+                  'NetworkController:infuraIsUnblocked',
+                  infuraIsUnblockedListener,
+                );
+
+                await controller.lookupNetwork();
+
+                expect(infuraIsUnblockedListener).not.toHaveBeenCalled();
+              },
+            );
+          });
+
+          it('does not publish NetworkController:infuraIsBlocked', async () => {
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+              },
+              async ({ controller, messenger }) => {
+                const infuraIsBlockedListener = jest.fn();
+                messenger.subscribe(
+                  'NetworkController:infuraIsBlocked',
+                  infuraIsBlockedListener,
+                );
+
+                await controller.lookupNetwork();
+
+                expect(infuraIsBlockedListener).not.toHaveBeenCalled();
+              },
+            );
+          });
+        });
+
+        describe('if the network was switched after the eth_getBlockByNumber request started but before it completed', () => {
+          it('stores the network status of the second network, not the first', async () => {
+            const infuraProjectId = 'some-infura-project-id';
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                      TESTNET.networkType,
+                    ),
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+                infuraProjectId,
+              },
+              async ({ controller }) => {
+                const fakeProviders = [
+                  buildFakeProvider([
+                    // Called during provider initialization
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                    },
+                    // Called via `lookupNetwork` directly
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                      beforeCompleting: (): void => {
+                        // We are purposefully not awaiting this promise.
+                        // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                        controller.setProviderType(TESTNET.networkType);
+                      },
+                    },
+                  ]),
+                  buildFakeProvider([
+                    // Called when switching networks
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      error: GENERIC_JSON_RPC_ERROR,
+                    },
+                  ]),
+                ];
+                const fakeNetworkClients = [
+                  buildFakeClient(fakeProviders[0]),
+                  buildFakeClient(fakeProviders[1]),
+                ];
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === '0x1337') {
+                      return fakeNetworkClients[0];
+                    } else if (
+                      configuration.chainId === ChainId[TESTNET.networkType]
+                    ) {
+                      return fakeNetworkClients[1];
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                await controller.initializeProvider();
+                expect(
+                  controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                    .status,
+                ).toBe('available');
+
+                await controller.lookupNetwork();
+
+                expect(
+                  controller.state.networksMetadata[TESTNET.networkType].status,
+                ).toBe('unknown');
+              },
+            );
+          });
+
+          it('stores the EIP-1559 support of the second network, not the first', async () => {
+            const infuraProjectId = 'some-infura-project-id';
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                      TESTNET.networkType,
+                    ),
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+                infuraProjectId,
+              },
+              async ({ controller }) => {
+                const fakeProviders = [
+                  buildFakeProvider([
+                    // Called during provider initialization
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: {
+                        result: POST_1559_BLOCK,
+                      },
+                    },
+                    // Called via `lookupNetwork` directly
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: {
+                        result: POST_1559_BLOCK,
+                      },
+                      beforeCompleting: (): void => {
+                        // We are purposefully not awaiting this promise.
+                        // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                        controller.setProviderType(TESTNET.networkType);
+                      },
+                    },
+                  ]),
+                  buildFakeProvider([
+                    // Called when switching networks
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: {
+                        result: PRE_1559_BLOCK,
+                      },
+                    },
+                  ]),
+                ];
+                const fakeNetworkClients = [
+                  buildFakeClient(fakeProviders[0]),
+                  buildFakeClient(fakeProviders[1]),
+                ];
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === '0x1337') {
+                      return fakeNetworkClients[0];
+                    } else if (
+                      configuration.chainId === ChainId[TESTNET.networkType]
+                    ) {
+                      return fakeNetworkClients[1];
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                await controller.initializeProvider();
+                expect(
+                  controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                    .EIPS[1559],
+                ).toBe(true);
+
+                await controller.lookupNetwork();
+
+                expect(
+                  controller.state.networksMetadata[TESTNET.networkType]
+                    .EIPS[1559],
+                ).toBe(false);
+                expect(
+                  controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                    .EIPS[1559],
+                ).toBe(true);
+              },
+            );
+          });
+
+          it('emits infuraIsBlocked, not infuraIsUnblocked, if the second network was blocked and the first network was not', async () => {
+            const infuraProjectId = 'some-infura-project-id';
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                      TESTNET.networkType,
+                    ),
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+                infuraProjectId,
+              },
+              async ({ controller, messenger }) => {
+                const fakeProviders = [
+                  buildFakeProvider([
+                    // Called during provider initialization
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                    },
+                    // Called via `lookupNetwork` directly
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                      beforeCompleting: (): void => {
+                        // We are purposefully not awaiting this promise.
+                        // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                        controller.setProviderType(TESTNET.networkType);
+                      },
+                    },
+                  ]),
+                  buildFakeProvider([
+                    // Called when switching networks
+                    {
+                      request: {
+                        method: 'eth_getBlockByNumber',
+                      },
+                      error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                    },
+                  ]),
+                ];
+                const fakeNetworkClients = [
+                  buildFakeClient(fakeProviders[0]),
+                  buildFakeClient(fakeProviders[1]),
+                ];
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === '0x1337') {
+                      return fakeNetworkClients[0];
+                    } else if (
+                      configuration.chainId === ChainId[TESTNET.networkType]
+                    ) {
+                      return fakeNetworkClients[1];
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                await controller.initializeProvider();
+                const promiseForNoInfuraIsUnblockedEvents =
+                  waitForPublishedEvents({
+                    messenger,
+                    eventType: 'NetworkController:infuraIsUnblocked',
+                    count: 0,
+                  });
+                const promiseForInfuraIsBlockedEvents = waitForPublishedEvents({
+                  messenger,
+                  eventType: 'NetworkController:infuraIsBlocked',
+                });
+
+                await controller.lookupNetwork();
+
+                await expect(
+                  promiseForNoInfuraIsUnblockedEvents,
+                ).toBeFulfilled();
+                await expect(promiseForInfuraIsBlockedEvents).toBeFulfilled();
+              },
+            );
+          });
+        });
+
+        describe('if all subscriptions are removed from the messenger before the call to lookupNetwork completes', () => {
+          it('does not throw an error', async () => {
+            const infuraProjectId = 'some-infura-project-id';
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+                infuraProjectId,
+              },
+              async ({ controller, messenger }) => {
+                const fakeProvider = buildFakeProvider([
+                  // Called during provider initialization
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                  },
+                  // Called via `lookupNetwork` directly
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                  },
+                ]);
+                const fakeNetworkClient = buildFakeClient(fakeProvider);
+                createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+                await controller.initializeProvider();
+
+                const lookupNetworkPromise = controller.lookupNetwork();
+                messenger.clearSubscriptions();
+                expect(await lookupNetworkPromise).toBeUndefined();
+              },
+            );
+          });
+        });
+
+        describe('if removing the networkDidChange subscription fails for an unknown reason', () => {
+          it('re-throws the error', async () => {
+            const infuraProjectId = 'some-infura-project-id';
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        }),
+                      ],
+                    }),
+                  },
+                },
+                infuraProjectId,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                const fakeProvider = buildFakeProvider([
+                  // Called during provider initialization
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                  },
+                  // Called via `lookupNetwork` directly
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                  },
+                ]);
+                const fakeNetworkClient = buildFakeClient(fakeProvider);
+                createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+                await controller.initializeProvider();
+
+                const lookupNetworkPromise = controller.lookupNetwork();
+                const error = new Error('oops');
+                jest
+                  .spyOn(networkControllerMessenger, 'unsubscribe')
+                  .mockImplementation((eventType) => {
+                    if (eventType === 'NetworkController:networkDidChange') {
+                      throw error;
+                    }
+                  });
+                await expect(lookupNetworkPromise).rejects.toThrow(error);
+              },
+            );
+          });
+        });
+
+        lookupNetworkTests({
+          expectedNetworkClientType: NetworkClientType.Custom,
+          expectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+          initialState: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+                nativeCurrency: 'TEST',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://test.network',
+                  }),
+                ],
+              }),
+            },
+          },
+          operation: async (controller) => {
+            await controller.lookupNetwork();
+          },
+        });
+      });
+    });
+  });
+
+  describe('setProviderType', () => {
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      describe(`given the Infura network "${infuraNetworkType}"`, () => {
+        refreshNetworkTests({
+          expectedNetworkClientConfiguration:
+            buildInfuraNetworkClientConfiguration(infuraNetworkType),
+          expectedNetworkClientId: infuraNetworkType,
+          operation: async (controller) => {
+            await controller.setProviderType(infuraNetworkType);
+          },
+        });
+      });
+
+      it(`sets selectedNetworkClientId in state to "${infuraNetworkType}"`, async () => {
+        await withController(async ({ controller }) => {
+          mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+
+          await controller.setProviderType(infuraNetworkType);
+
+          expect(controller.state.selectedNetworkClientId).toBe(
+            infuraNetworkType,
+          );
+        });
+      });
+    }
+
+    describe('given "rpc"', () => {
+      it('throws because there is no way to switch to a custom RPC endpoint using this method', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'mainnet',
+            },
+          },
+          async ({ controller }) => {
+            await expect(() =>
+              // @ts-expect-error Intentionally passing invalid type
+              controller.setProviderType(NetworkType.rpc),
+            ).rejects.toThrow(
+              'NetworkController - cannot call "setProviderType" with type "rpc". Use "setActiveNetwork"',
+            );
+          },
+        );
+      });
+
+      it("doesn't set a provider", async () => {
+        await withController(async ({ controller }) => {
+          const fakeProvider = buildFakeProvider();
+          const fakeNetworkClient = buildFakeClient(fakeProvider);
+          createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+
+          try {
+            // @ts-expect-error Intentionally passing invalid type
+            await controller.setProviderType(NetworkType.rpc);
+          } catch {
+            // catch the rejection (it is tested above)
+          }
+
+          expect(createNetworkClientMock).not.toHaveBeenCalled();
+          expect(
+            controller.getProviderAndBlockTracker().provider,
+          ).toBeUndefined();
+        });
+      });
+
+      it('does not update networksMetadata[...].EIPS in state', async () => {
+        await withController(async ({ controller }) => {
+          const fakeProvider = buildFakeProvider([
+            {
+              request: {
+                method: 'eth_getBlockByNumber',
+                params: ['latest', false],
+              },
+              response: {
+                result: {
+                  baseFeePerGas: '0x1',
+                },
+              },
+            },
+          ]);
+          const fakeNetworkClient = buildFakeClient(fakeProvider);
+          createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+
+          const detailsPre =
+            controller.state.networksMetadata[
+              controller.state.selectedNetworkClientId
+            ];
+
+          try {
+            // @ts-expect-error Intentionally passing invalid type
+            await controller.setProviderType(NetworkType.rpc);
+          } catch {
+            // catch the rejection (it is tested above)
+          }
+
+          const detailsPost =
+            controller.state.networksMetadata[
+              controller.state.selectedNetworkClientId
+            ];
+
+          expect(detailsPost).toBe(detailsPre);
+        });
+      });
+    });
+
+    describe('given an invalid Infura network name', () => {
+      it('throws', async () => {
+        await withController(async ({ controller }) => {
+          await expect(() =>
+            // @ts-expect-error Intentionally passing invalid type
+            controller.setProviderType('invalid-infura-network'),
+          ).rejects.toThrow(
+            new Error('Unknown Infura provider type "invalid-infura-network".'),
+          );
+        });
+      });
+    });
+
+    it('is callable from the controller messenger', async () => {
+      await withController({}, async ({ controller, messenger }) => {
+        const fakeProvider = buildFakeProvider();
+        const fakeNetworkClient = buildFakeClient(fakeProvider);
+        mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+
+        await messenger.call(
+          'NetworkController:setProviderType',
+          TESTNET.networkType,
+        );
+
+        expect(controller.state.selectedNetworkClientId).toBe(
+          TESTNET.networkType,
+        );
+      });
+    });
+  });
+
+  describe('setActiveNetwork', () => {
+    describe('if the given ID does not refer to an existing network client', () => {
+      it('throws', async () => {
+        await withController(async ({ controller }) => {
+          await expect(() =>
+            controller.setActiveNetwork('invalid-network-client-id'),
+          ).rejects.toThrow(
+            new Error(
+              "No network client found with ID 'invalid-network-client-id'",
+            ),
+          );
+        });
+      });
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraChainId = ChainId[infuraNetworkType];
+
+      describe(`if the ID refers to a network client created for the Infura network "${infuraNetworkType}"`, () => {
+        refreshNetworkTests({
+          expectedNetworkClientConfiguration:
+            buildInfuraNetworkClientConfiguration(infuraNetworkType),
+          expectedNetworkClientId: infuraNetworkType,
+          initialState: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              [infuraChainId]:
+                buildInfuraNetworkConfiguration(infuraNetworkType),
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  }),
+                ],
+              }),
+            },
+          },
+          operation: async (controller) => {
+            await controller.setActiveNetwork(infuraNetworkType);
+          },
+        });
+
+        it(`sets selectedNetworkClientId in state to "${infuraNetworkType}"`, async () => {
+          await withController({}, async ({ controller }) => {
+            mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+
+            await controller.setActiveNetwork(infuraNetworkType);
+
+            expect(controller.state.selectedNetworkClientId).toStrictEqual(
+              infuraNetworkType,
+            );
+          });
+        });
+      });
+    }
+
+    describe('if the ID refers to a custom network client', () => {
+      refreshNetworkTests({
+        expectedNetworkClientConfiguration:
+          buildCustomNetworkClientConfiguration({
+            rpcUrl: 'https://test.network',
+            chainId: '0x1337',
+            ticker: 'TEST',
+          }),
+        expectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+        initialState: {
+          selectedNetworkClientId: InfuraNetworkType.mainnet,
+          networkConfigurationsByChainId: {
+            [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+              InfuraNetworkType.mainnet,
+            ),
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              nativeCurrency: 'TEST',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.network',
+                }),
+              ],
+            }),
+          },
+        },
+        operation: async (controller) => {
+          await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+        },
+      });
+
+      it('assigns selectedNetworkClientId in state to the ID', async () => {
+        const testNetworkClientId = 'AAAA-AAAA-AAAA-AAAA';
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: InfuraNetworkType.mainnet,
+              networkConfigurationsByChainId: {
+                [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                  InfuraNetworkType.mainnet,
+                ),
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TEST',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network',
+                    }),
+                  ],
+                }),
+              },
+            },
+          },
+          async ({ controller }) => {
+            mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+
+            await controller.setActiveNetwork(testNetworkClientId);
+
+            expect(controller.state.selectedNetworkClientId).toStrictEqual(
+              testNetworkClientId,
+            );
+          },
+        );
+      });
+    });
+
+    it('is able to be called via messenger action', async () => {
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: InfuraNetworkType.mainnet,
+            networkConfigurationsByChainId: {
+              [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                InfuraNetworkType.mainnet,
+              ),
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+                nativeCurrency: 'TEST',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://test.network',
+                  }),
+                ],
+              }),
+            },
+          },
+        },
+        async ({ controller, messenger }) => {
+          mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+
+          await messenger.call(
+            'NetworkController:setActiveNetwork',
+            'AAAA-AAAA-AAAA-AAAA',
+          );
+
+          expect(controller.state.selectedNetworkClientId).toBe(
+            'AAAA-AAAA-AAAA-AAAA',
+          );
+        },
+      );
+    });
+  });
+
+  describe('getEIP1559Compatibility', () => {
+    describe('if no provider has been set yet', () => {
+      it('does not make any state changes', async () => {
+        await withController(async ({ controller, messenger }) => {
+          const promiseForNoStateChanges = waitForStateChanges({
+            messenger,
+            count: 0,
+            operation: async () => {
+              await controller.getEIP1559Compatibility();
+            },
+          });
+
+          expect(Boolean(promiseForNoStateChanges)).toBe(true);
+        });
+      });
+
+      it('returns false', async () => {
+        await withController(async ({ controller }) => {
+          const isEIP1559Compatible =
+            await controller.getEIP1559Compatibility();
+
+          expect(isEIP1559Compatible).toBe(false);
+        });
+      });
+    });
+
+    describe('if a networkClientId is passed in', () => {
+      it('uses the built in state for networksMetadata', async () => {
+        await withController(
+          {
+            state: {
+              networksMetadata: {
+                'linea-mainnet': {
+                  EIPS: {
+                    1559: true,
+                  },
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller }) => {
+            const isEIP1559Compatible =
+              await controller.getEIP1559Compatibility('linea-mainnet');
+
+            expect(isEIP1559Compatible).toBe(true);
+          },
+        );
+      });
+      it('uses the built in false state for networksMetadata', async () => {
+        await withController(
+          {
+            state: {
+              networksMetadata: {
+                'linea-mainnet': {
+                  EIPS: {
+                    1559: false,
+                  },
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller }) => {
+            const isEIP1559Compatible =
+              await controller.getEIP1559Compatibility('linea-mainnet');
+
+            expect(isEIP1559Compatible).toBe(false);
+          },
+        );
+      });
+      it('updates network metadata if undefined', async () => {
+        await withController(
+          {
+            infuraProjectId: 'some-infura-project-id',
+          },
+          async ({ controller }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  response: {
+                    result: POST_1559_BLOCK,
+                  },
+                },
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  response: {
+                    result: POST_1559_BLOCK,
+                  },
+                },
+              ],
+            });
+            const isEIP1559Compatible =
+              await controller.getEIP1559Compatibility('linea-mainnet');
+            expect(isEIP1559Compatible).toBe(true);
+          },
+        );
+      });
+      it('updates network metadata if EIP-1559 compatibility is missing', async () => {
+        await withController(
+          {
+            infuraProjectId: 'some-infura-project-id',
+            state: {
+              networksMetadata: {
+                'linea-mainnet': {
+                  EIPS: {},
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  response: {
+                    result: POST_1559_BLOCK,
+                  },
+                },
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  response: {
+                    result: POST_1559_BLOCK,
+                  },
+                },
+              ],
+            });
+            const isEIP1559Compatible =
+              await controller.getEIP1559Compatibility('linea-mainnet');
+            expect(isEIP1559Compatible).toBe(true);
+          },
+        );
+      });
+    });
+
+    describe('if a provider has been set but networksMetadata[selectedNetworkClientId].EIPS in state already has a "1559" property', () => {
+      it('does not make any state changes', async () => {
+        await withController(
+          {
+            state: {
+              networksMetadata: {
+                mainnet: {
+                  EIPS: {
+                    1559: true,
+                  },
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller, messenger }) => {
+            // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+            // eslint-disable-next-line @typescript-eslint/no-floating-promises
+            setFakeProvider(controller, {
+              stubLookupNetworkWhileSetting: true,
+            });
+            const promiseForNoStateChanges = waitForStateChanges({
+              messenger,
+              count: 0,
+              operation: async () => {
+                await controller.getEIP1559Compatibility();
+              },
+            });
+
+            expect(Boolean(promiseForNoStateChanges)).toBe(true);
+          },
+        );
+      });
+
+      it('returns the value of the "1559" property', async () => {
+        await withController(
+          {
+            state: {
+              networksMetadata: {
+                mainnet: {
+                  EIPS: {
+                    1559: true,
+                  },
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller }) => {
+            // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+            // eslint-disable-next-line @typescript-eslint/no-floating-promises
+            setFakeProvider(controller, {
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const isEIP1559Compatible =
+              await controller.getEIP1559Compatibility();
+
+            expect(isEIP1559Compatible).toBe(true);
+          },
+        );
+      });
+    });
+
+    describe('if a provider has been set and networksMetadata[selectedNetworkClientId].EIPS in state does not already have a "1559" property', () => {
+      describe('if the request for the latest block is successful', () => {
+        describe('if the latest block has a "baseFeePerGas" property', () => {
+          it('sets the "1559" property to true', async () => {
+            await withController(async ({ controller }) => {
+              // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    response: {
+                      result: POST_1559_BLOCK,
+                    },
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              await controller.getEIP1559Compatibility();
+
+              expect(
+                controller.state.networksMetadata[
+                  controller.state.selectedNetworkClientId
+                ].EIPS[1559],
+              ).toBe(true);
+            });
+          });
+
+          it('returns true', async () => {
+            await withController(async ({ controller }) => {
+              // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    response: {
+                      result: POST_1559_BLOCK,
+                    },
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const isEIP1559Compatible =
+                await controller.getEIP1559Compatibility();
+
+              expect(isEIP1559Compatible).toBe(true);
+            });
+          });
+        });
+
+        describe('if the latest block does not have a "baseFeePerGas" property', () => {
+          it('sets the "1559" property to false', async () => {
+            await withController(async ({ controller }) => {
+              // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    response: {
+                      result: PRE_1559_BLOCK,
+                    },
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              await controller.getEIP1559Compatibility();
+
+              expect(
+                controller.state.networksMetadata[
+                  controller.state.selectedNetworkClientId
+                ].EIPS[1559],
+              ).toBe(false);
+            });
+          });
+
+          it('returns false', async () => {
+            await withController(async ({ controller }) => {
+              // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    response: {
+                      result: PRE_1559_BLOCK,
+                    },
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const isEIP1559Compatible =
+                await controller.getEIP1559Compatibility();
+
+              expect(isEIP1559Compatible).toBe(false);
+            });
+          });
+        });
+
+        describe('if the request for the latest block responds with null', () => {
+          const latestBlockRespondsNull = {
+            request: {
+              method: 'eth_getBlockByNumber',
+              params: ['latest', false],
+            },
+            response: {
+              result: null,
+            },
+          };
+          it('keeps the "1559" property as undefined', async () => {
+            await withController(async ({ controller }) => {
+              // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              setFakeProvider(controller, {
+                stubs: [latestBlockRespondsNull],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              await controller.getEIP1559Compatibility();
+
+              expect(
+                controller.state.networksMetadata[
+                  controller.state.selectedNetworkClientId
+                ].EIPS[1559],
+              ).toBeUndefined();
+            });
+          });
+
+          it('returns undefined', async () => {
+            await withController(async ({ controller }) => {
+              // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              setFakeProvider(controller, {
+                stubs: [latestBlockRespondsNull],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const isEIP1559Compatible =
+                await controller.getEIP1559Compatibility();
+
+              expect(isEIP1559Compatible).toBeUndefined();
+            });
+          });
+        });
+      });
+
+      describe('if the request for the latest block is unsuccessful', () => {
+        it('does not make any state changes', async () => {
+          await withController(async ({ controller, messenger }) => {
+            // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+            // eslint-disable-next-line @typescript-eslint/no-floating-promises
+            setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  error: GENERIC_JSON_RPC_ERROR,
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const promiseForNoStateChanges = waitForStateChanges({
+              messenger,
+              count: 0,
+              operation: async () => {
+                try {
+                  await controller.getEIP1559Compatibility();
+                } catch {
+                  // ignore error
+                }
+              },
+            });
+
+            expect(Boolean(promiseForNoStateChanges)).toBe(true);
+          });
+        });
+      });
+    });
+  });
+
+  describe('resetConnection', () => {
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      describe(`when the selected network client represents the Infura network "${infuraNetworkType}"`, () => {
+        refreshNetworkTests({
+          expectedNetworkClientConfiguration:
+            buildInfuraNetworkClientConfiguration(infuraNetworkType),
+          expectedNetworkClientId: infuraNetworkType,
+          initialState: {
+            selectedNetworkClientId: infuraNetworkType,
+          },
+          operation: async (controller) => {
+            await controller.resetConnection();
+          },
+        });
+      });
+    }
+
+    describe('when the selected network client represents a custom RPC endpoint', () => {
+      refreshNetworkTests({
+        expectedNetworkClientConfiguration:
+          buildCustomNetworkClientConfiguration({
+            rpcUrl: 'https://test.network',
+            chainId: '0x1337',
+            ticker: 'TEST',
+          }),
+        expectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+        initialState: {
+          selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+          networkConfigurationsByChainId: {
+            '0x1337': buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              nativeCurrency: 'TEST',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.network',
+                }),
+              ],
+            }),
+          },
+        },
+        operation: async (controller) => {
+          await controller.resetConnection();
+        },
+      });
+    });
+  });
+
+  describe('NetworkController:getEthQuery action', () => {
+    it('returns a EthQuery object that can be used to make requests to the currently selected network', async () => {
+      await withController(async ({ controller, messenger }) => {
+        await setFakeProvider(controller, {
+          stubs: [
+            {
+              request: {
+                method: 'test_method',
+                params: [],
+              },
+              response: {
+                result: 'test response',
+              },
+            },
+          ],
+        });
+
+        const ethQuery = messenger.call('NetworkController:getEthQuery');
+        assert(ethQuery, 'ethQuery is not set');
+
+        const promisifiedSendAsync = promisify(
+          ethQuery.sendAsync.bind(ethQuery),
+        );
+        const result = await promisifiedSendAsync({
+          id: 1,
+          jsonrpc: '2.0',
+          method: 'test_method',
+          params: [],
+        });
+        expect(result).toBe('test response');
+      });
+    });
+
+    it('returns undefined if the provider has not been set yet', async () => {
+      await withController(({ messenger }) => {
+        const ethQuery = messenger.call('NetworkController:getEthQuery');
+
+        expect(ethQuery).toBeUndefined();
+      });
+    });
+  });
+
+  for (const [name, getNetworkConfigurationByChainId] of [
+    [
+      'getNetworkConfigurationByChainId',
+      ({
+        controller,
+        chainId,
+      }: {
+        controller: NetworkController;
+        chainId: Hex;
+      }): NetworkConfiguration | undefined =>
+        controller.getNetworkConfigurationByChainId(chainId),
+    ],
+    [
+      'NetworkController:getNetworkConfigurationByChainId',
+      ({
+        messenger,
+        chainId,
+      }: {
+        messenger: RootMessenger;
+        chainId: Hex;
+      }): NetworkConfiguration | undefined =>
+        messenger.call(
+          'NetworkController:getNetworkConfigurationByChainId',
+          chainId,
+        ),
+    ],
+  ] as const) {
+    // This is a string!
+    // eslint-disable-next-line jest/valid-title
+    describe(name, () => {
+      for (const infuraNetworkType of INFURA_NETWORKS) {
+        const infuraChainId = ChainId[infuraNetworkType];
+
+        describe(`given the ID of the Infura-supported chain "${infuraNetworkType}" that a network configuration is filed under`, () => {
+          it('returns the network configuration', async () => {
+            const registeredNetworkConfiguration =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+            await withController(
+              {
+                state:
+                  buildNetworkControllerStateWithDefaultSelectedNetworkClientId(
+                    {
+                      networkConfigurationsByChainId: {
+                        [infuraChainId]: registeredNetworkConfiguration,
+                      },
+                    },
+                  ),
+              },
+              ({ controller, messenger }) => {
+                const returnedNetworkConfiguration =
+                  getNetworkConfigurationByChainId({
+                    controller,
+                    messenger,
+                    chainId: infuraChainId,
+                  });
+
+                expect(returnedNetworkConfiguration).toBe(
+                  registeredNetworkConfiguration,
+                );
+              },
+            );
+          });
+        });
+      }
+
+      describe('given the ID of a non-Infura-supported chain that a network configuration is filed under', () => {
+        it('returns the network configuration', async () => {
+          const registeredNetworkConfiguration =
+            buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+            });
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': registeredNetworkConfiguration,
+                  },
+                }),
+            },
+            ({ controller, messenger }) => {
+              const returnedNetworkConfiguration =
+                getNetworkConfigurationByChainId({
+                  controller,
+                  messenger,
+                  chainId: '0x1337',
+                });
+
+              expect(returnedNetworkConfiguration).toBe(
+                registeredNetworkConfiguration,
+              );
+            },
+          );
+        });
+      });
+
+      describe('given the ID of a chain that no network configuration is filed under', () => {
+        it('returns undefined', async () => {
+          await withController(({ controller, messenger }) => {
+            const returnedNetworkConfiguration =
+              getNetworkConfigurationByChainId({
+                controller,
+                messenger,
+                chainId: '0x9999999999999',
+              });
+
+            expect(returnedNetworkConfiguration).toBeUndefined();
+          });
+        });
+      });
+    });
+  }
+
+  for (const [name, getNetworkConfigurationByNetworkClientId] of [
+    [
+      'getNetworkConfigurationByNetworkClientId',
+      ({
+        controller,
+        networkClientId,
+      }: {
+        controller: NetworkController;
+        networkClientId: NetworkClientId;
+      }): NetworkConfiguration | undefined =>
+        controller.getNetworkConfigurationByNetworkClientId(networkClientId),
+    ],
+    [
+      'NetworkController:getNetworkConfigurationByNetworkClientId',
+      ({
+        messenger,
+        networkClientId,
+      }: {
+        messenger: RootMessenger;
+        networkClientId: NetworkClientId;
+      }): NetworkConfiguration | undefined =>
+        messenger.call(
+          'NetworkController:getNetworkConfigurationByNetworkClientId',
+          networkClientId,
+        ),
+    ],
+  ] as const) {
+    // This is a string!
+    // eslint-disable-next-line jest/valid-title
+    describe(name, () => {
+      for (const infuraNetworkType of INFURA_NETWORKS) {
+        const infuraChainId = ChainId[infuraNetworkType];
+
+        describe(`given the ID of a network client that corresponds to an RPC endpoint for the Infura network "${infuraNetworkType}" in a network configuration`, () => {
+          it('returns the network configuration', async () => {
+            const registeredNetworkConfiguration =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: infuraNetworkType,
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: registeredNetworkConfiguration,
+                  },
+                },
+              },
+              ({ controller, messenger }) => {
+                const returnedNetworkConfiguration =
+                  getNetworkConfigurationByNetworkClientId({
+                    controller,
+                    messenger,
+                    networkClientId: infuraNetworkType,
+                  });
+
+                expect(returnedNetworkConfiguration).toBe(
+                  registeredNetworkConfiguration,
+                );
+              },
+            );
+          });
+        });
+      }
+
+      describe('given the ID of a network client that corresponds to a custom RPC endpoint in a network configuration', () => {
+        it('returns the network configuration', async () => {
+          const registeredNetworkConfiguration =
+            buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                }),
+              ],
+            });
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  '0x1337': registeredNetworkConfiguration,
+                },
+              },
+            },
+            ({ controller, messenger }) => {
+              const returnedNetworkConfiguration =
+                getNetworkConfigurationByNetworkClientId({
+                  controller,
+                  messenger,
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                });
+
+              expect(returnedNetworkConfiguration).toBe(
+                registeredNetworkConfiguration,
+              );
+            },
+          );
+        });
+      });
+
+      describe('given the ID of a network client that does not correspond to any RPC endpoint in a network configuration', () => {
+        it('returns undefined', async () => {
+          await withController(({ controller, messenger }) => {
+            const returnedNetworkConfiguration =
+              getNetworkConfigurationByNetworkClientId({
+                controller,
+                messenger,
+                networkClientId: 'nonexistent',
+              });
+
+            expect(returnedNetworkConfiguration).toBeUndefined();
+          });
+        });
+      });
+    });
+  }
+
+  describe('addNetwork', () => {
+    it('throws if the chainId field is a string, but not a 0x-prefixed hex number', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              // @ts-expect-error Intentionally passing bad input
+              chainId: '12345',
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            `Could not add network: Invalid \`chainId\` '12345' (must start with "0x" and not exceed the maximum)`,
+          ),
+        );
+      });
+    });
+
+    it('throws if the chainId field is greater than the maximum allowed chain ID', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              chainId: toHex(MAX_SAFE_CHAIN_ID + 1),
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            `Could not add network: Invalid \`chainId\` '0xfffffffffffed' (must start with "0x" and not exceed the maximum)`,
+          ),
+        );
+      });
+    });
+
+    it('throws if defaultBlockExplorerUrlIndex does not refer to an entry in blockExplorerUrls', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              blockExplorerUrls: [],
+              defaultBlockExplorerUrlIndex: 99999,
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            'Could not add network: `defaultBlockExplorerUrlIndex` must refer to an entry in `blockExplorerUrls`',
+          ),
+        );
+      });
+    });
+
+    it('throws if blockExplorerUrls is non-empty, but defaultBlockExplorerUrlIndex is missing', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              blockExplorerUrls: ['https://block.explorer'],
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            'Could not add network: `defaultBlockExplorerUrlIndex` must refer to an entry in `blockExplorerUrls`',
+          ),
+        );
+      });
+    });
+
+    it('throws if the rpcEndpoints field is an empty array', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              rpcEndpoints: [],
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            'Could not add network: `rpcEndpoints` must be a non-empty array',
+          ),
+        );
+      });
+    });
+
+    it('throws if one of the rpcEndpoints has an invalid url property', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              rpcEndpoints: [
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'clearly-not-a-url',
+                }),
+              ],
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            "Could not add network: An entry in `rpcEndpoints` has invalid URL 'clearly-not-a-url'",
+          ),
+        );
+      });
+    });
+
+    it('throws if the URLs of two or more RPC endpoints have similar schemes (comparing case-insensitively)', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              rpcEndpoints: [
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com/bar',
+                }),
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'HTTPS://foo.com/bar',
+                }),
+              ],
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            'Could not add network: Each entry in rpcEndpoints must have a unique URL',
+          ),
+        );
+      });
+    });
+
+    it('throws if the URLs of two or more RPC endpoints have similar hostnames (comparing case-insensitively)', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              rpcEndpoints: [
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com/bar',
+                }),
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'https://fOo.CoM/bar',
+                }),
+              ],
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            'Could not add network: Each entry in rpcEndpoints must have a unique URL',
+          ),
+        );
+      });
+    });
+
+    it('does not throw if the URLs of two or more RPC endpoints have similar paths (comparing case-insensitively)', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              rpcEndpoints: [
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com/bar',
+                }),
+                buildAddNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com/BAR',
+                }),
+              ],
+            }),
+          ),
+        ).not.toThrow();
+      });
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraNetworkNickname = NetworkNickname[infuraNetworkType];
+      const infuraChainId = ChainId[infuraNetworkType];
+
+      it(`throws if rpcEndpoints contains an Infura RPC endpoint which is already present in the network configuration for the Infura-supported chain ${infuraChainId}`, async () => {
+        const infuraRpcEndpoint = buildInfuraRpcEndpoint(infuraNetworkType);
+
+        await withController(
+          {
+            state:
+              buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                networkConfigurationsByChainId: {
+                  [infuraChainId]: buildInfuraNetworkConfiguration(
+                    infuraNetworkType,
+                    {
+                      rpcEndpoints: [infuraRpcEndpoint],
+                    },
+                  ),
+                },
+              }),
+          },
+          ({ controller }) => {
+            expect(() =>
+              controller.addNetwork(
+                buildAddNetworkFields({
+                  chainId: '0x1337',
+                  rpcEndpoints: [infuraRpcEndpoint],
+                }),
+              ),
+            ).toThrow(
+              `Could not add network that points to same RPC endpoint as existing network for chain ${infuraChainId} ('${infuraNetworkNickname}')`,
+            );
+          },
+        );
+      });
+    }
+
+    it('throws if rpcEndpoints contains a custom RPC endpoint which is already present in another network configuration (comparing URLs case-insensitively)', async () => {
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x2448': buildNetworkConfiguration({
+                chainId: '0x2448',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    url: 'http://test.endpoint/bar',
+                  }),
+                ],
+              }),
+            },
+          }),
+        },
+        ({ controller }) => {
+          expect(() =>
+            controller.addNetwork(
+              buildAddNetworkFields({
+                chainId: '0x1337',
+                rpcEndpoints: [
+                  buildAddNetworkCustomRpcEndpointFields({
+                    url: 'http://test.endpoint/foo',
+                  }),
+                  buildAddNetworkCustomRpcEndpointFields({
+                    url: 'HTTP://TEST.ENDPOINT/bar',
+                  }),
+                ],
+              }),
+            ),
+          ).toThrow(
+            "Could not add network that points to same RPC endpoint as existing network for chain 0x2448 ('Some Network')",
+          );
+        },
+      );
+    });
+
+    it('throws if two or more RPC endpoints are exactly the same object', async () => {
+      await withController(({ controller }) => {
+        const rpcEndpoint = buildAddNetworkCustomRpcEndpointFields();
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              chainId: '0x1337',
+              rpcEndpoints: [rpcEndpoint, rpcEndpoint],
+            }),
+          ),
+        ).toThrow(
+          'Could not add network: Each entry in rpcEndpoints must be unique',
+        );
+      });
+    });
+
+    it('throws if there are two or more different Infura RPC endpoints', async () => {
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+              }),
+            },
+          }),
+        },
+        ({ controller }) => {
+          const mainnetRpcEndpoint = buildInfuraRpcEndpoint(
+            InfuraNetworkType.mainnet,
+          );
+          const testnetRpcEndpoint = buildInfuraRpcEndpoint(
+            TESTNET.networkType,
+          );
+          expect(() =>
+            controller.addNetwork(
+              buildAddNetworkFields({
+                chainId: ChainId.mainnet,
+                rpcEndpoints: [mainnetRpcEndpoint, testnetRpcEndpoint],
+              }),
+            ),
+          ).toThrow(
+            'Could not add network: There cannot be more than one Infura RPC endpoint',
+          );
+        },
+      );
+    });
+
+    it('throws if defaultRpcEndpointIndex does not refer to an entry in rpcEndpoints', async () => {
+      await withController(({ controller }) => {
+        expect(() =>
+          controller.addNetwork(
+            buildAddNetworkFields({
+              defaultRpcEndpointIndex: 99999,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com',
+                }),
+                buildCustomRpcEndpoint({
+                  url: 'https://bar.com',
+                }),
+              ],
+            }),
+          ),
+        ).toThrow(
+          new Error(
+            'Could not add network: `defaultRpcEndpointIndex` must refer to an entry in `rpcEndpoints`',
+          ),
+        );
+      });
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraNetworkNickname = NetworkNickname[infuraNetworkType];
+      const infuraChainId = ChainId[infuraNetworkType];
+
+      it(`throws if a network configuration for the Infura network "${infuraNetworkNickname}" is already registered under the given chain ID`, async () => {
+        await withController(
+          {
+            state:
+              buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                },
+              }),
+          },
+          ({ controller }) => {
+            expect(() =>
+              controller.addNetwork(
+                buildAddNetworkFields({
+                  chainId: infuraChainId,
+                }),
+              ),
+            ).toThrow(
+              `Could not add network for chain ${infuraChainId} as another network for that chain already exists ('${infuraNetworkNickname}')`,
+            );
+          },
+        );
+      });
+    }
+
+    it('throws if a custom network is already registered under the given chain ID', async () => {
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+                name: 'Some Network',
+              }),
+            },
+          }),
+        },
+        ({ controller }) => {
+          expect(() =>
+            controller.addNetwork(
+              buildAddNetworkFields({
+                chainId: '0x1337',
+              }),
+            ),
+          ).toThrow(
+            `Could not add network for chain 0x1337 as another network for that chain already exists ('Some Network')`,
+          );
+        },
+      );
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraChainId = ChainId[infuraNetworkType];
+      const infuraNetworkNickname = NetworkNickname[infuraNetworkType];
+      const infuraNativeTokenName = NetworksTicker[infuraNetworkType];
+
+      describe(`given the ID of the Infura-supported chain ${infuraChainId}`, () => {
+        it('creates a new network client for not only each custom RPC endpoint, but also the Infura RPC endpoint', async () => {
+          uuidV4Mock
+            .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB')
+            .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+          const createAutoManagedNetworkClientSpy = jest.spyOn(
+            createAutoManagedNetworkClientModule,
+            'createAutoManagedNetworkClient',
+          );
+          const infuraProjectId = 'some-infura-project-id';
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+            fetchOptions: {
+              headers: {
+                'X-Foo': 'Bar',
+              },
+            },
+            policyOptions: {
+              maxRetries: 2,
+              maxConsecutiveFailures: 10,
+            },
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 2000,
+          });
+
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.endpoint/1',
+                        }),
+                      ],
+                    }),
+                  },
+                }),
+              infuraProjectId,
+              getRpcServiceOptions,
+              getBlockTrackerOptions,
+              isRpcFailoverEnabled: true,
+            },
+            ({ controller, networkControllerMessenger }) => {
+              const defaultRpcEndpoint: InfuraRpcEndpoint = {
+                failoverUrls: ['https://first.failover.endpoint'],
+                name: infuraNetworkNickname,
+                networkClientId: infuraNetworkType,
+                type: RpcEndpointType.Infura as const,
+                url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const,
+              };
+
+              controller.addNetwork({
+                blockExplorerUrls: [],
+                chainId: infuraChainId,
+                defaultRpcEndpointIndex: 1,
+                name: infuraNetworkType,
+                nativeCurrency: infuraNativeTokenName,
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  {
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Test Network 1',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://test.endpoint/2',
+                  },
+                  {
+                    failoverUrls: ['https://third.failover.endpoint'],
+                    name: 'Test Network 2',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://test.endpoint/3',
+                  },
+                ],
+              });
+
+              // Skipping the 1st call because it's for the initial state
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+                2,
+                {
+                  networkClientId: infuraNetworkType,
+                  networkClientConfiguration: {
+                    infuraProjectId,
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    chainId: infuraChainId,
+                    network: infuraNetworkType,
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Infura,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                },
+              );
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+                3,
+                {
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/2',
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                },
+              );
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+                4,
+                {
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://third.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/3',
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                },
+              );
+              const networkConfigurationsByNetworkClientId =
+                getNetworkConfigurationsByNetworkClientId(
+                  controller.getNetworkClientRegistry(),
+                );
+              expect(
+                networkConfigurationsByNetworkClientId[infuraNetworkType],
+              ).toStrictEqual({
+                chainId: infuraChainId,
+                infuraProjectId,
+                failoverRpcUrls: ['https://first.failover.endpoint'],
+                network: infuraNetworkType,
+                ticker: infuraNativeTokenName,
+                type: NetworkClientType.Infura,
+              });
+              expect(
+                networkConfigurationsByNetworkClientId['BBBB-BBBB-BBBB-BBBB'],
+              ).toStrictEqual({
+                chainId: infuraChainId,
+                failoverRpcUrls: ['https://second.failover.endpoint'],
+                rpcUrl: 'https://test.endpoint/2',
+                ticker: infuraNativeTokenName,
+                type: NetworkClientType.Custom,
+              });
+              expect(
+                networkConfigurationsByNetworkClientId['CCCC-CCCC-CCCC-CCCC'],
+              ).toStrictEqual({
+                chainId: infuraChainId,
+                failoverRpcUrls: ['https://third.failover.endpoint'],
+                rpcUrl: 'https://test.endpoint/3',
+                ticker: infuraNativeTokenName,
+                type: NetworkClientType.Custom,
+              });
+            },
+          );
+        });
+
+        it('adds the network configuration to state under the chain ID', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.endpoint/1',
+                        }),
+                      ],
+                    }),
+                  },
+                }),
+            },
+            ({ controller }) => {
+              controller.addNetwork({
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: infuraChainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: infuraNetworkNickname,
+                    networkClientId: infuraNetworkType,
+                    type: RpcEndpointType.Infura as const,
+                    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const,
+                  },
+                  {
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Test Network',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://test.endpoint/2',
+                  },
+                ],
+              });
+
+              expect(
+                controller.state.networkConfigurationsByChainId,
+              ).toHaveProperty(infuraChainId);
+              expect(
+                controller.state.networkConfigurationsByChainId[infuraChainId],
+              ).toStrictEqual({
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: infuraChainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: infuraNetworkNickname,
+                    networkClientId: infuraNetworkType,
+                    type: RpcEndpointType.Infura as const,
+                    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+                  },
+                  {
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Test Network',
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://test.endpoint/2',
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        it('emits the NetworkController:networkAdded event', async () => {
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.endpoint/1',
+                        }),
+                      ],
+                    }),
+                  },
+                }),
+            },
+            ({ controller, messenger }) => {
+              const networkAddedEventListener = jest.fn();
+              messenger.subscribe(
+                'NetworkController:networkAdded',
+                networkAddedEventListener,
+              );
+
+              controller.addNetwork({
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: infuraChainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://some.failover.endpoint'],
+                    name: infuraNetworkNickname,
+                    networkClientId: infuraNetworkType,
+                    type: RpcEndpointType.Infura as const,
+                    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const,
+                  },
+                ],
+              });
+
+              expect(networkAddedEventListener).toHaveBeenCalledWith({
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: infuraChainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://some.failover.endpoint'],
+                    name: infuraNetworkNickname,
+                    networkClientId: infuraNetworkType,
+                    type: RpcEndpointType.Infura as const,
+                    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        it('returns the newly added network configuration', async () => {
+          await withController(
+            {
+              state:
+                buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                  networkConfigurationsByChainId: {
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.endpoint/1',
+                        }),
+                      ],
+                    }),
+                  },
+                }),
+            },
+            ({ controller }) => {
+              const newNetworkConfiguration = controller.addNetwork({
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: infuraChainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://some.failover.endpoint'],
+                    name: infuraNetworkNickname,
+                    networkClientId: infuraNetworkType,
+                    type: RpcEndpointType.Infura as const,
+                    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}` as const,
+                  },
+                ],
+              });
+
+              expect(newNetworkConfiguration).toStrictEqual({
+                blockExplorerUrls: ['https://block.explorer'],
+                chainId: infuraChainId,
+                defaultBlockExplorerUrlIndex: 0,
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: ['https://some.failover.endpoint'],
+                    name: infuraNetworkNickname,
+                    networkClientId: infuraNetworkType,
+                    type: RpcEndpointType.Infura as const,
+                    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+      });
+    }
+
+    describe('given the ID of a non-Infura-supported chain', () => {
+      it('throws (albeit for a different reason) if rpcEndpoints contains an Infura RPC endpoint that represents a different chain that the one being added', async () => {
+        uuidV4Mock
+          .mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA')
+          .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+        const defaultRpcEndpoint = buildInfuraRpcEndpoint(
+          InfuraNetworkType.mainnet,
+        );
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          ({ controller }) => {
+            expect(() =>
+              controller.addNetwork({
+                blockExplorerUrls: [],
+                chainId: '0x1337',
+                defaultRpcEndpointIndex: 0,
+                name: 'Some Network',
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  {
+                    failoverUrls: [],
+                    name: 'Test Network 2',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://test.endpoint/2',
+                  },
+                ],
+              }),
+            ).toThrow(
+              new Error(
+                "Could not add network with chain ID 0x1337 and Infura RPC endpoint for 'Ethereum Mainnet' which represents 0x1, as the two conflict",
+              ),
+            );
+          },
+        );
+      });
+
+      it('creates a new network client for each given RPC endpoint', async () => {
+        uuidV4Mock
+          .mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA')
+          .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+
+        await withController(({ controller }) => {
+          controller.addNetwork({
+            blockExplorerUrls: [],
+            chainId: '0x1337',
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://first.failover.endpoint'],
+                name: 'Test Network 1',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/1',
+              },
+              {
+                failoverUrls: ['https://second.failover.endpoint'],
+                name: 'Test Network 2',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/2',
+              },
+            ],
+          });
+
+          const networkClient1 = controller.getNetworkClientById(
+            'AAAA-AAAA-AAAA-AAAA',
+          );
+          expect(networkClient1.configuration).toStrictEqual({
+            chainId: '0x1337',
+            failoverRpcUrls: ['https://first.failover.endpoint'],
+            rpcUrl: 'https://test.endpoint/1',
+            ticker: 'TOKEN',
+            type: NetworkClientType.Custom,
+          });
+          const networkClient2 = controller.getNetworkClientById(
+            'BBBB-BBBB-BBBB-BBBB',
+          );
+          expect(networkClient2.configuration).toStrictEqual({
+            chainId: '0x1337',
+            failoverRpcUrls: ['https://second.failover.endpoint'],
+            rpcUrl: 'https://test.endpoint/2',
+            ticker: 'TOKEN',
+            type: NetworkClientType.Custom,
+          });
+        });
+      });
+
+      it('adds the network configuration to state under the chain ID', async () => {
+        uuidV4Mock
+          .mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA')
+          .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+
+        await withController(({ controller }) => {
+          controller.addNetwork({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://first.failover.endpoint'],
+                name: 'Test Network 1',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/1',
+              },
+              {
+                failoverUrls: ['https://second.failover.endpoint'],
+                name: 'Test Network 2',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/2',
+              },
+            ],
+          });
+
+          expect(
+            controller.state.networkConfigurationsByChainId['0x1337'],
+          ).toStrictEqual({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://first.failover.endpoint'],
+                name: 'Test Network 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/1',
+              },
+              {
+                failoverUrls: ['https://second.failover.endpoint'],
+                name: 'Test Network 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/2',
+              },
+            ],
+            lastUpdatedAt: FAKE_DATE_NOW_MS,
+          });
+        });
+      });
+
+      it('emits the NetworkController:networkAdded event', async () => {
+        uuidV4Mock.mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA');
+
+        await withController(({ controller, messenger }) => {
+          const networkAddedEventListener = jest.fn();
+          messenger.subscribe(
+            'NetworkController:networkAdded',
+            networkAddedEventListener,
+          );
+
+          controller.addNetwork({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://failover.endpoint'],
+                name: 'Test Network',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint',
+              },
+            ],
+          });
+
+          expect(networkAddedEventListener).toHaveBeenCalledWith({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://failover.endpoint'],
+                name: 'Test Network',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint',
+              },
+            ],
+            lastUpdatedAt: FAKE_DATE_NOW_MS,
+          });
+        });
+      });
+
+      it('returns the newly added network configuration', async () => {
+        uuidV4Mock.mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA');
+
+        await withController(({ controller, messenger }) => {
+          const networkAddedEventListener = jest.fn();
+          messenger.subscribe(
+            'NetworkController:networkAdded',
+            networkAddedEventListener,
+          );
+
+          const newNetworkConfiguration = controller.addNetwork({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://failover.endpoint'],
+                name: 'Test Network',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint',
+              },
+            ],
+          });
+
+          expect(newNetworkConfiguration).toStrictEqual({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://failover.endpoint'],
+                name: 'Test Network',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint',
+              },
+            ],
+            lastUpdatedAt: FAKE_DATE_NOW_MS,
+          });
+        });
+      });
+
+      it('is callable from the controller messenger', async () => {
+        uuidV4Mock.mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA');
+
+        await withController(({ messenger }) => {
+          const networkAddedEventListener = jest.fn();
+          messenger.subscribe(
+            'NetworkController:networkAdded',
+            networkAddedEventListener,
+          );
+
+          const newNetworkConfiguration = messenger.call(
+            'NetworkController:addNetwork',
+            {
+              blockExplorerUrls: ['https://block.explorer'],
+              chainId: '0x1337',
+              defaultBlockExplorerUrlIndex: 0,
+              defaultRpcEndpointIndex: 0,
+              name: 'Some Network',
+              nativeCurrency: 'TOKEN',
+              rpcEndpoints: [
+                {
+                  failoverUrls: ['https://failover.endpoint'],
+                  name: 'Test Network',
+                  type: RpcEndpointType.Custom,
+                  url: 'https://test.endpoint',
+                },
+              ],
+              lastUpdatedAt: FAKE_DATE_NOW_MS,
+            },
+          );
+
+          expect(newNetworkConfiguration).toStrictEqual({
+            blockExplorerUrls: ['https://block.explorer'],
+            chainId: '0x1337',
+            defaultBlockExplorerUrlIndex: 0,
+            defaultRpcEndpointIndex: 0,
+            name: 'Some Network',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              {
+                failoverUrls: ['https://failover.endpoint'],
+                name: 'Test Network',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint',
+              },
+            ],
+            lastUpdatedAt: FAKE_DATE_NOW_MS,
+          });
+        });
+      });
+    });
+  });
+
+  describe('updateNetwork', () => {
+    it('throws if the given chain ID does not refer to an existing network configuration', async () => {
+      await withController(async ({ controller }) => {
+        await expect(
+          controller.updateNetwork(
+            '0x1337',
+            buildCustomNetworkConfiguration({
+              chainId: '0x1337',
+            }),
+          ),
+        ).rejects.toThrow(
+          new Error(
+            "Could not update network: Cannot find network configuration for chain '0x1337'",
+          ),
+        );
+      });
+    });
+
+    it('throws if defaultBlockExplorerUrlIndex does not refer to an entry in blockExplorerUrls', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(() =>
+            controller.updateNetwork(
+              '0x1337',
+              buildCustomNetworkConfiguration({
+                blockExplorerUrls: [],
+                defaultBlockExplorerUrlIndex: 99999,
+              }),
+            ),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: `defaultBlockExplorerUrlIndex` must refer to an entry in `blockExplorerUrls`',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if blockExplorerUrls is non-empty, but defaultBlockExplorerUrlIndex is cleared', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        blockExplorerUrls: ['https://block.explorer'],
+        chainId: '0x1337',
+        defaultBlockExplorerUrlIndex: 0,
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(() =>
+            controller.updateNetwork(
+              '0x1337',
+              buildCustomNetworkConfiguration({
+                ...networkConfigurationToUpdate,
+                defaultBlockExplorerUrlIndex: undefined,
+              }),
+            ),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: `defaultBlockExplorerUrlIndex` must refer to an entry in `blockExplorerUrls`',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if the new chainId field is a string, but not a 0x-prefixed hex number', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork(
+              '0x1337',
+              buildCustomNetworkConfiguration({
+                // @ts-expect-error Intentionally passing bad input
+                chainId: '12345',
+              }),
+            ),
+          ).rejects.toThrow(
+            new Error(
+              `Could not update network: Invalid \`chainId\` '12345' (must start with "0x" and not exceed the maximum)`,
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if the new chainId field is greater than the maximum allowed chain ID', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork(
+              '0x1337',
+              buildCustomNetworkConfiguration({
+                chainId: toHex(MAX_SAFE_CHAIN_ID + 1),
+              }),
+            ),
+          ).rejects.toThrow(
+            new Error(
+              `Could not update network: Invalid \`chainId\` '0xfffffffffffed' (must start with "0x" and not exceed the maximum)`,
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if the new rpcEndpoints field is an empty array', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork(
+              '0x1337',
+              buildNetworkConfiguration({
+                rpcEndpoints: [],
+              }),
+            ),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: `rpcEndpoints` must be a non-empty array',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if one of the new rpcEndpoints is custom and uses an Infura network name for networkClientId', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  networkClientId: InfuraNetworkType.mainnet,
+                  url: 'https://test.network',
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              "Could not update network: Custom RPC endpoint 'https://test.network' has invalid network client ID 'mainnet'",
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if one of the new rpcEndpoints has an invalid url property', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'clearly-not-a-url',
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              "Could not update network: An entry in `rpcEndpoints` has invalid URL 'clearly-not-a-url'",
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if one of the new RPC endpoints has a networkClientId that does not refer to a registered network client', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com',
+                  networkClientId: 'not-a-real-network-client-id',
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              "Could not update network: RPC endpoint 'https://foo.com' refers to network client 'not-a-real-network-client-id' that does not exist",
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if the URLs of two or more RPC endpoints have similar schemes (comparing case-insensitively)', async () => {
+      const networkConfigurationToUpdate = buildNetworkConfiguration();
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com/bar',
+                }),
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'HTTPS://foo.com/bar',
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: Each entry in rpcEndpoints must have a unique URL',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if the URLs of two or more RPC endpoints have similar hostnames (comparing case-insensitively)', async () => {
+      const networkConfigurationToUpdate = buildNetworkConfiguration();
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'https://foo.com/bar',
+                }),
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'https://fOo.CoM/bar',
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: Each entry in rpcEndpoints must have a unique URL',
+            ),
+          );
+        },
+      );
+    });
+
+    it('does not throw if the URLs of two or more RPC endpoints have similar paths (comparing case-insensitively)', async () => {
+      const networkConfigurationToUpdate = buildNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            url: 'https://foo.com/bar',
+          }),
+        ],
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          const result = await controller.updateNetwork('0x1337', {
+            ...networkConfigurationToUpdate,
+            defaultRpcEndpointIndex: 0,
+            rpcEndpoints: [
+              networkConfigurationToUpdate.rpcEndpoints[0],
+              buildUpdateNetworkCustomRpcEndpointFields({
+                url: 'https://foo.com/BAR',
+              }),
+            ],
+          });
+
+          expect(result).toBeDefined();
+        },
+      );
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraNetworkNickname = NetworkNickname[infuraNetworkType];
+      const infuraChainId = ChainId[infuraNetworkType];
+
+      it(`throws if an Infura RPC endpoint is being added which is already present in the network configuration for the Infura-supported chain ${infuraChainId}`, async () => {
+        const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+          chainId: '0x1337',
+        });
+        const infuraRpcEndpoint = buildInfuraRpcEndpoint(infuraNetworkType);
+
+        await withController(
+          {
+            state:
+              buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  [infuraChainId]: buildInfuraNetworkConfiguration(
+                    infuraNetworkType,
+                    {
+                      rpcEndpoints: [infuraRpcEndpoint],
+                    },
+                  ),
+                },
+              }),
+          },
+          async ({ controller }) => {
+            await expect(
+              controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [infuraRpcEndpoint],
+              }),
+            ).rejects.toThrow(
+              `Could not update network to point to same RPC endpoint as existing network for chain ${infuraChainId} ('${infuraNetworkNickname}')`,
+            );
+          },
+        );
+      });
+    }
+
+    it('throws if a custom RPC endpoint is being added which is already present in another network configuration (comparing URLs case-insensitively)', async () => {
+      const networkConfigurationToUpdate = buildNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            url: 'http://test.endpoint/foo',
+          }),
+        ],
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+              '0x2448': buildNetworkConfiguration({
+                chainId: '0x2448',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    url: 'http://test.endpoint/bar',
+                  }),
+                ],
+              }),
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'http://test.endpoint/foo',
+                }),
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'HTTP://TEST.ENDPOINT/bar',
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              "Could not update network to point to same RPC endpoint as existing network for chain 0x2448 ('Some Network')",
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if two or more RPC endpoints are exactly the same object', async () => {
+      const networkConfigurationToUpdate = buildNetworkConfiguration();
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          const rpcEndpoint = buildUpdateNetworkCustomRpcEndpointFields();
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              defaultRpcEndpointIndex: 0,
+              rpcEndpoints: [rpcEndpoint, rpcEndpoint],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: Each entry in rpcEndpoints must be unique',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if two or more RPC endpoints have the same networkClientId', async () => {
+      const rpcEndpoint = buildCustomRpcEndpoint({
+        url: 'https://test.endpoint',
+        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+      });
+      const networkConfigurationToUpdate = buildNetworkConfiguration({
+        rpcEndpoints: [rpcEndpoint],
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [
+                rpcEndpoint,
+                buildUpdateNetworkCustomRpcEndpointFields({
+                  url: 'https://test.endpoint/2',
+                  networkClientId: rpcEndpoint.networkClientId,
+                }),
+              ],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: Each entry in rpcEndpoints must have a unique networkClientId',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws (albeit for a different reason) if there are two or more different Infura RPC endpoints', async () => {
+      const [mainnetRpcEndpoint, testnetRpcEndpoint] = [
+        buildInfuraRpcEndpoint(InfuraNetworkType.mainnet),
+        buildInfuraRpcEndpoint(TESTNET.networkType),
+      ];
+      const networkConfigurationToUpdate = buildNetworkConfiguration({
+        name: 'Mainnet',
+        chainId: ChainId.mainnet,
+        rpcEndpoints: [mainnetRpcEndpoint],
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              [ChainId.mainnet]: networkConfigurationToUpdate,
+              [TESTNET.chainId]: buildNetworkConfiguration({
+                name: TESTNET.name,
+                chainId: TESTNET.chainId,
+                rpcEndpoints: [testnetRpcEndpoint],
+              }),
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork(ChainId.mainnet, {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [mainnetRpcEndpoint, testnetRpcEndpoint],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              `Could not update network to point to same RPC endpoint as existing network for chain ${TESTNET.chainId} ('${TESTNET.name}')`,
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if the new defaultRpcEndpointIndex does not refer to an entry in rpcEndpoints', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            url: 'https://foo.com',
+          }),
+          buildCustomRpcEndpoint({
+            url: 'https://bar.com',
+          }),
+        ],
+      });
+
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          }),
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              defaultRpcEndpointIndex: 99999,
+            }),
+          ).rejects.toThrow(
+            new Error(
+              'Could not update network: `defaultRpcEndpointIndex` must refer to an entry in `rpcEndpoints`',
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if a RPC endpoint being removed is represented by the selected network client, and replacementSelectedRpcEndpointIndex is not specified', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://foo.com',
+          }),
+          buildCustomRpcEndpoint({
+            networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+            url: 'https://bar.com',
+          }),
+        ],
+      });
+
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          },
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              rpcEndpoints: [networkConfigurationToUpdate.rpcEndpoints[1]],
+            }),
+          ).rejects.toThrow(
+            new Error(
+              "Could not update network: Cannot update RPC endpoints in such a way that the selected network 'AAAA-AAAA-AAAA-AAAA' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the `replacementSelectedRpcEndpointIndex` option.",
+            ),
+          );
+        },
+      );
+    });
+
+    it('throws if a RPC endpoint being removed is represented by the selected network client, and an invalid replacementSelectedRpcEndpointIndex is not specified', async () => {
+      const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://foo.com',
+          }),
+          buildCustomRpcEndpoint({
+            networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+            url: 'https://bar.com',
+          }),
+        ],
+      });
+
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              '0x1337': networkConfigurationToUpdate,
+            },
+          },
+        },
+        async ({ controller }) => {
+          await expect(
+            controller.updateNetwork(
+              '0x1337',
+              {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [networkConfigurationToUpdate.rpcEndpoints[1]],
+              },
+              { replacementSelectedRpcEndpointIndex: 9999 },
+            ),
+          ).rejects.toThrow(
+            new Error(
+              `Could not update network: \`replacementSelectedRpcEndpointIndex\` 9999 does not refer to an entry in \`rpcEndpoints\``,
+            ),
+          );
+        },
+      );
+    });
+
+    it('is callable from the controller messenger', async () => {
+      const originalNetwork = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.network',
+          }),
+        ],
+      });
+
+      const networkToUpdate = buildCustomNetworkConfiguration({
+        chainId: '0x1337',
+        rpcEndpoints: [
+          buildCustomRpcEndpoint({
+            name: 'Custom Name',
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.network',
+          }),
+        ],
+      });
+
+      const controllerState =
+        buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+          networkConfigurationsByChainId: {
+            [originalNetwork.chainId]: originalNetwork,
+          },
+          networksMetadata: {
+            'AAAA-AAAA-AAAA-AAAA': {
+              EIPS: {
+                '1559': true,
+              },
+              status: NetworkStatus.Available,
+            },
+          },
+        });
+
+      await withController(
+        { state: controllerState },
+        async ({ controller, messenger }) => {
+          await messenger.call(
+            'NetworkController:updateNetwork',
+            networkToUpdate.chainId,
+            networkToUpdate,
+          );
+          expect(
+            controller.state.networkConfigurationsByChainId['0x1337']
+              .rpcEndpoints[0].name,
+          ).toBe('Custom Name');
+        },
+      );
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraChainId = ChainId[infuraNetworkType];
+      const infuraNativeTokenName = NetworksTicker[infuraNetworkType];
+
+      describe(`if the existing chain ID is the Infura-supported chain ${infuraChainId} and is not being changed`, () => {
+        describe('when a new Infura RPC endpoint is being added', () => {
+          it('creates and registers a new network client for the RPC endpoint', async () => {
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://rpc.network',
+                  }),
+                ],
+              });
+            const infuraProjectId = 'some-infura-project-id';
+            const getRpcServiceOptions = (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              btoa,
+              fetch,
+              isOffline: (): boolean => false,
+              fetchOptions: {
+                headers: {
+                  'X-Foo': 'Bar',
+                },
+              },
+              policyOptions: {
+                maxRetries: 2,
+                maxConsecutiveFailures: 10,
+              },
+            });
+            const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+              pollingInterval: 2000,
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId,
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                isRpcFailoverEnabled: true,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                const infuraRpcEndpoint: InfuraRpcEndpoint = {
+                  failoverUrls: ['https://failover.endpoint'],
+                  networkClientId: infuraNetworkType,
+                  url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+                  type: RpcEndpointType.Infura,
+                };
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    infuraRpcEndpoint,
+                  ],
+                });
+
+                // Skipping network client creation for existing RPC endpoints
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(3, {
+                  networkClientId: infuraNetworkType,
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://failover.endpoint'],
+                    infuraProjectId,
+                    network: infuraNetworkType,
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Infura,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+
+                const networkConfigurationsByNetworkClientId =
+                  getNetworkConfigurationsByNetworkClientId(
+                    controller.getNetworkClientRegistry(),
+                  );
+                expect(
+                  networkConfigurationsByNetworkClientId[infuraNetworkType],
+                ).toStrictEqual({
+                  chainId: infuraChainId,
+                  failoverRpcUrls: ['https://failover.endpoint'],
+                  infuraProjectId,
+                  network: infuraNetworkType,
+                  ticker: infuraNativeTokenName,
+                  type: NetworkClientType.Infura,
+                });
+              },
+            );
+          });
+
+          it('stores the network configuration with the new RPC endpoint in state', async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://rpc.network',
+                  }),
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                const infuraRpcEndpoint: InfuraRpcEndpoint = {
+                  failoverUrls: ['https://failover.endpoint'],
+                  networkClientId: infuraNetworkType,
+                  url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+                  type: RpcEndpointType.Infura,
+                };
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    infuraRpcEndpoint,
+                  ],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    infuraRpcEndpoint,
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://rpc.network',
+                  }),
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                const infuraRpcEndpoint: InfuraRpcEndpoint = {
+                  failoverUrls: ['https://failover.endpoint'],
+                  networkClientId: infuraNetworkType,
+                  url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+                  type: RpcEndpointType.Infura,
+                };
+
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    rpcEndpoints: [
+                      ...networkConfigurationToUpdate.rpcEndpoints,
+                      infuraRpcEndpoint,
+                    ],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    infuraRpcEndpoint,
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+        });
+
+        describe('when new custom RPC endpoints are being added', () => {
+          it('creates and registers new network clients for each RPC endpoint', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA')
+              .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+            const infuraRpcEndpoint = buildInfuraRpcEndpoint(infuraNetworkType);
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+            const getRpcServiceOptions = (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              btoa,
+              fetch,
+              isOffline: (): boolean => false,
+              fetchOptions: {
+                headers: {
+                  'X-Foo': 'Bar',
+                },
+              },
+              policyOptions: {
+                maxRetries: 2,
+                maxConsecutiveFailures: 10,
+              },
+            });
+            const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+              pollingInterval: 2000,
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                isRpcFailoverEnabled: true,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                const [rpcEndpoint1, rpcEndpoint2] = [
+                  buildUpdateNetworkCustomRpcEndpointFields({
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: 'Endpoint 1',
+                    url: 'https://rpc.endpoint/1',
+                  }),
+                  buildUpdateNetworkCustomRpcEndpointFields({
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Endpoint 2',
+                    url: 'https://rpc.endpoint/2',
+                  }),
+                ];
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [infuraRpcEndpoint, rpcEndpoint1, rpcEndpoint2],
+                });
+
+                // Skipping network client creation for existing RPC endpoints
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(3, {
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    rpcUrl: 'https://rpc.endpoint/1',
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(4, {
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://rpc.endpoint/2',
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+
+                const networkConfigurationsByNetworkClientId =
+                  getNetworkConfigurationsByNetworkClientId(
+                    controller.getNetworkClientRegistry(),
+                  );
+                expect(
+                  networkConfigurationsByNetworkClientId['AAAA-AAAA-AAAA-AAAA'],
+                ).toStrictEqual({
+                  chainId: infuraChainId,
+                  failoverRpcUrls: ['https://first.failover.endpoint'],
+                  rpcUrl: 'https://rpc.endpoint/1',
+                  ticker: infuraNativeTokenName,
+                  type: NetworkClientType.Custom,
+                });
+                expect(
+                  networkConfigurationsByNetworkClientId['BBBB-BBBB-BBBB-BBBB'],
+                ).toStrictEqual({
+                  chainId: infuraChainId,
+                  failoverRpcUrls: ['https://second.failover.endpoint'],
+                  rpcUrl: 'https://rpc.endpoint/2',
+                  ticker: infuraNativeTokenName,
+                  type: NetworkClientType.Custom,
+                });
+              },
+            );
+          });
+
+          it('assigns the ID of the created network client to each RPC endpoint in state', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA')
+              .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [buildInfuraRpcEndpoint(infuraNetworkType)],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    buildUpdateNetworkCustomRpcEndpointFields({
+                      failoverUrls: ['https://first.failover.endpoint'],
+                      name: 'Endpoint 2',
+                      url: 'https://rpc.endpoint/2',
+                    }),
+                    buildUpdateNetworkCustomRpcEndpointFields({
+                      failoverUrls: ['https://second.failover.endpoint'],
+                      name: 'Endpoint 3',
+                      url: 'https://rpc.endpoint/3',
+                    }),
+                  ],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    {
+                      failoverUrls: ['https://first.failover.endpoint'],
+                      name: 'Endpoint 2',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      type: RpcEndpointType.Custom,
+                      url: 'https://rpc.endpoint/2',
+                    },
+                    {
+                      failoverUrls: ['https://second.failover.endpoint'],
+                      name: 'Endpoint 3',
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      type: RpcEndpointType.Custom,
+                      url: 'https://rpc.endpoint/3',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('AAAA-AAAA-AAAA-AAAA')
+              .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [buildInfuraRpcEndpoint(infuraNetworkType)],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    defaultRpcEndpointIndex: 0,
+                    rpcEndpoints: [
+                      ...networkConfigurationToUpdate.rpcEndpoints,
+                      buildUpdateNetworkCustomRpcEndpointFields({
+                        failoverUrls: ['https://first.failover.endpoint'],
+                        name: 'Endpoint 2',
+                        url: 'https://rpc.endpoint/2',
+                      }),
+                      buildUpdateNetworkCustomRpcEndpointFields({
+                        failoverUrls: ['https://second.failover.endpoint'],
+                        name: 'Endpoint 3',
+                        url: 'https://rpc.endpoint/3',
+                      }),
+                    ],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    ...networkConfigurationToUpdate.rpcEndpoints,
+                    {
+                      failoverUrls: ['https://first.failover.endpoint'],
+                      name: 'Endpoint 2',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      type: RpcEndpointType.Custom,
+                      url: 'https://rpc.endpoint/2',
+                    },
+                    {
+                      failoverUrls: ['https://second.failover.endpoint'],
+                      name: 'Endpoint 3',
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      type: RpcEndpointType.Custom,
+                      url: 'https://rpc.endpoint/3',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+        });
+
+        describe('when some custom RPC endpoints are being removed', () => {
+          it('destroys and unregisters existing network clients for the RPC endpoints', async () => {
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+              });
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                  },
+                },
+              },
+              async ({ controller }) => {
+                const existingNetworkClient = controller.getNetworkClientById(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                const destroySpy = jest.spyOn(existingNetworkClient, 'destroy');
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [rpcEndpoint2],
+                });
+
+                expect(destroySpy).toHaveBeenCalled();
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+              },
+            );
+          });
+
+          it('updates the network configuration in state', async () => {
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+              });
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                  },
+                },
+              },
+              async ({ controller }) => {
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [rpcEndpoint2],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [rpcEndpoint2],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+              });
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                  },
+                },
+              },
+              async ({ controller }) => {
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    defaultRpcEndpointIndex: 0,
+                    rpcEndpoints: [rpcEndpoint2],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [rpcEndpoint2],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          describe('when one is represented by the selected network client (and a replacement is specified)', () => {
+            describe('if the new replacement RPC endpoint already exists', () => {
+              it('selects the network client that represents the replacement RPC endpoint', async () => {
+                const networkConfigurationToUpdate =
+                  buildInfuraNetworkConfiguration(infuraNetworkType, {
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://test.network/1',
+                      }),
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                        url: 'https://test.network/2',
+                      }),
+                    ],
+                  });
+
+                await withController(
+                  {
+                    state: {
+                      selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      networkConfigurationsByChainId: {
+                        [infuraChainId]: networkConfigurationToUpdate,
+                      },
+                    },
+                  },
+                  async ({ controller }) => {
+                    const fakeProviders = [
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 1',
+                          },
+                        },
+                      ]),
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 2',
+                          },
+                        },
+                      ]),
+                    ];
+                    const fakeNetworkClients = [
+                      buildFakeClient(fakeProviders[0]),
+                      buildFakeClient(fakeProviders[1]),
+                    ];
+                    createNetworkClientMock.mockImplementation(
+                      ({ configuration }) => {
+                        if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/1'
+                        ) {
+                          return fakeNetworkClients[0];
+                        } else if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/2'
+                        ) {
+                          return fakeNetworkClients[1];
+                        }
+                        throw new Error(
+                          `Unknown network client configuration ${JSON.stringify(
+                            configuration,
+                          )}`,
+                        );
+                      },
+                    );
+                    await controller.initializeProvider();
+                    expect(controller.state.selectedNetworkClientId).toBe(
+                      'AAAA-AAAA-AAAA-AAAA',
+                    );
+                    const networkClient1 =
+                      controller.getSelectedNetworkClient();
+                    assert(networkClient1, 'Network client is somehow unset');
+                    const result1 = await networkClient1.provider.request({
+                      method: 'test',
+                    });
+                    expect(result1).toBe('test response from 1');
+
+                    await controller.updateNetwork(
+                      infuraChainId,
+                      {
+                        ...networkConfigurationToUpdate,
+                        rpcEndpoints: [
+                          networkConfigurationToUpdate.rpcEndpoints[1],
+                        ],
+                      },
+                      {
+                        replacementSelectedRpcEndpointIndex: 0,
+                      },
+                    );
+                    expect(controller.state.selectedNetworkClientId).toBe(
+                      'BBBB-BBBB-BBBB-BBBB',
+                    );
+                    const networkClient2 =
+                      controller.getSelectedNetworkClient();
+                    assert(networkClient2, 'Network client is somehow unset');
+                    const result2 = await networkClient2.provider.request({
+                      method: 'test',
+                    });
+                    expect(result2).toBe('test response from 2');
+                  },
+                );
+              });
+
+              it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+                const networkConfigurationToUpdate =
+                  buildInfuraNetworkConfiguration(infuraNetworkType, {
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://test.network/1',
+                      }),
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                        url: 'https://test.network/2',
+                      }),
+                    ],
+                  });
+
+                await withController(
+                  {
+                    state: {
+                      selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      networkConfigurationsByChainId: {
+                        [infuraChainId]: networkConfigurationToUpdate,
+                      },
+                    },
+                  },
+                  async ({ controller, messenger }) => {
+                    const fakeProviders = [
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 1',
+                          },
+                        },
+                      ]),
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 2',
+                          },
+                        },
+                      ]),
+                    ];
+                    const fakeNetworkClients = [
+                      buildFakeClient(fakeProviders[0]),
+                      buildFakeClient(fakeProviders[1]),
+                    ];
+                    createNetworkClientMock.mockImplementation(
+                      ({ configuration }) => {
+                        if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/1'
+                        ) {
+                          return fakeNetworkClients[0];
+                        } else if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/2'
+                        ) {
+                          return fakeNetworkClients[1];
+                        }
+                        throw new Error(
+                          `Unknown network client configuration ${JSON.stringify(
+                            configuration,
+                          )}`,
+                        );
+                      },
+                    );
+                    await controller.initializeProvider();
+
+                    const promiseForStateChanges = waitForStateChanges({
+                      messenger,
+                      count: 1,
+                    });
+
+                    await controller.updateNetwork(
+                      infuraChainId,
+                      {
+                        ...networkConfigurationToUpdate,
+                        rpcEndpoints: [
+                          networkConfigurationToUpdate.rpcEndpoints[1],
+                        ],
+                      },
+                      {
+                        replacementSelectedRpcEndpointIndex: 0,
+                      },
+                    );
+                    const stateChanges = await promiseForStateChanges;
+                    expect(stateChanges).toStrictEqual([
+                      [
+                        expect.any(Object),
+                        expect.arrayContaining([
+                          expect.objectContaining({
+                            op: 'replace',
+                            path: ['selectedNetworkClientId'],
+                            value: 'BBBB-BBBB-BBBB-BBBB',
+                          }),
+                          expect.objectContaining({
+                            op: 'replace',
+                            path: [
+                              'networkConfigurationsByChainId',
+                              infuraChainId,
+                            ],
+                          }),
+                        ]),
+                      ],
+                    ]);
+                  },
+                );
+              });
+            });
+
+            describe('if the replacement RPC endpoint is being added', () => {
+              it('selects the network client that represents the replacement RPC endpoint', async () => {
+                uuidV4Mock.mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+                const networkConfigurationToUpdate =
+                  buildInfuraNetworkConfiguration(infuraNetworkType, {
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://test.network/1',
+                      }),
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                        url: 'https://test.network/2',
+                      }),
+                    ],
+                  });
+
+                await withController(
+                  {
+                    state: {
+                      selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      networkConfigurationsByChainId: {
+                        [infuraChainId]: networkConfigurationToUpdate,
+                      },
+                    },
+                  },
+                  async ({ controller }) => {
+                    const fakeProviders = [
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 1',
+                          },
+                        },
+                      ]),
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 2',
+                          },
+                        },
+                      ]),
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 3',
+                          },
+                        },
+                      ]),
+                    ];
+                    const fakeNetworkClients = [
+                      buildFakeClient(fakeProviders[0]),
+                      buildFakeClient(fakeProviders[1]),
+                      buildFakeClient(fakeProviders[2]),
+                    ];
+                    createNetworkClientMock.mockImplementation(
+                      ({ configuration }) => {
+                        if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/1'
+                        ) {
+                          return fakeNetworkClients[0];
+                        } else if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/2'
+                        ) {
+                          return fakeNetworkClients[1];
+                        } else if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/3'
+                        ) {
+                          return fakeNetworkClients[2];
+                        }
+                        throw new Error(
+                          `Unknown network client configuration ${JSON.stringify(
+                            configuration,
+                          )}`,
+                        );
+                      },
+                    );
+                    await controller.initializeProvider();
+                    expect(controller.state.selectedNetworkClientId).toBe(
+                      'AAAA-AAAA-AAAA-AAAA',
+                    );
+                    const networkClient1 =
+                      controller.getSelectedNetworkClient();
+                    assert(networkClient1, 'Network client is somehow unset');
+                    const result1 = await networkClient1.provider.request({
+                      method: 'test',
+                    });
+                    expect(result1).toBe('test response from 1');
+
+                    await controller.updateNetwork(
+                      infuraChainId,
+                      {
+                        ...networkConfigurationToUpdate,
+                        rpcEndpoints: [
+                          buildUpdateNetworkCustomRpcEndpointFields({
+                            url: 'https://test.network/3',
+                          }),
+                          networkConfigurationToUpdate.rpcEndpoints[1],
+                        ],
+                      },
+                      {
+                        replacementSelectedRpcEndpointIndex: 0,
+                      },
+                    );
+                    expect(controller.state.selectedNetworkClientId).toBe(
+                      'CCCC-CCCC-CCCC-CCCC',
+                    );
+                    const networkClient2 =
+                      controller.getSelectedNetworkClient();
+                    assert(networkClient2, 'Network client is somehow unset');
+                    const result2 = await networkClient2.provider.request({
+                      method: 'test',
+                    });
+                    expect(result2).toBe('test response from 3');
+                  },
+                );
+              });
+
+              it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+                uuidV4Mock.mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+                const networkConfigurationToUpdate =
+                  buildInfuraNetworkConfiguration(infuraNetworkType, {
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://test.network/1',
+                      }),
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                        url: 'https://test.network/2',
+                      }),
+                    ],
+                  });
+
+                await withController(
+                  {
+                    state: {
+                      selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      networkConfigurationsByChainId: {
+                        [infuraChainId]: networkConfigurationToUpdate,
+                      },
+                    },
+                  },
+                  async ({ controller, messenger }) => {
+                    const fakeProviders = [
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 1',
+                          },
+                        },
+                      ]),
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 2',
+                          },
+                        },
+                      ]),
+                      buildFakeProvider([
+                        {
+                          request: {
+                            method: 'test',
+                          },
+                          response: {
+                            result: 'test response from 3',
+                          },
+                        },
+                      ]),
+                    ];
+                    const fakeNetworkClients = [
+                      buildFakeClient(fakeProviders[0]),
+                      buildFakeClient(fakeProviders[1]),
+                      buildFakeClient(fakeProviders[2]),
+                    ];
+                    createNetworkClientMock.mockImplementation(
+                      ({ configuration }) => {
+                        if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/1'
+                        ) {
+                          return fakeNetworkClients[0];
+                        } else if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/2'
+                        ) {
+                          return fakeNetworkClients[1];
+                        } else if (
+                          configuration.type === NetworkClientType.Custom &&
+                          configuration.rpcUrl === 'https://test.network/3'
+                        ) {
+                          return fakeNetworkClients[2];
+                        }
+                        throw new Error(
+                          `Unknown network client configuration ${JSON.stringify(
+                            configuration,
+                          )}`,
+                        );
+                      },
+                    );
+                    await controller.initializeProvider();
+
+                    const promiseForStateChanges = waitForStateChanges({
+                      messenger,
+                      count: 1,
+                    });
+
+                    await controller.updateNetwork(
+                      infuraChainId,
+                      {
+                        ...networkConfigurationToUpdate,
+                        rpcEndpoints: [
+                          buildUpdateNetworkCustomRpcEndpointFields({
+                            url: 'https://test.network/3',
+                          }),
+                          networkConfigurationToUpdate.rpcEndpoints[1],
+                        ],
+                      },
+                      {
+                        replacementSelectedRpcEndpointIndex: 0,
+                      },
+                    );
+                    const stateChanges = await promiseForStateChanges;
+                    expect(stateChanges).toStrictEqual([
+                      [
+                        expect.any(Object),
+                        expect.arrayContaining([
+                          expect.objectContaining({
+                            op: 'replace',
+                            path: ['selectedNetworkClientId'],
+                            value: 'CCCC-CCCC-CCCC-CCCC',
+                          }),
+                          expect.objectContaining({
+                            op: 'replace',
+                            path: [
+                              'networkConfigurationsByChainId',
+                              infuraChainId,
+                            ],
+                          }),
+                        ]),
+                      ],
+                    ]);
+                  },
+                );
+              });
+            });
+          });
+        });
+
+        describe('when the URL of an RPC endpoint is changed (using networkClientId as identification)', () => {
+          it('destroys and unregisters the network client for the previous version of the RPC endpoint', async () => {
+            uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const customRpcEndpoint = buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint',
+            });
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [customRpcEndpoint],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.chainId === infuraChainId &&
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://some.other.url'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                const existingNetworkClient = controller.getNetworkClientById(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                const destroySpy = jest.spyOn(existingNetworkClient, 'destroy');
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint,
+                      url: 'https://some.other.url',
+                    },
+                  ],
+                });
+
+                expect(destroySpy).toHaveBeenCalled();
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+              },
+            );
+          });
+
+          it('creates and registers a network client for the new version of the RPC endpoint', async () => {
+            uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+            const customRpcEndpoint = buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint',
+            });
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [customRpcEndpoint],
+              });
+            const getRpcServiceOptions = (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              btoa,
+              fetch,
+              isOffline: (): boolean => false,
+              fetchOptions: {
+                headers: {
+                  'X-Foo': 'Bar',
+                },
+              },
+              policyOptions: {
+                maxRetries: 2,
+                maxConsecutiveFailures: 10,
+              },
+            });
+            const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+              pollingInterval: 2000,
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                isRpcFailoverEnabled: true,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                createNetworkClientMock.mockReturnValue(buildFakeClient());
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint,
+                      url: 'https://some.other.url',
+                      failoverUrls: ['https://failover.endpoint'],
+                    },
+                  ],
+                });
+
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(3, {
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://failover.endpoint'],
+                    rpcUrl: 'https://some.other.url',
+                    ticker: infuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+                const networkConfigurationsByNetworkClientId =
+                  getNetworkConfigurationsByNetworkClientId(
+                    controller.getNetworkClientRegistry(),
+                  );
+                expect(
+                  networkConfigurationsByNetworkClientId['BBBB-BBBB-BBBB-BBBB'],
+                ).toStrictEqual({
+                  chainId: infuraChainId,
+                  failoverRpcUrls: ['https://failover.endpoint'],
+                  rpcUrl: 'https://some.other.url',
+                  ticker: infuraNativeTokenName,
+                  type: NetworkClientType.Custom,
+                });
+              },
+            );
+          });
+
+          it('updates the network configuration in state with a new network client ID for the RPC endpoint', async () => {
+            uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const customRpcEndpoint = buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint',
+            });
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [customRpcEndpoint],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockReturnValue(buildFakeClient());
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint,
+                      url: 'https://some.other.url',
+                    },
+                  ],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint,
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://some.other.url',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const customRpcEndpoint = buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint',
+            });
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [customRpcEndpoint],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockReturnValue(buildFakeClient());
+
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    rpcEndpoints: [
+                      {
+                        ...customRpcEndpoint,
+                        url: 'https://some.other.url',
+                      },
+                    ],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint,
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://some.other.url',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          describe('if the previous version of the RPC endpoint was represented by the selected network client', () => {
+            it('invisibly selects the network client for the new RPC endpoint', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildInfuraNetworkConfiguration(infuraNetworkType, {
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]: networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://rpc.endpoint'
+                      ) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://some.other.url'
+                      ) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'AAAA-AAAA-AAAA-AAAA',
+                  );
+                  const networkClient1 = controller.getSelectedNetworkClient();
+                  assert(networkClient1, 'Network client is somehow unset');
+                  const result1 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result1).toBe('test response from 1');
+
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        name: 'Endpoint 1',
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://some.other.url',
+                      }),
+                    ],
+                  });
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'BBBB-BBBB-BBBB-BBBB',
+                  );
+                  const networkClient2 = controller.getSelectedNetworkClient();
+                  assert(networkClient2, 'Network client is somehow unset');
+                  const result2 = await networkClient2.provider.request({
+                    method: 'test',
+                  });
+                  expect(result2).toBe('test response from 2');
+                },
+              );
+            });
+
+            it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildInfuraNetworkConfiguration(infuraNetworkType, {
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]: networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://rpc.endpoint'
+                      ) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://some.other.url'
+                      ) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+
+                  const promiseForStateChanges = waitForStateChanges({
+                    messenger,
+                    count: 1,
+                  });
+
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        name: 'Endpoint 1',
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                        url: 'https://some.other.url',
+                      }),
+                    ],
+                  });
+                  const stateChanges = await promiseForStateChanges;
+                  expect(stateChanges).toStrictEqual([
+                    [
+                      expect.any(Object),
+                      expect.arrayContaining([
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['selectedNetworkClientId'],
+                          value: 'BBBB-BBBB-BBBB-BBBB',
+                        }),
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: [
+                            'networkConfigurationsByChainId',
+                            infuraChainId,
+                          ],
+                        }),
+                      ]),
+                    ],
+                  ]);
+                },
+              );
+            });
+          });
+        });
+
+        describe('when all of the RPC endpoints are simply being shuffled', () => {
+          it('does not touch the network client registry', async () => {
+            const [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3] = [
+              buildInfuraRpcEndpoint(infuraNetworkType),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                });
+
+                expect(controller.getNetworkClientRegistry()).toStrictEqual(
+                  networkClientRegistry,
+                );
+              },
+            );
+          });
+
+          it('updates the network configuration in state with the new order of RPC endpoints', async () => {
+            const [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3] = [
+              buildInfuraRpcEndpoint(infuraNetworkType),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('returns the network configuration with the new order of RPC endpoints', async () => {
+            const [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3] = [
+              buildInfuraRpcEndpoint(infuraNetworkType),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+        });
+
+        describe('when the networkClientId of some custom RPC endpoints are being cleared', () => {
+          it('does not touch the network client registry', async () => {
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    rpcEndpoint1,
+                    { ...rpcEndpoint2, networkClientId: undefined },
+                  ],
+                });
+
+                expect(controller.getNetworkClientRegistry()).toStrictEqual(
+                  networkClientRegistry,
+                );
+              },
+            );
+          });
+
+          it('does not touch the network configuration in state, as if the network client IDs had not been cleared', async () => {
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                const previousNetworkConfigurationsByChainId =
+                  controller.state.networkConfigurationsByChainId;
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    rpcEndpoint1,
+                    { ...rpcEndpoint2, networkClientId: undefined },
+                  ],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).toStrictEqual(previousNetworkConfigurationsByChainId);
+              },
+            );
+          });
+
+          it('returns the network configuration, untouched', async () => {
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 2',
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://rpc.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    rpcEndpoints: [
+                      rpcEndpoint1,
+                      { ...rpcEndpoint2, networkClientId: undefined },
+                    ],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual(
+                  networkConfigurationToUpdate,
+                );
+              },
+            );
+          });
+        });
+
+        describe('when no RPC endpoints are being changed', () => {
+          it('does not touch the network client registry', async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                name: 'Some Name',
+                rpcEndpoints: [buildInfuraRpcEndpoint(infuraNetworkType)],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  name: 'Some Other Name',
+                });
+
+                expect(controller.getNetworkClientRegistry()).toStrictEqual(
+                  networkClientRegistry,
+                );
+              },
+            );
+          });
+        });
+      });
+    }
+
+    describe('if the existing chain ID is a non-Infura-supported chain and is not being changed', () => {
+      it('throws (albeit for a different reason) if an Infura RPC endpoint is being added that represents a different chain than the one being updated', async () => {
+        const defaultRpcEndpoint = buildInfuraRpcEndpoint(
+          InfuraNetworkType.mainnet,
+        );
+        const networkConfigurationToUpdate = buildNetworkConfiguration({
+          chainId: '0x1337',
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                [ChainId.mainnet]: buildInfuraNetworkConfiguration(
+                  InfuraNetworkType.mainnet,
+                ),
+              },
+              selectedNetworkClientId: InfuraNetworkType.mainnet,
+            },
+          },
+          async ({ controller }) => {
+            await expect(
+              controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  ...networkConfigurationToUpdate.rpcEndpoints,
+                  defaultRpcEndpoint,
+                ],
+              }),
+            ).rejects.toThrow(
+              "Could not update network to point to same RPC endpoint as existing network for chain 0x1 ('Ethereum Mainnet')",
+            );
+          },
+        );
+      });
+
+      describe('when new custom RPC endpoints are being added', () => {
+        it('creates and registers new network clients for each RPC endpoint', async () => {
+          uuidV4Mock
+            .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB')
+            .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+          const createAutoManagedNetworkClientSpy = jest.spyOn(
+            createAutoManagedNetworkClientModule,
+            'createAutoManagedNetworkClient',
+          );
+          const rpcEndpoint1 = buildCustomRpcEndpoint({
+            failoverUrls: [],
+            name: 'Endpoint 1',
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.endpoint/1',
+          });
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [rpcEndpoint1],
+          });
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+            fetchOptions: {
+              headers: {
+                'X-Foo': 'Bar',
+              },
+            },
+            policyOptions: {
+              maxRetries: 2,
+              maxConsecutiveFailures: 10,
+            },
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 2000,
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+              getRpcServiceOptions,
+              getBlockTrackerOptions,
+              isRpcFailoverEnabled: true,
+            },
+            async ({ controller, networkControllerMessenger }) => {
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                defaultRpcEndpointIndex: 0,
+                rpcEndpoints: [
+                  rpcEndpoint1,
+                  buildUpdateNetworkCustomRpcEndpointFields({
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: 'Endpoint 2',
+                    url: 'https://rpc.endpoint/2',
+                  }),
+                  buildUpdateNetworkCustomRpcEndpointFields({
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Endpoint 3',
+                    url: 'https://rpc.endpoint/3',
+                  }),
+                ],
+              });
+
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+                3,
+                {
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  networkClientConfiguration: {
+                    chainId: '0x1337',
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    rpcUrl: 'https://rpc.endpoint/2',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                },
+              );
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+                4,
+                {
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                  networkClientConfiguration: {
+                    chainId: '0x1337',
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://rpc.endpoint/3',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                },
+              );
+
+              const networkConfigurationsByNetworkClientId =
+                getNetworkConfigurationsByNetworkClientId(
+                  controller.getNetworkClientRegistry(),
+                );
+              expect(
+                networkConfigurationsByNetworkClientId['AAAA-AAAA-AAAA-AAAA'],
+              ).toStrictEqual({
+                chainId: '0x1337',
+                failoverRpcUrls: [],
+                rpcUrl: 'https://rpc.endpoint/1',
+                ticker: 'TOKEN',
+                type: NetworkClientType.Custom,
+              });
+              expect(
+                networkConfigurationsByNetworkClientId['BBBB-BBBB-BBBB-BBBB'],
+              ).toStrictEqual({
+                chainId: '0x1337',
+                failoverRpcUrls: ['https://first.failover.endpoint'],
+                rpcUrl: 'https://rpc.endpoint/2',
+                ticker: 'TOKEN',
+                type: NetworkClientType.Custom,
+              });
+              expect(
+                networkConfigurationsByNetworkClientId['CCCC-CCCC-CCCC-CCCC'],
+              ).toStrictEqual({
+                chainId: '0x1337',
+                failoverRpcUrls: ['https://second.failover.endpoint'],
+                rpcUrl: 'https://rpc.endpoint/3',
+                ticker: 'TOKEN',
+                type: NetworkClientType.Custom,
+              });
+            },
+          );
+        });
+
+        it('assigns the ID of the created network client to each RPC endpoint in state', async () => {
+          uuidV4Mock
+            .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB')
+            .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+          const rpcEndpoint1 = buildCustomRpcEndpoint({
+            name: 'Endpoint 1',
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.endpoint/1',
+          });
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                defaultRpcEndpointIndex: 0,
+                rpcEndpoints: [
+                  rpcEndpoint1,
+                  buildUpdateNetworkCustomRpcEndpointFields({
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: 'Endpoint 2',
+                    url: 'https://rpc.endpoint/2',
+                  }),
+                  buildUpdateNetworkCustomRpcEndpointFields({
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Endpoint 3',
+                    url: 'https://rpc.endpoint/3',
+                  }),
+                ],
+              });
+
+              expect(
+                controller.state.networkConfigurationsByChainId['0x1337'],
+              ).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  rpcEndpoint1,
+                  {
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: 'Endpoint 2',
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://rpc.endpoint/2',
+                  },
+                  {
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Endpoint 3',
+                    networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://rpc.endpoint/3',
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        it('returns the updated network configuration', async () => {
+          uuidV4Mock
+            .mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB')
+            .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+          const rpcEndpoint1 = buildCustomRpcEndpoint({
+            name: 'Endpoint 1',
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.endpoint/1',
+          });
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              const updatedNetworkConfiguration =
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [
+                    rpcEndpoint1,
+                    buildUpdateNetworkCustomRpcEndpointFields({
+                      failoverUrls: ['https://first.failover.endpoint'],
+                      name: 'Endpoint 2',
+                      url: 'https://rpc.endpoint/2',
+                    }),
+                    buildUpdateNetworkCustomRpcEndpointFields({
+                      failoverUrls: ['https://second.failover.endpoint'],
+                      name: 'Endpoint 3',
+                      url: 'https://rpc.endpoint/3',
+                    }),
+                  ],
+                });
+
+              expect(updatedNetworkConfiguration).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  rpcEndpoint1,
+                  {
+                    failoverUrls: ['https://first.failover.endpoint'],
+                    name: 'Endpoint 2',
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://rpc.endpoint/2',
+                  },
+                  {
+                    failoverUrls: ['https://second.failover.endpoint'],
+                    name: 'Endpoint 3',
+                    networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    type: RpcEndpointType.Custom,
+                    url: 'https://rpc.endpoint/3',
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+      });
+
+      describe('when some custom RPC endpoints are being removed', () => {
+        it('destroys and unregisters existing network clients for the RPC endpoints', async () => {
+          const [rpcEndpoint1, rpcEndpoint2] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+          });
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                },
+              },
+            },
+            async ({ controller }) => {
+              const existingNetworkClient = controller.getNetworkClientById(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+              const destroySpy = jest.spyOn(existingNetworkClient, 'destroy');
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                defaultRpcEndpointIndex: 0,
+                rpcEndpoints: [rpcEndpoint2],
+              });
+
+              expect(destroySpy).toHaveBeenCalled();
+              const networkClientRegistry =
+                controller.getNetworkClientRegistry();
+              expect(networkClientRegistry).not.toHaveProperty(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+            },
+          );
+        });
+
+        it('updates the network configuration in state', async () => {
+          const [rpcEndpoint1, rpcEndpoint2] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+          });
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                },
+              },
+            },
+            async ({ controller }) => {
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                defaultRpcEndpointIndex: 0,
+                rpcEndpoints: [rpcEndpoint2],
+              });
+
+              expect(
+                controller.state.networkConfigurationsByChainId['0x1337'],
+              ).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                defaultRpcEndpointIndex: 0,
+                rpcEndpoints: [rpcEndpoint2],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        it('returns the updated network configuration', async () => {
+          const [rpcEndpoint1, rpcEndpoint2] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+          });
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                },
+              },
+            },
+            async ({ controller }) => {
+              const updatedNetworkConfiguration =
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  defaultRpcEndpointIndex: 0,
+                  rpcEndpoints: [rpcEndpoint2],
+                });
+
+              expect(updatedNetworkConfiguration).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                defaultRpcEndpointIndex: 0,
+                rpcEndpoints: [rpcEndpoint2],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        describe('when one is represented by the selected network client (and a replacement is specified)', () => {
+          describe('if the replacement RPC endpoint already exists', () => {
+            it('selects the network client that represents the replacement RPC endpoint', async () => {
+              const networkConfigurationToUpdate =
+                buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                    }),
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      '0x1337': networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/1'
+                      ) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/2'
+                      ) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'AAAA-AAAA-AAAA-AAAA',
+                  );
+                  const networkClient1 = controller.getSelectedNetworkClient();
+                  assert(networkClient1, 'Network client is somehow unset');
+                  const result1 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result1).toBe('test response from 1');
+
+                  await controller.updateNetwork(
+                    '0x1337',
+                    {
+                      ...networkConfigurationToUpdate,
+                      rpcEndpoints: [
+                        networkConfigurationToUpdate.rpcEndpoints[1],
+                      ],
+                    },
+                    {
+                      replacementSelectedRpcEndpointIndex: 0,
+                    },
+                  );
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'BBBB-BBBB-BBBB-BBBB',
+                  );
+                  const networkClient2 = controller.getSelectedNetworkClient();
+                  assert(networkClient2, 'Network client is somehow unset');
+                  const result2 = await networkClient2.provider.request({
+                    method: 'test',
+                  });
+                  expect(result2).toBe('test response from 2');
+                },
+              );
+            });
+
+            it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+              const networkConfigurationToUpdate =
+                buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                    }),
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      '0x1337': networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/1'
+                      ) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/2'
+                      ) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+
+                  const promiseForStateChanges = waitForStateChanges({
+                    messenger,
+                    count: 1,
+                  });
+
+                  await controller.updateNetwork(
+                    '0x1337',
+                    {
+                      ...networkConfigurationToUpdate,
+                      rpcEndpoints: [
+                        networkConfigurationToUpdate.rpcEndpoints[1],
+                      ],
+                    },
+                    {
+                      replacementSelectedRpcEndpointIndex: 0,
+                    },
+                  );
+                  const stateChanges = await promiseForStateChanges;
+                  expect(stateChanges).toStrictEqual([
+                    [
+                      expect.any(Object),
+                      expect.arrayContaining([
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['selectedNetworkClientId'],
+                          value: 'BBBB-BBBB-BBBB-BBBB',
+                        }),
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['networkConfigurationsByChainId', '0x1337'],
+                        }),
+                      ]),
+                    ],
+                  ]);
+                },
+              );
+            });
+          });
+
+          describe('if the replacement RPC endpoint is being added', () => {
+            it('selects the network client that represents the replacement RPC endpoint', async () => {
+              uuidV4Mock.mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+              const networkConfigurationToUpdate =
+                buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                    }),
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      '0x1337': networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 3',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                    buildFakeClient(fakeProviders[2]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/1'
+                      ) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/2'
+                      ) {
+                        return fakeNetworkClients[1];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/3'
+                      ) {
+                        return fakeNetworkClients[2];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'AAAA-AAAA-AAAA-AAAA',
+                  );
+                  const networkClient1 = controller.getSelectedNetworkClient();
+                  assert(networkClient1, 'Network client is somehow unset');
+                  const result1 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result1).toBe('test response from 1');
+
+                  await controller.updateNetwork(
+                    '0x1337',
+                    {
+                      ...networkConfigurationToUpdate,
+                      rpcEndpoints: [
+                        buildUpdateNetworkCustomRpcEndpointFields({
+                          url: 'https://test.network/3',
+                        }),
+                        networkConfigurationToUpdate.rpcEndpoints[1],
+                      ],
+                    },
+                    {
+                      replacementSelectedRpcEndpointIndex: 0,
+                    },
+                  );
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'CCCC-CCCC-CCCC-CCCC',
+                  );
+                  const networkClient2 = controller.getSelectedNetworkClient();
+                  assert(networkClient2, 'Network client is somehow unset');
+                  const result2 = await networkClient2.provider.request({
+                    method: 'test',
+                  });
+                  expect(result2).toBe('test response from 3');
+                },
+              );
+            });
+
+            it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+              uuidV4Mock.mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC');
+              const networkConfigurationToUpdate =
+                buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network/1',
+                    }),
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.network/2',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      '0x1337': networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 3',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                    buildFakeClient(fakeProviders[2]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/1'
+                      ) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/2'
+                      ) {
+                        return fakeNetworkClients[1];
+                      } else if (
+                        configuration.type === NetworkClientType.Custom &&
+                        configuration.rpcUrl === 'https://test.network/3'
+                      ) {
+                        return fakeNetworkClients[2];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+
+                  const promiseForStateChanges = waitForStateChanges({
+                    messenger,
+                    count: 1,
+                  });
+
+                  await controller.updateNetwork(
+                    '0x1337',
+                    {
+                      ...networkConfigurationToUpdate,
+                      rpcEndpoints: [
+                        buildUpdateNetworkCustomRpcEndpointFields({
+                          url: 'https://test.network/3',
+                        }),
+                        networkConfigurationToUpdate.rpcEndpoints[1],
+                      ],
+                    },
+                    {
+                      replacementSelectedRpcEndpointIndex: 0,
+                    },
+                  );
+                  const stateChanges = await promiseForStateChanges;
+                  expect(stateChanges).toStrictEqual([
+                    [
+                      expect.any(Object),
+                      expect.arrayContaining([
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['selectedNetworkClientId'],
+                          value: 'CCCC-CCCC-CCCC-CCCC',
+                        }),
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['networkConfigurationsByChainId', '0x1337'],
+                        }),
+                      ]),
+                    ],
+                  ]);
+                },
+              );
+            });
+          });
+        });
+      });
+
+      describe('when the URL of an RPC endpoint is changed (using networkClientId as identification)', () => {
+        it('destroys and unregisters the network client for the previous version of the RPC endpoint', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint',
+              }),
+            ],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              createNetworkClientMock.mockReturnValue(buildFakeClient());
+              const existingNetworkClient = controller.getNetworkClientById(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+              const destroySpy = jest.spyOn(existingNetworkClient, 'destroy');
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    name: 'Endpoint 1',
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://some.other.url',
+                  }),
+                ],
+              });
+
+              expect(destroySpy).toHaveBeenCalled();
+              const networkClientRegistry =
+                controller.getNetworkClientRegistry();
+              expect(networkClientRegistry).not.toHaveProperty(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+            },
+          );
+        });
+
+        it('creates and registers a network client for the new version of the RPC endpoint', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+          const createAutoManagedNetworkClientSpy = jest.spyOn(
+            createAutoManagedNetworkClientModule,
+            'createAutoManagedNetworkClient',
+          );
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint',
+              }),
+            ],
+          });
+          const getRpcServiceOptions = (): Omit<
+            RpcServiceOptions,
+            'failoverService' | 'endpointUrl'
+          > => ({
+            btoa,
+            fetch,
+            isOffline: (): boolean => false,
+            fetchOptions: {
+              headers: {
+                'X-Foo': 'Bar',
+              },
+            },
+            policyOptions: {
+              maxRetries: 2,
+              maxConsecutiveFailures: 10,
+            },
+          });
+          const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+            pollingInterval: 2000,
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+              getRpcServiceOptions,
+              getBlockTrackerOptions,
+              isRpcFailoverEnabled: true,
+            },
+            async ({ controller, networkControllerMessenger }) => {
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (
+                    configuration.type === NetworkClientType.Custom &&
+                    configuration.rpcUrl === 'https://some.other.url'
+                  ) {
+                    return buildFakeClient();
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    failoverUrls: ['https://failover.endpoint'],
+                    name: 'Endpoint 1',
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://some.other.url',
+                  }),
+                ],
+              });
+
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenCalledWith({
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                networkClientConfiguration: {
+                  chainId: '0x1337',
+                  failoverRpcUrls: ['https://failover.endpoint'],
+                  rpcUrl: 'https://some.other.url',
+                  ticker: 'TOKEN',
+                  type: NetworkClientType.Custom,
+                },
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                messenger: networkControllerMessenger,
+                isRpcFailoverEnabled: true,
+              });
+              expect(
+                getNetworkConfigurationsByNetworkClientId(
+                  controller.getNetworkClientRegistry(),
+                ),
+              ).toMatchObject({
+                'BBBB-BBBB-BBBB-BBBB': {
+                  chainId: '0x1337',
+                  failoverRpcUrls: ['https://failover.endpoint'],
+                  rpcUrl: 'https://some.other.url',
+                  ticker: 'TOKEN',
+                  type: NetworkClientType.Custom,
+                },
+              });
+            },
+          );
+        });
+
+        it('updates the network configuration in state with a new network client ID for the RPC endpoint', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+          const customRpcEndpoint = buildCustomRpcEndpoint({
+            name: 'Endpoint 1',
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.endpoint',
+          });
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [customRpcEndpoint],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (
+                    configuration.type === NetworkClientType.Custom &&
+                    configuration.rpcUrl === 'https://some.other.url'
+                  ) {
+                    return buildFakeClient();
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  {
+                    ...customRpcEndpoint,
+                    url: 'https://some.other.url',
+                  },
+                ],
+              });
+
+              expect(
+                controller.state.networkConfigurationsByChainId['0x1337'],
+              ).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  {
+                    ...customRpcEndpoint,
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    url: 'https://some.other.url',
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        it('returns the updated network configuration', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+          const customRpcEndpoint = buildCustomRpcEndpoint({
+            name: 'Endpoint 1',
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://rpc.endpoint',
+          });
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [customRpcEndpoint],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (
+                    configuration.type === NetworkClientType.Custom &&
+                    configuration.rpcUrl === 'https://some.other.url'
+                  ) {
+                    return buildFakeClient();
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+
+              const updatedNetworkConfiguration =
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint,
+                      url: 'https://some.other.url',
+                    },
+                  ],
+                });
+
+              expect(updatedNetworkConfiguration).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  {
+                    ...customRpcEndpoint,
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    url: 'https://some.other.url',
+                  },
+                ],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        describe('if the previous version of the RPC endpoint was represented by the selected network client', () => {
+          it('invisibly selects the network client for the new RPC endpoint', async () => {
+            uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const networkConfigurationToUpdate =
+              buildCustomNetworkConfiguration({
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    name: 'Endpoint 1',
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://rpc.endpoint',
+                  }),
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                  },
+                },
+              },
+              async ({ controller }) => {
+                const fakeProviders = [
+                  buildFakeProvider([
+                    {
+                      request: {
+                        method: 'test',
+                      },
+                      response: {
+                        result: 'test response from 1',
+                      },
+                    },
+                  ]),
+                  buildFakeProvider([
+                    {
+                      request: {
+                        method: 'test',
+                      },
+                      response: {
+                        result: 'test response from 2',
+                      },
+                    },
+                  ]),
+                ];
+                const fakeNetworkClients = [
+                  buildFakeClient(fakeProviders[0]),
+                  buildFakeClient(fakeProviders[1]),
+                ];
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://rpc.endpoint'
+                    ) {
+                      return fakeNetworkClients[0];
+                    } else if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://some.other.url'
+                    ) {
+                      return fakeNetworkClients[1];
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                await controller.initializeProvider();
+                expect(controller.state.selectedNetworkClientId).toBe(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                const networkClient1 = controller.getSelectedNetworkClient();
+                assert(networkClient1, 'Network client is somehow unset');
+                const result1 = await networkClient1.provider.request({
+                  method: 'test',
+                });
+                expect(result1).toBe('test response from 1');
+
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://some.other.url',
+                    }),
+                  ],
+                });
+
+                expect(controller.state.selectedNetworkClientId).toBe(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+                const networkClient2 = controller.getSelectedNetworkClient();
+                assert(networkClient2, 'Network client is somehow unset');
+                const result2 = await networkClient1.provider.request({
+                  method: 'test',
+                });
+                expect(result2).toBe('test response from 2');
+              },
+            );
+          });
+
+          it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+            uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+            const networkConfigurationToUpdate =
+              buildCustomNetworkConfiguration({
+                nativeCurrency: 'TOKEN',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    name: 'Endpoint 1',
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://rpc.endpoint',
+                  }),
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                  },
+                },
+              },
+              async ({ controller, messenger }) => {
+                const fakeProviders = [
+                  buildFakeProvider([
+                    {
+                      request: {
+                        method: 'test',
+                      },
+                      response: {
+                        result: 'test response from 1',
+                      },
+                    },
+                  ]),
+                  buildFakeProvider([
+                    {
+                      request: {
+                        method: 'test',
+                      },
+                      response: {
+                        result: 'test response from 2',
+                      },
+                    },
+                  ]),
+                ];
+                const fakeNetworkClients = [
+                  buildFakeClient(fakeProviders[0]),
+                  buildFakeClient(fakeProviders[1]),
+                ];
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://rpc.endpoint'
+                    ) {
+                      return fakeNetworkClients[0];
+                    } else if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://some.other.url'
+                    ) {
+                      return fakeNetworkClients[1];
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                await controller.initializeProvider();
+
+                const promiseForStateChanges = waitForStateChanges({
+                  messenger,
+                  count: 1,
+                });
+
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://some.other.url',
+                    }),
+                  ],
+                });
+                const stateChanges = await promiseForStateChanges;
+                expect(stateChanges).toStrictEqual([
+                  [
+                    expect.any(Object),
+                    expect.arrayContaining([
+                      expect.objectContaining({
+                        op: 'replace',
+                        path: ['selectedNetworkClientId'],
+                        value: 'BBBB-BBBB-BBBB-BBBB',
+                      }),
+                      expect.objectContaining({
+                        op: 'replace',
+                        path: ['networkConfigurationsByChainId', '0x1337'],
+                      }),
+                    ]),
+                  ],
+                ]);
+              },
+            );
+          });
+        });
+      });
+
+      describe('when all of the RPC endpoints are simply being shuffled', () => {
+        it('does not touch the network client registry', async () => {
+          const [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 3',
+              networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+              url: 'https://rpc.endpoint/3',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+              const networkClientRegistry =
+                controller.getNetworkClientRegistry();
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+              });
+
+              expect(controller.getNetworkClientRegistry()).toStrictEqual(
+                networkClientRegistry,
+              );
+            },
+          );
+        });
+
+        it('updates the network configuration in state with the new order of RPC endpoints', async () => {
+          const [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 3',
+              networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+              url: 'https://rpc.endpoint/3',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+              });
+
+              expect(
+                controller.state.networkConfigurationsByChainId['0x1337'],
+              ).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+
+        it('returns the network configuration with the new order of RPC endpoints', async () => {
+          const [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 3',
+              networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+              url: 'https://rpc.endpoint/3',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2, rpcEndpoint3],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              const updatedNetworkConfiguration =
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                });
+
+              expect(updatedNetworkConfiguration).toStrictEqual({
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [rpcEndpoint3, rpcEndpoint1, rpcEndpoint2],
+                lastUpdatedAt: FAKE_DATE_NOW_MS,
+              });
+            },
+          );
+        });
+      });
+
+      describe('when the networkClientId of some custom RPC endpoints are being cleared', () => {
+        it('does not touch the network client registry', async () => {
+          const [rpcEndpoint1, rpcEndpoint2] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+              const networkClientRegistry =
+                controller.getNetworkClientRegistry();
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  rpcEndpoint1,
+                  { ...rpcEndpoint2, networkClientId: undefined },
+                ],
+              });
+
+              expect(controller.getNetworkClientRegistry()).toStrictEqual(
+                networkClientRegistry,
+              );
+            },
+          );
+        });
+
+        it('does not touch the network configuration in state, as if the network client IDs had not been cleared', async () => {
+          const [rpcEndpoint1, rpcEndpoint2] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              const previousNetworkConfigurationsByChainId =
+                controller.state.networkConfigurationsByChainId;
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                rpcEndpoints: [
+                  rpcEndpoint1,
+                  { ...rpcEndpoint2, networkClientId: undefined },
+                ],
+              });
+
+              expect(
+                controller.state.networkConfigurationsByChainId,
+              ).toStrictEqual(previousNetworkConfigurationsByChainId);
+            },
+          );
+        });
+
+        it('returns the network configuration, untouched', async () => {
+          const [rpcEndpoint1, rpcEndpoint2] = [
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://rpc.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Endpoint 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://rpc.endpoint/2',
+            }),
+          ];
+          const networkConfigurationToUpdate = buildNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              const updatedNetworkConfiguration =
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  rpcEndpoints: [
+                    rpcEndpoint1,
+                    { ...rpcEndpoint2, networkClientId: undefined },
+                  ],
+                });
+
+              expect(updatedNetworkConfiguration).toStrictEqual(
+                networkConfigurationToUpdate,
+              );
+            },
+          );
+        });
+      });
+
+      describe('when no RPC endpoints are being changed', () => {
+        it('does not touch the network client registry', async () => {
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [
+              buildCustomRpcEndpoint({
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://test.endpoint/1',
+              }),
+            ],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              mockCreateNetworkClient().mockReturnValue(buildFakeClient());
+              const networkClientRegistry =
+                controller.getNetworkClientRegistry();
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                name: 'Some Other Name',
+              });
+
+              expect(controller.getNetworkClientRegistry()).toStrictEqual(
+                networkClientRegistry,
+              );
+            },
+          );
+        });
+      });
+    });
+
+    const possibleInfuraNetworkTypes = INFURA_NETWORKS;
+    possibleInfuraNetworkTypes.forEach(
+      (infuraNetworkType, infuraNetworkTypeIndex) => {
+        const infuraNetworkNickname = NetworkNickname[infuraNetworkType];
+        const infuraChainId = ChainId[infuraNetworkType];
+        const anotherInfuraNetworkType =
+          possibleInfuraNetworkTypes[
+            (infuraNetworkTypeIndex + 1) % possibleInfuraNetworkTypes.length
+          ];
+        const anotherInfuraChainId = ChainId[anotherInfuraNetworkType];
+        const anotherInfuraNativeTokenName =
+          NetworksTicker[anotherInfuraNetworkType];
+        const anotherInfuraNetworkNickname =
+          NetworkNickname[anotherInfuraNetworkType];
+
+        describe(`if the chain ID is being changed from a non-Infura-supported chain to the Infura-supported chain ${infuraChainId}`, () => {
+          it(`throws if a network configuration for the Infura network "${infuraNetworkNickname}" is already registered under the new chain ID`, async () => {
+            const networkConfigurationToUpdate =
+              buildCustomNetworkConfiguration({ chainId: '0x1337' });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                    [infuraChainId]:
+                      buildInfuraNetworkConfiguration(infuraNetworkType),
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await expect(
+                  controller.updateNetwork('0x1337', {
+                    ...networkConfigurationToUpdate,
+                    chainId: infuraChainId,
+                  }),
+                ).rejects.toThrow(
+                  `Cannot move network from chain 0x1337 to ${infuraChainId} as another network for that chain already exists ('${infuraNetworkNickname}')`,
+                );
+              },
+            );
+          });
+
+          it('throws (albeit for a different reason) if an Infura RPC endpoint is being added that represents a different chain than the one being changed to', async () => {
+            const networkConfigurationToUpdate =
+              buildCustomNetworkConfiguration({ chainId: '0x1337' });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                    [anotherInfuraChainId]: buildInfuraNetworkConfiguration(
+                      anotherInfuraNetworkType,
+                    ),
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await expect(
+                  controller.updateNetwork('0x1337', {
+                    ...networkConfigurationToUpdate,
+                    chainId: infuraChainId,
+                    rpcEndpoints: [
+                      ...networkConfigurationToUpdate.rpcEndpoints,
+                      buildInfuraRpcEndpoint(anotherInfuraNetworkType),
+                    ],
+                  }),
+                ).rejects.toThrow(
+                  new Error(
+                    `Could not update network to point to same RPC endpoint as existing network for chain ${anotherInfuraChainId} ('${anotherInfuraNetworkNickname}')`,
+                  ),
+                );
+              },
+            );
+          });
+
+          it('re-files the existing network configuration from under the old chain ID to under the new one, regenerating network client IDs for each RPC endpoint', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://test.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://test.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate = buildNetworkConfiguration({
+              chainId: '0x1337',
+              rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  chainId: infuraChainId,
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).not.toHaveProperty('0x1337');
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).toHaveProperty(infuraChainId);
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  chainId: infuraChainId,
+                  rpcEndpoints: [
+                    {
+                      ...rpcEndpoint1,
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    },
+                    {
+                      ...rpcEndpoint2,
+                      networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('destroys and unregisters every network client for each of the RPC endpoints (even if none of the endpoint URLs were changed)', async () => {
+            const networkConfigurationToUpdate = buildNetworkConfiguration({
+              chainId: '0x1337',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  name: 'Test Network 1',
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  name: 'Test Network 2',
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ],
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                const existingNetworkClient1 = controller.getNetworkClientById(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                const destroySpy1 = jest.spyOn(
+                  existingNetworkClient1,
+                  'destroy',
+                );
+                const existingNetworkClient2 = controller.getNetworkClientById(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+                const destroySpy2 = jest.spyOn(
+                  existingNetworkClient2,
+                  'destroy',
+                );
+
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  chainId: infuraChainId,
+                });
+
+                expect(destroySpy1).toHaveBeenCalled();
+                expect(destroySpy2).toHaveBeenCalled();
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+              },
+            );
+          });
+
+          it('creates and registers new network clients for each of the given RPC endpoints', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+            const networkConfigurationToUpdate = buildNetworkConfiguration({
+              chainId: '0x1337',
+              nativeCurrency: 'TOKEN',
+              rpcEndpoints: [
+                buildCustomRpcEndpoint({
+                  failoverUrls: ['https://first.failover.endpoint'],
+                  name: 'Test Network 1',
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  failoverUrls: ['https://second.failover.endpoint'],
+                  name: 'Test Network 2',
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ],
+            });
+            const getRpcServiceOptions = (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              btoa,
+              fetch,
+              isOffline: (): boolean => false,
+              fetchOptions: {
+                headers: {
+                  'X-Foo': 'Bar',
+                },
+              },
+              policyOptions: {
+                maxRetries: 2,
+                maxConsecutiveFailures: 10,
+              },
+            });
+            const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+              pollingInterval: 2000,
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                isRpcFailoverEnabled: true,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                await controller.updateNetwork('0x1337', {
+                  ...networkConfigurationToUpdate,
+                  chainId: infuraChainId,
+                });
+
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(4, {
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/1',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(5, {
+                  networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                  networkClientConfiguration: {
+                    chainId: infuraChainId,
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/2',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+
+                const networkConfigurationsByNetworkClientId =
+                  getNetworkConfigurationsByNetworkClientId(
+                    controller.getNetworkClientRegistry(),
+                  );
+                expect(
+                  networkConfigurationsByNetworkClientId['CCCC-CCCC-CCCC-CCCC'],
+                ).toStrictEqual({
+                  chainId: infuraChainId,
+                  failoverRpcUrls: ['https://first.failover.endpoint'],
+                  rpcUrl: 'https://test.endpoint/1',
+                  ticker: 'TOKEN',
+                  type: NetworkClientType.Custom,
+                });
+                expect(
+                  networkConfigurationsByNetworkClientId['DDDD-DDDD-DDDD-DDDD'],
+                ).toStrictEqual({
+                  chainId: infuraChainId,
+                  failoverRpcUrls: ['https://second.failover.endpoint'],
+                  rpcUrl: 'https://test.endpoint/2',
+                  ticker: 'TOKEN',
+                  type: NetworkClientType.Custom,
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [rpcEndpoint1, rpcEndpoint2] = [
+              buildCustomRpcEndpoint({
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://test.endpoint/1',
+              }),
+              buildCustomRpcEndpoint({
+                networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                url: 'https://test.endpoint/2',
+              }),
+            ];
+            const networkConfigurationToUpdate = buildNetworkConfiguration({
+              chainId: '0x1337',
+              rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    '0x1337': networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork('0x1337', {
+                    ...networkConfigurationToUpdate,
+                    chainId: infuraChainId,
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  chainId: infuraChainId,
+                  rpcEndpoints: [
+                    {
+                      ...rpcEndpoint1,
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    },
+                    {
+                      ...rpcEndpoint2,
+                      networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          describe('if one of the RPC endpoints was represented by the selected network client', () => {
+            it('invisibly selects the network client created for the RPC endpoint', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildCustomNetworkConfiguration({
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      '0x1337': networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'AAAA-AAAA-AAAA-AAAA',
+                  );
+                  const networkClient1 = controller.getSelectedNetworkClient();
+                  assert(networkClient1, 'Network client is somehow unset');
+                  const result1 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result1).toBe('test response from 1');
+
+                  await controller.updateNetwork('0x1337', {
+                    ...networkConfigurationToUpdate,
+                    chainId: infuraChainId,
+                  });
+
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'BBBB-BBBB-BBBB-BBBB',
+                  );
+                  const networkClient2 = controller.getSelectedNetworkClient();
+                  assert(networkClient2, 'Network client is somehow unset');
+                  const result2 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result2).toBe('test response from 2');
+                },
+              );
+            });
+
+            it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildCustomNetworkConfiguration({
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      '0x1337': networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+
+                  const promiseForStateChanges = waitForStateChanges({
+                    messenger,
+                    count: 1,
+                  });
+
+                  await controller.updateNetwork('0x1337', {
+                    ...networkConfigurationToUpdate,
+                    chainId: infuraChainId,
+                  });
+                  const stateChanges = await promiseForStateChanges;
+                  expect(stateChanges).toStrictEqual([
+                    [
+                      expect.any(Object),
+                      expect.arrayContaining([
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['selectedNetworkClientId'],
+                          value: 'BBBB-BBBB-BBBB-BBBB',
+                        }),
+                        expect.objectContaining({
+                          op: 'remove',
+                          path: ['networkConfigurationsByChainId', '0x1337'],
+                        }),
+                        expect.objectContaining({
+                          op: 'add',
+                          path: [
+                            'networkConfigurationsByChainId',
+                            infuraChainId,
+                          ],
+                        }),
+                      ]),
+                    ],
+                  ]);
+                },
+              );
+            });
+          });
+        });
+
+        describe(`if the chain ID is being changed from the Infura-supported chain ${infuraChainId} to a non-Infura-supported chain`, () => {
+          it('throws if a network configuration for a custom network is already registered under the new chain ID', async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x1337': buildCustomNetworkConfiguration({
+                      chainId: '0x1337',
+                      name: 'Some Network',
+                    }),
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await expect(
+                  controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                  }),
+                ).rejects.toThrow(
+                  `Cannot move network from chain ${infuraChainId} to 0x1337 as another network for that chain already exists ('Some Network')`,
+                );
+              },
+            );
+          });
+
+          it('throws if the existing Infura RPC endpoint is not removed in the process of changing the chain ID', async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await expect(
+                  controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                  }),
+                ).rejects.toThrow(
+                  new Error(
+                    `Could not update network with chain ID 0x1337 and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,
+                  ),
+                );
+              },
+            );
+          });
+
+          it('re-files the existing network configuration from under the old chain ID to under the new one, regenerating network client IDs for each custom RPC endpoint', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                await controller.updateNetwork(
+                  infuraChainId,
+                  {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                    defaultRpcEndpointIndex: 0,
+                    nativeCurrency: 'TOKEN',
+                    rpcEndpoints: [customRpcEndpoint1, customRpcEndpoint2],
+                  },
+                  { replacementSelectedRpcEndpointIndex: 0 },
+                );
+
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).not.toHaveProperty(infuraChainId);
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).toHaveProperty('0x1337');
+                expect(
+                  controller.state.networkConfigurationsByChainId['0x1337'],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  chainId: '0x1337',
+                  defaultRpcEndpointIndex: 0,
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint1,
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    },
+                    {
+                      ...customRpcEndpoint2,
+                      networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('destroys and unregisters every network client for each of the custom RPC endpoints (even if none of the endpoint URLs were changed)', async () => {
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                const existingNetworkClient1 = controller.getNetworkClientById(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                const destroySpy1 = jest.spyOn(
+                  existingNetworkClient1,
+                  'destroy',
+                );
+                const existingNetworkClient2 = controller.getNetworkClientById(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+                const destroySpy2 = jest.spyOn(
+                  existingNetworkClient2,
+                  'destroy',
+                );
+
+                await controller.updateNetwork(
+                  infuraChainId,
+                  {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                    defaultRpcEndpointIndex: 0,
+                    nativeCurrency: 'TOKEN',
+                    rpcEndpoints: [customRpcEndpoint1, customRpcEndpoint2],
+                  },
+                  { replacementSelectedRpcEndpointIndex: 0 },
+                );
+
+                expect(destroySpy1).toHaveBeenCalled();
+                expect(destroySpy2).toHaveBeenCalled();
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+              },
+            );
+          });
+
+          it('creates and registers new network clients for each of the given custom RPC endpoints', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  failoverUrls: ['https://first.failover.endpoint'],
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  failoverUrls: ['https://second.failover.endpoint'],
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                nativeCurrency: 'ETH',
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+            const getRpcServiceOptions = (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              btoa,
+              fetch,
+              isOffline: (): boolean => false,
+              fetchOptions: {
+                headers: {
+                  'X-Foo': 'Bar',
+                },
+              },
+              policyOptions: {
+                maxRetries: 2,
+                maxConsecutiveFailures: 10,
+              },
+            });
+            const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+              pollingInterval: 2000,
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                isRpcFailoverEnabled: true,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                await controller.updateNetwork(
+                  infuraChainId,
+                  {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                    defaultRpcEndpointIndex: 0,
+                    nativeCurrency: 'TOKEN',
+                    rpcEndpoints: [customRpcEndpoint1, customRpcEndpoint2],
+                  },
+                  { replacementSelectedRpcEndpointIndex: 0 },
+                );
+
+                expect(createAutoManagedNetworkClientSpy).toHaveBeenCalledWith({
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                  networkClientConfiguration: {
+                    chainId: '0x1337',
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/1',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+                expect(createAutoManagedNetworkClientSpy).toHaveBeenCalledWith({
+                  networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                  networkClientConfiguration: {
+                    chainId: '0x1337',
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/2',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+
+                expect(
+                  getNetworkConfigurationsByNetworkClientId(
+                    controller.getNetworkClientRegistry(),
+                  ),
+                ).toMatchObject({
+                  'CCCC-CCCC-CCCC-CCCC': {
+                    chainId: '0x1337',
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/1',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                  'DDDD-DDDD-DDDD-DDDD': {
+                    chainId: '0x1337',
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/2',
+                    ticker: 'TOKEN',
+                    type: NetworkClientType.Custom,
+                  },
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (
+                      configuration.type === NetworkClientType.Custom &&
+                      configuration.rpcUrl === 'https://test.endpoint/1'
+                    ) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(
+                    infuraChainId,
+                    {
+                      ...networkConfigurationToUpdate,
+                      chainId: '0x1337',
+                      defaultRpcEndpointIndex: 0,
+                      nativeCurrency: 'TOKEN',
+                      rpcEndpoints: [customRpcEndpoint1, customRpcEndpoint2],
+                    },
+                    { replacementSelectedRpcEndpointIndex: 0 },
+                  );
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  chainId: '0x1337',
+                  defaultRpcEndpointIndex: 0,
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    {
+                      ...customRpcEndpoint1,
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    },
+                    {
+                      ...customRpcEndpoint2,
+                      networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          describe('if one of the RPC endpoints was represented by the selected network client', () => {
+            it('invisibly selects the network client created for the RPC endpoint', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildInfuraNetworkConfiguration(infuraNetworkType, {
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]: networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'AAAA-AAAA-AAAA-AAAA',
+                  );
+                  const networkClient1 = controller.getSelectedNetworkClient();
+                  assert(networkClient1, 'Network client is somehow unset');
+                  const result1 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result1).toBe('test response from 1');
+
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                  });
+
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'BBBB-BBBB-BBBB-BBBB',
+                  );
+                  const networkClient2 = controller.getSelectedNetworkClient();
+                  assert(networkClient2, 'Network client is somehow unset');
+                  const result2 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result2).toBe('test response from 2');
+                },
+              );
+            });
+
+            it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildInfuraNetworkConfiguration(infuraNetworkType, {
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]: networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (configuration.chainId === '0x1337') {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+
+                  const promiseForStateChanges = waitForStateChanges({
+                    messenger,
+                    count: 1,
+                  });
+
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: '0x1337',
+                  });
+                  const stateChanges = await promiseForStateChanges;
+                  expect(stateChanges).toStrictEqual([
+                    [
+                      expect.any(Object),
+                      expect.arrayContaining([
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['selectedNetworkClientId'],
+                          value: 'BBBB-BBBB-BBBB-BBBB',
+                        }),
+                        expect.objectContaining({
+                          op: 'remove',
+                          path: [
+                            'networkConfigurationsByChainId',
+                            infuraChainId,
+                          ],
+                        }),
+                        expect.objectContaining({
+                          op: 'add',
+                          path: ['networkConfigurationsByChainId', '0x1337'],
+                        }),
+                      ]),
+                    ],
+                  ]);
+                },
+              );
+            });
+          });
+        });
+
+        describe(`if the chain ID is being changed from the Infura-supported chain ${infuraChainId} to a different Infura-supported chain ${anotherInfuraChainId}`, () => {
+          it(`throws if a network configuration for the Infura network "${infuraNetworkNickname}" is already registered under the new chain ID`, async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    [anotherInfuraChainId]: buildInfuraNetworkConfiguration(
+                      anotherInfuraNetworkType,
+                    ),
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await expect(
+                  controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: anotherInfuraChainId,
+                  }),
+                ).rejects.toThrow(
+                  `Cannot move network from chain ${infuraChainId} to ${anotherInfuraChainId} as another network for that chain already exists ('${anotherInfuraNetworkNickname}')`,
+                );
+              },
+            );
+          });
+
+          it('throws if the existing Infura RPC endpoint is not updated in the process of changing the chain ID', async () => {
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await expect(
+                  controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: anotherInfuraChainId,
+                  }),
+                ).rejects.toThrow(
+                  new Error(
+                    `Could not update network with chain ID ${anotherInfuraChainId} and Infura RPC endpoint for '${infuraNetworkNickname}' which represents ${infuraChainId}, as the two conflict`,
+                  ),
+                );
+              },
+            );
+          });
+
+          it('re-files the existing network configuration from under the old chain ID to under the new one, regenerating network client IDs for each custom RPC endpoint', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === anotherInfuraChainId) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                const anotherInfuraRpcEndpoint = buildInfuraRpcEndpoint(
+                  anotherInfuraNetworkType,
+                );
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  chainId: anotherInfuraChainId,
+                  defaultRpcEndpointIndex: 0,
+                  nativeCurrency: anotherInfuraNativeTokenName,
+                  rpcEndpoints: [
+                    anotherInfuraRpcEndpoint,
+                    customRpcEndpoint1,
+                    customRpcEndpoint2,
+                  ],
+                });
+
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).not.toHaveProperty(infuraChainId);
+                expect(
+                  controller.state.networkConfigurationsByChainId,
+                ).toHaveProperty(anotherInfuraChainId);
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    anotherInfuraChainId
+                  ],
+                ).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  chainId: anotherInfuraChainId,
+                  nativeCurrency: anotherInfuraNativeTokenName,
+                  rpcEndpoints: [
+                    anotherInfuraRpcEndpoint,
+                    {
+                      ...customRpcEndpoint1,
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    },
+                    {
+                      ...customRpcEndpoint2,
+                      networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          it('destroys and unregisters every network client for each of the custom RPC endpoints (even if none of the endpoint URLs were changed)', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === anotherInfuraChainId) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+                const existingNetworkClient1 = controller.getNetworkClientById(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                const destroySpy1 = jest.spyOn(
+                  existingNetworkClient1,
+                  'destroy',
+                );
+                const existingNetworkClient2 = controller.getNetworkClientById(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+                const destroySpy2 = jest.spyOn(
+                  existingNetworkClient2,
+                  'destroy',
+                );
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  chainId: anotherInfuraChainId,
+                  defaultRpcEndpointIndex: 0,
+                  nativeCurrency: anotherInfuraNativeTokenName,
+                  rpcEndpoints: [
+                    buildInfuraRpcEndpoint(anotherInfuraNetworkType),
+                    customRpcEndpoint1,
+                    customRpcEndpoint2,
+                  ],
+                });
+
+                expect(destroySpy1).toHaveBeenCalled();
+                expect(destroySpy2).toHaveBeenCalled();
+                const networkClientRegistry =
+                  controller.getNetworkClientRegistry();
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'AAAA-AAAA-AAAA-AAAA',
+                );
+                expect(networkClientRegistry).not.toHaveProperty(
+                  'BBBB-BBBB-BBBB-BBBB',
+                );
+              },
+            );
+          });
+
+          it('creates and registers new network clients for each of the given custom RPC endpoints', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  failoverUrls: ['https://first.failover.endpoint'],
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  failoverUrls: ['https://second.failover.endpoint'],
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                nativeCurrency: 'ETH',
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+            const getRpcServiceOptions = (): Omit<
+              RpcServiceOptions,
+              'failoverService' | 'endpointUrl'
+            > => ({
+              btoa,
+              fetch,
+              isOffline: (): boolean => false,
+              fetchOptions: {
+                headers: {
+                  'X-Foo': 'Bar',
+                },
+              },
+              policyOptions: {
+                maxRetries: 2,
+                maxConsecutiveFailures: 10,
+              },
+            });
+            const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+              pollingInterval: 2000,
+            });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                isRpcFailoverEnabled: true,
+              },
+              async ({ controller, networkControllerMessenger }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === anotherInfuraChainId) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                await controller.updateNetwork(infuraChainId, {
+                  ...networkConfigurationToUpdate,
+                  chainId: anotherInfuraChainId,
+                  defaultRpcEndpointIndex: 0,
+                  nativeCurrency: anotherInfuraNativeTokenName,
+                  rpcEndpoints: [
+                    buildInfuraRpcEndpoint(anotherInfuraNetworkType),
+                    customRpcEndpoint1,
+                    customRpcEndpoint2,
+                  ],
+                });
+
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(6, {
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                  networkClientConfiguration: {
+                    chainId: anotherInfuraChainId,
+                    failoverRpcUrls: ['https://first.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/1',
+                    ticker: anotherInfuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+                expect(
+                  createAutoManagedNetworkClientSpy,
+                ).toHaveBeenNthCalledWith(7, {
+                  networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                  networkClientConfiguration: {
+                    chainId: anotherInfuraChainId,
+                    failoverRpcUrls: ['https://second.failover.endpoint'],
+                    rpcUrl: 'https://test.endpoint/2',
+                    ticker: anotherInfuraNativeTokenName,
+                    type: NetworkClientType.Custom,
+                  },
+                  getRpcServiceOptions,
+                  getBlockTrackerOptions,
+                  messenger: networkControllerMessenger,
+                  isRpcFailoverEnabled: true,
+                });
+
+                const networkConfigurationsByChainId =
+                  getNetworkConfigurationsByNetworkClientId(
+                    controller.getNetworkClientRegistry(),
+                  );
+                expect(
+                  networkConfigurationsByChainId['CCCC-CCCC-CCCC-CCCC'],
+                ).toStrictEqual({
+                  chainId: anotherInfuraChainId,
+                  failoverRpcUrls: ['https://first.failover.endpoint'],
+                  rpcUrl: 'https://test.endpoint/1',
+                  ticker: anotherInfuraNativeTokenName,
+                  type: NetworkClientType.Custom,
+                });
+                expect(
+                  networkConfigurationsByChainId['DDDD-DDDD-DDDD-DDDD'],
+                ).toStrictEqual({
+                  chainId: anotherInfuraChainId,
+                  failoverRpcUrls: ['https://second.failover.endpoint'],
+                  rpcUrl: 'https://test.endpoint/2',
+                  ticker: anotherInfuraNativeTokenName,
+                  type: NetworkClientType.Custom,
+                });
+              },
+            );
+          });
+
+          it('returns the updated network configuration', async () => {
+            uuidV4Mock
+              .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+              .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+            const [defaultRpcEndpoint, customRpcEndpoint1, customRpcEndpoint2] =
+              [
+                buildInfuraRpcEndpoint(infuraNetworkType),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  url: 'https://test.endpoint/1',
+                }),
+                buildCustomRpcEndpoint({
+                  networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                  url: 'https://test.endpoint/2',
+                }),
+              ];
+            const networkConfigurationToUpdate =
+              buildInfuraNetworkConfiguration(infuraNetworkType, {
+                rpcEndpoints: [
+                  defaultRpcEndpoint,
+                  customRpcEndpoint1,
+                  customRpcEndpoint2,
+                ],
+              });
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: networkConfigurationToUpdate,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+                infuraProjectId: 'some-infura-project-id',
+              },
+              async ({ controller }) => {
+                createNetworkClientMock.mockImplementation(
+                  ({ configuration }) => {
+                    if (configuration.chainId === anotherInfuraChainId) {
+                      return buildFakeClient();
+                    }
+                    throw new Error(
+                      `Unknown network client configuration ${JSON.stringify(
+                        configuration,
+                      )}`,
+                    );
+                  },
+                );
+
+                const anotherInfuraRpcEndpoint = buildInfuraRpcEndpoint(
+                  anotherInfuraNetworkType,
+                );
+                const updatedNetworkConfiguration =
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: anotherInfuraChainId,
+                    defaultRpcEndpointIndex: 0,
+                    nativeCurrency: anotherInfuraNativeTokenName,
+                    rpcEndpoints: [
+                      anotherInfuraRpcEndpoint,
+                      customRpcEndpoint1,
+                      customRpcEndpoint2,
+                    ],
+                  });
+
+                expect(updatedNetworkConfiguration).toStrictEqual({
+                  ...networkConfigurationToUpdate,
+                  chainId: anotherInfuraChainId,
+                  defaultRpcEndpointIndex: 0,
+                  nativeCurrency: anotherInfuraNativeTokenName,
+                  rpcEndpoints: [
+                    anotherInfuraRpcEndpoint,
+                    {
+                      ...customRpcEndpoint1,
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    },
+                    {
+                      ...customRpcEndpoint2,
+                      networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                    },
+                  ],
+                  lastUpdatedAt: FAKE_DATE_NOW_MS,
+                });
+              },
+            );
+          });
+
+          describe('if one of the RPC endpoints was represented by the selected network client', () => {
+            it('invisibly selects the network client created for the RPC endpoint', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildInfuraNetworkConfiguration(infuraNetworkType, {
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]: networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.chainId === anotherInfuraChainId
+                      ) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'AAAA-AAAA-AAAA-AAAA',
+                  );
+                  const networkClient1 = controller.getSelectedNetworkClient();
+                  assert(networkClient1, 'Network client is somehow unset');
+                  const result1 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result1).toBe('test response from 1');
+
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: anotherInfuraChainId,
+                  });
+
+                  expect(controller.state.selectedNetworkClientId).toBe(
+                    'BBBB-BBBB-BBBB-BBBB',
+                  );
+                  const networkClient2 = controller.getSelectedNetworkClient();
+                  assert(networkClient2, 'Network client is somehow unset');
+                  const result2 = await networkClient1.provider.request({
+                    method: 'test',
+                  });
+                  expect(result2).toBe('test response from 2');
+                },
+              );
+            });
+
+            it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+              uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+              const networkConfigurationToUpdate =
+                buildInfuraNetworkConfiguration(infuraNetworkType, {
+                  nativeCurrency: 'TOKEN',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Endpoint 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://rpc.endpoint',
+                    }),
+                  ],
+                });
+
+              await withController(
+                {
+                  state: {
+                    selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    networkConfigurationsByChainId: {
+                      [infuraChainId]: networkConfigurationToUpdate,
+                    },
+                  },
+                },
+                async ({ controller, messenger }) => {
+                  const fakeProviders = [
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 1',
+                        },
+                      },
+                    ]),
+                    buildFakeProvider([
+                      {
+                        request: {
+                          method: 'test',
+                        },
+                        response: {
+                          result: 'test response from 2',
+                        },
+                      },
+                    ]),
+                  ];
+                  const fakeNetworkClients = [
+                    buildFakeClient(fakeProviders[0]),
+                    buildFakeClient(fakeProviders[1]),
+                  ];
+                  createNetworkClientMock.mockImplementation(
+                    ({ configuration }) => {
+                      if (configuration.chainId === infuraChainId) {
+                        return fakeNetworkClients[0];
+                      } else if (
+                        configuration.chainId === anotherInfuraChainId
+                      ) {
+                        return fakeNetworkClients[1];
+                      }
+                      throw new Error(
+                        `Unknown network client configuration ${JSON.stringify(
+                          configuration,
+                        )}`,
+                      );
+                    },
+                  );
+                  await controller.initializeProvider();
+
+                  const promiseForStateChanges = waitForStateChanges({
+                    messenger,
+                    count: 1,
+                  });
+
+                  await controller.updateNetwork(infuraChainId, {
+                    ...networkConfigurationToUpdate,
+                    chainId: anotherInfuraChainId,
+                  });
+                  const stateChanges = await promiseForStateChanges;
+                  expect(stateChanges).toStrictEqual([
+                    [
+                      expect.any(Object),
+                      expect.arrayContaining([
+                        expect.objectContaining({
+                          op: 'replace',
+                          path: ['selectedNetworkClientId'],
+                          value: 'BBBB-BBBB-BBBB-BBBB',
+                        }),
+                        expect.objectContaining({
+                          op: 'remove',
+                          path: [
+                            'networkConfigurationsByChainId',
+                            infuraChainId,
+                          ],
+                        }),
+                        expect.objectContaining({
+                          op: 'add',
+                          path: [
+                            'networkConfigurationsByChainId',
+                            anotherInfuraChainId,
+                          ],
+                        }),
+                      ]),
+                    ],
+                  ]);
+                },
+              );
+            });
+          });
+        });
+      },
+    );
+
+    describe('if the chain ID is being changed from one non-Infura-supported chain to another', () => {
+      it('throws if a network configuration for a custom network is already registered under the new chain ID', async () => {
+        const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+          chainId: '0x1337',
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                '0x2448': buildNetworkConfiguration({
+                  name: 'Some Network',
+                  chainId: '0x2448',
+                }),
+                '0x9999': buildCustomNetworkConfiguration({
+                  chainId: '0x9999',
+                  nativeCurrency: 'TEST-9999',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                      url: 'https://selected.endpoint',
+                    }),
+                  ],
+                }),
+              },
+              selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+            },
+          },
+          async ({ controller }) => {
+            await expect(() =>
+              controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                chainId: '0x2448',
+              }),
+            ).rejects.toThrow(
+              "Cannot move network from chain 0x1337 to 0x2448 as another network for that chain already exists ('Some Network')",
+            );
+          },
+        );
+      });
+
+      it('throws (albeit for a different reason) if an Infura RPC endpoint is being added that represents a different chain than the one being changed to', async () => {
+        const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+          chainId: '0x1337',
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+                '0x9999': buildCustomNetworkConfiguration({
+                  chainId: '0x9999',
+                  nativeCurrency: 'TEST-9999',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                      url: 'https://selected.endpoint',
+                    }),
+                  ],
+                }),
+              },
+              selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+            },
+          },
+          async ({ controller }) => {
+            const newRpcEndpoint = buildInfuraRpcEndpoint(TESTNET.networkType);
+            await expect(() =>
+              controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                chainId: '0x2448',
+                rpcEndpoints: [newRpcEndpoint],
+              }),
+            ).rejects.toThrow(
+              new Error(
+                `Could not update network to point to same RPC endpoint as existing network for chain ${TESTNET.chainId} ('${TESTNET.name}')`,
+              ),
+            );
+          },
+        );
+      });
+
+      it('re-files the existing network configuration from under the old chain ID to under the new one, regenerating network client IDs for each RPC endpoint', async () => {
+        uuidV4Mock
+          .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+          .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+        const [rpcEndpoint1, rpcEndpoint2] = [
+          buildCustomRpcEndpoint({
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://test.endpoint/1',
+          }),
+          buildCustomRpcEndpoint({
+            networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+            url: 'https://test.endpoint/2',
+          }),
+        ];
+        const networkConfigurationToUpdate = buildNetworkConfiguration({
+          chainId: '0x1337',
+          rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                '0x9999': buildCustomNetworkConfiguration({
+                  chainId: '0x9999',
+                  nativeCurrency: 'TEST-9999',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                      url: 'https://selected.endpoint',
+                    }),
+                  ],
+                }),
+              },
+              selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+            },
+          },
+          async ({ controller }) => {
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (
+                configuration.type === NetworkClientType.Custom &&
+                configuration.rpcUrl === 'https://test.endpoint/1'
+              ) {
+                return buildFakeClient();
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+
+            await controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              chainId: '0x2448',
+            });
+
+            expect(
+              controller.state.networkConfigurationsByChainId,
+            ).not.toHaveProperty('0x1337');
+            expect(
+              controller.state.networkConfigurationsByChainId,
+            ).toHaveProperty('0x2448');
+            expect(
+              controller.state.networkConfigurationsByChainId['0x2448'],
+            ).toStrictEqual({
+              ...networkConfigurationToUpdate,
+              chainId: '0x2448',
+              rpcEndpoints: [
+                {
+                  ...rpcEndpoint1,
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                },
+                {
+                  ...rpcEndpoint2,
+                  networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                },
+              ],
+              lastUpdatedAt: FAKE_DATE_NOW_MS,
+            });
+          },
+        );
+      });
+
+      it('destroys and unregisters every network client for each of the RPC endpoints (even if none of the endpoint URLs were changed)', async () => {
+        const networkConfigurationToUpdate = buildNetworkConfiguration({
+          chainId: '0x1337',
+          rpcEndpoints: [
+            buildCustomRpcEndpoint({
+              name: 'Test Network 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://test.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              name: 'Test Network 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://test.endpoint/2',
+            }),
+          ],
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                '0x9999': buildCustomNetworkConfiguration({
+                  chainId: '0x9999',
+                  nativeCurrency: 'TEST-9999',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                      url: 'https://selected.endpoint',
+                    }),
+                  ],
+                }),
+              },
+              selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+            },
+          },
+          async ({ controller }) => {
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (
+                configuration.type === NetworkClientType.Custom &&
+                configuration.rpcUrl === 'https://test.endpoint/1'
+              ) {
+                return buildFakeClient();
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            const existingNetworkClient1 = controller.getNetworkClientById(
+              'AAAA-AAAA-AAAA-AAAA',
+            );
+            const destroySpy1 = jest.spyOn(existingNetworkClient1, 'destroy');
+            const existingNetworkClient2 = controller.getNetworkClientById(
+              'BBBB-BBBB-BBBB-BBBB',
+            );
+            const destroySpy2 = jest.spyOn(existingNetworkClient2, 'destroy');
+
+            await controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              chainId: '0x2448',
+            });
+
+            expect(destroySpy1).toHaveBeenCalled();
+            expect(destroySpy2).toHaveBeenCalled();
+            const networkClientRegistry = controller.getNetworkClientRegistry();
+            expect(networkClientRegistry).not.toHaveProperty(
+              'AAAA-AAAA-AAAA-AAAA',
+            );
+            expect(networkClientRegistry).not.toHaveProperty(
+              'BBBB-BBBB-BBBB-BBBB',
+            );
+          },
+        );
+      });
+
+      it('creates and registers new network clients for each of the given RPC endpoints', async () => {
+        uuidV4Mock
+          .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+          .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+        const createAutoManagedNetworkClientSpy = jest.spyOn(
+          createAutoManagedNetworkClientModule,
+          'createAutoManagedNetworkClient',
+        );
+        const networkConfigurationToUpdate = buildNetworkConfiguration({
+          chainId: '0x1337',
+          nativeCurrency: 'TOKEN',
+          rpcEndpoints: [
+            buildCustomRpcEndpoint({
+              failoverUrls: ['https://first.failover.endpoint'],
+              name: 'Test Network 1',
+              networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              url: 'https://test.endpoint/1',
+            }),
+            buildCustomRpcEndpoint({
+              failoverUrls: ['https://second.failover.endpoint'],
+              name: 'Test Network 2',
+              networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+              url: 'https://test.endpoint/2',
+            }),
+          ],
+        });
+        const getRpcServiceOptions = (): Omit<
+          RpcServiceOptions,
+          'failoverService' | 'endpointUrl'
+        > => ({
+          btoa,
+          fetch,
+          isOffline: (): boolean => false,
+          fetchOptions: {
+            headers: {
+              'X-Foo': 'Bar',
+            },
+          },
+          policyOptions: {
+            maxRetries: 2,
+            maxConsecutiveFailures: 10,
+          },
+        });
+        const getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({
+          pollingInterval: 2000,
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                '0x9999': buildCustomNetworkConfiguration({
+                  chainId: '0x9999',
+                  nativeCurrency: 'TEST-9999',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                      url: 'https://selected.endpoint',
+                    }),
+                  ],
+                }),
+              },
+              selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+            },
+            getRpcServiceOptions,
+            getBlockTrackerOptions,
+            isRpcFailoverEnabled: true,
+          },
+          async ({ controller, networkControllerMessenger }) => {
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (
+                configuration.type === NetworkClientType.Custom &&
+                configuration.rpcUrl === 'https://test.endpoint/1'
+              ) {
+                return buildFakeClient();
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+
+            await controller.updateNetwork('0x1337', {
+              ...networkConfigurationToUpdate,
+              chainId: '0x2448',
+            });
+
+            expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+              4,
+              {
+                networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                networkClientConfiguration: {
+                  chainId: '0x2448',
+                  failoverRpcUrls: ['https://first.failover.endpoint'],
+                  rpcUrl: 'https://test.endpoint/1',
+                  ticker: 'TOKEN',
+                  type: NetworkClientType.Custom,
+                },
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                messenger: networkControllerMessenger,
+                isRpcFailoverEnabled: true,
+              },
+            );
+            expect(createAutoManagedNetworkClientSpy).toHaveBeenNthCalledWith(
+              5,
+              {
+                networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                networkClientConfiguration: {
+                  chainId: '0x2448',
+                  failoverRpcUrls: ['https://second.failover.endpoint'],
+                  rpcUrl: 'https://test.endpoint/2',
+                  ticker: 'TOKEN',
+                  type: NetworkClientType.Custom,
+                },
+                getRpcServiceOptions,
+                getBlockTrackerOptions,
+                messenger: networkControllerMessenger,
+                isRpcFailoverEnabled: true,
+              },
+            );
+
+            const networkConfigurationsByChainId =
+              getNetworkConfigurationsByNetworkClientId(
+                controller.getNetworkClientRegistry(),
+              );
+            expect(
+              networkConfigurationsByChainId['CCCC-CCCC-CCCC-CCCC'],
+            ).toStrictEqual({
+              chainId: '0x2448',
+              failoverRpcUrls: ['https://first.failover.endpoint'],
+              rpcUrl: 'https://test.endpoint/1',
+              ticker: 'TOKEN',
+              type: NetworkClientType.Custom,
+            });
+            expect(
+              networkConfigurationsByChainId['DDDD-DDDD-DDDD-DDDD'],
+            ).toStrictEqual({
+              chainId: '0x2448',
+              failoverRpcUrls: ['https://second.failover.endpoint'],
+              rpcUrl: 'https://test.endpoint/2',
+              ticker: 'TOKEN',
+              type: NetworkClientType.Custom,
+            });
+          },
+        );
+      });
+
+      it('returns the updated network configuration', async () => {
+        uuidV4Mock
+          .mockReturnValueOnce('CCCC-CCCC-CCCC-CCCC')
+          .mockReturnValueOnce('DDDD-DDDD-DDDD-DDDD');
+
+        const [rpcEndpoint1, rpcEndpoint2] = [
+          buildCustomRpcEndpoint({
+            networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            url: 'https://test.endpoint/1',
+          }),
+          buildCustomRpcEndpoint({
+            networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+            url: 'https://test.endpoint/2',
+          }),
+        ];
+        const networkConfigurationToUpdate = buildNetworkConfiguration({
+          chainId: '0x1337',
+          rpcEndpoints: [rpcEndpoint1, rpcEndpoint2],
+        });
+
+        await withController(
+          {
+            state: {
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfigurationToUpdate,
+                '0x9999': buildCustomNetworkConfiguration({
+                  chainId: '0x9999',
+                  nativeCurrency: 'TEST-9999',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                      url: 'https://selected.endpoint',
+                    }),
+                  ],
+                }),
+              },
+              selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+            },
+          },
+          async ({ controller }) => {
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (
+                configuration.type === NetworkClientType.Custom &&
+                configuration.rpcUrl === 'https://test.endpoint/1'
+              ) {
+                return buildFakeClient();
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+
+            const updatedNetworkConfiguration = await controller.updateNetwork(
+              '0x1337',
+              {
+                ...networkConfigurationToUpdate,
+                chainId: '0x2448',
+              },
+            );
+
+            expect(updatedNetworkConfiguration).toStrictEqual({
+              ...networkConfigurationToUpdate,
+              chainId: '0x2448',
+              rpcEndpoints: [
+                {
+                  ...rpcEndpoint1,
+                  networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                },
+                {
+                  ...rpcEndpoint2,
+                  networkClientId: 'DDDD-DDDD-DDDD-DDDD',
+                },
+              ],
+              lastUpdatedAt: FAKE_DATE_NOW_MS,
+            });
+          },
+        );
+      });
+
+      describe('if one of the RPC endpoints was represented by the selected network client', () => {
+        it('invisibly selects the network client created for the RPC endpoint', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint',
+              }),
+            ],
+          });
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                },
+              },
+            },
+            async ({ controller }) => {
+              const fakeProviders = [
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test',
+                    },
+                    response: {
+                      result: 'test response from 1',
+                    },
+                  },
+                ]),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test',
+                    },
+                    response: {
+                      result: 'test response from 2',
+                    },
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === '0x2448') {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.initializeProvider();
+              expect(controller.state.selectedNetworkClientId).toBe(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+              const networkClient1 = controller.getSelectedNetworkClient();
+              assert(networkClient1, 'Network client is somehow unset');
+              const result1 = await networkClient1.provider.request({
+                method: 'test',
+              });
+              expect(result1).toBe('test response from 1');
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                chainId: '0x2448',
+              });
+
+              expect(controller.state.selectedNetworkClientId).toBe(
+                'BBBB-BBBB-BBBB-BBBB',
+              );
+              const networkClient2 = controller.getSelectedNetworkClient();
+              assert(networkClient2, 'Network client is somehow unset');
+              const result2 = await networkClient1.provider.request({
+                method: 'test',
+              });
+              expect(result2).toBe('test response from 2');
+            },
+          );
+        });
+
+        it('updates selectedNetworkClientId and networkConfigurationsByChainId at the same time', async () => {
+          uuidV4Mock.mockReturnValueOnce('BBBB-BBBB-BBBB-BBBB');
+          const networkConfigurationToUpdate = buildCustomNetworkConfiguration({
+            nativeCurrency: 'TOKEN',
+            rpcEndpoints: [
+              buildCustomRpcEndpoint({
+                name: 'Endpoint 1',
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                url: 'https://rpc.endpoint',
+              }),
+            ],
+          });
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  '0x1337': networkConfigurationToUpdate,
+                },
+              },
+            },
+            async ({ controller, messenger }) => {
+              const fakeProviders = [
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test',
+                    },
+                    response: {
+                      result: 'test response from 1',
+                    },
+                  },
+                ]),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test',
+                    },
+                    response: {
+                      result: 'test response from 2',
+                    },
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === '0x2448') {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.initializeProvider();
+
+              const promiseForStateChanges = waitForStateChanges({
+                messenger,
+                count: 1,
+              });
+
+              await controller.updateNetwork('0x1337', {
+                ...networkConfigurationToUpdate,
+                chainId: '0x2448',
+              });
+              const stateChanges = await promiseForStateChanges;
+              expect(stateChanges).toStrictEqual([
+                [
+                  expect.any(Object),
+                  expect.arrayContaining([
+                    expect.objectContaining({
+                      op: 'replace',
+                      path: ['selectedNetworkClientId'],
+                      value: 'BBBB-BBBB-BBBB-BBBB',
+                    }),
+                    expect.objectContaining({
+                      op: 'remove',
+                      path: ['networkConfigurationsByChainId', '0x1337'],
+                    }),
+                    expect.objectContaining({
+                      op: 'add',
+                      path: ['networkConfigurationsByChainId', '0x2448'],
+                    }),
+                  ]),
+                ],
+              ]);
+            },
+          );
+        });
+      });
+    });
+
+    describe('if nothing is being changed', () => {
+      for (const infuraNetworkType of INFURA_NETWORKS) {
+        const infuraChainId = ChainId[infuraNetworkType];
+
+        describe(`given the ID of the Infura-supported chain ${infuraChainId}`, () => {
+          it('makes no updates to state', async () => {
+            const existingNetworkConfiguration =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: existingNetworkConfiguration,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await controller.updateNetwork(
+                  infuraChainId,
+                  existingNetworkConfiguration,
+                );
+
+                expect(
+                  controller.state.networkConfigurationsByChainId[
+                    infuraChainId
+                  ],
+                ).toStrictEqual(existingNetworkConfiguration);
+              },
+            );
+          });
+
+          it('does not destroy any existing clients for the network', async () => {
+            const existingNetworkConfiguration =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: existingNetworkConfiguration,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                const existingNetworkClient =
+                  controller.getNetworkClientById(infuraNetworkType);
+                const destroySpy = jest.spyOn(existingNetworkClient, 'destroy');
+
+                await controller.updateNetwork(
+                  infuraChainId,
+                  existingNetworkConfiguration,
+                );
+
+                expect(destroySpy).not.toHaveBeenCalled();
+              },
+            );
+          });
+
+          it('does not create any new clients for the network', async () => {
+            const existingNetworkConfiguration =
+              buildInfuraNetworkConfiguration(infuraNetworkType);
+
+            const createAutoManagedNetworkClientSpy = jest.spyOn(
+              createAutoManagedNetworkClientModule,
+              'createAutoManagedNetworkClient',
+            );
+
+            await withController(
+              {
+                state: {
+                  networkConfigurationsByChainId: {
+                    [infuraChainId]: existingNetworkConfiguration,
+                    '0x9999': buildCustomNetworkConfiguration({
+                      chainId: '0x9999',
+                      nativeCurrency: 'TEST-9999',
+                      rpcEndpoints: [
+                        buildCustomRpcEndpoint({
+                          networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                          url: 'https://selected.endpoint',
+                        }),
+                      ],
+                    }),
+                  },
+                  selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                },
+              },
+              async ({ controller }) => {
+                await controller.updateNetwork(
+                  infuraChainId,
+                  existingNetworkConfiguration,
+                );
+
+                // 2 times for existing RPC endpoints, but no more
+                expect(createAutoManagedNetworkClientSpy).toHaveBeenCalledTimes(
+                  2,
+                );
+              },
+            );
+          });
+        });
+      }
+
+      describe('given the ID of a non-Infura-supported chain', () => {
+        it('makes no updates to state', async () => {
+          const existingNetworkConfiguration = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': existingNetworkConfiguration,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              await controller.updateNetwork(
+                '0x1337',
+                existingNetworkConfiguration,
+              );
+
+              expect(
+                controller.state.networkConfigurationsByChainId['0x1337'],
+              ).toStrictEqual(existingNetworkConfiguration);
+            },
+          );
+        });
+
+        it('does not destroy any existing clients for the network', async () => {
+          const existingNetworkConfiguration = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+            rpcEndpoints: [
+              buildCustomRpcEndpoint({
+                networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              }),
+            ],
+          });
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': existingNetworkConfiguration,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              const existingNetworkClient = controller.getNetworkClientById(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+              const destroySpy = jest.spyOn(existingNetworkClient, 'destroy');
+
+              await controller.updateNetwork(
+                '0x1337',
+                existingNetworkConfiguration,
+              );
+
+              expect(destroySpy).not.toHaveBeenCalled();
+            },
+          );
+        });
+
+        it('does not create any new clients for the network', async () => {
+          const existingNetworkConfiguration = buildCustomNetworkConfiguration({
+            chainId: '0x1337',
+          });
+
+          const createAutoManagedNetworkClientSpy = jest.spyOn(
+            createAutoManagedNetworkClientModule,
+            'createAutoManagedNetworkClient',
+          );
+
+          await withController(
+            {
+              state: {
+                networkConfigurationsByChainId: {
+                  '0x1337': existingNetworkConfiguration,
+                  '0x9999': buildCustomNetworkConfiguration({
+                    chainId: '0x9999',
+                    nativeCurrency: 'TEST-9999',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+                        url: 'https://selected.endpoint',
+                      }),
+                    ],
+                  }),
+                },
+                selectedNetworkClientId: 'ZZZZ-ZZZZ-ZZZZ-ZZZZ',
+              },
+            },
+            async ({ controller }) => {
+              await controller.updateNetwork(
+                '0x1337',
+                existingNetworkConfiguration,
+              );
+
+              // 2 times for existing RPC endpoints, but no more
+              expect(createAutoManagedNetworkClientSpy).toHaveBeenCalledTimes(
+                2,
+              );
+            },
+          );
+        });
+      });
+    });
+
+    it('allows calling `getNetworkConfigurationByNetworkClientId` when subscribing to state changes containing new endpoints', async () => {
+      const network = buildCustomNetworkConfiguration({
+        chainId: '0x1' as Hex,
+        name: 'mainnet',
+        nativeCurrency: 'ETH',
+        blockExplorerUrls: [],
+        defaultRpcEndpointIndex: 0,
+        rpcEndpoints: [
+          {
+            failoverUrls: [],
+            type: RpcEndpointType.Custom,
+            url: 'https://test.endpoint/1',
+            networkClientId: 'client1',
+          },
+        ],
+      });
+
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: 'client1',
+            networkConfigurationsByChainId: { '0x1': network },
+          },
+        },
+        async ({ controller, messenger }) => {
+          const stateChangePromise = new Promise<
+            NetworkConfiguration | undefined
+          >((resolve) => {
+            messenger.subscribe('NetworkController:stateChange', (state) => {
+              const { networkClientId } =
+                state.networkConfigurationsByChainId['0x1'].rpcEndpoints[1];
+
+              resolve(
+                controller.getNetworkConfigurationByNetworkClientId(
+                  networkClientId,
+                ),
+              );
+            });
+          });
+
+          // Add a new endpoint
+          await controller.updateNetwork('0x1', {
+            ...network,
+            rpcEndpoints: [
+              ...network.rpcEndpoints,
+              {
+                failoverUrls: [],
+                type: RpcEndpointType.Custom,
+                url: 'https://test.endpoint/2',
+              },
+            ],
+          });
+
+          const networkConfiguration = await stateChangePromise;
+          expect(networkConfiguration).toBeDefined();
+        },
+      );
+    });
+  });
+
+  describe('removeNetwork', () => {
+    it('throws if the given chain ID does not refer to an existing network configuration', async () => {
+      await withController(({ controller }) => {
+        expect(() => controller.removeNetwork('0x1337')).toThrow(
+          new Error("Cannot find network configuration for chain '0x1337'"),
+        );
+      });
+    });
+
+    it('throws if selectedNetworkClientId matches the networkClientId of any RPC endpoint in the existing network configuration', async () => {
+      await withController(
+        {
+          state: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                  }),
+                ],
+              }),
+            },
+          },
+        },
+        ({ controller }) => {
+          expect(() => controller.removeNetwork('0x1337')).toThrow(
+            'Cannot remove the currently selected network',
+          );
+        },
+      );
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraChainId = ChainId[infuraNetworkType];
+
+      describe(`given the ID of the Infura-supported chain ${infuraChainId}`, () => {
+        it('removes the existing network configuration from state', async () => {
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+            },
+            ({ controller }) => {
+              expect(
+                controller.state.networkConfigurationsByChainId,
+              ).toHaveProperty(infuraChainId);
+
+              controller.removeNetwork(infuraChainId);
+
+              expect(
+                controller.state.networkConfigurationsByChainId,
+              ).not.toHaveProperty(infuraChainId);
+            },
+          );
+        });
+
+        it('removes the existing metadata for the network from state', async () => {
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+                networksMetadata: {
+                  [infuraNetworkType]: {
+                    status: NetworkStatus.Available,
+                    EIPS: {},
+                  },
+                },
+              },
+            },
+            ({ controller }) => {
+              controller.removeNetwork(infuraChainId);
+
+              expect(controller.state.networksMetadata).not.toHaveProperty(
+                infuraNetworkType,
+              );
+            },
+          );
+        });
+
+        it('destroys and unregisters the network clients for each of the RPC endpoints defined in the network configuration (even the Infura endpoint)', async () => {
+          const defaultRpcEndpoint = buildInfuraRpcEndpoint(infuraNetworkType);
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                networkConfigurationsByChainId: {
+                  [infuraChainId]: buildInfuraNetworkConfiguration(
+                    infuraNetworkType,
+                    {
+                      rpcEndpoints: [
+                        defaultRpcEndpoint,
+                        buildCustomRpcEndpoint({
+                          name: 'Test Network',
+                          networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                          url: 'https://test.endpoint',
+                        }),
+                      ],
+                    },
+                  ),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      }),
+                    ],
+                  }),
+                },
+              },
+            },
+            ({ controller }) => {
+              const existingNetworkClient1 =
+                controller.getNetworkClientById(infuraNetworkType);
+              const destroySpy1 = jest.spyOn(existingNetworkClient1, 'destroy');
+              const existingNetworkClient2 = controller.getNetworkClientById(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+              const destroySpy2 = jest.spyOn(existingNetworkClient2, 'destroy');
+
+              controller.removeNetwork(infuraChainId);
+
+              expect(destroySpy1).toHaveBeenCalled();
+              expect(destroySpy2).toHaveBeenCalled();
+              const networkClientRegistry =
+                controller.getNetworkClientRegistry();
+              expect(networkClientRegistry).not.toHaveProperty(
+                infuraNetworkType,
+              );
+              expect(networkClientRegistry).not.toHaveProperty(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+            },
+          );
+        });
+      });
+    }
+
+    describe('given the ID of a non-Infura-supported chain', () => {
+      it('removes the existing network configuration from state', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration(),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          ({ controller }) => {
+            expect(
+              controller.state.networkConfigurationsByChainId,
+            ).toHaveProperty('0x1337');
+
+            controller.removeNetwork('0x1337');
+
+            expect(
+              controller.state.networkConfigurationsByChainId,
+            ).not.toHaveProperty('0x1337');
+          },
+        );
+      });
+
+      it('removes the existing metadata for all RPC endpoints in the network from state', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    }),
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'CCCC-CCCC-CCCC-CCCC',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+              networksMetadata: {
+                'AAAA-AAAA-AAAA-AAAA': {
+                  status: NetworkStatus.Available,
+                  EIPS: {},
+                },
+                'BBBB-BBBB-BBBB-BBBB': {
+                  status: NetworkStatus.Available,
+                  EIPS: {},
+                },
+                'CCCC-CCCC-CCCC-CCCC': {
+                  status: NetworkStatus.Available,
+                  EIPS: {},
+                },
+              },
+            },
+          },
+          ({ controller }) => {
+            controller.removeNetwork('0x1337');
+
+            expect(controller.state.networksMetadata).not.toHaveProperty(
+              'AAAA-AAAA-AAAA-AAAA',
+            );
+            expect(controller.state.networksMetadata).not.toHaveProperty(
+              'BBBB-BBBB-BBBB-BBBB',
+            );
+            expect(controller.state.networksMetadata).not.toHaveProperty(
+              'CCCC-CCCC-CCCC-CCCC',
+            );
+          },
+        );
+      });
+
+      it('destroys the network clients for each of the RPC endpoints defined in the network configuration', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      name: 'Test Network 1',
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.endpoint/1',
+                    }),
+                    buildCustomRpcEndpoint({
+                      name: 'Test Network 2',
+                      networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                      url: 'https://test.endpoint/2',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          ({ controller }) => {
+            const existingNetworkClient1 = controller.getNetworkClientById(
+              'AAAA-AAAA-AAAA-AAAA',
+            );
+            const destroySpy1 = jest.spyOn(existingNetworkClient1, 'destroy');
+            const existingNetworkClient2 = controller.getNetworkClientById(
+              'BBBB-BBBB-BBBB-BBBB',
+            );
+            const destroySpy2 = jest.spyOn(existingNetworkClient2, 'destroy');
+
+            controller.removeNetwork('0x1337');
+
+            expect(destroySpy1).toHaveBeenCalled();
+            expect(destroySpy2).toHaveBeenCalled();
+            const networkClientRegistry = controller.getNetworkClientRegistry();
+            expect(networkClientRegistry).not.toHaveProperty(
+              'AAAA-AAAA-AAAA-AAAA',
+            );
+            expect(networkClientRegistry).not.toHaveProperty(
+              'BBBB-BBBB-BBBB-BBBB',
+            );
+          },
+        );
+      });
+
+      it('is callable from the controller messenger', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration(),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          ({ controller, messenger }) => {
+            messenger.call('NetworkController:removeNetwork', '0x1337');
+            expect(
+              controller.state.networkConfigurationsByChainId,
+            ).not.toHaveProperty('0x1337');
+          },
+        );
+      });
+
+      it('emits the NetworkController:networkRemoved event', async () => {
+        const networkConfig = buildCustomNetworkConfiguration();
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: TESTNET.networkType,
+              networkConfigurationsByChainId: {
+                '0x1337': networkConfig,
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          ({ controller, messenger }) => {
+            const networkRemovedListener = jest.fn();
+            messenger.subscribe(
+              'NetworkController:networkRemoved',
+              networkRemovedListener,
+            );
+
+            controller.removeNetwork('0x1337');
+
+            expect(networkRemovedListener).toHaveBeenCalledWith(networkConfig);
+          },
+        );
+      });
+    });
+  });
+
+  describe('rollbackToPreviousProvider', () => {
+    describe('when called not following any network switches', () => {
+      for (const infuraNetworkType of INFURA_NETWORKS) {
+        describe(`when the selected network client represents the Infura network "${infuraNetworkType}"`, () => {
+          refreshNetworkTests({
+            expectedNetworkClientConfiguration:
+              buildInfuraNetworkClientConfiguration(infuraNetworkType),
+            expectedNetworkClientId: infuraNetworkType,
+            initialState: {
+              selectedNetworkClientId: infuraNetworkType,
+            },
+            operation: async (controller) => {
+              await controller.rollbackToPreviousProvider();
+            },
+          });
+        });
+      }
+
+      describe('when the selected network client represents a custom RPC endpoint', () => {
+        refreshNetworkTests({
+          expectedNetworkClientConfiguration:
+            buildCustomNetworkClientConfiguration({
+              rpcUrl: 'https://test.network',
+              chainId: '0x1337',
+              ticker: 'TEST',
+            }),
+          expectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+          initialState: {
+            selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+            networkConfigurationsByChainId: {
+              '0x1337': buildCustomNetworkConfiguration({
+                chainId: '0x1337',
+                nativeCurrency: 'TEST',
+                rpcEndpoints: [
+                  buildCustomRpcEndpoint({
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://test.network',
+                  }),
+                ],
+              }),
+            },
+          },
+          operation: async (controller) => {
+            await controller.rollbackToPreviousProvider();
+          },
+        });
+      });
+    });
+
+    for (const infuraNetworkType of INFURA_NETWORKS) {
+      const infuraChainId = ChainId[infuraNetworkType];
+
+      describe(`when called following a switch away from the Infura network "${infuraNetworkType}"`, () => {
+        it('emits networkWillChange with state payload', async () => {
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+            },
+            async ({ controller, messenger }) => {
+              const fakeProvider = buildFakeProvider();
+              const fakeNetworkClient = buildFakeClient(fakeProvider);
+              mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+
+              const networkWillChange = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:networkWillChange',
+                filter: ([networkState]) => networkState === controller.state,
+                operation: () => {
+                  // Intentionally not awaited because we're capturing an event
+                  // emitted partway through the operation
+                  // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                  controller.rollbackToPreviousProvider();
+                },
+              });
+
+              await expect(networkWillChange).toBeFulfilled();
+            },
+          );
+        });
+
+        it('emits networkDidChange with state payload', async () => {
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+            },
+            async ({ controller, messenger }) => {
+              const fakeProvider = buildFakeProvider();
+              const fakeNetworkClient = buildFakeClient(fakeProvider);
+              mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+
+              const networkDidChange = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:networkDidChange',
+                filter: ([networkState]) => networkState === controller.state,
+                operation: () => {
+                  // Intentionally not awaited because we're capturing an event
+                  // emitted partway through the operation
+                  // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+                  // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                  controller.rollbackToPreviousProvider();
+                },
+              });
+
+              await expect(networkDidChange).toBeFulfilled();
+            },
+          );
+        });
+
+        it('sets selectedNetworkClientId in state to the previous version', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller }) => {
+              const fakeProviders = [buildFakeProvider(), buildFakeProvider()];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+              expect(controller.state.selectedNetworkClientId).toBe(
+                'AAAA-AAAA-AAAA-AAAA',
+              );
+
+              await controller.rollbackToPreviousProvider();
+
+              expect(controller.state.selectedNetworkClientId).toBe(
+                infuraNetworkType,
+              );
+            },
+          );
+        });
+
+        it('resets the network status to "unknown" before updating the provider', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller, messenger }) => {
+              const fakeProviders = [
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                  },
+                ]),
+                buildFakeProvider(),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+              expect(
+                controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA'].status,
+              ).toBe('available');
+
+              await waitForStateChanges({
+                messenger,
+                propertyPath: ['networksMetadata', infuraNetworkType, 'status'],
+                // We only care about the first state change, because it
+                // happens before networkDidChange
+                count: 1,
+                operation: () => {
+                  // Intentionally not awaited because we want to check state
+                  // while this operation is in-progress
+                  // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                  controller.rollbackToPreviousProvider();
+                },
+                beforeResolving: () => {
+                  expect(
+                    controller.state.networksMetadata[infuraNetworkType].status,
+                  ).toBe('unknown');
+                },
+              });
+            },
+          );
+        });
+
+        it(`initializes a provider pointed to the "${infuraNetworkType}" Infura network`, async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller }) => {
+              const fakeProviders = [
+                buildFakeProvider(),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'test',
+                    },
+                    response: {
+                      result: 'test response',
+                    },
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+
+              await controller.rollbackToPreviousProvider();
+
+              const networkClient = controller.getSelectedNetworkClient();
+              assert(networkClient, 'Network client is somehow unset');
+              const result = await networkClient.provider.request({
+                id: '1',
+                jsonrpc: '2.0',
+                method: 'test',
+              });
+              expect(result).toBe('test response');
+            },
+          );
+        });
+
+        it('replaces the provider object underlying the provider proxy without creating a new instance of the proxy itself', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller }) => {
+              const fakeProviders = [buildFakeProvider(), buildFakeProvider()];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+              const networkClientBefore = controller.getSelectedNetworkClient();
+              assert(networkClientBefore, 'Network client is somehow unset');
+
+              await controller.rollbackToPreviousProvider();
+
+              const networkClientAfter = controller.getSelectedNetworkClient();
+              assert(networkClientAfter, 'Network client is somehow unset');
+              expect(networkClientBefore.provider).toBe(
+                networkClientAfter.provider,
+              );
+            },
+          );
+        });
+
+        it('emits infuraIsBlocked or infuraIsUnblocked, depending on whether Infura is blocking requests for the previous network', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller, messenger }) => {
+              const fakeProviders = [
+                buildFakeProvider(),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+              const promiseForNoInfuraIsUnblockedEvents =
+                waitForPublishedEvents({
+                  messenger,
+                  eventType: 'NetworkController:infuraIsUnblocked',
+                  count: 0,
+                });
+              const promiseForInfuraIsBlocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsBlocked',
+              });
+
+              await controller.rollbackToPreviousProvider();
+
+              await expect(promiseForNoInfuraIsUnblockedEvents).toBeFulfilled();
+              await expect(promiseForInfuraIsBlocked).toBeFulfilled();
+            },
+          );
+        });
+
+        it('checks the status of the previous network again and updates state accordingly', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller, messenger }) => {
+              const fakeProviders = [
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    error: rpcErrors.methodNotFound(),
+                  },
+                ]),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+              expect(
+                controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA'].status,
+              ).toBe('unavailable');
+
+              await waitForStateChanges({
+                messenger,
+                propertyPath: ['networksMetadata', infuraNetworkType, 'status'],
+                operation: async () => {
+                  await controller.rollbackToPreviousProvider();
+                },
+              });
+              expect(
+                controller.state.networksMetadata[infuraNetworkType].status,
+              ).toBe('available');
+            },
+          );
+        });
+
+        it('checks whether the previous network supports EIP-1559 again and updates state accordingly', async () => {
+          const infuraProjectId = 'some-infura-project-id';
+
+          await withController(
+            {
+              state: {
+                selectedNetworkClientId: infuraNetworkType,
+                networkConfigurationsByChainId: {
+                  [infuraChainId]:
+                    buildInfuraNetworkConfiguration(infuraNetworkType),
+                  '0x1337': buildCustomNetworkConfiguration({
+                    chainId: '0x1337',
+                    rpcEndpoints: [
+                      buildCustomRpcEndpoint({
+                        networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      }),
+                    ],
+                  }),
+                },
+              },
+              infuraProjectId,
+            },
+            async ({ controller, messenger }) => {
+              const fakeProviders = [
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: {
+                      result: PRE_1559_BLOCK,
+                    },
+                  },
+                ]),
+                buildFakeProvider([
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                    },
+                    response: {
+                      result: POST_1559_BLOCK,
+                    },
+                  },
+                ]),
+              ];
+              const fakeNetworkClients = [
+                buildFakeClient(fakeProviders[0]),
+                buildFakeClient(fakeProviders[1]),
+              ];
+              createNetworkClientMock.mockImplementation(
+                ({ configuration }) => {
+                  if (configuration.chainId === '0x1337') {
+                    return fakeNetworkClients[0];
+                  } else if (configuration.chainId === infuraChainId) {
+                    return fakeNetworkClients[1];
+                  }
+                  throw new Error(
+                    `Unknown network client configuration ${JSON.stringify(
+                      configuration,
+                    )}`,
+                  );
+                },
+              );
+              await controller.setActiveNetwork('AAAA-AAAA-AAAA-AAAA');
+              expect(
+                controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                  .EIPS[1559],
+              ).toBe(false);
+
+              await waitForStateChanges({
+                messenger,
+                propertyPath: ['networksMetadata', infuraNetworkType, 'EIPS'],
+                count: 2,
+                operation: async () => {
+                  await controller.rollbackToPreviousProvider();
+                },
+              });
+              expect(
+                controller.state.networksMetadata[infuraNetworkType].EIPS[1559],
+              ).toBe(true);
+            },
+          );
+        });
+      });
+    }
+
+    describe('when called following a switch away from a custom RPC endpoint', () => {
+      it('emits networkWillChange with state payload', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TEST',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          async ({ controller, messenger }) => {
+            const fakeProvider = buildFakeProvider();
+            const fakeNetworkClient = buildFakeClient(fakeProvider);
+            mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+            await controller.setActiveNetwork(TESTNET.networkType);
+
+            const networkWillChange = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:networkWillChange',
+              filter: ([networkState]) => networkState === controller.state,
+              operation: () => {
+                // Intentionally not awaited because we're capturing an event
+                // emitted partway through the operation
+                // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                controller.rollbackToPreviousProvider();
+              },
+            });
+
+            await expect(networkWillChange).toBeFulfilled();
+          },
+        );
+      });
+
+      it('emits networkDidChange with state payload', async () => {
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  nativeCurrency: 'TEST',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                      url: 'https://test.network',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+          },
+          async ({ controller, messenger }) => {
+            const fakeProvider = buildFakeProvider();
+            const fakeNetworkClient = buildFakeClient(fakeProvider);
+            mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+            await controller.setActiveNetwork(TESTNET.networkType);
+
+            const networkDidChange = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:networkDidChange',
+              filter: ([networkState]) => networkState === controller.state,
+              operation: () => {
+                // Intentionally not awaited because we're capturing an event
+                // emitted partway through the operation
+                // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                controller.rollbackToPreviousProvider();
+              },
+            });
+
+            await expect(networkDidChange).toBeFulfilled();
+          },
+        );
+      });
+
+      it('sets selectedNetworkClientId to the previous version', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            const fakeProviders = [buildFakeProvider(), buildFakeProvider()];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+            expect(controller.state.selectedNetworkClientId).toBe(
+              TESTNET.networkType,
+            );
+
+            await controller.rollbackToPreviousProvider();
+            expect(controller.state.selectedNetworkClientId).toBe(
+              'AAAA-AAAA-AAAA-AAAA',
+            );
+          },
+        );
+      });
+
+      it('resets the network state to "unknown" before updating the provider', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller, messenger }) => {
+            const fakeProviders = [
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                  },
+                  response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                },
+              ]),
+              buildFakeProvider(),
+            ];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+            expect(
+              controller.state.networksMetadata[
+                controller.state.selectedNetworkClientId
+              ].status,
+            ).toBe('available');
+
+            await waitForStateChanges({
+              messenger,
+              propertyPath: [
+                'networksMetadata',
+                'AAAA-AAAA-AAAA-AAAA',
+                'status',
+              ],
+              // We only care about the first state change, because it
+              // happens before networkDidChange
+              count: 1,
+              operation: () => {
+                // Intentionally not awaited because we want to check state
+                // while this operation is in-progress
+                // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                controller.rollbackToPreviousProvider();
+              },
+              beforeResolving: () => {
+                expect(
+                  controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                    .status,
+                ).toBe('unknown');
+              },
+            });
+          },
+        );
+      });
+
+      it('initializes a provider pointed to the given RPC URL', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            const fakeProviders = [
+              buildFakeProvider(),
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'test_method',
+                  },
+                  response: {
+                    result: 'test response',
+                  },
+                },
+              ]),
+            ];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+
+            await controller.rollbackToPreviousProvider();
+
+            const networkClient = controller.getSelectedNetworkClient();
+            assert(networkClient, 'Network client is somehow unset');
+            const result = await networkClient.provider.request({
+              id: '1',
+              jsonrpc: '2.0',
+              method: 'test_method',
+            });
+            expect(result).toBe('test response');
+          },
+        );
+      });
+
+      it('replaces the provider object underlying the provider proxy without creating a new instance of the proxy itself', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            const fakeProviders = [buildFakeProvider(), buildFakeProvider()];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+            const networkClientBefore = controller.getSelectedNetworkClient();
+            assert(networkClientBefore, 'Network client is somehow unset');
+
+            await controller.rollbackToPreviousProvider();
+
+            const networkClientAfter = controller.getSelectedNetworkClient();
+            assert(networkClientAfter, 'Network client is somehow unset');
+            expect(networkClientBefore.provider).toBe(
+              networkClientAfter.provider,
+            );
+          },
+        );
+      });
+
+      it('emits infuraIsUnblocked', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller, messenger }) => {
+            const fakeProviders = [buildFakeProvider(), buildFakeProvider()];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+
+            const promiseForInfuraIsUnblocked = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:infuraIsUnblocked',
+              operation: async () => {
+                await controller.rollbackToPreviousProvider();
+              },
+            });
+
+            await expect(promiseForInfuraIsUnblocked).toBeFulfilled();
+          },
+        );
+      });
+
+      it('checks the status of the previous network again and updates state accordingly', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            const fakeProviders = [
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                  },
+                  error: rpcErrors.methodNotFound(),
+                },
+              ]),
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                  },
+                  response: SUCCESSFUL_ETH_GET_BLOCK_BY_NUMBER_RESPONSE,
+                },
+              ]),
+            ];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+            expect(
+              controller.state.networksMetadata[TESTNET.networkType].status,
+            ).toBe('unavailable');
+
+            await controller.rollbackToPreviousProvider();
+            expect(
+              controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA'].status,
+            ).toBe('available');
+          },
+        );
+      });
+
+      it('checks whether the previous network supports EIP-1559 again and updates state accordingly', async () => {
+        const infuraProjectId = 'some-infura-project-id';
+
+        await withController(
+          {
+            state: {
+              selectedNetworkClientId: 'AAAA-AAAA-AAAA-AAAA',
+              networkConfigurationsByChainId: {
+                '0x1337': buildCustomNetworkConfiguration({
+                  chainId: '0x1337',
+                  rpcEndpoints: [
+                    buildCustomRpcEndpoint({
+                      networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    }),
+                  ],
+                }),
+                [TESTNET.chainId]: buildInfuraNetworkConfiguration(
+                  TESTNET.networkType,
+                ),
+              },
+            },
+            infuraProjectId,
+          },
+          async ({ controller }) => {
+            const fakeProviders = [
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                  },
+                  response: {
+                    result: PRE_1559_BLOCK,
+                  },
+                },
+              ]),
+              buildFakeProvider([
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                  },
+                  response: {
+                    result: POST_1559_BLOCK,
+                  },
+                },
+              ]),
+            ];
+            const fakeNetworkClients = [
+              buildFakeClient(fakeProviders[0]),
+              buildFakeClient(fakeProviders[1]),
+            ];
+            createNetworkClientMock.mockImplementation(({ configuration }) => {
+              if (configuration.chainId === TESTNET.chainId) {
+                return fakeNetworkClients[0];
+              } else if (configuration.chainId === '0x1337') {
+                return fakeNetworkClients[1];
+              }
+              throw new Error(
+                `Unknown network client configuration ${JSON.stringify(
+                  configuration,
+                )}`,
+              );
+            });
+            await controller.setActiveNetwork(TESTNET.networkType);
+            expect(
+              controller.state.networksMetadata[TESTNET.networkType].EIPS[1559],
+            ).toBe(false);
+
+            await controller.rollbackToPreviousProvider();
+            expect(
+              controller.state.networksMetadata['AAAA-AAAA-AAAA-AAAA']
+                .EIPS[1559],
+            ).toBe(true);
+          },
+        );
+      });
+    });
+  });
+
+  describe('loadBackup', () => {
+    it('merges the network configurations from the given backup into state', async () => {
+      await withController(
+        {
+          state: buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+            networkConfigurationsByChainId: {
+              '0x1337': {
+                blockExplorerUrls: [],
+                chainId: '0x1337' as const,
+                defaultRpcEndpointIndex: 0,
+                name: 'Test Network 1',
+                nativeCurrency: 'TOKEN1',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: [],
+                    name: 'Test Endpoint',
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://test.network/1',
+                    type: RpcEndpointType.Custom,
+                  },
+                ],
+              },
+            },
+          }),
+        },
+        ({ controller }) => {
+          controller.loadBackup({
+            networkConfigurationsByChainId: {
+              '0x2448': {
+                blockExplorerUrls: [],
+                chainId: '0x2448' as const,
+                defaultRpcEndpointIndex: 0,
+                name: 'Test Network 2',
+                nativeCurrency: 'TOKEN2',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: [],
+                    name: 'Test Endpoint',
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    url: 'https://test.network/2',
+                    type: RpcEndpointType.Custom,
+                  },
+                ],
+              },
+            },
+          });
+
+          expect(controller.state.networkConfigurationsByChainId).toStrictEqual(
+            {
+              '0x1337': {
+                blockExplorerUrls: [],
+                chainId: '0x1337' as const,
+                defaultRpcEndpointIndex: 0,
+                name: 'Test Network 1',
+                nativeCurrency: 'TOKEN1',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: [],
+                    name: 'Test Endpoint',
+                    networkClientId: 'AAAA-AAAA-AAAA-AAAA',
+                    url: 'https://test.network/1',
+                    type: RpcEndpointType.Custom,
+                  },
+                ],
+              },
+              '0x2448': {
+                blockExplorerUrls: [],
+                chainId: '0x2448' as const,
+                defaultRpcEndpointIndex: 0,
+                name: 'Test Network 2',
+                nativeCurrency: 'TOKEN2',
+                rpcEndpoints: [
+                  {
+                    failoverUrls: [],
+                    name: 'Test Endpoint',
+                    networkClientId: 'BBBB-BBBB-BBBB-BBBB',
+                    url: 'https://test.network/2',
+                    type: RpcEndpointType.Custom,
+                  },
+                ],
+              },
+            },
+          );
+        },
+      );
+    });
+  });
+
+  describe('getSelectedNetworkClient', () => {
+    it('returns the selected network provider and blockTracker proxy when initialized', async () => {
+      await withController(async ({ controller }) => {
+        const fakeProvider = buildFakeProvider();
+        const fakeNetworkClient = buildFakeClient(fakeProvider);
+        mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+        await controller.initializeProvider();
+        const defaultNetworkClient = controller.getProviderAndBlockTracker();
+
+        const selectedNetworkClient = controller.getSelectedNetworkClient();
+        expect(defaultNetworkClient.provider).toBe(
+          selectedNetworkClient?.provider,
+        );
+        expect(defaultNetworkClient.blockTracker).toBe(
+          selectedNetworkClient?.blockTracker,
+        );
+      });
+    });
+
+    it('returns undefined when the selected network provider and blockTracker proxy are not initialized', async () => {
+      await withController(async ({ controller }) => {
+        const selectedNetworkClient = controller.getSelectedNetworkClient();
+        expect(selectedNetworkClient).toBeUndefined();
+      });
+    });
+  });
+
+  describe('metadata', () => {
+    it('includes expected state in debug snapshots', async () => {
+      await withController(({ controller }) => {
+        expect(
+          deriveStateFromMetadata(
+            controller.state,
+            controller.metadata,
+            'includeInDebugSnapshot',
+          ),
+        ).toMatchInlineSnapshot(`Object {}`);
+      });
+    });
+
+    it('includes expected state in state logs', async () => {
+      await withController(({ controller }) => {
+        expect(
+          deriveStateFromMetadata(
+            controller.state,
+            controller.metadata,
+            'includeInStateLogs',
+          ),
+        ).toMatchInlineSnapshot(`
+          Object {
+            "networkConfigurationsByChainId": Object {
+              "0x1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Ethereum Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "mainnet",
+                    "type": "infura",
+                    "url": "https://mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x2105": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x2105",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Base Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "base-mainnet",
+                    "type": "infura",
+                    "url": "https://base-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x38": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x38",
+                "defaultRpcEndpointIndex": 0,
+                "name": "BSC Mainnet",
+                "nativeCurrency": "BNB",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "bsc-mainnet",
+                    "type": "infura",
+                    "url": "https://bsc-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x531": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x531",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sei Mainnet",
+                "nativeCurrency": "SEI",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sei-mainnet",
+                    "type": "infura",
+                    "url": "https://sei-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x89": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x89",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Polygon Mainnet",
+                "nativeCurrency": "POL",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "polygon-mainnet",
+                    "type": "infura",
+                    "url": "https://polygon-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Optimism Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "optimism-mainnet",
+                    "type": "infura",
+                    "url": "https://optimism-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa4b1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa4b1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Arbitrum One",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "arbitrum-mainnet",
+                    "type": "infura",
+                    "url": "https://arbitrum-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xaa36a7": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xaa36a7",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sepolia",
+                "nativeCurrency": "SepoliaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sepolia",
+                    "type": "infura",
+                    "url": "https://sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe705": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe705",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea Sepolia",
+                "nativeCurrency": "LineaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-sepolia",
+                    "type": "infura",
+                    "url": "https://linea-sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe708": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe708",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-mainnet",
+                    "type": "infura",
+                    "url": "https://linea-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+            },
+            "networksMetadata": Object {},
+            "selectedNetworkClientId": "mainnet",
+          }
+        `);
+      });
+    });
+
+    it('persists expected state', async () => {
+      await withController(({ controller }) => {
+        expect(
+          deriveStateFromMetadata(
+            controller.state,
+            controller.metadata,
+            'persist',
+          ),
+        ).toMatchInlineSnapshot(`
+          Object {
+            "networkConfigurationsByChainId": Object {
+              "0x1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Ethereum Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "mainnet",
+                    "type": "infura",
+                    "url": "https://mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x2105": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x2105",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Base Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "base-mainnet",
+                    "type": "infura",
+                    "url": "https://base-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x38": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x38",
+                "defaultRpcEndpointIndex": 0,
+                "name": "BSC Mainnet",
+                "nativeCurrency": "BNB",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "bsc-mainnet",
+                    "type": "infura",
+                    "url": "https://bsc-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x531": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x531",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sei Mainnet",
+                "nativeCurrency": "SEI",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sei-mainnet",
+                    "type": "infura",
+                    "url": "https://sei-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x89": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x89",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Polygon Mainnet",
+                "nativeCurrency": "POL",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "polygon-mainnet",
+                    "type": "infura",
+                    "url": "https://polygon-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Optimism Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "optimism-mainnet",
+                    "type": "infura",
+                    "url": "https://optimism-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa4b1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa4b1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Arbitrum One",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "arbitrum-mainnet",
+                    "type": "infura",
+                    "url": "https://arbitrum-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xaa36a7": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xaa36a7",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sepolia",
+                "nativeCurrency": "SepoliaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sepolia",
+                    "type": "infura",
+                    "url": "https://sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe705": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe705",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea Sepolia",
+                "nativeCurrency": "LineaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-sepolia",
+                    "type": "infura",
+                    "url": "https://linea-sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe708": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe708",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-mainnet",
+                    "type": "infura",
+                    "url": "https://linea-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+            },
+            "networksMetadata": Object {},
+            "selectedNetworkClientId": "mainnet",
+          }
+        `);
+      });
+    });
+
+    it('exposes expected state to UI', async () => {
+      await withController(({ controller }) => {
+        expect(
+          deriveStateFromMetadata(
+            controller.state,
+            controller.metadata,
+            'usedInUi',
+          ),
+        ).toMatchInlineSnapshot(`
+          Object {
+            "networkConfigurationsByChainId": Object {
+              "0x1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Ethereum Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "mainnet",
+                    "type": "infura",
+                    "url": "https://mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x2105": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x2105",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Base Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "base-mainnet",
+                    "type": "infura",
+                    "url": "https://base-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x38": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x38",
+                "defaultRpcEndpointIndex": 0,
+                "name": "BSC Mainnet",
+                "nativeCurrency": "BNB",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "bsc-mainnet",
+                    "type": "infura",
+                    "url": "https://bsc-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x531": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x531",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sei Mainnet",
+                "nativeCurrency": "SEI",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sei-mainnet",
+                    "type": "infura",
+                    "url": "https://sei-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0x89": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0x89",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Polygon Mainnet",
+                "nativeCurrency": "POL",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "polygon-mainnet",
+                    "type": "infura",
+                    "url": "https://polygon-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Optimism Mainnet",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "optimism-mainnet",
+                    "type": "infura",
+                    "url": "https://optimism-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xa4b1": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xa4b1",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Arbitrum One",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "arbitrum-mainnet",
+                    "type": "infura",
+                    "url": "https://arbitrum-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xaa36a7": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xaa36a7",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Sepolia",
+                "nativeCurrency": "SepoliaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "sepolia",
+                    "type": "infura",
+                    "url": "https://sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe705": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe705",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea Sepolia",
+                "nativeCurrency": "LineaETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-sepolia",
+                    "type": "infura",
+                    "url": "https://linea-sepolia.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+              "0xe708": Object {
+                "blockExplorerUrls": Array [],
+                "chainId": "0xe708",
+                "defaultRpcEndpointIndex": 0,
+                "name": "Linea",
+                "nativeCurrency": "ETH",
+                "rpcEndpoints": Array [
+                  Object {
+                    "failoverUrls": Array [],
+                    "networkClientId": "linea-mainnet",
+                    "type": "infura",
+                    "url": "https://linea-mainnet.infura.io/v3/{infuraProjectId}",
+                  },
+                ],
+              },
+            },
+            "networksMetadata": Object {},
+            "selectedNetworkClientId": "mainnet",
+          }
+        `);
+      });
+    });
+  });
+});
+
+describe('getNetworkConfigurations', () => {
+  it('returns network configurations available in the state', () => {
+    const state = getDefaultNetworkControllerState();
+
+    expect(getNetworkConfigurations(state)).toStrictEqual(
+      Object.values(state.networkConfigurationsByChainId),
+    );
+  });
+});
+
+describe('selectNetworkConfigurations', () => {
+  it('returns network configurations available in the state', () => {
+    const state = getDefaultNetworkControllerState();
+
+    expect(selectNetworkConfigurations(state)).toStrictEqual(
+      Object.values(state.networkConfigurationsByChainId),
+    );
+  });
+
+  it('is memoized', () => {
+    const state = getDefaultNetworkControllerState();
+
+    expect(selectNetworkConfigurations(state)).toBe(
+      selectNetworkConfigurations(state),
+    );
+  });
+});
+
+describe('getAvailableNetworkClientIds', () => {
+  it('returns network client ids available in the state', () => {
+    const networkConfigurations = [
+      {
+        rpcEndpoints: [
+          {
+            networkClientId: 'foo',
+          },
+        ],
+      },
+      {
+        rpcEndpoints: [
+          {
+            networkClientId: 'bar',
+          },
+        ],
+      },
+    ] as NetworkConfiguration[];
+
+    expect(getAvailableNetworkClientIds(networkConfigurations)).toStrictEqual([
+      'foo',
+      'bar',
+    ]);
+  });
+});
+
+describe('selectAvailableNetworkClientIds', () => {
+  it('selects all network client ids available in the state', () => {
+    const state = {
+      ...getDefaultNetworkControllerState(),
+      networkConfigurationsByChainId: {
+        '0x12': {
+          rpcEndpoints: [
+            {
+              networkClientId: 'foo',
+            },
+          ],
+        } as NetworkConfiguration,
+        '0x34': {
+          rpcEndpoints: [
+            {
+              networkClientId: 'bar',
+            },
+          ],
+        } as NetworkConfiguration,
+      },
+    };
+
+    expect(selectAvailableNetworkClientIds(state)).toStrictEqual([
+      'foo',
+      'bar',
+    ]);
+  });
+});
+
+/**
+ * Creates a mocked version of `createNetworkClient` where multiple mock
+ * invocations can be specified. A default implementation is provided so that if
+ * none of the actual invocations of the function match the mock invocations
+ * then an error will be thrown.
+ *
+ * @returns The mocked version of `createNetworkClient`.
+ */
+function mockCreateNetworkClient(): WhenMock<NetworkClient> {
+  return when(createNetworkClientMock).mockImplementation((options) => {
+    const inspectedOptions = inspect(options, { depth: null, compact: true });
+    const lines = [
+      `No fake network client was specified for ${inspectedOptions}.`,
+      'Make sure to mock this invocation of `createNetworkClient`.',
+    ];
+    if ('infuraProjectId' in options) {
+      lines.push(
+        '(You might have forgotten to pass an `infuraProjectId` to `withController`.)',
+      );
+    }
+    throw new Error(lines.join('\n'));
+  });
+}
+
+/**
+ * Test an operation that performs a `#refreshNetwork` call with the given
+ * provider configuration. All effects of the `#refreshNetwork` call should be
+ * covered by these tests.
+ *
+ * @param args - Arguments.
+ * @param args.expectedNetworkClientConfiguration - The network client
+ * configuration that the operation is expected to set.
+ * @param args.expectedNetworkClientId - The ID of the network client that the
+ * operation is expected to involve.
+ * @param args.initialState - The initial state of the network controller.
+ * @param args.operation - The operation to test.
+ */
+function refreshNetworkTests({
+  expectedNetworkClientConfiguration,
+  expectedNetworkClientId,
+  initialState,
+  operation,
+}: {
+  expectedNetworkClientConfiguration: NetworkClientConfiguration;
+  expectedNetworkClientId: NetworkClientId;
+  initialState?: Partial<NetworkState>;
+  operation: (controller: NetworkController) => Promise<void>;
+}): void {
+  // eslint-disable-next-line jest/require-top-level-describe
+  it('emits networkWillChange with state payload', async () => {
+    await withController(
+      {
+        state: initialState,
+      },
+      async ({ controller, messenger }) => {
+        const fakeProvider = buildFakeProvider();
+        const fakeNetworkClient = buildFakeClient(fakeProvider);
+        mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+
+        const networkWillChange = waitForPublishedEvents({
+          messenger,
+          eventType: 'NetworkController:networkWillChange',
+          filter: ([networkState]) => networkState === controller.state,
+          operation: () => {
+            // Intentionally not awaited because we're capturing an event
+            // emitted partway through the operation
+            // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+            // eslint-disable-next-line @typescript-eslint/no-floating-promises
+            operation(controller);
+          },
+        });
+
+        await expect(networkWillChange).toBeFulfilled();
+      },
+    );
+  });
+
+  // eslint-disable-next-line jest/require-top-level-describe
+  it('emits networkDidChange with state payload', async () => {
+    await withController(
+      {
+        state: initialState,
+      },
+      async ({ controller, messenger }) => {
+        const fakeProvider = buildFakeProvider();
+        const fakeNetworkClient = buildFakeClient(fakeProvider);
+        mockCreateNetworkClient().mockReturnValue(fakeNetworkClient);
+
+        const networkDidChange = waitForPublishedEvents({
+          messenger,
+          eventType: 'NetworkController:networkDidChange',
+          filter: ([networkState]) => networkState === controller.state,
+          operation: () => {
+            // Intentionally not awaited because we're capturing an event
+            // emitted partway through the operation
+            // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+            // eslint-disable-next-line @typescript-eslint/no-floating-promises
+            operation(controller);
+          },
+        });
+
+        await expect(networkDidChange).toBeFulfilled();
+      },
+    );
+  });
+
+  if (expectedNetworkClientConfiguration.type === NetworkClientType.Custom) {
+    // eslint-disable-next-line jest/require-top-level-describe
+    it('sets the provider to a custom RPC provider initialized with the RPC target and chain ID', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          const fakeProvider = buildFakeProvider([
+            {
+              request: {
+                method: 'eth_chainId',
+              },
+              response: {
+                result: toHex(111),
+              },
+            },
+          ]);
+          const fakeNetworkClient = buildFakeClient(fakeProvider);
+          createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+
+          await operation(controller);
+
+          expect(createNetworkClientMock).toHaveBeenCalledWith(
+            expect.objectContaining({
+              configuration: expectedNetworkClientConfiguration,
+            }),
+          );
+          const { provider } = controller.getProviderAndBlockTracker();
+          assert(provider);
+          const chainIdResult = await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'eth_chainId',
+            params: [],
+          });
+          expect(chainIdResult).toBe(toHex(111));
+        },
+      );
+    });
+  } else {
+    // eslint-disable-next-line jest/require-top-level-describe
+    it(`sets the provider to an Infura provider pointed to ${expectedNetworkClientConfiguration.network}`, async () => {
+      await withController(
+        {
+          infuraProjectId: 'infura-project-id',
+          state: initialState,
+        },
+        async ({ controller }) => {
+          const fakeProvider = buildFakeProvider([
+            {
+              request: {
+                method: 'eth_chainId',
+              },
+              response: {
+                result: toHex(1337),
+              },
+            },
+          ]);
+          const fakeNetworkClient = buildFakeClient(fakeProvider);
+          createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+
+          await operation(controller);
+
+          expect(createNetworkClientMock).toHaveBeenCalledWith(
+            expect.objectContaining({
+              configuration: {
+                ...expectedNetworkClientConfiguration,
+                infuraProjectId: 'infura-project-id',
+              },
+            }),
+          );
+          const { provider } = controller.getProviderAndBlockTracker();
+          assert(provider);
+          const chainIdResult = await provider.request({
+            id: 1,
+            jsonrpc: '2.0',
+            method: 'eth_chainId',
+            params: [],
+          });
+          expect(chainIdResult).toBe(toHex(1337));
+        },
+      );
+    });
+  }
+
+  // eslint-disable-next-line jest/require-top-level-describe
+  it('replaces the provider object underlying the provider proxy without creating a new instance of the proxy itself', async () => {
+    await withController(
+      {
+        infuraProjectId: 'infura-project-id',
+        state: initialState,
+      },
+      async ({ controller }) => {
+        const fakeProviders = [buildFakeProvider(), buildFakeProvider()];
+        const fakeNetworkClients = [
+          buildFakeClient(fakeProviders[0]),
+          buildFakeClient(fakeProviders[1]),
+        ];
+        const { selectedNetworkClientId } = controller.state;
+        let initializationNetworkClientConfiguration:
+          | Parameters<typeof createNetworkClient>[0]['configuration']
+          | undefined;
+
+        for (const matchingNetworkConfiguration of Object.values(
+          controller.state.networkConfigurationsByChainId,
+        )) {
+          const matchingRpcEndpoint =
+            matchingNetworkConfiguration.rpcEndpoints.find(
+              (rpcEndpoint) =>
+                rpcEndpoint.networkClientId === selectedNetworkClientId,
+            );
+          if (matchingRpcEndpoint) {
+            if (isInfuraNetworkType(selectedNetworkClientId)) {
+              initializationNetworkClientConfiguration = {
+                chainId: ChainId[selectedNetworkClientId],
+                failoverRpcUrls: [],
+                infuraProjectId: 'infura-project-id',
+                network: selectedNetworkClientId,
+                ticker: NetworksTicker[selectedNetworkClientId],
+                type: NetworkClientType.Infura,
+              };
+            } else {
+              initializationNetworkClientConfiguration = {
+                chainId: matchingNetworkConfiguration.chainId,
+                failoverRpcUrls: [],
+                rpcUrl: matchingRpcEndpoint.url,
+                ticker: matchingNetworkConfiguration.nativeCurrency,
+                type: NetworkClientType.Custom,
+              };
+            }
+          }
+        }
+
+        if (initializationNetworkClientConfiguration === undefined) {
+          throw new Error(
+            'Could not set initializationNetworkClientConfiguration',
+          );
+        }
+
+        const operationNetworkClientConfiguration: Parameters<
+          typeof createNetworkClient
+        >[0]['configuration'] =
+          expectedNetworkClientConfiguration.type === NetworkClientType.Custom
+            ? expectedNetworkClientConfiguration
+            : {
+                ...expectedNetworkClientConfiguration,
+                infuraProjectId: 'infura-project-id',
+              };
+        createNetworkClientMock.mockImplementation(({ configuration }) => {
+          if (
+            isDeepStrictEqual(
+              configuration,
+              initializationNetworkClientConfiguration,
+            )
+          ) {
+            return fakeNetworkClients[0];
+          } else if (
+            isDeepStrictEqual(
+              configuration,
+              operationNetworkClientConfiguration,
+            )
+          ) {
+            return fakeNetworkClients[1];
+          }
+          throw new Error(
+            `Unknown network client configuration ${JSON.stringify(
+              configuration,
+            )}`,
+          );
+        });
+        await controller.initializeProvider();
+        const { provider: providerBefore } =
+          controller.getProviderAndBlockTracker();
+
+        await operation(controller);
+
+        const { provider: providerAfter } =
+          controller.getProviderAndBlockTracker();
+        expect(providerBefore).toBe(providerAfter);
+      },
+    );
+  });
+
+  lookupNetworkTests({
+    expectedNetworkClientType: expectedNetworkClientConfiguration.type,
+    expectedNetworkClientId,
+    initialState,
+    operation,
+  });
+}
+
+/**
+ * Test an operation that performs a `lookupNetwork` call with the given
+ * provider configuration. All effects of the `lookupNetwork` call should be
+ * covered by these tests.
+ *
+ * @param args - Arguments.
+ * @param args.expectedNetworkClientType - The type of the network client
+ * that the operation is expected to involve.
+ * @param args.expectedNetworkClientId - The ID of the network client that the
+ * operation is expected to involve.
+ * @param args.initialState - The initial state of the network controller.
+ * @param args.operation - The operation to test.
+ * @param args.shouldTestInfuraMessengerEvents - Whether to test whether
+ * Infura-related messenger events are published. This is useful when the
+ * operation involves the currently selected network.
+ */
+function lookupNetworkTests({
+  expectedNetworkClientType,
+  expectedNetworkClientId,
+  initialState,
+  operation,
+  shouldTestInfuraMessengerEvents = true,
+}: {
+  expectedNetworkClientType: NetworkClientType;
+  expectedNetworkClientId: NetworkClientId;
+  initialState?: Partial<NetworkState>;
+  operation: (controller: NetworkController) => Promise<void>;
+  shouldTestInfuraMessengerEvents?: boolean;
+}): void {
+  describe('if the network details request resolves successfully', () => {
+    describe('if the new network details of the target network are different from the ones in state', () => {
+      it('updates state to match', async () => {
+        await withController(
+          {
+            state: {
+              ...initialState,
+              networksMetadata: {
+                [expectedNetworkClientId]: {
+                  EIPS: { 1559: false },
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  response: {
+                    result: {
+                      baseFeePerGas: '0x1',
+                    },
+                  },
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            await operation(controller);
+
+            expect(
+              controller.state.networksMetadata[expectedNetworkClientId]
+                .EIPS[1559],
+            ).toBe(true);
+          },
+        );
+      });
+    });
+
+    describe('if the new network details of the target network are the same as the ones in state', () => {
+      it('does not update state', async () => {
+        await withController(
+          {
+            state: {
+              ...initialState,
+              networksMetadata: {
+                [expectedNetworkClientId]: {
+                  EIPS: { 1559: true },
+                  status: NetworkStatus.Unknown,
+                },
+              },
+            },
+          },
+          async ({ controller }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  response: {
+                    result: {
+                      baseFeePerGas: '0x1',
+                    },
+                  },
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            await operation(controller);
+
+            expect(
+              controller.state.networksMetadata[expectedNetworkClientId]
+                .EIPS[1559],
+            ).toBe(true);
+          },
+        );
+      });
+    });
+
+    if (shouldTestInfuraMessengerEvents) {
+      it('emits infuraIsUnblocked', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller, messenger }) => {
+            await setFakeProvider(controller, {
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const infuraIsUnblocked = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:infuraIsUnblocked',
+              operation: async () => {
+                await operation(controller);
+              },
+            });
+
+            await expect(infuraIsUnblocked).toBeFulfilled();
+          },
+        );
+      });
+
+      it('does not emit infuraIsBlocked', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller, messenger }) => {
+            await setFakeProvider(controller, {
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const infuraIsBlocked = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:infuraIsBlocked',
+              count: 0,
+              operation: async () => {
+                await operation(controller);
+              },
+            });
+
+            await expect(infuraIsBlocked).toBeFulfilled();
+          },
+        );
+      });
+    }
+  });
+
+  describe('if the network details request produces a JSON-RPC error that is not internal and not a country blocked error', () => {
+    it('updates the network in state to "unavailable"', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: rpcErrors.limitExceeded('some error'),
+              },
+            ],
+            stubLookupNetworkWhileSetting: true,
+          });
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].status,
+          ).toBe(NetworkStatus.Unavailable);
+        },
+      );
+    });
+
+    it('resets the network details in state', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              // Called during provider initialization
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                response: {
+                  result: PRE_1559_BLOCK,
+                },
+              },
+              // Called when calling the operation directly
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: rpcErrors.limitExceeded('some error'),
+              },
+            ],
+          });
+          expect(
+            controller.state.networksMetadata[
+              controller.state.selectedNetworkClientId
+            ].EIPS[1559],
+          ).toBe(false);
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].EIPS,
+          ).toStrictEqual({});
+        },
+      );
+    });
+
+    if (shouldTestInfuraMessengerEvents) {
+      if (expectedNetworkClientType === NetworkClientType.Custom) {
+        it('emits infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: rpcErrors.limitExceeded('some error'),
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+      } else {
+        it('does not emit infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: rpcErrors.limitExceeded('some error'),
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                count: 0,
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+      }
+
+      it('does not emit infuraIsBlocked', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller, messenger }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  error: rpcErrors.limitExceeded('some error'),
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const infuraIsBlocked = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:infuraIsBlocked',
+              count: 0,
+              operation: async () => {
+                await operation(controller);
+              },
+            });
+
+            await expect(infuraIsBlocked).toBeFulfilled();
+          },
+        );
+      });
+    }
+  });
+
+  describe('if the network details request produces a country blocked error', () => {
+    if (expectedNetworkClientType === NetworkClientType.Custom) {
+      it('updates the network in state to "unknown"', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            await operation(controller);
+
+            expect(
+              controller.state.networksMetadata[expectedNetworkClientId].status,
+            ).toBe(NetworkStatus.Unknown);
+          },
+        );
+      });
+
+      if (shouldTestInfuraMessengerEvents) {
+        it('emits infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+
+        it('does not emit infuraIsBlocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsBlocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsBlocked',
+                count: 0,
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsBlocked).toBeFulfilled();
+            },
+          );
+        });
+      }
+    } else {
+      it('updates the network in state to "blocked"', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            await operation(controller);
+
+            expect(
+              controller.state.networksMetadata[expectedNetworkClientId].status,
+            ).toBe(NetworkStatus.Blocked);
+          },
+        );
+      });
+
+      if (shouldTestInfuraMessengerEvents) {
+        it('does not emit infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                count: 0,
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+
+        it('emits infuraIsBlocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: BLOCKED_INFURA_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsBlocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsBlocked',
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsBlocked).toBeFulfilled();
+            },
+          );
+        });
+      }
+    }
+
+    it('resets the network details in state', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              // Called during provider initialization
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                response: {
+                  result: PRE_1559_BLOCK,
+                },
+              },
+              // Called when calling the operation directly
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: BLOCKED_INFURA_JSON_RPC_ERROR,
+              },
+            ],
+          });
+          expect(
+            controller.state.networksMetadata[
+              controller.state.selectedNetworkClientId
+            ].EIPS[1559],
+          ).toBe(false);
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].EIPS,
+          ).toStrictEqual({});
+        },
+      );
+    });
+  });
+
+  describe('if the network details request produces an internal JSON-RPC error', () => {
+    it('updates the network in state to "unknown"', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: GENERIC_JSON_RPC_ERROR,
+              },
+            ],
+            stubLookupNetworkWhileSetting: true,
+          });
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].status,
+          ).toBe(NetworkStatus.Unknown);
+        },
+      );
+    });
+
+    it('resets the network details in state', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              // Called during provider initialization
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                response: {
+                  result: PRE_1559_BLOCK,
+                },
+              },
+              // Called when calling the operation directly
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: GENERIC_JSON_RPC_ERROR,
+              },
+            ],
+          });
+          expect(
+            controller.state.networksMetadata[
+              controller.state.selectedNetworkClientId
+            ].EIPS[1559],
+          ).toBe(false);
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].EIPS,
+          ).toStrictEqual({});
+        },
+      );
+    });
+
+    if (shouldTestInfuraMessengerEvents) {
+      if (expectedNetworkClientType === NetworkClientType.Custom) {
+        it('emits infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: GENERIC_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+      } else {
+        it('does not emit infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: GENERIC_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                count: 0,
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+      }
+
+      it('does not emit infuraIsBlocked', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller, messenger }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  error: GENERIC_JSON_RPC_ERROR,
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const infuraIsBlocked = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:infuraIsBlocked',
+              count: 0,
+              operation: async () => {
+                await operation(controller);
+              },
+            });
+
+            await expect(infuraIsBlocked).toBeFulfilled();
+          },
+        );
+      });
+    }
+  });
+
+  describe('if the network details request produces a non-JSON-RPC error', () => {
+    it('updates the network in state to "unknown"', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: 'oops',
+              },
+            ],
+            stubLookupNetworkWhileSetting: true,
+          });
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].status,
+          ).toBe(NetworkStatus.Unknown);
+        },
+      );
+    });
+
+    it('resets the network details in state', async () => {
+      await withController(
+        {
+          state: initialState,
+        },
+        async ({ controller }) => {
+          await setFakeProvider(controller, {
+            stubs: [
+              // Called during provider initialization
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                response: {
+                  result: PRE_1559_BLOCK,
+                },
+              },
+              // Called when calling the operation directly
+              {
+                request: {
+                  method: 'eth_getBlockByNumber',
+                  params: ['latest', false],
+                },
+                error: GENERIC_JSON_RPC_ERROR,
+              },
+            ],
+          });
+          expect(
+            controller.state.networksMetadata[
+              controller.state.selectedNetworkClientId
+            ].EIPS[1559],
+          ).toBe(false);
+
+          await operation(controller);
+
+          expect(
+            controller.state.networksMetadata[expectedNetworkClientId].EIPS,
+          ).toStrictEqual({});
+        },
+      );
+    });
+
+    if (shouldTestInfuraMessengerEvents) {
+      if (expectedNetworkClientType === NetworkClientType.Custom) {
+        it('emits infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: GENERIC_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+      } else {
+        it('does not emit infuraIsUnblocked', async () => {
+          await withController(
+            {
+              state: initialState,
+            },
+            async ({ controller, messenger }) => {
+              await setFakeProvider(controller, {
+                stubs: [
+                  {
+                    request: {
+                      method: 'eth_getBlockByNumber',
+                      params: ['latest', false],
+                    },
+                    error: GENERIC_JSON_RPC_ERROR,
+                  },
+                ],
+                stubLookupNetworkWhileSetting: true,
+              });
+
+              const infuraIsUnblocked = waitForPublishedEvents({
+                messenger,
+                eventType: 'NetworkController:infuraIsUnblocked',
+                count: 0,
+                operation: async () => {
+                  await operation(controller);
+                },
+              });
+
+              await expect(infuraIsUnblocked).toBeFulfilled();
+            },
+          );
+        });
+      }
+
+      it('does not emit infuraIsBlocked', async () => {
+        await withController(
+          {
+            state: initialState,
+          },
+          async ({ controller, messenger }) => {
+            await setFakeProvider(controller, {
+              stubs: [
+                {
+                  request: {
+                    method: 'eth_getBlockByNumber',
+                    params: ['latest', false],
+                  },
+                  error: GENERIC_JSON_RPC_ERROR,
+                },
+              ],
+              stubLookupNetworkWhileSetting: true,
+            });
+
+            const infuraIsBlocked = waitForPublishedEvents({
+              messenger,
+              eventType: 'NetworkController:infuraIsBlocked',
+              count: 0,
+              operation: async () => {
+                await operation(controller);
+              },
+            });
+
+            await expect(infuraIsBlocked).toBeFulfilled();
+          },
+        );
+      });
+    }
+  });
+}
+
+/**
+ * Builds an object that `createNetworkClient` returns.
+ *
+ * @param provider - The provider to use.
+ * @returns The network client.
+ */
+function buildFakeClient(
+  provider: Provider = buildFakeProvider(),
+): NetworkClient {
+  return {
+    configuration: {
+      failoverRpcUrls: [],
+      type: NetworkClientType.Custom,
+      ticker: 'TEST',
+      chainId: '0x1',
+      rpcUrl: 'https://test.network',
+    },
+    provider,
+    blockTracker: new FakeBlockTracker({
+      provider,
+    }),
+    destroy: (): void => {
+      // do nothing
+    },
+  };
+}
+
+/**
+ * Builds an object that fits the same shape as the object that the
+ * `@metamask/eth-json-rpc-provider` package builds, with canned responses
+ * optionally provided for certain RPC methods.
+ *
+ * @param stubs - The list of RPC methods you want to stub along with their
+ * responses. `eth_getBlockByNumber` and `eth_blockNumber will be stubbed by
+ * default.
+ * @returns The object.
+ */
+function buildFakeProvider(stubs: FakeProviderStub[] = []): Provider {
+  const completeStubs = stubs.slice();
+  if (!stubs.some((stub) => stub.request.method === 'eth_getBlockByNumber')) {
+    completeStubs.unshift({
+      request: { method: 'eth_getBlockByNumber' },
+      response: { result: '0x1' },
+      discardAfterMatching: false,
+    });
+  }
+  return new FakeProvider({ stubs: completeStubs });
+}
+
+/**
+ * Asks the controller to set the provider in the simplest way, stubbing the
+ * provider appropriately so as not to cause any errors to be thrown. This is
+ * useful in tests where it doesn't matter how the provider gets set, just that
+ * it does. Canned responses may be optionally provided for certain RPC methods
+ * on the provider.
+ *
+ * @param controller - The network controller.
+ * @param options - Additional options.
+ * @param options.stubs - The set of RPC methods you want to stub on the
+ * provider along with their responses.
+ * @param options.stubLookupNetworkWhileSetting - Whether to stub the call to
+ * `lookupNetwork` that happens when the provider is set. This option is useful
+ * in tests that need a provider to get set but also call `lookupNetwork` on
+ * their own. In this case, since the `providerConfig` setter already calls
+ * `lookupNetwork` once, and since `lookupNetwork` is called out of band, the
+ * test may run with unexpected results. By stubbing `lookupNetwork` before
+ * setting the provider, the test is free to explicitly call it.
+ * @returns The set provider.
+ */
+async function setFakeProvider(
+  controller: NetworkController,
+  {
+    stubs = [],
+    stubLookupNetworkWhileSetting = false,
+  }: {
+    stubs?: FakeProviderStub[];
+    stubLookupNetworkWhileSetting?: boolean;
+  } = {},
+): Promise<void> {
+  const fakeProvider = buildFakeProvider(stubs);
+  const fakeNetworkClient = buildFakeClient(fakeProvider);
+  createNetworkClientMock.mockReturnValue(fakeNetworkClient);
+  const lookupNetworkMock = jest.spyOn(controller, 'lookupNetwork');
+
+  if (stubLookupNetworkWhileSetting) {
+    lookupNetworkMock.mockResolvedValue(undefined);
+  }
+
+  await controller.initializeProvider();
+  assert(controller.getProviderAndBlockTracker().provider);
+
+  if (stubLookupNetworkWhileSetting) {
+    lookupNetworkMock.mockRestore();
+  }
+}
+
+/**
+ * Waits for controller events to be emitted before proceeding.
+ *
+ * @param options - An options bag.
+ * @param options.messenger - The messenger suited for NetworkController.
+ * @param options.eventType - The type of NetworkController event you want to wait for.
+ * @param options.count - The number of events you expect to occur (default: 1).
+ * @param options.filter - A function used to discard events that are not of
+ * interest.
+ * @param options.wait - The amount of time in milliseconds to wait for the
+ * expected number of filtered events to occur before resolving the promise that
+ * this function returns (default: 150).
+ * @param options.operation - A function to run that will presumably produce
+ * the events in question.
+ * @param options.beforeResolving - In some tests, events occur so fast, we need
+ * to make an assertion immediately after the event in question occurs. However,
+ * if we wait until the promise this function returns resolves to do so, some
+ * other state update to the same property may have happened. This option allows
+ * you to make an assertion _before_ the promise resolves. This has the added
+ * benefit of allowing you to maintain the "arrange, act, assert" ordering in
+ * your test, meaning that you can still call the method that kicks off the
+ * event and then make the assertion afterward instead of the other way around.
+ * @returns A promise that resolves to the list of payloads for the set of
+ * events, optionally filtered, when a specific number of them have occurred.
+ */
+async function waitForPublishedEvents<Events extends NetworkControllerEvents>({
+  messenger,
+  eventType,
+  count: expectedNumberOfEvents = 1,
+  filter: isEventPayloadInteresting = (): boolean => true,
+  wait: timeBeforeAssumingNoMoreEvents = 150,
+  operation = (): void => {
+    // do nothing
+  },
+  beforeResolving = async (): Promise<void> => {
+    // do nothing
+  },
+}: {
+  messenger: RootMessenger;
+  eventType: Events['type'];
+  count?: number;
+  filter?: (payload: Events['payload']) => boolean;
+  wait?: number;
+  operation?: () => void | Promise<void>;
+  beforeResolving?: () => void | Promise<void>;
+}): Promise<Events['payload'][]> {
+  const promiseForEventPayloads = new Promise<Events['payload'][]>(
+    (resolve, reject) => {
+      let timer: NodeJS.Timeout | undefined;
+      const allEventPayloads: Events['payload'][] = [];
+      const interestingEventPayloads: Events['payload'][] = [];
+      let alreadyEnded = false;
+
+      // We're using `any` here because there seems to be some mismatch between
+      // the signature of `subscribe` and the way that we're using it. Try
+      // changing `any` to either `((...args: E['payload']) => void)` or
+      // `ExtractEventHandler<E, E['type']>` to see the issue.
+      // TODO: Replace `any` with type
+      // eslint-disable-next-line @typescript-eslint/no-explicit-any
+      const eventListener: any = (...payload: Events['payload']) => {
+        allEventPayloads.push(payload);
+
+        if (isEventPayloadInteresting(payload)) {
+          interestingEventPayloads.push(payload);
+          if (interestingEventPayloads.length === expectedNumberOfEvents) {
+            stopTimer();
+            // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+            // eslint-disable-next-line @typescript-eslint/no-floating-promises
+            end();
+          } else {
+            resetTimer();
+          }
+        }
+      };
+
+      /**
+       * Stop listening for published events.
+       */
+      async function end(): Promise<void> {
+        if (!alreadyEnded) {
+          messenger.unsubscribe(eventType, eventListener);
+
+          await beforeResolving();
+
+          if (interestingEventPayloads.length === expectedNumberOfEvents) {
+            resolve(interestingEventPayloads);
+          } else {
+            reject(
+              new Error(
+                `Expected to receive ${expectedNumberOfEvents} ${String(eventType)} event(s), but received ${
+                  interestingEventPayloads.length
+                } after ${timeBeforeAssumingNoMoreEvents}ms.\n\nAll payloads:\n\n${inspect(
+                  allEventPayloads,
+                  { depth: null },
+                )}`,
+              ),
+            );
+          }
+
+          // eslint-disable-next-line require-atomic-updates
+          alreadyEnded = true;
+        }
+      }
+
+      /**
+       * Stop the timer used to detect a timeout when listening for published events.
+       */
+      function stopTimer(): void {
+        if (timer) {
+          clearTimeout(timer);
+        }
+      }
+
+      /**
+       * Reset the timer used to detect a timeout when listening for published events.
+       */
+      function resetTimer(): void {
+        stopTimer();
+        timer = setTimeout(() => {
+          // TODO: Either fix this lint violation or explain why it's necessary to ignore.
+          // eslint-disable-next-line @typescript-eslint/no-floating-promises
+          end();
+        }, timeBeforeAssumingNoMoreEvents);
+      }
+
+      messenger.subscribe(eventType, eventListener);
+      resetTimer();
+    },
+  );
+
+  await operation();
+
+  return await promiseForEventPayloads;
+}
+
+/**
+ * Waits for state change events to be emitted (optionally centered around a
+ * particular property) before proceeding.
+ *
+ * @param options - An options bag.
+ * @param options.messenger - The messenger suited for NetworkController.
+ * @param options.propertyPath - The path of the property you expect the state
+ * changes to concern.
+ * @param options.count - The number of events you expect to occur (default: 1).
+ * @param options.wait - The amount of time in milliseconds to wait for the
+ * expected number of filtered events to occur before resolving the promise that
+ * this function returns (default: 150).
+ * @param options.operation - A function to run that will presumably
+ * produce the state changes in question.
+ * @param options.beforeResolving - In some tests, state updates happen so fast,
+ * we need to make an assertion immediately after the event in question occurs.
+ * However, if we wait until the promise this function returns resolves to do
+ * so, some other state update to the same property may have happened. This
+ * option allows you to make an assertion _before_ the promise resolves. This
+ * has the added benefit of allowing you to maintain the "arrange, act, assert"
+ * ordering in your test, meaning that you can still call the method that kicks
+ * off the event and then make the assertion afterward instead of the other way
+ * around.
+ * @returns A promise that resolves to the list of state changes, optionally
+ * filtered by the property, when a specific number of them have occurred.
+ */
+async function waitForStateChanges({
+  messenger,
+  propertyPath,
+  count,
+  wait,
+  operation,
+  beforeResolving,
+}: {
+  messenger: RootMessenger;
+  propertyPath?: string[];
+  count?: number;
+  wait?: number;
+  operation?: () => void | Promise<void>;
+  beforeResolving?: () => void | Promise<void>;
+}): Promise<[NetworkState, Patch[]][]> {
+  const filter =
+    propertyPath === undefined
+      ? (): boolean => true
+      : ([_newState, patches]: [NetworkState, Patch[]]): boolean =>
+          didPropertyChange(patches, propertyPath);
+
+  return await waitForPublishedEvents<NetworkControllerStateChangeEvent>({
+    messenger,
+    eventType: 'NetworkController:stateChange',
+    operation,
+    count,
+    filter,
+    wait,
+    beforeResolving,
+  });
+}
+
+/**
+ * Given a set of Immer patches, determines whether the given property was
+ * added, removed, or replaced in some way.
+ *
+ * @param patches - The Immer patches.
+ * @param propertyPath - The path to a property. For instance, if you wanted to
+ * know whether `foo` has changed you'd say `["foo"]`; if `foo.bar` then
+ * `["foo", "bar"]`.
+ * @returns A boolean.
+ */
+function didPropertyChange(patches: Patch[], propertyPath: string[]): boolean {
+  return patches.some((patch) => {
+    const minLength = Math.min(patch.path.length, propertyPath.length);
+    return isDeepStrictEqual(
+      patch.path.slice(0, minLength),
+      propertyPath.slice(0, minLength),
+    );
+  });
+}
+
+/**
+ * Extracts the network client configurations from a network client registry so
+ * that it is easier to test without having to ignore every property in
+ * NetworkClient but `configuration`.
+ *
+ * @param networkClientRegistry - The network client registry.
+ * @returns A map of network client ID to network client configuration.
+ */
+function getNetworkConfigurationsByNetworkClientId(
+  networkClientRegistry: AutoManagedBuiltInNetworkClientRegistry &
+    AutoManagedCustomNetworkClientRegistry,
+): Record<NetworkClientId, NetworkClientConfiguration> {
+  return Object.entries(networkClientRegistry).reduce(
+    (
+      obj: Partial<Record<NetworkClientId, NetworkClientConfiguration>>,
+      [networkClientId, networkClient],
+    ) => {
+      return {
+        ...obj,
+        [networkClientId]: networkClient.configuration,
+      };
+    },
+    {},
+  ) as Record<NetworkClientId, NetworkClientConfiguration>;
+}
+
+/**
+ * When initializing NetworkController with state, the `selectedNetworkClientId`
+ * property must match the `networkClientId` of an RPC endpoint in
+ * `networkConfigurationsByChainId`. Sometimes when writing tests we care about
+ * what the `selectedNetworkClientId` is, but sometimes we don't and we'd rather
+ * have this property automatically filled in for us.
+ *
+ * This function takes care of filling in the `selectedNetworkClientId` using
+ * the first RPC endpoint of the first network configuration given.
+ *
+ * @param networkControllerState - The desired NetworkController state
+ * overrides.
+ * @param networkControllerState.networkConfigurationsByChainId - The desired
+ * `networkConfigurationsByChainId`.
+ * @param networkControllerState.selectedNetworkClientId - The desired
+ * `selectedNetworkClientId`; if not provided, then will be set to the
+ * `networkClientId` of the first RPC endpoint in
+ * `networkConfigurationsByChainId`.
+ * @returns The complete NetworkController state with `selectedNetworkClientId`
+ * properly filled in.
+ */
+function buildNetworkControllerStateWithDefaultSelectedNetworkClientId({
+  networkConfigurationsByChainId,
+  selectedNetworkClientId: givenSelectedNetworkClientId,
+  ...rest
+}: Partial<Omit<NetworkState, 'networkConfigurationsByChainId'>> &
+  Pick<NetworkState, 'networkConfigurationsByChainId'>): Partial<NetworkState> {
+  if (givenSelectedNetworkClientId === undefined) {
+    const networkConfigurations = Object.values(networkConfigurationsByChainId);
+    const selectedNetworkClientId =
+      networkConfigurations.length > 0
+        ? networkConfigurations[0].rpcEndpoints[0].networkClientId
+        : undefined;
+    return {
+      networkConfigurationsByChainId,
+      selectedNetworkClientId,
+      ...rest,
+    };
+  }
+
+  return {
+    networkConfigurationsByChainId,
+    selectedNetworkClientId: givenSelectedNetworkClientId,
+    ...rest,
+  };
+}
diff --git a/tests/helpers.ts b/tests/helpers.ts
new file mode 100644
index 0000000000000000000000000000000000000000..860eb2a53478b5a3a2dd8b5124af732d3277b3c2
--- /dev/null
+++ b/tests/helpers.ts
@@ -0,0 +1,656 @@
+import { CONNECTIVITY_STATUSES } from '@metamask/connectivity-controller';
+import type { ConnectivityStatus } from '@metamask/connectivity-controller';
+import {
+  ChainId,
+  InfuraNetworkType,
+  NetworkNickname,
+  NetworksTicker,
+  toHex,
+} from '@metamask/controller-utils';
+import type { InternalProvider } from '@metamask/eth-json-rpc-provider';
+import { Messenger, MOCK_ANY_NAMESPACE } from '@metamask/messenger';
+import type {
+  MockAnyNamespace,
+  MessengerActions,
+  MessengerEvents,
+} from '@metamask/messenger';
+import type { Hex } from '@metamask/utils';
+import { v4 as uuidV4 } from 'uuid';
+
+import { FakeBlockTracker } from '../../../tests/fake-block-tracker';
+import { FakeProvider } from '../../../tests/fake-provider';
+import type { FakeProviderStub } from '../../../tests/fake-provider';
+import { buildTestObject } from '../../../tests/helpers';
+import { NetworkController } from '../src';
+import type {
+  BuiltInNetworkClientId,
+  CustomNetworkClientId,
+  NetworkClient,
+  NetworkClientConfiguration,
+  NetworkClientId,
+  NetworkConfiguration,
+} from '../src';
+import type { AutoManagedNetworkClient } from '../src/create-auto-managed-network-client';
+import type {
+  AddNetworkCustomRpcEndpointFields,
+  AddNetworkFields,
+  CustomRpcEndpoint,
+  InfuraRpcEndpoint,
+  NetworkControllerMessenger,
+  NetworkControllerOptions,
+  UpdateNetworkCustomRpcEndpointFields,
+} from '../src/NetworkController';
+import { RpcEndpointType } from '../src/NetworkController';
+import { RpcServiceOptions } from '../src/rpc-service/rpc-service';
+import type {
+  CustomNetworkClientConfiguration,
+  InfuraNetworkClientConfiguration,
+} from '../src/types';
+import { NetworkClientType } from '../src/types';
+
+export type AllNetworkControllerActions =
+  MessengerActions<NetworkControllerMessenger>;
+
+export type AllNetworkControllerEvents =
+  MessengerEvents<NetworkControllerMessenger>;
+
+export type RootMessenger = Messenger<
+  MockAnyNamespace,
+  AllNetworkControllerActions,
+  AllNetworkControllerEvents
+>;
+
+/**
+ * A list of active InfuraNetworkType that are used in many tests
+ *
+ * TODO: Base this off of InfuraNetworkType when Goerli is removed.
+ */
+export const INFURA_NETWORKS = [
+  InfuraNetworkType.mainnet,
+  InfuraNetworkType.sepolia,
+  InfuraNetworkType['linea-mainnet'],
+  InfuraNetworkType['linea-sepolia'],
+];
+
+/**
+ * A object that contains the configuration for a network that begining used in many tests
+ */
+export const TESTNET = {
+  networkType: InfuraNetworkType.sepolia,
+  chainId: ChainId.sepolia,
+  name: 'Sepolia',
+  nativeCurrency: 'SepoliaETH',
+};
+
+/**
+ * Build a root messenger that includes all events used by the network
+ * controller.
+ *
+ * @param options - Optional configuration.
+ * @param options.connectivityStatus - The connectivity status to return by default.
+ * If not provided, defaults to Online.
+ * @returns The messenger.
+ */
+export function buildRootMessenger({
+  connectivityStatus = CONNECTIVITY_STATUSES.Online,
+}: {
+  connectivityStatus?: ConnectivityStatus;
+} = {}): RootMessenger {
+  const rootMessenger = new Messenger<
+    MockAnyNamespace,
+    MessengerActions<NetworkControllerMessenger>,
+    MessengerEvents<NetworkControllerMessenger>
+  >({ namespace: MOCK_ANY_NAMESPACE, captureException: jest.fn() });
+
+  rootMessenger.registerActionHandler(
+    'ConnectivityController:getState',
+    () => ({
+      connectivityStatus,
+    }),
+  );
+
+  return rootMessenger;
+}
+
+/**
+ * Build a messenger for the network controller.
+ *
+ * @param rootMessenger - The root messenger.
+ * @returns The network controller messenger.
+ */
+export function buildNetworkControllerMessenger(
+  rootMessenger = buildRootMessenger(),
+): NetworkControllerMessenger {
+  const networkControllerMessenger = new Messenger<
+    'NetworkController',
+    AllNetworkControllerActions,
+    AllNetworkControllerEvents,
+    typeof rootMessenger
+  >({
+    namespace: 'NetworkController',
+    parent: rootMessenger,
+  });
+
+  rootMessenger.delegate({
+    messenger: networkControllerMessenger,
+    actions: ['ConnectivityController:getState'],
+  });
+
+  return networkControllerMessenger;
+}
+
+/**
+ * Builds an object that satisfies the NetworkClient shape, but using a fake
+ * provider and block tracker which doesn't make any requests.
+ *
+ * @param args - Arguments to this function.
+ * @param args.configuration - The desired network client configuration.
+ * @param args.providerStubs - Objects that allow for stubbing specific provider
+ * requests.
+ * @returns The fake network client.
+ */
+function buildFakeNetworkClient({
+  configuration,
+  providerStubs = [],
+}: {
+  configuration: NetworkClientConfiguration;
+  providerStubs?: FakeProviderStub[];
+}): NetworkClient {
+  const provider = new FakeProvider({ stubs: providerStubs });
+  return {
+    configuration,
+    provider,
+    blockTracker: new FakeBlockTracker({
+      provider: provider as unknown as InternalProvider,
+    }),
+    destroy: (): void => {
+      // do nothing
+    },
+  };
+}
+
+/**
+ * The `getNetworkClientById` method on NetworkController (and thus, the
+ * `NetworkController:getNetworkClientById` controller action) is difficult to
+ * mock because it needs to be able to return either an Infura network client or
+ * a custom network client. However, a test may want to return specific network
+ * clients with specific network client configurations for specific network
+ * client IDs. This function makes that easier by allowing the consumer to
+ * specify a map of network client ID to network client configuration, handling
+ * the logic appropriately as well as defining the correct overloads for the
+ * mock version of `getNetworkClientById`.
+ *
+ * @param mockNetworkClientConfigurationsByNetworkClientId - Allows for defining
+ * the network client configuration â€” and thus the network client itself â€” that
+ * belongs to a particular network client ID.
+ * @returns The mock version of `getNetworkClientById`.
+ */
+export function buildMockGetNetworkClientById(
+  mockNetworkClientConfigurationsByNetworkClientId: Record<
+    NetworkClientId,
+    NetworkClientConfiguration
+  > = {},
+): NetworkController['getNetworkClientById'] {
+  // Since we might want to access these network client IDs so often in tests,
+  // register the network client configurations for all Infura networks by
+  // default. This does introduce a bit of magic as we don't expect to actually
+  // have a NetworkController in a test, but if we did, then we'd be able to
+  // make the same assumption anyway (i.e., that we'd be able to access any
+  // Infura network without having to add it explicitly to the controller). So
+  // pre-registering these network client IDs provides consistency from a mental
+  // model perspective at the expense of debuggability.
+  const defaultMockNetworkClientConfigurationsByNetworkClientId = Object.values(
+    InfuraNetworkType,
+  ).reduce((obj, infuraNetworkType) => {
+    return {
+      ...obj,
+      [infuraNetworkType]:
+        buildInfuraNetworkClientConfiguration(infuraNetworkType),
+    };
+  }, {});
+  const mergedMockNetworkClientConfigurationsByNetworkClientId: Record<
+    NetworkClientId,
+    NetworkClientConfiguration
+  > = {
+    ...defaultMockNetworkClientConfigurationsByNetworkClientId,
+    ...mockNetworkClientConfigurationsByNetworkClientId,
+  };
+
+  function getNetworkClientById(
+    networkClientId: BuiltInNetworkClientId,
+  ): AutoManagedNetworkClient<InfuraNetworkClientConfiguration>;
+  function getNetworkClientById(
+    networkClientId: CustomNetworkClientId,
+  ): AutoManagedNetworkClient<CustomNetworkClientConfiguration>;
+
+  function getNetworkClientById(networkClientId: string): NetworkClient {
+    const mockNetworkClientConfiguration =
+      mergedMockNetworkClientConfigurationsByNetworkClientId[networkClientId];
+
+    if (mockNetworkClientConfiguration === undefined) {
+      throw new Error(
+        `Unknown network client ID '${networkClientId}'. Please add it to mockNetworkClientConfigurationsByNetworkClientId.`,
+      );
+    }
+
+    return buildFakeNetworkClient({
+      configuration: mockNetworkClientConfiguration,
+    });
+  }
+
+  return getNetworkClientById;
+}
+
+/**
+ * Builds a mock version of the `findNetworkClientIdByChainId` method on
+ * NetworkController.
+ *
+ * @param mockNetworkClientConfigurationsByNetworkClientId - Allows for defining
+ * the network client configuration â€” and thus the network client itself â€” that
+ * belongs to a particular network client ID.
+ * @returns The mock version of `findNetworkClientIdByChainId`.
+ */
+export function buildMockFindNetworkClientIdByChainId(
+  mockNetworkClientConfigurationsByNetworkClientId: Record<
+    Hex,
+    NetworkClientConfiguration
+  > = {},
+): NetworkController['findNetworkClientIdByChainId'] {
+  const defaultMockNetworkClientConfigurationsByNetworkClientId = Object.values(
+    InfuraNetworkType,
+  ).reduce((obj, infuraNetworkType) => {
+    const testNetworkClientConfig =
+      buildInfuraNetworkClientConfiguration(infuraNetworkType);
+    return {
+      ...obj,
+      [testNetworkClientConfig.chainId]: testNetworkClientConfig,
+    };
+  }, {});
+  const mergedMockNetworkClientConfigurationsByNetworkClientId: Record<
+    Hex,
+    InfuraNetworkClientConfiguration
+  > = {
+    ...defaultMockNetworkClientConfigurationsByNetworkClientId,
+    ...mockNetworkClientConfigurationsByNetworkClientId,
+  };
+
+  function findNetworkClientIdByChainId(chainId: Hex): NetworkClientId;
+
+  function findNetworkClientIdByChainId(chainId: Hex): NetworkClientId {
+    const networkClientConfigForChainId =
+      mergedMockNetworkClientConfigurationsByNetworkClientId[chainId];
+    if (!networkClientConfigForChainId) {
+      throw new Error(
+        `Unknown chainId '${chainId}'. Please add it to mockNetworkClientConfigurationsByNetworkClientId.`,
+      );
+    }
+
+    return networkClientConfigForChainId.network;
+  }
+  return findNetworkClientIdByChainId;
+}
+
+/**
+ * Builds a configuration object for an Infura network client based on the name
+ * of an Infura network.
+ *
+ * @param network - The name of an Infura network.
+ * @param overrides - Properties to merge into the configuration object.
+ * @returns the complete Infura network client configuration.
+ */
+export function buildInfuraNetworkClientConfiguration(
+  network: InfuraNetworkType,
+  overrides: Partial<InfuraNetworkClientConfiguration> = {},
+): InfuraNetworkClientConfiguration {
+  return {
+    type: NetworkClientType.Infura,
+    network,
+    failoverRpcUrls: [],
+    infuraProjectId: 'test-infura-project-id',
+    chainId: ChainId[network],
+    ticker: NetworksTicker[network],
+    ...overrides,
+  };
+}
+
+/**
+ * Builds a configuration object for a custom network client based on any
+ * overrides provided.
+ *
+ * @param overrides - Properties to merge into the configuration object.
+ * @returns the complete custom network client configuration.
+ */
+export function buildCustomNetworkClientConfiguration(
+  overrides: Partial<CustomNetworkClientConfiguration> = {},
+): CustomNetworkClientConfiguration {
+  // `Object.assign` allows for properties to be `undefined` in `overrides`,
+  // and will copy them over
+  return Object.assign(
+    {
+      chainId: toHex(1337),
+      failoverRpcUrls: [],
+      rpcUrl: 'https://example.test',
+      ticker: 'TEST',
+    },
+    overrides,
+    {
+      type: NetworkClientType.Custom,
+    },
+  );
+}
+
+/**
+ * Constructs a NetworkConfiguration object for use in testing, providing
+ * defaults and allowing properties to be overridden at will.
+ *
+ * @param overrides - The properties to override the new
+ * NetworkConfiguration with.
+ * @param defaultRpcEndpointType - The type of the RPC endpoint you want to
+ * use by default.
+ * @returns The complete NetworkConfiguration object.
+ */
+export function buildNetworkConfiguration(
+  overrides: Partial<NetworkConfiguration> = {},
+  defaultRpcEndpointType: RpcEndpointType = RpcEndpointType.Custom,
+): NetworkConfiguration {
+  return buildTestObject(
+    {
+      blockExplorerUrls: () => [],
+      chainId: () => '0x1337',
+      // @ts-expect-error We will make sure that this property is set below.
+      defaultRpcEndpointIndex: () => undefined,
+      name: () => 'Some Network',
+      nativeCurrency: () => 'TOKEN',
+      rpcEndpoints: () => [
+        defaultRpcEndpointType === RpcEndpointType.Infura
+          ? buildInfuraRpcEndpoint(TESTNET.networkType)
+          : buildCustomRpcEndpoint({ url: 'https://test.endpoint' }),
+      ],
+    },
+    overrides,
+    (object) => {
+      if (
+        object.defaultRpcEndpointIndex === undefined &&
+        object.rpcEndpoints.length > 0
+      ) {
+        return {
+          ...object,
+          defaultRpcEndpointIndex: 0,
+        };
+      }
+      return object;
+    },
+  );
+}
+
+/**
+ * Constructs a NetworkConfiguration object preloaded with a custom RPC endpoint
+ * for use in testing, providing defaults and allowing properties to be
+ * overridden at will.
+ *
+ * @param overrides - The properties to override the new NetworkConfiguration
+ * with.
+ * @returns The complete NetworkConfiguration object.
+ */
+export function buildCustomNetworkConfiguration(
+  overrides: Partial<NetworkConfiguration> = {},
+): NetworkConfiguration {
+  return buildTestObject(
+    {
+      blockExplorerUrls: () => [],
+      chainId: () => '0x1337' as const,
+      // @ts-expect-error We will make sure that this property is set below.
+      defaultRpcEndpointIndex: () => undefined,
+      name: () => 'Some Network',
+      nativeCurrency: () => 'TOKEN',
+      rpcEndpoints: () => [
+        buildCustomRpcEndpoint({
+          url: generateCustomRpcEndpointUrl(),
+        }),
+      ],
+    },
+    overrides,
+    (object) => {
+      if (
+        object.defaultRpcEndpointIndex === undefined &&
+        object.rpcEndpoints.length > 0
+      ) {
+        return {
+          ...object,
+          defaultRpcEndpointIndex: 0,
+        };
+      }
+      return object;
+    },
+  );
+}
+
+/**
+ * Constructs a NetworkConfiguration object preloaded with an Infura RPC
+ * endpoint for use in testing.
+ *
+ * @param infuraNetworkType - The Infura network type from which to create the
+ * NetworkConfiguration.
+ * @param overrides - The properties to override the new NetworkConfiguration
+ * with.
+ * @param overrides.rpcEndpoints - Extra RPC endpoints.
+ * @returns The complete NetworkConfiguration object.
+ */
+export function buildInfuraNetworkConfiguration(
+  infuraNetworkType: InfuraNetworkType,
+  overrides: Partial<NetworkConfiguration> = {},
+): NetworkConfiguration {
+  const defaultRpcEndpoint = buildInfuraRpcEndpoint(infuraNetworkType);
+  return buildTestObject(
+    {
+      blockExplorerUrls: () => [],
+      chainId: () => ChainId[infuraNetworkType],
+      // @ts-expect-error We will make sure that this property is set below.
+      defaultRpcEndpointIndex: () => undefined,
+      name: () => NetworkNickname[infuraNetworkType],
+      nativeCurrency: () => NetworksTicker[infuraNetworkType],
+      rpcEndpoints: () => [defaultRpcEndpoint],
+    },
+    overrides,
+    (object) => {
+      if (
+        object.defaultRpcEndpointIndex === undefined &&
+        object.rpcEndpoints.length > 0
+      ) {
+        return {
+          ...object,
+          defaultRpcEndpointIndex: 0,
+        };
+      }
+      return object;
+    },
+  );
+}
+
+/**
+ * Constructs a InfuraRpcEndpoint object for use in testing.
+ *
+ * @param infuraNetworkType - The Infura network type from which to create the
+ * InfuraRpcEndpoint.
+ * @param options - Options.
+ * @param options.failoverUrls - The failover URLs to use.
+ * @returns The created InfuraRpcEndpoint object.
+ */
+export function buildInfuraRpcEndpoint(
+  infuraNetworkType: InfuraNetworkType,
+  { failoverUrls = [] }: { failoverUrls?: string[] } = {},
+): InfuraRpcEndpoint {
+  return {
+    failoverUrls,
+    networkClientId: infuraNetworkType,
+    type: RpcEndpointType.Infura as const,
+    url: `https://${infuraNetworkType}.infura.io/v3/{infuraProjectId}`,
+  };
+}
+
+/**
+ * Constructs an CustomRpcEndpoint object for use in testing, providing defaults
+ * and allowing properties to be overridden at will.
+ *
+ * @param overrides - The properties to override the new CustomRpcEndpoint with.
+ * @returns The complete CustomRpcEndpoint object.
+ */
+export function buildCustomRpcEndpoint(
+  overrides: Partial<CustomRpcEndpoint> = {},
+): CustomRpcEndpoint {
+  return buildTestObject(
+    {
+      failoverUrls: () => [],
+      networkClientId: () => uuidV4(),
+      type: () => RpcEndpointType.Custom as const,
+      url: () => generateCustomRpcEndpointUrl(),
+    },
+    overrides,
+  );
+}
+
+/**
+ * Constructs an AddNetworkFields object for use in testing, providing defaults
+ * and allowing properties to be overridden at will.
+ *
+ * @param overrides - The properties to override the new AddNetworkFields with.
+ * @returns The complete AddNetworkFields object.
+ */
+export function buildAddNetworkFields(
+  overrides: Partial<AddNetworkFields> = {},
+): AddNetworkFields {
+  return buildTestObject(
+    {
+      blockExplorerUrls: () => [],
+      chainId: () => '0x1337' as const,
+      // @ts-expect-error We will make sure that this property is set below.
+      defaultRpcEndpointIndex: () => undefined,
+      name: () => 'Some Network',
+      nativeCurrency: () => 'TOKEN',
+      rpcEndpoints: () => [
+        buildAddNetworkCustomRpcEndpointFields({
+          url: generateCustomRpcEndpointUrl(),
+        }),
+      ],
+    },
+    overrides,
+    (object) => {
+      if (
+        object.defaultRpcEndpointIndex === undefined &&
+        object.rpcEndpoints.length > 0
+      ) {
+        return {
+          ...object,
+          defaultRpcEndpointIndex: 0,
+        };
+      }
+      return object;
+    },
+  );
+}
+
+/**
+ * Constructs an AddNetworkCustomRpcEndpointFields object for use in testing,
+ * providing defaults and allowing properties to be overridden at will.
+ *
+ * @param overrides - The properties to override the new
+ * AddNetworkCustomRpcEndpointFields with.
+ * @returns The complete AddNetworkCustomRpcEndpointFields object.
+ */
+export function buildAddNetworkCustomRpcEndpointFields(
+  overrides: Partial<AddNetworkCustomRpcEndpointFields> = {},
+): AddNetworkCustomRpcEndpointFields {
+  return buildTestObject(
+    {
+      failoverUrls: () => [],
+      type: () => RpcEndpointType.Custom as const,
+      url: () => generateCustomRpcEndpointUrl(),
+    },
+    overrides,
+  );
+}
+
+/**
+ * Constructs an UpdateNetworkCustomRpcEndpointFields object for use in testing,
+ * providing defaults and allowing properties to be overridden at will.
+ *
+ * @param overrides - The properties to override the new
+ * UpdateNetworkCustomRpcEndpointFields with.
+ * @returns The complete UpdateNetworkCustomRpcEndpointFields object.
+ */
+export function buildUpdateNetworkCustomRpcEndpointFields(
+  overrides: Partial<UpdateNetworkCustomRpcEndpointFields> = {},
+): UpdateNetworkCustomRpcEndpointFields {
+  return buildTestObject(
+    {
+      failoverUrls: () => [],
+      type: () => RpcEndpointType.Custom as const,
+      url: () => generateCustomRpcEndpointUrl(),
+    },
+    overrides,
+  );
+}
+
+let testEndpointCounter = 0;
+
+/**
+ * Generates a unique custom RPC endpoint URL for testing.
+ *
+ * @returns The generated RPC endpoint URL.
+ */
+function generateCustomRpcEndpointUrl(): string {
+  const url = `https://test.endpoint/${testEndpointCounter}`;
+  testEndpointCounter += 1;
+  return url;
+}
+
+type WithControllerCallback<ReturnValue> = ({
+  controller,
+}: {
+  controller: NetworkController;
+  messenger: RootMessenger;
+  networkControllerMessenger: NetworkControllerMessenger;
+}) => Promise<ReturnValue> | ReturnValue;
+
+type WithControllerOptions = Partial<NetworkControllerOptions>;
+
+type WithControllerArgs<ReturnValue> =
+  | [WithControllerCallback<ReturnValue>]
+  | [WithControllerOptions, WithControllerCallback<ReturnValue>];
+
+/**
+ * Builds a controller based on the given options, and calls the given function
+ * with that controller.
+ *
+ * @param args - Either a function, or an options bag + a function. The options
+ * bag is equivalent to the options that NetworkController takes (although
+ * `messenger` and `infuraProjectId` are  filled in if not given); the function
+ * will be called with the built controller.
+ * @returns Whatever the callback returns.
+ */
+export async function withController<ReturnValue>(
+  ...args: WithControllerArgs<ReturnValue>
+): Promise<ReturnValue> {
+  const [{ ...rest }, fn] = args.length === 2 ? args : [{}, args[0]];
+  const messenger = buildRootMessenger();
+  const networkControllerMessenger = buildNetworkControllerMessenger(messenger);
+  const controller = new NetworkController({
+    messenger: networkControllerMessenger,
+    infuraProjectId: 'infura-project-id',
+    getRpcServiceOptions: (): Omit<
+      RpcServiceOptions,
+      'failoverService' | 'endpointUrl'
+    > => ({
+      fetch,
+      btoa,
+      isOffline: (): boolean => false,
+    }),
+    ...rest,
+  });
+  try {
+    return await fn({ controller, messenger, networkControllerMessenger });
+  } finally {
+    const { blockTracker } = controller.getProviderAndBlockTracker();
+    await blockTracker?.destroy();
+  }
+}
diff --git a/tests/network-client/block-hash-in-response.ts b/tests/network-client/block-hash-in-response.ts
new file mode 100644
index 0000000000000000000000000000000000000000..1ed8a59407fe86f6536509445e5e4d5f9c7317b3
--- /dev/null
+++ b/tests/network-client/block-hash-in-response.ts
@@ -0,0 +1,815 @@
+import { errorCodes, rpcErrors } from '@metamask/rpc-errors';
+
+import type { ProviderType } from './helpers';
+import {
+  waitForPromiseToBeFulfilledAfterRunningAllTimers,
+  withMockedCommunications,
+  withNetworkClient,
+} from './helpers';
+import { testsForRpcFailoverBehavior } from './rpc-failover';
+import { CUSTOM_RPC_ERRORS } from '../../src/rpc-service/rpc-service';
+import { NetworkClientType } from '../../src/types';
+
+type TestsForRpcMethodThatCheckForBlockHashInResponseOptions = {
+  providerType: ProviderType;
+  numberOfParameters: number;
+};
+
+/**
+ * Defines tests which exercise the behavior exhibited by an RPC method that
+ * use `blockHash` in the response data to determine whether the response is
+ * cacheable.
+ *
+ * @param method - The name of the RPC method under test.
+ * @param additionalArgs - Additional arguments.
+ * @param additionalArgs.numberOfParameters - The number of parameters supported
+ * by the method under test.
+ * @param additionalArgs.providerType - The type of provider being tested;
+ * either `infura` or `custom`.
+ */
+export function testsForRpcMethodsThatCheckForBlockHashInResponse(
+  method: string,
+  {
+    numberOfParameters,
+    providerType,
+  }: TestsForRpcMethodThatCheckForBlockHashInResponseOptions,
+): void {
+  it('does not hit the RPC endpoint more than once for identical requests and it has a valid blockHash', async () => {
+    const requests = [{ method }, { method }];
+    const mockResult = { blockHash: '0x1' };
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResult },
+      });
+
+      const results = await withNetworkClient(
+        { providerType },
+        ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+      );
+
+      expect(results).toStrictEqual([mockResult, mockResult]);
+    });
+  });
+
+  it('hits the RPC endpoint and does not reuse the result of a previous request if the latest block number was updated since', async () => {
+    const pollingInterval = 1234;
+    const requests = [{ method }, { method }];
+    const mockResults = [{ blockHash: '0x100' }, { blockHash: '0x200' }];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      comms.mockNextBlockTrackerRequest({ blockNumber: '0x1' });
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+      });
+      comms.mockNextBlockTrackerRequest({ blockNumber: '0x2' });
+      comms.mockRpcCall({
+        request: requests[1],
+        response: { result: mockResults[1] },
+      });
+
+      const results = await withNetworkClient(
+        {
+          providerType,
+          getBlockTrackerOptions: () => ({
+            pollingInterval,
+          }),
+        },
+        async ({ blockTracker, makeRpcCall, clock }) => {
+          const waitForTwoBlocks = new Promise<void>((resolve) => {
+            let numberOfBlocks = 0;
+
+            // Start the block tracker
+            blockTracker.on('latest', () => {
+              numberOfBlocks += 1;
+              if (numberOfBlocks === 2) {
+                resolve();
+              }
+            });
+          });
+
+          const firstResult = await makeRpcCall(requests[0]);
+          // Proceed to the next iteration of the block tracker so that a new
+          // block is fetched and the current block is updated.
+          await clock.tickAsync(pollingInterval);
+          await waitForTwoBlocks;
+          const secondResult = await makeRpcCall(requests[1]);
+          return [firstResult, secondResult];
+        },
+      );
+
+      expect(results).toStrictEqual(mockResults);
+    });
+  });
+
+  it('does not reuse the result of a previous request if result.blockHash was null', async () => {
+    const requests = [{ method }, { method }];
+    const mockResults = [
+      { blockHash: null, extra: 'some value' },
+      { blockHash: '0x100', extra: 'some other value' },
+    ];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+      });
+      comms.mockRpcCall({
+        request: requests[1],
+        response: { result: mockResults[1] },
+      });
+
+      const results = await withNetworkClient(
+        { providerType },
+        ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+      );
+
+      expect(results).toStrictEqual(mockResults);
+    });
+  });
+
+  it('does not reuse the result of a previous request if result.blockHash was undefined', async () => {
+    const requests = [{ method }, { method }];
+    const mockResults = [
+      { extra: 'some value' },
+      { blockHash: '0x100', extra: 'some other value' },
+    ];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+      });
+      comms.mockRpcCall({
+        request: requests[1],
+        response: { result: mockResults[1] },
+      });
+
+      const results = await withNetworkClient(
+        { providerType },
+        ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+      );
+
+      expect(results).toStrictEqual(mockResults);
+    });
+  });
+
+  it('does not reuse the result of a previous request if result.blockHash was "0x0000000000000000000000000000000000000000000000000000000000000000"', async () => {
+    const requests = [{ method }, { method }];
+    const mockResults = [
+      {
+        blockHash:
+          '0x0000000000000000000000000000000000000000000000000000000000000000',
+        extra: 'some value',
+      },
+      { blockHash: '0x100', extra: 'some other value' },
+    ];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+      });
+      comms.mockRpcCall({
+        request: requests[1],
+        response: { result: mockResults[1] },
+      });
+
+      const results = await withNetworkClient(
+        { providerType },
+        ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+      );
+
+      expect(results).toStrictEqual(mockResults);
+    });
+  });
+
+  for (const emptyValue of [null, '\u003cnil\u003e']) {
+    it(`does not retry an empty response of "${emptyValue}"`, async () => {
+      const request = { method };
+      const mockResult = emptyValue;
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request,
+          response: { result: mockResult },
+        });
+
+        const result = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCall }) => makeRpcCall(request),
+        );
+
+        expect(result).toStrictEqual(mockResult);
+      });
+    });
+
+    it(`does not reuse the result of a previous request if it was "${emptyValue}"`, async () => {
+      const requests = [{ method }, { method }];
+      const mockResults = [emptyValue, { blockHash: '0x100' }];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+        comms.mockRpcCall({
+          request: requests[1],
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual(mockResults);
+      });
+    });
+  }
+
+  for (const paramIndex of [...Array(numberOfParameters).keys()]) {
+    it(`does not reuse the result of a previous request with a valid blockHash if parameter at index "${paramIndex}" differs`, async () => {
+      const firstMockParams = [
+        ...new Array(numberOfParameters).fill('some value'),
+      ];
+      const secondMockParams = firstMockParams.slice();
+      secondMockParams[paramIndex] = 'another value';
+      const requests = [
+        {
+          method,
+          params: firstMockParams,
+        },
+        { method, params: secondMockParams },
+      ];
+      const mockResults = [{ blockHash: '0x100' }, { blockHash: '0x200' }];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+        comms.mockRpcCall({
+          request: requests[1],
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual([mockResults[0], mockResults[1]]);
+      });
+    });
+  }
+
+  it('does not discard an error in a non-standard JSON-RPC error response, but throws it', async () => {
+    const request = { method, params: [] };
+    const error = {
+      code: -32000,
+      data: {
+        foo: 'bar',
+      },
+      message: 'VM Exception while processing transaction: revert',
+      name: 'RuntimeError',
+      stack:
+        'RuntimeError: VM Exception while processing transaction: revert at exactimate (/Users/elliot/code/metamask/metamask-mobile/node_modules/ganache/dist/node/webpack:/Ganache/ethereum/ethereum/lib/src/helpers/gas-estimator.js:257:23)',
+    };
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request,
+        response: {
+          error,
+        },
+      });
+
+      const promise = withNetworkClient(
+        { providerType },
+        async ({ provider }) => {
+          return await provider.request(request);
+        },
+      );
+
+      if (providerType === NetworkClientType.Infura) {
+        // This is not ideal, but we can refactor this later.
+        // eslint-disable-next-line jest/no-conditional-expect
+        await expect(promise).rejects.toThrow(
+          rpcErrors.internal({
+            message: error.message,
+            data: { cause: error },
+          }),
+        );
+      } else {
+        // This is not ideal, but we can refactor this later.
+        // eslint-disable-next-line jest/no-conditional-expect
+        await expect(promise).rejects.toThrow(
+          rpcErrors.internal({ data: error }),
+        );
+      }
+    });
+  });
+
+  describe.each([
+    [401, CUSTOM_RPC_ERRORS.unauthorized],
+    [402, errorCodes.rpc.resourceUnavailable],
+    [404, errorCodes.rpc.resourceUnavailable],
+    [422, CUSTOM_RPC_ERRORS.httpClientError],
+    [429, errorCodes.rpc.limitExceeded],
+  ])(
+    'if the RPC endpoint returns a %d response',
+    (httpStatus, rpcErrorCode) => {
+      const expectedError = expect.objectContaining({
+        code: rpcErrorCode,
+      });
+
+      it('throws a custom error without retrying the request', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            response: {
+              httpStatus,
+            },
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall }) => makeRpcCall(request),
+          );
+
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+
+      // NOTE: We do not test the RPC failover behavior here because only 5xx
+      // errors break the circuit and cause a failover.
+    },
+  );
+
+  describe.each([500, 501, 505, 506, 507, 508, 510, 511])(
+    'if the RPC endpoint returns a %d response',
+    (httpStatus) => {
+      const expectedError = expect.objectContaining({
+        code: errorCodes.rpc.resourceUnavailable,
+      });
+
+      it('throws a custom error without retrying the request', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            response: {
+              httpStatus,
+            },
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall }) => makeRpcCall(request),
+          );
+
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: [],
+        },
+        getRequestToMock: () => ({
+          method,
+          params: [],
+        }),
+        failure: {
+          httpStatus,
+        },
+        isRetriableFailure: false,
+        getExpectedError: () => expectedError,
+        getExpectedBreakError: () =>
+          expect.objectContaining({
+            message: `Fetch failed with status '${httpStatus}'`,
+          }),
+      });
+    },
+  );
+
+  describe.each([502, 503, 504])(
+    'if the RPC endpoint returns a %d response',
+    (httpStatus) => {
+      const expectedError = expect.objectContaining({
+        code: errorCodes.rpc.resourceUnavailable,
+      });
+
+      it('retries the request up to 5 times until there is a 200 response', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          // Here we have the request fail for the first 4 tries, then succeed
+          // on the 5th try.
+          comms.mockRpcCall({
+            request,
+            response: {
+              error: 'Some error',
+              httpStatus,
+            },
+            times: 4,
+          });
+          comms.mockRpcCall({
+            request,
+            response: {
+              result: 'the result',
+              httpStatus: 200,
+            },
+          });
+          const result = await withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          expect(result).toBe('the result');
+        });
+      });
+
+      it(`throws a custom error if the response continues to be ${httpStatus} after 5 retries`, async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            response: {
+              error: 'Some error',
+              httpStatus,
+            },
+            times: 5,
+          });
+          comms.mockNextBlockTrackerRequest();
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: [],
+        },
+        getRequestToMock: () => ({
+          method,
+          params: [],
+        }),
+        failure: {
+          httpStatus,
+        },
+        isRetriableFailure: true,
+        getExpectedError: () => expectedError,
+        getExpectedBreakError: () =>
+          expect.objectContaining({
+            message: expect.stringContaining(
+              `Fetch failed with status '${httpStatus}'`,
+            ),
+          }),
+      });
+    },
+  );
+
+  describe.each(['ETIMEDOUT', 'ECONNRESET'])(
+    'if a %s error is thrown while making the request',
+    (errorCode) => {
+      const error = new Error(errorCode);
+      // @ts-expect-error `code` does not exist on the Error type, but is
+      // still used by Node.
+      error.code = errorCode;
+
+      it('retries the request up to 5 times until it is successful', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          // Here we have the request fail for the first 4 tries, then succeed
+          // on the 5th try.
+          comms.mockRpcCall({
+            request,
+            error,
+            times: 4,
+          });
+          comms.mockRpcCall({
+            request,
+            response: {
+              result: 'the result',
+              httpStatus: 200,
+            },
+          });
+
+          const result = await withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          expect(result).toBe('the result');
+        });
+      });
+
+      it('re-throws the error if it persists after 5 retries', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            error,
+            times: 5,
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          await expect(promiseForResult).rejects.toThrow(error.message);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: [],
+        },
+        getRequestToMock: () => ({
+          method,
+          params: [],
+        }),
+        failure: error,
+        isRetriableFailure: true,
+        getExpectedError: (url: string) =>
+          expect.objectContaining({
+            message: `request to ${url} failed, reason: ${errorCode}`,
+          }),
+      });
+    },
+  );
+
+  describe('if the RPC endpoint responds with invalid JSON', () => {
+    const expectedError = expect.objectContaining({
+      code: errorCodes.rpc.parse,
+    });
+
+    it('retries the request up to 5 times until it responds with valid JSON', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        // Here we have the request fail for the first 4 tries, then succeed
+        // on the 5th try.
+        comms.mockRpcCall({
+          request,
+          response: {
+            body: 'invalid JSON',
+          },
+          times: 4,
+        });
+        comms.mockRpcCall({
+          request,
+          response: {
+            result: 'the result',
+            httpStatus: 200,
+          },
+        });
+
+        const result = await withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        expect(result).toBe('the result');
+      });
+    });
+
+    it('throws a custom error if the result is still non-JSON-parseable after 5 retries', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request,
+          response: {
+            body: 'invalid JSON',
+          },
+          times: 5,
+        });
+        const promiseForResult = withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        await expect(promiseForResult).rejects.toThrow(expectedError);
+      });
+    });
+
+    testsForRpcFailoverBehavior({
+      providerType,
+      requestToCall: {
+        method,
+        params: [],
+      },
+      getRequestToMock: () => ({
+        method,
+        params: [],
+      }),
+      failure: {
+        body: 'invalid JSON',
+      },
+      isRetriableFailure: true,
+      getExpectedError: () => expectedError,
+      getExpectedBreakError: () =>
+        expect.objectContaining({
+          message: expect.stringContaining('invalid json'),
+        }),
+    });
+  });
+
+  describe('if making the request throws a connection error', () => {
+    const error = new TypeError('Failed to fetch');
+
+    it('retries the request up to 5 times until there is no connection error', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        // Here we have the request fail for the first 4 tries, then succeed
+        // on the 5th try.
+        comms.mockRpcCall({
+          request,
+          error,
+          times: 4,
+        });
+        comms.mockRpcCall({
+          request,
+          response: {
+            result: 'the result',
+            httpStatus: 200,
+          },
+        });
+
+        const result = await withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        expect(result).toBe('the result');
+      });
+    });
+
+    it('re-throws the error if it persists after 5 retries', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request,
+          error,
+          times: 5,
+        });
+        const promiseForResult = withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        await expect(promiseForResult).rejects.toThrow(error.message);
+      });
+    });
+
+    testsForRpcFailoverBehavior({
+      providerType,
+      requestToCall: {
+        method,
+        params: [],
+      },
+      getRequestToMock: () => ({
+        method,
+        params: [],
+      }),
+      failure: error,
+      isRetriableFailure: true,
+      getExpectedError: (url: string) =>
+        expect.objectContaining({
+          message: `request to ${url} failed, reason: ${error.message}`,
+        }),
+    });
+  });
+}
diff --git a/tests/network-client/block-param.ts b/tests/network-client/block-param.ts
new file mode 100644
index 0000000000000000000000000000000000000000..f2e1cd268c353db166f5b2d7cd34150ea73f51f3
--- /dev/null
+++ b/tests/network-client/block-param.ts
@@ -0,0 +1,1668 @@
+import { errorCodes, rpcErrors } from '@metamask/rpc-errors';
+import type { Hex } from '@metamask/utils';
+
+import type { MockRequest, ProviderType } from './helpers';
+import {
+  buildMockParams,
+  buildRequestWithReplacedBlockParam,
+  waitForPromiseToBeFulfilledAfterRunningAllTimers,
+  withMockedCommunications,
+  withNetworkClient,
+} from './helpers';
+import { testsForRpcFailoverBehavior } from './rpc-failover';
+import { CUSTOM_RPC_ERRORS } from '../../src/rpc-service/rpc-service';
+import { NetworkClientType } from '../../src/types';
+
+type TestsForRpcMethodSupportingBlockParam = {
+  providerType: ProviderType;
+  blockParamIndex: number;
+  numberOfParameters: number;
+};
+
+/**
+ * Defines tests which exercise the behavior exhibited by an RPC method that
+ * takes a block parameter. The value of this parameter can be either a block
+ * number or a block tag ("latest", "earliest", or "pending") and affects how
+ * the method is cached.
+ *
+ * @param method - The name of the RPC method under test.
+ * @param additionalArgs - Additional arguments.
+ * @param additionalArgs.blockParamIndex - The index of the block parameter.
+ * @param additionalArgs.numberOfParameters - The number of parameters
+ * supported by the method under test.
+ * @param additionalArgs.providerType - The type of provider being tested.
+ * either `infura` or `custom`.
+ */
+export function testsForRpcMethodSupportingBlockParam(
+  method: string,
+  {
+    blockParamIndex,
+    numberOfParameters,
+    providerType,
+  }: TestsForRpcMethodSupportingBlockParam,
+): void {
+  describe.each([
+    ['given no block tag', undefined],
+    ['given a block tag of "latest"', 'latest'],
+  ])('%s', (_desc, blockParam) => {
+    it('does not hit the RPC endpoint more than once for identical requests', async () => {
+      const requests = [
+        {
+          method,
+          params: buildMockParams({ blockParamIndex, blockParam }),
+        },
+        { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+      ];
+      const mockResults = ['first result', 'second result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the block-cache
+        // middleware will request the latest block number through the block
+        // tracker to determine the cache key. Later, the block-ref
+        // middleware will request the latest block number again to resolve
+        // the value of "latest", but the block number is cached once made,
+        // so we only need to mock the request once.
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+        // The block-ref middleware will make the request as specified
+        // except that the block param is replaced with the latest block
+        // number.
+        comms.mockRpcCall({
+          request: buildRequestWithReplacedBlockParam(
+            requests[0],
+            blockParamIndex,
+            '0x100',
+          ),
+          response: { result: mockResults[0] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual([mockResults[0], mockResults[0]]);
+      });
+    });
+
+    for (const paramIndex of [...Array(numberOfParameters).keys()]) {
+      if (paramIndex === blockParamIndex) {
+        // testing changes in block param is covered under later tests
+        continue;
+      }
+      it(`does not reuse the result of a previous request if parameter at index "${paramIndex}" differs`, async () => {
+        const firstMockParams = [
+          ...new Array(numberOfParameters).fill('some value'),
+        ];
+        firstMockParams[blockParamIndex] = blockParam;
+        const secondMockParams = firstMockParams.slice();
+        secondMockParams[paramIndex] = 'another value';
+        const requests = [
+          {
+            method,
+            params: firstMockParams,
+          },
+          { method, params: secondMockParams },
+        ];
+        const mockResults = ['first result', 'second result'];
+
+        await withMockedCommunications({ providerType }, async (comms) => {
+          // The first time a block-cacheable request is made, the block-cache
+          // middleware will request the latest block number through the block
+          // tracker to determine the cache key. Later, the block-ref
+          // middleware will request the latest block number again to resolve
+          // the value of "latest", but the block number is cached once made,
+          // so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              requests[0],
+              blockParamIndex,
+              '0x100',
+            ),
+            response: { result: mockResults[0] },
+          });
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              requests[1],
+              blockParamIndex,
+              '0x100',
+            ),
+            response: { result: mockResults[1] },
+          });
+
+          const results = await withNetworkClient(
+            { providerType },
+            ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+          );
+
+          expect(results).toStrictEqual([mockResults[0], mockResults[1]]);
+        });
+      });
+    }
+
+    it('hits the RPC endpoint and does not reuse the result of a previous request if the latest block number was updated since', async () => {
+      const pollingInterval = 1234;
+      const requests = [
+        { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+        { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+      ];
+      const mockResults = ['first result', 'second result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+        // The block-ref middleware will make the request as specified
+        // except that the block param is replaced with the latest block
+        // number.
+        comms.mockRpcCall({
+          request: buildRequestWithReplacedBlockParam(
+            requests[0],
+            blockParamIndex,
+            '0x100',
+          ),
+          response: { result: mockResults[0] },
+        });
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x200' });
+        comms.mockRpcCall({
+          request: buildRequestWithReplacedBlockParam(
+            requests[1],
+            blockParamIndex,
+            '0x200',
+          ),
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          {
+            providerType,
+            getBlockTrackerOptions: () => ({
+              pollingInterval,
+            }),
+          },
+          async ({ blockTracker, makeRpcCall, clock }) => {
+            const waitForTwoBlocks = new Promise<void>((resolve) => {
+              let numberOfBlocks = 0;
+
+              // Start the block tracker
+              blockTracker.on('latest', () => {
+                numberOfBlocks += 1;
+                if (numberOfBlocks === 2) {
+                  resolve();
+                }
+              });
+            });
+
+            const firstResult = await makeRpcCall(requests[0]);
+            // Proceed to the next iteration of the block tracker so that a new
+            // block is fetched and the current block is updated.
+            await clock.tickAsync(pollingInterval);
+            await waitForTwoBlocks;
+            const secondResult = await makeRpcCall(requests[1]);
+            return [firstResult, secondResult];
+          },
+        );
+
+        expect(results).toStrictEqual(mockResults);
+      });
+    });
+
+    for (const emptyValue of [null, '\u003cnil\u003e']) {
+      it(`does not retry an empty response of "${emptyValue}"`, async () => {
+        const request = {
+          method,
+          params: buildMockParams({ blockParamIndex, blockParam }),
+        };
+        const mockResult = emptyValue;
+
+        await withMockedCommunications({ providerType }, async (comms) => {
+          // The first time a block-cacheable request is made, the
+          // block-cache middleware will request the latest block number
+          // through the block tracker to determine the cache key. Later,
+          // the block-ref middleware will request the latest block number
+          // again to resolve the value of "latest", but the block number is
+          // cached once made, so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            response: { result: mockResult },
+          });
+
+          const result = await withNetworkClient(
+            { providerType },
+            ({ makeRpcCall }) => makeRpcCall(request),
+          );
+
+          expect(result).toStrictEqual(mockResult);
+        });
+      });
+
+      it(`does not reuse the result of a previous request if it was "${emptyValue}"`, async () => {
+        const requests = [
+          { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+          { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+        ];
+        const mockResults = [emptyValue, 'some result'];
+
+        await withMockedCommunications({ providerType }, async (comms) => {
+          // The first time a block-cacheable request is made, the
+          // block-cache middleware will request the latest block number
+          // through the block tracker to determine the cache key. Later,
+          // the block-ref middleware will request the latest block number
+          // again to resolve the value of "latest", but the block number is
+          // cached once made, so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              requests[0],
+              blockParamIndex,
+              '0x100',
+            ),
+            response: { result: mockResults[0] },
+          });
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              requests[1],
+              blockParamIndex,
+              '0x100',
+            ),
+            response: { result: mockResults[1] },
+          });
+
+          const results = await withNetworkClient(
+            { providerType },
+            ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+          );
+
+          expect(results).toStrictEqual(mockResults);
+        });
+      });
+    }
+
+    it('queues requests while a previous identical call is still pending, then runs the queue when it finishes, reusing the result from the first request', async () => {
+      const requests = [
+        { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+        { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+        { method, params: buildMockParams({ blockParamIndex, blockParam }) },
+      ];
+      const mockResults = ['first result', 'second result', 'third result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the
+        // block-cache middleware will request the latest block number
+        // through the block tracker to determine the cache key. Later,
+        // the block-ref middleware will request the latest block number
+        // again to resolve the value of "latest", but the block number is
+        // cached once made, so we only need to mock the request once.
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+        // The block-ref middleware will make the request as specified
+        // except that the block param is replaced with the latest block
+        // number, and we delay it.
+        comms.mockRpcCall({
+          delay: 100,
+          request: buildRequestWithReplacedBlockParam(
+            requests[0],
+            blockParamIndex,
+            '0x100',
+          ),
+          response: { result: mockResults[0] },
+        });
+        // The previous two requests will happen again, in the same order.
+        comms.mockRpcCall({
+          request: buildRequestWithReplacedBlockParam(
+            requests[1],
+            blockParamIndex,
+            '0x100',
+          ),
+          response: { result: mockResults[1] },
+        });
+        comms.mockRpcCall({
+          request: buildRequestWithReplacedBlockParam(
+            requests[2],
+            blockParamIndex,
+            '0x100',
+          ),
+          response: { result: mockResults[2] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          async (client) => {
+            const resultPromises = [
+              client.makeRpcCall(requests[0]),
+              client.makeRpcCall(requests[1]),
+              client.makeRpcCall(requests[2]),
+            ];
+            const firstResult = await resultPromises[0];
+            // The inflight cache middleware uses setTimeout to run the
+            // handlers, so run them now
+            client.clock.runAll();
+            const remainingResults = await Promise.all(resultPromises.slice(1));
+            return [firstResult, ...remainingResults];
+          },
+        );
+
+        expect(results).toStrictEqual([
+          mockResults[0],
+          mockResults[0],
+          mockResults[0],
+        ]);
+      });
+    });
+
+    it('does not discard an error in a non-standard JSON-RPC error response, but throws it', async () => {
+      const request = {
+        method,
+        params: buildMockParams({ blockParamIndex, blockParam }),
+      };
+      const error = {
+        code: -32000,
+        data: {
+          foo: 'bar',
+        },
+        message: 'VM Exception while processing transaction: revert',
+        name: 'RuntimeError',
+        stack:
+          'RuntimeError: VM Exception while processing transaction: revert at exactimate (/Users/elliot/code/metamask/metamask-mobile/node_modules/ganache/dist/node/webpack:/Ganache/ethereum/ethereum/lib/src/helpers/gas-estimator.js:257:23)',
+      };
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the
+        // block-cache middleware will request the latest block number
+        // through the block tracker to determine the cache key. Later,
+        // the block-ref middleware will request the latest block number
+        // again to resolve the value of "latest", but the block number is
+        // cached once made, so we only need to mock the request once.
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+        comms.mockRpcCall({
+          request: buildRequestWithReplacedBlockParam(
+            request,
+            blockParamIndex,
+            '0x100',
+          ),
+          response: {
+            error,
+          },
+        });
+
+        const promise = withNetworkClient(
+          { providerType },
+          async ({ provider }) => {
+            return await provider.request(request);
+          },
+        );
+
+        if (providerType === NetworkClientType.Infura) {
+          // This is not ideal, but we can refactor this later.
+          // eslint-disable-next-line jest/no-conditional-expect
+          await expect(promise).rejects.toThrow(
+            rpcErrors.internal({
+              message: error.message,
+              data: { cause: error },
+            }),
+          );
+        } else {
+          // This is not ideal, but we can refactor this later.
+          // eslint-disable-next-line jest/no-conditional-expect
+          await expect(promise).rejects.toThrow(
+            rpcErrors.internal({ data: error }),
+          );
+        }
+      });
+    });
+
+    describe.each([
+      [401, CUSTOM_RPC_ERRORS.unauthorized],
+      [402, errorCodes.rpc.resourceUnavailable],
+      [404, errorCodes.rpc.resourceUnavailable],
+      [422, CUSTOM_RPC_ERRORS.httpClientError],
+      [429, errorCodes.rpc.limitExceeded],
+    ])(
+      'if the RPC endpoint returns a %d response',
+      (httpStatus, rpcErrorCode) => {
+        const expectedError = expect.objectContaining({
+          code: rpcErrorCode,
+        });
+
+        it('throws a custom error without retrying the request', async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              params: buildMockParams({ blockParam, blockParamIndex }),
+            };
+
+            // The first time a block-cacheable request is made, the
+            // block-cache middleware will request the latest block number
+            // through the block tracker to determine the cache key. Later,
+            // the block-ref middleware will request the latest block number
+            // again to resolve the value of "latest", but the block number is
+            // cached once made, so we only need to mock the request once.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+            // The block-ref middleware will make the request as specified
+            // except that the block param is replaced with the latest block
+            // number.
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              response: {
+                httpStatus,
+              },
+            });
+            const promiseForResult = withNetworkClient(
+              { providerType },
+              async ({ makeRpcCall }) => makeRpcCall(request),
+            );
+
+            await expect(promiseForResult).rejects.toThrow(expectedError);
+          });
+        });
+
+        // NOTE: We do not test the RPC failover behavior here because only 5xx
+        // errors break the circuit and cause a failover.
+      },
+    );
+
+    describe.each([500, 501, 505, 506, 507, 508, 510, 511])(
+      'if the RPC endpoint returns a %d response',
+      (httpStatus) => {
+        const expectedError = expect.objectContaining({
+          code: errorCodes.rpc.resourceUnavailable,
+        });
+
+        it('throws a generic, undescriptive error', async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              params: buildMockParams({ blockParam, blockParamIndex }),
+            };
+
+            // The first time a block-cacheable request is made, the
+            // block-cache middleware will request the latest block number
+            // through the block tracker to determine the cache key. Later,
+            // the block-ref middleware will request the latest block number
+            // again to resolve the value of "latest", but the block number is
+            // cached once made, so we only need to mock the request once.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+            // The block-ref middleware will make the request as specified
+            // except that the block param is replaced with the latest block
+            // number.
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              response: {
+                httpStatus,
+              },
+            });
+            const promiseForResult = withNetworkClient(
+              { providerType },
+              async ({ makeRpcCall }) => makeRpcCall(request),
+            );
+
+            await expect(promiseForResult).rejects.toThrow(expectedError);
+          });
+        });
+
+        testsForRpcFailoverBehavior({
+          providerType,
+          requestToCall: {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          },
+          getRequestToMock: (request: MockRequest, blockNumber: Hex) => {
+            return buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              blockNumber,
+            );
+          },
+          failure: {
+            httpStatus,
+          },
+          isRetriableFailure: false,
+          getExpectedError: () => expectedError,
+          getExpectedBreakError: () =>
+            expect.objectContaining({
+              message: `Fetch failed with status '${httpStatus}'`,
+            }),
+        });
+      },
+    );
+
+    describe.each([502, 503, 504])(
+      'if the RPC endpoint returns a %d response',
+      (httpStatus) => {
+        const expectedError = expect.objectContaining({
+          code: errorCodes.rpc.resourceUnavailable,
+        });
+
+        it('retries the request up to 5 times until there is a 200 response', async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              params: buildMockParams({ blockParam, blockParamIndex }),
+            };
+
+            // The first time a block-cacheable request is made, the
+            // block-cache middleware will request the latest block number
+            // through the block tracker to determine the cache key. Later,
+            // the block-ref middleware will request the latest block number
+            // again to resolve the value of "latest", but the block number is
+            // cached once made, so we only need to mock the request once.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+            // The block-ref middleware will make the request as specified
+            // except that the block param is replaced with the latest block
+            // number.
+            //
+            // Here we have the request fail for the first 4 tries, then succeed
+            // on the 5th try.
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              response: {
+                error: 'some error',
+                httpStatus,
+              },
+              times: 4,
+            });
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              response: {
+                result: 'the result',
+                httpStatus: 200,
+              },
+            });
+            const result = await withNetworkClient(
+              { providerType },
+              async ({ makeRpcCall, clock }) => {
+                return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                  makeRpcCall(request),
+                  clock,
+                );
+              },
+            );
+
+            expect(result).toBe('the result');
+          });
+        });
+
+        it(`throws a custom error if the response continues to be ${httpStatus} after 5 retries`, async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              params: buildMockParams({ blockParam, blockParamIndex }),
+            };
+
+            // The first time a block-cacheable request is made, the
+            // block-cache middleware will request the latest block number
+            // through the block tracker to determine the cache key. Later,
+            // the block-ref middleware will request the latest block number
+            // again to resolve the value of "latest", but the block number is
+            // cached once made, so we only need to mock the request once.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+            // The block-ref middleware will make the request as specified
+            // except that the block param is replaced with the latest block
+            // number.
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              response: {
+                error: 'Some error',
+                httpStatus,
+              },
+              times: 5,
+            });
+            const promiseForResult = withNetworkClient(
+              { providerType },
+              async ({ makeRpcCall, clock }) => {
+                return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                  makeRpcCall(request),
+                  clock,
+                );
+              },
+            );
+            await expect(promiseForResult).rejects.toThrow(expectedError);
+          });
+        });
+
+        testsForRpcFailoverBehavior({
+          providerType,
+          requestToCall: {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          },
+          getRequestToMock: (request: MockRequest, blockNumber: Hex) => {
+            return buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              blockNumber,
+            );
+          },
+          failure: {
+            httpStatus,
+          },
+          isRetriableFailure: true,
+          getExpectedError: () => expectedError,
+          getExpectedBreakError: () =>
+            expect.objectContaining({
+              message: expect.stringContaining(
+                `Fetch failed with status '${httpStatus}'`,
+              ),
+            }),
+        });
+      },
+    );
+
+    describe.each(['ETIMEDOUT', 'ECONNRESET'])(
+      'if a %s error is thrown while making the request',
+      (errorCode) => {
+        const error = new Error(errorCode);
+        // @ts-expect-error `code` does not exist on the Error type, but is
+        // still used by Node.
+        error.code = errorCode;
+
+        it('retries the request up to 5 times until it is successful', async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              params: buildMockParams({ blockParam, blockParamIndex }),
+            };
+
+            // The first time a block-cacheable request is made, the
+            // block-cache middleware will request the latest block number
+            // through the block tracker to determine the cache key. Later,
+            // the block-ref middleware will request the latest block number
+            // again to resolve the value of "latest", but the block number is
+            // cached once made, so we only need to mock the request once.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+            // The block-ref middleware will make the request as specified
+            // except that the block param is replaced with the latest block
+            // number.
+            //
+            // Here we have the request fail for the first 4 tries, then
+            // succeed on the 5th try.
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              error,
+              times: 4,
+            });
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              response: {
+                result: 'the result',
+                httpStatus: 200,
+              },
+            });
+
+            const result = await withNetworkClient(
+              { providerType },
+              async ({ makeRpcCall, clock }) => {
+                return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                  makeRpcCall(request),
+                  clock,
+                );
+              },
+            );
+
+            expect(result).toBe('the result');
+          });
+        });
+
+        it('re-throws the error if it persists after 5 retries', async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              params: buildMockParams({ blockParam, blockParamIndex }),
+            };
+
+            // The first time a block-cacheable request is made, the
+            // block-cache middleware will request the latest block number
+            // through the block tracker to determine the cache key. Later,
+            // the block-ref middleware will request the latest block number
+            // again to resolve the value of "latest", but the block number is
+            // cached once made, so we only need to mock the request once.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+            // The block-ref middleware will make the request as specified
+            // except that the block param is replaced with the latest block
+            // number.
+            comms.mockRpcCall({
+              request: buildRequestWithReplacedBlockParam(
+                request,
+                blockParamIndex,
+                '0x100',
+              ),
+              error,
+              times: 5,
+            });
+
+            const promiseForResult = withNetworkClient(
+              { providerType },
+              async ({ makeRpcCall, clock }) => {
+                return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                  makeRpcCall(request),
+                  clock,
+                );
+              },
+            );
+
+            await expect(promiseForResult).rejects.toThrow(error.message);
+          });
+        });
+
+        testsForRpcFailoverBehavior({
+          providerType,
+          requestToCall: {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          },
+          getRequestToMock: (request: MockRequest, blockNumber: Hex) => {
+            return buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              blockNumber,
+            );
+          },
+          failure: error,
+          isRetriableFailure: true,
+          getExpectedError: (url: string) =>
+            expect.objectContaining({
+              message: `request to ${url} failed, reason: ${errorCode}`,
+            }),
+        });
+      },
+    );
+
+    describe('if the RPC endpoint responds with invalid JSON', () => {
+      const expectedError = expect.objectContaining({
+        code: errorCodes.rpc.parse,
+      });
+
+      it('retries the request up to 5 times until it responds with valid JSON', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          };
+
+          // The first time a block-cacheable request is made, the
+          // block-cache middleware will request the latest block number
+          // through the block tracker to determine the cache key. Later,
+          // the block-ref middleware will request the latest block number
+          // again to resolve the value of "latest", but the block number is
+          // cached once made, so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          //
+          // Here we have the request fail for the first 4 tries, then
+          // succeed on the 5th try.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            response: {
+              body: 'invalid JSON',
+            },
+            times: 4,
+          });
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            response: {
+              result: 'the result',
+              httpStatus: 200,
+            },
+          });
+          const result = await withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          expect(result).toBe('the result');
+        });
+      });
+
+      it('throws a custom error if the result is still non-JSON-parseable after 5 retries', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          };
+
+          // The first time a block-cacheable request is made, the
+          // block-cache middleware will request the latest block number
+          // through the block tracker to determine the cache key. Later,
+          // the block-ref middleware will request the latest block number
+          // again to resolve the value of "latest", but the block number is
+          // cached once made, so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            response: {
+              body: 'invalid JSON',
+            },
+            times: 5,
+          });
+
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: buildMockParams({ blockParam, blockParamIndex }),
+        },
+        getRequestToMock: (request: MockRequest, blockNumber: Hex) => {
+          return buildRequestWithReplacedBlockParam(
+            request,
+            blockParamIndex,
+            blockNumber,
+          );
+        },
+        failure: {
+          body: 'invalid JSON',
+        },
+        isRetriableFailure: true,
+        getExpectedError: () => expectedError,
+        getExpectedBreakError: () =>
+          expect.objectContaining({
+            message: expect.stringContaining('invalid json'),
+          }),
+      });
+    });
+
+    describe('if making the request throws a connection error', () => {
+      const error = new TypeError('Failed to fetch');
+
+      it('retries the request up to 5 times until there is no connection error', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          };
+
+          // The first time a block-cacheable request is made, the
+          // block-cache middleware will request the latest block number
+          // through the block tracker to determine the cache key. Later,
+          // the block-ref middleware will request the latest block number
+          // again to resolve the value of "latest", but the block number is
+          // cached once made, so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          //
+          // Here we have the request fail for the first 4 tries, then
+          // succeed on the 5th try.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            error,
+            times: 4,
+          });
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            response: {
+              result: 'the result',
+              httpStatus: 200,
+            },
+          });
+
+          const result = await withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          expect(result).toBe('the result');
+        });
+      });
+
+      it('re-throws the error if it persists after 5 retries', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = {
+            method,
+            params: buildMockParams({ blockParam, blockParamIndex }),
+          };
+
+          // The first time a block-cacheable request is made, the
+          // block-cache middleware will request the latest block number
+          // through the block tracker to determine the cache key. Later,
+          // the block-ref middleware will request the latest block number
+          // again to resolve the value of "latest", but the block number is
+          // cached once made, so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          comms.mockRpcCall({
+            request: buildRequestWithReplacedBlockParam(
+              request,
+              blockParamIndex,
+              '0x100',
+            ),
+            error,
+            times: 5,
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          await expect(promiseForResult).rejects.toThrow(error.message);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: buildMockParams({ blockParam, blockParamIndex }),
+        },
+        getRequestToMock: (request: MockRequest, blockNumber: Hex) => {
+          return buildRequestWithReplacedBlockParam(
+            request,
+            blockParamIndex,
+            blockNumber,
+          );
+        },
+        failure: error,
+        isRetriableFailure: true,
+        getExpectedError: (url: string) =>
+          expect.objectContaining({
+            message: `request to ${url} failed, reason: ${error.message}`,
+          }),
+      });
+    });
+  });
+
+  describe.each([
+    ['given a block tag of "earliest"', 'earliest', 'earliest'],
+    ['given a block number', 'block number', '0x100'],
+  ])('%s', (_desc, blockParamType, blockParam) => {
+    it('does not hit the RPC endpoint more than once for identical requests', async () => {
+      const requests = [
+        {
+          method,
+          params: buildMockParams({ blockParamIndex, blockParam }),
+        },
+        {
+          method,
+          params: buildMockParams({ blockParamIndex, blockParam }),
+        },
+      ];
+      const mockResults = ['first result', 'second result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the block-cache
+        // middleware will request the latest block number through the block
+        // tracker to determine the cache key. This block number doesn't
+        // matter.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual([mockResults[0], mockResults[0]]);
+      });
+    });
+
+    for (const paramIndex of [...Array(numberOfParameters).keys()]) {
+      if (paramIndex === blockParamIndex) {
+        // testing changes in block param is covered under later tests
+        continue;
+      }
+
+      it(`does not reuse the result of a previous request if parameter at index "${paramIndex}" differs`, async () => {
+        const firstMockParams = [
+          ...new Array(numberOfParameters).fill('some value'),
+        ];
+        firstMockParams[blockParamIndex] = blockParam;
+        const secondMockParams = firstMockParams.slice();
+        secondMockParams[paramIndex] = 'another value';
+        const requests = [
+          {
+            method,
+            params: firstMockParams,
+          },
+          { method, params: secondMockParams },
+        ];
+        const mockResults = ['first result', 'second result'];
+
+        await withMockedCommunications({ providerType }, async (comms) => {
+          // The first time a block-cacheable request is made, the block-cache
+          // middleware will request the latest block number through the block
+          // tracker to determine the cache key. Later, the block-ref
+          // middleware will request the latest block number again to resolve
+          // the value of "latest", but the block number is cached once made,
+          // so we only need to mock the request once.
+          comms.mockNextBlockTrackerRequest({ blockNumber: '0x100' });
+          // The block-ref middleware will make the request as specified
+          // except that the block param is replaced with the latest block
+          // number.
+          comms.mockRpcCall({
+            request: requests[0],
+            response: { result: mockResults[0] },
+          });
+          comms.mockRpcCall({
+            request: requests[1],
+            response: { result: mockResults[1] },
+          });
+
+          const results = await withNetworkClient(
+            { providerType },
+            ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+          );
+
+          expect(results).toStrictEqual([mockResults[0], mockResults[1]]);
+        });
+      });
+    }
+
+    it('reuses the result of a previous request even if the latest block number was updated since', async () => {
+      const requests = [
+        {
+          method,
+          params: buildMockParams({ blockParamIndex, blockParam }),
+        },
+        {
+          method,
+          params: buildMockParams({ blockParamIndex, blockParam }),
+        },
+      ];
+      const mockResults = ['first result', 'second result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // Note that we have to mock these requests in a specific order. The
+        // first block tracker request occurs because of the first RPC
+        // request. The second block tracker request, however, does not
+        // occur because of the second RPC request, but rather because we
+        // call `clock.runAll()` below.
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x1' });
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+        comms.mockNextBlockTrackerRequest({ blockNumber: '0x2' });
+        comms.mockRpcCall({
+          request: requests[1],
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          async (client) => {
+            const firstResult = await client.makeRpcCall(requests[0]);
+            // Proceed to the next iteration of the block tracker so that a
+            // new block is fetched and the current block is updated.
+            client.clock.runAll();
+            const secondResult = await client.makeRpcCall(requests[1]);
+            return [firstResult, secondResult];
+          },
+        );
+
+        expect(results).toStrictEqual([mockResults[0], mockResults[0]]);
+      });
+    });
+
+    if (blockParamType === 'earliest') {
+      it('treats "0x00" as a synonym for "earliest"', async () => {
+        const requests = [
+          {
+            method,
+            params: buildMockParams({ blockParamIndex, blockParam }),
+          },
+          {
+            method,
+            params: buildMockParams({ blockParamIndex, blockParam: '0x00' }),
+          },
+        ];
+        const mockResults = ['first result', 'second result'];
+
+        await withMockedCommunications({ providerType }, async (comms) => {
+          // The first time a block-cacheable request is made, the latest
+          // block number is retrieved through the block tracker first. It
+          // doesn't matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request: requests[0],
+            response: { result: mockResults[0] },
+          });
+
+          const results = await withNetworkClient(
+            { providerType },
+            ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+          );
+
+          expect(results).toStrictEqual([mockResults[0], mockResults[0]]);
+        });
+      });
+
+      for (const emptyValue of [null, '\u003cnil\u003e']) {
+        it(`does not retry an empty response of "${emptyValue}"`, async () => {
+          const request = {
+            method,
+            params: buildMockParams({ blockParamIndex, blockParam }),
+          };
+          const mockResult = emptyValue;
+
+          await withMockedCommunications({ providerType }, async (comms) => {
+            // The first time a block-cacheable request is made, the latest block
+            // number is retrieved through the block tracker first. It doesn't
+            // matter what this is â€” it's just used as a cache key.
+            comms.mockNextBlockTrackerRequest();
+            comms.mockRpcCall({
+              request,
+              response: { result: mockResult },
+            });
+
+            const result = await withNetworkClient(
+              { providerType },
+              ({ makeRpcCall }) => makeRpcCall(request),
+            );
+
+            expect(result).toStrictEqual(mockResult);
+          });
+        });
+
+        it(`does not reuse the result of a previous request if it was "${emptyValue}"`, async () => {
+          const requests = [
+            {
+              method,
+              params: buildMockParams({ blockParamIndex, blockParam }),
+            },
+            {
+              method,
+              params: buildMockParams({ blockParamIndex, blockParam }),
+            },
+          ];
+          const mockResults = [emptyValue, 'some result'];
+
+          await withMockedCommunications({ providerType }, async (comms) => {
+            // The first time a block-cacheable request is made, the latest block
+            // number is retrieved through the block tracker first. It doesn't
+            // matter what this is â€” it's just used as a cache key.
+            comms.mockNextBlockTrackerRequest();
+            comms.mockRpcCall({
+              request: requests[0],
+              response: { result: mockResults[0] },
+            });
+            comms.mockRpcCall({
+              request: requests[1],
+              response: { result: mockResults[1] },
+            });
+
+            const results = await withNetworkClient(
+              { providerType },
+              ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+            );
+
+            expect(results).toStrictEqual(mockResults);
+          });
+        });
+      }
+    }
+
+    if (blockParamType === 'block number') {
+      it('does not reuse the result of a previous request if it was made with different arguments than this one', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const requests = [
+            {
+              method,
+              params: buildMockParams({ blockParamIndex, blockParam: '0x100' }),
+            },
+            {
+              method,
+              params: buildMockParams({ blockParamIndex, blockParam: '0x200' }),
+            },
+          ];
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request: requests[0],
+            response: { result: 'first result' },
+          });
+          comms.mockRpcCall({
+            request: requests[1],
+            response: { result: 'second result' },
+          });
+
+          const results = await withNetworkClient(
+            { providerType },
+            ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+          );
+
+          expect(results).toStrictEqual(['first result', 'second result']);
+        });
+      });
+
+      for (const [nestedDesc, currentBlockNumber] of [
+        ['less than the current block number', '0x200'],
+        ['equal to the curent block number', '0x100'],
+      ]) {
+        describe(`${nestedDesc}`, () => {
+          it('makes an additional request to the RPC endpoint', async () => {
+            await withMockedCommunications({ providerType }, async (comms) => {
+              const request = {
+                method,
+                // Note that `blockParam` is `0x100` here
+                params: buildMockParams({ blockParamIndex, blockParam }),
+              };
+
+              // The first time a block-cacheable request is made, the latest
+              // block number is retrieved through the block tracker first.
+              comms.mockNextBlockTrackerRequest({
+                blockNumber: currentBlockNumber,
+              });
+              comms.mockRpcCall({
+                request,
+                response: { result: 'the result' },
+              });
+
+              const result = await withNetworkClient(
+                { providerType },
+                ({ makeRpcCall }) => makeRpcCall(request),
+              );
+
+              expect(result).toBe('the result');
+            });
+          });
+
+          for (const emptyValue of [null, '\u003cnil\u003e']) {
+            if (providerType === 'infura') {
+              it(`retries up to 10 times if a "${emptyValue}" response is returned, returning successful non-empty response if there is one on the 10th try`, async () => {
+                const request = {
+                  method,
+                  // Note that `blockParam` is `0x100` here
+                  params: buildMockParams({ blockParamIndex, blockParam }),
+                };
+
+                await withMockedCommunications(
+                  { providerType },
+                  async (comms) => {
+                    // The first time a block-cacheable request is made, the latest block
+                    // number is retrieved through the block tracker first.
+                    comms.mockNextBlockTrackerRequest({
+                      blockNumber: currentBlockNumber,
+                    });
+                    comms.mockRpcCall({
+                      request,
+                      response: { result: emptyValue },
+                      times: 9,
+                    });
+                    comms.mockRpcCall({
+                      request,
+                      response: { result: 'some value' },
+                    });
+
+                    const result = await withNetworkClient(
+                      { providerType },
+                      ({ makeRpcCall, clock }) =>
+                        waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                          makeRpcCall(request),
+                          clock,
+                        ),
+                    );
+
+                    expect(result).toBe('some value');
+                  },
+                );
+              });
+
+              it(`retries up to 10 times if a "${emptyValue}" response is returned, failing after the 10th try`, async () => {
+                const request = {
+                  method,
+                  // Note that `blockParam` is `0x100` here
+                  params: buildMockParams({ blockParamIndex, blockParam }),
+                };
+                const mockResult = emptyValue;
+
+                await withMockedCommunications(
+                  { providerType },
+                  async (comms) => {
+                    // The first time a block-cacheable request is made, the latest block
+                    // number is retrieved through the block tracker first.
+                    comms.mockNextBlockTrackerRequest({
+                      blockNumber: currentBlockNumber,
+                    });
+                    comms.mockRpcCall({
+                      request,
+                      response: { result: mockResult },
+                      times: 10,
+                    });
+
+                    const promiseForResult = withNetworkClient(
+                      { providerType },
+                      ({ makeRpcCall, clock }) =>
+                        waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                          makeRpcCall(request),
+                          clock,
+                        ),
+                    );
+
+                    await expect(promiseForResult).rejects.toThrow(
+                      'RetryOnEmptyMiddleware - retries exhausted',
+                    );
+                  },
+                );
+              });
+            } else {
+              it(`does not retry an empty response of "${emptyValue}"`, async () => {
+                const request = {
+                  method,
+                  // Note that `blockParam` is `0x100` here
+                  params: buildMockParams({ blockParamIndex, blockParam }),
+                };
+                const mockResult = emptyValue;
+
+                await withMockedCommunications(
+                  { providerType },
+                  async (comms) => {
+                    // The first time a block-cacheable request is made, the latest block
+                    // number is retrieved through the block tracker first.
+                    comms.mockNextBlockTrackerRequest({
+                      blockNumber: currentBlockNumber,
+                    });
+                    comms.mockRpcCall({
+                      request: buildRequestWithReplacedBlockParam(
+                        request,
+                        blockParamIndex,
+                        '0x100',
+                      ),
+                      response: { result: mockResult },
+                    });
+
+                    const result = await withNetworkClient(
+                      { providerType },
+                      ({ makeRpcCall }) => makeRpcCall(request),
+                    );
+
+                    expect(result).toStrictEqual(mockResult);
+                  },
+                );
+              });
+
+              it(`does not reuse the result of a previous request if it was "${emptyValue}"`, async () => {
+                const requests = [
+                  {
+                    method,
+                    // Note that `blockParam` is `0x100` here
+                    params: buildMockParams({ blockParamIndex, blockParam }),
+                  },
+                  {
+                    method,
+                    // Note that `blockParam` is `0x100` here
+                    params: buildMockParams({ blockParamIndex, blockParam }),
+                  },
+                ];
+                const mockResults = [emptyValue, { blockHash: '0x100' }];
+
+                await withMockedCommunications(
+                  { providerType },
+                  async (comms) => {
+                    // The first time a block-cacheable request is made, the latest block
+                    // number is retrieved through the block tracker first.
+                    comms.mockNextBlockTrackerRequest({
+                      blockNumber: currentBlockNumber,
+                    });
+                    comms.mockRpcCall({
+                      request: buildRequestWithReplacedBlockParam(
+                        requests[0],
+                        blockParamIndex,
+                        '0x100',
+                      ),
+                      response: { result: mockResults[0] },
+                    });
+                    comms.mockRpcCall({
+                      request: buildRequestWithReplacedBlockParam(
+                        requests[1],
+                        blockParamIndex,
+                        '0x100',
+                      ),
+                      response: { result: mockResults[1] },
+                    });
+
+                    const results = await withNetworkClient(
+                      { providerType },
+                      ({ makeRpcCallsInSeries }) =>
+                        makeRpcCallsInSeries(requests),
+                    );
+
+                    expect(results).toStrictEqual(mockResults);
+                  },
+                );
+              });
+            }
+          }
+        });
+      }
+
+      describe('greater than the current block number', () => {
+        it('makes an additional request to the RPC endpoint', async () => {
+          await withMockedCommunications({ providerType }, async (comms) => {
+            const request = {
+              method,
+              // Note that `blockParam` is `0x100` here
+              params: buildMockParams({ blockParamIndex, blockParam }),
+            };
+
+            // The first time a block-cacheable request is made, the latest
+            // block number is retrieved through the block tracker first.
+            comms.mockNextBlockTrackerRequest({ blockNumber: '0x42' });
+            comms.mockRpcCall({
+              request,
+              response: { result: 'the result' },
+            });
+
+            const result = await withNetworkClient(
+              { providerType },
+              ({ makeRpcCall }) => makeRpcCall(request),
+            );
+
+            expect(result).toBe('the result');
+          });
+        });
+
+        for (const emptyValue of [null, '\u003cnil\u003e']) {
+          it(`does not retry an empty response of "${emptyValue}"`, async () => {
+            const request = {
+              method,
+              // Note that `blockParam` is `0x100` here
+              params: buildMockParams({ blockParamIndex, blockParam }),
+            };
+            const mockResult = emptyValue;
+
+            await withMockedCommunications({ providerType }, async (comms) => {
+              // The first time a block-cacheable request is made, the latest block
+              // number is retrieved through the block tracker first.
+              comms.mockNextBlockTrackerRequest({ blockNumber: '0x42' });
+              comms.mockRpcCall({
+                request: buildRequestWithReplacedBlockParam(
+                  request,
+                  blockParamIndex,
+                  '0x100',
+                ),
+                response: { result: mockResult },
+              });
+
+              const result = await withNetworkClient(
+                { providerType },
+                ({ makeRpcCall }) => makeRpcCall(request),
+              );
+
+              expect(result).toStrictEqual(mockResult);
+            });
+          });
+
+          it(`does not reuse the result of a previous request if it was "${emptyValue}"`, async () => {
+            const requests = [
+              {
+                method,
+                // Note that `blockParam` is `0x100` here
+                params: buildMockParams({ blockParamIndex, blockParam }),
+              },
+              {
+                method,
+                // Note that `blockParam` is `0x100` here
+                params: buildMockParams({ blockParamIndex, blockParam }),
+              },
+            ];
+            const mockResults = [emptyValue, { blockHash: '0x100' }];
+
+            await withMockedCommunications({ providerType }, async (comms) => {
+              // The first time a block-cacheable request is made, the latest block
+              // number is retrieved through the block tracker first.
+              comms.mockNextBlockTrackerRequest({ blockNumber: '0x42' });
+              comms.mockRpcCall({
+                request: buildRequestWithReplacedBlockParam(
+                  requests[0],
+                  blockParamIndex,
+                  '0x100',
+                ),
+                response: { result: mockResults[0] },
+              });
+              comms.mockRpcCall({
+                request: buildRequestWithReplacedBlockParam(
+                  requests[1],
+                  blockParamIndex,
+                  '0x100',
+                ),
+                response: { result: mockResults[1] },
+              });
+
+              const results = await withNetworkClient(
+                { providerType },
+                ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+              );
+
+              expect(results).toStrictEqual(mockResults);
+            });
+          });
+        }
+      });
+    }
+  });
+
+  describe('given a block tag of "pending"', () => {
+    const params = buildMockParams({ blockParamIndex, blockParam: 'pending' });
+
+    it('hits the RPC endpoint on all calls and does not cache anything', async () => {
+      const requests = [
+        { method, params },
+        { method, params },
+      ];
+      const mockResults = ['first result', 'second result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest
+        // block number is retrieved through the block tracker first. It
+        // doesn't matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+        comms.mockRpcCall({
+          request: requests[1],
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual(mockResults);
+      });
+    });
+  });
+}
diff --git a/tests/network-client/helpers.ts b/tests/network-client/helpers.ts
new file mode 100644
index 0000000000000000000000000000000000000000..deaf9266e91755db0664356f36f554379115dff3
--- /dev/null
+++ b/tests/network-client/helpers.ts
@@ -0,0 +1,650 @@
+import type { JSONRPCResponse } from '@json-rpc-specification/meta-schema';
+import type { InfuraNetworkType } from '@metamask/controller-utils';
+import { BUILT_IN_NETWORKS } from '@metamask/controller-utils';
+import type {
+  BlockTracker,
+  PollingBlockTrackerOptions,
+} from '@metamask/eth-block-tracker';
+import EthQuery from '@metamask/eth-query';
+import type { Hex, Json, JsonRpcRequest } from '@metamask/utils';
+import nock, { isDone as nockIsDone } from 'nock';
+import type { Scope as NockScope } from 'nock';
+import { SinonFakeTimers, useFakeTimers } from 'sinon';
+
+import { createNetworkClient } from '../../src/create-network-client';
+import type {
+  NetworkClientId,
+  NetworkControllerOptions,
+} from '../../src/NetworkController';
+import type { RpcServiceOptions } from '../../src/rpc-service/rpc-service';
+import type { NetworkClientConfiguration, Provider } from '../../src/types';
+import { NetworkClientType } from '../../src/types';
+import type { RootMessenger } from '../helpers';
+import {
+  buildNetworkControllerMessenger,
+  buildRootMessenger,
+} from '../helpers';
+
+/**
+ * A dummy value for the `infuraProjectId` option that `createInfuraClient`
+ * needs. (Infura should not be hit during tests, but just in case, this should
+ * not refer to a real project ID.)
+ */
+const MOCK_INFURA_PROJECT_ID = 'abc123';
+
+/**
+ * A dummy value for the `rpcUrl` option that `createJsonRpcClient` needs. (This
+ * should not be hit during tests, but just in case, this should also not refer
+ * to a real Infura URL.)
+ */
+const MOCK_RPC_URL = 'http://foo.com/';
+
+/**
+ * A default value for the `eth_blockNumber` request that the block tracker
+ * makes.
+ */
+const DEFAULT_LATEST_BLOCK_NUMBER = '0x42';
+
+/**
+ * If you're having trouble writing a test and you're wondering why the test
+ * keeps failing, you can set `process.env.DEBUG_PROVIDER_TESTS` to `1`. This
+ * will turn on some extra logging.
+ *
+ * @param args - The arguments that `console.log` takes.
+ */
+function debug(...args: unknown[]): void {
+  /* eslint-disable-next-line n/no-process-env */
+  if (process.env.DEBUG_PROVIDER_TESTS === '1') {
+    console.log(...args);
+  }
+}
+
+/**
+ * Builds a Nock scope object for mocking provider requests.
+ *
+ * @param rpcUrl - The URL of the RPC endpoint.
+ * @param headers - Headers with which to mock the request.
+ * @returns The nock scope.
+ */
+function buildScopeForMockingRequests(
+  rpcUrl: string,
+  headers: Record<string, string>,
+): NockScope {
+  return nock(rpcUrl, { reqheaders: headers }).filteringRequestBody((body) => {
+    debug('Nock Received Request: ', body);
+    return body;
+  });
+}
+
+// TODO: Replace `any` with type
+// eslint-disable-next-line @typescript-eslint/no-explicit-any
+export type MockRequest = { method: string; params?: any[] };
+type Response = {
+  id?: number | string;
+  jsonrpc?: '2.0';
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  error?: any;
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  result?: any;
+  httpStatus?: number;
+};
+export type MockResponse =
+  | { body: JSONRPCResponse | string }
+  | Response
+  | (() => Response | Promise<Response>);
+type CurriedMockRpcCallOptions = {
+  request: MockRequest;
+  // The response data.
+  response?: MockResponse;
+  /**
+   * An error to throw while making the request.
+   * Takes precedence over `response`.
+   */
+  error?: Error | string;
+  /**
+   * The amount of time that should pass before the
+   * request resolves with the response.
+   */
+  delay?: number;
+  /**
+   * The number of times that the request is
+   * expected to be made.
+   */
+  times?: number;
+};
+
+type MockRpcCallOptions = {
+  // A nock scope (a set of mocked requests scoped to a certain base URL).
+  nockScope: nock.Scope;
+} & CurriedMockRpcCallOptions;
+
+type MockRpcCallResult = nock.Interceptor | nock.Scope;
+
+/**
+ * Mocks a JSON-RPC request sent to the provider with the given response.
+ * Provider type is inferred from the base url set on the nockScope.
+ *
+ * @param args - The arguments.
+ * @param args.nockScope - A nock scope (a set of mocked requests scoped to a
+ * certain base URL).
+ * @param args.request - The request data.
+ * @param args.response - Information concerning the response that the request
+ * should have. If a `body` property is present, this is taken as the complete
+ * response body. If an `httpStatus` property is present, then it is taken as
+ * the HTTP status code to respond with. Properties other than these two are
+ * used to build a complete response body (including `id` and `jsonrpc`
+ * properties).
+ * @param args.error - An error to throw while making the request. Takes
+ * precedence over `response`.
+ * @param args.delay - The amount of time that should pass before the request
+ * resolves with the response.
+ * @param args.times - The number of times that the request is expected to be
+ * made.
+ * @returns The nock scope.
+ */
+function mockRpcCall({
+  nockScope,
+  request,
+  response,
+  error,
+  delay,
+  times,
+}: MockRpcCallOptions): MockRpcCallResult {
+  // eth-query always passes `params`, so even if we don't supply this property,
+  // for consistency with makeRpcCall, assume that the `body` contains it
+  const { method, params = [], ...rest } = request;
+  const httpStatus =
+    (typeof response === 'object' &&
+      'httpStatus' in response &&
+      // Using nullish coalescing here breaks the tests.
+      // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing
+      response.httpStatus) ||
+    200;
+
+  /* @ts-expect-error The types for Nock do not include `basePath` in the interface for Nock.Scope. */
+  const url = nockScope.basePath.includes('infura.io')
+    ? `/v3/${MOCK_INFURA_PROJECT_ID}`
+    : '/';
+
+  debug('Mocking request:', {
+    url,
+    method,
+    params,
+    response,
+    error,
+    ...rest,
+    times,
+  });
+
+  let nockRequest = nockScope.post(url, {
+    id: /\d*/u,
+    jsonrpc: '2.0',
+    method,
+    params,
+    ...rest,
+  });
+
+  if (delay !== undefined) {
+    nockRequest = nockRequest.delay(delay);
+  }
+
+  if (times !== undefined) {
+    nockRequest = nockRequest.times(times);
+  }
+
+  if (error !== undefined) {
+    return nockRequest.replyWithError(error);
+  }
+
+  return nockRequest.reply(async (_uri, requestBody) => {
+    const jsonRpcRequest = requestBody as JsonRpcRequest;
+    let resolvedResponse: Response | string | JSONRPCResponse | undefined;
+    if (typeof response === 'function') {
+      resolvedResponse = await response();
+    } else if (response !== undefined && 'body' in response) {
+      resolvedResponse = response.body;
+    } else {
+      resolvedResponse = response;
+    }
+
+    if (
+      typeof resolvedResponse === 'string' ||
+      resolvedResponse === undefined
+    ) {
+      return [httpStatus, resolvedResponse];
+    }
+
+    const {
+      id: jsonRpcId = jsonRpcRequest.id,
+      jsonrpc: jsonRpcVersion = jsonRpcRequest.jsonrpc,
+      result: jsonRpcResult,
+      error: jsonRpcError,
+    } = resolvedResponse;
+
+    const completeResponse = {
+      id: jsonRpcId,
+      jsonrpc: jsonRpcVersion,
+      result: jsonRpcResult,
+      error: jsonRpcError,
+    };
+    debug('Nock returning Response', completeResponse);
+    return [httpStatus, completeResponse];
+  });
+}
+
+type MockBlockTrackerRequestOptions = {
+  /**
+   * A nock scope (a set of mocked requests scoped to a certain base url).
+   */
+  nockScope: NockScope;
+  /**
+   * The block number that the block tracker should report, as a 0x-prefixed hex
+   * string.
+   */
+  blockNumber: string;
+};
+
+/**
+ * Mocks the next request for the latest block that the block tracker will make.
+ *
+ * @param args - The arguments.
+ * @param args.nockScope - A nock scope (a set of mocked requests scoped to a
+ * certain base URL).
+ * @param args.blockNumber - The block number that the block tracker should
+ * report, as a 0x-prefixed hex string.
+ */
+function mockNextBlockTrackerRequest({
+  nockScope,
+  blockNumber = DEFAULT_LATEST_BLOCK_NUMBER,
+}: MockBlockTrackerRequestOptions): void {
+  mockRpcCall({
+    nockScope,
+    request: { method: 'eth_blockNumber', params: [] },
+    response: { result: blockNumber },
+  });
+}
+
+/**
+ * Mocks all requests for the latest block that the block tracker will make.
+ *
+ * @param args - The arguments.
+ * @param args.nockScope - A nock scope (a set of mocked requests scoped to a
+ * certain base URL).
+ * @param args.blockNumber - The block number that the block tracker should
+ * report, as a 0x-prefixed hex string.
+ */
+async function mockAllBlockTrackerRequests({
+  nockScope,
+  blockNumber = DEFAULT_LATEST_BLOCK_NUMBER,
+}: MockBlockTrackerRequestOptions): Promise<void> {
+  const result = mockRpcCall({
+    nockScope,
+    request: { method: 'eth_blockNumber', params: [] },
+    response: { result: blockNumber },
+  });
+
+  if ('persist' in result) {
+    result.persist();
+  }
+}
+
+/**
+ * Makes a JSON-RPC call through the given eth-query object.
+ *
+ * @param ethQuery - The eth-query object.
+ * @param request - The request data.
+ * @returns A promise that either resolves with the result from the JSON-RPC
+ * response if it is successful or rejects with the error from the JSON-RPC
+ * response otherwise.
+ */
+function makeRpcCall(
+  ethQuery: EthQuery,
+  request: MockRequest,
+): Promise<unknown> {
+  return new Promise((resolve, reject) => {
+    debug('[makeRpcCall] making request', request);
+    // TODO: Replace `any` with type
+    // eslint-disable-next-line @typescript-eslint/no-explicit-any
+    ethQuery.sendAsync(request, (error: any, result: any) => {
+      debug('[makeRpcCall > ethQuery handler] error', error, 'result', result);
+      if (error) {
+        // This should be an error, but we will allow it to be whatever it is.
+        // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors
+        reject(error);
+      } else {
+        resolve(result);
+      }
+    });
+  });
+}
+
+export type ProviderType = 'infura' | 'custom';
+
+export type MockOptions = {
+  infuraNetwork?: InfuraNetworkType;
+  failoverRpcUrls?: string[];
+  providerType: ProviderType;
+  customRpcUrl?: string;
+  customChainId?: Hex;
+  customTicker?: string;
+  getRpcServiceOptions?: NetworkControllerOptions['getRpcServiceOptions'];
+  getBlockTrackerOptions?: NetworkControllerOptions['getBlockTrackerOptions'];
+  expectedHeaders?: Record<string, string>;
+  messenger?: RootMessenger;
+  networkClientId?: NetworkClientId;
+  isRpcFailoverEnabled?: boolean;
+};
+
+export type MockCommunications = {
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  mockNextBlockTrackerRequest: (options?: any) => void;
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  mockAllBlockTrackerRequests: (options?: any) => void;
+  mockRpcCall: (options: CurriedMockRpcCallOptions) => MockRpcCallResult;
+  rpcUrl: string;
+  infuraNetwork: InfuraNetworkType;
+};
+
+/**
+ * Sets up request mocks for requests to the provider.
+ *
+ * @param options - An options bag.
+ * @param options.providerType - The type of network client being tested.
+ * @param options.infuraNetwork - The name of the Infura network being tested,
+ * assuming that `providerType` is "infura" (default: "mainnet").
+ * @param options.customRpcUrl - The URL of the custom RPC endpoint, assuming
+ * that `providerType` is "custom".
+ * @param options.expectedHeaders - Headers with which to mock the request.
+ * @param fn - A function which will be called with an object that allows
+ * interaction with the network client.
+ * @returns The return value of the given function.
+ */
+export async function withMockedCommunications(
+  {
+    providerType,
+    infuraNetwork = 'mainnet',
+    customRpcUrl = MOCK_RPC_URL,
+    expectedHeaders = {},
+  }: MockOptions,
+  fn: (comms: MockCommunications) => Promise<void>,
+): Promise<void> {
+  const rpcUrl =
+    providerType === 'infura'
+      ? `https://${infuraNetwork}.infura.io`
+      : customRpcUrl;
+  const nockScope = buildScopeForMockingRequests(rpcUrl, expectedHeaders);
+  const curriedMockNextBlockTrackerRequest = (
+    localOptions: Omit<MockBlockTrackerRequestOptions, 'nockScope'>,
+  ): void => mockNextBlockTrackerRequest({ nockScope, ...localOptions });
+  const curriedMockAllBlockTrackerRequests = (
+    localOptions: Omit<MockBlockTrackerRequestOptions, 'nockScope'>,
+  ): Promise<void> =>
+    mockAllBlockTrackerRequests({ nockScope, ...localOptions });
+  const curriedMockRpcCall = (
+    localOptions: Omit<MockRpcCallOptions, 'nockScope'>,
+  ): MockRpcCallResult => mockRpcCall({ nockScope, ...localOptions });
+
+  const comms = {
+    mockNextBlockTrackerRequest: curriedMockNextBlockTrackerRequest,
+    mockAllBlockTrackerRequests: curriedMockAllBlockTrackerRequests,
+    mockRpcCall: curriedMockRpcCall,
+    rpcUrl,
+    infuraNetwork,
+  };
+
+  try {
+    return await fn(comms);
+  } finally {
+    nockIsDone();
+  }
+}
+
+type MockNetworkClient = {
+  blockTracker: BlockTracker;
+  provider: Provider;
+  clock: sinon.SinonFakeTimers;
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  makeRpcCall: (request: MockRequest) => Promise<any>;
+  // TODO: Replace `any` with type
+  // eslint-disable-next-line @typescript-eslint/no-explicit-any
+  makeRpcCallsInSeries: (requests: MockRequest[]) => Promise<any[]>;
+  messenger: RootMessenger;
+  chainId: Hex;
+  rpcUrl: string;
+};
+
+/**
+ * Some middleware contain logic which retries the request if some condition
+ * applies. This retrying always happens out of band via `setTimeout`, and
+ * because we are stubbing time via Jest's fake timers, we have to manually
+ * advance the clock so that the `setTimeout` handlers get fired. We don't know
+ * when these timers will get created, however, so we have to keep advancing
+ * timers until the request has been made an appropriate number of times.
+ * Unfortunately we don't have a good way to know how many times a request has
+ * been retried, but the good news is that the middleware won't end, and thus
+ * the promise which the RPC call returns won't get fulfilled, until all retries
+ * have been made.
+ *
+ * @param promise - The promise which is returned by the RPC call.
+ * @param clock - A Sinon clock object which can be used to advance to the next
+ * `setTimeout` handler.
+ * @returns The given promise.
+ */
+export async function waitForPromiseToBeFulfilledAfterRunningAllTimers<Type>(
+  promise: Promise<Type>,
+  clock: SinonFakeTimers,
+): Promise<Type> {
+  let hasPromiseBeenFulfilled = false;
+  let numTimesClockHasBeenAdvanced = 0;
+
+  promise
+    .catch((error: unknown) => {
+      // This is used to silence Node.js warnings about the rejection
+      // being handled asynchronously. The error is handled later when
+      // `promise` is awaited, but we log it here anyway in case it gets
+      // swallowed.
+      debug(error);
+    })
+    .finally(() => {
+      hasPromiseBeenFulfilled = true;
+    });
+
+  // `hasPromiseBeenFulfilled` is modified asynchronously.
+  /* eslint-disable-next-line no-unmodified-loop-condition */
+  while (!hasPromiseBeenFulfilled && numTimesClockHasBeenAdvanced < 30) {
+    await clock.runAllAsync();
+    numTimesClockHasBeenAdvanced += 1;
+  }
+
+  return promise;
+}
+
+/**
+ * Builds a provider from the middleware (for the provider type) along with a
+ * block tracker, runs the given function with those two things, and then
+ * ensures the block tracker is stopped at the end.
+ *
+ * @param options - An options bag.
+ * @param options.providerType - The type of network client being tested.
+ * @param options.failoverRpcUrls - The list of failover endpoint
+ * URLs to use.
+ * @param options.infuraNetwork - The name of the Infura network being tested,
+ * assuming that `providerType` is "infura" (default: "mainnet").
+ * @param options.customRpcUrl - The URL of the custom RPC endpoint, assuming
+ * that `providerType` is "custom".
+ * @param options.customChainId - The chain id belonging to the custom RPC
+ * endpoint, assuming that `providerType` is "custom" (default: "0x1").
+ * @param options.customTicker - The ticker of the custom RPC endpoint, assuming
+ * that `providerType` is "custom" (default: "ETH").
+ * @param options.getRpcServiceOptions - RPC service options factory.
+ * @param options.getBlockTrackerOptions - Block tracker options factory.
+ * @param options.messenger - The root messenger to use in tests.
+ * @param options.networkClientId - The ID of the new network client.
+ * @param options.isRpcFailoverEnabled - Whether or not the RPC failover
+ * functionality is enabled.
+ * @param fn - A function which will be called with an object that allows
+ * interaction with the network client.
+ * @returns The return value of the given function.
+ */
+export async function withNetworkClient<Type>(
+  {
+    providerType,
+    failoverRpcUrls = [],
+    infuraNetwork = 'mainnet',
+    customRpcUrl = MOCK_RPC_URL,
+    customChainId = '0x1',
+    customTicker = 'ETH',
+    getRpcServiceOptions = (): Omit<
+      RpcServiceOptions,
+      'failoverService' | 'endpointUrl'
+    > => ({ fetch, btoa, isOffline: (): boolean => false }),
+    getBlockTrackerOptions = (): PollingBlockTrackerOptions => ({}),
+    messenger = buildRootMessenger(),
+    networkClientId = 'some-network-client-id',
+    isRpcFailoverEnabled = false,
+  }: MockOptions,
+  fn: (client: MockNetworkClient) => Promise<Type>,
+): Promise<Type> {
+  // Faking timers ends up doing two things:
+  // 1. Halting the block tracker (which depends on `setTimeout` to periodically
+  // request the latest block) set up in `eth-json-rpc-middleware`
+  // 2. Halting the retry logic in `@metamask/eth-json-rpc-infura` (which also
+  // depends on `setTimeout`)
+  const clock = useFakeTimers();
+
+  const networkControllerMessenger = buildNetworkControllerMessenger(messenger);
+
+  // The JSON-RPC client wraps `eth_estimateGas` so that it takes 2 seconds longer
+  // than it usually would to complete. Or at least it should â€” this doesn't
+  // appear to be working correctly. Unset `IN_TEST` on `process.env` to prevent
+  // this behavior.
+  /* eslint-disable-next-line n/no-process-env */
+  const inTest = process.env.IN_TEST;
+  /* eslint-disable-next-line n/no-process-env */
+  delete process.env.IN_TEST;
+  const networkClientConfiguration: NetworkClientConfiguration =
+    providerType === 'infura'
+      ? {
+          network: infuraNetwork,
+          failoverRpcUrls,
+          infuraProjectId: MOCK_INFURA_PROJECT_ID,
+          type: NetworkClientType.Infura,
+          chainId: BUILT_IN_NETWORKS[infuraNetwork].chainId,
+          ticker: BUILT_IN_NETWORKS[infuraNetwork].ticker,
+        }
+      : {
+          chainId: customChainId,
+          failoverRpcUrls,
+          rpcUrl: customRpcUrl,
+          type: NetworkClientType.Custom,
+          ticker: customTicker,
+        };
+
+  const { chainId } = networkClientConfiguration;
+
+  const rpcUrl =
+    providerType === 'custom'
+      ? customRpcUrl
+      : `https://${infuraNetwork}.infura.io/v3/${MOCK_INFURA_PROJECT_ID}`;
+
+  const networkClient = createNetworkClient({
+    id: networkClientId,
+    configuration: networkClientConfiguration,
+    getRpcServiceOptions,
+    getBlockTrackerOptions,
+    messenger: networkControllerMessenger,
+    isRpcFailoverEnabled,
+  });
+  /* eslint-disable-next-line n/no-process-env */
+  process.env.IN_TEST = inTest;
+
+  const { provider, blockTracker } = networkClient;
+
+  const ethQuery = new EthQuery(provider);
+  const curriedMakeRpcCall = (request: MockRequest): Promise<unknown> =>
+    makeRpcCall(ethQuery, request);
+  const makeRpcCallsInSeries = async (
+    requests: MockRequest[],
+  ): Promise<unknown[]> => {
+    const responses: unknown[] = [];
+    for (const request of requests) {
+      responses.push(await curriedMakeRpcCall(request));
+    }
+    return responses;
+  };
+
+  const client = {
+    blockTracker,
+    provider,
+    clock,
+    makeRpcCall: curriedMakeRpcCall,
+    makeRpcCallsInSeries,
+    messenger,
+    chainId,
+    rpcUrl,
+  };
+
+  try {
+    return await fn(client);
+  } finally {
+    await blockTracker.destroy();
+
+    clock.restore();
+  }
+}
+
+type BuildMockParamsOptions = {
+  blockParam?: Json;
+  blockParamIndex: number;
+};
+
+/**
+ * Build mock parameters for a JSON-RPC call.
+ *
+ * The string 'some value' is used as the default value for each entry. The
+ * block parameter index determines the number of parameters to generate.
+ *
+ * The block parameter can be set to a custom value. If no value is given, it
+ * is set as undefined.
+ *
+ * @param args - Arguments.
+ * @param args.blockParamIndex - The index of the block parameter.
+ * @param args.blockParam - The block parameter value to set.
+ * @returns The mock params.
+ */
+export function buildMockParams({
+  blockParam,
+  blockParamIndex,
+}: BuildMockParamsOptions): Json[] {
+  const params = new Array(blockParamIndex).fill('some value');
+  params[blockParamIndex] = blockParam;
+
+  return params;
+}
+
+/**
+ * Returns a partial JSON-RPC request object, with the "block" param replaced
+ * with the given value.
+ *
+ * @param request - The request object.
+ * @param request.method - The request method.
+ * @param request.params - The request params.
+ * @param blockParamIndex - The index within the `params` array of the block
+ * param.
+ * @param blockParam - The desired block param value.
+ * @returns The updated request object.
+ */
+export function buildRequestWithReplacedBlockParam(
+  { method, params = [] }: MockRequest,
+  blockParamIndex: number,
+  blockParam: unknown,
+): { method: string; params: unknown[] } {
+  const updatedParams = params.slice();
+  updatedParams[blockParamIndex] = blockParam;
+  return { method, params: updatedParams };
+}
diff --git a/tests/network-client/no-block-param.ts b/tests/network-client/no-block-param.ts
new file mode 100644
index 0000000000000000000000000000000000000000..8c73a77775f179e9e371955dc7b39a766e2f2b77
--- /dev/null
+++ b/tests/network-client/no-block-param.ts
@@ -0,0 +1,768 @@
+import { errorCodes, rpcErrors } from '@metamask/rpc-errors';
+
+import type { ProviderType } from './helpers';
+import {
+  waitForPromiseToBeFulfilledAfterRunningAllTimers,
+  withMockedCommunications,
+  withNetworkClient,
+} from './helpers';
+import { testsForRpcFailoverBehavior } from './rpc-failover';
+import { CUSTOM_RPC_ERRORS } from '../../src/rpc-service/rpc-service';
+import { NetworkClientType } from '../../src/types';
+
+type TestsForRpcMethodAssumingNoBlockParamOptions = {
+  providerType: ProviderType;
+  numberOfParameters: number;
+};
+
+/**
+ * Defines tests which exercise the behavior exhibited by an RPC method which is
+ * assumed to not take a block parameter. Even if it does, the value of this
+ * parameter will not be used in determining how to cache the method.
+ *
+ * @param method - The name of the RPC method under test.
+ * @param additionalArgs - Additional arguments.
+ * @param additionalArgs.numberOfParameters - The number of parameters
+ * supported by the method under test.
+ * @param additionalArgs.providerType - The type of provider being tested;
+ * either `infura` or `custom`.
+ */
+export function testsForRpcMethodAssumingNoBlockParam(
+  method: string,
+  {
+    numberOfParameters,
+    providerType,
+  }: TestsForRpcMethodAssumingNoBlockParamOptions,
+): void {
+  it('does not hit the RPC endpoint more than once for identical requests', async () => {
+    const requests = [{ method }, { method }];
+    const mockResults = ['first result', 'second result'];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+      });
+
+      const results = await withNetworkClient(
+        { providerType },
+        ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+      );
+
+      expect(results).toStrictEqual([mockResults[0], mockResults[0]]);
+    });
+  });
+
+  for (const paramIndex of [...Array(numberOfParameters).keys()]) {
+    it(`does not reuse the result of a previous request if parameter at index "${paramIndex}" differs`, async () => {
+      const firstMockParams = [
+        ...new Array(numberOfParameters).fill('some value'),
+      ];
+      const secondMockParams = firstMockParams.slice();
+      secondMockParams[paramIndex] = 'another value';
+      const requests = [
+        {
+          method,
+          params: firstMockParams,
+        },
+        { method, params: secondMockParams },
+      ];
+      const mockResults = ['some result', 'another result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+        comms.mockRpcCall({
+          request: requests[1],
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual([mockResults[0], mockResults[1]]);
+      });
+    });
+  }
+
+  it('hits the RPC endpoint and does not reuse the result of a previous request if the latest block number was updated since', async () => {
+    const pollingInterval = 1234;
+    const requests = [{ method }, { method }];
+    const mockResults = ['first result', 'second result'];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      comms.mockNextBlockTrackerRequest({ blockNumber: '0x1' });
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+      });
+      comms.mockNextBlockTrackerRequest({ blockNumber: '0x2' });
+      comms.mockRpcCall({
+        request: requests[1],
+        response: { result: mockResults[1] },
+      });
+
+      const results = await withNetworkClient(
+        {
+          providerType,
+          getBlockTrackerOptions: () => ({
+            pollingInterval,
+          }),
+        },
+        async ({ blockTracker, makeRpcCall, clock }) => {
+          const waitForTwoBlocks = new Promise<void>((resolve) => {
+            let numberOfBlocks = 0;
+
+            // Start the block tracker
+            blockTracker.on('latest', () => {
+              numberOfBlocks += 1;
+              if (numberOfBlocks === 2) {
+                resolve();
+              }
+            });
+          });
+
+          const firstResult = await makeRpcCall(requests[0]);
+          // Proceed to the next iteration of the block tracker so that a new
+          // block is fetched and the current block is updated.
+          await clock.tickAsync(pollingInterval);
+          await waitForTwoBlocks;
+          const secondResult = await makeRpcCall(requests[1]);
+          return [firstResult, secondResult];
+        },
+      );
+
+      expect(results).toStrictEqual(mockResults);
+    });
+  });
+
+  for (const emptyValue of [null, '\u003cnil\u003e']) {
+    it(`does not retry an empty response of "${emptyValue}"`, async () => {
+      const request = { method };
+      const mockResult = emptyValue;
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request,
+          response: { result: mockResult },
+        });
+
+        const result = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCall }) => makeRpcCall(request),
+        );
+
+        expect(result).toStrictEqual(mockResult);
+      });
+    });
+
+    it(`does not reuse the result of a previous request if it was "${emptyValue}"`, async () => {
+      const requests = [{ method }, { method }];
+      const mockResults = [emptyValue, 'some result'];
+
+      await withMockedCommunications({ providerType }, async (comms) => {
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request: requests[0],
+          response: { result: mockResults[0] },
+        });
+        comms.mockRpcCall({
+          request: requests[1],
+          response: { result: mockResults[1] },
+        });
+
+        const results = await withNetworkClient(
+          { providerType },
+          ({ makeRpcCallsInSeries }) => makeRpcCallsInSeries(requests),
+        );
+
+        expect(results).toStrictEqual(mockResults);
+      });
+    });
+  }
+
+  it('queues requests while a previous identical call is still pending, then runs the queue when it finishes, reusing the result from the first request', async () => {
+    const requests = [{ method }, { method }, { method }];
+    const mockResults = ['first result', 'second result', 'third result'];
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request: requests[0],
+        response: { result: mockResults[0] },
+        delay: 100,
+      });
+
+      comms.mockRpcCall({
+        request: requests[1],
+        response: { result: mockResults[1] },
+      });
+
+      comms.mockRpcCall({
+        request: requests[2],
+        response: { result: mockResults[2] },
+      });
+
+      const results = await withNetworkClient(
+        { providerType },
+        async (client) => {
+          const resultPromises = [
+            client.makeRpcCall(requests[0]),
+            client.makeRpcCall(requests[1]),
+            client.makeRpcCall(requests[2]),
+          ];
+          const firstResult = await resultPromises[0];
+          // The inflight cache middleware uses setTimeout to run the handlers,
+          // so run them now
+          client.clock.runAll();
+          const remainingResults = await Promise.all(resultPromises.slice(1));
+          return [firstResult, ...remainingResults];
+        },
+      );
+
+      expect(results).toStrictEqual([
+        mockResults[0],
+        mockResults[0],
+        mockResults[0],
+      ]);
+    });
+  });
+
+  it('does not discard an error in a non-standard JSON-RPC error response, but throws it', async () => {
+    const request = { method, params: [] };
+    const error = {
+      code: -32000,
+      data: {
+        foo: 'bar',
+      },
+      message: 'VM Exception while processing transaction: revert',
+      name: 'RuntimeError',
+      stack:
+        'RuntimeError: VM Exception while processing transaction: revert at exactimate (/Users/elliot/code/metamask/metamask-mobile/node_modules/ganache/dist/node/webpack:/Ganache/ethereum/ethereum/lib/src/helpers/gas-estimator.js:257:23)',
+    };
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request,
+        response: {
+          error,
+        },
+      });
+
+      const promise = withNetworkClient(
+        { providerType },
+        async ({ provider }) => {
+          return await provider.request(request);
+        },
+      );
+
+      if (providerType === NetworkClientType.Infura) {
+        // This is not ideal, but we can refactor this later.
+        // eslint-disable-next-line jest/no-conditional-expect
+        await expect(promise).rejects.toThrow(
+          rpcErrors.internal({
+            message: error.message,
+            data: { cause: error },
+          }),
+        );
+      } else {
+        // This is not ideal, but we can refactor this later.
+        // eslint-disable-next-line jest/no-conditional-expect
+        await expect(promise).rejects.toThrow(
+          rpcErrors.internal({ data: error }),
+        );
+      }
+    });
+  });
+
+  describe.each([
+    [401, CUSTOM_RPC_ERRORS.unauthorized],
+    [402, errorCodes.rpc.resourceUnavailable],
+    [404, errorCodes.rpc.resourceUnavailable],
+    [422, CUSTOM_RPC_ERRORS.httpClientError],
+    [429, errorCodes.rpc.limitExceeded],
+  ])(
+    'if the RPC endpoint returns a %d response',
+    (httpStatus, rpcErrorCode) => {
+      const expectedError = expect.objectContaining({
+        code: rpcErrorCode,
+      });
+
+      it('throws a custom error without retrying the request', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            response: {
+              httpStatus,
+            },
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall }) => makeRpcCall(request),
+          );
+
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+    },
+  );
+
+  describe.each([500, 501, 505, 506, 507, 508, 510, 511])(
+    'if the RPC endpoint returns a %d response',
+    (httpStatus) => {
+      const expectedError = expect.objectContaining({
+        code: errorCodes.rpc.resourceUnavailable,
+      });
+
+      it('throws a generic, undescriptive error', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            response: {
+              httpStatus,
+            },
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall }) => makeRpcCall(request),
+          );
+
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: [],
+        },
+        getRequestToMock: () => ({
+          method,
+          params: [],
+        }),
+        failure: {
+          httpStatus,
+        },
+        isRetriableFailure: false,
+        getExpectedError: () => expectedError,
+        getExpectedBreakError: () =>
+          expect.objectContaining({
+            message: `Fetch failed with status '${httpStatus}'`,
+          }),
+      });
+    },
+  );
+
+  describe.each([502, 503, 504])(
+    'if the RPC endpoint returns a %d response',
+    (httpStatus) => {
+      const expectedError = expect.objectContaining({
+        code: errorCodes.rpc.resourceUnavailable,
+      });
+
+      it('retries the request up to 5 times until there is a 200 response', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          // Here we have the request fail for the first 4 tries, then succeed
+          // on the 5th try.
+          comms.mockRpcCall({
+            request,
+            response: {
+              error: 'Some error',
+              httpStatus,
+            },
+            times: 4,
+          });
+          comms.mockRpcCall({
+            request,
+            response: {
+              result: 'the result',
+              httpStatus: 200,
+            },
+          });
+          const result = await withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          expect(result).toBe('the result');
+        });
+      });
+
+      it(`throws a custom error if the response continues to be ${httpStatus} after 5 retries`, async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            response: {
+              error: 'Some error',
+              httpStatus,
+            },
+            times: 5,
+          });
+          comms.mockNextBlockTrackerRequest();
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+          await expect(promiseForResult).rejects.toThrow(expectedError);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: [],
+        },
+        getRequestToMock: () => ({
+          method,
+          params: [],
+        }),
+        failure: {
+          httpStatus,
+        },
+        isRetriableFailure: true,
+        getExpectedError: () => expectedError,
+        getExpectedBreakError: () =>
+          expect.objectContaining({
+            message: expect.stringContaining(
+              `Fetch failed with status '${httpStatus}'`,
+            ),
+          }),
+      });
+    },
+  );
+
+  describe.each(['ETIMEDOUT', 'ECONNRESET'])(
+    'if a %s error is thrown while making the request',
+    (errorCode) => {
+      const error = new Error(errorCode);
+      // @ts-expect-error `code` does not exist on the Error type, but is
+      // still used by Node.
+      error.code = errorCode;
+
+      it('retries the request up to 5 times until it is successful', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          // Here we have the request fail for the first 4 tries, then succeed
+          // on the 5th try.
+          comms.mockRpcCall({
+            request,
+            error,
+            times: 4,
+          });
+          comms.mockRpcCall({
+            request,
+            response: {
+              result: 'the result',
+              httpStatus: 200,
+            },
+          });
+
+          const result = await withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          expect(result).toBe('the result');
+        });
+      });
+
+      it('re-throws the error if it persists after 5 retries', async () => {
+        await withMockedCommunications({ providerType }, async (comms) => {
+          const request = { method };
+
+          // The first time a block-cacheable request is made, the latest block
+          // number is retrieved through the block tracker first. It doesn't
+          // matter what this is â€” it's just used as a cache key.
+          comms.mockNextBlockTrackerRequest();
+          comms.mockRpcCall({
+            request,
+            error,
+            times: 5,
+          });
+          const promiseForResult = withNetworkClient(
+            { providerType },
+            async ({ makeRpcCall, clock }) => {
+              return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+                makeRpcCall(request),
+                clock,
+              );
+            },
+          );
+
+          await expect(promiseForResult).rejects.toThrow(error.message);
+        });
+      });
+
+      testsForRpcFailoverBehavior({
+        providerType,
+        requestToCall: {
+          method,
+          params: [],
+        },
+        getRequestToMock: () => ({
+          method,
+          params: [],
+        }),
+        failure: error,
+        isRetriableFailure: true,
+        getExpectedError: (url: string) =>
+          expect.objectContaining({
+            message: `request to ${url} failed, reason: ${errorCode}`,
+          }),
+      });
+    },
+  );
+
+  describe('if the RPC endpoint responds with invalid JSON', () => {
+    const expectedError = expect.objectContaining({
+      code: errorCodes.rpc.parse,
+    });
+
+    it('retries the request up to 5 times until it responds with valid JSON', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        // Here we have the request fail for the first 4 tries, then succeed
+        // on the 5th try.
+        comms.mockRpcCall({
+          request,
+          response: {
+            body: 'invalid JSON',
+          },
+          times: 4,
+        });
+        comms.mockRpcCall({
+          request,
+          response: {
+            result: 'the result',
+            httpStatus: 200,
+          },
+        });
+
+        const result = await withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        expect(result).toBe('the result');
+      });
+    });
+
+    it('throws a custom error if the result is still non-JSON-parseable after 5 retries', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request,
+          response: {
+            body: 'invalid JSON',
+          },
+          times: 5,
+        });
+        const promiseForResult = withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        await expect(promiseForResult).rejects.toThrow(expectedError);
+      });
+    });
+
+    testsForRpcFailoverBehavior({
+      providerType,
+      requestToCall: {
+        method,
+        params: [],
+      },
+      getRequestToMock: () => ({
+        method,
+        params: [],
+      }),
+      failure: {
+        body: 'invalid JSON',
+      },
+      isRetriableFailure: true,
+      getExpectedError: () => expectedError,
+      getExpectedBreakError: () =>
+        expect.objectContaining({
+          message: expect.stringContaining('invalid json'),
+        }),
+    });
+  });
+
+  describe('if making the request throws a connection error', () => {
+    const error = new TypeError('Failed to fetch');
+
+    it('retries the request up to 5 times until there is no connection error', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        // Here we have the request fail for the first 4 tries, then succeed
+        // on the 5th try.
+        comms.mockRpcCall({
+          request,
+          error,
+          times: 4,
+        });
+        comms.mockRpcCall({
+          request,
+          response: {
+            result: 'the result',
+            httpStatus: 200,
+          },
+        });
+
+        const result = await withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        expect(result).toBe('the result');
+      });
+    });
+
+    it('re-throws the error if it persists after 5 retries', async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = { method };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first. It doesn't
+        // matter what this is â€” it's just used as a cache key.
+        comms.mockNextBlockTrackerRequest();
+        comms.mockRpcCall({
+          request,
+          error,
+          times: 5,
+        });
+        const promiseForResult = withNetworkClient(
+          { providerType },
+          async ({ makeRpcCall, clock }) => {
+            return await waitForPromiseToBeFulfilledAfterRunningAllTimers(
+              makeRpcCall(request),
+              clock,
+            );
+          },
+        );
+
+        await expect(promiseForResult).rejects.toThrow(error.message);
+      });
+    });
+
+    testsForRpcFailoverBehavior({
+      providerType,
+      requestToCall: {
+        method,
+        params: [],
+      },
+      getRequestToMock: () => ({
+        method,
+        params: [],
+      }),
+      failure: error,
+      isRetriableFailure: true,
+      getExpectedError: (url: string) =>
+        expect.objectContaining({
+          message: `request to ${url} failed, reason: ${error.message}`,
+        }),
+    });
+  });
+}
diff --git a/tests/network-client/not-handled-by-middleware.ts b/tests/network-client/not-handled-by-middleware.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2dee8f3e85b773a98b29aa2f833ac6e9e38bf505
--- /dev/null
+++ b/tests/network-client/not-handled-by-middleware.ts
@@ -0,0 +1,53 @@
+import { fill } from 'lodash';
+
+import type { ProviderType } from './helpers';
+import { withMockedCommunications, withNetworkClient } from './helpers';
+
+type TestsForRpcMethodNotHandledByMiddlewareOptions = {
+  providerType: ProviderType;
+  numberOfParameters: number;
+};
+
+/**
+ * Defines tests which exercise the behavior exhibited by an RPC method that
+ * is not handled specially by the network client middleware.
+ *
+ * @param method - The name of the RPC method under test.
+ * @param additionalArgs - Additional arguments.
+ * @param additionalArgs.providerType - The type of provider being tested;
+ * either `infura` or `custom`.
+ * @param additionalArgs.numberOfParameters - The number of parameters that this
+ * RPC method takes.
+ */
+export function testsForRpcMethodNotHandledByMiddleware(
+  method: string,
+  {
+    providerType,
+    numberOfParameters,
+  }: TestsForRpcMethodNotHandledByMiddlewareOptions,
+): void {
+  it('attempts to pass the request off to the RPC endpoint', async () => {
+    const request = {
+      method,
+      params: fill(Array(numberOfParameters), 'some value'),
+    };
+    const expectedResult = 'the result';
+
+    await withMockedCommunications({ providerType }, async (comms) => {
+      // The first time a block-cacheable request is made, the latest block
+      // number is retrieved through the block tracker first. It doesn't
+      // matter what this is â€” it's just used as a cache key.
+      comms.mockNextBlockTrackerRequest();
+      comms.mockRpcCall({
+        request,
+        response: { result: expectedResult },
+      });
+      const actualResult = await withNetworkClient(
+        { providerType },
+        ({ makeRpcCall }) => makeRpcCall(request),
+      );
+
+      expect(actualResult).toStrictEqual(expectedResult);
+    });
+  });
+}
diff --git a/tests/network-client/rpc-failover.ts b/tests/network-client/rpc-failover.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2decfa2dc72643412ab5b70bfd1d40285bdb1425
--- /dev/null
+++ b/tests/network-client/rpc-failover.ts
@@ -0,0 +1,300 @@
+import { ConstantBackoff } from '@metamask/controller-utils';
+import type { Hex } from '@metamask/utils';
+
+import type { MockRequest, MockResponse, ProviderType } from './helpers';
+import { withMockedCommunications, withNetworkClient } from './helpers';
+import { ignoreRejection } from '../../../../tests/helpers';
+import { buildRootMessenger } from '../helpers';
+
+/**
+ * Tests for RPC failover behavior.
+ *
+ * @param args - The arguments.
+ * @param args.providerType - The provider type.
+ * @param args.requestToCall - The request to call.
+ * @param args.getRequestToMock - Factory returning the request to mock.
+ * @param args.failure - The failure mock response to use.
+ * @param args.isRetriableFailure - Whether the failure gets retried.
+ * @param args.getExpectedError - Factory returning the expected error.
+ * @param args.getExpectedBreakError - Factory returning the expected error
+ * upon circuit break. Defaults to using `getExpectedError`.
+ */
+export function testsForRpcFailoverBehavior({
+  providerType,
+  requestToCall,
+  getRequestToMock,
+  failure,
+  isRetriableFailure,
+  getExpectedError,
+}: {
+  providerType: ProviderType;
+  requestToCall: MockRequest;
+  getRequestToMock: (request: MockRequest, blockNumber: Hex) => MockRequest;
+  failure: MockResponse | Error | string;
+  isRetriableFailure: boolean;
+  getExpectedError: (url: string) => Error | jest.Constructable;
+  getExpectedBreakError?: (url: string) => Error | jest.Constructable;
+}): void {
+  const blockNumber = '0x100';
+  const backoffDuration = 100;
+  const maxConsecutiveFailures = 15;
+  const maxRetries = 4;
+  const numRequestsToMake = isRetriableFailure
+    ? maxConsecutiveFailures / (maxRetries + 1)
+    : maxConsecutiveFailures;
+
+  describe('if RPC failover functionality is enabled', () => {
+    it(`fails over to the provided alternate RPC endpoint after ${maxConsecutiveFailures} unsuccessful attempts`, async () => {
+      await withMockedCommunications({ providerType }, async (primaryComms) => {
+        await withMockedCommunications(
+          {
+            providerType: 'custom',
+            customRpcUrl: 'https://failover.endpoint',
+          },
+          async (failoverComms) => {
+            const request = requestToCall;
+            const requestToMock = getRequestToMock(request, blockNumber);
+            const additionalMockRpcCallOptions =
+              failure instanceof Error || typeof failure === 'string'
+                ? { error: failure }
+                : { response: failure };
+
+            // The first time a block-cacheable request is made, the
+            // latest block number is retrieved through the block
+            // tracker first.
+            primaryComms.mockNextBlockTrackerRequest({
+              blockNumber,
+            });
+            primaryComms.mockRpcCall({
+              request: requestToMock,
+              times: maxConsecutiveFailures,
+              ...additionalMockRpcCallOptions,
+            });
+            failoverComms.mockRpcCall({
+              request: requestToMock,
+              response: {
+                result: 'ok',
+              },
+            });
+
+            const messenger = buildRootMessenger();
+
+            const result = await withNetworkClient(
+              {
+                providerType,
+                isRpcFailoverEnabled: true,
+                failoverRpcUrls: ['https://failover.endpoint'],
+                messenger,
+                getRpcServiceOptions: () => ({
+                  fetch,
+                  btoa,
+                  isOffline: (): boolean => false,
+                  policyOptions: {
+                    backoff: new ConstantBackoff(backoffDuration),
+                  },
+                }),
+              },
+              async ({ makeRpcCall, clock }) => {
+                messenger.subscribe(
+                  'NetworkController:rpcEndpointRetried',
+                  () => {
+                    // Ensure that we advance to the next RPC request
+                    // retry, not the next block tracker request.
+                    // We also don't need to await this, it just needs to
+                    // be added to the promise queue.
+                    // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                    clock.tickAsync(backoffDuration);
+                  },
+                );
+
+                for (let i = 0; i < numRequestsToMake - 1; i++) {
+                  await ignoreRejection(makeRpcCall(request));
+                }
+                return await makeRpcCall(request);
+              },
+            );
+
+            expect(result).toBe('ok');
+          },
+        );
+      });
+    });
+
+    it('allows RPC service options to be customized', async () => {
+      const customMaxConsecutiveFailures = 6;
+      const customMaxRetries = 2;
+      const customNumRequestsToMake = isRetriableFailure
+        ? customMaxConsecutiveFailures / (customMaxRetries + 1)
+        : customMaxConsecutiveFailures;
+
+      await withMockedCommunications(
+        {
+          providerType,
+          expectedHeaders: {
+            'X-Foo': 'Bar',
+          },
+        },
+        async (primaryComms) => {
+          await withMockedCommunications(
+            {
+              providerType: 'custom',
+              customRpcUrl: 'https://failover.endpoint',
+              expectedHeaders: {
+                'X-Baz': 'Qux',
+              },
+            },
+            async (failoverComms) => {
+              const request = requestToCall;
+              const requestToMock = getRequestToMock(request, blockNumber);
+              const additionalMockRpcCallOptions =
+                failure instanceof Error || typeof failure === 'string'
+                  ? { error: failure }
+                  : { response: failure };
+
+              // The first time a block-cacheable request is made, the
+              // latest block number is retrieved through the block
+              // tracker first.
+              primaryComms.mockNextBlockTrackerRequest({
+                blockNumber,
+              });
+              primaryComms.mockRpcCall({
+                request: requestToMock,
+                times: customMaxConsecutiveFailures,
+                ...additionalMockRpcCallOptions,
+              });
+              failoverComms.mockRpcCall({
+                request: requestToMock,
+                response: {
+                  result: 'ok',
+                },
+              });
+
+              const messenger = buildRootMessenger();
+
+              const result = await withNetworkClient(
+                {
+                  providerType,
+                  isRpcFailoverEnabled: true,
+                  failoverRpcUrls: ['https://failover.endpoint'],
+                  messenger,
+                  getRpcServiceOptions: (rpcEndpointUrl) => {
+                    const commonOptions = {
+                      fetch,
+                      btoa,
+                      isOffline: (): boolean => false,
+                    };
+                    if (rpcEndpointUrl === 'https://failover.endpoint') {
+                      const headers: HeadersInit = {
+                        'X-Baz': 'Qux',
+                      };
+                      return {
+                        ...commonOptions,
+                        fetchOptions: {
+                          headers,
+                        },
+                      };
+                    }
+                    const headers: HeadersInit = {
+                      'X-Foo': 'Bar',
+                    };
+                    return {
+                      ...commonOptions,
+                      fetchOptions: {
+                        headers,
+                      },
+                      policyOptions: {
+                        backoff: new ConstantBackoff(backoffDuration),
+                        maxRetries: customMaxRetries,
+                        maxConsecutiveFailures: customMaxConsecutiveFailures,
+                      },
+                    };
+                  },
+                },
+                async ({ makeRpcCall, clock }) => {
+                  messenger.subscribe(
+                    'NetworkController:rpcEndpointRetried',
+                    () => {
+                      // Ensure that we advance to the next RPC request
+                      // retry, not the next block tracker request.
+                      // We also don't need to await this, it just needs to
+                      // be added to the promise queue.
+                      // eslint-disable-next-line @typescript-eslint/no-floating-promises
+                      clock.tickAsync(backoffDuration);
+                    },
+                  );
+
+                  for (let i = 0; i < customNumRequestsToMake - 1; i++) {
+                    await ignoreRejection(makeRpcCall(request));
+                  }
+                  return await makeRpcCall(request);
+                },
+              );
+
+              expect(result).toBe('ok');
+            },
+          );
+        },
+      );
+    });
+  });
+
+  describe('if RPC failover functionality is not enabled', () => {
+    it(`throws even after ${maxConsecutiveFailures} unsuccessful attempts`, async () => {
+      await withMockedCommunications({ providerType }, async (comms) => {
+        const request = requestToCall;
+        const requestToMock = getRequestToMock(request, blockNumber);
+        const additionalMockRpcCallOptions =
+          failure instanceof Error || typeof failure === 'string'
+            ? { error: failure }
+            : { response: failure };
+
+        // The first time a block-cacheable request is made, the latest block
+        // number is retrieved through the block tracker first.
+        comms.mockNextBlockTrackerRequest({ blockNumber });
+        comms.mockRpcCall({
+          request: requestToMock,
+          times: maxConsecutiveFailures,
+          ...additionalMockRpcCallOptions,
+        });
+
+        const messenger = buildRootMessenger();
+
+        await withNetworkClient(
+          {
+            providerType,
+            isRpcFailoverEnabled: false,
+            failoverRpcUrls: ['https://failover.endpoint'],
+            messenger,
+            getRpcServiceOptions: () => ({
+              fetch,
+              btoa,
+              isOffline: (): boolean => false,
+              policyOptions: {
+                backoff: new ConstantBackoff(backoffDuration),
+              },
+            }),
+          },
+          async ({ makeRpcCall, clock, rpcUrl }) => {
+            messenger.subscribe('NetworkController:rpcEndpointRetried', () => {
+              // Ensure that we advance to the next RPC request
+              // retry, not the next block tracker request.
+              // We also don't need to await this, it just needs to
+              // be added to the promise queue.
+              // eslint-disable-next-line @typescript-eslint/no-floating-promises
+              clock.tickAsync(backoffDuration);
+            });
+
+            for (let i = 0; i < numRequestsToMake - 1; i++) {
+              await ignoreRejection(makeRpcCall(request));
+            }
+            const promiseForResult = makeRpcCall(request);
+
+            await expect(promiseForResult).rejects.toThrow(
+              getExpectedError(rpcUrl),
+            );
+          },
+        );
+      });
+    });
+  });
+}
diff --git a/tsconfig.build.json b/tsconfig.build.json
new file mode 100644
index 0000000000000000000000000000000000000000..a81948ea66a79219fd90c55976b91b172018aa06
--- /dev/null
+++ b/tsconfig.build.json
@@ -0,0 +1,20 @@
+{
+  "extends": "../../tsconfig.packages.build.json",
+  "compilerOptions": {
+    "baseUrl": "./",
+    "outDir": "./dist",
+    "rootDir": "./src"
+  },
+  "references": [
+    { "path": "../base-controller/tsconfig.build.json" },
+    { "path": "../controller-utils/tsconfig.build.json" },
+    { "path": "../connectivity-controller/tsconfig.build.json" },
+    { "path": "../eth-block-tracker/tsconfig.build.json" },
+    { "path": "../eth-json-rpc-middleware/tsconfig.build.json" },
+    { "path": "../eth-json-rpc-provider/tsconfig.build.json" },
+    { "path": "../json-rpc-engine/tsconfig.build.json" },
+    { "path": "../error-reporting-service/tsconfig.build.json" },
+    { "path": "../messenger/tsconfig.build.json" }
+  ],
+  "include": ["../../types", "./src"]
+}
diff --git a/tsconfig.build.tsbuildinfo b/tsconfig.build.tsbuildinfo
new file mode 100644
index 0000000000000000000000000000000000000000..8dc1b43e87686a2a9e1ce52da7b4d16f9c6eea5c
--- /dev/null
+++ b/tsconfig.build.tsbuildinfo
@@ -0,0 +1 @@
+{"version":"5.3.3"}
\ No newline at end of file
diff --git a/tsconfig.json b/tsconfig.json
new file mode 100644
index 0000000000000000000000000000000000000000..e5a54a5785b0e2ac729739687536e193652d6f0e
--- /dev/null
+++ b/tsconfig.json
@@ -0,0 +1,19 @@
+{
+  "extends": "../../tsconfig.packages.json",
+  "compilerOptions": {
+    "baseUrl": "./",
+    "rootDir": "../.."
+  },
+  "references": [
+    { "path": "../base-controller" },
+    { "path": "../controller-utils" },
+    { "path": "../connectivity-controller" },
+    { "path": "../eth-block-tracker" },
+    { "path": "../eth-json-rpc-middleware" },
+    { "path": "../eth-json-rpc-provider" },
+    { "path": "../json-rpc-engine" },
+    { "path": "../error-reporting-service" },
+    { "path": "../messenger" }
+  ],
+  "include": ["../../types", "../../tests", "./src", "./tests"]
+}
diff --git a/typedoc.json b/typedoc.json
new file mode 100644
index 0000000000000000000000000000000000000000..c9da015dbf8a0e0e3d39dd61f7c0386efac96ddc
--- /dev/null
+++ b/typedoc.json
@@ -0,0 +1,7 @@
+{
+  "entryPoints": ["./src/index.ts"],
+  "excludePrivate": true,
+  "hideGenerator": true,
+  "out": "docs",
+  "tsconfig": "./tsconfig.build.json"
+}
