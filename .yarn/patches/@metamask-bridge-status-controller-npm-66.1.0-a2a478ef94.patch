diff --git a/dist/bridge-status-controller.cjs b/dist/bridge-status-controller.cjs
index 45003640c463ecf21f4a6ddd57d3d4244d46be94..7ab245fb69a39214c288ef1b19c55434b2e9c6ce 100644
--- a/dist/bridge-status-controller.cjs
+++ b/dist/bridge-status-controller.cjs
@@ -10,7 +10,7 @@ var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (
     if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
     return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
 };
-var _BridgeStatusController_instances, _BridgeStatusController_pollingTokensByTxMetaId, _BridgeStatusController_intentStatusManager, _BridgeStatusController_clientId, _BridgeStatusController_fetchFn, _BridgeStatusController_config, _BridgeStatusController_addTransactionFn, _BridgeStatusController_addTransactionBatchFn, _BridgeStatusController_updateTransactionFn, _BridgeStatusController_estimateGasFeeFn, _BridgeStatusController_trace, _BridgeStatusController_markTxAsFailed, _BridgeStatusController_restartPollingForIncompleteHistoryItems, _BridgeStatusController_addTxToHistory, _BridgeStatusController_rekeyHistoryItem, _BridgeStatusController_startPollingForTxId, _BridgeStatusController_shouldPollHistoryItem, _BridgeStatusController_getMultichainSelectedAccount, _BridgeStatusController_handleFetchFailure, _BridgeStatusController_fetchBridgeTxStatus, _BridgeStatusController_getSrcTxHash, _BridgeStatusController_updateSrcTxHash, _BridgeStatusController_wipeBridgeStatusByChainId, _BridgeStatusController_handleNonEvmTx, _BridgeStatusController_waitForHashAndReturnFinalTxMeta, _BridgeStatusController_waitForTxConfirmation, _BridgeStatusController_handleApprovalTx, _BridgeStatusController_handleEvmTransaction, _BridgeStatusController_handleUSDTAllowanceReset, _BridgeStatusController_calculateGasFees, _BridgeStatusController_handleEvmTransactionBatch, _BridgeStatusController_trackUnifiedSwapBridgeEvent;
+var _BridgeStatusController_instances, _BridgeStatusController_pollingTokensByTxMetaId, _BridgeStatusController_intentStatusManager, _BridgeStatusController_clientId, _BridgeStatusController_fetchFn, _BridgeStatusController_config, _BridgeStatusController_addTransactionFn, _BridgeStatusController_addTransactionBatchFn, _BridgeStatusController_updateTransactionFn, _BridgeStatusController_estimateGasFeeFn, _BridgeStatusController_trace, _BridgeStatusController_markTxAsFailed, _BridgeStatusController_restartPollingForIncompleteHistoryItems, _BridgeStatusController_addTxToHistory, _BridgeStatusController_rekeyHistoryItem, _BridgeStatusController_startPollingForTxId, _BridgeStatusController_shouldPollHistoryItem, _BridgeStatusController_getMultichainSelectedAccount, _BridgeStatusController_handleFetchFailure, _BridgeStatusController_fetchBridgeTxStatus, _BridgeStatusController_getJwt, _BridgeStatusController_getSrcTxHash, _BridgeStatusController_updateSrcTxHash, _BridgeStatusController_wipeBridgeStatusByChainId, _BridgeStatusController_handleNonEvmTx, _BridgeStatusController_waitForHashAndReturnFinalTxMeta, _BridgeStatusController_waitForTxConfirmation, _BridgeStatusController_handleApprovalTx, _BridgeStatusController_handleEvmTransaction, _BridgeStatusController_handleUSDTAllowanceReset, _BridgeStatusController_calculateGasFees, _BridgeStatusController_handleEvmTransactionBatch, _BridgeStatusController_trackUnifiedSwapBridgeEvent;
 Object.defineProperty(exports, "__esModule", { value: true });
 exports.BridgeStatusController = void 0;
 const bridge_controller_1 = require("@metamask/bridge-controller");
@@ -207,7 +207,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
             });
         });
         _BridgeStatusController_addTxToHistory.set(this, (startPollingForBridgeTxStatusArgs, actionId) => {
-            const { bridgeTxMeta, statusRequest, quoteResponse, startTime, slippagePercentage, initialDestAssetBalance, targetContractAddress, approvalTxId, isStxEnabled, location, accountAddress: selectedAddress, } = startPollingForBridgeTxStatusArgs;
+            const { bridgeTxMeta, statusRequest, quoteResponse, startTime, slippagePercentage, initialDestAssetBalance, targetContractAddress, approvalTxId, isStxEnabled, location, abTests, accountAddress: selectedAddress, } = startPollingForBridgeTxStatusArgs;
             // Determine the key for this history item:
             // - For pre-submission (non-batch EVM): use actionId
             // - For post-submission or other cases: use bridgeTxMeta.id
@@ -248,6 +248,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                 isStxEnabled: isStxEnabled ?? false,
                 featureId: quoteResponse.featureId,
                 location,
+                ...(abTests && { abTests }),
             };
             this.update((state) => {
                 // Use actionId as key for pre-submission, or txMeta.id for post-submission
@@ -385,7 +386,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                 if (isIntent) {
                     const { srcChainId } = historyItem.quote;
                     const intentApi = new intent_api_1.IntentApiImpl(__classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl, __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"));
-                    const intentOrder = await intentApi.getOrderStatus(bridgeTxMetaId, historyItem.quote.intent?.protocol ?? '', srcChainId.toString(), __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"));
+                    const intentOrder = await intentApi.getOrderStatus(bridgeTxMetaId, historyItem.quote.intent?.protocol ?? '', srcChainId.toString(), __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), await __classPrivateFieldGet(this, _BridgeStatusController_getJwt, "f").call(this));
                     intentOrderStatus = intentOrder.status;
                     intentTranslation = (0, intent_api_1.translateIntentOrderToBridgeStatus)(intentOrder, srcChainId, historyItem.status.srcChain.txHash);
                     status = intentTranslation.status;
@@ -400,7 +401,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                     }
                     __classPrivateFieldGet(this, _BridgeStatusController_updateSrcTxHash, "f").call(this, bridgeTxMetaId, srcTxHash);
                     const statusRequest = (0, bridge_status_1.getStatusRequestWithSrcTxHash)(historyItem.quote, srcTxHash);
-                    const response = await (0, bridge_status_1.fetchBridgeTxStatus)(statusRequest, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl);
+                    const response = await (0, bridge_status_1.fetchBridgeTxStatus)(statusRequest, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), await __classPrivateFieldGet(this, _BridgeStatusController_getJwt, "f").call(this), __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl);
                     status = response.status;
                     validationFailures = response.validationFailures;
                 }
@@ -456,6 +457,16 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                 __classPrivateFieldGet(this, _BridgeStatusController_handleFetchFailure, "f").call(this, bridgeTxMetaId);
             }
         });
+        _BridgeStatusController_getJwt.set(this, async () => {
+            try {
+                const token = await this.messenger.call('AuthenticationController:getBearerToken');
+                return token;
+            }
+            catch (error) {
+                console.error('Error getting JWT token for bridge-api request', error);
+                return undefined;
+            }
+        });
         _BridgeStatusController_getSrcTxHash.set(this, (bridgeTxMetaId) => {
             const { txHistory } = this.state;
             // Prefer the srcTxHash from bridgeStatusState so we don't have to l ook up in TransactionController
@@ -704,9 +715,10 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
          * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
          * @param quotesReceivedContext - The context for the QuotesReceived event
          * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+         * @param abTests - A/B test context to attribute events to specific experiments
          * @returns The transaction meta
          */
-        this.submitTx = async (accountAddress, quoteResponse, isStxEnabledOnClient, quotesReceivedContext, location = bridge_controller_1.MetaMetricsSwapsEventSource.MainView) => {
+        this.submitTx = async (accountAddress, quoteResponse, isStxEnabledOnClient, quotesReceivedContext, location = bridge_controller_1.MetaMetricsSwapsEventSource.MainView, abTests) => {
             this.messenger.call('BridgeController:stopPollingForQuotes', bridge_controller_1.AbortReason.TransactionSubmitted, 
             // If trade is submitted before all quotes are loaded, the QuotesReceived event is published
             // If the trade has a featureId, it means it was submitted outside of the Unified Swap and Bridge experience, so no QuotesReceived event is published
@@ -716,7 +728,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                 throw new Error('Failed to submit cross-chain swap transaction: undefined multichain account');
             }
             const isHardwareAccount = (0, bridge_controller_1.isHardwareWallet)(selectedAccount);
-            const preConfirmationProperties = (0, metrics_1.getPreConfirmationPropertiesFromQuote)(quoteResponse, isStxEnabledOnClient, isHardwareAccount, location);
+            const preConfirmationProperties = (0, metrics_1.getPreConfirmationPropertiesFromQuote)(quoteResponse, isStxEnabledOnClient, isHardwareAccount, location, abTests);
             // Emit Submitted event after submit button is clicked
             !quoteResponse.featureId &&
                 __classPrivateFieldGet(this, _BridgeStatusController_trackUnifiedSwapBridgeEvent, "f").call(this, bridge_controller_1.UnifiedSwapBridgeEventName.Submitted, undefined, preConfirmationProperties);
@@ -838,6 +850,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                         startTime,
                         approvalTxId,
                         location,
+                        abTests,
                     }, actionId);
                     // Pass txFee when gasIncluded is true to use the quote's gas fees
                     // instead of re-estimating (which would fail for max native token swaps)
@@ -878,6 +891,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                         startTime,
                         approvalTxId,
                         location,
+                        abTests,
                     });
                 }
                 if ((0, bridge_controller_1.isNonEvmChainId)(quoteResponse.quote.srcChainId)) {
@@ -903,15 +917,16 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
          * @param params.signature - Hex signature produced by eth_signTypedData_v4
          * @param params.accountAddress - The EOA submitting the order
          * @param params.location - The entry point from which the user initiated the swap or bridge
+         * @param params.abTests - A/B test context to attribute events to specific experiments
          * @returns A lightweight TransactionMeta-like object for history linking
          */
         this.submitIntent = async (params) => {
-            const { quoteResponse, signature, accountAddress, location } = params;
+            const { quoteResponse, signature, accountAddress, location, abTests } = params;
             this.messenger.call('BridgeController:stopPollingForQuotes', bridge_controller_1.AbortReason.TransactionSubmitted);
             // Build pre-confirmation properties for error tracking parity with submitTx
             const account = __classPrivateFieldGet(this, _BridgeStatusController_instances, "m", _BridgeStatusController_getMultichainSelectedAccount).call(this, accountAddress);
             const isHardwareAccount = Boolean(account) && (0, bridge_controller_1.isHardwareWallet)(account);
-            const preConfirmationProperties = (0, metrics_1.getPreConfirmationPropertiesFromQuote)(quoteResponse, false, isHardwareAccount, location);
+            const preConfirmationProperties = (0, metrics_1.getPreConfirmationPropertiesFromQuote)(quoteResponse, false, isHardwareAccount, location, abTests);
             try {
                 const intent = (0, transaction_1.getIntentFromQuote)(quoteResponse);
                 // If backend provided an approval tx for this intent quote, submit it first (on-chain),
@@ -939,7 +954,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                     aggregatorId: intent.protocol,
                 };
                 const intentApi = new intent_api_1.IntentApiImpl(__classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl, __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"));
-                const intentOrder = await intentApi.submitIntent(submissionParams, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"));
+                const intentOrder = await intentApi.submitIntent(submissionParams, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), await __classPrivateFieldGet(this, _BridgeStatusController_getJwt, "f").call(this));
                 const orderUid = intentOrder.id;
                 // Determine transaction type: swap for same-chain, bridge for cross-chain
                 const isCrossChainTx = (0, bridge_controller_1.isCrossChain)(quoteResponse.quote.srcChainId, quoteResponse.quote.destChainId);
@@ -1007,6 +1022,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
                         approvalTxId,
                         startTime,
                         location,
+                        abTests,
                     });
                     // Start polling using the orderId key to route to intent manager
                     __classPrivateFieldGet(this, _BridgeStatusController_startPollingForTxId, "f").call(this, bridgeHistoryKey);
@@ -1033,12 +1049,20 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
          * @param eventProperties - The properties for the event
          */
         _BridgeStatusController_trackUnifiedSwapBridgeEvent.set(this, (eventName, txMetaId, eventProperties) => {
+            const historyAbTests = txMetaId
+                ? this.state.txHistory?.[txMetaId]?.abTests
+                : undefined;
+            const resolvedAbTests = eventProperties?.ab_tests ?? historyAbTests ?? undefined;
             const baseProperties = {
                 action_type: bridge_controller_1.MetricsActionType.SWAPBRIDGE_V1,
                 location: eventProperties?.location ??
                     (txMetaId ? this.state.txHistory?.[txMetaId]?.location : undefined) ??
                     bridge_controller_1.MetaMetricsSwapsEventSource.MainView,
                 ...(eventProperties ?? {}),
+                ...(resolvedAbTests &&
+                    Object.keys(resolvedAbTests).length > 0 && {
+                    ab_tests: resolvedAbTests,
+                }),
             };
             // This will publish events for PERPS dropped tx failures as well
             if (!txMetaId) {
@@ -1152,7 +1176,7 @@ class BridgeStatusController extends (0, polling_controller_1.StaticIntervalPoll
     }
 }
 exports.BridgeStatusController = BridgeStatusController;
-_BridgeStatusController_pollingTokensByTxMetaId = new WeakMap(), _BridgeStatusController_intentStatusManager = new WeakMap(), _BridgeStatusController_clientId = new WeakMap(), _BridgeStatusController_fetchFn = new WeakMap(), _BridgeStatusController_config = new WeakMap(), _BridgeStatusController_addTransactionFn = new WeakMap(), _BridgeStatusController_addTransactionBatchFn = new WeakMap(), _BridgeStatusController_updateTransactionFn = new WeakMap(), _BridgeStatusController_estimateGasFeeFn = new WeakMap(), _BridgeStatusController_trace = new WeakMap(), _BridgeStatusController_markTxAsFailed = new WeakMap(), _BridgeStatusController_restartPollingForIncompleteHistoryItems = new WeakMap(), _BridgeStatusController_addTxToHistory = new WeakMap(), _BridgeStatusController_rekeyHistoryItem = new WeakMap(), _BridgeStatusController_startPollingForTxId = new WeakMap(), _BridgeStatusController_shouldPollHistoryItem = new WeakMap(), _BridgeStatusController_handleFetchFailure = new WeakMap(), _BridgeStatusController_fetchBridgeTxStatus = new WeakMap(), _BridgeStatusController_getSrcTxHash = new WeakMap(), _BridgeStatusController_updateSrcTxHash = new WeakMap(), _BridgeStatusController_wipeBridgeStatusByChainId = new WeakMap(), _BridgeStatusController_handleNonEvmTx = new WeakMap(), _BridgeStatusController_waitForHashAndReturnFinalTxMeta = new WeakMap(), _BridgeStatusController_waitForTxConfirmation = new WeakMap(), _BridgeStatusController_handleApprovalTx = new WeakMap(), _BridgeStatusController_handleEvmTransaction = new WeakMap(), _BridgeStatusController_handleUSDTAllowanceReset = new WeakMap(), _BridgeStatusController_calculateGasFees = new WeakMap(), _BridgeStatusController_handleEvmTransactionBatch = new WeakMap(), _BridgeStatusController_trackUnifiedSwapBridgeEvent = new WeakMap(), _BridgeStatusController_instances = new WeakSet(), _BridgeStatusController_getMultichainSelectedAccount = function _BridgeStatusController_getMultichainSelectedAccount(accountAddress) {
+_BridgeStatusController_pollingTokensByTxMetaId = new WeakMap(), _BridgeStatusController_intentStatusManager = new WeakMap(), _BridgeStatusController_clientId = new WeakMap(), _BridgeStatusController_fetchFn = new WeakMap(), _BridgeStatusController_config = new WeakMap(), _BridgeStatusController_addTransactionFn = new WeakMap(), _BridgeStatusController_addTransactionBatchFn = new WeakMap(), _BridgeStatusController_updateTransactionFn = new WeakMap(), _BridgeStatusController_estimateGasFeeFn = new WeakMap(), _BridgeStatusController_trace = new WeakMap(), _BridgeStatusController_markTxAsFailed = new WeakMap(), _BridgeStatusController_restartPollingForIncompleteHistoryItems = new WeakMap(), _BridgeStatusController_addTxToHistory = new WeakMap(), _BridgeStatusController_rekeyHistoryItem = new WeakMap(), _BridgeStatusController_startPollingForTxId = new WeakMap(), _BridgeStatusController_shouldPollHistoryItem = new WeakMap(), _BridgeStatusController_handleFetchFailure = new WeakMap(), _BridgeStatusController_fetchBridgeTxStatus = new WeakMap(), _BridgeStatusController_getJwt = new WeakMap(), _BridgeStatusController_getSrcTxHash = new WeakMap(), _BridgeStatusController_updateSrcTxHash = new WeakMap(), _BridgeStatusController_wipeBridgeStatusByChainId = new WeakMap(), _BridgeStatusController_handleNonEvmTx = new WeakMap(), _BridgeStatusController_waitForHashAndReturnFinalTxMeta = new WeakMap(), _BridgeStatusController_waitForTxConfirmation = new WeakMap(), _BridgeStatusController_handleApprovalTx = new WeakMap(), _BridgeStatusController_handleEvmTransaction = new WeakMap(), _BridgeStatusController_handleUSDTAllowanceReset = new WeakMap(), _BridgeStatusController_calculateGasFees = new WeakMap(), _BridgeStatusController_handleEvmTransactionBatch = new WeakMap(), _BridgeStatusController_trackUnifiedSwapBridgeEvent = new WeakMap(), _BridgeStatusController_instances = new WeakSet(), _BridgeStatusController_getMultichainSelectedAccount = function _BridgeStatusController_getMultichainSelectedAccount(accountAddress) {
     return this.messenger.call('AccountsController:getAccountByAddress', accountAddress);
 };
 //# sourceMappingURL=bridge-status-controller.cjs.map
\ No newline at end of file
diff --git a/dist/bridge-status-controller.cjs.map b/dist/bridge-status-controller.cjs.map
index f552d9a2a485c53a0211147548782defde9d6950..bb17fe8efe632f77a54c27678b0afe8af8fc7bcb 100644
--- a/dist/bridge-status-controller.cjs.map
+++ b/dist/bridge-status-controller.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status-controller.cjs","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AccountsControllerState } from '@metamask/accounts-controller';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type {\n  QuoteMetadata,\n  RequiredEventContextFromClient,\n  TxData,\n  QuoteResponse,\n  Intent,\n  Trade,\n} from '@metamask/bridge-controller';\nimport {\n  formatChainIdToHex,\n  isNonEvmChainId,\n  StatusTypes,\n  UnifiedSwapBridgeEventName,\n  formatChainIdToCaip,\n  isCrossChain,\n  isTronChainId,\n  isEvmTxData,\n  isHardwareWallet,\n  MetricsActionType,\n  MetaMetricsSwapsEventSource,\n  isBitcoinTrade,\n  isTronTrade,\n  AbortReason,\n  PollingStatus,\n} from '@metamask/bridge-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport { toHex } from '@metamask/controller-utils';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type {\n  TransactionController,\n  TransactionMeta,\n  TransactionParams,\n} from '@metamask/transaction-controller';\nimport { numberToHex } from '@metamask/utils';\nimport type { Hex } from '@metamask/utils';\n\nimport { IntentStatusManager } from './bridge-status-controller.intent';\nimport {\n  BRIDGE_PROD_API_BASE_URL,\n  BRIDGE_STATUS_CONTROLLER_NAME,\n  DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n  MAX_ATTEMPTS,\n  REFRESH_INTERVAL_MS,\n  TraceName,\n} from './constants';\nimport type {\n  BridgeStatusControllerState,\n  StartPollingForBridgeTxStatusArgsSerialized,\n  FetchFunction,\n  SolanaTransactionMeta,\n  BridgeHistoryItem,\n} from './types';\nimport type { BridgeStatusControllerMessenger } from './types';\nimport { BridgeClientId } from './types';\nimport {\n  fetchBridgeTxStatus,\n  getStatusRequestWithSrcTxHash,\n  shouldSkipFetchDueToFetchFailures,\n} from './utils/bridge-status';\nimport { getTxGasEstimates } from './utils/gas';\nimport {\n  IntentApiImpl,\n  IntentStatusTranslation,\n  mapIntentOrderStatusToTransactionStatus,\n  translateIntentOrderToBridgeStatus,\n} from './utils/intent-api';\nimport {\n  getFinalizedTxProperties,\n  getPriceImpactFromQuote,\n  getRequestMetadataFromHistory,\n  getRequestParamFromHistory,\n  getTradeDataFromHistory,\n  getEVMTxPropertiesFromTransactionMeta,\n  getTxStatusesFromHistory,\n  getPreConfirmationPropertiesFromQuote,\n} from './utils/metrics';\nimport {\n  findAndUpdateTransactionsInBatch,\n  getAddTransactionBatchParams,\n  getClientRequest,\n  getHistoryKey,\n  getIntentFromQuote,\n  getStatusRequestParams,\n  handleApprovalDelay,\n  handleMobileHardwareWalletDelay,\n  handleNonEvmTxResponse,\n  generateActionId,\n  waitForTxConfirmation,\n  rekeyHistoryItemInState,\n} from './utils/transaction';\n\nconst metadata: StateMetadata<BridgeStatusControllerState> = {\n  // We want to persist the bridge status state so that we can show the proper data for the Activity list\n  // basically match the behavior of TransactionController\n  txHistory: {\n    includeInStateLogs: true,\n    persist: true,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/** The input to start polling for the {@link BridgeStatusController} */\ntype BridgeStatusPollingInput = FetchBridgeTxStatusArgs;\n\ntype SrcTxMetaId = string;\nexport type FetchBridgeTxStatusArgs = {\n  bridgeTxMetaId: string;\n};\nexport class BridgeStatusController extends StaticIntervalPollingController<BridgeStatusPollingInput>()<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState,\n  BridgeStatusControllerMessenger\n> {\n  #pollingTokensByTxMetaId: Record<SrcTxMetaId, string> = {};\n\n  readonly #intentStatusManager: IntentStatusManager;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #config: {\n    customBridgeApiBaseUrl: string;\n  };\n\n  readonly #addTransactionFn: typeof TransactionController.prototype.addTransaction;\n\n  readonly #addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n\n  readonly #updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n\n  readonly #estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n\n  readonly #trace: TraceCallback;\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    fetchFn,\n    addTransactionFn,\n    addTransactionBatchFn,\n    updateTransactionFn,\n    estimateGasFeeFn,\n    config,\n    traceFn,\n  }: {\n    messenger: BridgeStatusControllerMessenger;\n    state?: Partial<BridgeStatusControllerState>;\n    clientId: BridgeClientId;\n    fetchFn: FetchFunction;\n    addTransactionFn: typeof TransactionController.prototype.addTransaction;\n    addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n    updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n    estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_STATUS_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      // Restore the persisted state\n      state: {\n        ...DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n        ...state,\n      },\n    });\n\n    this.#clientId = clientId;\n    this.#fetchFn = fetchFn;\n    this.#addTransactionFn = addTransactionFn;\n    this.#addTransactionBatchFn = addTransactionBatchFn;\n    this.#updateTransactionFn = updateTransactionFn;\n    this.#estimateGasFeeFn = estimateGasFeeFn;\n    this.#config = {\n      customBridgeApiBaseUrl:\n        config?.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n    };\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n    this.#intentStatusManager = new IntentStatusManager({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n    });\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:startPollingForBridgeTxStatus`,\n      this.startPollingForBridgeTxStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:wipeBridgeStatus`,\n      this.wipeBridgeStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitTx`,\n      this.submitTx.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitIntent`,\n      this.submitIntent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:restartPollingForFailedAttempts`,\n      this.restartPollingForFailedAttempts.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:getBridgeHistoryItemByTxMetaId`,\n      this.getBridgeHistoryItemByTxMetaId.bind(this),\n    );\n\n    // Set interval\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.messenger.subscribe(\n      'TransactionController:transactionFailed',\n      ({ transactionMeta }) => {\n        const { type, status, id: txMetaId, actionId } = transactionMeta;\n\n        if (\n          type &&\n          [\n            TransactionType.bridge,\n            TransactionType.swap,\n            TransactionType.bridgeApproval,\n            TransactionType.swapApproval,\n          ].includes(type) &&\n          [\n            TransactionStatus.failed,\n            TransactionStatus.dropped,\n            TransactionStatus.rejected,\n          ].includes(status)\n        ) {\n          // Mark tx as failed in txHistory\n          this.#markTxAsFailed(transactionMeta);\n          // Track failed event\n          if (status !== TransactionStatus.rejected) {\n            // Look up history by txMetaId first, then by actionId (for pre-submission failures)\n            let historyKey: string | undefined;\n            if (this.state.txHistory[txMetaId]) {\n              historyKey = txMetaId;\n            } else if (actionId && this.state.txHistory[actionId]) {\n              historyKey = actionId;\n            }\n\n            this.#trackUnifiedSwapBridgeEvent(\n              UnifiedSwapBridgeEventName.Failed,\n              historyKey ?? txMetaId,\n              getEVMTxPropertiesFromTransactionMeta(transactionMeta),\n            );\n          }\n        }\n      },\n    );\n\n    this.messenger.subscribe(\n      'TransactionController:transactionConfirmed',\n      (transactionMeta) => {\n        const { type, id: txMetaId, chainId } = transactionMeta;\n        if (type === TransactionType.swap) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMetaId,\n          );\n        }\n        if (type === TransactionType.bridge && !isNonEvmChainId(chainId)) {\n          this.#startPollingForTxId(txMetaId);\n        }\n      },\n    );\n\n    // If you close the extension, but keep the browser open, the polling continues\n    // If you close the browser, the polling stops\n    // Check for historyItems that do not have a status of complete and restart polling\n    this.#restartPollingForIncompleteHistoryItems();\n  }\n\n  // Mark tx as failed in txHistory if either the approval or trade fails\n  readonly #markTxAsFailed = ({\n    id: txMetaId,\n    actionId,\n  }: TransactionMeta): void => {\n    // Look up by txMetaId first\n    let txHistoryKey: string | undefined = this.state.txHistory[txMetaId]\n      ? txMetaId\n      : undefined;\n\n    // If not found by txMetaId, try looking up by actionId (for pre-submission failures)\n    if (!txHistoryKey && actionId && this.state.txHistory[actionId]) {\n      txHistoryKey = actionId;\n    }\n\n    // If still not found, try looking up by approvalTxId\n    txHistoryKey ??= Object.keys(this.state.txHistory).find(\n      (key) => this.state.txHistory[key].approvalTxId === txMetaId,\n    );\n\n    if (!txHistoryKey) {\n      return;\n    }\n    const key = txHistoryKey;\n    this.update((statusState) => {\n      statusState.txHistory[key].status.status = StatusTypes.FAILED;\n    });\n  };\n\n  resetState = (): void => {\n    this.update((state) => {\n      state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n    });\n  };\n\n  wipeBridgeStatus = ({\n    address,\n    ignoreNetwork,\n  }: {\n    address: string;\n    ignoreNetwork: boolean;\n  }): void => {\n    // Wipe all networks for this address\n    if (ignoreNetwork) {\n      this.update((state) => {\n        state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n      });\n    } else {\n      const { selectedNetworkClientId } = this.messenger.call(\n        'NetworkController:getState',\n      );\n      const selectedNetworkClient = this.messenger.call(\n        'NetworkController:getNetworkClientById',\n        selectedNetworkClientId,\n      );\n      const selectedChainId = selectedNetworkClient.configuration.chainId;\n\n      this.#wipeBridgeStatusByChainId(address, selectedChainId);\n    }\n  };\n\n  /**\n   * Resets the attempts counter for a bridge transaction history item\n   * and restarts polling if it was previously stopped due to max attempts\n   *\n   * @param identifier - Object containing either txMetaId or txHash to identify the history item\n   * @param identifier.txMetaId - The transaction meta ID\n   * @param identifier.txHash - The transaction hash\n   */\n  restartPollingForFailedAttempts = (identifier: {\n    txMetaId?: string;\n    txHash?: string;\n  }): void => {\n    const { txMetaId, txHash } = identifier;\n\n    if (!txMetaId && !txHash) {\n      throw new Error('Either txMetaId or txHash must be provided');\n    }\n\n    // Find the history item by txMetaId or txHash\n    let targetTxMetaId: string | undefined;\n\n    if (txMetaId) {\n      // Direct lookup by txMetaId\n      if (this.state.txHistory[txMetaId]) {\n        targetTxMetaId = txMetaId;\n      }\n    } else if (txHash) {\n      // Search by txHash in status.srcChain.txHash\n      targetTxMetaId = Object.keys(this.state.txHistory).find(\n        (id) => this.state.txHistory[id].status.srcChain.txHash === txHash,\n      );\n    }\n\n    if (!targetTxMetaId) {\n      throw new Error(\n        `No bridge transaction history found for ${\n          txMetaId ? `txMetaId: ${txMetaId}` : `txHash: ${txHash}`\n        }`,\n      );\n    }\n\n    const historyItem = this.state.txHistory[targetTxMetaId];\n\n    // Capture attempts count before resetting for metrics\n    const previousAttempts = historyItem.attempts?.counter ?? 0;\n\n    // Reset the attempts counter\n    this.update((state) => {\n      if (targetTxMetaId) {\n        state.txHistory[targetTxMetaId].attempts = undefined;\n      }\n    });\n\n    // Restart polling if it was stopped and this tx still needs status updates\n    if (this.#shouldPollHistoryItem(historyItem)) {\n      // Check if polling was stopped (no active polling token)\n      const existingPollingToken =\n        this.#pollingTokensByTxMetaId[targetTxMetaId];\n\n      if (!existingPollingToken) {\n        // Restart polling\n        this.#startPollingForTxId(targetTxMetaId);\n\n        // Track polling manually restarted event\n        if (!historyItem.featureId) {\n          const selectedAccount = this.messenger.call(\n            'AccountsController:getAccountByAddress',\n            historyItem.account,\n          );\n          const requestParams = getRequestParamFromHistory(historyItem);\n          const requestMetadata = getRequestMetadataFromHistory(\n            historyItem,\n            selectedAccount,\n          );\n          const { security_warnings: _, ...metadataWithoutWarnings } =\n            requestMetadata;\n\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.PollingStatusUpdated,\n            targetTxMetaId,\n            {\n              ...getTradeDataFromHistory(historyItem),\n              ...getPriceImpactFromQuote(historyItem.quote),\n              ...metadataWithoutWarnings,\n              chain_id_source: requestParams.chain_id_source,\n              chain_id_destination: requestParams.chain_id_destination,\n              token_symbol_source: requestParams.token_symbol_source,\n              token_symbol_destination: requestParams.token_symbol_destination,\n              action_type: MetricsActionType.SWAPBRIDGE_V1,\n              polling_status: PollingStatus.ManuallyRestarted,\n              retry_attempts: previousAttempts,\n            },\n          );\n        }\n      }\n    }\n  };\n\n  /**\n   * Gets a bridge history item from the history by its transaction meta ID\n   *\n   * @param txMetaId - The transaction meta ID to look up\n   * @returns The bridge history item if found, undefined otherwise\n   */\n  getBridgeHistoryItemByTxMetaId = (\n    txMetaId: string,\n  ): BridgeHistoryItem | undefined => {\n    return this.state.txHistory[txMetaId];\n  };\n\n  /**\n   * Restart polling for txs that are not in a final state\n   * This is called during initialization\n   */\n  readonly #restartPollingForIncompleteHistoryItems = (): void => {\n    // Check for historyItems that do not have a status of complete and restart polling\n    const { txHistory } = this.state;\n    const historyItems = Object.values(txHistory);\n    const incompleteHistoryItems = historyItems\n      .filter(\n        (historyItem) =>\n          historyItem.status.status === StatusTypes.PENDING ||\n          historyItem.status.status === StatusTypes.UNKNOWN,\n      )\n      // Only poll items with txMetaId (post-submission items)\n      .filter(\n        (\n          historyItem,\n        ): historyItem is BridgeHistoryItem & { txMetaId: string } =>\n          Boolean(historyItem.txMetaId),\n      )\n      .filter((historyItem) => {\n        // Check if we are already polling this tx, if so, skip restarting polling for that\n        const pollingToken =\n          this.#pollingTokensByTxMetaId[historyItem.txMetaId];\n        return !pollingToken;\n      })\n      // Only restart polling for items that still require status updates\n      .filter((historyItem) => {\n        return this.#shouldPollHistoryItem(historyItem);\n      });\n\n    incompleteHistoryItems.forEach((historyItem) => {\n      const bridgeTxMetaId = historyItem.txMetaId;\n      const shouldSkipFetch = shouldSkipFetchDueToFetchFailures(\n        historyItem.attempts,\n      );\n      if (shouldSkipFetch) {\n        return;\n      }\n\n      // We manually call startPolling() here rather than go through startPollingForBridgeTxStatus()\n      // because we don't want to overwrite the existing historyItem in state\n      this.#startPollingForTxId(bridgeTxMetaId);\n    });\n  };\n\n  readonly #addTxToHistory = (\n    startPollingForBridgeTxStatusArgs: StartPollingForBridgeTxStatusArgsSerialized,\n    actionId?: string,\n  ): void => {\n    const {\n      bridgeTxMeta,\n      statusRequest,\n      quoteResponse,\n      startTime,\n      slippagePercentage,\n      initialDestAssetBalance,\n      targetContractAddress,\n      approvalTxId,\n      isStxEnabled,\n      location,\n      accountAddress: selectedAddress,\n    } = startPollingForBridgeTxStatusArgs;\n\n    // Determine the key for this history item:\n    // - For pre-submission (non-batch EVM): use actionId\n    // - For post-submission or other cases: use bridgeTxMeta.id\n    const historyKey = getHistoryKey(actionId, bridgeTxMeta?.id);\n\n    // Write all non-status fields to state so we can reference the quote in Activity list without the Bridge API\n    // We know it's in progress but not the exact status yet\n    const txHistoryItem: BridgeHistoryItem = {\n      txMetaId: bridgeTxMeta?.id,\n      actionId,\n      originalTransactionId:\n        (bridgeTxMeta as unknown as { originalTransactionId: string })\n          ?.originalTransactionId || bridgeTxMeta?.id, // Keep original for intent transactions\n      batchId: bridgeTxMeta?.batchId,\n      quote: quoteResponse.quote,\n      startTime,\n      estimatedProcessingTimeInSeconds:\n        quoteResponse.estimatedProcessingTimeInSeconds,\n      slippagePercentage,\n      pricingData: {\n        amountSent: quoteResponse.sentAmount?.amount ?? '0',\n        amountSentInUsd: quoteResponse.sentAmount?.usd ?? undefined,\n        quotedGasInUsd: quoteResponse.gasFee?.effective?.usd ?? undefined,\n        quotedReturnInUsd: quoteResponse.toTokenAmount?.usd ?? undefined,\n        quotedGasAmount: quoteResponse.gasFee?.effective?.amount ?? undefined,\n      },\n      initialDestAssetBalance,\n      targetContractAddress,\n      account: selectedAddress,\n      status: {\n        // We always have a PENDING status when we start polling for a tx, don't need the Bridge API for that\n        // Also we know the bare minimum fields for status at this point in time\n        status: StatusTypes.PENDING,\n        srcChain: {\n          chainId: statusRequest.srcChainId,\n          txHash: statusRequest.srcTxHash,\n        },\n      },\n      hasApprovalTx: Boolean(quoteResponse.approval),\n      approvalTxId,\n      isStxEnabled: isStxEnabled ?? false,\n      featureId: quoteResponse.featureId,\n      location,\n    };\n    this.update((state) => {\n      // Use actionId as key for pre-submission, or txMeta.id for post-submission\n      state.txHistory[historyKey] = txHistoryItem;\n    });\n  };\n\n  /**\n   * Rekeys a history item from actionId to txMeta.id after successful submission.\n   * Also updates txMetaId and srcTxHash which weren't available pre-submission.\n   *\n   * @param actionId - The actionId used as the temporary key for the history item\n   * @param txMeta - The transaction meta from the successful submission\n   * @param txMeta.id - The transaction meta id to use as the new key\n   * @param txMeta.hash - The transaction hash to set on the history item\n   */\n  readonly #rekeyHistoryItem = (\n    actionId: string,\n    txMeta: { id: string; hash?: string },\n  ): void => {\n    this.update((state) => {\n      rekeyHistoryItemInState(state, actionId, txMeta);\n    });\n  };\n\n  readonly #startPollingForTxId = (txId: string): void => {\n    // If we are already polling for this tx, stop polling for it before restarting\n    const existingPollingToken = this.#pollingTokensByTxMetaId[txId];\n    if (existingPollingToken) {\n      this.stopPollingByPollingToken(existingPollingToken);\n    }\n\n    const txHistoryItem = this.state.txHistory[txId];\n    if (!txHistoryItem) {\n      return;\n    }\n    if (this.#shouldPollHistoryItem(txHistoryItem)) {\n      this.#pollingTokensByTxMetaId[txId] = this.startPolling({\n        bridgeTxMetaId: txId,\n      });\n    }\n  };\n\n  readonly #shouldPollHistoryItem = (\n    historyItem: BridgeHistoryItem,\n  ): boolean => {\n    const isIntent = Boolean(historyItem?.quote?.intent);\n    const isBridgeTx = isCrossChain(\n      historyItem.quote.srcChainId,\n      historyItem.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(historyItem.quote.srcChainId);\n\n    return [isBridgeTx, isIntent, isTronTx].some(Boolean);\n  };\n\n  /**\n   * @deprecated For EVM/Solana swap/bridge txs we add tx to history in submitTx()\n   * For Solana swap/bridge we start polling in submitTx()\n   * For EVM bridge we listen for 'TransactionController:transactionConfirmed' and start polling there\n   * No clients currently call this, safe to remove in future versions\n   *\n   * Adds tx to history and starts polling for the bridge tx status\n   *\n   * @param txHistoryMeta - The parameters for creating the history item\n   */\n  startPollingForBridgeTxStatus = (\n    txHistoryMeta: StartPollingForBridgeTxStatusArgsSerialized,\n  ): void => {\n    const { bridgeTxMeta } = txHistoryMeta;\n\n    if (!bridgeTxMeta?.id) {\n      throw new Error(\n        'Cannot start polling: bridgeTxMeta.id is required for polling',\n      );\n    }\n\n    this.#addTxToHistory(txHistoryMeta);\n    this.#startPollingForTxId(bridgeTxMeta.id);\n  };\n\n  // This will be called after you call this.startPolling()\n  // The args passed in are the args you passed in to startPolling()\n  _executePoll = async (\n    pollingInput: BridgeStatusPollingInput,\n  ): Promise<void> => {\n    await this.#fetchBridgeTxStatus(pollingInput);\n  };\n\n  #getMultichainSelectedAccount(\n    accountAddress: string,\n  ):\n    | AccountsControllerState['internalAccounts']['accounts'][string]\n    | undefined {\n    return this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      accountAddress,\n    );\n  }\n\n  /**\n   * Handles the failure to fetch the bridge tx status\n   * We eventually stop polling for the tx if we fail too many times\n   * Failures (500 errors) can be due to:\n   * - The srcTxHash not being available immediately for STX\n   * - The srcTxHash being invalid for the chain. This case will never resolve so we stop polling for it to avoid hammering the Bridge API forever.\n   *\n   * @param bridgeTxMetaId - The txMetaId of the bridge tx\n   */\n  readonly #handleFetchFailure = (bridgeTxMetaId: string): void => {\n    const { attempts } = this.state.txHistory[bridgeTxMetaId];\n\n    const newAttempts = attempts\n      ? {\n          counter: attempts.counter + 1,\n          lastAttemptTime: Date.now(),\n        }\n      : {\n          counter: 1,\n          lastAttemptTime: Date.now(),\n        };\n\n    // If we've failed too many times, stop polling for the tx\n    const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n    if (newAttempts.counter >= MAX_ATTEMPTS && pollingToken) {\n      this.stopPollingByPollingToken(pollingToken);\n      delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      // Track max polling reached event\n      const historyItem = this.state.txHistory[bridgeTxMetaId];\n      if (historyItem && !historyItem.featureId) {\n        const selectedAccount = this.messenger.call(\n          'AccountsController:getAccountByAddress',\n          historyItem.account,\n        );\n        const requestParams = getRequestParamFromHistory(historyItem);\n        const requestMetadata = getRequestMetadataFromHistory(\n          historyItem,\n          selectedAccount,\n        );\n        const { security_warnings: _, ...metadataWithoutWarnings } =\n          requestMetadata;\n\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.PollingStatusUpdated,\n          bridgeTxMetaId,\n          {\n            ...getTradeDataFromHistory(historyItem),\n            ...getPriceImpactFromQuote(historyItem.quote),\n            ...metadataWithoutWarnings,\n            chain_id_source: requestParams.chain_id_source,\n            chain_id_destination: requestParams.chain_id_destination,\n            token_symbol_source: requestParams.token_symbol_source,\n            token_symbol_destination: requestParams.token_symbol_destination,\n            action_type: MetricsActionType.SWAPBRIDGE_V1,\n            polling_status: PollingStatus.MaxPollingReached,\n            retry_attempts: newAttempts.counter,\n          },\n        );\n      }\n    }\n\n    // Update the attempts counter\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].attempts = newAttempts;\n    });\n  };\n\n  readonly #fetchBridgeTxStatus = async ({\n    bridgeTxMetaId,\n  }: FetchBridgeTxStatusArgs): Promise<void> => {\n    // 1. Check for history item\n\n    const { txHistory } = this.state;\n    const historyItem = txHistory[bridgeTxMetaId];\n    if (!historyItem) {\n      return;\n    }\n\n    // 2. Check for previous failures\n\n    if (shouldSkipFetchDueToFetchFailures(historyItem.attempts)) {\n      return;\n    }\n\n    // 3. Fetch transcation status\n\n    try {\n      let status: BridgeHistoryItem['status'];\n      let validationFailures: string[] = [];\n      let intentTranslation: IntentStatusTranslation | null = null;\n      let intentOrderStatus: string | undefined;\n\n      const isIntent = Boolean(historyItem.quote.intent);\n\n      if (isIntent) {\n        const { srcChainId } = historyItem.quote;\n\n        const intentApi = new IntentApiImpl(\n          this.#config.customBridgeApiBaseUrl,\n          this.#fetchFn,\n        );\n        const intentOrder = await intentApi.getOrderStatus(\n          bridgeTxMetaId,\n          historyItem.quote.intent?.protocol ?? '',\n          srcChainId.toString(),\n          this.#clientId,\n        );\n\n        intentOrderStatus = intentOrder.status;\n        intentTranslation = translateIntentOrderToBridgeStatus(\n          intentOrder,\n          srcChainId,\n          historyItem.status.srcChain.txHash,\n        );\n        status = intentTranslation.status;\n      } else {\n        // We try here because we receive 500 errors from Bridge API if we try to fetch immediately after submitting the source tx\n        // Oddly mostly happens on Optimism, never on Arbitrum. By the 2nd fetch, the Bridge API responds properly.\n        // Also srcTxHash may not be available immediately for STX, so we don't want to fetch in those cases\n        const srcTxHash = this.#getSrcTxHash(bridgeTxMetaId);\n        if (!srcTxHash) {\n          return;\n        }\n\n        this.#updateSrcTxHash(bridgeTxMetaId, srcTxHash);\n\n        const statusRequest = getStatusRequestWithSrcTxHash(\n          historyItem.quote,\n          srcTxHash,\n        );\n        const response = await fetchBridgeTxStatus(\n          statusRequest,\n          this.#clientId,\n          this.#fetchFn,\n          this.#config.customBridgeApiBaseUrl,\n        );\n        status = response.status;\n        validationFailures = response.validationFailures;\n      }\n\n      if (validationFailures.length > 0) {\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.StatusValidationFailed,\n          bridgeTxMetaId,\n          {\n            failures: validationFailures,\n            refresh_count: historyItem.attempts?.counter ?? 0,\n          },\n        );\n        throw new Error(\n          `Bridge status validation failed: ${validationFailures.join(', ')}`,\n        );\n      }\n\n      // 4. Create bridge history item\n\n      const newBridgeHistoryItem = {\n        ...historyItem,\n        status,\n        completionTime:\n          status.status === StatusTypes.COMPLETE ||\n          status.status === StatusTypes.FAILED\n            ? Date.now()\n            : undefined, // TODO make this more accurate by looking up dest txHash block time\n        attempts: undefined,\n      };\n\n      // No need to purge these on network change or account change, TransactionController does not purge either.\n      // TODO In theory we can skip checking status if it's not the current account/network\n      // we need to keep track of the account that this is associated with as well so that we don't show it in Activity list for other accounts\n      // First stab at this will not stop polling when you are on a different account\n      this.update((state) => {\n        state.txHistory[bridgeTxMetaId] = newBridgeHistoryItem;\n      });\n\n      if (isIntent && intentTranslation && intentOrderStatus) {\n        this.#intentStatusManager.syncTransactionFromIntentStatus(\n          bridgeTxMetaId,\n          historyItem,\n          intentTranslation,\n          intentOrderStatus,\n        );\n      }\n\n      // 5. After effects\n\n      const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      const isFinalStatus =\n        status.status === StatusTypes.COMPLETE ||\n        status.status === StatusTypes.FAILED;\n\n      if (isFinalStatus && pollingToken) {\n        this.stopPollingByPollingToken(pollingToken);\n        delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n        // Skip tracking events when featureId is set (i.e. PERPS)\n        if (historyItem.featureId) {\n          return;\n        }\n\n        if (status.status === StatusTypes.COMPLETE) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            bridgeTxMetaId,\n          );\n          this.messenger.publish(\n            'BridgeStatusController:destinationTransactionCompleted',\n            historyItem.quote.destAsset.assetId,\n          );\n        }\n        if (status.status === StatusTypes.FAILED) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Failed,\n            bridgeTxMetaId,\n          );\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to fetch bridge tx status', error);\n      this.#handleFetchFailure(bridgeTxMetaId);\n    }\n  };\n\n  readonly #getSrcTxHash = (bridgeTxMetaId: string): string | undefined => {\n    const { txHistory } = this.state;\n    // Prefer the srcTxHash from bridgeStatusState so we don't have to l ook up in TransactionController\n    // But it is possible to have bridgeHistoryItem in state without the srcTxHash yet when it is an STX\n    const srcTxHash = txHistory[bridgeTxMetaId].status.srcChain.txHash;\n\n    if (srcTxHash) {\n      return srcTxHash;\n    }\n\n    // Look up in TransactionController if txMeta has been updated with the srcTxHash\n    const txControllerState = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = txControllerState.transactions.find(\n      (tx: TransactionMeta) => tx.id === bridgeTxMetaId,\n    );\n    return txMeta?.hash;\n  };\n\n  readonly #updateSrcTxHash = (\n    bridgeTxMetaId: string,\n    srcTxHash: string,\n  ): void => {\n    const { txHistory } = this.state;\n    if (txHistory[bridgeTxMetaId].status.srcChain.txHash) {\n      return;\n    }\n\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].status.srcChain.txHash = srcTxHash;\n    });\n  };\n\n  // Wipes the bridge status for the given address and chainId\n  // Will match only source chainId to the selectedChainId\n  readonly #wipeBridgeStatusByChainId = (\n    address: string,\n    selectedChainId: Hex,\n  ): void => {\n    const sourceTxMetaIdsToDelete = Object.keys(this.state.txHistory).filter(\n      (txMetaId) => {\n        const bridgeHistoryItem = this.state.txHistory[txMetaId];\n\n        const hexSourceChainId = numberToHex(\n          bridgeHistoryItem.quote.srcChainId,\n        );\n\n        return (\n          bridgeHistoryItem.account === address &&\n          hexSourceChainId === selectedChainId\n        );\n      },\n    );\n\n    sourceTxMetaIdsToDelete.forEach((sourceTxMetaId) => {\n      const pollingToken = this.#pollingTokensByTxMetaId[sourceTxMetaId];\n\n      if (pollingToken) {\n        this.stopPollingByPollingToken(\n          this.#pollingTokensByTxMetaId[sourceTxMetaId],\n        );\n      }\n    });\n\n    this.update((state) => {\n      state.txHistory = sourceTxMetaIdsToDelete.reduce(\n        (acc, sourceTxMetaId) => {\n          delete acc[sourceTxMetaId];\n          return acc;\n        },\n        state.txHistory,\n      );\n    });\n  };\n\n  /**\n   * ******************************************************\n   * TX SUBMISSION HANDLING\n   *******************************************************\n   */\n\n  /**\n   * Submits the transaction to the snap using the new unified ClientRequest interface\n   * Works for all non-EVM chains (Solana, BTC, Tron)\n   * This adds an approval tx to the ApprovalsController in the background\n   * The client needs to handle the approval tx by redirecting to the confirmation page with the approvalTxId in the URL\n   *\n   * @param trade - The trade data (can be approval or main trade)\n   * @param quoteResponse - The quote response containing metadata\n   * @param selectedAccount - The account to submit the transaction for\n   * @returns The transaction meta\n   */\n  readonly #handleNonEvmTx = async (\n    trade: Trade,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    selectedAccount: AccountsControllerState['internalAccounts']['accounts'][string],\n  ): Promise<TransactionMeta> => {\n    if (!selectedAccount.metadata?.snap?.id) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined snap id',\n      );\n    }\n\n    const request = getClientRequest(\n      trade,\n      quoteResponse.quote.srcChainId,\n      selectedAccount,\n    );\n    const requestResponse = (await this.messenger.call(\n      'SnapController:handleRequest',\n      request,\n    )) as\n      | string\n      | { transactionId: string }\n      | { result: Record<string, string> }\n      | { signature: string };\n\n    // Create quote response with the specified trade\n    // This allows the same method to handle both approvals and main trades\n    const txQuoteResponse: QuoteResponse<Trade> & QuoteMetadata = {\n      ...quoteResponse,\n      trade,\n    };\n\n    const txMeta = handleNonEvmTxResponse(\n      requestResponse,\n      txQuoteResponse,\n      selectedAccount,\n    );\n\n    // TODO remove this eventually, just returning it now to match extension behavior\n    // OR if the snap can propagate the snapRequestId or keyringReqId to the ApprovalsController, this can return the approvalTxId instead and clients won't need to subscribe to the ApprovalsController state to redirect\n    return txMeta;\n  };\n\n  readonly #waitForHashAndReturnFinalTxMeta = async (\n    hashPromise?: Awaited<\n      ReturnType<TransactionController['addTransaction']>\n    >['result'],\n  ): Promise<TransactionMeta> => {\n    const transactionHash = await hashPromise;\n    const finalTransactionMeta: TransactionMeta | undefined = this.messenger\n      .call('TransactionController:getState')\n      .transactions.find((tx: TransactionMeta) => tx.hash === transactionHash);\n    if (!finalTransactionMeta) {\n      throw new Error(\n        'Failed to submit cross-chain swap tx: txMeta for txHash was not found',\n      );\n    }\n    return finalTransactionMeta;\n  };\n\n  // Waits until a given transaction (by id) reaches confirmed/finalized status or fails/times out.\n  readonly #waitForTxConfirmation = async (\n    txId: string,\n    {\n      timeoutMs = 5 * 60_000, // 5 minutes default\n      pollMs = 3_000,\n    }: { timeoutMs?: number; pollMs?: number } = {},\n  ): Promise<TransactionMeta> => {\n    return await waitForTxConfirmation(this.messenger, txId, {\n      timeoutMs,\n      pollMs,\n    });\n  };\n\n  readonly #handleApprovalTx = async (\n    isBridgeTx: boolean,\n    srcChainId: QuoteResponse['quote']['srcChainId'],\n    approval?: TxData,\n    resetApproval?: TxData,\n    requireApproval?: boolean,\n  ): Promise<TransactionMeta | undefined> => {\n    if (approval) {\n      const approveTx = async (): Promise<TransactionMeta> => {\n        await this.#handleUSDTAllowanceReset(resetApproval);\n\n        const approvalTxMeta = await this.#handleEvmTransaction({\n          transactionType: isBridgeTx\n            ? TransactionType.bridgeApproval\n            : TransactionType.swapApproval,\n          trade: approval,\n          requireApproval,\n        });\n\n        await handleApprovalDelay(srcChainId);\n        return approvalTxMeta;\n      };\n\n      return await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionApprovalCompleted\n            : TraceName.SwapTransactionApprovalCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(srcChainId),\n            stxEnabled: false,\n          },\n        },\n        approveTx,\n      );\n    }\n\n    return undefined;\n  };\n\n  /**\n   * Submits an EVM transaction to the TransactionController\n   *\n   * @param params - The parameters for the transaction\n   * @param params.transactionType - The type of transaction to submit\n   * @param params.trade - The trade data to confirm\n   * @param params.requireApproval - Whether to require approval for the transaction\n   * @param params.txFee - Optional gas fee parameters from the quote (used when gasIncluded is true)\n   * @param params.txFee.maxFeePerGas - The maximum fee per gas from the quote\n   * @param params.txFee.maxPriorityFeePerGas - The maximum priority fee per gas from the quote\n   * @param params.actionId - Optional actionId for pre-submission history (if not provided, one is generated)\n   * @returns The transaction meta\n   */\n  readonly #handleEvmTransaction = async ({\n    transactionType,\n    trade,\n    requireApproval = false,\n    txFee,\n    actionId: providedActionId,\n  }: {\n    transactionType: TransactionType;\n    trade: TxData;\n    requireApproval?: boolean;\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string };\n    actionId?: string;\n  }): Promise<TransactionMeta> => {\n    // Use provided actionId (for pre-submission history) or generate one\n    const actionId = providedActionId ?? generateActionId().toString();\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      trade.from,\n    );\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: unknown account in trade data',\n      );\n    }\n    const hexChainId = formatChainIdToHex(trade.chainId);\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      hexChainId,\n    );\n\n    const requestOptions = {\n      actionId,\n      networkClientId,\n      requireApproval,\n      type: transactionType,\n      origin: 'metamask',\n    };\n    // Exclude gasLimit from trade to avoid type issues (it can be null)\n    const { gasLimit: tradeGasLimit, ...tradeWithoutGasLimit } = trade;\n\n    const transactionParams: Parameters<\n      TransactionController['addTransaction']\n    >[0] = {\n      ...tradeWithoutGasLimit,\n      chainId: hexChainId,\n      // Only add gasLimit and gas if they're valid (not undefined/null/zero)\n      ...(tradeGasLimit &&\n        tradeGasLimit !== 0 && {\n          gasLimit: tradeGasLimit.toString(),\n          gas: tradeGasLimit.toString(),\n        }),\n    };\n    const transactionParamsWithMaxGas: TransactionParams = {\n      ...transactionParams,\n      ...(await this.#calculateGasFees(\n        transactionParams,\n        networkClientId,\n        hexChainId,\n        txFee,\n      )),\n    };\n\n    const { result } = await this.#addTransactionFn(\n      transactionParamsWithMaxGas,\n      requestOptions,\n    );\n\n    return await this.#waitForHashAndReturnFinalTxMeta(result);\n  };\n\n  readonly #handleUSDTAllowanceReset = async (\n    resetApproval?: TxData,\n  ): Promise<void> => {\n    if (resetApproval) {\n      await this.#handleEvmTransaction({\n        transactionType: TransactionType.bridgeApproval,\n        trade: resetApproval,\n      });\n    }\n  };\n\n  readonly #calculateGasFees = async (\n    transactionParams: TransactionParams,\n    networkClientId: string,\n    chainId: Hex,\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string },\n  ): Promise<{\n    maxFeePerGas: Hex;\n    maxPriorityFeePerGas: Hex;\n    gas?: Hex;\n  }> => {\n    const { gas } = transactionParams;\n    // If txFee is provided (gasIncluded case), use the quote's gas fees\n    // Convert to hex since txFee values from the quote are decimal strings\n    if (txFee) {\n      return {\n        maxFeePerGas: toHex(txFee.maxFeePerGas ?? 0),\n        maxPriorityFeePerGas: toHex(txFee.maxPriorityFeePerGas ?? 0),\n        gas: gas ? toHex(gas) : undefined,\n      };\n    }\n\n    const { gasFeeEstimates } = this.messenger.call(\n      'GasFeeController:getState',\n    );\n    const { estimates: txGasFeeEstimates } = await this.#estimateGasFeeFn({\n      transactionParams,\n      chainId,\n      networkClientId,\n    });\n    const { maxFeePerGas, maxPriorityFeePerGas } = getTxGasEstimates({\n      networkGasFeeEstimates: gasFeeEstimates,\n      txGasFeeEstimates,\n    });\n\n    return {\n      maxFeePerGas,\n      maxPriorityFeePerGas,\n      gas: gas ? toHex(gas) : undefined,\n    };\n  };\n\n  /**\n   * Submits batched EVM transactions to the TransactionController\n   *\n   * @param args - The parameters for the transaction\n   * @param args.isBridgeTx - Whether the transaction is a bridge transaction\n   * @param args.trade - The trade data to confirm\n   * @param args.approval - The approval data to confirm\n   * @param args.resetApproval - The ethereum:USDT reset approval data to confirm\n   * @param args.quoteResponse - The quote response\n   * @param args.requireApproval - Whether to require approval for the transaction\n   * @returns The approvalMeta and tradeMeta for the batched transaction\n   */\n  readonly #handleEvmTransactionBatch = async (\n    args: Omit<\n      Parameters<typeof getAddTransactionBatchParams>[0],\n      'messenger' | 'estimateGasFeeFn'\n    >,\n  ): Promise<{\n    approvalMeta?: TransactionMeta;\n    tradeMeta: TransactionMeta;\n  }> => {\n    const transactionParams = await getAddTransactionBatchParams({\n      messenger: this.messenger,\n      estimateGasFeeFn: this.#estimateGasFeeFn,\n      ...args,\n    });\n    const txDataByType = {\n      [TransactionType.bridgeApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridgeApproval,\n      )?.params.data,\n      [TransactionType.swapApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swapApproval,\n      )?.params.data,\n      [TransactionType.bridge]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridge,\n      )?.params.data,\n      [TransactionType.swap]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swap,\n      )?.params.data,\n    };\n\n    const { batchId } = await this.#addTransactionBatchFn(transactionParams);\n\n    const { approvalMeta, tradeMeta } = findAndUpdateTransactionsInBatch({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n      batchId,\n      txDataByType,\n    });\n\n    if (!tradeMeta) {\n      throw new Error(\n        'Failed to update cross-chain swap transaction batch: tradeMeta not found',\n      );\n    }\n\n    return { approvalMeta, tradeMeta };\n  };\n\n  /**\n   * Submits a cross-chain swap transaction\n   *\n   * @param accountAddress - The address of the account to submit the transaction for\n   * @param quoteResponse - The quote response\n   * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n   * @param quotesReceivedContext - The context for the QuotesReceived event\n   * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n   * @returns The transaction meta\n   */\n  submitTx = async (\n    accountAddress: string,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    isStxEnabledOnClient: boolean,\n    quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n    location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n  ): Promise<TransactionMeta & Partial<SolanaTransactionMeta>> => {\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n      // If trade is submitted before all quotes are loaded, the QuotesReceived event is published\n      // If the trade has a featureId, it means it was submitted outside of the Unified Swap and Bridge experience, so no QuotesReceived event is published\n      quoteResponse.featureId ? undefined : quotesReceivedContext,\n    );\n\n    const selectedAccount = this.#getMultichainSelectedAccount(accountAddress);\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined multichain account',\n      );\n    }\n    const isHardwareAccount = isHardwareWallet(selectedAccount);\n\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      isStxEnabledOnClient,\n      isHardwareAccount,\n      location,\n    );\n    // Emit Submitted event after submit button is clicked\n    !quoteResponse.featureId &&\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Submitted,\n        undefined,\n        preConfirmationProperties,\n      );\n\n    let txMeta: TransactionMeta & Partial<SolanaTransactionMeta>;\n    let approvalTxId: string | undefined;\n    const startTime = Date.now();\n\n    const isBridgeTx = isCrossChain(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(quoteResponse.quote.srcChainId);\n\n    // Submit non-EVM tx (Solana, BTC, Tron)\n    if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n      // Handle non-EVM approval if present (e.g., Tron token approvals)\n      if (quoteResponse.approval && isTronTrade(quoteResponse.approval)) {\n        const approvalTxMeta = await this.#trace(\n          {\n            name: isBridgeTx\n              ? TraceName.BridgeTransactionApprovalCompleted\n              : TraceName.SwapTransactionApprovalCompleted,\n            data: {\n              srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n              stxEnabled: false,\n            },\n          },\n          async () => {\n            try {\n              return quoteResponse.approval &&\n                isTronTrade(quoteResponse.approval)\n                ? await this.#handleNonEvmTx(\n                    quoteResponse.approval,\n                    quoteResponse,\n                    selectedAccount,\n                  )\n                : undefined;\n            } catch (error) {\n              !quoteResponse.featureId &&\n                this.#trackUnifiedSwapBridgeEvent(\n                  UnifiedSwapBridgeEventName.Failed,\n                  undefined,\n                  {\n                    error_message: (error as Error)?.message,\n                    ...preConfirmationProperties,\n                  },\n                );\n              throw error;\n            }\n          },\n        );\n\n        approvalTxId = approvalTxMeta?.id;\n\n        // Add delay after approval similar to EVM flow\n        await handleApprovalDelay(quoteResponse.quote.srcChainId);\n      }\n\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: false,\n          },\n        },\n        async () => {\n          try {\n            if (\n              !(\n                isTronTrade(quoteResponse.trade) ||\n                isBitcoinTrade(quoteResponse.trade) ||\n                typeof quoteResponse.trade === 'string'\n              )\n            ) {\n              throw new Error(\n                'Failed to submit cross-chain swap transaction: trade is not a non-EVM transaction',\n              );\n            }\n            return await this.#handleNonEvmTx(\n              quoteResponse.trade,\n              quoteResponse,\n              selectedAccount,\n            );\n          } catch (error) {\n            !quoteResponse.featureId &&\n              this.#trackUnifiedSwapBridgeEvent(\n                UnifiedSwapBridgeEventName.Failed,\n                txMeta?.id,\n                {\n                  error_message: (error as Error)?.message,\n                  ...preConfirmationProperties,\n                },\n              );\n            throw error;\n          }\n        },\n      );\n    } else {\n      // Submit EVM tx\n      // For hardware wallets on Mobile, this is fixes an issue where the Ledger does not get prompted for the 2nd approval\n      // Extension does not have this issue\n      const requireApproval =\n        this.#clientId === BridgeClientId.MOBILE && isHardwareAccount;\n\n      // Handle smart transactions if enabled\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: isStxEnabledOnClient,\n          },\n        },\n        async () => {\n          if (!isEvmTxData(quoteResponse.trade)) {\n            throw new Error(\n              'Failed to submit cross-chain swap transaction: trade is not an EVM transaction',\n            );\n          }\n          if (isStxEnabledOnClient || quoteResponse.quote.gasIncluded7702) {\n            const { tradeMeta, approvalMeta } =\n              await this.#handleEvmTransactionBatch({\n                isBridgeTx,\n                resetApproval: quoteResponse.resetApproval,\n                approval:\n                  quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n                    ? quoteResponse.approval\n                    : undefined,\n                trade: quoteResponse.trade,\n                quoteResponse,\n                requireApproval,\n              });\n\n            approvalTxId = approvalMeta?.id;\n            return tradeMeta;\n          }\n          // Set approval time and id if an approval tx is needed\n          const approvalTxMeta = await this.#handleApprovalTx(\n            isBridgeTx,\n            quoteResponse.quote.srcChainId,\n            quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n              ? quoteResponse.approval\n              : undefined,\n            quoteResponse.resetApproval,\n            requireApproval,\n          );\n\n          approvalTxId = approvalTxMeta?.id;\n\n          await handleMobileHardwareWalletDelay(requireApproval);\n\n          // Generate actionId for pre-submission history (non-batch EVM only)\n          const actionId = generateActionId().toString();\n\n          // Add pre-submission history keyed by actionId\n          // This ensures we have quote data available if transaction fails during submission\n          this.#addTxToHistory(\n            {\n              accountAddress: selectedAccount.address,\n              statusRequest: {\n                ...getStatusRequestParams(quoteResponse),\n                srcTxHash: '', // Not available yet\n              },\n              quoteResponse,\n              slippagePercentage: 0,\n              isStxEnabled: isStxEnabledOnClient,\n              startTime,\n              approvalTxId,\n              location,\n            },\n            actionId,\n          );\n\n          // Pass txFee when gasIncluded is true to use the quote's gas fees\n          // instead of re-estimating (which would fail for max native token swaps)\n          const tradeTxMeta = await this.#handleEvmTransaction({\n            transactionType: isBridgeTx\n              ? TransactionType.bridge\n              : TransactionType.swap,\n            trade: quoteResponse.trade,\n            requireApproval,\n            txFee: quoteResponse.quote.gasIncluded\n              ? quoteResponse.quote.feeData.txFee\n              : undefined,\n            actionId,\n          });\n\n          // On success, rekey from actionId to txMeta.id and update srcTxHash\n          this.#rekeyHistoryItem(actionId, tradeTxMeta);\n\n          return tradeTxMeta;\n        },\n      );\n    }\n\n    try {\n      // For non-batch EVM transactions, history was already added/rekeyed above\n      // Only add history here for non-EVM and batch EVM transactions\n      const isNonBatchEvm =\n        !isNonEvmChainId(quoteResponse.quote.srcChainId) &&\n        !isStxEnabledOnClient &&\n        !quoteResponse.quote.gasIncluded7702;\n\n      if (!isNonBatchEvm) {\n        // Add swap or bridge tx to history\n        this.#addTxToHistory({\n          accountAddress: selectedAccount.address,\n          bridgeTxMeta: txMeta, // Only the id field is used by the BridgeStatusController\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: txMeta.hash,\n          },\n          quoteResponse,\n          slippagePercentage: 0, // TODO include slippage provided by quote if using dynamic slippage, or slippage from quote request\n          isStxEnabled: isStxEnabledOnClient,\n          startTime,\n          approvalTxId,\n          location,\n        });\n      }\n\n      if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n        // Start polling for bridge tx status\n        this.#startPollingForTxId(txMeta.id);\n        // Track non-EVM Swap completed event\n        if (!(isBridgeTx || isTronTx)) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMeta.id,\n          );\n        }\n      }\n    } catch {\n      // Ignore errors here, we don't want to crash the app if this fails and tx submission succeeds\n    }\n    return txMeta;\n  };\n\n  /**\n   * UI-signed intent submission (fast path): the UI generates the EIP-712 signature and calls this with the raw signature.\n   * Here we submit the order to the intent provider and create a synthetic history entry for UX.\n   *\n   * @param params - Object containing intent submission parameters\n   * @param params.quoteResponse - Quote carrying intent data\n   * @param params.signature - Hex signature produced by eth_signTypedData_v4\n   * @param params.accountAddress - The EOA submitting the order\n   * @param params.location - The entry point from which the user initiated the swap or bridge\n   * @returns A lightweight TransactionMeta-like object for history linking\n   */\n  submitIntent = async (params: {\n    quoteResponse: QuoteResponse<TxData | string> & QuoteMetadata;\n    signature: string;\n    accountAddress: string;\n    location?: MetaMetricsSwapsEventSource;\n  }): Promise<Pick<TransactionMeta, 'id' | 'chainId' | 'type' | 'status'>> => {\n    const { quoteResponse, signature, accountAddress, location } = params;\n\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n    );\n\n    // Build pre-confirmation properties for error tracking parity with submitTx\n    const account = this.#getMultichainSelectedAccount(accountAddress);\n    const isHardwareAccount = Boolean(account) && isHardwareWallet(account);\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      false,\n      isHardwareAccount,\n      location,\n    );\n\n    try {\n      const intent = getIntentFromQuote(\n        quoteResponse as QuoteResponse & { quote: { intent?: Intent } },\n      );\n\n      // If backend provided an approval tx for this intent quote, submit it first (on-chain),\n      // then proceed with off-chain intent submission.\n      let approvalTxId: string | undefined;\n      if (quoteResponse.approval) {\n        const isBridgeTx = isCrossChain(\n          quoteResponse.quote.srcChainId,\n          quoteResponse.quote.destChainId,\n        );\n\n        // Handle approval silently for better UX in intent flows\n        const approvalTxMeta = await this.#handleApprovalTx(\n          isBridgeTx,\n          quoteResponse.quote.srcChainId,\n          quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n            ? quoteResponse.approval\n            : undefined,\n          quoteResponse.resetApproval,\n          /* requireApproval */ false,\n        );\n        approvalTxId = approvalTxMeta?.id;\n\n        if (approvalTxId) {\n          await this.#waitForTxConfirmation(approvalTxId);\n        }\n      }\n\n      const { srcChainId: chainId, requestId } = quoteResponse.quote;\n\n      const submissionParams = {\n        srcChainId: chainId.toString(),\n        quoteId: requestId,\n        signature,\n        order: intent.order,\n        userAddress: accountAddress,\n        aggregatorId: intent.protocol,\n      };\n      const intentApi = new IntentApiImpl(\n        this.#config.customBridgeApiBaseUrl,\n        this.#fetchFn,\n      );\n      const intentOrder = await intentApi.submitIntent(\n        submissionParams,\n        this.#clientId,\n      );\n\n      const orderUid = intentOrder.id;\n\n      // Determine transaction type: swap for same-chain, bridge for cross-chain\n      const isCrossChainTx = isCrossChain(\n        quoteResponse.quote.srcChainId,\n        quoteResponse.quote.destChainId,\n      );\n      const transactionType = isCrossChainTx\n        ? TransactionType.bridge\n        : TransactionType.swap;\n\n      // Create actual transaction in Transaction Controller first\n      const networkClientId = this.messenger.call(\n        'NetworkController:findNetworkClientIdByChainId',\n        formatChainIdToHex(chainId),\n      );\n\n      // This is a synthetic transaction whose purpose is to be able\n      // to track the order status via the history\n      const intentTransactionParams = {\n        chainId: formatChainIdToHex(chainId),\n        from: accountAddress,\n        to:\n          intent.settlementContract ??\n          '0x9008D19f58AAbd9eD0D60971565AA8510560ab41', // Default settlement contract\n        data: `0x${orderUid.slice(-8)}`, // Use last 8 chars of orderUid to make each transaction unique\n        value: '0x0',\n        gas: '0x5208', // Minimal gas for display purposes\n        gasPrice: '0x3b9aca00', // 1 Gwei - will be converted to EIP-1559 fees if network supports it\n      };\n\n      const { transactionMeta: txMetaPromise } = await this.#addTransactionFn(\n        intentTransactionParams,\n        {\n          origin: 'metamask',\n          actionId: generateActionId(),\n          requireApproval: false,\n          isStateOnly: true,\n          networkClientId,\n          type: transactionType,\n        },\n      );\n\n      const intentTxMeta = txMetaPromise;\n\n      // Map intent order status to TransactionController status\n      const initialTransactionStatus = mapIntentOrderStatusToTransactionStatus(\n        intentOrder.status,\n      );\n\n      // Update transaction with proper initial status based on intent order\n      const statusUpdatedTxMeta = {\n        ...intentTxMeta,\n        status: initialTransactionStatus,\n      };\n\n      // Update with actual transaction metadata\n      const syntheticMeta = {\n        ...statusUpdatedTxMeta,\n        isIntentTx: true,\n        orderUid,\n        intentType: isCrossChainTx ? 'bridge' : 'swap',\n      } as unknown as TransactionMeta;\n\n      // Record in bridge history with actual transaction metadata\n      try {\n        // Use orderId as the history key for intent transactions\n        const bridgeHistoryKey = orderUid;\n\n        // Create a bridge transaction metadata that includes the original txId\n        const bridgeTxMetaForHistory = {\n          ...syntheticMeta,\n          id: bridgeHistoryKey,\n          originalTransactionId: syntheticMeta.id, // Keep original txId for TransactionController updates\n        } as TransactionMeta;\n\n        const startTime = Date.now();\n\n        this.#addTxToHistory({\n          accountAddress,\n          bridgeTxMeta: bridgeTxMetaForHistory,\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: syntheticMeta.hash ?? '',\n          },\n          quoteResponse,\n          slippagePercentage: 0,\n          isStxEnabled: false,\n          approvalTxId,\n          startTime,\n          location,\n        });\n\n        // Start polling using the orderId key to route to intent manager\n        this.#startPollingForTxId(bridgeHistoryKey);\n      } catch (error) {\n        console.error(\n          ' [submitIntent] Failed to add to bridge history',\n          error,\n        );\n        // non-fatal but log the error\n      }\n      return syntheticMeta;\n    } catch (error) {\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Failed,\n        undefined,\n        {\n          error_message: (error as Error)?.message,\n          ...preConfirmationProperties,\n        },\n      );\n\n      throw error;\n    }\n  };\n\n  /**\n   * Tracks post-submission events for a cross-chain swap based on the history item\n   *\n   * @param eventName - The name of the event to track\n   * @param txMetaId - The txMetaId of the history item to track the event for\n   * @param eventProperties - The properties for the event\n   */\n  readonly #trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      | typeof UnifiedSwapBridgeEventName.Submitted\n      | typeof UnifiedSwapBridgeEventName.Failed\n      | typeof UnifiedSwapBridgeEventName.Completed\n      | typeof UnifiedSwapBridgeEventName.StatusValidationFailed\n      | typeof UnifiedSwapBridgeEventName.PollingStatusUpdated,\n  >(\n    eventName: EventName,\n    txMetaId?: string,\n    eventProperties?: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): void => {\n    const baseProperties = {\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n      location:\n        eventProperties?.location ??\n        (txMetaId ? this.state.txHistory?.[txMetaId]?.location : undefined) ??\n        MetaMetricsSwapsEventSource.MainView,\n      ...(eventProperties ?? {}),\n    };\n\n    // This will publish events for PERPS dropped tx failures as well\n    if (!txMetaId) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const historyItem: BridgeHistoryItem | undefined =\n      this.state.txHistory[txMetaId];\n\n    if (!historyItem) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const requestParamProperties = getRequestParamFromHistory(historyItem);\n    // Always publish StatusValidationFailed event, regardless of featureId\n    if (eventName === UnifiedSwapBridgeEventName.StatusValidationFailed) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        {\n          ...baseProperties,\n          chain_id_source: requestParamProperties.chain_id_source,\n          chain_id_destination: requestParamProperties.chain_id_destination,\n          token_address_source: requestParamProperties.token_address_source,\n          token_address_destination:\n            requestParamProperties.token_address_destination,\n          refresh_count: historyItem.attempts?.counter ?? 0,\n        },\n      );\n      return;\n    }\n\n    // Skip tracking all other events when featureId is set (i.e. PERPS)\n    if (historyItem.featureId) {\n      return;\n    }\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      historyItem.account,\n    );\n\n    const { transactions } = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === txMetaId,\n    );\n    const approvalTxMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === historyItem.approvalTxId,\n    );\n\n    const requiredEventProperties = {\n      ...baseProperties,\n      ...requestParamProperties,\n      ...getRequestMetadataFromHistory(historyItem, selectedAccount),\n      ...getTradeDataFromHistory(historyItem),\n      ...getTxStatusesFromHistory(historyItem),\n      ...getFinalizedTxProperties(historyItem, txMeta, approvalTxMeta),\n      ...getPriceImpactFromQuote(historyItem.quote),\n    };\n\n    this.messenger.call(\n      'BridgeController:trackUnifiedSwapBridgeEvent',\n      eventName,\n      requiredEventProperties,\n    );\n  };\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"bridge-status-controller.cjs","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AccountsControllerState } from '@metamask/accounts-controller';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type {\n  QuoteMetadata,\n  RequiredEventContextFromClient,\n  TxData,\n  QuoteResponse,\n  Intent,\n  Trade,\n} from '@metamask/bridge-controller';\nimport {\n  formatChainIdToHex,\n  isNonEvmChainId,\n  StatusTypes,\n  UnifiedSwapBridgeEventName,\n  formatChainIdToCaip,\n  isCrossChain,\n  isTronChainId,\n  isEvmTxData,\n  isHardwareWallet,\n  MetricsActionType,\n  MetaMetricsSwapsEventSource,\n  isBitcoinTrade,\n  isTronTrade,\n  AbortReason,\n  PollingStatus,\n} from '@metamask/bridge-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport { toHex } from '@metamask/controller-utils';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type {\n  TransactionController,\n  TransactionMeta,\n  TransactionParams,\n} from '@metamask/transaction-controller';\nimport { numberToHex } from '@metamask/utils';\nimport type { Hex } from '@metamask/utils';\n\nimport { IntentStatusManager } from './bridge-status-controller.intent';\nimport {\n  BRIDGE_PROD_API_BASE_URL,\n  BRIDGE_STATUS_CONTROLLER_NAME,\n  DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n  MAX_ATTEMPTS,\n  REFRESH_INTERVAL_MS,\n  TraceName,\n} from './constants';\nimport type {\n  BridgeStatusControllerState,\n  StartPollingForBridgeTxStatusArgsSerialized,\n  FetchFunction,\n  SolanaTransactionMeta,\n  BridgeHistoryItem,\n} from './types';\nimport type { BridgeStatusControllerMessenger } from './types';\nimport { BridgeClientId } from './types';\nimport {\n  fetchBridgeTxStatus,\n  getStatusRequestWithSrcTxHash,\n  shouldSkipFetchDueToFetchFailures,\n} from './utils/bridge-status';\nimport { getTxGasEstimates } from './utils/gas';\nimport {\n  IntentApiImpl,\n  IntentStatusTranslation,\n  mapIntentOrderStatusToTransactionStatus,\n  translateIntentOrderToBridgeStatus,\n} from './utils/intent-api';\nimport {\n  getFinalizedTxProperties,\n  getPriceImpactFromQuote,\n  getRequestMetadataFromHistory,\n  getRequestParamFromHistory,\n  getTradeDataFromHistory,\n  getEVMTxPropertiesFromTransactionMeta,\n  getTxStatusesFromHistory,\n  getPreConfirmationPropertiesFromQuote,\n} from './utils/metrics';\nimport {\n  findAndUpdateTransactionsInBatch,\n  getAddTransactionBatchParams,\n  getClientRequest,\n  getHistoryKey,\n  getIntentFromQuote,\n  getStatusRequestParams,\n  handleApprovalDelay,\n  handleMobileHardwareWalletDelay,\n  handleNonEvmTxResponse,\n  generateActionId,\n  waitForTxConfirmation,\n  rekeyHistoryItemInState,\n} from './utils/transaction';\n\nconst metadata: StateMetadata<BridgeStatusControllerState> = {\n  // We want to persist the bridge status state so that we can show the proper data for the Activity list\n  // basically match the behavior of TransactionController\n  txHistory: {\n    includeInStateLogs: true,\n    persist: true,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/** The input to start polling for the {@link BridgeStatusController} */\ntype BridgeStatusPollingInput = FetchBridgeTxStatusArgs;\n\ntype SrcTxMetaId = string;\nexport type FetchBridgeTxStatusArgs = {\n  bridgeTxMetaId: string;\n};\nexport class BridgeStatusController extends StaticIntervalPollingController<BridgeStatusPollingInput>()<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState,\n  BridgeStatusControllerMessenger\n> {\n  #pollingTokensByTxMetaId: Record<SrcTxMetaId, string> = {};\n\n  readonly #intentStatusManager: IntentStatusManager;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #config: {\n    customBridgeApiBaseUrl: string;\n  };\n\n  readonly #addTransactionFn: typeof TransactionController.prototype.addTransaction;\n\n  readonly #addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n\n  readonly #updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n\n  readonly #estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n\n  readonly #trace: TraceCallback;\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    fetchFn,\n    addTransactionFn,\n    addTransactionBatchFn,\n    updateTransactionFn,\n    estimateGasFeeFn,\n    config,\n    traceFn,\n  }: {\n    messenger: BridgeStatusControllerMessenger;\n    state?: Partial<BridgeStatusControllerState>;\n    clientId: BridgeClientId;\n    fetchFn: FetchFunction;\n    addTransactionFn: typeof TransactionController.prototype.addTransaction;\n    addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n    updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n    estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_STATUS_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      // Restore the persisted state\n      state: {\n        ...DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n        ...state,\n      },\n    });\n\n    this.#clientId = clientId;\n    this.#fetchFn = fetchFn;\n    this.#addTransactionFn = addTransactionFn;\n    this.#addTransactionBatchFn = addTransactionBatchFn;\n    this.#updateTransactionFn = updateTransactionFn;\n    this.#estimateGasFeeFn = estimateGasFeeFn;\n    this.#config = {\n      customBridgeApiBaseUrl:\n        config?.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n    };\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n    this.#intentStatusManager = new IntentStatusManager({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n    });\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:startPollingForBridgeTxStatus`,\n      this.startPollingForBridgeTxStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:wipeBridgeStatus`,\n      this.wipeBridgeStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitTx`,\n      this.submitTx.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitIntent`,\n      this.submitIntent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:restartPollingForFailedAttempts`,\n      this.restartPollingForFailedAttempts.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:getBridgeHistoryItemByTxMetaId`,\n      this.getBridgeHistoryItemByTxMetaId.bind(this),\n    );\n\n    // Set interval\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.messenger.subscribe(\n      'TransactionController:transactionFailed',\n      ({ transactionMeta }) => {\n        const { type, status, id: txMetaId, actionId } = transactionMeta;\n\n        if (\n          type &&\n          [\n            TransactionType.bridge,\n            TransactionType.swap,\n            TransactionType.bridgeApproval,\n            TransactionType.swapApproval,\n          ].includes(type) &&\n          [\n            TransactionStatus.failed,\n            TransactionStatus.dropped,\n            TransactionStatus.rejected,\n          ].includes(status)\n        ) {\n          // Mark tx as failed in txHistory\n          this.#markTxAsFailed(transactionMeta);\n          // Track failed event\n          if (status !== TransactionStatus.rejected) {\n            // Look up history by txMetaId first, then by actionId (for pre-submission failures)\n            let historyKey: string | undefined;\n            if (this.state.txHistory[txMetaId]) {\n              historyKey = txMetaId;\n            } else if (actionId && this.state.txHistory[actionId]) {\n              historyKey = actionId;\n            }\n\n            this.#trackUnifiedSwapBridgeEvent(\n              UnifiedSwapBridgeEventName.Failed,\n              historyKey ?? txMetaId,\n              getEVMTxPropertiesFromTransactionMeta(transactionMeta),\n            );\n          }\n        }\n      },\n    );\n\n    this.messenger.subscribe(\n      'TransactionController:transactionConfirmed',\n      (transactionMeta) => {\n        const { type, id: txMetaId, chainId } = transactionMeta;\n        if (type === TransactionType.swap) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMetaId,\n          );\n        }\n        if (type === TransactionType.bridge && !isNonEvmChainId(chainId)) {\n          this.#startPollingForTxId(txMetaId);\n        }\n      },\n    );\n\n    // If you close the extension, but keep the browser open, the polling continues\n    // If you close the browser, the polling stops\n    // Check for historyItems that do not have a status of complete and restart polling\n    this.#restartPollingForIncompleteHistoryItems();\n  }\n\n  // Mark tx as failed in txHistory if either the approval or trade fails\n  readonly #markTxAsFailed = ({\n    id: txMetaId,\n    actionId,\n  }: TransactionMeta): void => {\n    // Look up by txMetaId first\n    let txHistoryKey: string | undefined = this.state.txHistory[txMetaId]\n      ? txMetaId\n      : undefined;\n\n    // If not found by txMetaId, try looking up by actionId (for pre-submission failures)\n    if (!txHistoryKey && actionId && this.state.txHistory[actionId]) {\n      txHistoryKey = actionId;\n    }\n\n    // If still not found, try looking up by approvalTxId\n    txHistoryKey ??= Object.keys(this.state.txHistory).find(\n      (key) => this.state.txHistory[key].approvalTxId === txMetaId,\n    );\n\n    if (!txHistoryKey) {\n      return;\n    }\n    const key = txHistoryKey;\n    this.update((statusState) => {\n      statusState.txHistory[key].status.status = StatusTypes.FAILED;\n    });\n  };\n\n  resetState = (): void => {\n    this.update((state) => {\n      state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n    });\n  };\n\n  wipeBridgeStatus = ({\n    address,\n    ignoreNetwork,\n  }: {\n    address: string;\n    ignoreNetwork: boolean;\n  }): void => {\n    // Wipe all networks for this address\n    if (ignoreNetwork) {\n      this.update((state) => {\n        state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n      });\n    } else {\n      const { selectedNetworkClientId } = this.messenger.call(\n        'NetworkController:getState',\n      );\n      const selectedNetworkClient = this.messenger.call(\n        'NetworkController:getNetworkClientById',\n        selectedNetworkClientId,\n      );\n      const selectedChainId = selectedNetworkClient.configuration.chainId;\n\n      this.#wipeBridgeStatusByChainId(address, selectedChainId);\n    }\n  };\n\n  /**\n   * Resets the attempts counter for a bridge transaction history item\n   * and restarts polling if it was previously stopped due to max attempts\n   *\n   * @param identifier - Object containing either txMetaId or txHash to identify the history item\n   * @param identifier.txMetaId - The transaction meta ID\n   * @param identifier.txHash - The transaction hash\n   */\n  restartPollingForFailedAttempts = (identifier: {\n    txMetaId?: string;\n    txHash?: string;\n  }): void => {\n    const { txMetaId, txHash } = identifier;\n\n    if (!txMetaId && !txHash) {\n      throw new Error('Either txMetaId or txHash must be provided');\n    }\n\n    // Find the history item by txMetaId or txHash\n    let targetTxMetaId: string | undefined;\n\n    if (txMetaId) {\n      // Direct lookup by txMetaId\n      if (this.state.txHistory[txMetaId]) {\n        targetTxMetaId = txMetaId;\n      }\n    } else if (txHash) {\n      // Search by txHash in status.srcChain.txHash\n      targetTxMetaId = Object.keys(this.state.txHistory).find(\n        (id) => this.state.txHistory[id].status.srcChain.txHash === txHash,\n      );\n    }\n\n    if (!targetTxMetaId) {\n      throw new Error(\n        `No bridge transaction history found for ${\n          txMetaId ? `txMetaId: ${txMetaId}` : `txHash: ${txHash}`\n        }`,\n      );\n    }\n\n    const historyItem = this.state.txHistory[targetTxMetaId];\n\n    // Capture attempts count before resetting for metrics\n    const previousAttempts = historyItem.attempts?.counter ?? 0;\n\n    // Reset the attempts counter\n    this.update((state) => {\n      if (targetTxMetaId) {\n        state.txHistory[targetTxMetaId].attempts = undefined;\n      }\n    });\n\n    // Restart polling if it was stopped and this tx still needs status updates\n    if (this.#shouldPollHistoryItem(historyItem)) {\n      // Check if polling was stopped (no active polling token)\n      const existingPollingToken =\n        this.#pollingTokensByTxMetaId[targetTxMetaId];\n\n      if (!existingPollingToken) {\n        // Restart polling\n        this.#startPollingForTxId(targetTxMetaId);\n\n        // Track polling manually restarted event\n        if (!historyItem.featureId) {\n          const selectedAccount = this.messenger.call(\n            'AccountsController:getAccountByAddress',\n            historyItem.account,\n          );\n          const requestParams = getRequestParamFromHistory(historyItem);\n          const requestMetadata = getRequestMetadataFromHistory(\n            historyItem,\n            selectedAccount,\n          );\n          const { security_warnings: _, ...metadataWithoutWarnings } =\n            requestMetadata;\n\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.PollingStatusUpdated,\n            targetTxMetaId,\n            {\n              ...getTradeDataFromHistory(historyItem),\n              ...getPriceImpactFromQuote(historyItem.quote),\n              ...metadataWithoutWarnings,\n              chain_id_source: requestParams.chain_id_source,\n              chain_id_destination: requestParams.chain_id_destination,\n              token_symbol_source: requestParams.token_symbol_source,\n              token_symbol_destination: requestParams.token_symbol_destination,\n              action_type: MetricsActionType.SWAPBRIDGE_V1,\n              polling_status: PollingStatus.ManuallyRestarted,\n              retry_attempts: previousAttempts,\n            },\n          );\n        }\n      }\n    }\n  };\n\n  /**\n   * Gets a bridge history item from the history by its transaction meta ID\n   *\n   * @param txMetaId - The transaction meta ID to look up\n   * @returns The bridge history item if found, undefined otherwise\n   */\n  getBridgeHistoryItemByTxMetaId = (\n    txMetaId: string,\n  ): BridgeHistoryItem | undefined => {\n    return this.state.txHistory[txMetaId];\n  };\n\n  /**\n   * Restart polling for txs that are not in a final state\n   * This is called during initialization\n   */\n  readonly #restartPollingForIncompleteHistoryItems = (): void => {\n    // Check for historyItems that do not have a status of complete and restart polling\n    const { txHistory } = this.state;\n    const historyItems = Object.values(txHistory);\n    const incompleteHistoryItems = historyItems\n      .filter(\n        (historyItem) =>\n          historyItem.status.status === StatusTypes.PENDING ||\n          historyItem.status.status === StatusTypes.UNKNOWN,\n      )\n      // Only poll items with txMetaId (post-submission items)\n      .filter(\n        (\n          historyItem,\n        ): historyItem is BridgeHistoryItem & { txMetaId: string } =>\n          Boolean(historyItem.txMetaId),\n      )\n      .filter((historyItem) => {\n        // Check if we are already polling this tx, if so, skip restarting polling for that\n        const pollingToken =\n          this.#pollingTokensByTxMetaId[historyItem.txMetaId];\n        return !pollingToken;\n      })\n      // Only restart polling for items that still require status updates\n      .filter((historyItem) => {\n        return this.#shouldPollHistoryItem(historyItem);\n      });\n\n    incompleteHistoryItems.forEach((historyItem) => {\n      const bridgeTxMetaId = historyItem.txMetaId;\n      const shouldSkipFetch = shouldSkipFetchDueToFetchFailures(\n        historyItem.attempts,\n      );\n      if (shouldSkipFetch) {\n        return;\n      }\n\n      // We manually call startPolling() here rather than go through startPollingForBridgeTxStatus()\n      // because we don't want to overwrite the existing historyItem in state\n      this.#startPollingForTxId(bridgeTxMetaId);\n    });\n  };\n\n  readonly #addTxToHistory = (\n    startPollingForBridgeTxStatusArgs: StartPollingForBridgeTxStatusArgsSerialized,\n    actionId?: string,\n  ): void => {\n    const {\n      bridgeTxMeta,\n      statusRequest,\n      quoteResponse,\n      startTime,\n      slippagePercentage,\n      initialDestAssetBalance,\n      targetContractAddress,\n      approvalTxId,\n      isStxEnabled,\n      location,\n      abTests,\n      accountAddress: selectedAddress,\n    } = startPollingForBridgeTxStatusArgs;\n\n    // Determine the key for this history item:\n    // - For pre-submission (non-batch EVM): use actionId\n    // - For post-submission or other cases: use bridgeTxMeta.id\n    const historyKey = getHistoryKey(actionId, bridgeTxMeta?.id);\n\n    // Write all non-status fields to state so we can reference the quote in Activity list without the Bridge API\n    // We know it's in progress but not the exact status yet\n    const txHistoryItem: BridgeHistoryItem = {\n      txMetaId: bridgeTxMeta?.id,\n      actionId,\n      originalTransactionId:\n        (bridgeTxMeta as unknown as { originalTransactionId: string })\n          ?.originalTransactionId || bridgeTxMeta?.id, // Keep original for intent transactions\n      batchId: bridgeTxMeta?.batchId,\n      quote: quoteResponse.quote,\n      startTime,\n      estimatedProcessingTimeInSeconds:\n        quoteResponse.estimatedProcessingTimeInSeconds,\n      slippagePercentage,\n      pricingData: {\n        amountSent: quoteResponse.sentAmount?.amount ?? '0',\n        amountSentInUsd: quoteResponse.sentAmount?.usd ?? undefined,\n        quotedGasInUsd: quoteResponse.gasFee?.effective?.usd ?? undefined,\n        quotedReturnInUsd: quoteResponse.toTokenAmount?.usd ?? undefined,\n        quotedGasAmount: quoteResponse.gasFee?.effective?.amount ?? undefined,\n      },\n      initialDestAssetBalance,\n      targetContractAddress,\n      account: selectedAddress,\n      status: {\n        // We always have a PENDING status when we start polling for a tx, don't need the Bridge API for that\n        // Also we know the bare minimum fields for status at this point in time\n        status: StatusTypes.PENDING,\n        srcChain: {\n          chainId: statusRequest.srcChainId,\n          txHash: statusRequest.srcTxHash,\n        },\n      },\n      hasApprovalTx: Boolean(quoteResponse.approval),\n      approvalTxId,\n      isStxEnabled: isStxEnabled ?? false,\n      featureId: quoteResponse.featureId,\n      location,\n      ...(abTests && { abTests }),\n    };\n    this.update((state) => {\n      // Use actionId as key for pre-submission, or txMeta.id for post-submission\n      state.txHistory[historyKey] = txHistoryItem;\n    });\n  };\n\n  /**\n   * Rekeys a history item from actionId to txMeta.id after successful submission.\n   * Also updates txMetaId and srcTxHash which weren't available pre-submission.\n   *\n   * @param actionId - The actionId used as the temporary key for the history item\n   * @param txMeta - The transaction meta from the successful submission\n   * @param txMeta.id - The transaction meta id to use as the new key\n   * @param txMeta.hash - The transaction hash to set on the history item\n   */\n  readonly #rekeyHistoryItem = (\n    actionId: string,\n    txMeta: { id: string; hash?: string },\n  ): void => {\n    this.update((state) => {\n      rekeyHistoryItemInState(state, actionId, txMeta);\n    });\n  };\n\n  readonly #startPollingForTxId = (txId: string): void => {\n    // If we are already polling for this tx, stop polling for it before restarting\n    const existingPollingToken = this.#pollingTokensByTxMetaId[txId];\n    if (existingPollingToken) {\n      this.stopPollingByPollingToken(existingPollingToken);\n    }\n\n    const txHistoryItem = this.state.txHistory[txId];\n    if (!txHistoryItem) {\n      return;\n    }\n    if (this.#shouldPollHistoryItem(txHistoryItem)) {\n      this.#pollingTokensByTxMetaId[txId] = this.startPolling({\n        bridgeTxMetaId: txId,\n      });\n    }\n  };\n\n  readonly #shouldPollHistoryItem = (\n    historyItem: BridgeHistoryItem,\n  ): boolean => {\n    const isIntent = Boolean(historyItem?.quote?.intent);\n    const isBridgeTx = isCrossChain(\n      historyItem.quote.srcChainId,\n      historyItem.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(historyItem.quote.srcChainId);\n\n    return [isBridgeTx, isIntent, isTronTx].some(Boolean);\n  };\n\n  /**\n   * @deprecated For EVM/Solana swap/bridge txs we add tx to history in submitTx()\n   * For Solana swap/bridge we start polling in submitTx()\n   * For EVM bridge we listen for 'TransactionController:transactionConfirmed' and start polling there\n   * No clients currently call this, safe to remove in future versions\n   *\n   * Adds tx to history and starts polling for the bridge tx status\n   *\n   * @param txHistoryMeta - The parameters for creating the history item\n   */\n  startPollingForBridgeTxStatus = (\n    txHistoryMeta: StartPollingForBridgeTxStatusArgsSerialized,\n  ): void => {\n    const { bridgeTxMeta } = txHistoryMeta;\n\n    if (!bridgeTxMeta?.id) {\n      throw new Error(\n        'Cannot start polling: bridgeTxMeta.id is required for polling',\n      );\n    }\n\n    this.#addTxToHistory(txHistoryMeta);\n    this.#startPollingForTxId(bridgeTxMeta.id);\n  };\n\n  // This will be called after you call this.startPolling()\n  // The args passed in are the args you passed in to startPolling()\n  _executePoll = async (\n    pollingInput: BridgeStatusPollingInput,\n  ): Promise<void> => {\n    await this.#fetchBridgeTxStatus(pollingInput);\n  };\n\n  #getMultichainSelectedAccount(\n    accountAddress: string,\n  ):\n    | AccountsControllerState['internalAccounts']['accounts'][string]\n    | undefined {\n    return this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      accountAddress,\n    );\n  }\n\n  /**\n   * Handles the failure to fetch the bridge tx status\n   * We eventually stop polling for the tx if we fail too many times\n   * Failures (500 errors) can be due to:\n   * - The srcTxHash not being available immediately for STX\n   * - The srcTxHash being invalid for the chain. This case will never resolve so we stop polling for it to avoid hammering the Bridge API forever.\n   *\n   * @param bridgeTxMetaId - The txMetaId of the bridge tx\n   */\n  readonly #handleFetchFailure = (bridgeTxMetaId: string): void => {\n    const { attempts } = this.state.txHistory[bridgeTxMetaId];\n\n    const newAttempts = attempts\n      ? {\n          counter: attempts.counter + 1,\n          lastAttemptTime: Date.now(),\n        }\n      : {\n          counter: 1,\n          lastAttemptTime: Date.now(),\n        };\n\n    // If we've failed too many times, stop polling for the tx\n    const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n    if (newAttempts.counter >= MAX_ATTEMPTS && pollingToken) {\n      this.stopPollingByPollingToken(pollingToken);\n      delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      // Track max polling reached event\n      const historyItem = this.state.txHistory[bridgeTxMetaId];\n      if (historyItem && !historyItem.featureId) {\n        const selectedAccount = this.messenger.call(\n          'AccountsController:getAccountByAddress',\n          historyItem.account,\n        );\n        const requestParams = getRequestParamFromHistory(historyItem);\n        const requestMetadata = getRequestMetadataFromHistory(\n          historyItem,\n          selectedAccount,\n        );\n        const { security_warnings: _, ...metadataWithoutWarnings } =\n          requestMetadata;\n\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.PollingStatusUpdated,\n          bridgeTxMetaId,\n          {\n            ...getTradeDataFromHistory(historyItem),\n            ...getPriceImpactFromQuote(historyItem.quote),\n            ...metadataWithoutWarnings,\n            chain_id_source: requestParams.chain_id_source,\n            chain_id_destination: requestParams.chain_id_destination,\n            token_symbol_source: requestParams.token_symbol_source,\n            token_symbol_destination: requestParams.token_symbol_destination,\n            action_type: MetricsActionType.SWAPBRIDGE_V1,\n            polling_status: PollingStatus.MaxPollingReached,\n            retry_attempts: newAttempts.counter,\n          },\n        );\n      }\n    }\n\n    // Update the attempts counter\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].attempts = newAttempts;\n    });\n  };\n\n  readonly #fetchBridgeTxStatus = async ({\n    bridgeTxMetaId,\n  }: FetchBridgeTxStatusArgs): Promise<void> => {\n    // 1. Check for history item\n\n    const { txHistory } = this.state;\n    const historyItem = txHistory[bridgeTxMetaId];\n    if (!historyItem) {\n      return;\n    }\n\n    // 2. Check for previous failures\n\n    if (shouldSkipFetchDueToFetchFailures(historyItem.attempts)) {\n      return;\n    }\n\n    // 3. Fetch transcation status\n\n    try {\n      let status: BridgeHistoryItem['status'];\n      let validationFailures: string[] = [];\n      let intentTranslation: IntentStatusTranslation | null = null;\n      let intentOrderStatus: string | undefined;\n\n      const isIntent = Boolean(historyItem.quote.intent);\n\n      if (isIntent) {\n        const { srcChainId } = historyItem.quote;\n\n        const intentApi = new IntentApiImpl(\n          this.#config.customBridgeApiBaseUrl,\n          this.#fetchFn,\n        );\n        const intentOrder = await intentApi.getOrderStatus(\n          bridgeTxMetaId,\n          historyItem.quote.intent?.protocol ?? '',\n          srcChainId.toString(),\n          this.#clientId,\n          await this.#getJwt(),\n        );\n\n        intentOrderStatus = intentOrder.status;\n        intentTranslation = translateIntentOrderToBridgeStatus(\n          intentOrder,\n          srcChainId,\n          historyItem.status.srcChain.txHash,\n        );\n        status = intentTranslation.status;\n      } else {\n        // We try here because we receive 500 errors from Bridge API if we try to fetch immediately after submitting the source tx\n        // Oddly mostly happens on Optimism, never on Arbitrum. By the 2nd fetch, the Bridge API responds properly.\n        // Also srcTxHash may not be available immediately for STX, so we don't want to fetch in those cases\n        const srcTxHash = this.#getSrcTxHash(bridgeTxMetaId);\n        if (!srcTxHash) {\n          return;\n        }\n\n        this.#updateSrcTxHash(bridgeTxMetaId, srcTxHash);\n\n        const statusRequest = getStatusRequestWithSrcTxHash(\n          historyItem.quote,\n          srcTxHash,\n        );\n        const response = await fetchBridgeTxStatus(\n          statusRequest,\n          this.#clientId,\n          await this.#getJwt(),\n          this.#fetchFn,\n          this.#config.customBridgeApiBaseUrl,\n        );\n        status = response.status;\n        validationFailures = response.validationFailures;\n      }\n\n      if (validationFailures.length > 0) {\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.StatusValidationFailed,\n          bridgeTxMetaId,\n          {\n            failures: validationFailures,\n            refresh_count: historyItem.attempts?.counter ?? 0,\n          },\n        );\n        throw new Error(\n          `Bridge status validation failed: ${validationFailures.join(', ')}`,\n        );\n      }\n\n      // 4. Create bridge history item\n\n      const newBridgeHistoryItem = {\n        ...historyItem,\n        status,\n        completionTime:\n          status.status === StatusTypes.COMPLETE ||\n          status.status === StatusTypes.FAILED\n            ? Date.now()\n            : undefined, // TODO make this more accurate by looking up dest txHash block time\n        attempts: undefined,\n      };\n\n      // No need to purge these on network change or account change, TransactionController does not purge either.\n      // TODO In theory we can skip checking status if it's not the current account/network\n      // we need to keep track of the account that this is associated with as well so that we don't show it in Activity list for other accounts\n      // First stab at this will not stop polling when you are on a different account\n      this.update((state) => {\n        state.txHistory[bridgeTxMetaId] = newBridgeHistoryItem;\n      });\n\n      if (isIntent && intentTranslation && intentOrderStatus) {\n        this.#intentStatusManager.syncTransactionFromIntentStatus(\n          bridgeTxMetaId,\n          historyItem,\n          intentTranslation,\n          intentOrderStatus,\n        );\n      }\n\n      // 5. After effects\n\n      const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      const isFinalStatus =\n        status.status === StatusTypes.COMPLETE ||\n        status.status === StatusTypes.FAILED;\n\n      if (isFinalStatus && pollingToken) {\n        this.stopPollingByPollingToken(pollingToken);\n        delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n        // Skip tracking events when featureId is set (i.e. PERPS)\n        if (historyItem.featureId) {\n          return;\n        }\n\n        if (status.status === StatusTypes.COMPLETE) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            bridgeTxMetaId,\n          );\n          this.messenger.publish(\n            'BridgeStatusController:destinationTransactionCompleted',\n            historyItem.quote.destAsset.assetId,\n          );\n        }\n        if (status.status === StatusTypes.FAILED) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Failed,\n            bridgeTxMetaId,\n          );\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to fetch bridge tx status', error);\n      this.#handleFetchFailure(bridgeTxMetaId);\n    }\n  };\n\n  readonly #getJwt = async (): Promise<string | undefined> => {\n    try {\n      const token = await this.messenger.call(\n        'AuthenticationController:getBearerToken',\n      );\n      return token;\n    } catch (error) {\n      console.error('Error getting JWT token for bridge-api request', error);\n      return undefined;\n    }\n  };\n\n  readonly #getSrcTxHash = (bridgeTxMetaId: string): string | undefined => {\n    const { txHistory } = this.state;\n    // Prefer the srcTxHash from bridgeStatusState so we don't have to l ook up in TransactionController\n    // But it is possible to have bridgeHistoryItem in state without the srcTxHash yet when it is an STX\n    const srcTxHash = txHistory[bridgeTxMetaId].status.srcChain.txHash;\n\n    if (srcTxHash) {\n      return srcTxHash;\n    }\n\n    // Look up in TransactionController if txMeta has been updated with the srcTxHash\n    const txControllerState = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = txControllerState.transactions.find(\n      (tx: TransactionMeta) => tx.id === bridgeTxMetaId,\n    );\n    return txMeta?.hash;\n  };\n\n  readonly #updateSrcTxHash = (\n    bridgeTxMetaId: string,\n    srcTxHash: string,\n  ): void => {\n    const { txHistory } = this.state;\n    if (txHistory[bridgeTxMetaId].status.srcChain.txHash) {\n      return;\n    }\n\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].status.srcChain.txHash = srcTxHash;\n    });\n  };\n\n  // Wipes the bridge status for the given address and chainId\n  // Will match only source chainId to the selectedChainId\n  readonly #wipeBridgeStatusByChainId = (\n    address: string,\n    selectedChainId: Hex,\n  ): void => {\n    const sourceTxMetaIdsToDelete = Object.keys(this.state.txHistory).filter(\n      (txMetaId) => {\n        const bridgeHistoryItem = this.state.txHistory[txMetaId];\n\n        const hexSourceChainId = numberToHex(\n          bridgeHistoryItem.quote.srcChainId,\n        );\n\n        return (\n          bridgeHistoryItem.account === address &&\n          hexSourceChainId === selectedChainId\n        );\n      },\n    );\n\n    sourceTxMetaIdsToDelete.forEach((sourceTxMetaId) => {\n      const pollingToken = this.#pollingTokensByTxMetaId[sourceTxMetaId];\n\n      if (pollingToken) {\n        this.stopPollingByPollingToken(\n          this.#pollingTokensByTxMetaId[sourceTxMetaId],\n        );\n      }\n    });\n\n    this.update((state) => {\n      state.txHistory = sourceTxMetaIdsToDelete.reduce(\n        (acc, sourceTxMetaId) => {\n          delete acc[sourceTxMetaId];\n          return acc;\n        },\n        state.txHistory,\n      );\n    });\n  };\n\n  /**\n   * ******************************************************\n   * TX SUBMISSION HANDLING\n   *******************************************************\n   */\n\n  /**\n   * Submits the transaction to the snap using the new unified ClientRequest interface\n   * Works for all non-EVM chains (Solana, BTC, Tron)\n   * This adds an approval tx to the ApprovalsController in the background\n   * The client needs to handle the approval tx by redirecting to the confirmation page with the approvalTxId in the URL\n   *\n   * @param trade - The trade data (can be approval or main trade)\n   * @param quoteResponse - The quote response containing metadata\n   * @param selectedAccount - The account to submit the transaction for\n   * @returns The transaction meta\n   */\n  readonly #handleNonEvmTx = async (\n    trade: Trade,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    selectedAccount: AccountsControllerState['internalAccounts']['accounts'][string],\n  ): Promise<TransactionMeta> => {\n    if (!selectedAccount.metadata?.snap?.id) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined snap id',\n      );\n    }\n\n    const request = getClientRequest(\n      trade,\n      quoteResponse.quote.srcChainId,\n      selectedAccount,\n    );\n    const requestResponse = (await this.messenger.call(\n      'SnapController:handleRequest',\n      request,\n    )) as\n      | string\n      | { transactionId: string }\n      | { result: Record<string, string> }\n      | { signature: string };\n\n    // Create quote response with the specified trade\n    // This allows the same method to handle both approvals and main trades\n    const txQuoteResponse: QuoteResponse<Trade> & QuoteMetadata = {\n      ...quoteResponse,\n      trade,\n    };\n\n    const txMeta = handleNonEvmTxResponse(\n      requestResponse,\n      txQuoteResponse,\n      selectedAccount,\n    );\n\n    // TODO remove this eventually, just returning it now to match extension behavior\n    // OR if the snap can propagate the snapRequestId or keyringReqId to the ApprovalsController, this can return the approvalTxId instead and clients won't need to subscribe to the ApprovalsController state to redirect\n    return txMeta;\n  };\n\n  readonly #waitForHashAndReturnFinalTxMeta = async (\n    hashPromise?: Awaited<\n      ReturnType<TransactionController['addTransaction']>\n    >['result'],\n  ): Promise<TransactionMeta> => {\n    const transactionHash = await hashPromise;\n    const finalTransactionMeta: TransactionMeta | undefined = this.messenger\n      .call('TransactionController:getState')\n      .transactions.find((tx: TransactionMeta) => tx.hash === transactionHash);\n    if (!finalTransactionMeta) {\n      throw new Error(\n        'Failed to submit cross-chain swap tx: txMeta for txHash was not found',\n      );\n    }\n    return finalTransactionMeta;\n  };\n\n  // Waits until a given transaction (by id) reaches confirmed/finalized status or fails/times out.\n  readonly #waitForTxConfirmation = async (\n    txId: string,\n    {\n      timeoutMs = 5 * 60_000, // 5 minutes default\n      pollMs = 3_000,\n    }: { timeoutMs?: number; pollMs?: number } = {},\n  ): Promise<TransactionMeta> => {\n    return await waitForTxConfirmation(this.messenger, txId, {\n      timeoutMs,\n      pollMs,\n    });\n  };\n\n  readonly #handleApprovalTx = async (\n    isBridgeTx: boolean,\n    srcChainId: QuoteResponse['quote']['srcChainId'],\n    approval?: TxData,\n    resetApproval?: TxData,\n    requireApproval?: boolean,\n  ): Promise<TransactionMeta | undefined> => {\n    if (approval) {\n      const approveTx = async (): Promise<TransactionMeta> => {\n        await this.#handleUSDTAllowanceReset(resetApproval);\n\n        const approvalTxMeta = await this.#handleEvmTransaction({\n          transactionType: isBridgeTx\n            ? TransactionType.bridgeApproval\n            : TransactionType.swapApproval,\n          trade: approval,\n          requireApproval,\n        });\n\n        await handleApprovalDelay(srcChainId);\n        return approvalTxMeta;\n      };\n\n      return await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionApprovalCompleted\n            : TraceName.SwapTransactionApprovalCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(srcChainId),\n            stxEnabled: false,\n          },\n        },\n        approveTx,\n      );\n    }\n\n    return undefined;\n  };\n\n  /**\n   * Submits an EVM transaction to the TransactionController\n   *\n   * @param params - The parameters for the transaction\n   * @param params.transactionType - The type of transaction to submit\n   * @param params.trade - The trade data to confirm\n   * @param params.requireApproval - Whether to require approval for the transaction\n   * @param params.txFee - Optional gas fee parameters from the quote (used when gasIncluded is true)\n   * @param params.txFee.maxFeePerGas - The maximum fee per gas from the quote\n   * @param params.txFee.maxPriorityFeePerGas - The maximum priority fee per gas from the quote\n   * @param params.actionId - Optional actionId for pre-submission history (if not provided, one is generated)\n   * @returns The transaction meta\n   */\n  readonly #handleEvmTransaction = async ({\n    transactionType,\n    trade,\n    requireApproval = false,\n    txFee,\n    actionId: providedActionId,\n  }: {\n    transactionType: TransactionType;\n    trade: TxData;\n    requireApproval?: boolean;\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string };\n    actionId?: string;\n  }): Promise<TransactionMeta> => {\n    // Use provided actionId (for pre-submission history) or generate one\n    const actionId = providedActionId ?? generateActionId().toString();\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      trade.from,\n    );\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: unknown account in trade data',\n      );\n    }\n    const hexChainId = formatChainIdToHex(trade.chainId);\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      hexChainId,\n    );\n\n    const requestOptions = {\n      actionId,\n      networkClientId,\n      requireApproval,\n      type: transactionType,\n      origin: 'metamask',\n    };\n    // Exclude gasLimit from trade to avoid type issues (it can be null)\n    const { gasLimit: tradeGasLimit, ...tradeWithoutGasLimit } = trade;\n\n    const transactionParams: Parameters<\n      TransactionController['addTransaction']\n    >[0] = {\n      ...tradeWithoutGasLimit,\n      chainId: hexChainId,\n      // Only add gasLimit and gas if they're valid (not undefined/null/zero)\n      ...(tradeGasLimit &&\n        tradeGasLimit !== 0 && {\n          gasLimit: tradeGasLimit.toString(),\n          gas: tradeGasLimit.toString(),\n        }),\n    };\n    const transactionParamsWithMaxGas: TransactionParams = {\n      ...transactionParams,\n      ...(await this.#calculateGasFees(\n        transactionParams,\n        networkClientId,\n        hexChainId,\n        txFee,\n      )),\n    };\n\n    const { result } = await this.#addTransactionFn(\n      transactionParamsWithMaxGas,\n      requestOptions,\n    );\n\n    return await this.#waitForHashAndReturnFinalTxMeta(result);\n  };\n\n  readonly #handleUSDTAllowanceReset = async (\n    resetApproval?: TxData,\n  ): Promise<void> => {\n    if (resetApproval) {\n      await this.#handleEvmTransaction({\n        transactionType: TransactionType.bridgeApproval,\n        trade: resetApproval,\n      });\n    }\n  };\n\n  readonly #calculateGasFees = async (\n    transactionParams: TransactionParams,\n    networkClientId: string,\n    chainId: Hex,\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string },\n  ): Promise<{\n    maxFeePerGas: Hex;\n    maxPriorityFeePerGas: Hex;\n    gas?: Hex;\n  }> => {\n    const { gas } = transactionParams;\n    // If txFee is provided (gasIncluded case), use the quote's gas fees\n    // Convert to hex since txFee values from the quote are decimal strings\n    if (txFee) {\n      return {\n        maxFeePerGas: toHex(txFee.maxFeePerGas ?? 0),\n        maxPriorityFeePerGas: toHex(txFee.maxPriorityFeePerGas ?? 0),\n        gas: gas ? toHex(gas) : undefined,\n      };\n    }\n\n    const { gasFeeEstimates } = this.messenger.call(\n      'GasFeeController:getState',\n    );\n    const { estimates: txGasFeeEstimates } = await this.#estimateGasFeeFn({\n      transactionParams,\n      chainId,\n      networkClientId,\n    });\n    const { maxFeePerGas, maxPriorityFeePerGas } = getTxGasEstimates({\n      networkGasFeeEstimates: gasFeeEstimates,\n      txGasFeeEstimates,\n    });\n\n    return {\n      maxFeePerGas,\n      maxPriorityFeePerGas,\n      gas: gas ? toHex(gas) : undefined,\n    };\n  };\n\n  /**\n   * Submits batched EVM transactions to the TransactionController\n   *\n   * @param args - The parameters for the transaction\n   * @param args.isBridgeTx - Whether the transaction is a bridge transaction\n   * @param args.trade - The trade data to confirm\n   * @param args.approval - The approval data to confirm\n   * @param args.resetApproval - The ethereum:USDT reset approval data to confirm\n   * @param args.quoteResponse - The quote response\n   * @param args.requireApproval - Whether to require approval for the transaction\n   * @returns The approvalMeta and tradeMeta for the batched transaction\n   */\n  readonly #handleEvmTransactionBatch = async (\n    args: Omit<\n      Parameters<typeof getAddTransactionBatchParams>[0],\n      'messenger' | 'estimateGasFeeFn'\n    >,\n  ): Promise<{\n    approvalMeta?: TransactionMeta;\n    tradeMeta: TransactionMeta;\n  }> => {\n    const transactionParams = await getAddTransactionBatchParams({\n      messenger: this.messenger,\n      estimateGasFeeFn: this.#estimateGasFeeFn,\n      ...args,\n    });\n    const txDataByType = {\n      [TransactionType.bridgeApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridgeApproval,\n      )?.params.data,\n      [TransactionType.swapApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swapApproval,\n      )?.params.data,\n      [TransactionType.bridge]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridge,\n      )?.params.data,\n      [TransactionType.swap]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swap,\n      )?.params.data,\n    };\n\n    const { batchId } = await this.#addTransactionBatchFn(transactionParams);\n\n    const { approvalMeta, tradeMeta } = findAndUpdateTransactionsInBatch({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n      batchId,\n      txDataByType,\n    });\n\n    if (!tradeMeta) {\n      throw new Error(\n        'Failed to update cross-chain swap transaction batch: tradeMeta not found',\n      );\n    }\n\n    return { approvalMeta, tradeMeta };\n  };\n\n  /**\n   * Submits a cross-chain swap transaction\n   *\n   * @param accountAddress - The address of the account to submit the transaction for\n   * @param quoteResponse - The quote response\n   * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n   * @param quotesReceivedContext - The context for the QuotesReceived event\n   * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n   * @param abTests - A/B test context to attribute events to specific experiments\n   * @returns The transaction meta\n   */\n  submitTx = async (\n    accountAddress: string,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    isStxEnabledOnClient: boolean,\n    quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n    location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n    abTests?: Record<string, string>,\n  ): Promise<TransactionMeta & Partial<SolanaTransactionMeta>> => {\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n      // If trade is submitted before all quotes are loaded, the QuotesReceived event is published\n      // If the trade has a featureId, it means it was submitted outside of the Unified Swap and Bridge experience, so no QuotesReceived event is published\n      quoteResponse.featureId ? undefined : quotesReceivedContext,\n    );\n\n    const selectedAccount = this.#getMultichainSelectedAccount(accountAddress);\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined multichain account',\n      );\n    }\n    const isHardwareAccount = isHardwareWallet(selectedAccount);\n\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      isStxEnabledOnClient,\n      isHardwareAccount,\n      location,\n      abTests,\n    );\n    // Emit Submitted event after submit button is clicked\n    !quoteResponse.featureId &&\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Submitted,\n        undefined,\n        preConfirmationProperties,\n      );\n\n    let txMeta: TransactionMeta & Partial<SolanaTransactionMeta>;\n    let approvalTxId: string | undefined;\n    const startTime = Date.now();\n\n    const isBridgeTx = isCrossChain(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(quoteResponse.quote.srcChainId);\n\n    // Submit non-EVM tx (Solana, BTC, Tron)\n    if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n      // Handle non-EVM approval if present (e.g., Tron token approvals)\n      if (quoteResponse.approval && isTronTrade(quoteResponse.approval)) {\n        const approvalTxMeta = await this.#trace(\n          {\n            name: isBridgeTx\n              ? TraceName.BridgeTransactionApprovalCompleted\n              : TraceName.SwapTransactionApprovalCompleted,\n            data: {\n              srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n              stxEnabled: false,\n            },\n          },\n          async () => {\n            try {\n              return quoteResponse.approval &&\n                isTronTrade(quoteResponse.approval)\n                ? await this.#handleNonEvmTx(\n                    quoteResponse.approval,\n                    quoteResponse,\n                    selectedAccount,\n                  )\n                : undefined;\n            } catch (error) {\n              !quoteResponse.featureId &&\n                this.#trackUnifiedSwapBridgeEvent(\n                  UnifiedSwapBridgeEventName.Failed,\n                  undefined,\n                  {\n                    error_message: (error as Error)?.message,\n                    ...preConfirmationProperties,\n                  },\n                );\n              throw error;\n            }\n          },\n        );\n\n        approvalTxId = approvalTxMeta?.id;\n\n        // Add delay after approval similar to EVM flow\n        await handleApprovalDelay(quoteResponse.quote.srcChainId);\n      }\n\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: false,\n          },\n        },\n        async () => {\n          try {\n            if (\n              !(\n                isTronTrade(quoteResponse.trade) ||\n                isBitcoinTrade(quoteResponse.trade) ||\n                typeof quoteResponse.trade === 'string'\n              )\n            ) {\n              throw new Error(\n                'Failed to submit cross-chain swap transaction: trade is not a non-EVM transaction',\n              );\n            }\n            return await this.#handleNonEvmTx(\n              quoteResponse.trade,\n              quoteResponse,\n              selectedAccount,\n            );\n          } catch (error) {\n            !quoteResponse.featureId &&\n              this.#trackUnifiedSwapBridgeEvent(\n                UnifiedSwapBridgeEventName.Failed,\n                txMeta?.id,\n                {\n                  error_message: (error as Error)?.message,\n                  ...preConfirmationProperties,\n                },\n              );\n            throw error;\n          }\n        },\n      );\n    } else {\n      // Submit EVM tx\n      // For hardware wallets on Mobile, this is fixes an issue where the Ledger does not get prompted for the 2nd approval\n      // Extension does not have this issue\n      const requireApproval =\n        this.#clientId === BridgeClientId.MOBILE && isHardwareAccount;\n\n      // Handle smart transactions if enabled\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: isStxEnabledOnClient,\n          },\n        },\n        async () => {\n          if (!isEvmTxData(quoteResponse.trade)) {\n            throw new Error(\n              'Failed to submit cross-chain swap transaction: trade is not an EVM transaction',\n            );\n          }\n          if (isStxEnabledOnClient || quoteResponse.quote.gasIncluded7702) {\n            const { tradeMeta, approvalMeta } =\n              await this.#handleEvmTransactionBatch({\n                isBridgeTx,\n                resetApproval: quoteResponse.resetApproval,\n                approval:\n                  quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n                    ? quoteResponse.approval\n                    : undefined,\n                trade: quoteResponse.trade,\n                quoteResponse,\n                requireApproval,\n              });\n\n            approvalTxId = approvalMeta?.id;\n            return tradeMeta;\n          }\n          // Set approval time and id if an approval tx is needed\n          const approvalTxMeta = await this.#handleApprovalTx(\n            isBridgeTx,\n            quoteResponse.quote.srcChainId,\n            quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n              ? quoteResponse.approval\n              : undefined,\n            quoteResponse.resetApproval,\n            requireApproval,\n          );\n\n          approvalTxId = approvalTxMeta?.id;\n\n          await handleMobileHardwareWalletDelay(requireApproval);\n\n          // Generate actionId for pre-submission history (non-batch EVM only)\n          const actionId = generateActionId().toString();\n\n          // Add pre-submission history keyed by actionId\n          // This ensures we have quote data available if transaction fails during submission\n          this.#addTxToHistory(\n            {\n              accountAddress: selectedAccount.address,\n              statusRequest: {\n                ...getStatusRequestParams(quoteResponse),\n                srcTxHash: '', // Not available yet\n              },\n              quoteResponse,\n              slippagePercentage: 0,\n              isStxEnabled: isStxEnabledOnClient,\n              startTime,\n              approvalTxId,\n              location,\n              abTests,\n            },\n            actionId,\n          );\n\n          // Pass txFee when gasIncluded is true to use the quote's gas fees\n          // instead of re-estimating (which would fail for max native token swaps)\n          const tradeTxMeta = await this.#handleEvmTransaction({\n            transactionType: isBridgeTx\n              ? TransactionType.bridge\n              : TransactionType.swap,\n            trade: quoteResponse.trade,\n            requireApproval,\n            txFee: quoteResponse.quote.gasIncluded\n              ? quoteResponse.quote.feeData.txFee\n              : undefined,\n            actionId,\n          });\n\n          // On success, rekey from actionId to txMeta.id and update srcTxHash\n          this.#rekeyHistoryItem(actionId, tradeTxMeta);\n\n          return tradeTxMeta;\n        },\n      );\n    }\n\n    try {\n      // For non-batch EVM transactions, history was already added/rekeyed above\n      // Only add history here for non-EVM and batch EVM transactions\n      const isNonBatchEvm =\n        !isNonEvmChainId(quoteResponse.quote.srcChainId) &&\n        !isStxEnabledOnClient &&\n        !quoteResponse.quote.gasIncluded7702;\n\n      if (!isNonBatchEvm) {\n        // Add swap or bridge tx to history\n        this.#addTxToHistory({\n          accountAddress: selectedAccount.address,\n          bridgeTxMeta: txMeta, // Only the id field is used by the BridgeStatusController\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: txMeta.hash,\n          },\n          quoteResponse,\n          slippagePercentage: 0, // TODO include slippage provided by quote if using dynamic slippage, or slippage from quote request\n          isStxEnabled: isStxEnabledOnClient,\n          startTime,\n          approvalTxId,\n          location,\n          abTests,\n        });\n      }\n\n      if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n        // Start polling for bridge tx status\n        this.#startPollingForTxId(txMeta.id);\n        // Track non-EVM Swap completed event\n        if (!(isBridgeTx || isTronTx)) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMeta.id,\n          );\n        }\n      }\n    } catch {\n      // Ignore errors here, we don't want to crash the app if this fails and tx submission succeeds\n    }\n    return txMeta;\n  };\n\n  /**\n   * UI-signed intent submission (fast path): the UI generates the EIP-712 signature and calls this with the raw signature.\n   * Here we submit the order to the intent provider and create a synthetic history entry for UX.\n   *\n   * @param params - Object containing intent submission parameters\n   * @param params.quoteResponse - Quote carrying intent data\n   * @param params.signature - Hex signature produced by eth_signTypedData_v4\n   * @param params.accountAddress - The EOA submitting the order\n   * @param params.location - The entry point from which the user initiated the swap or bridge\n   * @param params.abTests - A/B test context to attribute events to specific experiments\n   * @returns A lightweight TransactionMeta-like object for history linking\n   */\n  submitIntent = async (params: {\n    quoteResponse: QuoteResponse<TxData | string> & QuoteMetadata;\n    signature: string;\n    accountAddress: string;\n    location?: MetaMetricsSwapsEventSource;\n    abTests?: Record<string, string>;\n  }): Promise<Pick<TransactionMeta, 'id' | 'chainId' | 'type' | 'status'>> => {\n    const { quoteResponse, signature, accountAddress, location, abTests } =\n      params;\n\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n    );\n\n    // Build pre-confirmation properties for error tracking parity with submitTx\n    const account = this.#getMultichainSelectedAccount(accountAddress);\n    const isHardwareAccount = Boolean(account) && isHardwareWallet(account);\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      false,\n      isHardwareAccount,\n      location,\n      abTests,\n    );\n\n    try {\n      const intent = getIntentFromQuote(\n        quoteResponse as QuoteResponse & { quote: { intent?: Intent } },\n      );\n\n      // If backend provided an approval tx for this intent quote, submit it first (on-chain),\n      // then proceed with off-chain intent submission.\n      let approvalTxId: string | undefined;\n      if (quoteResponse.approval) {\n        const isBridgeTx = isCrossChain(\n          quoteResponse.quote.srcChainId,\n          quoteResponse.quote.destChainId,\n        );\n\n        // Handle approval silently for better UX in intent flows\n        const approvalTxMeta = await this.#handleApprovalTx(\n          isBridgeTx,\n          quoteResponse.quote.srcChainId,\n          quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n            ? quoteResponse.approval\n            : undefined,\n          quoteResponse.resetApproval,\n          /* requireApproval */ false,\n        );\n        approvalTxId = approvalTxMeta?.id;\n\n        if (approvalTxId) {\n          await this.#waitForTxConfirmation(approvalTxId);\n        }\n      }\n\n      const { srcChainId: chainId, requestId } = quoteResponse.quote;\n\n      const submissionParams = {\n        srcChainId: chainId.toString(),\n        quoteId: requestId,\n        signature,\n        order: intent.order,\n        userAddress: accountAddress,\n        aggregatorId: intent.protocol,\n      };\n      const intentApi = new IntentApiImpl(\n        this.#config.customBridgeApiBaseUrl,\n        this.#fetchFn,\n      );\n      const intentOrder = await intentApi.submitIntent(\n        submissionParams,\n        this.#clientId,\n        await this.#getJwt(),\n      );\n\n      const orderUid = intentOrder.id;\n\n      // Determine transaction type: swap for same-chain, bridge for cross-chain\n      const isCrossChainTx = isCrossChain(\n        quoteResponse.quote.srcChainId,\n        quoteResponse.quote.destChainId,\n      );\n      const transactionType = isCrossChainTx\n        ? TransactionType.bridge\n        : TransactionType.swap;\n\n      // Create actual transaction in Transaction Controller first\n      const networkClientId = this.messenger.call(\n        'NetworkController:findNetworkClientIdByChainId',\n        formatChainIdToHex(chainId),\n      );\n\n      // This is a synthetic transaction whose purpose is to be able\n      // to track the order status via the history\n      const intentTransactionParams = {\n        chainId: formatChainIdToHex(chainId),\n        from: accountAddress,\n        to:\n          intent.settlementContract ??\n          '0x9008D19f58AAbd9eD0D60971565AA8510560ab41', // Default settlement contract\n        data: `0x${orderUid.slice(-8)}`, // Use last 8 chars of orderUid to make each transaction unique\n        value: '0x0',\n        gas: '0x5208', // Minimal gas for display purposes\n        gasPrice: '0x3b9aca00', // 1 Gwei - will be converted to EIP-1559 fees if network supports it\n      };\n\n      const { transactionMeta: txMetaPromise } = await this.#addTransactionFn(\n        intentTransactionParams,\n        {\n          origin: 'metamask',\n          actionId: generateActionId(),\n          requireApproval: false,\n          isStateOnly: true,\n          networkClientId,\n          type: transactionType,\n        },\n      );\n\n      const intentTxMeta = txMetaPromise;\n\n      // Map intent order status to TransactionController status\n      const initialTransactionStatus = mapIntentOrderStatusToTransactionStatus(\n        intentOrder.status,\n      );\n\n      // Update transaction with proper initial status based on intent order\n      const statusUpdatedTxMeta = {\n        ...intentTxMeta,\n        status: initialTransactionStatus,\n      };\n\n      // Update with actual transaction metadata\n      const syntheticMeta = {\n        ...statusUpdatedTxMeta,\n        isIntentTx: true,\n        orderUid,\n        intentType: isCrossChainTx ? 'bridge' : 'swap',\n      } as unknown as TransactionMeta;\n\n      // Record in bridge history with actual transaction metadata\n      try {\n        // Use orderId as the history key for intent transactions\n        const bridgeHistoryKey = orderUid;\n\n        // Create a bridge transaction metadata that includes the original txId\n        const bridgeTxMetaForHistory = {\n          ...syntheticMeta,\n          id: bridgeHistoryKey,\n          originalTransactionId: syntheticMeta.id, // Keep original txId for TransactionController updates\n        } as TransactionMeta;\n\n        const startTime = Date.now();\n\n        this.#addTxToHistory({\n          accountAddress,\n          bridgeTxMeta: bridgeTxMetaForHistory,\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: syntheticMeta.hash ?? '',\n          },\n          quoteResponse,\n          slippagePercentage: 0,\n          isStxEnabled: false,\n          approvalTxId,\n          startTime,\n          location,\n          abTests,\n        });\n\n        // Start polling using the orderId key to route to intent manager\n        this.#startPollingForTxId(bridgeHistoryKey);\n      } catch (error) {\n        console.error(\n          ' [submitIntent] Failed to add to bridge history',\n          error,\n        );\n        // non-fatal but log the error\n      }\n      return syntheticMeta;\n    } catch (error) {\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Failed,\n        undefined,\n        {\n          error_message: (error as Error)?.message,\n          ...preConfirmationProperties,\n        },\n      );\n\n      throw error;\n    }\n  };\n\n  /**\n   * Tracks post-submission events for a cross-chain swap based on the history item\n   *\n   * @param eventName - The name of the event to track\n   * @param txMetaId - The txMetaId of the history item to track the event for\n   * @param eventProperties - The properties for the event\n   */\n  readonly #trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      | typeof UnifiedSwapBridgeEventName.Submitted\n      | typeof UnifiedSwapBridgeEventName.Failed\n      | typeof UnifiedSwapBridgeEventName.Completed\n      | typeof UnifiedSwapBridgeEventName.StatusValidationFailed\n      | typeof UnifiedSwapBridgeEventName.PollingStatusUpdated,\n  >(\n    eventName: EventName,\n    txMetaId?: string,\n    eventProperties?: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): void => {\n    const historyAbTests = txMetaId\n      ? this.state.txHistory?.[txMetaId]?.abTests\n      : undefined;\n    const resolvedAbTests =\n      eventProperties?.ab_tests ?? historyAbTests ?? undefined;\n\n    const baseProperties = {\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n      location:\n        eventProperties?.location ??\n        (txMetaId ? this.state.txHistory?.[txMetaId]?.location : undefined) ??\n        MetaMetricsSwapsEventSource.MainView,\n      ...(eventProperties ?? {}),\n      ...(resolvedAbTests &&\n        Object.keys(resolvedAbTests).length > 0 && {\n          ab_tests: resolvedAbTests,\n        }),\n    };\n\n    // This will publish events for PERPS dropped tx failures as well\n    if (!txMetaId) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const historyItem: BridgeHistoryItem | undefined =\n      this.state.txHistory[txMetaId];\n\n    if (!historyItem) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const requestParamProperties = getRequestParamFromHistory(historyItem);\n    // Always publish StatusValidationFailed event, regardless of featureId\n    if (eventName === UnifiedSwapBridgeEventName.StatusValidationFailed) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        {\n          ...baseProperties,\n          chain_id_source: requestParamProperties.chain_id_source,\n          chain_id_destination: requestParamProperties.chain_id_destination,\n          token_address_source: requestParamProperties.token_address_source,\n          token_address_destination:\n            requestParamProperties.token_address_destination,\n          refresh_count: historyItem.attempts?.counter ?? 0,\n        },\n      );\n      return;\n    }\n\n    // Skip tracking all other events when featureId is set (i.e. PERPS)\n    if (historyItem.featureId) {\n      return;\n    }\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      historyItem.account,\n    );\n\n    const { transactions } = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === txMetaId,\n    );\n    const approvalTxMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === historyItem.approvalTxId,\n    );\n\n    const requiredEventProperties = {\n      ...baseProperties,\n      ...requestParamProperties,\n      ...getRequestMetadataFromHistory(historyItem, selectedAccount),\n      ...getTradeDataFromHistory(historyItem),\n      ...getTxStatusesFromHistory(historyItem),\n      ...getFinalizedTxProperties(historyItem, txMeta, approvalTxMeta),\n      ...getPriceImpactFromQuote(historyItem.quote),\n    };\n\n    this.messenger.call(\n      'BridgeController:trackUnifiedSwapBridgeEvent',\n      eventName,\n      requiredEventProperties,\n    );\n  };\n}\n"]}
\ No newline at end of file
diff --git a/dist/bridge-status-controller.d.cts b/dist/bridge-status-controller.d.cts
index a71266a9c15070d9fd9242148b16ad0e454184e9..54a52fcda845cfc1e026164364fdb1703538a55b 100644
--- a/dist/bridge-status-controller.d.cts
+++ b/dist/bridge-status-controller.d.cts
@@ -86,9 +86,10 @@ export declare class BridgeStatusController extends BridgeStatusController_base<
      * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
      * @param quotesReceivedContext - The context for the QuotesReceived event
      * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+     * @param abTests - A/B test context to attribute events to specific experiments
      * @returns The transaction meta
      */
-    submitTx: (accountAddress: string, quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata, isStxEnabledOnClient: boolean, quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived], location?: MetaMetricsSwapsEventSource) => Promise<TransactionMeta & Partial<SolanaTransactionMeta>>;
+    submitTx: (accountAddress: string, quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata, isStxEnabledOnClient: boolean, quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived], location?: MetaMetricsSwapsEventSource, abTests?: Record<string, string>) => Promise<TransactionMeta & Partial<SolanaTransactionMeta>>;
     /**
      * UI-signed intent submission (fast path): the UI generates the EIP-712 signature and calls this with the raw signature.
      * Here we submit the order to the intent provider and create a synthetic history entry for UX.
@@ -98,6 +99,7 @@ export declare class BridgeStatusController extends BridgeStatusController_base<
      * @param params.signature - Hex signature produced by eth_signTypedData_v4
      * @param params.accountAddress - The EOA submitting the order
      * @param params.location - The entry point from which the user initiated the swap or bridge
+     * @param params.abTests - A/B test context to attribute events to specific experiments
      * @returns A lightweight TransactionMeta-like object for history linking
      */
     submitIntent: (params: {
@@ -105,6 +107,7 @@ export declare class BridgeStatusController extends BridgeStatusController_base<
         signature: string;
         accountAddress: string;
         location?: MetaMetricsSwapsEventSource;
+        abTests?: Record<string, string>;
     }) => Promise<Pick<TransactionMeta, 'id' | 'chainId' | 'type' | 'status'>>;
 }
 export {};
diff --git a/dist/bridge-status-controller.d.cts.map b/dist/bridge-status-controller.d.cts.map
index d46c604b152af2911d82e9e8329df2c2ce6a2f2c..edca1b81c4b4390396f1eb72c3792c0727465d79 100644
--- a/dist/bridge-status-controller.d.cts.map
+++ b/dist/bridge-status-controller.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status-controller.d.cts","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"bridge-status-controller.d.cts","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/bridge-status-controller.d.mts b/dist/bridge-status-controller.d.mts
index 2b179d7b33b9c2c74dcbbfdb85bcd22228c03960..fc622e941e4d3f663bb8f0946d9d70050b46a77f 100644
--- a/dist/bridge-status-controller.d.mts
+++ b/dist/bridge-status-controller.d.mts
@@ -86,9 +86,10 @@ export declare class BridgeStatusController extends BridgeStatusController_base<
      * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
      * @param quotesReceivedContext - The context for the QuotesReceived event
      * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+     * @param abTests - A/B test context to attribute events to specific experiments
      * @returns The transaction meta
      */
-    submitTx: (accountAddress: string, quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata, isStxEnabledOnClient: boolean, quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived], location?: MetaMetricsSwapsEventSource) => Promise<TransactionMeta & Partial<SolanaTransactionMeta>>;
+    submitTx: (accountAddress: string, quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata, isStxEnabledOnClient: boolean, quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived], location?: MetaMetricsSwapsEventSource, abTests?: Record<string, string>) => Promise<TransactionMeta & Partial<SolanaTransactionMeta>>;
     /**
      * UI-signed intent submission (fast path): the UI generates the EIP-712 signature and calls this with the raw signature.
      * Here we submit the order to the intent provider and create a synthetic history entry for UX.
@@ -98,6 +99,7 @@ export declare class BridgeStatusController extends BridgeStatusController_base<
      * @param params.signature - Hex signature produced by eth_signTypedData_v4
      * @param params.accountAddress - The EOA submitting the order
      * @param params.location - The entry point from which the user initiated the swap or bridge
+     * @param params.abTests - A/B test context to attribute events to specific experiments
      * @returns A lightweight TransactionMeta-like object for history linking
      */
     submitIntent: (params: {
@@ -105,6 +107,7 @@ export declare class BridgeStatusController extends BridgeStatusController_base<
         signature: string;
         accountAddress: string;
         location?: MetaMetricsSwapsEventSource;
+        abTests?: Record<string, string>;
     }) => Promise<Pick<TransactionMeta, 'id' | 'chainId' | 'type' | 'status'>>;
 }
 export {};
diff --git a/dist/bridge-status-controller.d.mts.map b/dist/bridge-status-controller.d.mts.map
index 6cc47b701baf959351dcc37bb7d871513e990ef5..8a3c0d3f9e847390f950f782c43c421e2b9c4b61 100644
--- a/dist/bridge-status-controller.d.mts.map
+++ b/dist/bridge-status-controller.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status-controller.d.mts","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"AAEA,OAAO,KAAK,EACV,aAAa,EACb,8BAA8B,EAC9B,MAAM,EACN,aAAa,EAEb,KAAK,EACN,oCAAoC;AACrC,OAAO,EAIL,0BAA0B,EAO1B,2BAA2B,EAK5B,oCAAoC;AACrC,OAAO,KAAK,EAAE,aAAa,EAAE,mCAAmC;AAOhE,OAAO,KAAK,EACV,qBAAqB,EACrB,eAAe,EAEhB,yCAAyC;AAK1C,OAAO,EAEL,6BAA6B,EAK9B,wBAAoB;AACrB,OAAO,KAAK,EACV,2BAA2B,EAC3B,2CAA2C,EAC3C,aAAa,EACb,qBAAqB,EACrB,iBAAiB,EAClB,oBAAgB;AACjB,OAAO,KAAK,EAAE,+BAA+B,EAAE,oBAAgB;AAC/D,OAAO,EAAE,cAAc,EAAE,oBAAgB;AAiDzC,wEAAwE;AACxE,KAAK,wBAAwB,GAAG,uBAAuB,CAAC;AAGxD,MAAM,MAAM,uBAAuB,GAAG;IACpC,cAAc,EAAE,MAAM,CAAC;CACxB,CAAC;;;;;;;;;;;;;;;;AACF,qBAAa,sBAAuB,SAAQ,4BAC1C,OAAO,6BAA6B,EACpC,2BAA2B,EAC3B,+BAA+B,CAChC;;gBAuBa,EACV,SAAS,EACT,KAAK,EACL,QAAQ,EACR,OAAO,EACP,gBAAgB,EAChB,qBAAqB,EACrB,mBAAmB,EACnB,gBAAgB,EAChB,MAAM,EACN,OAAO,GACR,EAAE;QACD,SAAS,EAAE,+BAA+B,CAAC;QAC3C,KAAK,CAAC,EAAE,OAAO,CAAC,2BAA2B,CAAC,CAAC;QAC7C,QAAQ,EAAE,cAAc,CAAC;QACzB,OAAO,EAAE,aAAa,CAAC;QACvB,gBAAgB,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,cAAc,CAAC;QACxE,qBAAqB,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,mBAAmB,CAAC;QAClF,mBAAmB,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,iBAAiB,CAAC;QAC9E,gBAAgB,EAAE,OAAO,qBAAqB,CAAC,SAAS,CAAC,cAAc,CAAC;QACxE,MAAM,CAAC,EAAE;YACP,sBAAsB,CAAC,EAAE,MAAM,CAAC;SACjC,CAAC;QACF,OAAO,CAAC,EAAE,aAAa,CAAC;KACzB;IAyJD,UAAU,QAAO,IAAI,CAInB;IAEF,gBAAgB;iBAIL,MAAM;uBACA,OAAO;UACpB,IAAI,CAkBN;IAEF;;;;;;;OAOG;IACH,+BAA+B,eAAgB;QAC7C,QAAQ,CAAC,EAAE,MAAM,CAAC;QAClB,MAAM,CAAC,EAAE,MAAM,CAAC;KACjB,KAAG,IAAI,CAqFN;IAEF;;;;;OAKG;IACH,8BAA8B,aAClB,MAAM,KACf,iBAAiB,GAAG,SAAS,CAE9B;IAsKF;;;;;;;;;OASG;IACH,6BAA6B,kBACZ,2CAA2C,KACzD,IAAI,CAWL;IAIF,YAAY,iBACI,wBAAwB,KACrC,QAAQ,IAAI,CAAC,CAEd;IAgoBF;;;;;;;;;OASG;IACH,QAAQ,mBACU,MAAM,iBACP,cAAc,KAAK,EAAE,KAAK,CAAC,GAAG,aAAa,wBACpC,OAAO,0BACL,8BAA8B,CAAC,2BAA2B,cAAc,CAAC,aACvF,2BAA2B,KACpC,QAAQ,eAAe,GAAG,QAAQ,qBAAqB,CAAC,CAAC,CA6Q1D;IAEF;;;;;;;;;;OAUG;IACH,YAAY,WAAkB;QAC5B,aAAa,EAAE,cAAc,MAAM,GAAG,MAAM,CAAC,GAAG,aAAa,CAAC;QAC9D,SAAS,EAAE,MAAM,CAAC;QAClB,cAAc,EAAE,MAAM,CAAC;QACvB,QAAQ,CAAC,EAAE,2BAA2B,CAAC;KACxC,KAAG,QAAQ,KAAK,eAAe,EAAE,IAAI,GAAG,SAAS,GAAG,MAAM,GAAG,QAAQ,CAAC,CAAC,CAuLtE;CA8GH"}
\ No newline at end of file
+{"version":3,"file":"bridge-status-controller.d.mts","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/bridge-status-controller.mjs b/dist/bridge-status-controller.mjs
index df7a99ca755dad373cfb4d54a9b608d59e51a8fe..40be93cffa872db33b3c2c17f63ad0a7fa760102 100644
--- a/dist/bridge-status-controller.mjs
+++ b/dist/bridge-status-controller.mjs
@@ -9,7 +9,7 @@ var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (
     if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
     return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
 };
-var _BridgeStatusController_instances, _BridgeStatusController_pollingTokensByTxMetaId, _BridgeStatusController_intentStatusManager, _BridgeStatusController_clientId, _BridgeStatusController_fetchFn, _BridgeStatusController_config, _BridgeStatusController_addTransactionFn, _BridgeStatusController_addTransactionBatchFn, _BridgeStatusController_updateTransactionFn, _BridgeStatusController_estimateGasFeeFn, _BridgeStatusController_trace, _BridgeStatusController_markTxAsFailed, _BridgeStatusController_restartPollingForIncompleteHistoryItems, _BridgeStatusController_addTxToHistory, _BridgeStatusController_rekeyHistoryItem, _BridgeStatusController_startPollingForTxId, _BridgeStatusController_shouldPollHistoryItem, _BridgeStatusController_getMultichainSelectedAccount, _BridgeStatusController_handleFetchFailure, _BridgeStatusController_fetchBridgeTxStatus, _BridgeStatusController_getSrcTxHash, _BridgeStatusController_updateSrcTxHash, _BridgeStatusController_wipeBridgeStatusByChainId, _BridgeStatusController_handleNonEvmTx, _BridgeStatusController_waitForHashAndReturnFinalTxMeta, _BridgeStatusController_waitForTxConfirmation, _BridgeStatusController_handleApprovalTx, _BridgeStatusController_handleEvmTransaction, _BridgeStatusController_handleUSDTAllowanceReset, _BridgeStatusController_calculateGasFees, _BridgeStatusController_handleEvmTransactionBatch, _BridgeStatusController_trackUnifiedSwapBridgeEvent;
+var _BridgeStatusController_instances, _BridgeStatusController_pollingTokensByTxMetaId, _BridgeStatusController_intentStatusManager, _BridgeStatusController_clientId, _BridgeStatusController_fetchFn, _BridgeStatusController_config, _BridgeStatusController_addTransactionFn, _BridgeStatusController_addTransactionBatchFn, _BridgeStatusController_updateTransactionFn, _BridgeStatusController_estimateGasFeeFn, _BridgeStatusController_trace, _BridgeStatusController_markTxAsFailed, _BridgeStatusController_restartPollingForIncompleteHistoryItems, _BridgeStatusController_addTxToHistory, _BridgeStatusController_rekeyHistoryItem, _BridgeStatusController_startPollingForTxId, _BridgeStatusController_shouldPollHistoryItem, _BridgeStatusController_getMultichainSelectedAccount, _BridgeStatusController_handleFetchFailure, _BridgeStatusController_fetchBridgeTxStatus, _BridgeStatusController_getJwt, _BridgeStatusController_getSrcTxHash, _BridgeStatusController_updateSrcTxHash, _BridgeStatusController_wipeBridgeStatusByChainId, _BridgeStatusController_handleNonEvmTx, _BridgeStatusController_waitForHashAndReturnFinalTxMeta, _BridgeStatusController_waitForTxConfirmation, _BridgeStatusController_handleApprovalTx, _BridgeStatusController_handleEvmTransaction, _BridgeStatusController_handleUSDTAllowanceReset, _BridgeStatusController_calculateGasFees, _BridgeStatusController_handleEvmTransactionBatch, _BridgeStatusController_trackUnifiedSwapBridgeEvent;
 import { formatChainIdToHex, isNonEvmChainId, StatusTypes, UnifiedSwapBridgeEventName, formatChainIdToCaip, isCrossChain, isTronChainId, isEvmTxData, isHardwareWallet, MetricsActionType, MetaMetricsSwapsEventSource, isBitcoinTrade, isTronTrade, AbortReason, PollingStatus } from "@metamask/bridge-controller";
 import { toHex } from "@metamask/controller-utils";
 import { StaticIntervalPollingController } from "@metamask/polling-controller";
@@ -204,7 +204,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
             });
         });
         _BridgeStatusController_addTxToHistory.set(this, (startPollingForBridgeTxStatusArgs, actionId) => {
-            const { bridgeTxMeta, statusRequest, quoteResponse, startTime, slippagePercentage, initialDestAssetBalance, targetContractAddress, approvalTxId, isStxEnabled, location, accountAddress: selectedAddress, } = startPollingForBridgeTxStatusArgs;
+            const { bridgeTxMeta, statusRequest, quoteResponse, startTime, slippagePercentage, initialDestAssetBalance, targetContractAddress, approvalTxId, isStxEnabled, location, abTests, accountAddress: selectedAddress, } = startPollingForBridgeTxStatusArgs;
             // Determine the key for this history item:
             // - For pre-submission (non-batch EVM): use actionId
             // - For post-submission or other cases: use bridgeTxMeta.id
@@ -245,6 +245,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                 isStxEnabled: isStxEnabled ?? false,
                 featureId: quoteResponse.featureId,
                 location,
+                ...(abTests && { abTests }),
             };
             this.update((state) => {
                 // Use actionId as key for pre-submission, or txMeta.id for post-submission
@@ -382,7 +383,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                 if (isIntent) {
                     const { srcChainId } = historyItem.quote;
                     const intentApi = new IntentApiImpl(__classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl, __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"));
-                    const intentOrder = await intentApi.getOrderStatus(bridgeTxMetaId, historyItem.quote.intent?.protocol ?? '', srcChainId.toString(), __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"));
+                    const intentOrder = await intentApi.getOrderStatus(bridgeTxMetaId, historyItem.quote.intent?.protocol ?? '', srcChainId.toString(), __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), await __classPrivateFieldGet(this, _BridgeStatusController_getJwt, "f").call(this));
                     intentOrderStatus = intentOrder.status;
                     intentTranslation = translateIntentOrderToBridgeStatus(intentOrder, srcChainId, historyItem.status.srcChain.txHash);
                     status = intentTranslation.status;
@@ -397,7 +398,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                     }
                     __classPrivateFieldGet(this, _BridgeStatusController_updateSrcTxHash, "f").call(this, bridgeTxMetaId, srcTxHash);
                     const statusRequest = getStatusRequestWithSrcTxHash(historyItem.quote, srcTxHash);
-                    const response = await fetchBridgeTxStatus(statusRequest, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl);
+                    const response = await fetchBridgeTxStatus(statusRequest, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), await __classPrivateFieldGet(this, _BridgeStatusController_getJwt, "f").call(this), __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"), __classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl);
                     status = response.status;
                     validationFailures = response.validationFailures;
                 }
@@ -453,6 +454,16 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                 __classPrivateFieldGet(this, _BridgeStatusController_handleFetchFailure, "f").call(this, bridgeTxMetaId);
             }
         });
+        _BridgeStatusController_getJwt.set(this, async () => {
+            try {
+                const token = await this.messenger.call('AuthenticationController:getBearerToken');
+                return token;
+            }
+            catch (error) {
+                console.error('Error getting JWT token for bridge-api request', error);
+                return undefined;
+            }
+        });
         _BridgeStatusController_getSrcTxHash.set(this, (bridgeTxMetaId) => {
             const { txHistory } = this.state;
             // Prefer the srcTxHash from bridgeStatusState so we don't have to l ook up in TransactionController
@@ -701,9 +712,10 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
          * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
          * @param quotesReceivedContext - The context for the QuotesReceived event
          * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+         * @param abTests - A/B test context to attribute events to specific experiments
          * @returns The transaction meta
          */
-        this.submitTx = async (accountAddress, quoteResponse, isStxEnabledOnClient, quotesReceivedContext, location = MetaMetricsSwapsEventSource.MainView) => {
+        this.submitTx = async (accountAddress, quoteResponse, isStxEnabledOnClient, quotesReceivedContext, location = MetaMetricsSwapsEventSource.MainView, abTests) => {
             this.messenger.call('BridgeController:stopPollingForQuotes', AbortReason.TransactionSubmitted, 
             // If trade is submitted before all quotes are loaded, the QuotesReceived event is published
             // If the trade has a featureId, it means it was submitted outside of the Unified Swap and Bridge experience, so no QuotesReceived event is published
@@ -713,7 +725,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                 throw new Error('Failed to submit cross-chain swap transaction: undefined multichain account');
             }
             const isHardwareAccount = isHardwareWallet(selectedAccount);
-            const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(quoteResponse, isStxEnabledOnClient, isHardwareAccount, location);
+            const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(quoteResponse, isStxEnabledOnClient, isHardwareAccount, location, abTests);
             // Emit Submitted event after submit button is clicked
             !quoteResponse.featureId &&
                 __classPrivateFieldGet(this, _BridgeStatusController_trackUnifiedSwapBridgeEvent, "f").call(this, UnifiedSwapBridgeEventName.Submitted, undefined, preConfirmationProperties);
@@ -835,6 +847,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                         startTime,
                         approvalTxId,
                         location,
+                        abTests,
                     }, actionId);
                     // Pass txFee when gasIncluded is true to use the quote's gas fees
                     // instead of re-estimating (which would fail for max native token swaps)
@@ -875,6 +888,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                         startTime,
                         approvalTxId,
                         location,
+                        abTests,
                     });
                 }
                 if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {
@@ -900,15 +914,16 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
          * @param params.signature - Hex signature produced by eth_signTypedData_v4
          * @param params.accountAddress - The EOA submitting the order
          * @param params.location - The entry point from which the user initiated the swap or bridge
+         * @param params.abTests - A/B test context to attribute events to specific experiments
          * @returns A lightweight TransactionMeta-like object for history linking
          */
         this.submitIntent = async (params) => {
-            const { quoteResponse, signature, accountAddress, location } = params;
+            const { quoteResponse, signature, accountAddress, location, abTests } = params;
             this.messenger.call('BridgeController:stopPollingForQuotes', AbortReason.TransactionSubmitted);
             // Build pre-confirmation properties for error tracking parity with submitTx
             const account = __classPrivateFieldGet(this, _BridgeStatusController_instances, "m", _BridgeStatusController_getMultichainSelectedAccount).call(this, accountAddress);
             const isHardwareAccount = Boolean(account) && isHardwareWallet(account);
-            const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(quoteResponse, false, isHardwareAccount, location);
+            const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(quoteResponse, false, isHardwareAccount, location, abTests);
             try {
                 const intent = getIntentFromQuote(quoteResponse);
                 // If backend provided an approval tx for this intent quote, submit it first (on-chain),
@@ -936,7 +951,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                     aggregatorId: intent.protocol,
                 };
                 const intentApi = new IntentApiImpl(__classPrivateFieldGet(this, _BridgeStatusController_config, "f").customBridgeApiBaseUrl, __classPrivateFieldGet(this, _BridgeStatusController_fetchFn, "f"));
-                const intentOrder = await intentApi.submitIntent(submissionParams, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"));
+                const intentOrder = await intentApi.submitIntent(submissionParams, __classPrivateFieldGet(this, _BridgeStatusController_clientId, "f"), await __classPrivateFieldGet(this, _BridgeStatusController_getJwt, "f").call(this));
                 const orderUid = intentOrder.id;
                 // Determine transaction type: swap for same-chain, bridge for cross-chain
                 const isCrossChainTx = isCrossChain(quoteResponse.quote.srcChainId, quoteResponse.quote.destChainId);
@@ -1004,6 +1019,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
                         approvalTxId,
                         startTime,
                         location,
+                        abTests,
                     });
                     // Start polling using the orderId key to route to intent manager
                     __classPrivateFieldGet(this, _BridgeStatusController_startPollingForTxId, "f").call(this, bridgeHistoryKey);
@@ -1030,12 +1046,20 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
          * @param eventProperties - The properties for the event
          */
         _BridgeStatusController_trackUnifiedSwapBridgeEvent.set(this, (eventName, txMetaId, eventProperties) => {
+            const historyAbTests = txMetaId
+                ? this.state.txHistory?.[txMetaId]?.abTests
+                : undefined;
+            const resolvedAbTests = eventProperties?.ab_tests ?? historyAbTests ?? undefined;
             const baseProperties = {
                 action_type: MetricsActionType.SWAPBRIDGE_V1,
                 location: eventProperties?.location ??
                     (txMetaId ? this.state.txHistory?.[txMetaId]?.location : undefined) ??
                     MetaMetricsSwapsEventSource.MainView,
                 ...(eventProperties ?? {}),
+                ...(resolvedAbTests &&
+                    Object.keys(resolvedAbTests).length > 0 && {
+                    ab_tests: resolvedAbTests,
+                }),
             };
             // This will publish events for PERPS dropped tx failures as well
             if (!txMetaId) {
@@ -1148,7 +1172,7 @@ export class BridgeStatusController extends StaticIntervalPollingController() {
         __classPrivateFieldGet(this, _BridgeStatusController_restartPollingForIncompleteHistoryItems, "f").call(this);
     }
 }
-_BridgeStatusController_pollingTokensByTxMetaId = new WeakMap(), _BridgeStatusController_intentStatusManager = new WeakMap(), _BridgeStatusController_clientId = new WeakMap(), _BridgeStatusController_fetchFn = new WeakMap(), _BridgeStatusController_config = new WeakMap(), _BridgeStatusController_addTransactionFn = new WeakMap(), _BridgeStatusController_addTransactionBatchFn = new WeakMap(), _BridgeStatusController_updateTransactionFn = new WeakMap(), _BridgeStatusController_estimateGasFeeFn = new WeakMap(), _BridgeStatusController_trace = new WeakMap(), _BridgeStatusController_markTxAsFailed = new WeakMap(), _BridgeStatusController_restartPollingForIncompleteHistoryItems = new WeakMap(), _BridgeStatusController_addTxToHistory = new WeakMap(), _BridgeStatusController_rekeyHistoryItem = new WeakMap(), _BridgeStatusController_startPollingForTxId = new WeakMap(), _BridgeStatusController_shouldPollHistoryItem = new WeakMap(), _BridgeStatusController_handleFetchFailure = new WeakMap(), _BridgeStatusController_fetchBridgeTxStatus = new WeakMap(), _BridgeStatusController_getSrcTxHash = new WeakMap(), _BridgeStatusController_updateSrcTxHash = new WeakMap(), _BridgeStatusController_wipeBridgeStatusByChainId = new WeakMap(), _BridgeStatusController_handleNonEvmTx = new WeakMap(), _BridgeStatusController_waitForHashAndReturnFinalTxMeta = new WeakMap(), _BridgeStatusController_waitForTxConfirmation = new WeakMap(), _BridgeStatusController_handleApprovalTx = new WeakMap(), _BridgeStatusController_handleEvmTransaction = new WeakMap(), _BridgeStatusController_handleUSDTAllowanceReset = new WeakMap(), _BridgeStatusController_calculateGasFees = new WeakMap(), _BridgeStatusController_handleEvmTransactionBatch = new WeakMap(), _BridgeStatusController_trackUnifiedSwapBridgeEvent = new WeakMap(), _BridgeStatusController_instances = new WeakSet(), _BridgeStatusController_getMultichainSelectedAccount = function _BridgeStatusController_getMultichainSelectedAccount(accountAddress) {
+_BridgeStatusController_pollingTokensByTxMetaId = new WeakMap(), _BridgeStatusController_intentStatusManager = new WeakMap(), _BridgeStatusController_clientId = new WeakMap(), _BridgeStatusController_fetchFn = new WeakMap(), _BridgeStatusController_config = new WeakMap(), _BridgeStatusController_addTransactionFn = new WeakMap(), _BridgeStatusController_addTransactionBatchFn = new WeakMap(), _BridgeStatusController_updateTransactionFn = new WeakMap(), _BridgeStatusController_estimateGasFeeFn = new WeakMap(), _BridgeStatusController_trace = new WeakMap(), _BridgeStatusController_markTxAsFailed = new WeakMap(), _BridgeStatusController_restartPollingForIncompleteHistoryItems = new WeakMap(), _BridgeStatusController_addTxToHistory = new WeakMap(), _BridgeStatusController_rekeyHistoryItem = new WeakMap(), _BridgeStatusController_startPollingForTxId = new WeakMap(), _BridgeStatusController_shouldPollHistoryItem = new WeakMap(), _BridgeStatusController_handleFetchFailure = new WeakMap(), _BridgeStatusController_fetchBridgeTxStatus = new WeakMap(), _BridgeStatusController_getJwt = new WeakMap(), _BridgeStatusController_getSrcTxHash = new WeakMap(), _BridgeStatusController_updateSrcTxHash = new WeakMap(), _BridgeStatusController_wipeBridgeStatusByChainId = new WeakMap(), _BridgeStatusController_handleNonEvmTx = new WeakMap(), _BridgeStatusController_waitForHashAndReturnFinalTxMeta = new WeakMap(), _BridgeStatusController_waitForTxConfirmation = new WeakMap(), _BridgeStatusController_handleApprovalTx = new WeakMap(), _BridgeStatusController_handleEvmTransaction = new WeakMap(), _BridgeStatusController_handleUSDTAllowanceReset = new WeakMap(), _BridgeStatusController_calculateGasFees = new WeakMap(), _BridgeStatusController_handleEvmTransactionBatch = new WeakMap(), _BridgeStatusController_trackUnifiedSwapBridgeEvent = new WeakMap(), _BridgeStatusController_instances = new WeakSet(), _BridgeStatusController_getMultichainSelectedAccount = function _BridgeStatusController_getMultichainSelectedAccount(accountAddress) {
     return this.messenger.call('AccountsController:getAccountByAddress', accountAddress);
 };
 //# sourceMappingURL=bridge-status-controller.mjs.map
\ No newline at end of file
diff --git a/dist/bridge-status-controller.mjs.map b/dist/bridge-status-controller.mjs.map
index e76cb12f688d4ae2263d9ab3a0c1a342493ab358..232e9b5f585a876fcce241490024c12716f6c6d6 100644
--- a/dist/bridge-status-controller.mjs.map
+++ b/dist/bridge-status-controller.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status-controller.mjs","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":";;;;;;;;;;;;AAUA,OAAO,EACL,kBAAkB,EAClB,eAAe,EACf,WAAW,EACX,0BAA0B,EAC1B,mBAAmB,EACnB,YAAY,EACZ,aAAa,EACb,WAAW,EACX,gBAAgB,EAChB,iBAAiB,EACjB,2BAA2B,EAC3B,cAAc,EACd,WAAW,EACX,WAAW,EACX,aAAa,EACd,oCAAoC;AAErC,OAAO,EAAE,KAAK,EAAE,mCAAmC;AACnD,OAAO,EAAE,+BAA+B,EAAE,qCAAqC;AAC/E,OAAO,EACL,iBAAiB,EACjB,eAAe,EAChB,yCAAyC;AAM1C,OAAO,EAAE,WAAW,EAAE,wBAAwB;AAG9C,OAAO,EAAE,mBAAmB,EAAE,8CAA0C;AACxE,OAAO,EACL,wBAAwB,EACxB,6BAA6B,EAC7B,sCAAsC,EACtC,YAAY,EACZ,mBAAmB,EACnB,SAAS,EACV,wBAAoB;AASrB,OAAO,EAAE,cAAc,EAAE,oBAAgB;AACzC,OAAO,EACL,mBAAmB,EACnB,6BAA6B,EAC7B,iCAAiC,EAClC,kCAA8B;AAC/B,OAAO,EAAE,iBAAiB,EAAE,wBAAoB;AAChD,OAAO,EACL,aAAa,EAEb,uCAAuC,EACvC,kCAAkC,EACnC,+BAA2B;AAC5B,OAAO,EACL,wBAAwB,EACxB,uBAAuB,EACvB,6BAA6B,EAC7B,0BAA0B,EAC1B,uBAAuB,EACvB,qCAAqC,EACrC,wBAAwB,EACxB,qCAAqC,EACtC,4BAAwB;AACzB,OAAO,EACL,gCAAgC,EAChC,4BAA4B,EAC5B,gBAAgB,EAChB,aAAa,EACb,kBAAkB,EAClB,sBAAsB,EACtB,mBAAmB,EACnB,+BAA+B,EAC/B,sBAAsB,EACtB,gBAAgB,EAChB,qBAAqB,EACrB,uBAAuB,EACxB,gCAA4B;AAE7B,MAAM,QAAQ,GAA+C;IAC3D,uGAAuG;IACvG,wDAAwD;IACxD,SAAS,EAAE;QACT,kBAAkB,EAAE,IAAI;QACxB,OAAO,EAAE,IAAI;QACb,sBAAsB,EAAE,KAAK;QAC7B,QAAQ,EAAE,IAAI;KACf;CACF,CAAC;AASF,MAAM,OAAO,sBAAuB,SAAQ,+BAA+B,EAI1E;IAuBC,YAAY,EACV,SAAS,EACT,KAAK,EACL,QAAQ,EACR,OAAO,EACP,gBAAgB,EAChB,qBAAqB,EACrB,mBAAmB,EACnB,gBAAgB,EAChB,MAAM,EACN,OAAO,GAcR;QACC,KAAK,CAAC;YACJ,IAAI,EAAE,6BAA6B;YACnC,QAAQ;YACR,SAAS;YACT,8BAA8B;YAC9B,KAAK,EAAE;gBACL,GAAG,sCAAsC;gBACzC,GAAG,KAAK;aACT;SACF,CAAC,CAAC;;QAxDL,0DAAwD,EAAE,EAAC;QAElD,8DAA0C;QAE1C,mDAA0B;QAE1B,kDAAwB;QAExB,iDAEP;QAEO,2DAAyE;QAEzE,gEAAmF;QAEnF,8DAA+E;QAE/E,2DAAyE;QAEzE,gDAAsB;QAsJ/B,uEAAuE;QAC9D,iDAAkB,CAAC,EAC1B,EAAE,EAAE,QAAQ,EACZ,QAAQ,GACQ,EAAQ,EAAE;YAC1B,4BAA4B;YAC5B,IAAI,YAAY,GAAuB,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC;gBACnE,CAAC,CAAC,QAAQ;gBACV,CAAC,CAAC,SAAS,CAAC;YAEd,qFAAqF;YACrF,IAAI,CAAC,YAAY,IAAI,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAChE,YAAY,GAAG,QAAQ,CAAC;YAC1B,CAAC;YAED,qDAAqD;YACrD,YAAY,KAAZ,YAAY,GAAK,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CACrD,CAAC,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,YAAY,KAAK,QAAQ,CAC7D,EAAC;YAEF,IAAI,CAAC,YAAY,EAAE,CAAC;gBAClB,OAAO;YACT,CAAC;YACD,MAAM,GAAG,GAAG,YAAY,CAAC;YACzB,IAAI,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,EAAE;gBAC1B,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC;YAChE,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEF,eAAU,GAAG,GAAS,EAAE;YACtB,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,KAAK,CAAC,SAAS,GAAG,sCAAsC,CAAC,SAAS,CAAC;YACrE,CAAC,CAAC,CAAC;QACL,CAAC,CAAC;QAEF,qBAAgB,GAAG,CAAC,EAClB,OAAO,EACP,aAAa,GAId,EAAQ,EAAE;YACT,qCAAqC;YACrC,IAAI,aAAa,EAAE,CAAC;gBAClB,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;oBACpB,KAAK,CAAC,SAAS,GAAG,sCAAsC,CAAC,SAAS,CAAC;gBACrE,CAAC,CAAC,CAAC;YACL,CAAC;iBAAM,CAAC;gBACN,MAAM,EAAE,uBAAuB,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACrD,4BAA4B,CAC7B,CAAC;gBACF,MAAM,qBAAqB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAC/C,wCAAwC,EACxC,uBAAuB,CACxB,CAAC;gBACF,MAAM,eAAe,GAAG,qBAAqB,CAAC,aAAa,CAAC,OAAO,CAAC;gBAEpE,uBAAA,IAAI,yDAA2B,MAA/B,IAAI,EAA4B,OAAO,EAAE,eAAe,CAAC,CAAC;YAC5D,CAAC;QACH,CAAC,CAAC;QAEF;;;;;;;WAOG;QACH,oCAA+B,GAAG,CAAC,UAGlC,EAAQ,EAAE;YACT,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,UAAU,CAAC;YAExC,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM,EAAE,CAAC;gBACzB,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;YAChE,CAAC;YAED,8CAA8C;YAC9C,IAAI,cAAkC,CAAC;YAEvC,IAAI,QAAQ,EAAE,CAAC;gBACb,4BAA4B;gBAC5B,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC;oBACnC,cAAc,GAAG,QAAQ,CAAC;gBAC5B,CAAC;YACH,CAAC;iBAAM,IAAI,MAAM,EAAE,CAAC;gBAClB,6CAA6C;gBAC7C,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CACrD,CAAC,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,KAAK,MAAM,CACnE,CAAC;YACJ,CAAC;YAED,IAAI,CAAC,cAAc,EAAE,CAAC;gBACpB,MAAM,IAAI,KAAK,CACb,2CACE,QAAQ,CAAC,CAAC,CAAC,aAAa,QAAQ,EAAE,CAAC,CAAC,CAAC,WAAW,MAAM,EACxD,EAAE,CACH,CAAC;YACJ,CAAC;YAED,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;YAEzD,sDAAsD;YACtD,MAAM,gBAAgB,GAAG,WAAW,CAAC,QAAQ,EAAE,OAAO,IAAI,CAAC,CAAC;YAE5D,6BAA6B;YAC7B,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,IAAI,cAAc,EAAE,CAAC;oBACnB,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,QAAQ,GAAG,SAAS,CAAC;gBACvD,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,2EAA2E;YAC3E,IAAI,uBAAA,IAAI,qDAAuB,MAA3B,IAAI,EAAwB,WAAW,CAAC,EAAE,CAAC;gBAC7C,yDAAyD;gBACzD,MAAM,oBAAoB,GACxB,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAAC;gBAEhD,IAAI,CAAC,oBAAoB,EAAE,CAAC;oBAC1B,kBAAkB;oBAClB,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,cAAc,CAAC,CAAC;oBAE1C,yCAAyC;oBACzC,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;wBAC3B,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACzC,wCAAwC,EACxC,WAAW,CAAC,OAAO,CACpB,CAAC;wBACF,MAAM,aAAa,GAAG,0BAA0B,CAAC,WAAW,CAAC,CAAC;wBAC9D,MAAM,eAAe,GAAG,6BAA6B,CACnD,WAAW,EACX,eAAe,CAChB,CAAC;wBACF,MAAM,EAAE,iBAAiB,EAAE,CAAC,EAAE,GAAG,uBAAuB,EAAE,GACxD,eAAe,CAAC;wBAElB,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,oBAAoB,EAC/C,cAAc,EACd;4BACE,GAAG,uBAAuB,CAAC,WAAW,CAAC;4BACvC,GAAG,uBAAuB,CAAC,WAAW,CAAC,KAAK,CAAC;4BAC7C,GAAG,uBAAuB;4BAC1B,eAAe,EAAE,aAAa,CAAC,eAAe;4BAC9C,oBAAoB,EAAE,aAAa,CAAC,oBAAoB;4BACxD,mBAAmB,EAAE,aAAa,CAAC,mBAAmB;4BACtD,wBAAwB,EAAE,aAAa,CAAC,wBAAwB;4BAChE,WAAW,EAAE,iBAAiB,CAAC,aAAa;4BAC5C,cAAc,EAAE,aAAa,CAAC,iBAAiB;4BAC/C,cAAc,EAAE,gBAAgB;yBACjC,CACF,CAAC;oBACJ,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC,CAAC;QAEF;;;;;WAKG;QACH,mCAA8B,GAAG,CAC/B,QAAgB,EACe,EAAE;YACjC,OAAO,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QACxC,CAAC,CAAC;QAEF;;;WAGG;QACM,0EAA2C,GAAS,EAAE;YAC7D,mFAAmF;YACnF,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YACjC,MAAM,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YAC9C,MAAM,sBAAsB,GAAG,YAAY;iBACxC,MAAM,CACL,CAAC,WAAW,EAAE,EAAE,CACd,WAAW,CAAC,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,OAAO;gBACjD,WAAW,CAAC,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,OAAO,CACpD;gBACD,wDAAwD;iBACvD,MAAM,CACL,CACE,WAAW,EAC8C,EAAE,CAC3D,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,CAChC;iBACA,MAAM,CAAC,CAAC,WAAW,EAAE,EAAE;gBACtB,mFAAmF;gBACnF,MAAM,YAAY,GAChB,uBAAA,IAAI,uDAAyB,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;gBACtD,OAAO,CAAC,YAAY,CAAC;YACvB,CAAC,CAAC;gBACF,mEAAmE;iBAClE,MAAM,CAAC,CAAC,WAAW,EAAE,EAAE;gBACtB,OAAO,uBAAA,IAAI,qDAAuB,MAA3B,IAAI,EAAwB,WAAW,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC;YAEL,sBAAsB,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE;gBAC7C,MAAM,cAAc,GAAG,WAAW,CAAC,QAAQ,CAAC;gBAC5C,MAAM,eAAe,GAAG,iCAAiC,CACvD,WAAW,CAAC,QAAQ,CACrB,CAAC;gBACF,IAAI,eAAe,EAAE,CAAC;oBACpB,OAAO;gBACT,CAAC;gBAED,8FAA8F;gBAC9F,uEAAuE;gBACvE,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,cAAc,CAAC,CAAC;YAC5C,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEO,iDAAkB,CACzB,iCAA8E,EAC9E,QAAiB,EACX,EAAE;YACR,MAAM,EACJ,YAAY,EACZ,aAAa,EACb,aAAa,EACb,SAAS,EACT,kBAAkB,EAClB,uBAAuB,EACvB,qBAAqB,EACrB,YAAY,EACZ,YAAY,EACZ,QAAQ,EACR,cAAc,EAAE,eAAe,GAChC,GAAG,iCAAiC,CAAC;YAEtC,2CAA2C;YAC3C,qDAAqD;YACrD,4DAA4D;YAC5D,MAAM,UAAU,GAAG,aAAa,CAAC,QAAQ,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YAE7D,6GAA6G;YAC7G,wDAAwD;YACxD,MAAM,aAAa,GAAsB;gBACvC,QAAQ,EAAE,YAAY,EAAE,EAAE;gBAC1B,QAAQ;gBACR,qBAAqB,EAClB,YAA6D;oBAC5D,EAAE,qBAAqB,IAAI,YAAY,EAAE,EAAE,EAAE,wCAAwC;gBACzF,OAAO,EAAE,YAAY,EAAE,OAAO;gBAC9B,KAAK,EAAE,aAAa,CAAC,KAAK;gBAC1B,SAAS;gBACT,gCAAgC,EAC9B,aAAa,CAAC,gCAAgC;gBAChD,kBAAkB;gBAClB,WAAW,EAAE;oBACX,UAAU,EAAE,aAAa,CAAC,UAAU,EAAE,MAAM,IAAI,GAAG;oBACnD,eAAe,EAAE,aAAa,CAAC,UAAU,EAAE,GAAG,IAAI,SAAS;oBAC3D,cAAc,EAAE,aAAa,CAAC,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,SAAS;oBACjE,iBAAiB,EAAE,aAAa,CAAC,aAAa,EAAE,GAAG,IAAI,SAAS;oBAChE,eAAe,EAAE,aAAa,CAAC,MAAM,EAAE,SAAS,EAAE,MAAM,IAAI,SAAS;iBACtE;gBACD,uBAAuB;gBACvB,qBAAqB;gBACrB,OAAO,EAAE,eAAe;gBACxB,MAAM,EAAE;oBACN,qGAAqG;oBACrG,wEAAwE;oBACxE,MAAM,EAAE,WAAW,CAAC,OAAO;oBAC3B,QAAQ,EAAE;wBACR,OAAO,EAAE,aAAa,CAAC,UAAU;wBACjC,MAAM,EAAE,aAAa,CAAC,SAAS;qBAChC;iBACF;gBACD,aAAa,EAAE,OAAO,CAAC,aAAa,CAAC,QAAQ,CAAC;gBAC9C,YAAY;gBACZ,YAAY,EAAE,YAAY,IAAI,KAAK;gBACnC,SAAS,EAAE,aAAa,CAAC,SAAS;gBAClC,QAAQ;aACT,CAAC;YACF,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,2EAA2E;gBAC3E,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,GAAG,aAAa,CAAC;YAC9C,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEF;;;;;;;;WAQG;QACM,mDAAoB,CAC3B,QAAgB,EAChB,MAAqC,EAC/B,EAAE;YACR,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,uBAAuB,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEO,sDAAuB,CAAC,IAAY,EAAQ,EAAE;YACrD,+EAA+E;YAC/E,MAAM,oBAAoB,GAAG,uBAAA,IAAI,uDAAyB,CAAC,IAAI,CAAC,CAAC;YACjE,IAAI,oBAAoB,EAAE,CAAC;gBACzB,IAAI,CAAC,yBAAyB,CAAC,oBAAoB,CAAC,CAAC;YACvD,CAAC;YAED,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YACjD,IAAI,CAAC,aAAa,EAAE,CAAC;gBACnB,OAAO;YACT,CAAC;YACD,IAAI,uBAAA,IAAI,qDAAuB,MAA3B,IAAI,EAAwB,aAAa,CAAC,EAAE,CAAC;gBAC/C,uBAAA,IAAI,uDAAyB,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC;oBACtD,cAAc,EAAE,IAAI;iBACrB,CAAC,CAAC;YACL,CAAC;QACH,CAAC,EAAC;QAEO,wDAAyB,CAChC,WAA8B,EACrB,EAAE;YACX,MAAM,QAAQ,GAAG,OAAO,CAAC,WAAW,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;YACrD,MAAM,UAAU,GAAG,YAAY,CAC7B,WAAW,CAAC,KAAK,CAAC,UAAU,EAC5B,WAAW,CAAC,KAAK,CAAC,WAAW,CAC9B,CAAC;YACF,MAAM,QAAQ,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAE7D,OAAO,CAAC,UAAU,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxD,CAAC,EAAC;QAEF;;;;;;;;;WASG;QACH,kCAA6B,GAAG,CAC9B,aAA0D,EACpD,EAAE;YACR,MAAM,EAAE,YAAY,EAAE,GAAG,aAAa,CAAC;YAEvC,IAAI,CAAC,YAAY,EAAE,EAAE,EAAE,CAAC;gBACtB,MAAM,IAAI,KAAK,CACb,+DAA+D,CAChE,CAAC;YACJ,CAAC;YAED,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EAAiB,aAAa,CAAC,CAAC;YACpC,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,YAAY,CAAC,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC;QAEF,yDAAyD;QACzD,kEAAkE;QAClE,iBAAY,GAAG,KAAK,EAClB,YAAsC,EACvB,EAAE;YACjB,MAAM,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,YAAY,CAAC,CAAC;QAChD,CAAC,CAAC;QAaF;;;;;;;;WAQG;QACM,qDAAsB,CAAC,cAAsB,EAAQ,EAAE;YAC9D,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;YAE1D,MAAM,WAAW,GAAG,QAAQ;gBAC1B,CAAC,CAAC;oBACE,OAAO,EAAE,QAAQ,CAAC,OAAO,GAAG,CAAC;oBAC7B,eAAe,EAAE,IAAI,CAAC,GAAG,EAAE;iBAC5B;gBACH,CAAC,CAAC;oBACE,OAAO,EAAE,CAAC;oBACV,eAAe,EAAE,IAAI,CAAC,GAAG,EAAE;iBAC5B,CAAC;YAEN,0DAA0D;YAC1D,MAAM,YAAY,GAAG,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAAC;YACnE,IAAI,WAAW,CAAC,OAAO,IAAI,YAAY,IAAI,YAAY,EAAE,CAAC;gBACxD,IAAI,CAAC,yBAAyB,CAAC,YAAY,CAAC,CAAC;gBAC7C,OAAO,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAAC;gBAErD,kCAAkC;gBAClC,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;gBACzD,IAAI,WAAW,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;oBAC1C,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACzC,wCAAwC,EACxC,WAAW,CAAC,OAAO,CACpB,CAAC;oBACF,MAAM,aAAa,GAAG,0BAA0B,CAAC,WAAW,CAAC,CAAC;oBAC9D,MAAM,eAAe,GAAG,6BAA6B,CACnD,WAAW,EACX,eAAe,CAChB,CAAC;oBACF,MAAM,EAAE,iBAAiB,EAAE,CAAC,EAAE,GAAG,uBAAuB,EAAE,GACxD,eAAe,CAAC;oBAElB,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,oBAAoB,EAC/C,cAAc,EACd;wBACE,GAAG,uBAAuB,CAAC,WAAW,CAAC;wBACvC,GAAG,uBAAuB,CAAC,WAAW,CAAC,KAAK,CAAC;wBAC7C,GAAG,uBAAuB;wBAC1B,eAAe,EAAE,aAAa,CAAC,eAAe;wBAC9C,oBAAoB,EAAE,aAAa,CAAC,oBAAoB;wBACxD,mBAAmB,EAAE,aAAa,CAAC,mBAAmB;wBACtD,wBAAwB,EAAE,aAAa,CAAC,wBAAwB;wBAChE,WAAW,EAAE,iBAAiB,CAAC,aAAa;wBAC5C,cAAc,EAAE,aAAa,CAAC,iBAAiB;wBAC/C,cAAc,EAAE,WAAW,CAAC,OAAO;qBACpC,CACF,CAAC;gBACJ,CAAC;YACH,CAAC;YAED,8BAA8B;YAC9B,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,QAAQ,GAAG,WAAW,CAAC;YACzD,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEO,sDAAuB,KAAK,EAAE,EACrC,cAAc,GACU,EAAiB,EAAE;YAC3C,4BAA4B;YAE5B,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YACjC,MAAM,WAAW,GAAG,SAAS,CAAC,cAAc,CAAC,CAAC;YAC9C,IAAI,CAAC,WAAW,EAAE,CAAC;gBACjB,OAAO;YACT,CAAC;YAED,iCAAiC;YAEjC,IAAI,iCAAiC,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAC5D,OAAO;YACT,CAAC;YAED,8BAA8B;YAE9B,IAAI,CAAC;gBACH,IAAI,MAAmC,CAAC;gBACxC,IAAI,kBAAkB,GAAa,EAAE,CAAC;gBACtC,IAAI,iBAAiB,GAAmC,IAAI,CAAC;gBAC7D,IAAI,iBAAqC,CAAC;gBAE1C,MAAM,QAAQ,GAAG,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEnD,IAAI,QAAQ,EAAE,CAAC;oBACb,MAAM,EAAE,UAAU,EAAE,GAAG,WAAW,CAAC,KAAK,CAAC;oBAEzC,MAAM,SAAS,GAAG,IAAI,aAAa,CACjC,uBAAA,IAAI,sCAAQ,CAAC,sBAAsB,EACnC,uBAAA,IAAI,uCAAS,CACd,CAAC;oBACF,MAAM,WAAW,GAAG,MAAM,SAAS,CAAC,cAAc,CAChD,cAAc,EACd,WAAW,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,IAAI,EAAE,EACxC,UAAU,CAAC,QAAQ,EAAE,EACrB,uBAAA,IAAI,wCAAU,CACf,CAAC;oBAEF,iBAAiB,GAAG,WAAW,CAAC,MAAM,CAAC;oBACvC,iBAAiB,GAAG,kCAAkC,CACpD,WAAW,EACX,UAAU,EACV,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CACnC,CAAC;oBACF,MAAM,GAAG,iBAAiB,CAAC,MAAM,CAAC;gBACpC,CAAC;qBAAM,CAAC;oBACN,0HAA0H;oBAC1H,2GAA2G;oBAC3G,oGAAoG;oBACpG,MAAM,SAAS,GAAG,uBAAA,IAAI,4CAAc,MAAlB,IAAI,EAAe,cAAc,CAAC,CAAC;oBACrD,IAAI,CAAC,SAAS,EAAE,CAAC;wBACf,OAAO;oBACT,CAAC;oBAED,uBAAA,IAAI,+CAAiB,MAArB,IAAI,EAAkB,cAAc,EAAE,SAAS,CAAC,CAAC;oBAEjD,MAAM,aAAa,GAAG,6BAA6B,CACjD,WAAW,CAAC,KAAK,EACjB,SAAS,CACV,CAAC;oBACF,MAAM,QAAQ,GAAG,MAAM,mBAAmB,CACxC,aAAa,EACb,uBAAA,IAAI,wCAAU,EACd,uBAAA,IAAI,uCAAS,EACb,uBAAA,IAAI,sCAAQ,CAAC,sBAAsB,CACpC,CAAC;oBACF,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;oBACzB,kBAAkB,GAAG,QAAQ,CAAC,kBAAkB,CAAC;gBACnD,CAAC;gBAED,IAAI,kBAAkB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;oBAClC,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,sBAAsB,EACjD,cAAc,EACd;wBACE,QAAQ,EAAE,kBAAkB;wBAC5B,aAAa,EAAE,WAAW,CAAC,QAAQ,EAAE,OAAO,IAAI,CAAC;qBAClD,CACF,CAAC;oBACF,MAAM,IAAI,KAAK,CACb,oCAAoC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CACpE,CAAC;gBACJ,CAAC;gBAED,gCAAgC;gBAEhC,MAAM,oBAAoB,GAAG;oBAC3B,GAAG,WAAW;oBACd,MAAM;oBACN,cAAc,EACZ,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,QAAQ;wBACtC,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,MAAM;wBAClC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;wBACZ,CAAC,CAAC,SAAS,EAAE,oEAAoE;oBACrF,QAAQ,EAAE,SAAS;iBACpB,CAAC;gBAEF,2GAA2G;gBAC3G,qFAAqF;gBACrF,yIAAyI;gBACzI,+EAA+E;gBAC/E,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;oBACpB,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,GAAG,oBAAoB,CAAC;gBACzD,CAAC,CAAC,CAAC;gBAEH,IAAI,QAAQ,IAAI,iBAAiB,IAAI,iBAAiB,EAAE,CAAC;oBACvD,uBAAA,IAAI,mDAAqB,CAAC,+BAA+B,CACvD,cAAc,EACd,WAAW,EACX,iBAAiB,EACjB,iBAAiB,CAClB,CAAC;gBACJ,CAAC;gBAED,mBAAmB;gBAEnB,MAAM,YAAY,GAAG,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAAC;gBAEnE,MAAM,aAAa,GACjB,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,QAAQ;oBACtC,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,MAAM,CAAC;gBAEvC,IAAI,aAAa,IAAI,YAAY,EAAE,CAAC;oBAClC,IAAI,CAAC,yBAAyB,CAAC,YAAY,CAAC,CAAC;oBAC7C,OAAO,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAAC;oBAErD,0DAA0D;oBAC1D,IAAI,WAAW,CAAC,SAAS,EAAE,CAAC;wBAC1B,OAAO;oBACT,CAAC;oBAED,IAAI,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,QAAQ,EAAE,CAAC;wBAC3C,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,SAAS,EACpC,cAAc,CACf,CAAC;wBACF,IAAI,CAAC,SAAS,CAAC,OAAO,CACpB,wDAAwD,EACxD,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,OAAO,CACpC,CAAC;oBACJ,CAAC;oBACD,IAAI,MAAM,CAAC,MAAM,KAAK,WAAW,CAAC,MAAM,EAAE,CAAC;wBACzC,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,MAAM,EACjC,cAAc,CACf,CAAC;oBACJ,CAAC;gBACH,CAAC;YACH,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,OAAO,CAAC,IAAI,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;gBACxD,uBAAA,IAAI,kDAAoB,MAAxB,IAAI,EAAqB,cAAc,CAAC,CAAC;YAC3C,CAAC;QACH,CAAC,EAAC;QAEO,+CAAgB,CAAC,cAAsB,EAAsB,EAAE;YACtE,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YACjC,oGAAoG;YACpG,oGAAoG;YACpG,MAAM,SAAS,GAAG,SAAS,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAEnE,IAAI,SAAS,EAAE,CAAC;gBACd,OAAO,SAAS,CAAC;YACnB,CAAC;YAED,iFAAiF;YACjF,MAAM,iBAAiB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAC3C,gCAAgC,CACjC,CAAC;YACF,MAAM,MAAM,GAAG,iBAAiB,CAAC,YAAY,CAAC,IAAI,CAChD,CAAC,EAAmB,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,cAAc,CAClD,CAAC;YACF,OAAO,MAAM,EAAE,IAAI,CAAC;QACtB,CAAC,EAAC;QAEO,kDAAmB,CAC1B,cAAsB,EACtB,SAAiB,EACX,EAAE;YACR,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YACjC,IAAI,SAAS,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;gBACrD,OAAO;YACT,CAAC;YAED,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,GAAG,SAAS,CAAC;YACrE,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEF,4DAA4D;QAC5D,wDAAwD;QAC/C,4DAA6B,CACpC,OAAe,EACf,eAAoB,EACd,EAAE;YACR,MAAM,uBAAuB,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,MAAM,CACtE,CAAC,QAAQ,EAAE,EAAE;gBACX,MAAM,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;gBAEzD,MAAM,gBAAgB,GAAG,WAAW,CAClC,iBAAiB,CAAC,KAAK,CAAC,UAAU,CACnC,CAAC;gBAEF,OAAO,CACL,iBAAiB,CAAC,OAAO,KAAK,OAAO;oBACrC,gBAAgB,KAAK,eAAe,CACrC,CAAC;YACJ,CAAC,CACF,CAAC;YAEF,uBAAuB,CAAC,OAAO,CAAC,CAAC,cAAc,EAAE,EAAE;gBACjD,MAAM,YAAY,GAAG,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAAC;gBAEnE,IAAI,YAAY,EAAE,CAAC;oBACjB,IAAI,CAAC,yBAAyB,CAC5B,uBAAA,IAAI,uDAAyB,CAAC,cAAc,CAAC,CAC9C,CAAC;gBACJ,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE;gBACpB,KAAK,CAAC,SAAS,GAAG,uBAAuB,CAAC,MAAM,CAC9C,CAAC,GAAG,EAAE,cAAc,EAAE,EAAE;oBACtB,OAAO,GAAG,CAAC,cAAc,CAAC,CAAC;oBAC3B,OAAO,GAAG,CAAC;gBACb,CAAC,EACD,KAAK,CAAC,SAAS,CAChB,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC,EAAC;QAEF;;;;WAIG;QAEH;;;;;;;;;;WAUG;QACM,iDAAkB,KAAK,EAC9B,KAAY,EACZ,aAA0D,EAC1D,eAAgF,EACtD,EAAE;YAC5B,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;gBACxC,MAAM,IAAI,KAAK,CACb,kEAAkE,CACnE,CAAC;YACJ,CAAC;YAED,MAAM,OAAO,GAAG,gBAAgB,CAC9B,KAAK,EACL,aAAa,CAAC,KAAK,CAAC,UAAU,EAC9B,eAAe,CAChB,CAAC;YACF,MAAM,eAAe,GAAG,CAAC,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAChD,8BAA8B,EAC9B,OAAO,CACR,CAIwB,CAAC;YAE1B,iDAAiD;YACjD,uEAAuE;YACvE,MAAM,eAAe,GAAyC;gBAC5D,GAAG,aAAa;gBAChB,KAAK;aACN,CAAC;YAEF,MAAM,MAAM,GAAG,sBAAsB,CACnC,eAAe,EACf,eAAe,EACf,eAAe,CAChB,CAAC;YAEF,iFAAiF;YACjF,uNAAuN;YACvN,OAAO,MAAM,CAAC;QAChB,CAAC,EAAC;QAEO,kEAAmC,KAAK,EAC/C,WAEW,EACe,EAAE;YAC5B,MAAM,eAAe,GAAG,MAAM,WAAW,CAAC;YAC1C,MAAM,oBAAoB,GAAgC,IAAI,CAAC,SAAS;iBACrE,IAAI,CAAC,gCAAgC,CAAC;iBACtC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAmB,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,eAAe,CAAC,CAAC;YAC3E,IAAI,CAAC,oBAAoB,EAAE,CAAC;gBAC1B,MAAM,IAAI,KAAK,CACb,uEAAuE,CACxE,CAAC;YACJ,CAAC;YACD,OAAO,oBAAoB,CAAC;QAC9B,CAAC,EAAC;QAEF,iGAAiG;QACxF,wDAAyB,KAAK,EACrC,IAAY,EACZ,EACE,SAAS,GAAG,CAAC,GAAG,KAAM,EAAE,oBAAoB;QAC5C,MAAM,GAAG,IAAK,MAC6B,EAAE,EACrB,EAAE;YAC5B,OAAO,MAAM,qBAAqB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE;gBACvD,SAAS;gBACT,MAAM;aACP,CAAC,CAAC;QACL,CAAC,EAAC;QAEO,mDAAoB,KAAK,EAChC,UAAmB,EACnB,UAAgD,EAChD,QAAiB,EACjB,aAAsB,EACtB,eAAyB,EACa,EAAE;YACxC,IAAI,QAAQ,EAAE,CAAC;gBACb,MAAM,SAAS,GAAG,KAAK,IAA8B,EAAE;oBACrD,MAAM,uBAAA,IAAI,wDAA0B,MAA9B,IAAI,EAA2B,aAAa,CAAC,CAAC;oBAEpD,MAAM,cAAc,GAAG,MAAM,uBAAA,IAAI,oDAAsB,MAA1B,IAAI,EAAuB;wBACtD,eAAe,EAAE,UAAU;4BACzB,CAAC,CAAC,eAAe,CAAC,cAAc;4BAChC,CAAC,CAAC,eAAe,CAAC,YAAY;wBAChC,KAAK,EAAE,QAAQ;wBACf,eAAe;qBAChB,CAAC,CAAC;oBAEH,MAAM,mBAAmB,CAAC,UAAU,CAAC,CAAC;oBACtC,OAAO,cAAc,CAAC;gBACxB,CAAC,CAAC;gBAEF,OAAO,MAAM,uBAAA,IAAI,qCAAO,MAAX,IAAI,EACf;oBACE,IAAI,EAAE,UAAU;wBACd,CAAC,CAAC,SAAS,CAAC,kCAAkC;wBAC9C,CAAC,CAAC,SAAS,CAAC,gCAAgC;oBAC9C,IAAI,EAAE;wBACJ,UAAU,EAAE,mBAAmB,CAAC,UAAU,CAAC;wBAC3C,UAAU,EAAE,KAAK;qBAClB;iBACF,EACD,SAAS,CACV,CAAC;YACJ,CAAC;YAED,OAAO,SAAS,CAAC;QACnB,CAAC,EAAC;QAEF;;;;;;;;;;;;WAYG;QACM,uDAAwB,KAAK,EAAE,EACtC,eAAe,EACf,KAAK,EACL,eAAe,GAAG,KAAK,EACvB,KAAK,EACL,QAAQ,EAAE,gBAAgB,GAO3B,EAA4B,EAAE;YAC7B,qEAAqE;YACrE,MAAM,QAAQ,GAAG,gBAAgB,IAAI,gBAAgB,EAAE,CAAC,QAAQ,EAAE,CAAC;YAEnE,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACzC,wCAAwC,EACxC,KAAK,CAAC,IAAI,CACX,CAAC;YACF,IAAI,CAAC,eAAe,EAAE,CAAC;gBACrB,MAAM,IAAI,KAAK,CACb,8EAA8E,CAC/E,CAAC;YACJ,CAAC;YACD,MAAM,UAAU,GAAG,kBAAkB,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YACrD,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACzC,gDAAgD,EAChD,UAAU,CACX,CAAC;YAEF,MAAM,cAAc,GAAG;gBACrB,QAAQ;gBACR,eAAe;gBACf,eAAe;gBACf,IAAI,EAAE,eAAe;gBACrB,MAAM,EAAE,UAAU;aACnB,CAAC;YACF,oEAAoE;YACpE,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,oBAAoB,EAAE,GAAG,KAAK,CAAC;YAEnE,MAAM,iBAAiB,GAEhB;gBACL,GAAG,oBAAoB;gBACvB,OAAO,EAAE,UAAU;gBACnB,uEAAuE;gBACvE,GAAG,CAAC,aAAa;oBACf,aAAa,KAAK,CAAC,IAAI;oBACrB,QAAQ,EAAE,aAAa,CAAC,QAAQ,EAAE;oBAClC,GAAG,EAAE,aAAa,CAAC,QAAQ,EAAE;iBAC9B,CAAC;aACL,CAAC;YACF,MAAM,2BAA2B,GAAsB;gBACrD,GAAG,iBAAiB;gBACpB,GAAG,CAAC,MAAM,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EACZ,iBAAiB,EACjB,eAAe,EACf,UAAU,EACV,KAAK,CACN,CAAC;aACH,CAAC;YAEF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EAC3B,2BAA2B,EAC3B,cAAc,CACf,CAAC;YAEF,OAAO,MAAM,uBAAA,IAAI,+DAAiC,MAArC,IAAI,EAAkC,MAAM,CAAC,CAAC;QAC7D,CAAC,EAAC;QAEO,2DAA4B,KAAK,EACxC,aAAsB,EACP,EAAE;YACjB,IAAI,aAAa,EAAE,CAAC;gBAClB,MAAM,uBAAA,IAAI,oDAAsB,MAA1B,IAAI,EAAuB;oBAC/B,eAAe,EAAE,eAAe,CAAC,cAAc;oBAC/C,KAAK,EAAE,aAAa;iBACrB,CAAC,CAAC;YACL,CAAC;QACH,CAAC,EAAC;QAEO,mDAAoB,KAAK,EAChC,iBAAoC,EACpC,eAAuB,EACvB,OAAY,EACZ,KAA8D,EAK7D,EAAE;YACH,MAAM,EAAE,GAAG,EAAE,GAAG,iBAAiB,CAAC;YAClC,oEAAoE;YACpE,uEAAuE;YACvE,IAAI,KAAK,EAAE,CAAC;gBACV,OAAO;oBACL,YAAY,EAAE,KAAK,CAAC,KAAK,CAAC,YAAY,IAAI,CAAC,CAAC;oBAC5C,oBAAoB,EAAE,KAAK,CAAC,KAAK,CAAC,oBAAoB,IAAI,CAAC,CAAC;oBAC5D,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS;iBAClC,CAAC;YACJ,CAAC;YAED,MAAM,EAAE,eAAe,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAC7C,2BAA2B,CAC5B,CAAC;YACF,MAAM,EAAE,SAAS,EAAE,iBAAiB,EAAE,GAAG,MAAM,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EAAmB;gBACpE,iBAAiB;gBACjB,OAAO;gBACP,eAAe;aAChB,CAAC,CAAC;YACH,MAAM,EAAE,YAAY,EAAE,oBAAoB,EAAE,GAAG,iBAAiB,CAAC;gBAC/D,sBAAsB,EAAE,eAAe;gBACvC,iBAAiB;aAClB,CAAC,CAAC;YAEH,OAAO;gBACL,YAAY;gBACZ,oBAAoB;gBACpB,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS;aAClC,CAAC;QACJ,CAAC,EAAC;QAEF;;;;;;;;;;;WAWG;QACM,4DAA6B,KAAK,EACzC,IAGC,EAIA,EAAE;YACH,MAAM,iBAAiB,GAAG,MAAM,4BAA4B,CAAC;gBAC3D,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,gBAAgB,EAAE,uBAAA,IAAI,gDAAkB;gBACxC,GAAG,IAAI;aACR,CAAC,CAAC;YACH,MAAM,YAAY,GAAG;gBACnB,CAAC,eAAe,CAAC,cAAc,CAAC,EAAE,iBAAiB,CAAC,YAAY,CAAC,IAAI,CACnE,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,KAAK,eAAe,CAAC,cAAc,CACtD,EAAE,MAAM,CAAC,IAAI;gBACd,CAAC,eAAe,CAAC,YAAY,CAAC,EAAE,iBAAiB,CAAC,YAAY,CAAC,IAAI,CACjE,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,KAAK,eAAe,CAAC,YAAY,CACpD,EAAE,MAAM,CAAC,IAAI;gBACd,CAAC,eAAe,CAAC,MAAM,CAAC,EAAE,iBAAiB,CAAC,YAAY,CAAC,IAAI,CAC3D,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,KAAK,eAAe,CAAC,MAAM,CAC9C,EAAE,MAAM,CAAC,IAAI;gBACd,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,iBAAiB,CAAC,YAAY,CAAC,IAAI,CACzD,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,IAAI,KAAK,eAAe,CAAC,IAAI,CAC5C,EAAE,MAAM,CAAC,IAAI;aACf,CAAC;YAEF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,uBAAA,IAAI,qDAAuB,MAA3B,IAAI,EAAwB,iBAAiB,CAAC,CAAC;YAEzE,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,GAAG,gCAAgC,CAAC;gBACnE,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,mBAAmB,EAAE,uBAAA,IAAI,mDAAqB;gBAC9C,OAAO;gBACP,YAAY;aACb,CAAC,CAAC;YAEH,IAAI,CAAC,SAAS,EAAE,CAAC;gBACf,MAAM,IAAI,KAAK,CACb,0EAA0E,CAC3E,CAAC;YACJ,CAAC;YAED,OAAO,EAAE,YAAY,EAAE,SAAS,EAAE,CAAC;QACrC,CAAC,EAAC;QAEF;;;;;;;;;WASG;QACH,aAAQ,GAAG,KAAK,EACd,cAAsB,EACtB,aAA0D,EAC1D,oBAA6B,EAC7B,qBAAiG,EACjG,WAAwC,2BAA2B,CAAC,QAAQ,EACjB,EAAE;YAC7D,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,uCAAuC,EACvC,WAAW,CAAC,oBAAoB;YAChC,4FAA4F;YAC5F,qJAAqJ;YACrJ,aAAa,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,qBAAqB,CAC5D,CAAC;YAEF,MAAM,eAAe,GAAG,uBAAA,IAAI,+FAA8B,MAAlC,IAAI,EAA+B,cAAc,CAAC,CAAC;YAC3E,IAAI,CAAC,eAAe,EAAE,CAAC;gBACrB,MAAM,IAAI,KAAK,CACb,6EAA6E,CAC9E,CAAC;YACJ,CAAC;YACD,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,eAAe,CAAC,CAAC;YAE5D,MAAM,yBAAyB,GAAG,qCAAqC,CACrE,aAAa,EACb,oBAAoB,EACpB,iBAAiB,EACjB,QAAQ,CACT,CAAC;YACF,sDAAsD;YACtD,CAAC,aAAa,CAAC,SAAS;gBACtB,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,SAAS,EACpC,SAAS,EACT,yBAAyB,CAC1B,CAAC;YAEJ,IAAI,MAAwD,CAAC;YAC7D,IAAI,YAAgC,CAAC;YACrC,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE7B,MAAM,UAAU,GAAG,YAAY,CAC7B,aAAa,CAAC,KAAK,CAAC,UAAU,EAC9B,aAAa,CAAC,KAAK,CAAC,WAAW,CAChC,CAAC;YACF,MAAM,QAAQ,GAAG,aAAa,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAE/D,wCAAwC;YACxC,IAAI,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE,CAAC;gBACpD,kEAAkE;gBAClE,IAAI,aAAa,CAAC,QAAQ,IAAI,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAE,CAAC;oBAClE,MAAM,cAAc,GAAG,MAAM,uBAAA,IAAI,qCAAO,MAAX,IAAI,EAC/B;wBACE,IAAI,EAAE,UAAU;4BACd,CAAC,CAAC,SAAS,CAAC,kCAAkC;4BAC9C,CAAC,CAAC,SAAS,CAAC,gCAAgC;wBAC9C,IAAI,EAAE;4BACJ,UAAU,EAAE,mBAAmB,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC;4BAC/D,UAAU,EAAE,KAAK;yBAClB;qBACF,EACD,KAAK,IAAI,EAAE;wBACT,IAAI,CAAC;4BACH,OAAO,aAAa,CAAC,QAAQ;gCAC3B,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC;gCACnC,CAAC,CAAC,MAAM,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EACR,aAAa,CAAC,QAAQ,EACtB,aAAa,EACb,eAAe,CAChB;gCACH,CAAC,CAAC,SAAS,CAAC;wBAChB,CAAC;wBAAC,OAAO,KAAK,EAAE,CAAC;4BACf,CAAC,aAAa,CAAC,SAAS;gCACtB,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,MAAM,EACjC,SAAS,EACT;oCACE,aAAa,EAAG,KAAe,EAAE,OAAO;oCACxC,GAAG,yBAAyB;iCAC7B,CACF,CAAC;4BACJ,MAAM,KAAK,CAAC;wBACd,CAAC;oBACH,CAAC,CACF,CAAC;oBAEF,YAAY,GAAG,cAAc,EAAE,EAAE,CAAC;oBAElC,+CAA+C;oBAC/C,MAAM,mBAAmB,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;gBAC5D,CAAC;gBAED,MAAM,GAAG,MAAM,uBAAA,IAAI,qCAAO,MAAX,IAAI,EACjB;oBACE,IAAI,EAAE,UAAU;wBACd,CAAC,CAAC,SAAS,CAAC,0BAA0B;wBACtC,CAAC,CAAC,SAAS,CAAC,wBAAwB;oBACtC,IAAI,EAAE;wBACJ,UAAU,EAAE,mBAAmB,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC;wBAC/D,UAAU,EAAE,KAAK;qBAClB;iBACF,EACD,KAAK,IAAI,EAAE;oBACT,IAAI,CAAC;wBACH,IACE,CAAC,CACC,WAAW,CAAC,aAAa,CAAC,KAAK,CAAC;4BAChC,cAAc,CAAC,aAAa,CAAC,KAAK,CAAC;4BACnC,OAAO,aAAa,CAAC,KAAK,KAAK,QAAQ,CACxC,EACD,CAAC;4BACD,MAAM,IAAI,KAAK,CACb,mFAAmF,CACpF,CAAC;wBACJ,CAAC;wBACD,OAAO,MAAM,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EACf,aAAa,CAAC,KAAK,EACnB,aAAa,EACb,eAAe,CAChB,CAAC;oBACJ,CAAC;oBAAC,OAAO,KAAK,EAAE,CAAC;wBACf,CAAC,aAAa,CAAC,SAAS;4BACtB,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,MAAM,EACjC,MAAM,EAAE,EAAE,EACV;gCACE,aAAa,EAAG,KAAe,EAAE,OAAO;gCACxC,GAAG,yBAAyB;6BAC7B,CACF,CAAC;wBACJ,MAAM,KAAK,CAAC;oBACd,CAAC;gBACH,CAAC,CACF,CAAC;YACJ,CAAC;iBAAM,CAAC;gBACN,gBAAgB;gBAChB,qHAAqH;gBACrH,qCAAqC;gBACrC,MAAM,eAAe,GACnB,uBAAA,IAAI,wCAAU,KAAK,cAAc,CAAC,MAAM,IAAI,iBAAiB,CAAC;gBAEhE,uCAAuC;gBACvC,MAAM,GAAG,MAAM,uBAAA,IAAI,qCAAO,MAAX,IAAI,EACjB;oBACE,IAAI,EAAE,UAAU;wBACd,CAAC,CAAC,SAAS,CAAC,0BAA0B;wBACtC,CAAC,CAAC,SAAS,CAAC,wBAAwB;oBACtC,IAAI,EAAE;wBACJ,UAAU,EAAE,mBAAmB,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC;wBAC/D,UAAU,EAAE,oBAAoB;qBACjC;iBACF,EACD,KAAK,IAAI,EAAE;oBACT,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,KAAK,CAAC,EAAE,CAAC;wBACtC,MAAM,IAAI,KAAK,CACb,gFAAgF,CACjF,CAAC;oBACJ,CAAC;oBACD,IAAI,oBAAoB,IAAI,aAAa,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC;wBAChE,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,GAC/B,MAAM,uBAAA,IAAI,yDAA2B,MAA/B,IAAI,EAA4B;4BACpC,UAAU;4BACV,aAAa,EAAE,aAAa,CAAC,aAAa;4BAC1C,QAAQ,EACN,aAAa,CAAC,QAAQ,IAAI,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC;gCAC3D,CAAC,CAAC,aAAa,CAAC,QAAQ;gCACxB,CAAC,CAAC,SAAS;4BACf,KAAK,EAAE,aAAa,CAAC,KAAK;4BAC1B,aAAa;4BACb,eAAe;yBAChB,CAAC,CAAC;wBAEL,YAAY,GAAG,YAAY,EAAE,EAAE,CAAC;wBAChC,OAAO,SAAS,CAAC;oBACnB,CAAC;oBACD,uDAAuD;oBACvD,MAAM,cAAc,GAAG,MAAM,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EAC/B,UAAU,EACV,aAAa,CAAC,KAAK,CAAC,UAAU,EAC9B,aAAa,CAAC,QAAQ,IAAI,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC;wBAC3D,CAAC,CAAC,aAAa,CAAC,QAAQ;wBACxB,CAAC,CAAC,SAAS,EACb,aAAa,CAAC,aAAa,EAC3B,eAAe,CAChB,CAAC;oBAEF,YAAY,GAAG,cAAc,EAAE,EAAE,CAAC;oBAElC,MAAM,+BAA+B,CAAC,eAAe,CAAC,CAAC;oBAEvD,oEAAoE;oBACpE,MAAM,QAAQ,GAAG,gBAAgB,EAAE,CAAC,QAAQ,EAAE,CAAC;oBAE/C,+CAA+C;oBAC/C,mFAAmF;oBACnF,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EACF;wBACE,cAAc,EAAE,eAAe,CAAC,OAAO;wBACvC,aAAa,EAAE;4BACb,GAAG,sBAAsB,CAAC,aAAa,CAAC;4BACxC,SAAS,EAAE,EAAE,EAAE,oBAAoB;yBACpC;wBACD,aAAa;wBACb,kBAAkB,EAAE,CAAC;wBACrB,YAAY,EAAE,oBAAoB;wBAClC,SAAS;wBACT,YAAY;wBACZ,QAAQ;qBACT,EACD,QAAQ,CACT,CAAC;oBAEF,kEAAkE;oBAClE,yEAAyE;oBACzE,MAAM,WAAW,GAAG,MAAM,uBAAA,IAAI,oDAAsB,MAA1B,IAAI,EAAuB;wBACnD,eAAe,EAAE,UAAU;4BACzB,CAAC,CAAC,eAAe,CAAC,MAAM;4BACxB,CAAC,CAAC,eAAe,CAAC,IAAI;wBACxB,KAAK,EAAE,aAAa,CAAC,KAAK;wBAC1B,eAAe;wBACf,KAAK,EAAE,aAAa,CAAC,KAAK,CAAC,WAAW;4BACpC,CAAC,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK;4BACnC,CAAC,CAAC,SAAS;wBACb,QAAQ;qBACT,CAAC,CAAC;oBAEH,oEAAoE;oBACpE,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EAAmB,QAAQ,EAAE,WAAW,CAAC,CAAC;oBAE9C,OAAO,WAAW,CAAC;gBACrB,CAAC,CACF,CAAC;YACJ,CAAC;YAED,IAAI,CAAC;gBACH,0EAA0E;gBAC1E,+DAA+D;gBAC/D,MAAM,aAAa,GACjB,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC;oBAChD,CAAC,oBAAoB;oBACrB,CAAC,aAAa,CAAC,KAAK,CAAC,eAAe,CAAC;gBAEvC,IAAI,CAAC,aAAa,EAAE,CAAC;oBACnB,mCAAmC;oBACnC,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EAAiB;wBACnB,cAAc,EAAE,eAAe,CAAC,OAAO;wBACvC,YAAY,EAAE,MAAM,EAAE,0DAA0D;wBAChF,aAAa,EAAE;4BACb,GAAG,sBAAsB,CAAC,aAAa,CAAC;4BACxC,SAAS,EAAE,MAAM,CAAC,IAAI;yBACvB;wBACD,aAAa;wBACb,kBAAkB,EAAE,CAAC,EAAE,oGAAoG;wBAC3H,YAAY,EAAE,oBAAoB;wBAClC,SAAS;wBACT,YAAY;wBACZ,QAAQ;qBACT,CAAC,CAAC;gBACL,CAAC;gBAED,IAAI,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE,CAAC;oBACpD,qCAAqC;oBACrC,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,MAAM,CAAC,EAAE,CAAC,CAAC;oBACrC,qCAAqC;oBACrC,IAAI,CAAC,CAAC,UAAU,IAAI,QAAQ,CAAC,EAAE,CAAC;wBAC9B,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,SAAS,EACpC,MAAM,CAAC,EAAE,CACV,CAAC;oBACJ,CAAC;gBACH,CAAC;YACH,CAAC;YAAC,MAAM,CAAC;gBACP,8FAA8F;YAChG,CAAC;YACD,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC;QAEF;;;;;;;;;;WAUG;QACH,iBAAY,GAAG,KAAK,EAAE,MAKrB,EAAwE,EAAE;YACzE,MAAM,EAAE,aAAa,EAAE,SAAS,EAAE,cAAc,EAAE,QAAQ,EAAE,GAAG,MAAM,CAAC;YAEtE,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,uCAAuC,EACvC,WAAW,CAAC,oBAAoB,CACjC,CAAC;YAEF,4EAA4E;YAC5E,MAAM,OAAO,GAAG,uBAAA,IAAI,+FAA8B,MAAlC,IAAI,EAA+B,cAAc,CAAC,CAAC;YACnE,MAAM,iBAAiB,GAAG,OAAO,CAAC,OAAO,CAAC,IAAI,gBAAgB,CAAC,OAAO,CAAC,CAAC;YACxE,MAAM,yBAAyB,GAAG,qCAAqC,CACrE,aAAa,EACb,KAAK,EACL,iBAAiB,EACjB,QAAQ,CACT,CAAC;YAEF,IAAI,CAAC;gBACH,MAAM,MAAM,GAAG,kBAAkB,CAC/B,aAA+D,CAChE,CAAC;gBAEF,wFAAwF;gBACxF,iDAAiD;gBACjD,IAAI,YAAgC,CAAC;gBACrC,IAAI,aAAa,CAAC,QAAQ,EAAE,CAAC;oBAC3B,MAAM,UAAU,GAAG,YAAY,CAC7B,aAAa,CAAC,KAAK,CAAC,UAAU,EAC9B,aAAa,CAAC,KAAK,CAAC,WAAW,CAChC,CAAC;oBAEF,yDAAyD;oBACzD,MAAM,cAAc,GAAG,MAAM,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EAC/B,UAAU,EACV,aAAa,CAAC,KAAK,CAAC,UAAU,EAC9B,aAAa,CAAC,QAAQ,IAAI,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC;wBAC3D,CAAC,CAAC,aAAa,CAAC,QAAQ;wBACxB,CAAC,CAAC,SAAS,EACb,aAAa,CAAC,aAAa;oBAC3B,qBAAqB,CAAC,KAAK,CAC5B,CAAC;oBACF,YAAY,GAAG,cAAc,EAAE,EAAE,CAAC;oBAElC,IAAI,YAAY,EAAE,CAAC;wBACjB,MAAM,uBAAA,IAAI,qDAAuB,MAA3B,IAAI,EAAwB,YAAY,CAAC,CAAC;oBAClD,CAAC;gBACH,CAAC;gBAED,MAAM,EAAE,UAAU,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,aAAa,CAAC,KAAK,CAAC;gBAE/D,MAAM,gBAAgB,GAAG;oBACvB,UAAU,EAAE,OAAO,CAAC,QAAQ,EAAE;oBAC9B,OAAO,EAAE,SAAS;oBAClB,SAAS;oBACT,KAAK,EAAE,MAAM,CAAC,KAAK;oBACnB,WAAW,EAAE,cAAc;oBAC3B,YAAY,EAAE,MAAM,CAAC,QAAQ;iBAC9B,CAAC;gBACF,MAAM,SAAS,GAAG,IAAI,aAAa,CACjC,uBAAA,IAAI,sCAAQ,CAAC,sBAAsB,EACnC,uBAAA,IAAI,uCAAS,CACd,CAAC;gBACF,MAAM,WAAW,GAAG,MAAM,SAAS,CAAC,YAAY,CAC9C,gBAAgB,EAChB,uBAAA,IAAI,wCAAU,CACf,CAAC;gBAEF,MAAM,QAAQ,GAAG,WAAW,CAAC,EAAE,CAAC;gBAEhC,0EAA0E;gBAC1E,MAAM,cAAc,GAAG,YAAY,CACjC,aAAa,CAAC,KAAK,CAAC,UAAU,EAC9B,aAAa,CAAC,KAAK,CAAC,WAAW,CAChC,CAAC;gBACF,MAAM,eAAe,GAAG,cAAc;oBACpC,CAAC,CAAC,eAAe,CAAC,MAAM;oBACxB,CAAC,CAAC,eAAe,CAAC,IAAI,CAAC;gBAEzB,4DAA4D;gBAC5D,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACzC,gDAAgD,EAChD,kBAAkB,CAAC,OAAO,CAAC,CAC5B,CAAC;gBAEF,8DAA8D;gBAC9D,4CAA4C;gBAC5C,MAAM,uBAAuB,GAAG;oBAC9B,OAAO,EAAE,kBAAkB,CAAC,OAAO,CAAC;oBACpC,IAAI,EAAE,cAAc;oBACpB,EAAE,EACA,MAAM,CAAC,kBAAkB;wBACzB,4CAA4C,EAAE,8BAA8B;oBAC9E,IAAI,EAAE,KAAK,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,+DAA+D;oBAChG,KAAK,EAAE,KAAK;oBACZ,GAAG,EAAE,QAAQ,EAAE,mCAAmC;oBAClD,QAAQ,EAAE,YAAY,EAAE,qEAAqE;iBAC9F,CAAC;gBAEF,MAAM,EAAE,eAAe,EAAE,aAAa,EAAE,GAAG,MAAM,uBAAA,IAAI,gDAAkB,MAAtB,IAAI,EACnD,uBAAuB,EACvB;oBACE,MAAM,EAAE,UAAU;oBAClB,QAAQ,EAAE,gBAAgB,EAAE;oBAC5B,eAAe,EAAE,KAAK;oBACtB,WAAW,EAAE,IAAI;oBACjB,eAAe;oBACf,IAAI,EAAE,eAAe;iBACtB,CACF,CAAC;gBAEF,MAAM,YAAY,GAAG,aAAa,CAAC;gBAEnC,0DAA0D;gBAC1D,MAAM,wBAAwB,GAAG,uCAAuC,CACtE,WAAW,CAAC,MAAM,CACnB,CAAC;gBAEF,sEAAsE;gBACtE,MAAM,mBAAmB,GAAG;oBAC1B,GAAG,YAAY;oBACf,MAAM,EAAE,wBAAwB;iBACjC,CAAC;gBAEF,0CAA0C;gBAC1C,MAAM,aAAa,GAAG;oBACpB,GAAG,mBAAmB;oBACtB,UAAU,EAAE,IAAI;oBAChB,QAAQ;oBACR,UAAU,EAAE,cAAc,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM;iBACjB,CAAC;gBAEhC,4DAA4D;gBAC5D,IAAI,CAAC;oBACH,yDAAyD;oBACzD,MAAM,gBAAgB,GAAG,QAAQ,CAAC;oBAElC,uEAAuE;oBACvE,MAAM,sBAAsB,GAAG;wBAC7B,GAAG,aAAa;wBAChB,EAAE,EAAE,gBAAgB;wBACpB,qBAAqB,EAAE,aAAa,CAAC,EAAE,EAAE,uDAAuD;qBAC9E,CAAC;oBAErB,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;oBAE7B,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EAAiB;wBACnB,cAAc;wBACd,YAAY,EAAE,sBAAsB;wBACpC,aAAa,EAAE;4BACb,GAAG,sBAAsB,CAAC,aAAa,CAAC;4BACxC,SAAS,EAAE,aAAa,CAAC,IAAI,IAAI,EAAE;yBACpC;wBACD,aAAa;wBACb,kBAAkB,EAAE,CAAC;wBACrB,YAAY,EAAE,KAAK;wBACnB,YAAY;wBACZ,SAAS;wBACT,QAAQ;qBACT,CAAC,CAAC;oBAEH,iEAAiE;oBACjE,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,gBAAgB,CAAC,CAAC;gBAC9C,CAAC;gBAAC,OAAO,KAAK,EAAE,CAAC;oBACf,OAAO,CAAC,KAAK,CACX,mDAAmD,EACnD,KAAK,CACN,CAAC;oBACF,8BAA8B;gBAChC,CAAC;gBACD,OAAO,aAAa,CAAC;YACvB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,MAAM,EACjC,SAAS,EACT;oBACE,aAAa,EAAG,KAAe,EAAE,OAAO;oBACxC,GAAG,yBAAyB;iBAC7B,CACF,CAAC;gBAEF,MAAM,KAAK,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF;;;;;;WAMG;QACM,8DAA+B,CAQtC,SAAoB,EACpB,QAAiB,EACjB,eAGY,EACN,EAAE;YACR,MAAM,cAAc,GAAG;gBACrB,WAAW,EAAE,iBAAiB,CAAC,aAAa;gBAC5C,QAAQ,EACN,eAAe,EAAE,QAAQ;oBACzB,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC;oBACnE,2BAA2B,CAAC,QAAQ;gBACtC,GAAG,CAAC,eAAe,IAAI,EAAE,CAAC;aAC3B,CAAC;YAEF,iEAAiE;YACjE,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACd,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,8CAA8C,EAC9C,SAAS,EACT,cAAc,CACf,CAAC;gBACF,OAAO;YACT,CAAC;YAED,MAAM,WAAW,GACf,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;YAEjC,IAAI,CAAC,WAAW,EAAE,CAAC;gBACjB,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,8CAA8C,EAC9C,SAAS,EACT,cAAc,CACf,CAAC;gBACF,OAAO;YACT,CAAC;YAED,MAAM,sBAAsB,GAAG,0BAA0B,CAAC,WAAW,CAAC,CAAC;YACvE,uEAAuE;YACvE,IAAI,SAAS,KAAK,0BAA0B,CAAC,sBAAsB,EAAE,CAAC;gBACpE,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,8CAA8C,EAC9C,SAAS,EACT;oBACE,GAAG,cAAc;oBACjB,eAAe,EAAE,sBAAsB,CAAC,eAAe;oBACvD,oBAAoB,EAAE,sBAAsB,CAAC,oBAAoB;oBACjE,oBAAoB,EAAE,sBAAsB,CAAC,oBAAoB;oBACjE,yBAAyB,EACvB,sBAAsB,CAAC,yBAAyB;oBAClD,aAAa,EAAE,WAAW,CAAC,QAAQ,EAAE,OAAO,IAAI,CAAC;iBAClD,CACF,CAAC;gBACF,OAAO;YACT,CAAC;YAED,oEAAoE;YACpE,IAAI,WAAW,CAAC,SAAS,EAAE,CAAC;gBAC1B,OAAO;YACT,CAAC;YAED,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CACzC,wCAAwC,EACxC,WAAW,CAAC,OAAO,CACpB,CAAC;YAEF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAC1C,gCAAgC,CACjC,CAAC;YACF,MAAM,MAAM,GAAG,YAAY,EAAE,IAAI,CAC/B,CAAC,EAAmB,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,QAAQ,CAC5C,CAAC;YACF,MAAM,cAAc,GAAG,YAAY,EAAE,IAAI,CACvC,CAAC,EAAmB,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,WAAW,CAAC,YAAY,CAC5D,CAAC;YAEF,MAAM,uBAAuB,GAAG;gBAC9B,GAAG,cAAc;gBACjB,GAAG,sBAAsB;gBACzB,GAAG,6BAA6B,CAAC,WAAW,EAAE,eAAe,CAAC;gBAC9D,GAAG,uBAAuB,CAAC,WAAW,CAAC;gBACvC,GAAG,wBAAwB,CAAC,WAAW,CAAC;gBACxC,GAAG,wBAAwB,CAAC,WAAW,EAAE,MAAM,EAAE,cAAc,CAAC;gBAChE,GAAG,uBAAuB,CAAC,WAAW,CAAC,KAAK,CAAC;aAC9C,CAAC;YAEF,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,8CAA8C,EAC9C,SAAS,EACT,uBAAuB,CACxB,CAAC;QACJ,CAAC,EAAC;QAjrDA,uBAAA,IAAI,oCAAa,QAAQ,MAAA,CAAC;QAC1B,uBAAA,IAAI,mCAAY,OAAO,MAAA,CAAC;QACxB,uBAAA,IAAI,4CAAqB,gBAAgB,MAAA,CAAC;QAC1C,uBAAA,IAAI,iDAA0B,qBAAqB,MAAA,CAAC;QACpD,uBAAA,IAAI,+CAAwB,mBAAmB,MAAA,CAAC;QAChD,uBAAA,IAAI,4CAAqB,gBAAgB,MAAA,CAAC;QAC1C,uBAAA,IAAI,kCAAW;YACb,sBAAsB,EACpB,MAAM,EAAE,sBAAsB,IAAI,wBAAwB;SAC7D,MAAA,CAAC;QACF,uBAAA,IAAI,iCAAU,OAAO,IAAK,CAAC,CAAC,QAAQ,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAmB,MAAA,CAAC;QACvE,uBAAA,IAAI,+CAAwB,IAAI,mBAAmB,CAAC;YAClD,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,mBAAmB,EAAE,uBAAA,IAAI,mDAAqB;SAC/C,CAAC,MAAA,CAAC;QAEH,2BAA2B;QAC3B,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,gCAAgC,EAChE,IAAI,CAAC,6BAA6B,CAAC,IAAI,CAAC,IAAI,CAAC,CAC9C,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,mBAAmB,EACnD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CACjC,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,aAAa,EAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAC3B,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,WAAW,EAC3C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CACzB,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,eAAe,EAC/C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAC7B,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,kCAAkC,EAClE,IAAI,CAAC,+BAA+B,CAAC,IAAI,CAAC,IAAI,CAAC,CAChD,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAClC,GAAG,6BAA6B,iCAAiC,EACjE,IAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,IAAI,CAAC,CAC/C,CAAC;QAEF,eAAe;QACf,IAAI,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,CAAC;QAE5C,IAAI,CAAC,SAAS,CAAC,SAAS,CACtB,yCAAyC,EACzC,CAAC,EAAE,eAAe,EAAE,EAAE,EAAE;YACtB,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,eAAe,CAAC;YAEjE,IACE,IAAI;gBACJ;oBACE,eAAe,CAAC,MAAM;oBACtB,eAAe,CAAC,IAAI;oBACpB,eAAe,CAAC,cAAc;oBAC9B,eAAe,CAAC,YAAY;iBAC7B,CAAC,QAAQ,CAAC,IAAI,CAAC;gBAChB;oBACE,iBAAiB,CAAC,MAAM;oBACxB,iBAAiB,CAAC,OAAO;oBACzB,iBAAiB,CAAC,QAAQ;iBAC3B,CAAC,QAAQ,CAAC,MAAM,CAAC,EAClB,CAAC;gBACD,iCAAiC;gBACjC,uBAAA,IAAI,8CAAgB,MAApB,IAAI,EAAiB,eAAe,CAAC,CAAC;gBACtC,qBAAqB;gBACrB,IAAI,MAAM,KAAK,iBAAiB,CAAC,QAAQ,EAAE,CAAC;oBAC1C,oFAAoF;oBACpF,IAAI,UAA8B,CAAC;oBACnC,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC;wBACnC,UAAU,GAAG,QAAQ,CAAC;oBACxB,CAAC;yBAAM,IAAI,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC;wBACtD,UAAU,GAAG,QAAQ,CAAC;oBACxB,CAAC;oBAED,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,MAAM,EACjC,UAAU,IAAI,QAAQ,EACtB,qCAAqC,CAAC,eAAe,CAAC,CACvD,CAAC;gBACJ,CAAC;YACH,CAAC;QACH,CAAC,CACF,CAAC;QAEF,IAAI,CAAC,SAAS,CAAC,SAAS,CACtB,4CAA4C,EAC5C,CAAC,eAAe,EAAE,EAAE;YAClB,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,eAAe,CAAC;YACxD,IAAI,IAAI,KAAK,eAAe,CAAC,IAAI,EAAE,CAAC;gBAClC,uBAAA,IAAI,2DAA6B,MAAjC,IAAI,EACF,0BAA0B,CAAC,SAAS,EACpC,QAAQ,CACT,CAAC;YACJ,CAAC;YACD,IAAI,IAAI,KAAK,eAAe,CAAC,MAAM,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,EAAE,CAAC;gBACjE,uBAAA,IAAI,mDAAqB,MAAzB,IAAI,EAAsB,QAAQ,CAAC,CAAC;YACtC,CAAC;QACH,CAAC,CACF,CAAC;QAEF,+EAA+E;QAC/E,8CAA8C;QAC9C,mFAAmF;QACnF,uBAAA,IAAI,uEAAyC,MAA7C,IAAI,CAA2C,CAAC;IAClD,CAAC;CAokDF;s7DAjtCG,cAAsB;IAItB,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CACxB,wCAAwC,EACxC,cAAc,CACf,CAAC;AACJ,CAAC","sourcesContent":["import type { AccountsControllerState } from '@metamask/accounts-controller';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type {\n  QuoteMetadata,\n  RequiredEventContextFromClient,\n  TxData,\n  QuoteResponse,\n  Intent,\n  Trade,\n} from '@metamask/bridge-controller';\nimport {\n  formatChainIdToHex,\n  isNonEvmChainId,\n  StatusTypes,\n  UnifiedSwapBridgeEventName,\n  formatChainIdToCaip,\n  isCrossChain,\n  isTronChainId,\n  isEvmTxData,\n  isHardwareWallet,\n  MetricsActionType,\n  MetaMetricsSwapsEventSource,\n  isBitcoinTrade,\n  isTronTrade,\n  AbortReason,\n  PollingStatus,\n} from '@metamask/bridge-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport { toHex } from '@metamask/controller-utils';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type {\n  TransactionController,\n  TransactionMeta,\n  TransactionParams,\n} from '@metamask/transaction-controller';\nimport { numberToHex } from '@metamask/utils';\nimport type { Hex } from '@metamask/utils';\n\nimport { IntentStatusManager } from './bridge-status-controller.intent';\nimport {\n  BRIDGE_PROD_API_BASE_URL,\n  BRIDGE_STATUS_CONTROLLER_NAME,\n  DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n  MAX_ATTEMPTS,\n  REFRESH_INTERVAL_MS,\n  TraceName,\n} from './constants';\nimport type {\n  BridgeStatusControllerState,\n  StartPollingForBridgeTxStatusArgsSerialized,\n  FetchFunction,\n  SolanaTransactionMeta,\n  BridgeHistoryItem,\n} from './types';\nimport type { BridgeStatusControllerMessenger } from './types';\nimport { BridgeClientId } from './types';\nimport {\n  fetchBridgeTxStatus,\n  getStatusRequestWithSrcTxHash,\n  shouldSkipFetchDueToFetchFailures,\n} from './utils/bridge-status';\nimport { getTxGasEstimates } from './utils/gas';\nimport {\n  IntentApiImpl,\n  IntentStatusTranslation,\n  mapIntentOrderStatusToTransactionStatus,\n  translateIntentOrderToBridgeStatus,\n} from './utils/intent-api';\nimport {\n  getFinalizedTxProperties,\n  getPriceImpactFromQuote,\n  getRequestMetadataFromHistory,\n  getRequestParamFromHistory,\n  getTradeDataFromHistory,\n  getEVMTxPropertiesFromTransactionMeta,\n  getTxStatusesFromHistory,\n  getPreConfirmationPropertiesFromQuote,\n} from './utils/metrics';\nimport {\n  findAndUpdateTransactionsInBatch,\n  getAddTransactionBatchParams,\n  getClientRequest,\n  getHistoryKey,\n  getIntentFromQuote,\n  getStatusRequestParams,\n  handleApprovalDelay,\n  handleMobileHardwareWalletDelay,\n  handleNonEvmTxResponse,\n  generateActionId,\n  waitForTxConfirmation,\n  rekeyHistoryItemInState,\n} from './utils/transaction';\n\nconst metadata: StateMetadata<BridgeStatusControllerState> = {\n  // We want to persist the bridge status state so that we can show the proper data for the Activity list\n  // basically match the behavior of TransactionController\n  txHistory: {\n    includeInStateLogs: true,\n    persist: true,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/** The input to start polling for the {@link BridgeStatusController} */\ntype BridgeStatusPollingInput = FetchBridgeTxStatusArgs;\n\ntype SrcTxMetaId = string;\nexport type FetchBridgeTxStatusArgs = {\n  bridgeTxMetaId: string;\n};\nexport class BridgeStatusController extends StaticIntervalPollingController<BridgeStatusPollingInput>()<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState,\n  BridgeStatusControllerMessenger\n> {\n  #pollingTokensByTxMetaId: Record<SrcTxMetaId, string> = {};\n\n  readonly #intentStatusManager: IntentStatusManager;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #config: {\n    customBridgeApiBaseUrl: string;\n  };\n\n  readonly #addTransactionFn: typeof TransactionController.prototype.addTransaction;\n\n  readonly #addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n\n  readonly #updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n\n  readonly #estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n\n  readonly #trace: TraceCallback;\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    fetchFn,\n    addTransactionFn,\n    addTransactionBatchFn,\n    updateTransactionFn,\n    estimateGasFeeFn,\n    config,\n    traceFn,\n  }: {\n    messenger: BridgeStatusControllerMessenger;\n    state?: Partial<BridgeStatusControllerState>;\n    clientId: BridgeClientId;\n    fetchFn: FetchFunction;\n    addTransactionFn: typeof TransactionController.prototype.addTransaction;\n    addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n    updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n    estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_STATUS_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      // Restore the persisted state\n      state: {\n        ...DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n        ...state,\n      },\n    });\n\n    this.#clientId = clientId;\n    this.#fetchFn = fetchFn;\n    this.#addTransactionFn = addTransactionFn;\n    this.#addTransactionBatchFn = addTransactionBatchFn;\n    this.#updateTransactionFn = updateTransactionFn;\n    this.#estimateGasFeeFn = estimateGasFeeFn;\n    this.#config = {\n      customBridgeApiBaseUrl:\n        config?.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n    };\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n    this.#intentStatusManager = new IntentStatusManager({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n    });\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:startPollingForBridgeTxStatus`,\n      this.startPollingForBridgeTxStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:wipeBridgeStatus`,\n      this.wipeBridgeStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitTx`,\n      this.submitTx.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitIntent`,\n      this.submitIntent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:restartPollingForFailedAttempts`,\n      this.restartPollingForFailedAttempts.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:getBridgeHistoryItemByTxMetaId`,\n      this.getBridgeHistoryItemByTxMetaId.bind(this),\n    );\n\n    // Set interval\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.messenger.subscribe(\n      'TransactionController:transactionFailed',\n      ({ transactionMeta }) => {\n        const { type, status, id: txMetaId, actionId } = transactionMeta;\n\n        if (\n          type &&\n          [\n            TransactionType.bridge,\n            TransactionType.swap,\n            TransactionType.bridgeApproval,\n            TransactionType.swapApproval,\n          ].includes(type) &&\n          [\n            TransactionStatus.failed,\n            TransactionStatus.dropped,\n            TransactionStatus.rejected,\n          ].includes(status)\n        ) {\n          // Mark tx as failed in txHistory\n          this.#markTxAsFailed(transactionMeta);\n          // Track failed event\n          if (status !== TransactionStatus.rejected) {\n            // Look up history by txMetaId first, then by actionId (for pre-submission failures)\n            let historyKey: string | undefined;\n            if (this.state.txHistory[txMetaId]) {\n              historyKey = txMetaId;\n            } else if (actionId && this.state.txHistory[actionId]) {\n              historyKey = actionId;\n            }\n\n            this.#trackUnifiedSwapBridgeEvent(\n              UnifiedSwapBridgeEventName.Failed,\n              historyKey ?? txMetaId,\n              getEVMTxPropertiesFromTransactionMeta(transactionMeta),\n            );\n          }\n        }\n      },\n    );\n\n    this.messenger.subscribe(\n      'TransactionController:transactionConfirmed',\n      (transactionMeta) => {\n        const { type, id: txMetaId, chainId } = transactionMeta;\n        if (type === TransactionType.swap) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMetaId,\n          );\n        }\n        if (type === TransactionType.bridge && !isNonEvmChainId(chainId)) {\n          this.#startPollingForTxId(txMetaId);\n        }\n      },\n    );\n\n    // If you close the extension, but keep the browser open, the polling continues\n    // If you close the browser, the polling stops\n    // Check for historyItems that do not have a status of complete and restart polling\n    this.#restartPollingForIncompleteHistoryItems();\n  }\n\n  // Mark tx as failed in txHistory if either the approval or trade fails\n  readonly #markTxAsFailed = ({\n    id: txMetaId,\n    actionId,\n  }: TransactionMeta): void => {\n    // Look up by txMetaId first\n    let txHistoryKey: string | undefined = this.state.txHistory[txMetaId]\n      ? txMetaId\n      : undefined;\n\n    // If not found by txMetaId, try looking up by actionId (for pre-submission failures)\n    if (!txHistoryKey && actionId && this.state.txHistory[actionId]) {\n      txHistoryKey = actionId;\n    }\n\n    // If still not found, try looking up by approvalTxId\n    txHistoryKey ??= Object.keys(this.state.txHistory).find(\n      (key) => this.state.txHistory[key].approvalTxId === txMetaId,\n    );\n\n    if (!txHistoryKey) {\n      return;\n    }\n    const key = txHistoryKey;\n    this.update((statusState) => {\n      statusState.txHistory[key].status.status = StatusTypes.FAILED;\n    });\n  };\n\n  resetState = (): void => {\n    this.update((state) => {\n      state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n    });\n  };\n\n  wipeBridgeStatus = ({\n    address,\n    ignoreNetwork,\n  }: {\n    address: string;\n    ignoreNetwork: boolean;\n  }): void => {\n    // Wipe all networks for this address\n    if (ignoreNetwork) {\n      this.update((state) => {\n        state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n      });\n    } else {\n      const { selectedNetworkClientId } = this.messenger.call(\n        'NetworkController:getState',\n      );\n      const selectedNetworkClient = this.messenger.call(\n        'NetworkController:getNetworkClientById',\n        selectedNetworkClientId,\n      );\n      const selectedChainId = selectedNetworkClient.configuration.chainId;\n\n      this.#wipeBridgeStatusByChainId(address, selectedChainId);\n    }\n  };\n\n  /**\n   * Resets the attempts counter for a bridge transaction history item\n   * and restarts polling if it was previously stopped due to max attempts\n   *\n   * @param identifier - Object containing either txMetaId or txHash to identify the history item\n   * @param identifier.txMetaId - The transaction meta ID\n   * @param identifier.txHash - The transaction hash\n   */\n  restartPollingForFailedAttempts = (identifier: {\n    txMetaId?: string;\n    txHash?: string;\n  }): void => {\n    const { txMetaId, txHash } = identifier;\n\n    if (!txMetaId && !txHash) {\n      throw new Error('Either txMetaId or txHash must be provided');\n    }\n\n    // Find the history item by txMetaId or txHash\n    let targetTxMetaId: string | undefined;\n\n    if (txMetaId) {\n      // Direct lookup by txMetaId\n      if (this.state.txHistory[txMetaId]) {\n        targetTxMetaId = txMetaId;\n      }\n    } else if (txHash) {\n      // Search by txHash in status.srcChain.txHash\n      targetTxMetaId = Object.keys(this.state.txHistory).find(\n        (id) => this.state.txHistory[id].status.srcChain.txHash === txHash,\n      );\n    }\n\n    if (!targetTxMetaId) {\n      throw new Error(\n        `No bridge transaction history found for ${\n          txMetaId ? `txMetaId: ${txMetaId}` : `txHash: ${txHash}`\n        }`,\n      );\n    }\n\n    const historyItem = this.state.txHistory[targetTxMetaId];\n\n    // Capture attempts count before resetting for metrics\n    const previousAttempts = historyItem.attempts?.counter ?? 0;\n\n    // Reset the attempts counter\n    this.update((state) => {\n      if (targetTxMetaId) {\n        state.txHistory[targetTxMetaId].attempts = undefined;\n      }\n    });\n\n    // Restart polling if it was stopped and this tx still needs status updates\n    if (this.#shouldPollHistoryItem(historyItem)) {\n      // Check if polling was stopped (no active polling token)\n      const existingPollingToken =\n        this.#pollingTokensByTxMetaId[targetTxMetaId];\n\n      if (!existingPollingToken) {\n        // Restart polling\n        this.#startPollingForTxId(targetTxMetaId);\n\n        // Track polling manually restarted event\n        if (!historyItem.featureId) {\n          const selectedAccount = this.messenger.call(\n            'AccountsController:getAccountByAddress',\n            historyItem.account,\n          );\n          const requestParams = getRequestParamFromHistory(historyItem);\n          const requestMetadata = getRequestMetadataFromHistory(\n            historyItem,\n            selectedAccount,\n          );\n          const { security_warnings: _, ...metadataWithoutWarnings } =\n            requestMetadata;\n\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.PollingStatusUpdated,\n            targetTxMetaId,\n            {\n              ...getTradeDataFromHistory(historyItem),\n              ...getPriceImpactFromQuote(historyItem.quote),\n              ...metadataWithoutWarnings,\n              chain_id_source: requestParams.chain_id_source,\n              chain_id_destination: requestParams.chain_id_destination,\n              token_symbol_source: requestParams.token_symbol_source,\n              token_symbol_destination: requestParams.token_symbol_destination,\n              action_type: MetricsActionType.SWAPBRIDGE_V1,\n              polling_status: PollingStatus.ManuallyRestarted,\n              retry_attempts: previousAttempts,\n            },\n          );\n        }\n      }\n    }\n  };\n\n  /**\n   * Gets a bridge history item from the history by its transaction meta ID\n   *\n   * @param txMetaId - The transaction meta ID to look up\n   * @returns The bridge history item if found, undefined otherwise\n   */\n  getBridgeHistoryItemByTxMetaId = (\n    txMetaId: string,\n  ): BridgeHistoryItem | undefined => {\n    return this.state.txHistory[txMetaId];\n  };\n\n  /**\n   * Restart polling for txs that are not in a final state\n   * This is called during initialization\n   */\n  readonly #restartPollingForIncompleteHistoryItems = (): void => {\n    // Check for historyItems that do not have a status of complete and restart polling\n    const { txHistory } = this.state;\n    const historyItems = Object.values(txHistory);\n    const incompleteHistoryItems = historyItems\n      .filter(\n        (historyItem) =>\n          historyItem.status.status === StatusTypes.PENDING ||\n          historyItem.status.status === StatusTypes.UNKNOWN,\n      )\n      // Only poll items with txMetaId (post-submission items)\n      .filter(\n        (\n          historyItem,\n        ): historyItem is BridgeHistoryItem & { txMetaId: string } =>\n          Boolean(historyItem.txMetaId),\n      )\n      .filter((historyItem) => {\n        // Check if we are already polling this tx, if so, skip restarting polling for that\n        const pollingToken =\n          this.#pollingTokensByTxMetaId[historyItem.txMetaId];\n        return !pollingToken;\n      })\n      // Only restart polling for items that still require status updates\n      .filter((historyItem) => {\n        return this.#shouldPollHistoryItem(historyItem);\n      });\n\n    incompleteHistoryItems.forEach((historyItem) => {\n      const bridgeTxMetaId = historyItem.txMetaId;\n      const shouldSkipFetch = shouldSkipFetchDueToFetchFailures(\n        historyItem.attempts,\n      );\n      if (shouldSkipFetch) {\n        return;\n      }\n\n      // We manually call startPolling() here rather than go through startPollingForBridgeTxStatus()\n      // because we don't want to overwrite the existing historyItem in state\n      this.#startPollingForTxId(bridgeTxMetaId);\n    });\n  };\n\n  readonly #addTxToHistory = (\n    startPollingForBridgeTxStatusArgs: StartPollingForBridgeTxStatusArgsSerialized,\n    actionId?: string,\n  ): void => {\n    const {\n      bridgeTxMeta,\n      statusRequest,\n      quoteResponse,\n      startTime,\n      slippagePercentage,\n      initialDestAssetBalance,\n      targetContractAddress,\n      approvalTxId,\n      isStxEnabled,\n      location,\n      accountAddress: selectedAddress,\n    } = startPollingForBridgeTxStatusArgs;\n\n    // Determine the key for this history item:\n    // - For pre-submission (non-batch EVM): use actionId\n    // - For post-submission or other cases: use bridgeTxMeta.id\n    const historyKey = getHistoryKey(actionId, bridgeTxMeta?.id);\n\n    // Write all non-status fields to state so we can reference the quote in Activity list without the Bridge API\n    // We know it's in progress but not the exact status yet\n    const txHistoryItem: BridgeHistoryItem = {\n      txMetaId: bridgeTxMeta?.id,\n      actionId,\n      originalTransactionId:\n        (bridgeTxMeta as unknown as { originalTransactionId: string })\n          ?.originalTransactionId || bridgeTxMeta?.id, // Keep original for intent transactions\n      batchId: bridgeTxMeta?.batchId,\n      quote: quoteResponse.quote,\n      startTime,\n      estimatedProcessingTimeInSeconds:\n        quoteResponse.estimatedProcessingTimeInSeconds,\n      slippagePercentage,\n      pricingData: {\n        amountSent: quoteResponse.sentAmount?.amount ?? '0',\n        amountSentInUsd: quoteResponse.sentAmount?.usd ?? undefined,\n        quotedGasInUsd: quoteResponse.gasFee?.effective?.usd ?? undefined,\n        quotedReturnInUsd: quoteResponse.toTokenAmount?.usd ?? undefined,\n        quotedGasAmount: quoteResponse.gasFee?.effective?.amount ?? undefined,\n      },\n      initialDestAssetBalance,\n      targetContractAddress,\n      account: selectedAddress,\n      status: {\n        // We always have a PENDING status when we start polling for a tx, don't need the Bridge API for that\n        // Also we know the bare minimum fields for status at this point in time\n        status: StatusTypes.PENDING,\n        srcChain: {\n          chainId: statusRequest.srcChainId,\n          txHash: statusRequest.srcTxHash,\n        },\n      },\n      hasApprovalTx: Boolean(quoteResponse.approval),\n      approvalTxId,\n      isStxEnabled: isStxEnabled ?? false,\n      featureId: quoteResponse.featureId,\n      location,\n    };\n    this.update((state) => {\n      // Use actionId as key for pre-submission, or txMeta.id for post-submission\n      state.txHistory[historyKey] = txHistoryItem;\n    });\n  };\n\n  /**\n   * Rekeys a history item from actionId to txMeta.id after successful submission.\n   * Also updates txMetaId and srcTxHash which weren't available pre-submission.\n   *\n   * @param actionId - The actionId used as the temporary key for the history item\n   * @param txMeta - The transaction meta from the successful submission\n   * @param txMeta.id - The transaction meta id to use as the new key\n   * @param txMeta.hash - The transaction hash to set on the history item\n   */\n  readonly #rekeyHistoryItem = (\n    actionId: string,\n    txMeta: { id: string; hash?: string },\n  ): void => {\n    this.update((state) => {\n      rekeyHistoryItemInState(state, actionId, txMeta);\n    });\n  };\n\n  readonly #startPollingForTxId = (txId: string): void => {\n    // If we are already polling for this tx, stop polling for it before restarting\n    const existingPollingToken = this.#pollingTokensByTxMetaId[txId];\n    if (existingPollingToken) {\n      this.stopPollingByPollingToken(existingPollingToken);\n    }\n\n    const txHistoryItem = this.state.txHistory[txId];\n    if (!txHistoryItem) {\n      return;\n    }\n    if (this.#shouldPollHistoryItem(txHistoryItem)) {\n      this.#pollingTokensByTxMetaId[txId] = this.startPolling({\n        bridgeTxMetaId: txId,\n      });\n    }\n  };\n\n  readonly #shouldPollHistoryItem = (\n    historyItem: BridgeHistoryItem,\n  ): boolean => {\n    const isIntent = Boolean(historyItem?.quote?.intent);\n    const isBridgeTx = isCrossChain(\n      historyItem.quote.srcChainId,\n      historyItem.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(historyItem.quote.srcChainId);\n\n    return [isBridgeTx, isIntent, isTronTx].some(Boolean);\n  };\n\n  /**\n   * @deprecated For EVM/Solana swap/bridge txs we add tx to history in submitTx()\n   * For Solana swap/bridge we start polling in submitTx()\n   * For EVM bridge we listen for 'TransactionController:transactionConfirmed' and start polling there\n   * No clients currently call this, safe to remove in future versions\n   *\n   * Adds tx to history and starts polling for the bridge tx status\n   *\n   * @param txHistoryMeta - The parameters for creating the history item\n   */\n  startPollingForBridgeTxStatus = (\n    txHistoryMeta: StartPollingForBridgeTxStatusArgsSerialized,\n  ): void => {\n    const { bridgeTxMeta } = txHistoryMeta;\n\n    if (!bridgeTxMeta?.id) {\n      throw new Error(\n        'Cannot start polling: bridgeTxMeta.id is required for polling',\n      );\n    }\n\n    this.#addTxToHistory(txHistoryMeta);\n    this.#startPollingForTxId(bridgeTxMeta.id);\n  };\n\n  // This will be called after you call this.startPolling()\n  // The args passed in are the args you passed in to startPolling()\n  _executePoll = async (\n    pollingInput: BridgeStatusPollingInput,\n  ): Promise<void> => {\n    await this.#fetchBridgeTxStatus(pollingInput);\n  };\n\n  #getMultichainSelectedAccount(\n    accountAddress: string,\n  ):\n    | AccountsControllerState['internalAccounts']['accounts'][string]\n    | undefined {\n    return this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      accountAddress,\n    );\n  }\n\n  /**\n   * Handles the failure to fetch the bridge tx status\n   * We eventually stop polling for the tx if we fail too many times\n   * Failures (500 errors) can be due to:\n   * - The srcTxHash not being available immediately for STX\n   * - The srcTxHash being invalid for the chain. This case will never resolve so we stop polling for it to avoid hammering the Bridge API forever.\n   *\n   * @param bridgeTxMetaId - The txMetaId of the bridge tx\n   */\n  readonly #handleFetchFailure = (bridgeTxMetaId: string): void => {\n    const { attempts } = this.state.txHistory[bridgeTxMetaId];\n\n    const newAttempts = attempts\n      ? {\n          counter: attempts.counter + 1,\n          lastAttemptTime: Date.now(),\n        }\n      : {\n          counter: 1,\n          lastAttemptTime: Date.now(),\n        };\n\n    // If we've failed too many times, stop polling for the tx\n    const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n    if (newAttempts.counter >= MAX_ATTEMPTS && pollingToken) {\n      this.stopPollingByPollingToken(pollingToken);\n      delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      // Track max polling reached event\n      const historyItem = this.state.txHistory[bridgeTxMetaId];\n      if (historyItem && !historyItem.featureId) {\n        const selectedAccount = this.messenger.call(\n          'AccountsController:getAccountByAddress',\n          historyItem.account,\n        );\n        const requestParams = getRequestParamFromHistory(historyItem);\n        const requestMetadata = getRequestMetadataFromHistory(\n          historyItem,\n          selectedAccount,\n        );\n        const { security_warnings: _, ...metadataWithoutWarnings } =\n          requestMetadata;\n\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.PollingStatusUpdated,\n          bridgeTxMetaId,\n          {\n            ...getTradeDataFromHistory(historyItem),\n            ...getPriceImpactFromQuote(historyItem.quote),\n            ...metadataWithoutWarnings,\n            chain_id_source: requestParams.chain_id_source,\n            chain_id_destination: requestParams.chain_id_destination,\n            token_symbol_source: requestParams.token_symbol_source,\n            token_symbol_destination: requestParams.token_symbol_destination,\n            action_type: MetricsActionType.SWAPBRIDGE_V1,\n            polling_status: PollingStatus.MaxPollingReached,\n            retry_attempts: newAttempts.counter,\n          },\n        );\n      }\n    }\n\n    // Update the attempts counter\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].attempts = newAttempts;\n    });\n  };\n\n  readonly #fetchBridgeTxStatus = async ({\n    bridgeTxMetaId,\n  }: FetchBridgeTxStatusArgs): Promise<void> => {\n    // 1. Check for history item\n\n    const { txHistory } = this.state;\n    const historyItem = txHistory[bridgeTxMetaId];\n    if (!historyItem) {\n      return;\n    }\n\n    // 2. Check for previous failures\n\n    if (shouldSkipFetchDueToFetchFailures(historyItem.attempts)) {\n      return;\n    }\n\n    // 3. Fetch transcation status\n\n    try {\n      let status: BridgeHistoryItem['status'];\n      let validationFailures: string[] = [];\n      let intentTranslation: IntentStatusTranslation | null = null;\n      let intentOrderStatus: string | undefined;\n\n      const isIntent = Boolean(historyItem.quote.intent);\n\n      if (isIntent) {\n        const { srcChainId } = historyItem.quote;\n\n        const intentApi = new IntentApiImpl(\n          this.#config.customBridgeApiBaseUrl,\n          this.#fetchFn,\n        );\n        const intentOrder = await intentApi.getOrderStatus(\n          bridgeTxMetaId,\n          historyItem.quote.intent?.protocol ?? '',\n          srcChainId.toString(),\n          this.#clientId,\n        );\n\n        intentOrderStatus = intentOrder.status;\n        intentTranslation = translateIntentOrderToBridgeStatus(\n          intentOrder,\n          srcChainId,\n          historyItem.status.srcChain.txHash,\n        );\n        status = intentTranslation.status;\n      } else {\n        // We try here because we receive 500 errors from Bridge API if we try to fetch immediately after submitting the source tx\n        // Oddly mostly happens on Optimism, never on Arbitrum. By the 2nd fetch, the Bridge API responds properly.\n        // Also srcTxHash may not be available immediately for STX, so we don't want to fetch in those cases\n        const srcTxHash = this.#getSrcTxHash(bridgeTxMetaId);\n        if (!srcTxHash) {\n          return;\n        }\n\n        this.#updateSrcTxHash(bridgeTxMetaId, srcTxHash);\n\n        const statusRequest = getStatusRequestWithSrcTxHash(\n          historyItem.quote,\n          srcTxHash,\n        );\n        const response = await fetchBridgeTxStatus(\n          statusRequest,\n          this.#clientId,\n          this.#fetchFn,\n          this.#config.customBridgeApiBaseUrl,\n        );\n        status = response.status;\n        validationFailures = response.validationFailures;\n      }\n\n      if (validationFailures.length > 0) {\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.StatusValidationFailed,\n          bridgeTxMetaId,\n          {\n            failures: validationFailures,\n            refresh_count: historyItem.attempts?.counter ?? 0,\n          },\n        );\n        throw new Error(\n          `Bridge status validation failed: ${validationFailures.join(', ')}`,\n        );\n      }\n\n      // 4. Create bridge history item\n\n      const newBridgeHistoryItem = {\n        ...historyItem,\n        status,\n        completionTime:\n          status.status === StatusTypes.COMPLETE ||\n          status.status === StatusTypes.FAILED\n            ? Date.now()\n            : undefined, // TODO make this more accurate by looking up dest txHash block time\n        attempts: undefined,\n      };\n\n      // No need to purge these on network change or account change, TransactionController does not purge either.\n      // TODO In theory we can skip checking status if it's not the current account/network\n      // we need to keep track of the account that this is associated with as well so that we don't show it in Activity list for other accounts\n      // First stab at this will not stop polling when you are on a different account\n      this.update((state) => {\n        state.txHistory[bridgeTxMetaId] = newBridgeHistoryItem;\n      });\n\n      if (isIntent && intentTranslation && intentOrderStatus) {\n        this.#intentStatusManager.syncTransactionFromIntentStatus(\n          bridgeTxMetaId,\n          historyItem,\n          intentTranslation,\n          intentOrderStatus,\n        );\n      }\n\n      // 5. After effects\n\n      const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      const isFinalStatus =\n        status.status === StatusTypes.COMPLETE ||\n        status.status === StatusTypes.FAILED;\n\n      if (isFinalStatus && pollingToken) {\n        this.stopPollingByPollingToken(pollingToken);\n        delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n        // Skip tracking events when featureId is set (i.e. PERPS)\n        if (historyItem.featureId) {\n          return;\n        }\n\n        if (status.status === StatusTypes.COMPLETE) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            bridgeTxMetaId,\n          );\n          this.messenger.publish(\n            'BridgeStatusController:destinationTransactionCompleted',\n            historyItem.quote.destAsset.assetId,\n          );\n        }\n        if (status.status === StatusTypes.FAILED) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Failed,\n            bridgeTxMetaId,\n          );\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to fetch bridge tx status', error);\n      this.#handleFetchFailure(bridgeTxMetaId);\n    }\n  };\n\n  readonly #getSrcTxHash = (bridgeTxMetaId: string): string | undefined => {\n    const { txHistory } = this.state;\n    // Prefer the srcTxHash from bridgeStatusState so we don't have to l ook up in TransactionController\n    // But it is possible to have bridgeHistoryItem in state without the srcTxHash yet when it is an STX\n    const srcTxHash = txHistory[bridgeTxMetaId].status.srcChain.txHash;\n\n    if (srcTxHash) {\n      return srcTxHash;\n    }\n\n    // Look up in TransactionController if txMeta has been updated with the srcTxHash\n    const txControllerState = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = txControllerState.transactions.find(\n      (tx: TransactionMeta) => tx.id === bridgeTxMetaId,\n    );\n    return txMeta?.hash;\n  };\n\n  readonly #updateSrcTxHash = (\n    bridgeTxMetaId: string,\n    srcTxHash: string,\n  ): void => {\n    const { txHistory } = this.state;\n    if (txHistory[bridgeTxMetaId].status.srcChain.txHash) {\n      return;\n    }\n\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].status.srcChain.txHash = srcTxHash;\n    });\n  };\n\n  // Wipes the bridge status for the given address and chainId\n  // Will match only source chainId to the selectedChainId\n  readonly #wipeBridgeStatusByChainId = (\n    address: string,\n    selectedChainId: Hex,\n  ): void => {\n    const sourceTxMetaIdsToDelete = Object.keys(this.state.txHistory).filter(\n      (txMetaId) => {\n        const bridgeHistoryItem = this.state.txHistory[txMetaId];\n\n        const hexSourceChainId = numberToHex(\n          bridgeHistoryItem.quote.srcChainId,\n        );\n\n        return (\n          bridgeHistoryItem.account === address &&\n          hexSourceChainId === selectedChainId\n        );\n      },\n    );\n\n    sourceTxMetaIdsToDelete.forEach((sourceTxMetaId) => {\n      const pollingToken = this.#pollingTokensByTxMetaId[sourceTxMetaId];\n\n      if (pollingToken) {\n        this.stopPollingByPollingToken(\n          this.#pollingTokensByTxMetaId[sourceTxMetaId],\n        );\n      }\n    });\n\n    this.update((state) => {\n      state.txHistory = sourceTxMetaIdsToDelete.reduce(\n        (acc, sourceTxMetaId) => {\n          delete acc[sourceTxMetaId];\n          return acc;\n        },\n        state.txHistory,\n      );\n    });\n  };\n\n  /**\n   * ******************************************************\n   * TX SUBMISSION HANDLING\n   *******************************************************\n   */\n\n  /**\n   * Submits the transaction to the snap using the new unified ClientRequest interface\n   * Works for all non-EVM chains (Solana, BTC, Tron)\n   * This adds an approval tx to the ApprovalsController in the background\n   * The client needs to handle the approval tx by redirecting to the confirmation page with the approvalTxId in the URL\n   *\n   * @param trade - The trade data (can be approval or main trade)\n   * @param quoteResponse - The quote response containing metadata\n   * @param selectedAccount - The account to submit the transaction for\n   * @returns The transaction meta\n   */\n  readonly #handleNonEvmTx = async (\n    trade: Trade,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    selectedAccount: AccountsControllerState['internalAccounts']['accounts'][string],\n  ): Promise<TransactionMeta> => {\n    if (!selectedAccount.metadata?.snap?.id) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined snap id',\n      );\n    }\n\n    const request = getClientRequest(\n      trade,\n      quoteResponse.quote.srcChainId,\n      selectedAccount,\n    );\n    const requestResponse = (await this.messenger.call(\n      'SnapController:handleRequest',\n      request,\n    )) as\n      | string\n      | { transactionId: string }\n      | { result: Record<string, string> }\n      | { signature: string };\n\n    // Create quote response with the specified trade\n    // This allows the same method to handle both approvals and main trades\n    const txQuoteResponse: QuoteResponse<Trade> & QuoteMetadata = {\n      ...quoteResponse,\n      trade,\n    };\n\n    const txMeta = handleNonEvmTxResponse(\n      requestResponse,\n      txQuoteResponse,\n      selectedAccount,\n    );\n\n    // TODO remove this eventually, just returning it now to match extension behavior\n    // OR if the snap can propagate the snapRequestId or keyringReqId to the ApprovalsController, this can return the approvalTxId instead and clients won't need to subscribe to the ApprovalsController state to redirect\n    return txMeta;\n  };\n\n  readonly #waitForHashAndReturnFinalTxMeta = async (\n    hashPromise?: Awaited<\n      ReturnType<TransactionController['addTransaction']>\n    >['result'],\n  ): Promise<TransactionMeta> => {\n    const transactionHash = await hashPromise;\n    const finalTransactionMeta: TransactionMeta | undefined = this.messenger\n      .call('TransactionController:getState')\n      .transactions.find((tx: TransactionMeta) => tx.hash === transactionHash);\n    if (!finalTransactionMeta) {\n      throw new Error(\n        'Failed to submit cross-chain swap tx: txMeta for txHash was not found',\n      );\n    }\n    return finalTransactionMeta;\n  };\n\n  // Waits until a given transaction (by id) reaches confirmed/finalized status or fails/times out.\n  readonly #waitForTxConfirmation = async (\n    txId: string,\n    {\n      timeoutMs = 5 * 60_000, // 5 minutes default\n      pollMs = 3_000,\n    }: { timeoutMs?: number; pollMs?: number } = {},\n  ): Promise<TransactionMeta> => {\n    return await waitForTxConfirmation(this.messenger, txId, {\n      timeoutMs,\n      pollMs,\n    });\n  };\n\n  readonly #handleApprovalTx = async (\n    isBridgeTx: boolean,\n    srcChainId: QuoteResponse['quote']['srcChainId'],\n    approval?: TxData,\n    resetApproval?: TxData,\n    requireApproval?: boolean,\n  ): Promise<TransactionMeta | undefined> => {\n    if (approval) {\n      const approveTx = async (): Promise<TransactionMeta> => {\n        await this.#handleUSDTAllowanceReset(resetApproval);\n\n        const approvalTxMeta = await this.#handleEvmTransaction({\n          transactionType: isBridgeTx\n            ? TransactionType.bridgeApproval\n            : TransactionType.swapApproval,\n          trade: approval,\n          requireApproval,\n        });\n\n        await handleApprovalDelay(srcChainId);\n        return approvalTxMeta;\n      };\n\n      return await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionApprovalCompleted\n            : TraceName.SwapTransactionApprovalCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(srcChainId),\n            stxEnabled: false,\n          },\n        },\n        approveTx,\n      );\n    }\n\n    return undefined;\n  };\n\n  /**\n   * Submits an EVM transaction to the TransactionController\n   *\n   * @param params - The parameters for the transaction\n   * @param params.transactionType - The type of transaction to submit\n   * @param params.trade - The trade data to confirm\n   * @param params.requireApproval - Whether to require approval for the transaction\n   * @param params.txFee - Optional gas fee parameters from the quote (used when gasIncluded is true)\n   * @param params.txFee.maxFeePerGas - The maximum fee per gas from the quote\n   * @param params.txFee.maxPriorityFeePerGas - The maximum priority fee per gas from the quote\n   * @param params.actionId - Optional actionId for pre-submission history (if not provided, one is generated)\n   * @returns The transaction meta\n   */\n  readonly #handleEvmTransaction = async ({\n    transactionType,\n    trade,\n    requireApproval = false,\n    txFee,\n    actionId: providedActionId,\n  }: {\n    transactionType: TransactionType;\n    trade: TxData;\n    requireApproval?: boolean;\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string };\n    actionId?: string;\n  }): Promise<TransactionMeta> => {\n    // Use provided actionId (for pre-submission history) or generate one\n    const actionId = providedActionId ?? generateActionId().toString();\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      trade.from,\n    );\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: unknown account in trade data',\n      );\n    }\n    const hexChainId = formatChainIdToHex(trade.chainId);\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      hexChainId,\n    );\n\n    const requestOptions = {\n      actionId,\n      networkClientId,\n      requireApproval,\n      type: transactionType,\n      origin: 'metamask',\n    };\n    // Exclude gasLimit from trade to avoid type issues (it can be null)\n    const { gasLimit: tradeGasLimit, ...tradeWithoutGasLimit } = trade;\n\n    const transactionParams: Parameters<\n      TransactionController['addTransaction']\n    >[0] = {\n      ...tradeWithoutGasLimit,\n      chainId: hexChainId,\n      // Only add gasLimit and gas if they're valid (not undefined/null/zero)\n      ...(tradeGasLimit &&\n        tradeGasLimit !== 0 && {\n          gasLimit: tradeGasLimit.toString(),\n          gas: tradeGasLimit.toString(),\n        }),\n    };\n    const transactionParamsWithMaxGas: TransactionParams = {\n      ...transactionParams,\n      ...(await this.#calculateGasFees(\n        transactionParams,\n        networkClientId,\n        hexChainId,\n        txFee,\n      )),\n    };\n\n    const { result } = await this.#addTransactionFn(\n      transactionParamsWithMaxGas,\n      requestOptions,\n    );\n\n    return await this.#waitForHashAndReturnFinalTxMeta(result);\n  };\n\n  readonly #handleUSDTAllowanceReset = async (\n    resetApproval?: TxData,\n  ): Promise<void> => {\n    if (resetApproval) {\n      await this.#handleEvmTransaction({\n        transactionType: TransactionType.bridgeApproval,\n        trade: resetApproval,\n      });\n    }\n  };\n\n  readonly #calculateGasFees = async (\n    transactionParams: TransactionParams,\n    networkClientId: string,\n    chainId: Hex,\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string },\n  ): Promise<{\n    maxFeePerGas: Hex;\n    maxPriorityFeePerGas: Hex;\n    gas?: Hex;\n  }> => {\n    const { gas } = transactionParams;\n    // If txFee is provided (gasIncluded case), use the quote's gas fees\n    // Convert to hex since txFee values from the quote are decimal strings\n    if (txFee) {\n      return {\n        maxFeePerGas: toHex(txFee.maxFeePerGas ?? 0),\n        maxPriorityFeePerGas: toHex(txFee.maxPriorityFeePerGas ?? 0),\n        gas: gas ? toHex(gas) : undefined,\n      };\n    }\n\n    const { gasFeeEstimates } = this.messenger.call(\n      'GasFeeController:getState',\n    );\n    const { estimates: txGasFeeEstimates } = await this.#estimateGasFeeFn({\n      transactionParams,\n      chainId,\n      networkClientId,\n    });\n    const { maxFeePerGas, maxPriorityFeePerGas } = getTxGasEstimates({\n      networkGasFeeEstimates: gasFeeEstimates,\n      txGasFeeEstimates,\n    });\n\n    return {\n      maxFeePerGas,\n      maxPriorityFeePerGas,\n      gas: gas ? toHex(gas) : undefined,\n    };\n  };\n\n  /**\n   * Submits batched EVM transactions to the TransactionController\n   *\n   * @param args - The parameters for the transaction\n   * @param args.isBridgeTx - Whether the transaction is a bridge transaction\n   * @param args.trade - The trade data to confirm\n   * @param args.approval - The approval data to confirm\n   * @param args.resetApproval - The ethereum:USDT reset approval data to confirm\n   * @param args.quoteResponse - The quote response\n   * @param args.requireApproval - Whether to require approval for the transaction\n   * @returns The approvalMeta and tradeMeta for the batched transaction\n   */\n  readonly #handleEvmTransactionBatch = async (\n    args: Omit<\n      Parameters<typeof getAddTransactionBatchParams>[0],\n      'messenger' | 'estimateGasFeeFn'\n    >,\n  ): Promise<{\n    approvalMeta?: TransactionMeta;\n    tradeMeta: TransactionMeta;\n  }> => {\n    const transactionParams = await getAddTransactionBatchParams({\n      messenger: this.messenger,\n      estimateGasFeeFn: this.#estimateGasFeeFn,\n      ...args,\n    });\n    const txDataByType = {\n      [TransactionType.bridgeApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridgeApproval,\n      )?.params.data,\n      [TransactionType.swapApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swapApproval,\n      )?.params.data,\n      [TransactionType.bridge]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridge,\n      )?.params.data,\n      [TransactionType.swap]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swap,\n      )?.params.data,\n    };\n\n    const { batchId } = await this.#addTransactionBatchFn(transactionParams);\n\n    const { approvalMeta, tradeMeta } = findAndUpdateTransactionsInBatch({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n      batchId,\n      txDataByType,\n    });\n\n    if (!tradeMeta) {\n      throw new Error(\n        'Failed to update cross-chain swap transaction batch: tradeMeta not found',\n      );\n    }\n\n    return { approvalMeta, tradeMeta };\n  };\n\n  /**\n   * Submits a cross-chain swap transaction\n   *\n   * @param accountAddress - The address of the account to submit the transaction for\n   * @param quoteResponse - The quote response\n   * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n   * @param quotesReceivedContext - The context for the QuotesReceived event\n   * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n   * @returns The transaction meta\n   */\n  submitTx = async (\n    accountAddress: string,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    isStxEnabledOnClient: boolean,\n    quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n    location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n  ): Promise<TransactionMeta & Partial<SolanaTransactionMeta>> => {\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n      // If trade is submitted before all quotes are loaded, the QuotesReceived event is published\n      // If the trade has a featureId, it means it was submitted outside of the Unified Swap and Bridge experience, so no QuotesReceived event is published\n      quoteResponse.featureId ? undefined : quotesReceivedContext,\n    );\n\n    const selectedAccount = this.#getMultichainSelectedAccount(accountAddress);\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined multichain account',\n      );\n    }\n    const isHardwareAccount = isHardwareWallet(selectedAccount);\n\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      isStxEnabledOnClient,\n      isHardwareAccount,\n      location,\n    );\n    // Emit Submitted event after submit button is clicked\n    !quoteResponse.featureId &&\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Submitted,\n        undefined,\n        preConfirmationProperties,\n      );\n\n    let txMeta: TransactionMeta & Partial<SolanaTransactionMeta>;\n    let approvalTxId: string | undefined;\n    const startTime = Date.now();\n\n    const isBridgeTx = isCrossChain(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(quoteResponse.quote.srcChainId);\n\n    // Submit non-EVM tx (Solana, BTC, Tron)\n    if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n      // Handle non-EVM approval if present (e.g., Tron token approvals)\n      if (quoteResponse.approval && isTronTrade(quoteResponse.approval)) {\n        const approvalTxMeta = await this.#trace(\n          {\n            name: isBridgeTx\n              ? TraceName.BridgeTransactionApprovalCompleted\n              : TraceName.SwapTransactionApprovalCompleted,\n            data: {\n              srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n              stxEnabled: false,\n            },\n          },\n          async () => {\n            try {\n              return quoteResponse.approval &&\n                isTronTrade(quoteResponse.approval)\n                ? await this.#handleNonEvmTx(\n                    quoteResponse.approval,\n                    quoteResponse,\n                    selectedAccount,\n                  )\n                : undefined;\n            } catch (error) {\n              !quoteResponse.featureId &&\n                this.#trackUnifiedSwapBridgeEvent(\n                  UnifiedSwapBridgeEventName.Failed,\n                  undefined,\n                  {\n                    error_message: (error as Error)?.message,\n                    ...preConfirmationProperties,\n                  },\n                );\n              throw error;\n            }\n          },\n        );\n\n        approvalTxId = approvalTxMeta?.id;\n\n        // Add delay after approval similar to EVM flow\n        await handleApprovalDelay(quoteResponse.quote.srcChainId);\n      }\n\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: false,\n          },\n        },\n        async () => {\n          try {\n            if (\n              !(\n                isTronTrade(quoteResponse.trade) ||\n                isBitcoinTrade(quoteResponse.trade) ||\n                typeof quoteResponse.trade === 'string'\n              )\n            ) {\n              throw new Error(\n                'Failed to submit cross-chain swap transaction: trade is not a non-EVM transaction',\n              );\n            }\n            return await this.#handleNonEvmTx(\n              quoteResponse.trade,\n              quoteResponse,\n              selectedAccount,\n            );\n          } catch (error) {\n            !quoteResponse.featureId &&\n              this.#trackUnifiedSwapBridgeEvent(\n                UnifiedSwapBridgeEventName.Failed,\n                txMeta?.id,\n                {\n                  error_message: (error as Error)?.message,\n                  ...preConfirmationProperties,\n                },\n              );\n            throw error;\n          }\n        },\n      );\n    } else {\n      // Submit EVM tx\n      // For hardware wallets on Mobile, this is fixes an issue where the Ledger does not get prompted for the 2nd approval\n      // Extension does not have this issue\n      const requireApproval =\n        this.#clientId === BridgeClientId.MOBILE && isHardwareAccount;\n\n      // Handle smart transactions if enabled\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: isStxEnabledOnClient,\n          },\n        },\n        async () => {\n          if (!isEvmTxData(quoteResponse.trade)) {\n            throw new Error(\n              'Failed to submit cross-chain swap transaction: trade is not an EVM transaction',\n            );\n          }\n          if (isStxEnabledOnClient || quoteResponse.quote.gasIncluded7702) {\n            const { tradeMeta, approvalMeta } =\n              await this.#handleEvmTransactionBatch({\n                isBridgeTx,\n                resetApproval: quoteResponse.resetApproval,\n                approval:\n                  quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n                    ? quoteResponse.approval\n                    : undefined,\n                trade: quoteResponse.trade,\n                quoteResponse,\n                requireApproval,\n              });\n\n            approvalTxId = approvalMeta?.id;\n            return tradeMeta;\n          }\n          // Set approval time and id if an approval tx is needed\n          const approvalTxMeta = await this.#handleApprovalTx(\n            isBridgeTx,\n            quoteResponse.quote.srcChainId,\n            quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n              ? quoteResponse.approval\n              : undefined,\n            quoteResponse.resetApproval,\n            requireApproval,\n          );\n\n          approvalTxId = approvalTxMeta?.id;\n\n          await handleMobileHardwareWalletDelay(requireApproval);\n\n          // Generate actionId for pre-submission history (non-batch EVM only)\n          const actionId = generateActionId().toString();\n\n          // Add pre-submission history keyed by actionId\n          // This ensures we have quote data available if transaction fails during submission\n          this.#addTxToHistory(\n            {\n              accountAddress: selectedAccount.address,\n              statusRequest: {\n                ...getStatusRequestParams(quoteResponse),\n                srcTxHash: '', // Not available yet\n              },\n              quoteResponse,\n              slippagePercentage: 0,\n              isStxEnabled: isStxEnabledOnClient,\n              startTime,\n              approvalTxId,\n              location,\n            },\n            actionId,\n          );\n\n          // Pass txFee when gasIncluded is true to use the quote's gas fees\n          // instead of re-estimating (which would fail for max native token swaps)\n          const tradeTxMeta = await this.#handleEvmTransaction({\n            transactionType: isBridgeTx\n              ? TransactionType.bridge\n              : TransactionType.swap,\n            trade: quoteResponse.trade,\n            requireApproval,\n            txFee: quoteResponse.quote.gasIncluded\n              ? quoteResponse.quote.feeData.txFee\n              : undefined,\n            actionId,\n          });\n\n          // On success, rekey from actionId to txMeta.id and update srcTxHash\n          this.#rekeyHistoryItem(actionId, tradeTxMeta);\n\n          return tradeTxMeta;\n        },\n      );\n    }\n\n    try {\n      // For non-batch EVM transactions, history was already added/rekeyed above\n      // Only add history here for non-EVM and batch EVM transactions\n      const isNonBatchEvm =\n        !isNonEvmChainId(quoteResponse.quote.srcChainId) &&\n        !isStxEnabledOnClient &&\n        !quoteResponse.quote.gasIncluded7702;\n\n      if (!isNonBatchEvm) {\n        // Add swap or bridge tx to history\n        this.#addTxToHistory({\n          accountAddress: selectedAccount.address,\n          bridgeTxMeta: txMeta, // Only the id field is used by the BridgeStatusController\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: txMeta.hash,\n          },\n          quoteResponse,\n          slippagePercentage: 0, // TODO include slippage provided by quote if using dynamic slippage, or slippage from quote request\n          isStxEnabled: isStxEnabledOnClient,\n          startTime,\n          approvalTxId,\n          location,\n        });\n      }\n\n      if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n        // Start polling for bridge tx status\n        this.#startPollingForTxId(txMeta.id);\n        // Track non-EVM Swap completed event\n        if (!(isBridgeTx || isTronTx)) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMeta.id,\n          );\n        }\n      }\n    } catch {\n      // Ignore errors here, we don't want to crash the app if this fails and tx submission succeeds\n    }\n    return txMeta;\n  };\n\n  /**\n   * UI-signed intent submission (fast path): the UI generates the EIP-712 signature and calls this with the raw signature.\n   * Here we submit the order to the intent provider and create a synthetic history entry for UX.\n   *\n   * @param params - Object containing intent submission parameters\n   * @param params.quoteResponse - Quote carrying intent data\n   * @param params.signature - Hex signature produced by eth_signTypedData_v4\n   * @param params.accountAddress - The EOA submitting the order\n   * @param params.location - The entry point from which the user initiated the swap or bridge\n   * @returns A lightweight TransactionMeta-like object for history linking\n   */\n  submitIntent = async (params: {\n    quoteResponse: QuoteResponse<TxData | string> & QuoteMetadata;\n    signature: string;\n    accountAddress: string;\n    location?: MetaMetricsSwapsEventSource;\n  }): Promise<Pick<TransactionMeta, 'id' | 'chainId' | 'type' | 'status'>> => {\n    const { quoteResponse, signature, accountAddress, location } = params;\n\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n    );\n\n    // Build pre-confirmation properties for error tracking parity with submitTx\n    const account = this.#getMultichainSelectedAccount(accountAddress);\n    const isHardwareAccount = Boolean(account) && isHardwareWallet(account);\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      false,\n      isHardwareAccount,\n      location,\n    );\n\n    try {\n      const intent = getIntentFromQuote(\n        quoteResponse as QuoteResponse & { quote: { intent?: Intent } },\n      );\n\n      // If backend provided an approval tx for this intent quote, submit it first (on-chain),\n      // then proceed with off-chain intent submission.\n      let approvalTxId: string | undefined;\n      if (quoteResponse.approval) {\n        const isBridgeTx = isCrossChain(\n          quoteResponse.quote.srcChainId,\n          quoteResponse.quote.destChainId,\n        );\n\n        // Handle approval silently for better UX in intent flows\n        const approvalTxMeta = await this.#handleApprovalTx(\n          isBridgeTx,\n          quoteResponse.quote.srcChainId,\n          quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n            ? quoteResponse.approval\n            : undefined,\n          quoteResponse.resetApproval,\n          /* requireApproval */ false,\n        );\n        approvalTxId = approvalTxMeta?.id;\n\n        if (approvalTxId) {\n          await this.#waitForTxConfirmation(approvalTxId);\n        }\n      }\n\n      const { srcChainId: chainId, requestId } = quoteResponse.quote;\n\n      const submissionParams = {\n        srcChainId: chainId.toString(),\n        quoteId: requestId,\n        signature,\n        order: intent.order,\n        userAddress: accountAddress,\n        aggregatorId: intent.protocol,\n      };\n      const intentApi = new IntentApiImpl(\n        this.#config.customBridgeApiBaseUrl,\n        this.#fetchFn,\n      );\n      const intentOrder = await intentApi.submitIntent(\n        submissionParams,\n        this.#clientId,\n      );\n\n      const orderUid = intentOrder.id;\n\n      // Determine transaction type: swap for same-chain, bridge for cross-chain\n      const isCrossChainTx = isCrossChain(\n        quoteResponse.quote.srcChainId,\n        quoteResponse.quote.destChainId,\n      );\n      const transactionType = isCrossChainTx\n        ? TransactionType.bridge\n        : TransactionType.swap;\n\n      // Create actual transaction in Transaction Controller first\n      const networkClientId = this.messenger.call(\n        'NetworkController:findNetworkClientIdByChainId',\n        formatChainIdToHex(chainId),\n      );\n\n      // This is a synthetic transaction whose purpose is to be able\n      // to track the order status via the history\n      const intentTransactionParams = {\n        chainId: formatChainIdToHex(chainId),\n        from: accountAddress,\n        to:\n          intent.settlementContract ??\n          '0x9008D19f58AAbd9eD0D60971565AA8510560ab41', // Default settlement contract\n        data: `0x${orderUid.slice(-8)}`, // Use last 8 chars of orderUid to make each transaction unique\n        value: '0x0',\n        gas: '0x5208', // Minimal gas for display purposes\n        gasPrice: '0x3b9aca00', // 1 Gwei - will be converted to EIP-1559 fees if network supports it\n      };\n\n      const { transactionMeta: txMetaPromise } = await this.#addTransactionFn(\n        intentTransactionParams,\n        {\n          origin: 'metamask',\n          actionId: generateActionId(),\n          requireApproval: false,\n          isStateOnly: true,\n          networkClientId,\n          type: transactionType,\n        },\n      );\n\n      const intentTxMeta = txMetaPromise;\n\n      // Map intent order status to TransactionController status\n      const initialTransactionStatus = mapIntentOrderStatusToTransactionStatus(\n        intentOrder.status,\n      );\n\n      // Update transaction with proper initial status based on intent order\n      const statusUpdatedTxMeta = {\n        ...intentTxMeta,\n        status: initialTransactionStatus,\n      };\n\n      // Update with actual transaction metadata\n      const syntheticMeta = {\n        ...statusUpdatedTxMeta,\n        isIntentTx: true,\n        orderUid,\n        intentType: isCrossChainTx ? 'bridge' : 'swap',\n      } as unknown as TransactionMeta;\n\n      // Record in bridge history with actual transaction metadata\n      try {\n        // Use orderId as the history key for intent transactions\n        const bridgeHistoryKey = orderUid;\n\n        // Create a bridge transaction metadata that includes the original txId\n        const bridgeTxMetaForHistory = {\n          ...syntheticMeta,\n          id: bridgeHistoryKey,\n          originalTransactionId: syntheticMeta.id, // Keep original txId for TransactionController updates\n        } as TransactionMeta;\n\n        const startTime = Date.now();\n\n        this.#addTxToHistory({\n          accountAddress,\n          bridgeTxMeta: bridgeTxMetaForHistory,\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: syntheticMeta.hash ?? '',\n          },\n          quoteResponse,\n          slippagePercentage: 0,\n          isStxEnabled: false,\n          approvalTxId,\n          startTime,\n          location,\n        });\n\n        // Start polling using the orderId key to route to intent manager\n        this.#startPollingForTxId(bridgeHistoryKey);\n      } catch (error) {\n        console.error(\n          ' [submitIntent] Failed to add to bridge history',\n          error,\n        );\n        // non-fatal but log the error\n      }\n      return syntheticMeta;\n    } catch (error) {\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Failed,\n        undefined,\n        {\n          error_message: (error as Error)?.message,\n          ...preConfirmationProperties,\n        },\n      );\n\n      throw error;\n    }\n  };\n\n  /**\n   * Tracks post-submission events for a cross-chain swap based on the history item\n   *\n   * @param eventName - The name of the event to track\n   * @param txMetaId - The txMetaId of the history item to track the event for\n   * @param eventProperties - The properties for the event\n   */\n  readonly #trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      | typeof UnifiedSwapBridgeEventName.Submitted\n      | typeof UnifiedSwapBridgeEventName.Failed\n      | typeof UnifiedSwapBridgeEventName.Completed\n      | typeof UnifiedSwapBridgeEventName.StatusValidationFailed\n      | typeof UnifiedSwapBridgeEventName.PollingStatusUpdated,\n  >(\n    eventName: EventName,\n    txMetaId?: string,\n    eventProperties?: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): void => {\n    const baseProperties = {\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n      location:\n        eventProperties?.location ??\n        (txMetaId ? this.state.txHistory?.[txMetaId]?.location : undefined) ??\n        MetaMetricsSwapsEventSource.MainView,\n      ...(eventProperties ?? {}),\n    };\n\n    // This will publish events for PERPS dropped tx failures as well\n    if (!txMetaId) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const historyItem: BridgeHistoryItem | undefined =\n      this.state.txHistory[txMetaId];\n\n    if (!historyItem) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const requestParamProperties = getRequestParamFromHistory(historyItem);\n    // Always publish StatusValidationFailed event, regardless of featureId\n    if (eventName === UnifiedSwapBridgeEventName.StatusValidationFailed) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        {\n          ...baseProperties,\n          chain_id_source: requestParamProperties.chain_id_source,\n          chain_id_destination: requestParamProperties.chain_id_destination,\n          token_address_source: requestParamProperties.token_address_source,\n          token_address_destination:\n            requestParamProperties.token_address_destination,\n          refresh_count: historyItem.attempts?.counter ?? 0,\n        },\n      );\n      return;\n    }\n\n    // Skip tracking all other events when featureId is set (i.e. PERPS)\n    if (historyItem.featureId) {\n      return;\n    }\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      historyItem.account,\n    );\n\n    const { transactions } = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === txMetaId,\n    );\n    const approvalTxMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === historyItem.approvalTxId,\n    );\n\n    const requiredEventProperties = {\n      ...baseProperties,\n      ...requestParamProperties,\n      ...getRequestMetadataFromHistory(historyItem, selectedAccount),\n      ...getTradeDataFromHistory(historyItem),\n      ...getTxStatusesFromHistory(historyItem),\n      ...getFinalizedTxProperties(historyItem, txMeta, approvalTxMeta),\n      ...getPriceImpactFromQuote(historyItem.quote),\n    };\n\n    this.messenger.call(\n      'BridgeController:trackUnifiedSwapBridgeEvent',\n      eventName,\n      requiredEventProperties,\n    );\n  };\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"bridge-status-controller.mjs","sourceRoot":"","sources":["../src/bridge-status-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AccountsControllerState } from '@metamask/accounts-controller';\nimport type { StateMetadata } from '@metamask/base-controller';\nimport type {\n  QuoteMetadata,\n  RequiredEventContextFromClient,\n  TxData,\n  QuoteResponse,\n  Intent,\n  Trade,\n} from '@metamask/bridge-controller';\nimport {\n  formatChainIdToHex,\n  isNonEvmChainId,\n  StatusTypes,\n  UnifiedSwapBridgeEventName,\n  formatChainIdToCaip,\n  isCrossChain,\n  isTronChainId,\n  isEvmTxData,\n  isHardwareWallet,\n  MetricsActionType,\n  MetaMetricsSwapsEventSource,\n  isBitcoinTrade,\n  isTronTrade,\n  AbortReason,\n  PollingStatus,\n} from '@metamask/bridge-controller';\nimport type { TraceCallback } from '@metamask/controller-utils';\nimport { toHex } from '@metamask/controller-utils';\nimport { StaticIntervalPollingController } from '@metamask/polling-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type {\n  TransactionController,\n  TransactionMeta,\n  TransactionParams,\n} from '@metamask/transaction-controller';\nimport { numberToHex } from '@metamask/utils';\nimport type { Hex } from '@metamask/utils';\n\nimport { IntentStatusManager } from './bridge-status-controller.intent';\nimport {\n  BRIDGE_PROD_API_BASE_URL,\n  BRIDGE_STATUS_CONTROLLER_NAME,\n  DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n  MAX_ATTEMPTS,\n  REFRESH_INTERVAL_MS,\n  TraceName,\n} from './constants';\nimport type {\n  BridgeStatusControllerState,\n  StartPollingForBridgeTxStatusArgsSerialized,\n  FetchFunction,\n  SolanaTransactionMeta,\n  BridgeHistoryItem,\n} from './types';\nimport type { BridgeStatusControllerMessenger } from './types';\nimport { BridgeClientId } from './types';\nimport {\n  fetchBridgeTxStatus,\n  getStatusRequestWithSrcTxHash,\n  shouldSkipFetchDueToFetchFailures,\n} from './utils/bridge-status';\nimport { getTxGasEstimates } from './utils/gas';\nimport {\n  IntentApiImpl,\n  IntentStatusTranslation,\n  mapIntentOrderStatusToTransactionStatus,\n  translateIntentOrderToBridgeStatus,\n} from './utils/intent-api';\nimport {\n  getFinalizedTxProperties,\n  getPriceImpactFromQuote,\n  getRequestMetadataFromHistory,\n  getRequestParamFromHistory,\n  getTradeDataFromHistory,\n  getEVMTxPropertiesFromTransactionMeta,\n  getTxStatusesFromHistory,\n  getPreConfirmationPropertiesFromQuote,\n} from './utils/metrics';\nimport {\n  findAndUpdateTransactionsInBatch,\n  getAddTransactionBatchParams,\n  getClientRequest,\n  getHistoryKey,\n  getIntentFromQuote,\n  getStatusRequestParams,\n  handleApprovalDelay,\n  handleMobileHardwareWalletDelay,\n  handleNonEvmTxResponse,\n  generateActionId,\n  waitForTxConfirmation,\n  rekeyHistoryItemInState,\n} from './utils/transaction';\n\nconst metadata: StateMetadata<BridgeStatusControllerState> = {\n  // We want to persist the bridge status state so that we can show the proper data for the Activity list\n  // basically match the behavior of TransactionController\n  txHistory: {\n    includeInStateLogs: true,\n    persist: true,\n    includeInDebugSnapshot: false,\n    usedInUi: true,\n  },\n};\n\n/** The input to start polling for the {@link BridgeStatusController} */\ntype BridgeStatusPollingInput = FetchBridgeTxStatusArgs;\n\ntype SrcTxMetaId = string;\nexport type FetchBridgeTxStatusArgs = {\n  bridgeTxMetaId: string;\n};\nexport class BridgeStatusController extends StaticIntervalPollingController<BridgeStatusPollingInput>()<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState,\n  BridgeStatusControllerMessenger\n> {\n  #pollingTokensByTxMetaId: Record<SrcTxMetaId, string> = {};\n\n  readonly #intentStatusManager: IntentStatusManager;\n\n  readonly #clientId: BridgeClientId;\n\n  readonly #fetchFn: FetchFunction;\n\n  readonly #config: {\n    customBridgeApiBaseUrl: string;\n  };\n\n  readonly #addTransactionFn: typeof TransactionController.prototype.addTransaction;\n\n  readonly #addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n\n  readonly #updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n\n  readonly #estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n\n  readonly #trace: TraceCallback;\n\n  constructor({\n    messenger,\n    state,\n    clientId,\n    fetchFn,\n    addTransactionFn,\n    addTransactionBatchFn,\n    updateTransactionFn,\n    estimateGasFeeFn,\n    config,\n    traceFn,\n  }: {\n    messenger: BridgeStatusControllerMessenger;\n    state?: Partial<BridgeStatusControllerState>;\n    clientId: BridgeClientId;\n    fetchFn: FetchFunction;\n    addTransactionFn: typeof TransactionController.prototype.addTransaction;\n    addTransactionBatchFn: typeof TransactionController.prototype.addTransactionBatch;\n    updateTransactionFn: typeof TransactionController.prototype.updateTransaction;\n    estimateGasFeeFn: typeof TransactionController.prototype.estimateGasFee;\n    config?: {\n      customBridgeApiBaseUrl?: string;\n    };\n    traceFn?: TraceCallback;\n  }) {\n    super({\n      name: BRIDGE_STATUS_CONTROLLER_NAME,\n      metadata,\n      messenger,\n      // Restore the persisted state\n      state: {\n        ...DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE,\n        ...state,\n      },\n    });\n\n    this.#clientId = clientId;\n    this.#fetchFn = fetchFn;\n    this.#addTransactionFn = addTransactionFn;\n    this.#addTransactionBatchFn = addTransactionBatchFn;\n    this.#updateTransactionFn = updateTransactionFn;\n    this.#estimateGasFeeFn = estimateGasFeeFn;\n    this.#config = {\n      customBridgeApiBaseUrl:\n        config?.customBridgeApiBaseUrl ?? BRIDGE_PROD_API_BASE_URL,\n    };\n    this.#trace = traceFn ?? (((_request, fn) => fn?.()) as TraceCallback);\n    this.#intentStatusManager = new IntentStatusManager({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n    });\n\n    // Register action handlers\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:startPollingForBridgeTxStatus`,\n      this.startPollingForBridgeTxStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:wipeBridgeStatus`,\n      this.wipeBridgeStatus.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:resetState`,\n      this.resetState.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitTx`,\n      this.submitTx.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:submitIntent`,\n      this.submitIntent.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:restartPollingForFailedAttempts`,\n      this.restartPollingForFailedAttempts.bind(this),\n    );\n    this.messenger.registerActionHandler(\n      `${BRIDGE_STATUS_CONTROLLER_NAME}:getBridgeHistoryItemByTxMetaId`,\n      this.getBridgeHistoryItemByTxMetaId.bind(this),\n    );\n\n    // Set interval\n    this.setIntervalLength(REFRESH_INTERVAL_MS);\n\n    this.messenger.subscribe(\n      'TransactionController:transactionFailed',\n      ({ transactionMeta }) => {\n        const { type, status, id: txMetaId, actionId } = transactionMeta;\n\n        if (\n          type &&\n          [\n            TransactionType.bridge,\n            TransactionType.swap,\n            TransactionType.bridgeApproval,\n            TransactionType.swapApproval,\n          ].includes(type) &&\n          [\n            TransactionStatus.failed,\n            TransactionStatus.dropped,\n            TransactionStatus.rejected,\n          ].includes(status)\n        ) {\n          // Mark tx as failed in txHistory\n          this.#markTxAsFailed(transactionMeta);\n          // Track failed event\n          if (status !== TransactionStatus.rejected) {\n            // Look up history by txMetaId first, then by actionId (for pre-submission failures)\n            let historyKey: string | undefined;\n            if (this.state.txHistory[txMetaId]) {\n              historyKey = txMetaId;\n            } else if (actionId && this.state.txHistory[actionId]) {\n              historyKey = actionId;\n            }\n\n            this.#trackUnifiedSwapBridgeEvent(\n              UnifiedSwapBridgeEventName.Failed,\n              historyKey ?? txMetaId,\n              getEVMTxPropertiesFromTransactionMeta(transactionMeta),\n            );\n          }\n        }\n      },\n    );\n\n    this.messenger.subscribe(\n      'TransactionController:transactionConfirmed',\n      (transactionMeta) => {\n        const { type, id: txMetaId, chainId } = transactionMeta;\n        if (type === TransactionType.swap) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMetaId,\n          );\n        }\n        if (type === TransactionType.bridge && !isNonEvmChainId(chainId)) {\n          this.#startPollingForTxId(txMetaId);\n        }\n      },\n    );\n\n    // If you close the extension, but keep the browser open, the polling continues\n    // If you close the browser, the polling stops\n    // Check for historyItems that do not have a status of complete and restart polling\n    this.#restartPollingForIncompleteHistoryItems();\n  }\n\n  // Mark tx as failed in txHistory if either the approval or trade fails\n  readonly #markTxAsFailed = ({\n    id: txMetaId,\n    actionId,\n  }: TransactionMeta): void => {\n    // Look up by txMetaId first\n    let txHistoryKey: string | undefined = this.state.txHistory[txMetaId]\n      ? txMetaId\n      : undefined;\n\n    // If not found by txMetaId, try looking up by actionId (for pre-submission failures)\n    if (!txHistoryKey && actionId && this.state.txHistory[actionId]) {\n      txHistoryKey = actionId;\n    }\n\n    // If still not found, try looking up by approvalTxId\n    txHistoryKey ??= Object.keys(this.state.txHistory).find(\n      (key) => this.state.txHistory[key].approvalTxId === txMetaId,\n    );\n\n    if (!txHistoryKey) {\n      return;\n    }\n    const key = txHistoryKey;\n    this.update((statusState) => {\n      statusState.txHistory[key].status.status = StatusTypes.FAILED;\n    });\n  };\n\n  resetState = (): void => {\n    this.update((state) => {\n      state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n    });\n  };\n\n  wipeBridgeStatus = ({\n    address,\n    ignoreNetwork,\n  }: {\n    address: string;\n    ignoreNetwork: boolean;\n  }): void => {\n    // Wipe all networks for this address\n    if (ignoreNetwork) {\n      this.update((state) => {\n        state.txHistory = DEFAULT_BRIDGE_STATUS_CONTROLLER_STATE.txHistory;\n      });\n    } else {\n      const { selectedNetworkClientId } = this.messenger.call(\n        'NetworkController:getState',\n      );\n      const selectedNetworkClient = this.messenger.call(\n        'NetworkController:getNetworkClientById',\n        selectedNetworkClientId,\n      );\n      const selectedChainId = selectedNetworkClient.configuration.chainId;\n\n      this.#wipeBridgeStatusByChainId(address, selectedChainId);\n    }\n  };\n\n  /**\n   * Resets the attempts counter for a bridge transaction history item\n   * and restarts polling if it was previously stopped due to max attempts\n   *\n   * @param identifier - Object containing either txMetaId or txHash to identify the history item\n   * @param identifier.txMetaId - The transaction meta ID\n   * @param identifier.txHash - The transaction hash\n   */\n  restartPollingForFailedAttempts = (identifier: {\n    txMetaId?: string;\n    txHash?: string;\n  }): void => {\n    const { txMetaId, txHash } = identifier;\n\n    if (!txMetaId && !txHash) {\n      throw new Error('Either txMetaId or txHash must be provided');\n    }\n\n    // Find the history item by txMetaId or txHash\n    let targetTxMetaId: string | undefined;\n\n    if (txMetaId) {\n      // Direct lookup by txMetaId\n      if (this.state.txHistory[txMetaId]) {\n        targetTxMetaId = txMetaId;\n      }\n    } else if (txHash) {\n      // Search by txHash in status.srcChain.txHash\n      targetTxMetaId = Object.keys(this.state.txHistory).find(\n        (id) => this.state.txHistory[id].status.srcChain.txHash === txHash,\n      );\n    }\n\n    if (!targetTxMetaId) {\n      throw new Error(\n        `No bridge transaction history found for ${\n          txMetaId ? `txMetaId: ${txMetaId}` : `txHash: ${txHash}`\n        }`,\n      );\n    }\n\n    const historyItem = this.state.txHistory[targetTxMetaId];\n\n    // Capture attempts count before resetting for metrics\n    const previousAttempts = historyItem.attempts?.counter ?? 0;\n\n    // Reset the attempts counter\n    this.update((state) => {\n      if (targetTxMetaId) {\n        state.txHistory[targetTxMetaId].attempts = undefined;\n      }\n    });\n\n    // Restart polling if it was stopped and this tx still needs status updates\n    if (this.#shouldPollHistoryItem(historyItem)) {\n      // Check if polling was stopped (no active polling token)\n      const existingPollingToken =\n        this.#pollingTokensByTxMetaId[targetTxMetaId];\n\n      if (!existingPollingToken) {\n        // Restart polling\n        this.#startPollingForTxId(targetTxMetaId);\n\n        // Track polling manually restarted event\n        if (!historyItem.featureId) {\n          const selectedAccount = this.messenger.call(\n            'AccountsController:getAccountByAddress',\n            historyItem.account,\n          );\n          const requestParams = getRequestParamFromHistory(historyItem);\n          const requestMetadata = getRequestMetadataFromHistory(\n            historyItem,\n            selectedAccount,\n          );\n          const { security_warnings: _, ...metadataWithoutWarnings } =\n            requestMetadata;\n\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.PollingStatusUpdated,\n            targetTxMetaId,\n            {\n              ...getTradeDataFromHistory(historyItem),\n              ...getPriceImpactFromQuote(historyItem.quote),\n              ...metadataWithoutWarnings,\n              chain_id_source: requestParams.chain_id_source,\n              chain_id_destination: requestParams.chain_id_destination,\n              token_symbol_source: requestParams.token_symbol_source,\n              token_symbol_destination: requestParams.token_symbol_destination,\n              action_type: MetricsActionType.SWAPBRIDGE_V1,\n              polling_status: PollingStatus.ManuallyRestarted,\n              retry_attempts: previousAttempts,\n            },\n          );\n        }\n      }\n    }\n  };\n\n  /**\n   * Gets a bridge history item from the history by its transaction meta ID\n   *\n   * @param txMetaId - The transaction meta ID to look up\n   * @returns The bridge history item if found, undefined otherwise\n   */\n  getBridgeHistoryItemByTxMetaId = (\n    txMetaId: string,\n  ): BridgeHistoryItem | undefined => {\n    return this.state.txHistory[txMetaId];\n  };\n\n  /**\n   * Restart polling for txs that are not in a final state\n   * This is called during initialization\n   */\n  readonly #restartPollingForIncompleteHistoryItems = (): void => {\n    // Check for historyItems that do not have a status of complete and restart polling\n    const { txHistory } = this.state;\n    const historyItems = Object.values(txHistory);\n    const incompleteHistoryItems = historyItems\n      .filter(\n        (historyItem) =>\n          historyItem.status.status === StatusTypes.PENDING ||\n          historyItem.status.status === StatusTypes.UNKNOWN,\n      )\n      // Only poll items with txMetaId (post-submission items)\n      .filter(\n        (\n          historyItem,\n        ): historyItem is BridgeHistoryItem & { txMetaId: string } =>\n          Boolean(historyItem.txMetaId),\n      )\n      .filter((historyItem) => {\n        // Check if we are already polling this tx, if so, skip restarting polling for that\n        const pollingToken =\n          this.#pollingTokensByTxMetaId[historyItem.txMetaId];\n        return !pollingToken;\n      })\n      // Only restart polling for items that still require status updates\n      .filter((historyItem) => {\n        return this.#shouldPollHistoryItem(historyItem);\n      });\n\n    incompleteHistoryItems.forEach((historyItem) => {\n      const bridgeTxMetaId = historyItem.txMetaId;\n      const shouldSkipFetch = shouldSkipFetchDueToFetchFailures(\n        historyItem.attempts,\n      );\n      if (shouldSkipFetch) {\n        return;\n      }\n\n      // We manually call startPolling() here rather than go through startPollingForBridgeTxStatus()\n      // because we don't want to overwrite the existing historyItem in state\n      this.#startPollingForTxId(bridgeTxMetaId);\n    });\n  };\n\n  readonly #addTxToHistory = (\n    startPollingForBridgeTxStatusArgs: StartPollingForBridgeTxStatusArgsSerialized,\n    actionId?: string,\n  ): void => {\n    const {\n      bridgeTxMeta,\n      statusRequest,\n      quoteResponse,\n      startTime,\n      slippagePercentage,\n      initialDestAssetBalance,\n      targetContractAddress,\n      approvalTxId,\n      isStxEnabled,\n      location,\n      abTests,\n      accountAddress: selectedAddress,\n    } = startPollingForBridgeTxStatusArgs;\n\n    // Determine the key for this history item:\n    // - For pre-submission (non-batch EVM): use actionId\n    // - For post-submission or other cases: use bridgeTxMeta.id\n    const historyKey = getHistoryKey(actionId, bridgeTxMeta?.id);\n\n    // Write all non-status fields to state so we can reference the quote in Activity list without the Bridge API\n    // We know it's in progress but not the exact status yet\n    const txHistoryItem: BridgeHistoryItem = {\n      txMetaId: bridgeTxMeta?.id,\n      actionId,\n      originalTransactionId:\n        (bridgeTxMeta as unknown as { originalTransactionId: string })\n          ?.originalTransactionId || bridgeTxMeta?.id, // Keep original for intent transactions\n      batchId: bridgeTxMeta?.batchId,\n      quote: quoteResponse.quote,\n      startTime,\n      estimatedProcessingTimeInSeconds:\n        quoteResponse.estimatedProcessingTimeInSeconds,\n      slippagePercentage,\n      pricingData: {\n        amountSent: quoteResponse.sentAmount?.amount ?? '0',\n        amountSentInUsd: quoteResponse.sentAmount?.usd ?? undefined,\n        quotedGasInUsd: quoteResponse.gasFee?.effective?.usd ?? undefined,\n        quotedReturnInUsd: quoteResponse.toTokenAmount?.usd ?? undefined,\n        quotedGasAmount: quoteResponse.gasFee?.effective?.amount ?? undefined,\n      },\n      initialDestAssetBalance,\n      targetContractAddress,\n      account: selectedAddress,\n      status: {\n        // We always have a PENDING status when we start polling for a tx, don't need the Bridge API for that\n        // Also we know the bare minimum fields for status at this point in time\n        status: StatusTypes.PENDING,\n        srcChain: {\n          chainId: statusRequest.srcChainId,\n          txHash: statusRequest.srcTxHash,\n        },\n      },\n      hasApprovalTx: Boolean(quoteResponse.approval),\n      approvalTxId,\n      isStxEnabled: isStxEnabled ?? false,\n      featureId: quoteResponse.featureId,\n      location,\n      ...(abTests && { abTests }),\n    };\n    this.update((state) => {\n      // Use actionId as key for pre-submission, or txMeta.id for post-submission\n      state.txHistory[historyKey] = txHistoryItem;\n    });\n  };\n\n  /**\n   * Rekeys a history item from actionId to txMeta.id after successful submission.\n   * Also updates txMetaId and srcTxHash which weren't available pre-submission.\n   *\n   * @param actionId - The actionId used as the temporary key for the history item\n   * @param txMeta - The transaction meta from the successful submission\n   * @param txMeta.id - The transaction meta id to use as the new key\n   * @param txMeta.hash - The transaction hash to set on the history item\n   */\n  readonly #rekeyHistoryItem = (\n    actionId: string,\n    txMeta: { id: string; hash?: string },\n  ): void => {\n    this.update((state) => {\n      rekeyHistoryItemInState(state, actionId, txMeta);\n    });\n  };\n\n  readonly #startPollingForTxId = (txId: string): void => {\n    // If we are already polling for this tx, stop polling for it before restarting\n    const existingPollingToken = this.#pollingTokensByTxMetaId[txId];\n    if (existingPollingToken) {\n      this.stopPollingByPollingToken(existingPollingToken);\n    }\n\n    const txHistoryItem = this.state.txHistory[txId];\n    if (!txHistoryItem) {\n      return;\n    }\n    if (this.#shouldPollHistoryItem(txHistoryItem)) {\n      this.#pollingTokensByTxMetaId[txId] = this.startPolling({\n        bridgeTxMetaId: txId,\n      });\n    }\n  };\n\n  readonly #shouldPollHistoryItem = (\n    historyItem: BridgeHistoryItem,\n  ): boolean => {\n    const isIntent = Boolean(historyItem?.quote?.intent);\n    const isBridgeTx = isCrossChain(\n      historyItem.quote.srcChainId,\n      historyItem.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(historyItem.quote.srcChainId);\n\n    return [isBridgeTx, isIntent, isTronTx].some(Boolean);\n  };\n\n  /**\n   * @deprecated For EVM/Solana swap/bridge txs we add tx to history in submitTx()\n   * For Solana swap/bridge we start polling in submitTx()\n   * For EVM bridge we listen for 'TransactionController:transactionConfirmed' and start polling there\n   * No clients currently call this, safe to remove in future versions\n   *\n   * Adds tx to history and starts polling for the bridge tx status\n   *\n   * @param txHistoryMeta - The parameters for creating the history item\n   */\n  startPollingForBridgeTxStatus = (\n    txHistoryMeta: StartPollingForBridgeTxStatusArgsSerialized,\n  ): void => {\n    const { bridgeTxMeta } = txHistoryMeta;\n\n    if (!bridgeTxMeta?.id) {\n      throw new Error(\n        'Cannot start polling: bridgeTxMeta.id is required for polling',\n      );\n    }\n\n    this.#addTxToHistory(txHistoryMeta);\n    this.#startPollingForTxId(bridgeTxMeta.id);\n  };\n\n  // This will be called after you call this.startPolling()\n  // The args passed in are the args you passed in to startPolling()\n  _executePoll = async (\n    pollingInput: BridgeStatusPollingInput,\n  ): Promise<void> => {\n    await this.#fetchBridgeTxStatus(pollingInput);\n  };\n\n  #getMultichainSelectedAccount(\n    accountAddress: string,\n  ):\n    | AccountsControllerState['internalAccounts']['accounts'][string]\n    | undefined {\n    return this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      accountAddress,\n    );\n  }\n\n  /**\n   * Handles the failure to fetch the bridge tx status\n   * We eventually stop polling for the tx if we fail too many times\n   * Failures (500 errors) can be due to:\n   * - The srcTxHash not being available immediately for STX\n   * - The srcTxHash being invalid for the chain. This case will never resolve so we stop polling for it to avoid hammering the Bridge API forever.\n   *\n   * @param bridgeTxMetaId - The txMetaId of the bridge tx\n   */\n  readonly #handleFetchFailure = (bridgeTxMetaId: string): void => {\n    const { attempts } = this.state.txHistory[bridgeTxMetaId];\n\n    const newAttempts = attempts\n      ? {\n          counter: attempts.counter + 1,\n          lastAttemptTime: Date.now(),\n        }\n      : {\n          counter: 1,\n          lastAttemptTime: Date.now(),\n        };\n\n    // If we've failed too many times, stop polling for the tx\n    const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n    if (newAttempts.counter >= MAX_ATTEMPTS && pollingToken) {\n      this.stopPollingByPollingToken(pollingToken);\n      delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      // Track max polling reached event\n      const historyItem = this.state.txHistory[bridgeTxMetaId];\n      if (historyItem && !historyItem.featureId) {\n        const selectedAccount = this.messenger.call(\n          'AccountsController:getAccountByAddress',\n          historyItem.account,\n        );\n        const requestParams = getRequestParamFromHistory(historyItem);\n        const requestMetadata = getRequestMetadataFromHistory(\n          historyItem,\n          selectedAccount,\n        );\n        const { security_warnings: _, ...metadataWithoutWarnings } =\n          requestMetadata;\n\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.PollingStatusUpdated,\n          bridgeTxMetaId,\n          {\n            ...getTradeDataFromHistory(historyItem),\n            ...getPriceImpactFromQuote(historyItem.quote),\n            ...metadataWithoutWarnings,\n            chain_id_source: requestParams.chain_id_source,\n            chain_id_destination: requestParams.chain_id_destination,\n            token_symbol_source: requestParams.token_symbol_source,\n            token_symbol_destination: requestParams.token_symbol_destination,\n            action_type: MetricsActionType.SWAPBRIDGE_V1,\n            polling_status: PollingStatus.MaxPollingReached,\n            retry_attempts: newAttempts.counter,\n          },\n        );\n      }\n    }\n\n    // Update the attempts counter\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].attempts = newAttempts;\n    });\n  };\n\n  readonly #fetchBridgeTxStatus = async ({\n    bridgeTxMetaId,\n  }: FetchBridgeTxStatusArgs): Promise<void> => {\n    // 1. Check for history item\n\n    const { txHistory } = this.state;\n    const historyItem = txHistory[bridgeTxMetaId];\n    if (!historyItem) {\n      return;\n    }\n\n    // 2. Check for previous failures\n\n    if (shouldSkipFetchDueToFetchFailures(historyItem.attempts)) {\n      return;\n    }\n\n    // 3. Fetch transcation status\n\n    try {\n      let status: BridgeHistoryItem['status'];\n      let validationFailures: string[] = [];\n      let intentTranslation: IntentStatusTranslation | null = null;\n      let intentOrderStatus: string | undefined;\n\n      const isIntent = Boolean(historyItem.quote.intent);\n\n      if (isIntent) {\n        const { srcChainId } = historyItem.quote;\n\n        const intentApi = new IntentApiImpl(\n          this.#config.customBridgeApiBaseUrl,\n          this.#fetchFn,\n        );\n        const intentOrder = await intentApi.getOrderStatus(\n          bridgeTxMetaId,\n          historyItem.quote.intent?.protocol ?? '',\n          srcChainId.toString(),\n          this.#clientId,\n          await this.#getJwt(),\n        );\n\n        intentOrderStatus = intentOrder.status;\n        intentTranslation = translateIntentOrderToBridgeStatus(\n          intentOrder,\n          srcChainId,\n          historyItem.status.srcChain.txHash,\n        );\n        status = intentTranslation.status;\n      } else {\n        // We try here because we receive 500 errors from Bridge API if we try to fetch immediately after submitting the source tx\n        // Oddly mostly happens on Optimism, never on Arbitrum. By the 2nd fetch, the Bridge API responds properly.\n        // Also srcTxHash may not be available immediately for STX, so we don't want to fetch in those cases\n        const srcTxHash = this.#getSrcTxHash(bridgeTxMetaId);\n        if (!srcTxHash) {\n          return;\n        }\n\n        this.#updateSrcTxHash(bridgeTxMetaId, srcTxHash);\n\n        const statusRequest = getStatusRequestWithSrcTxHash(\n          historyItem.quote,\n          srcTxHash,\n        );\n        const response = await fetchBridgeTxStatus(\n          statusRequest,\n          this.#clientId,\n          await this.#getJwt(),\n          this.#fetchFn,\n          this.#config.customBridgeApiBaseUrl,\n        );\n        status = response.status;\n        validationFailures = response.validationFailures;\n      }\n\n      if (validationFailures.length > 0) {\n        this.#trackUnifiedSwapBridgeEvent(\n          UnifiedSwapBridgeEventName.StatusValidationFailed,\n          bridgeTxMetaId,\n          {\n            failures: validationFailures,\n            refresh_count: historyItem.attempts?.counter ?? 0,\n          },\n        );\n        throw new Error(\n          `Bridge status validation failed: ${validationFailures.join(', ')}`,\n        );\n      }\n\n      // 4. Create bridge history item\n\n      const newBridgeHistoryItem = {\n        ...historyItem,\n        status,\n        completionTime:\n          status.status === StatusTypes.COMPLETE ||\n          status.status === StatusTypes.FAILED\n            ? Date.now()\n            : undefined, // TODO make this more accurate by looking up dest txHash block time\n        attempts: undefined,\n      };\n\n      // No need to purge these on network change or account change, TransactionController does not purge either.\n      // TODO In theory we can skip checking status if it's not the current account/network\n      // we need to keep track of the account that this is associated with as well so that we don't show it in Activity list for other accounts\n      // First stab at this will not stop polling when you are on a different account\n      this.update((state) => {\n        state.txHistory[bridgeTxMetaId] = newBridgeHistoryItem;\n      });\n\n      if (isIntent && intentTranslation && intentOrderStatus) {\n        this.#intentStatusManager.syncTransactionFromIntentStatus(\n          bridgeTxMetaId,\n          historyItem,\n          intentTranslation,\n          intentOrderStatus,\n        );\n      }\n\n      // 5. After effects\n\n      const pollingToken = this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n      const isFinalStatus =\n        status.status === StatusTypes.COMPLETE ||\n        status.status === StatusTypes.FAILED;\n\n      if (isFinalStatus && pollingToken) {\n        this.stopPollingByPollingToken(pollingToken);\n        delete this.#pollingTokensByTxMetaId[bridgeTxMetaId];\n\n        // Skip tracking events when featureId is set (i.e. PERPS)\n        if (historyItem.featureId) {\n          return;\n        }\n\n        if (status.status === StatusTypes.COMPLETE) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            bridgeTxMetaId,\n          );\n          this.messenger.publish(\n            'BridgeStatusController:destinationTransactionCompleted',\n            historyItem.quote.destAsset.assetId,\n          );\n        }\n        if (status.status === StatusTypes.FAILED) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Failed,\n            bridgeTxMetaId,\n          );\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to fetch bridge tx status', error);\n      this.#handleFetchFailure(bridgeTxMetaId);\n    }\n  };\n\n  readonly #getJwt = async (): Promise<string | undefined> => {\n    try {\n      const token = await this.messenger.call(\n        'AuthenticationController:getBearerToken',\n      );\n      return token;\n    } catch (error) {\n      console.error('Error getting JWT token for bridge-api request', error);\n      return undefined;\n    }\n  };\n\n  readonly #getSrcTxHash = (bridgeTxMetaId: string): string | undefined => {\n    const { txHistory } = this.state;\n    // Prefer the srcTxHash from bridgeStatusState so we don't have to l ook up in TransactionController\n    // But it is possible to have bridgeHistoryItem in state without the srcTxHash yet when it is an STX\n    const srcTxHash = txHistory[bridgeTxMetaId].status.srcChain.txHash;\n\n    if (srcTxHash) {\n      return srcTxHash;\n    }\n\n    // Look up in TransactionController if txMeta has been updated with the srcTxHash\n    const txControllerState = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = txControllerState.transactions.find(\n      (tx: TransactionMeta) => tx.id === bridgeTxMetaId,\n    );\n    return txMeta?.hash;\n  };\n\n  readonly #updateSrcTxHash = (\n    bridgeTxMetaId: string,\n    srcTxHash: string,\n  ): void => {\n    const { txHistory } = this.state;\n    if (txHistory[bridgeTxMetaId].status.srcChain.txHash) {\n      return;\n    }\n\n    this.update((state) => {\n      state.txHistory[bridgeTxMetaId].status.srcChain.txHash = srcTxHash;\n    });\n  };\n\n  // Wipes the bridge status for the given address and chainId\n  // Will match only source chainId to the selectedChainId\n  readonly #wipeBridgeStatusByChainId = (\n    address: string,\n    selectedChainId: Hex,\n  ): void => {\n    const sourceTxMetaIdsToDelete = Object.keys(this.state.txHistory).filter(\n      (txMetaId) => {\n        const bridgeHistoryItem = this.state.txHistory[txMetaId];\n\n        const hexSourceChainId = numberToHex(\n          bridgeHistoryItem.quote.srcChainId,\n        );\n\n        return (\n          bridgeHistoryItem.account === address &&\n          hexSourceChainId === selectedChainId\n        );\n      },\n    );\n\n    sourceTxMetaIdsToDelete.forEach((sourceTxMetaId) => {\n      const pollingToken = this.#pollingTokensByTxMetaId[sourceTxMetaId];\n\n      if (pollingToken) {\n        this.stopPollingByPollingToken(\n          this.#pollingTokensByTxMetaId[sourceTxMetaId],\n        );\n      }\n    });\n\n    this.update((state) => {\n      state.txHistory = sourceTxMetaIdsToDelete.reduce(\n        (acc, sourceTxMetaId) => {\n          delete acc[sourceTxMetaId];\n          return acc;\n        },\n        state.txHistory,\n      );\n    });\n  };\n\n  /**\n   * ******************************************************\n   * TX SUBMISSION HANDLING\n   *******************************************************\n   */\n\n  /**\n   * Submits the transaction to the snap using the new unified ClientRequest interface\n   * Works for all non-EVM chains (Solana, BTC, Tron)\n   * This adds an approval tx to the ApprovalsController in the background\n   * The client needs to handle the approval tx by redirecting to the confirmation page with the approvalTxId in the URL\n   *\n   * @param trade - The trade data (can be approval or main trade)\n   * @param quoteResponse - The quote response containing metadata\n   * @param selectedAccount - The account to submit the transaction for\n   * @returns The transaction meta\n   */\n  readonly #handleNonEvmTx = async (\n    trade: Trade,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    selectedAccount: AccountsControllerState['internalAccounts']['accounts'][string],\n  ): Promise<TransactionMeta> => {\n    if (!selectedAccount.metadata?.snap?.id) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined snap id',\n      );\n    }\n\n    const request = getClientRequest(\n      trade,\n      quoteResponse.quote.srcChainId,\n      selectedAccount,\n    );\n    const requestResponse = (await this.messenger.call(\n      'SnapController:handleRequest',\n      request,\n    )) as\n      | string\n      | { transactionId: string }\n      | { result: Record<string, string> }\n      | { signature: string };\n\n    // Create quote response with the specified trade\n    // This allows the same method to handle both approvals and main trades\n    const txQuoteResponse: QuoteResponse<Trade> & QuoteMetadata = {\n      ...quoteResponse,\n      trade,\n    };\n\n    const txMeta = handleNonEvmTxResponse(\n      requestResponse,\n      txQuoteResponse,\n      selectedAccount,\n    );\n\n    // TODO remove this eventually, just returning it now to match extension behavior\n    // OR if the snap can propagate the snapRequestId or keyringReqId to the ApprovalsController, this can return the approvalTxId instead and clients won't need to subscribe to the ApprovalsController state to redirect\n    return txMeta;\n  };\n\n  readonly #waitForHashAndReturnFinalTxMeta = async (\n    hashPromise?: Awaited<\n      ReturnType<TransactionController['addTransaction']>\n    >['result'],\n  ): Promise<TransactionMeta> => {\n    const transactionHash = await hashPromise;\n    const finalTransactionMeta: TransactionMeta | undefined = this.messenger\n      .call('TransactionController:getState')\n      .transactions.find((tx: TransactionMeta) => tx.hash === transactionHash);\n    if (!finalTransactionMeta) {\n      throw new Error(\n        'Failed to submit cross-chain swap tx: txMeta for txHash was not found',\n      );\n    }\n    return finalTransactionMeta;\n  };\n\n  // Waits until a given transaction (by id) reaches confirmed/finalized status or fails/times out.\n  readonly #waitForTxConfirmation = async (\n    txId: string,\n    {\n      timeoutMs = 5 * 60_000, // 5 minutes default\n      pollMs = 3_000,\n    }: { timeoutMs?: number; pollMs?: number } = {},\n  ): Promise<TransactionMeta> => {\n    return await waitForTxConfirmation(this.messenger, txId, {\n      timeoutMs,\n      pollMs,\n    });\n  };\n\n  readonly #handleApprovalTx = async (\n    isBridgeTx: boolean,\n    srcChainId: QuoteResponse['quote']['srcChainId'],\n    approval?: TxData,\n    resetApproval?: TxData,\n    requireApproval?: boolean,\n  ): Promise<TransactionMeta | undefined> => {\n    if (approval) {\n      const approveTx = async (): Promise<TransactionMeta> => {\n        await this.#handleUSDTAllowanceReset(resetApproval);\n\n        const approvalTxMeta = await this.#handleEvmTransaction({\n          transactionType: isBridgeTx\n            ? TransactionType.bridgeApproval\n            : TransactionType.swapApproval,\n          trade: approval,\n          requireApproval,\n        });\n\n        await handleApprovalDelay(srcChainId);\n        return approvalTxMeta;\n      };\n\n      return await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionApprovalCompleted\n            : TraceName.SwapTransactionApprovalCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(srcChainId),\n            stxEnabled: false,\n          },\n        },\n        approveTx,\n      );\n    }\n\n    return undefined;\n  };\n\n  /**\n   * Submits an EVM transaction to the TransactionController\n   *\n   * @param params - The parameters for the transaction\n   * @param params.transactionType - The type of transaction to submit\n   * @param params.trade - The trade data to confirm\n   * @param params.requireApproval - Whether to require approval for the transaction\n   * @param params.txFee - Optional gas fee parameters from the quote (used when gasIncluded is true)\n   * @param params.txFee.maxFeePerGas - The maximum fee per gas from the quote\n   * @param params.txFee.maxPriorityFeePerGas - The maximum priority fee per gas from the quote\n   * @param params.actionId - Optional actionId for pre-submission history (if not provided, one is generated)\n   * @returns The transaction meta\n   */\n  readonly #handleEvmTransaction = async ({\n    transactionType,\n    trade,\n    requireApproval = false,\n    txFee,\n    actionId: providedActionId,\n  }: {\n    transactionType: TransactionType;\n    trade: TxData;\n    requireApproval?: boolean;\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string };\n    actionId?: string;\n  }): Promise<TransactionMeta> => {\n    // Use provided actionId (for pre-submission history) or generate one\n    const actionId = providedActionId ?? generateActionId().toString();\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      trade.from,\n    );\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: unknown account in trade data',\n      );\n    }\n    const hexChainId = formatChainIdToHex(trade.chainId);\n    const networkClientId = this.messenger.call(\n      'NetworkController:findNetworkClientIdByChainId',\n      hexChainId,\n    );\n\n    const requestOptions = {\n      actionId,\n      networkClientId,\n      requireApproval,\n      type: transactionType,\n      origin: 'metamask',\n    };\n    // Exclude gasLimit from trade to avoid type issues (it can be null)\n    const { gasLimit: tradeGasLimit, ...tradeWithoutGasLimit } = trade;\n\n    const transactionParams: Parameters<\n      TransactionController['addTransaction']\n    >[0] = {\n      ...tradeWithoutGasLimit,\n      chainId: hexChainId,\n      // Only add gasLimit and gas if they're valid (not undefined/null/zero)\n      ...(tradeGasLimit &&\n        tradeGasLimit !== 0 && {\n          gasLimit: tradeGasLimit.toString(),\n          gas: tradeGasLimit.toString(),\n        }),\n    };\n    const transactionParamsWithMaxGas: TransactionParams = {\n      ...transactionParams,\n      ...(await this.#calculateGasFees(\n        transactionParams,\n        networkClientId,\n        hexChainId,\n        txFee,\n      )),\n    };\n\n    const { result } = await this.#addTransactionFn(\n      transactionParamsWithMaxGas,\n      requestOptions,\n    );\n\n    return await this.#waitForHashAndReturnFinalTxMeta(result);\n  };\n\n  readonly #handleUSDTAllowanceReset = async (\n    resetApproval?: TxData,\n  ): Promise<void> => {\n    if (resetApproval) {\n      await this.#handleEvmTransaction({\n        transactionType: TransactionType.bridgeApproval,\n        trade: resetApproval,\n      });\n    }\n  };\n\n  readonly #calculateGasFees = async (\n    transactionParams: TransactionParams,\n    networkClientId: string,\n    chainId: Hex,\n    txFee?: { maxFeePerGas: string; maxPriorityFeePerGas: string },\n  ): Promise<{\n    maxFeePerGas: Hex;\n    maxPriorityFeePerGas: Hex;\n    gas?: Hex;\n  }> => {\n    const { gas } = transactionParams;\n    // If txFee is provided (gasIncluded case), use the quote's gas fees\n    // Convert to hex since txFee values from the quote are decimal strings\n    if (txFee) {\n      return {\n        maxFeePerGas: toHex(txFee.maxFeePerGas ?? 0),\n        maxPriorityFeePerGas: toHex(txFee.maxPriorityFeePerGas ?? 0),\n        gas: gas ? toHex(gas) : undefined,\n      };\n    }\n\n    const { gasFeeEstimates } = this.messenger.call(\n      'GasFeeController:getState',\n    );\n    const { estimates: txGasFeeEstimates } = await this.#estimateGasFeeFn({\n      transactionParams,\n      chainId,\n      networkClientId,\n    });\n    const { maxFeePerGas, maxPriorityFeePerGas } = getTxGasEstimates({\n      networkGasFeeEstimates: gasFeeEstimates,\n      txGasFeeEstimates,\n    });\n\n    return {\n      maxFeePerGas,\n      maxPriorityFeePerGas,\n      gas: gas ? toHex(gas) : undefined,\n    };\n  };\n\n  /**\n   * Submits batched EVM transactions to the TransactionController\n   *\n   * @param args - The parameters for the transaction\n   * @param args.isBridgeTx - Whether the transaction is a bridge transaction\n   * @param args.trade - The trade data to confirm\n   * @param args.approval - The approval data to confirm\n   * @param args.resetApproval - The ethereum:USDT reset approval data to confirm\n   * @param args.quoteResponse - The quote response\n   * @param args.requireApproval - Whether to require approval for the transaction\n   * @returns The approvalMeta and tradeMeta for the batched transaction\n   */\n  readonly #handleEvmTransactionBatch = async (\n    args: Omit<\n      Parameters<typeof getAddTransactionBatchParams>[0],\n      'messenger' | 'estimateGasFeeFn'\n    >,\n  ): Promise<{\n    approvalMeta?: TransactionMeta;\n    tradeMeta: TransactionMeta;\n  }> => {\n    const transactionParams = await getAddTransactionBatchParams({\n      messenger: this.messenger,\n      estimateGasFeeFn: this.#estimateGasFeeFn,\n      ...args,\n    });\n    const txDataByType = {\n      [TransactionType.bridgeApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridgeApproval,\n      )?.params.data,\n      [TransactionType.swapApproval]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swapApproval,\n      )?.params.data,\n      [TransactionType.bridge]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.bridge,\n      )?.params.data,\n      [TransactionType.swap]: transactionParams.transactions.find(\n        ({ type }) => type === TransactionType.swap,\n      )?.params.data,\n    };\n\n    const { batchId } = await this.#addTransactionBatchFn(transactionParams);\n\n    const { approvalMeta, tradeMeta } = findAndUpdateTransactionsInBatch({\n      messenger: this.messenger,\n      updateTransactionFn: this.#updateTransactionFn,\n      batchId,\n      txDataByType,\n    });\n\n    if (!tradeMeta) {\n      throw new Error(\n        'Failed to update cross-chain swap transaction batch: tradeMeta not found',\n      );\n    }\n\n    return { approvalMeta, tradeMeta };\n  };\n\n  /**\n   * Submits a cross-chain swap transaction\n   *\n   * @param accountAddress - The address of the account to submit the transaction for\n   * @param quoteResponse - The quote response\n   * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n   * @param quotesReceivedContext - The context for the QuotesReceived event\n   * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n   * @param abTests - A/B test context to attribute events to specific experiments\n   * @returns The transaction meta\n   */\n  submitTx = async (\n    accountAddress: string,\n    quoteResponse: QuoteResponse<Trade, Trade> & QuoteMetadata,\n    isStxEnabledOnClient: boolean,\n    quotesReceivedContext?: RequiredEventContextFromClient[UnifiedSwapBridgeEventName.QuotesReceived],\n    location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n    abTests?: Record<string, string>,\n  ): Promise<TransactionMeta & Partial<SolanaTransactionMeta>> => {\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n      // If trade is submitted before all quotes are loaded, the QuotesReceived event is published\n      // If the trade has a featureId, it means it was submitted outside of the Unified Swap and Bridge experience, so no QuotesReceived event is published\n      quoteResponse.featureId ? undefined : quotesReceivedContext,\n    );\n\n    const selectedAccount = this.#getMultichainSelectedAccount(accountAddress);\n    if (!selectedAccount) {\n      throw new Error(\n        'Failed to submit cross-chain swap transaction: undefined multichain account',\n      );\n    }\n    const isHardwareAccount = isHardwareWallet(selectedAccount);\n\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      isStxEnabledOnClient,\n      isHardwareAccount,\n      location,\n      abTests,\n    );\n    // Emit Submitted event after submit button is clicked\n    !quoteResponse.featureId &&\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Submitted,\n        undefined,\n        preConfirmationProperties,\n      );\n\n    let txMeta: TransactionMeta & Partial<SolanaTransactionMeta>;\n    let approvalTxId: string | undefined;\n    const startTime = Date.now();\n\n    const isBridgeTx = isCrossChain(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    );\n    const isTronTx = isTronChainId(quoteResponse.quote.srcChainId);\n\n    // Submit non-EVM tx (Solana, BTC, Tron)\n    if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n      // Handle non-EVM approval if present (e.g., Tron token approvals)\n      if (quoteResponse.approval && isTronTrade(quoteResponse.approval)) {\n        const approvalTxMeta = await this.#trace(\n          {\n            name: isBridgeTx\n              ? TraceName.BridgeTransactionApprovalCompleted\n              : TraceName.SwapTransactionApprovalCompleted,\n            data: {\n              srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n              stxEnabled: false,\n            },\n          },\n          async () => {\n            try {\n              return quoteResponse.approval &&\n                isTronTrade(quoteResponse.approval)\n                ? await this.#handleNonEvmTx(\n                    quoteResponse.approval,\n                    quoteResponse,\n                    selectedAccount,\n                  )\n                : undefined;\n            } catch (error) {\n              !quoteResponse.featureId &&\n                this.#trackUnifiedSwapBridgeEvent(\n                  UnifiedSwapBridgeEventName.Failed,\n                  undefined,\n                  {\n                    error_message: (error as Error)?.message,\n                    ...preConfirmationProperties,\n                  },\n                );\n              throw error;\n            }\n          },\n        );\n\n        approvalTxId = approvalTxMeta?.id;\n\n        // Add delay after approval similar to EVM flow\n        await handleApprovalDelay(quoteResponse.quote.srcChainId);\n      }\n\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: false,\n          },\n        },\n        async () => {\n          try {\n            if (\n              !(\n                isTronTrade(quoteResponse.trade) ||\n                isBitcoinTrade(quoteResponse.trade) ||\n                typeof quoteResponse.trade === 'string'\n              )\n            ) {\n              throw new Error(\n                'Failed to submit cross-chain swap transaction: trade is not a non-EVM transaction',\n              );\n            }\n            return await this.#handleNonEvmTx(\n              quoteResponse.trade,\n              quoteResponse,\n              selectedAccount,\n            );\n          } catch (error) {\n            !quoteResponse.featureId &&\n              this.#trackUnifiedSwapBridgeEvent(\n                UnifiedSwapBridgeEventName.Failed,\n                txMeta?.id,\n                {\n                  error_message: (error as Error)?.message,\n                  ...preConfirmationProperties,\n                },\n              );\n            throw error;\n          }\n        },\n      );\n    } else {\n      // Submit EVM tx\n      // For hardware wallets on Mobile, this is fixes an issue where the Ledger does not get prompted for the 2nd approval\n      // Extension does not have this issue\n      const requireApproval =\n        this.#clientId === BridgeClientId.MOBILE && isHardwareAccount;\n\n      // Handle smart transactions if enabled\n      txMeta = await this.#trace(\n        {\n          name: isBridgeTx\n            ? TraceName.BridgeTransactionCompleted\n            : TraceName.SwapTransactionCompleted,\n          data: {\n            srcChainId: formatChainIdToCaip(quoteResponse.quote.srcChainId),\n            stxEnabled: isStxEnabledOnClient,\n          },\n        },\n        async () => {\n          if (!isEvmTxData(quoteResponse.trade)) {\n            throw new Error(\n              'Failed to submit cross-chain swap transaction: trade is not an EVM transaction',\n            );\n          }\n          if (isStxEnabledOnClient || quoteResponse.quote.gasIncluded7702) {\n            const { tradeMeta, approvalMeta } =\n              await this.#handleEvmTransactionBatch({\n                isBridgeTx,\n                resetApproval: quoteResponse.resetApproval,\n                approval:\n                  quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n                    ? quoteResponse.approval\n                    : undefined,\n                trade: quoteResponse.trade,\n                quoteResponse,\n                requireApproval,\n              });\n\n            approvalTxId = approvalMeta?.id;\n            return tradeMeta;\n          }\n          // Set approval time and id if an approval tx is needed\n          const approvalTxMeta = await this.#handleApprovalTx(\n            isBridgeTx,\n            quoteResponse.quote.srcChainId,\n            quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n              ? quoteResponse.approval\n              : undefined,\n            quoteResponse.resetApproval,\n            requireApproval,\n          );\n\n          approvalTxId = approvalTxMeta?.id;\n\n          await handleMobileHardwareWalletDelay(requireApproval);\n\n          // Generate actionId for pre-submission history (non-batch EVM only)\n          const actionId = generateActionId().toString();\n\n          // Add pre-submission history keyed by actionId\n          // This ensures we have quote data available if transaction fails during submission\n          this.#addTxToHistory(\n            {\n              accountAddress: selectedAccount.address,\n              statusRequest: {\n                ...getStatusRequestParams(quoteResponse),\n                srcTxHash: '', // Not available yet\n              },\n              quoteResponse,\n              slippagePercentage: 0,\n              isStxEnabled: isStxEnabledOnClient,\n              startTime,\n              approvalTxId,\n              location,\n              abTests,\n            },\n            actionId,\n          );\n\n          // Pass txFee when gasIncluded is true to use the quote's gas fees\n          // instead of re-estimating (which would fail for max native token swaps)\n          const tradeTxMeta = await this.#handleEvmTransaction({\n            transactionType: isBridgeTx\n              ? TransactionType.bridge\n              : TransactionType.swap,\n            trade: quoteResponse.trade,\n            requireApproval,\n            txFee: quoteResponse.quote.gasIncluded\n              ? quoteResponse.quote.feeData.txFee\n              : undefined,\n            actionId,\n          });\n\n          // On success, rekey from actionId to txMeta.id and update srcTxHash\n          this.#rekeyHistoryItem(actionId, tradeTxMeta);\n\n          return tradeTxMeta;\n        },\n      );\n    }\n\n    try {\n      // For non-batch EVM transactions, history was already added/rekeyed above\n      // Only add history here for non-EVM and batch EVM transactions\n      const isNonBatchEvm =\n        !isNonEvmChainId(quoteResponse.quote.srcChainId) &&\n        !isStxEnabledOnClient &&\n        !quoteResponse.quote.gasIncluded7702;\n\n      if (!isNonBatchEvm) {\n        // Add swap or bridge tx to history\n        this.#addTxToHistory({\n          accountAddress: selectedAccount.address,\n          bridgeTxMeta: txMeta, // Only the id field is used by the BridgeStatusController\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: txMeta.hash,\n          },\n          quoteResponse,\n          slippagePercentage: 0, // TODO include slippage provided by quote if using dynamic slippage, or slippage from quote request\n          isStxEnabled: isStxEnabledOnClient,\n          startTime,\n          approvalTxId,\n          location,\n          abTests,\n        });\n      }\n\n      if (isNonEvmChainId(quoteResponse.quote.srcChainId)) {\n        // Start polling for bridge tx status\n        this.#startPollingForTxId(txMeta.id);\n        // Track non-EVM Swap completed event\n        if (!(isBridgeTx || isTronTx)) {\n          this.#trackUnifiedSwapBridgeEvent(\n            UnifiedSwapBridgeEventName.Completed,\n            txMeta.id,\n          );\n        }\n      }\n    } catch {\n      // Ignore errors here, we don't want to crash the app if this fails and tx submission succeeds\n    }\n    return txMeta;\n  };\n\n  /**\n   * UI-signed intent submission (fast path): the UI generates the EIP-712 signature and calls this with the raw signature.\n   * Here we submit the order to the intent provider and create a synthetic history entry for UX.\n   *\n   * @param params - Object containing intent submission parameters\n   * @param params.quoteResponse - Quote carrying intent data\n   * @param params.signature - Hex signature produced by eth_signTypedData_v4\n   * @param params.accountAddress - The EOA submitting the order\n   * @param params.location - The entry point from which the user initiated the swap or bridge\n   * @param params.abTests - A/B test context to attribute events to specific experiments\n   * @returns A lightweight TransactionMeta-like object for history linking\n   */\n  submitIntent = async (params: {\n    quoteResponse: QuoteResponse<TxData | string> & QuoteMetadata;\n    signature: string;\n    accountAddress: string;\n    location?: MetaMetricsSwapsEventSource;\n    abTests?: Record<string, string>;\n  }): Promise<Pick<TransactionMeta, 'id' | 'chainId' | 'type' | 'status'>> => {\n    const { quoteResponse, signature, accountAddress, location, abTests } =\n      params;\n\n    this.messenger.call(\n      'BridgeController:stopPollingForQuotes',\n      AbortReason.TransactionSubmitted,\n    );\n\n    // Build pre-confirmation properties for error tracking parity with submitTx\n    const account = this.#getMultichainSelectedAccount(accountAddress);\n    const isHardwareAccount = Boolean(account) && isHardwareWallet(account);\n    const preConfirmationProperties = getPreConfirmationPropertiesFromQuote(\n      quoteResponse,\n      false,\n      isHardwareAccount,\n      location,\n      abTests,\n    );\n\n    try {\n      const intent = getIntentFromQuote(\n        quoteResponse as QuoteResponse & { quote: { intent?: Intent } },\n      );\n\n      // If backend provided an approval tx for this intent quote, submit it first (on-chain),\n      // then proceed with off-chain intent submission.\n      let approvalTxId: string | undefined;\n      if (quoteResponse.approval) {\n        const isBridgeTx = isCrossChain(\n          quoteResponse.quote.srcChainId,\n          quoteResponse.quote.destChainId,\n        );\n\n        // Handle approval silently for better UX in intent flows\n        const approvalTxMeta = await this.#handleApprovalTx(\n          isBridgeTx,\n          quoteResponse.quote.srcChainId,\n          quoteResponse.approval && isEvmTxData(quoteResponse.approval)\n            ? quoteResponse.approval\n            : undefined,\n          quoteResponse.resetApproval,\n          /* requireApproval */ false,\n        );\n        approvalTxId = approvalTxMeta?.id;\n\n        if (approvalTxId) {\n          await this.#waitForTxConfirmation(approvalTxId);\n        }\n      }\n\n      const { srcChainId: chainId, requestId } = quoteResponse.quote;\n\n      const submissionParams = {\n        srcChainId: chainId.toString(),\n        quoteId: requestId,\n        signature,\n        order: intent.order,\n        userAddress: accountAddress,\n        aggregatorId: intent.protocol,\n      };\n      const intentApi = new IntentApiImpl(\n        this.#config.customBridgeApiBaseUrl,\n        this.#fetchFn,\n      );\n      const intentOrder = await intentApi.submitIntent(\n        submissionParams,\n        this.#clientId,\n        await this.#getJwt(),\n      );\n\n      const orderUid = intentOrder.id;\n\n      // Determine transaction type: swap for same-chain, bridge for cross-chain\n      const isCrossChainTx = isCrossChain(\n        quoteResponse.quote.srcChainId,\n        quoteResponse.quote.destChainId,\n      );\n      const transactionType = isCrossChainTx\n        ? TransactionType.bridge\n        : TransactionType.swap;\n\n      // Create actual transaction in Transaction Controller first\n      const networkClientId = this.messenger.call(\n        'NetworkController:findNetworkClientIdByChainId',\n        formatChainIdToHex(chainId),\n      );\n\n      // This is a synthetic transaction whose purpose is to be able\n      // to track the order status via the history\n      const intentTransactionParams = {\n        chainId: formatChainIdToHex(chainId),\n        from: accountAddress,\n        to:\n          intent.settlementContract ??\n          '0x9008D19f58AAbd9eD0D60971565AA8510560ab41', // Default settlement contract\n        data: `0x${orderUid.slice(-8)}`, // Use last 8 chars of orderUid to make each transaction unique\n        value: '0x0',\n        gas: '0x5208', // Minimal gas for display purposes\n        gasPrice: '0x3b9aca00', // 1 Gwei - will be converted to EIP-1559 fees if network supports it\n      };\n\n      const { transactionMeta: txMetaPromise } = await this.#addTransactionFn(\n        intentTransactionParams,\n        {\n          origin: 'metamask',\n          actionId: generateActionId(),\n          requireApproval: false,\n          isStateOnly: true,\n          networkClientId,\n          type: transactionType,\n        },\n      );\n\n      const intentTxMeta = txMetaPromise;\n\n      // Map intent order status to TransactionController status\n      const initialTransactionStatus = mapIntentOrderStatusToTransactionStatus(\n        intentOrder.status,\n      );\n\n      // Update transaction with proper initial status based on intent order\n      const statusUpdatedTxMeta = {\n        ...intentTxMeta,\n        status: initialTransactionStatus,\n      };\n\n      // Update with actual transaction metadata\n      const syntheticMeta = {\n        ...statusUpdatedTxMeta,\n        isIntentTx: true,\n        orderUid,\n        intentType: isCrossChainTx ? 'bridge' : 'swap',\n      } as unknown as TransactionMeta;\n\n      // Record in bridge history with actual transaction metadata\n      try {\n        // Use orderId as the history key for intent transactions\n        const bridgeHistoryKey = orderUid;\n\n        // Create a bridge transaction metadata that includes the original txId\n        const bridgeTxMetaForHistory = {\n          ...syntheticMeta,\n          id: bridgeHistoryKey,\n          originalTransactionId: syntheticMeta.id, // Keep original txId for TransactionController updates\n        } as TransactionMeta;\n\n        const startTime = Date.now();\n\n        this.#addTxToHistory({\n          accountAddress,\n          bridgeTxMeta: bridgeTxMetaForHistory,\n          statusRequest: {\n            ...getStatusRequestParams(quoteResponse),\n            srcTxHash: syntheticMeta.hash ?? '',\n          },\n          quoteResponse,\n          slippagePercentage: 0,\n          isStxEnabled: false,\n          approvalTxId,\n          startTime,\n          location,\n          abTests,\n        });\n\n        // Start polling using the orderId key to route to intent manager\n        this.#startPollingForTxId(bridgeHistoryKey);\n      } catch (error) {\n        console.error(\n          ' [submitIntent] Failed to add to bridge history',\n          error,\n        );\n        // non-fatal but log the error\n      }\n      return syntheticMeta;\n    } catch (error) {\n      this.#trackUnifiedSwapBridgeEvent(\n        UnifiedSwapBridgeEventName.Failed,\n        undefined,\n        {\n          error_message: (error as Error)?.message,\n          ...preConfirmationProperties,\n        },\n      );\n\n      throw error;\n    }\n  };\n\n  /**\n   * Tracks post-submission events for a cross-chain swap based on the history item\n   *\n   * @param eventName - The name of the event to track\n   * @param txMetaId - The txMetaId of the history item to track the event for\n   * @param eventProperties - The properties for the event\n   */\n  readonly #trackUnifiedSwapBridgeEvent = <\n    EventName extends\n      | typeof UnifiedSwapBridgeEventName.Submitted\n      | typeof UnifiedSwapBridgeEventName.Failed\n      | typeof UnifiedSwapBridgeEventName.Completed\n      | typeof UnifiedSwapBridgeEventName.StatusValidationFailed\n      | typeof UnifiedSwapBridgeEventName.PollingStatusUpdated,\n  >(\n    eventName: EventName,\n    txMetaId?: string,\n    eventProperties?: Pick<\n      RequiredEventContextFromClient,\n      EventName\n    >[EventName],\n  ): void => {\n    const historyAbTests = txMetaId\n      ? this.state.txHistory?.[txMetaId]?.abTests\n      : undefined;\n    const resolvedAbTests =\n      eventProperties?.ab_tests ?? historyAbTests ?? undefined;\n\n    const baseProperties = {\n      action_type: MetricsActionType.SWAPBRIDGE_V1,\n      location:\n        eventProperties?.location ??\n        (txMetaId ? this.state.txHistory?.[txMetaId]?.location : undefined) ??\n        MetaMetricsSwapsEventSource.MainView,\n      ...(eventProperties ?? {}),\n      ...(resolvedAbTests &&\n        Object.keys(resolvedAbTests).length > 0 && {\n          ab_tests: resolvedAbTests,\n        }),\n    };\n\n    // This will publish events for PERPS dropped tx failures as well\n    if (!txMetaId) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const historyItem: BridgeHistoryItem | undefined =\n      this.state.txHistory[txMetaId];\n\n    if (!historyItem) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        baseProperties,\n      );\n      return;\n    }\n\n    const requestParamProperties = getRequestParamFromHistory(historyItem);\n    // Always publish StatusValidationFailed event, regardless of featureId\n    if (eventName === UnifiedSwapBridgeEventName.StatusValidationFailed) {\n      this.messenger.call(\n        'BridgeController:trackUnifiedSwapBridgeEvent',\n        eventName,\n        {\n          ...baseProperties,\n          chain_id_source: requestParamProperties.chain_id_source,\n          chain_id_destination: requestParamProperties.chain_id_destination,\n          token_address_source: requestParamProperties.token_address_source,\n          token_address_destination:\n            requestParamProperties.token_address_destination,\n          refresh_count: historyItem.attempts?.counter ?? 0,\n        },\n      );\n      return;\n    }\n\n    // Skip tracking all other events when featureId is set (i.e. PERPS)\n    if (historyItem.featureId) {\n      return;\n    }\n\n    const selectedAccount = this.messenger.call(\n      'AccountsController:getAccountByAddress',\n      historyItem.account,\n    );\n\n    const { transactions } = this.messenger.call(\n      'TransactionController:getState',\n    );\n    const txMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === txMetaId,\n    );\n    const approvalTxMeta = transactions?.find(\n      (tx: TransactionMeta) => tx.id === historyItem.approvalTxId,\n    );\n\n    const requiredEventProperties = {\n      ...baseProperties,\n      ...requestParamProperties,\n      ...getRequestMetadataFromHistory(historyItem, selectedAccount),\n      ...getTradeDataFromHistory(historyItem),\n      ...getTxStatusesFromHistory(historyItem),\n      ...getFinalizedTxProperties(historyItem, txMeta, approvalTxMeta),\n      ...getPriceImpactFromQuote(historyItem.quote),\n    };\n\n    this.messenger.call(\n      'BridgeController:trackUnifiedSwapBridgeEvent',\n      eventName,\n      requiredEventProperties,\n    );\n  };\n}\n"]}
\ No newline at end of file
diff --git a/dist/types.cjs.map b/dist/types.cjs.map
index 3c72bc8c4c606b84640a0e47951dad0a633acdde..fa179ec541b05e7f27b5b52c8dba9b23020c6caa 100644
--- a/dist/types.cjs.map
+++ b/dist/types.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"types.cjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":";;;AAkCA,+CAA4D;AAG5D,8EAA8E;AAC9E,2BAA2B;AAE3B,IAAY,cAGX;AAHD,WAAY,cAAc;IACxB,yCAAuB,CAAA;IACvB,mCAAiB,CAAA;AACnB,CAAC,EAHW,cAAc,8BAAd,cAAc,QAGzB;AAyCD,IAAY,QAaX;AAbD,WAAY,QAAQ;IAClB,uBAAW,CAAA;IACX,2BAAe,CAAA;IACf,uCAA2B,CAAA;IAC3B,+BAAmB,CAAA;IACnB,+BAAmB,CAAA;IACnB,mCAAuB,CAAA;IACvB,qCAAyB,CAAA;IACzB,6BAAiB,CAAA;IACjB,6BAAiB,CAAA;IACjB,iCAAqB,CAAA;IACrB,2BAAe,CAAA;IACf,2BAAe,CAAA;AACjB,CAAC,EAbW,QAAQ,wBAAR,QAAQ,QAanB;AAmDD,IAAY,kBASX;AATD,WAAY,kBAAkB;IAC5B,qFAA+D,CAAA;IAC/D,2DAAqC,CAAA;IACrC,2CAAqB,CAAA;IACrB,+CAAyB,CAAA;IACzB,2CAAqB,CAAA;IACrB,mDAA6B,CAAA;IAC7B,yFAAmE,CAAA;IACnE,uFAAiE,CAAA;AACnE,CAAC,EATW,kBAAkB,kCAAlB,kBAAkB,QAS7B","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type {\n  BridgeBackgroundAction,\n  BridgeControllerAction,\n  ChainId,\n  FeatureId,\n  Quote,\n  QuoteMetadata,\n  QuoteResponse,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type { GetGasFeeState } from '@metamask/gas-fee-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n  NetworkControllerGetStateAction,\n} from '@metamask/network-controller';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  TransactionControllerGetStateAction,\n  TransactionControllerTransactionConfirmedEvent,\n  TransactionControllerTransactionFailedEvent,\n  TransactionMeta,\n} from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\n\nimport type { BridgeStatusController } from './bridge-status-controller';\nimport { BRIDGE_STATUS_CONTROLLER_NAME } from './constants';\nimport type { StatusResponseSchema } from './utils/validators';\n\n// All fields need to be types not interfaces, same with their children fields\n// o/w you get a type error\n\nexport enum BridgeClientId {\n  EXTENSION = 'extension',\n  MOBILE = 'mobile',\n}\n\nexport type FetchFunction = (\n  input: RequestInfo | URL,\n  init?: RequestInit,\n) => Promise<unknown>;\n\n/**\n * These fields are specific to Solana transactions and can likely be infered from TransactionMeta\n *\n * @deprecated these should be removed eventually\n */\nexport type SolanaTransactionMeta = {\n  isSolana: boolean;\n  isBridgeTx: boolean;\n};\n\nexport type StatusRequest = {\n  bridgeId: string; // lifi, socket, squid\n  srcTxHash?: string; // lifi, socket, squid, might be undefined for STX\n  bridge: string; // lifi, socket, squid\n  srcChainId: ChainId; // lifi, socket, squid\n  destChainId: ChainId; // lifi, socket, squid\n  quote?: Quote; // squid\n  refuel?: boolean; // lifi\n};\n\nexport type StatusRequestDto = Omit<\n  StatusRequest,\n  'quote' | 'srcChainId' | 'destChainId' | 'refuel'\n> & {\n  srcChainId: string; // lifi, socket, squid\n  destChainId: string; // lifi, socket, squid\n  requestId?: string;\n  refuel?: string; // lifi\n};\n\nexport type StatusRequestWithSrcTxHash = StatusRequest & {\n  srcTxHash: string;\n};\n\nexport enum BridgeId {\n  HOP = 'hop',\n  CELER = 'celer',\n  CELERCIRCLE = 'celercircle',\n  CONNEXT = 'connext',\n  POLYGON = 'polygon',\n  AVALANCHE = 'avalanche',\n  MULTICHAIN = 'multichain',\n  AXELAR = 'axelar',\n  ACROSS = 'across',\n  STARGATE = 'stargate',\n  RELAY = 'relay',\n  MAYAN = 'mayan',\n}\n\nexport type StatusResponse = Infer<typeof StatusResponseSchema>;\n\nexport type RefuelStatusResponse = object & StatusResponse;\n\nexport type BridgeHistoryItem = {\n  txMetaId?: string; // Optional: not available pre-submission or on sync failure\n  actionId?: string; // Only for non-batch EVM transactions\n  originalTransactionId?: string; // Keep original transaction ID for intent transactions\n  batchId?: string;\n  quote: Quote;\n  status: StatusResponse;\n  startTime?: number; // timestamp in ms\n  estimatedProcessingTimeInSeconds: number;\n  slippagePercentage: number;\n  completionTime?: number; // timestamp in ms\n  pricingData?: {\n    /**\n     * The actual amount sent by user in non-atomic decimal form\n     */\n    amountSent: QuoteMetadata['sentAmount']['amount'];\n    amountSentInUsd?: QuoteMetadata['sentAmount']['usd'];\n    quotedGasInUsd?: QuoteMetadata['gasFee']['effective']['usd'];\n    quotedGasAmount?: QuoteMetadata['gasFee']['effective']['amount'];\n    quotedReturnInUsd?: QuoteMetadata['toTokenAmount']['usd'];\n    quotedRefuelSrcAmountInUsd?: string;\n    quotedRefuelDestAmountInUsd?: string;\n  };\n  initialDestAssetBalance?: string;\n  targetContractAddress?: string;\n  account: string;\n  hasApprovalTx: boolean;\n  approvalTxId?: string;\n  featureId?: FeatureId;\n  isStxEnabled?: boolean;\n  /**\n   * The location/entry point from which the user initiated the swap or bridge.\n   * Used to attribute swaps to specific flows (e.g. Trending Explore).\n   */\n  location?: MetaMetricsSwapsEventSource;\n  /**\n   * Attempts tracking for exponential backoff on failed fetches.\n   * We track the number of attempts and the last attempt time for each txMetaId that has failed at least once\n   */\n  attempts?: {\n    counter: number;\n    lastAttemptTime: number; // timestamp in ms\n  };\n};\n\nexport enum BridgeStatusAction {\n  StartPollingForBridgeTxStatus = 'StartPollingForBridgeTxStatus',\n  WipeBridgeStatus = 'WipeBridgeStatus',\n  GetState = 'GetState',\n  ResetState = 'ResetState',\n  SubmitTx = 'SubmitTx',\n  SubmitIntent = 'SubmitIntent',\n  RestartPollingForFailedAttempts = 'RestartPollingForFailedAttempts',\n  GetBridgeHistoryItemByTxMetaId = 'GetBridgeHistoryItemByTxMetaId',\n}\n\nexport type TokenAmountValuesSerialized = {\n  amount: string;\n  valueInCurrency: string | null;\n  usd: string | null;\n};\n\nexport type QuoteMetadataSerialized = {\n  gasFee: TokenAmountValuesSerialized;\n  /**\n   * The total network fee for the bridge transaction\n   * estimatedGasFees + relayerFees\n   */\n  totalNetworkFee: TokenAmountValuesSerialized;\n  /**\n   * The total max network fee for the bridge transaction\n   * maxGasFees + relayerFees\n   */\n  totalMaxNetworkFee: TokenAmountValuesSerialized;\n  toTokenAmount: TokenAmountValuesSerialized;\n  /**\n   * The adjusted return for the bridge transaction\n   * destTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValuesSerialized, 'amount'>;\n  /**\n   * The actual amount sent by user in non-atomic decimal form\n   * srcTokenAmount + metabridgeFee\n   */\n  sentAmount: TokenAmountValuesSerialized;\n  swapRate: string; // destTokenAmount / sentAmount\n  /**\n   * The cost of the bridge transaction\n   * sentAmount - adjustedReturn\n   */\n  cost: Omit<TokenAmountValuesSerialized, 'amount'>;\n};\n\nexport type StartPollingForBridgeTxStatusArgs = {\n  bridgeTxMeta?: TransactionMeta;\n  statusRequest: StatusRequest;\n  quoteResponse: QuoteResponse & QuoteMetadata;\n  startTime?: BridgeHistoryItem['startTime'];\n  slippagePercentage: BridgeHistoryItem['slippagePercentage'];\n  initialDestAssetBalance?: BridgeHistoryItem['initialDestAssetBalance'];\n  targetContractAddress?: BridgeHistoryItem['targetContractAddress'];\n  approvalTxId?: BridgeHistoryItem['approvalTxId'];\n  isStxEnabled?: BridgeHistoryItem['isStxEnabled'];\n  location?: BridgeHistoryItem['location'];\n  accountAddress: string;\n};\n\n/**\n * Chrome: The BigNumber values are automatically serialized to strings when sent to the background\n * Firefox: The BigNumber values are not serialized to strings when sent to the background,\n * so we force the ui to do it manually, by using StartPollingForBridgeTxStatusArgsSerialized type on the startPollingForBridgeTxStatus action\n */\nexport type StartPollingForBridgeTxStatusArgsSerialized = Omit<\n  StartPollingForBridgeTxStatusArgs,\n  'quoteResponse'\n> & {\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>;\n};\n\nexport type SourceChainTxMetaId = string;\n\nexport type BridgeStatusControllerState = {\n  txHistory: Record<SourceChainTxMetaId, BridgeHistoryItem>;\n};\n\n// Actions\ntype BridgeStatusControllerAction<\n  FunctionName extends keyof BridgeStatusController,\n> = {\n  type: `${typeof BRIDGE_STATUS_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeStatusController[FunctionName];\n};\n\nexport type BridgeStatusControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeStatusControllerStartPollingForBridgeTxStatusAction =\n  BridgeStatusControllerAction<'startPollingForBridgeTxStatus'>;\n\nexport type BridgeStatusControllerWipeBridgeStatusAction =\n  BridgeStatusControllerAction<'wipeBridgeStatus'>;\n\nexport type BridgeStatusControllerResetStateAction =\n  BridgeStatusControllerAction<'resetState'>;\n\nexport type BridgeStatusControllerSubmitTxAction =\n  BridgeStatusControllerAction<'submitTx'>;\n\nexport type BridgeStatusControllerSubmitIntentAction =\n  BridgeStatusControllerAction<'submitIntent'>;\n\nexport type BridgeStatusControllerRestartPollingForFailedAttemptsAction =\n  BridgeStatusControllerAction<'restartPollingForFailedAttempts'>;\n\nexport type BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction =\n  BridgeStatusControllerAction<'getBridgeHistoryItemByTxMetaId'>;\n\nexport type BridgeStatusControllerActions =\n  | BridgeStatusControllerStartPollingForBridgeTxStatusAction\n  | BridgeStatusControllerWipeBridgeStatusAction\n  | BridgeStatusControllerResetStateAction\n  | BridgeStatusControllerGetStateAction\n  | BridgeStatusControllerSubmitTxAction\n  | BridgeStatusControllerSubmitIntentAction\n  | BridgeStatusControllerRestartPollingForFailedAttemptsAction\n  | BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction;\n\n// Events\nexport type BridgeStatusControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n/**\n * This event is published when the destination bridge transaction is completed\n * The payload is the asset received on the destination chain\n */\nexport type BridgeStatusControllerDestinationTransactionCompletedEvent = {\n  type: 'BridgeStatusController:destinationTransactionCompleted';\n  payload: [CaipAssetType];\n};\n\nexport type BridgeStatusControllerEvents =\n  | BridgeStatusControllerStateChangeEvent\n  | BridgeStatusControllerDestinationTransactionCompletedEvent;\n\n/**\n * The external actions available to the BridgeStatusController.\n */\ntype AllowedActions =\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | HandleSnapRequest\n  | TransactionControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | GetGasFeeState\n  | AccountsControllerGetAccountByAddressAction\n  | RemoteFeatureFlagControllerGetStateAction;\n\n/**\n * The external events available to the BridgeStatusController.\n */\ntype AllowedEvents =\n  | TransactionControllerTransactionFailedEvent\n  | TransactionControllerTransactionConfirmedEvent;\n\n/**\n * The messenger for the BridgeStatusController.\n */\nexport type BridgeStatusControllerMessenger = Messenger<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerActions | AllowedActions,\n  BridgeStatusControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
+{"version":3,"file":"types.cjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":";;;AAmCA,+CAA4D;AAG5D,8EAA8E;AAC9E,2BAA2B;AAE3B,IAAY,cAGX;AAHD,WAAY,cAAc;IACxB,yCAAuB,CAAA;IACvB,mCAAiB,CAAA;AACnB,CAAC,EAHW,cAAc,8BAAd,cAAc,QAGzB;AAyCD,IAAY,QAaX;AAbD,WAAY,QAAQ;IAClB,uBAAW,CAAA;IACX,2BAAe,CAAA;IACf,uCAA2B,CAAA;IAC3B,+BAAmB,CAAA;IACnB,+BAAmB,CAAA;IACnB,mCAAuB,CAAA;IACvB,qCAAyB,CAAA;IACzB,6BAAiB,CAAA;IACjB,6BAAiB,CAAA;IACjB,iCAAqB,CAAA;IACrB,2BAAe,CAAA;IACf,2BAAe,CAAA;AACjB,CAAC,EAbW,QAAQ,wBAAR,QAAQ,QAanB;AAwDD,IAAY,kBASX;AATD,WAAY,kBAAkB;IAC5B,qFAA+D,CAAA;IAC/D,2DAAqC,CAAA;IACrC,2CAAqB,CAAA;IACrB,+CAAyB,CAAA;IACzB,2CAAqB,CAAA;IACrB,mDAA6B,CAAA;IAC7B,yFAAmE,CAAA;IACnE,uFAAiE,CAAA;AACnE,CAAC,EATW,kBAAkB,kCAAlB,kBAAkB,QAS7B","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type {\n  BridgeBackgroundAction,\n  BridgeControllerAction,\n  ChainId,\n  FeatureId,\n  Quote,\n  QuoteMetadata,\n  QuoteResponse,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type { GetGasFeeState } from '@metamask/gas-fee-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n  NetworkControllerGetStateAction,\n} from '@metamask/network-controller';\nimport type { AuthenticationControllerGetBearerToken } from '@metamask/profile-sync-controller/auth';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  TransactionControllerGetStateAction,\n  TransactionControllerTransactionConfirmedEvent,\n  TransactionControllerTransactionFailedEvent,\n  TransactionMeta,\n} from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\n\nimport type { BridgeStatusController } from './bridge-status-controller';\nimport { BRIDGE_STATUS_CONTROLLER_NAME } from './constants';\nimport type { StatusResponseSchema } from './utils/validators';\n\n// All fields need to be types not interfaces, same with their children fields\n// o/w you get a type error\n\nexport enum BridgeClientId {\n  EXTENSION = 'extension',\n  MOBILE = 'mobile',\n}\n\nexport type FetchFunction = (\n  input: RequestInfo | URL,\n  init?: RequestInit,\n) => Promise<unknown>;\n\n/**\n * These fields are specific to Solana transactions and can likely be infered from TransactionMeta\n *\n * @deprecated these should be removed eventually\n */\nexport type SolanaTransactionMeta = {\n  isSolana: boolean;\n  isBridgeTx: boolean;\n};\n\nexport type StatusRequest = {\n  bridgeId: string; // lifi, socket, squid\n  srcTxHash?: string; // lifi, socket, squid, might be undefined for STX\n  bridge: string; // lifi, socket, squid\n  srcChainId: ChainId; // lifi, socket, squid\n  destChainId: ChainId; // lifi, socket, squid\n  quote?: Quote; // squid\n  refuel?: boolean; // lifi\n};\n\nexport type StatusRequestDto = Omit<\n  StatusRequest,\n  'quote' | 'srcChainId' | 'destChainId' | 'refuel'\n> & {\n  srcChainId: string; // lifi, socket, squid\n  destChainId: string; // lifi, socket, squid\n  requestId?: string;\n  refuel?: string; // lifi\n};\n\nexport type StatusRequestWithSrcTxHash = StatusRequest & {\n  srcTxHash: string;\n};\n\nexport enum BridgeId {\n  HOP = 'hop',\n  CELER = 'celer',\n  CELERCIRCLE = 'celercircle',\n  CONNEXT = 'connext',\n  POLYGON = 'polygon',\n  AVALANCHE = 'avalanche',\n  MULTICHAIN = 'multichain',\n  AXELAR = 'axelar',\n  ACROSS = 'across',\n  STARGATE = 'stargate',\n  RELAY = 'relay',\n  MAYAN = 'mayan',\n}\n\nexport type StatusResponse = Infer<typeof StatusResponseSchema>;\n\nexport type RefuelStatusResponse = object & StatusResponse;\n\nexport type BridgeHistoryItem = {\n  txMetaId?: string; // Optional: not available pre-submission or on sync failure\n  actionId?: string; // Only for non-batch EVM transactions\n  originalTransactionId?: string; // Keep original transaction ID for intent transactions\n  batchId?: string;\n  quote: Quote;\n  status: StatusResponse;\n  startTime?: number; // timestamp in ms\n  estimatedProcessingTimeInSeconds: number;\n  slippagePercentage: number;\n  completionTime?: number; // timestamp in ms\n  pricingData?: {\n    /**\n     * The actual amount sent by user in non-atomic decimal form\n     */\n    amountSent: QuoteMetadata['sentAmount']['amount'];\n    amountSentInUsd?: QuoteMetadata['sentAmount']['usd'];\n    quotedGasInUsd?: QuoteMetadata['gasFee']['effective']['usd'];\n    quotedGasAmount?: QuoteMetadata['gasFee']['effective']['amount'];\n    quotedReturnInUsd?: QuoteMetadata['toTokenAmount']['usd'];\n    quotedRefuelSrcAmountInUsd?: string;\n    quotedRefuelDestAmountInUsd?: string;\n  };\n  initialDestAssetBalance?: string;\n  targetContractAddress?: string;\n  account: string;\n  hasApprovalTx: boolean;\n  approvalTxId?: string;\n  featureId?: FeatureId;\n  isStxEnabled?: boolean;\n  /**\n   * The location/entry point from which the user initiated the swap or bridge.\n   * Used to attribute swaps to specific flows (e.g. Trending Explore).\n   */\n  location?: MetaMetricsSwapsEventSource;\n  /**\n   * A/B test context to attribute swap/bridge events to specific experiments.\n   * Keys are test names, values are variant names (e.g. { token_details_layout: 'treatment' }).\n   */\n  abTests?: Record<string, string>;\n  /**\n   * Attempts tracking for exponential backoff on failed fetches.\n   * We track the number of attempts and the last attempt time for each txMetaId that has failed at least once\n   */\n  attempts?: {\n    counter: number;\n    lastAttemptTime: number; // timestamp in ms\n  };\n};\n\nexport enum BridgeStatusAction {\n  StartPollingForBridgeTxStatus = 'StartPollingForBridgeTxStatus',\n  WipeBridgeStatus = 'WipeBridgeStatus',\n  GetState = 'GetState',\n  ResetState = 'ResetState',\n  SubmitTx = 'SubmitTx',\n  SubmitIntent = 'SubmitIntent',\n  RestartPollingForFailedAttempts = 'RestartPollingForFailedAttempts',\n  GetBridgeHistoryItemByTxMetaId = 'GetBridgeHistoryItemByTxMetaId',\n}\n\nexport type TokenAmountValuesSerialized = {\n  amount: string;\n  valueInCurrency: string | null;\n  usd: string | null;\n};\n\nexport type QuoteMetadataSerialized = {\n  gasFee: TokenAmountValuesSerialized;\n  /**\n   * The total network fee for the bridge transaction\n   * estimatedGasFees + relayerFees\n   */\n  totalNetworkFee: TokenAmountValuesSerialized;\n  /**\n   * The total max network fee for the bridge transaction\n   * maxGasFees + relayerFees\n   */\n  totalMaxNetworkFee: TokenAmountValuesSerialized;\n  toTokenAmount: TokenAmountValuesSerialized;\n  /**\n   * The adjusted return for the bridge transaction\n   * destTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValuesSerialized, 'amount'>;\n  /**\n   * The actual amount sent by user in non-atomic decimal form\n   * srcTokenAmount + metabridgeFee\n   */\n  sentAmount: TokenAmountValuesSerialized;\n  swapRate: string; // destTokenAmount / sentAmount\n  /**\n   * The cost of the bridge transaction\n   * sentAmount - adjustedReturn\n   */\n  cost: Omit<TokenAmountValuesSerialized, 'amount'>;\n};\n\nexport type StartPollingForBridgeTxStatusArgs = {\n  bridgeTxMeta?: TransactionMeta;\n  statusRequest: StatusRequest;\n  quoteResponse: QuoteResponse & QuoteMetadata;\n  startTime?: BridgeHistoryItem['startTime'];\n  slippagePercentage: BridgeHistoryItem['slippagePercentage'];\n  initialDestAssetBalance?: BridgeHistoryItem['initialDestAssetBalance'];\n  targetContractAddress?: BridgeHistoryItem['targetContractAddress'];\n  approvalTxId?: BridgeHistoryItem['approvalTxId'];\n  isStxEnabled?: BridgeHistoryItem['isStxEnabled'];\n  location?: BridgeHistoryItem['location'];\n  abTests?: BridgeHistoryItem['abTests'];\n  accountAddress: string;\n};\n\n/**\n * Chrome: The BigNumber values are automatically serialized to strings when sent to the background\n * Firefox: The BigNumber values are not serialized to strings when sent to the background,\n * so we force the ui to do it manually, by using StartPollingForBridgeTxStatusArgsSerialized type on the startPollingForBridgeTxStatus action\n */\nexport type StartPollingForBridgeTxStatusArgsSerialized = Omit<\n  StartPollingForBridgeTxStatusArgs,\n  'quoteResponse'\n> & {\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>;\n};\n\nexport type SourceChainTxMetaId = string;\n\nexport type BridgeStatusControllerState = {\n  txHistory: Record<SourceChainTxMetaId, BridgeHistoryItem>;\n};\n\n// Actions\ntype BridgeStatusControllerAction<\n  FunctionName extends keyof BridgeStatusController,\n> = {\n  type: `${typeof BRIDGE_STATUS_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeStatusController[FunctionName];\n};\n\nexport type BridgeStatusControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeStatusControllerStartPollingForBridgeTxStatusAction =\n  BridgeStatusControllerAction<'startPollingForBridgeTxStatus'>;\n\nexport type BridgeStatusControllerWipeBridgeStatusAction =\n  BridgeStatusControllerAction<'wipeBridgeStatus'>;\n\nexport type BridgeStatusControllerResetStateAction =\n  BridgeStatusControllerAction<'resetState'>;\n\nexport type BridgeStatusControllerSubmitTxAction =\n  BridgeStatusControllerAction<'submitTx'>;\n\nexport type BridgeStatusControllerSubmitIntentAction =\n  BridgeStatusControllerAction<'submitIntent'>;\n\nexport type BridgeStatusControllerRestartPollingForFailedAttemptsAction =\n  BridgeStatusControllerAction<'restartPollingForFailedAttempts'>;\n\nexport type BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction =\n  BridgeStatusControllerAction<'getBridgeHistoryItemByTxMetaId'>;\n\nexport type BridgeStatusControllerActions =\n  | BridgeStatusControllerStartPollingForBridgeTxStatusAction\n  | BridgeStatusControllerWipeBridgeStatusAction\n  | BridgeStatusControllerResetStateAction\n  | BridgeStatusControllerGetStateAction\n  | BridgeStatusControllerSubmitTxAction\n  | BridgeStatusControllerSubmitIntentAction\n  | BridgeStatusControllerRestartPollingForFailedAttemptsAction\n  | BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction;\n\n// Events\nexport type BridgeStatusControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n/**\n * This event is published when the destination bridge transaction is completed\n * The payload is the asset received on the destination chain\n */\nexport type BridgeStatusControllerDestinationTransactionCompletedEvent = {\n  type: 'BridgeStatusController:destinationTransactionCompleted';\n  payload: [CaipAssetType];\n};\n\nexport type BridgeStatusControllerEvents =\n  | BridgeStatusControllerStateChangeEvent\n  | BridgeStatusControllerDestinationTransactionCompletedEvent;\n\n/**\n * The external actions available to the BridgeStatusController.\n */\ntype AllowedActions =\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | HandleSnapRequest\n  | TransactionControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | GetGasFeeState\n  | AccountsControllerGetAccountByAddressAction\n  | RemoteFeatureFlagControllerGetStateAction\n  | AuthenticationControllerGetBearerToken;\n\n/**\n * The external events available to the BridgeStatusController.\n */\ntype AllowedEvents =\n  | TransactionControllerTransactionFailedEvent\n  | TransactionControllerTransactionConfirmedEvent;\n\n/**\n * The messenger for the BridgeStatusController.\n */\nexport type BridgeStatusControllerMessenger = Messenger<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerActions | AllowedActions,\n  BridgeStatusControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
diff --git a/dist/types.d.cts b/dist/types.d.cts
index a77021907623ca60681a979c0ef0bfeee5ca3150..d99759d1cd1b64d4be9ebe6d949e81134ac8abad 100644
--- a/dist/types.d.cts
+++ b/dist/types.d.cts
@@ -4,6 +4,7 @@ import type { BridgeBackgroundAction, BridgeControllerAction, ChainId, FeatureId
 import type { GetGasFeeState } from "@metamask/gas-fee-controller";
 import type { Messenger } from "@metamask/messenger";
 import type { NetworkControllerFindNetworkClientIdByChainIdAction, NetworkControllerGetNetworkClientByIdAction, NetworkControllerGetStateAction } from "@metamask/network-controller";
+import type { AuthenticationControllerGetBearerToken } from "@metamask/profile-sync-controller/auth";
 import type { RemoteFeatureFlagControllerGetStateAction } from "@metamask/remote-feature-flag-controller";
 import type { HandleSnapRequest } from "@metamask/snaps-controllers";
 import type { Infer } from "@metamask/superstruct";
@@ -95,6 +96,11 @@ export type BridgeHistoryItem = {
      * Used to attribute swaps to specific flows (e.g. Trending Explore).
      */
     location?: MetaMetricsSwapsEventSource;
+    /**
+     * A/B test context to attribute swap/bridge events to specific experiments.
+     * Keys are test names, values are variant names (e.g. { token_details_layout: 'treatment' }).
+     */
+    abTests?: Record<string, string>;
     /**
      * Attempts tracking for exponential backoff on failed fetches.
      * We track the number of attempts and the last attempt time for each txMetaId that has failed at least once
@@ -160,6 +166,7 @@ export type StartPollingForBridgeTxStatusArgs = {
     approvalTxId?: BridgeHistoryItem['approvalTxId'];
     isStxEnabled?: BridgeHistoryItem['isStxEnabled'];
     location?: BridgeHistoryItem['location'];
+    abTests?: BridgeHistoryItem['abTests'];
     accountAddress: string;
 };
 /**
@@ -200,7 +207,7 @@ export type BridgeStatusControllerEvents = BridgeStatusControllerStateChangeEven
 /**
  * The external actions available to the BridgeStatusController.
  */
-type AllowedActions = NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetStateAction | NetworkControllerGetNetworkClientByIdAction | HandleSnapRequest | TransactionControllerGetStateAction | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT> | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES> | GetGasFeeState | AccountsControllerGetAccountByAddressAction | RemoteFeatureFlagControllerGetStateAction;
+type AllowedActions = NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetStateAction | NetworkControllerGetNetworkClientByIdAction | HandleSnapRequest | TransactionControllerGetStateAction | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT> | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES> | GetGasFeeState | AccountsControllerGetAccountByAddressAction | RemoteFeatureFlagControllerGetStateAction | AuthenticationControllerGetBearerToken;
 /**
  * The external events available to the BridgeStatusController.
  */
diff --git a/dist/types.d.cts.map b/dist/types.d.cts.map
index c78bf1051f6698dea8b87a0d571e266f812bccd6..17b1c5a1e82e0888f67e6230311d57ce4afc4cb9 100644
--- a/dist/types.d.cts.map
+++ b/dist/types.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"types.d.cts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"types.d.cts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/types.d.mts b/dist/types.d.mts
index 615f3c51f4d925425bd7f8ee9b8ca566e3f842e3..093dadfa0399ac7d06ccc48a4d232d7f169802df 100644
--- a/dist/types.d.mts
+++ b/dist/types.d.mts
@@ -4,6 +4,7 @@ import type { BridgeBackgroundAction, BridgeControllerAction, ChainId, FeatureId
 import type { GetGasFeeState } from "@metamask/gas-fee-controller";
 import type { Messenger } from "@metamask/messenger";
 import type { NetworkControllerFindNetworkClientIdByChainIdAction, NetworkControllerGetNetworkClientByIdAction, NetworkControllerGetStateAction } from "@metamask/network-controller";
+import type { AuthenticationControllerGetBearerToken } from "@metamask/profile-sync-controller/auth";
 import type { RemoteFeatureFlagControllerGetStateAction } from "@metamask/remote-feature-flag-controller";
 import type { HandleSnapRequest } from "@metamask/snaps-controllers";
 import type { Infer } from "@metamask/superstruct";
@@ -95,6 +96,11 @@ export type BridgeHistoryItem = {
      * Used to attribute swaps to specific flows (e.g. Trending Explore).
      */
     location?: MetaMetricsSwapsEventSource;
+    /**
+     * A/B test context to attribute swap/bridge events to specific experiments.
+     * Keys are test names, values are variant names (e.g. { token_details_layout: 'treatment' }).
+     */
+    abTests?: Record<string, string>;
     /**
      * Attempts tracking for exponential backoff on failed fetches.
      * We track the number of attempts and the last attempt time for each txMetaId that has failed at least once
@@ -160,6 +166,7 @@ export type StartPollingForBridgeTxStatusArgs = {
     approvalTxId?: BridgeHistoryItem['approvalTxId'];
     isStxEnabled?: BridgeHistoryItem['isStxEnabled'];
     location?: BridgeHistoryItem['location'];
+    abTests?: BridgeHistoryItem['abTests'];
     accountAddress: string;
 };
 /**
@@ -200,7 +207,7 @@ export type BridgeStatusControllerEvents = BridgeStatusControllerStateChangeEven
 /**
  * The external actions available to the BridgeStatusController.
  */
-type AllowedActions = NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetStateAction | NetworkControllerGetNetworkClientByIdAction | HandleSnapRequest | TransactionControllerGetStateAction | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT> | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES> | GetGasFeeState | AccountsControllerGetAccountByAddressAction | RemoteFeatureFlagControllerGetStateAction;
+type AllowedActions = NetworkControllerFindNetworkClientIdByChainIdAction | NetworkControllerGetStateAction | NetworkControllerGetNetworkClientByIdAction | HandleSnapRequest | TransactionControllerGetStateAction | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT> | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES> | GetGasFeeState | AccountsControllerGetAccountByAddressAction | RemoteFeatureFlagControllerGetStateAction | AuthenticationControllerGetBearerToken;
 /**
  * The external events available to the BridgeStatusController.
  */
diff --git a/dist/types.d.mts.map b/dist/types.d.mts.map
index 22a8ab1827bbf6adb3dafb3d7ad156bb492fca18..3029d0c6bb61dcc155df1961e0099e666740e09e 100644
--- a/dist/types.d.mts.map
+++ b/dist/types.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"types.d.mts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"types.d.mts","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/types.mjs.map b/dist/types.mjs.map
index 2097b8b8637d79d853f12bf150bef77a9bdb0241..177c26fee1a51f63b073acff0a8749855dafdc57 100644
--- a/dist/types.mjs.map
+++ b/dist/types.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"types.mjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"AAkCA,OAAO,EAAE,6BAA6B,EAAE,wBAAoB;AAG5D,8EAA8E;AAC9E,2BAA2B;AAE3B,MAAM,CAAN,IAAY,cAGX;AAHD,WAAY,cAAc;IACxB,yCAAuB,CAAA;IACvB,mCAAiB,CAAA;AACnB,CAAC,EAHW,cAAc,KAAd,cAAc,QAGzB;AAyCD,MAAM,CAAN,IAAY,QAaX;AAbD,WAAY,QAAQ;IAClB,uBAAW,CAAA;IACX,2BAAe,CAAA;IACf,uCAA2B,CAAA;IAC3B,+BAAmB,CAAA;IACnB,+BAAmB,CAAA;IACnB,mCAAuB,CAAA;IACvB,qCAAyB,CAAA;IACzB,6BAAiB,CAAA;IACjB,6BAAiB,CAAA;IACjB,iCAAqB,CAAA;IACrB,2BAAe,CAAA;IACf,2BAAe,CAAA;AACjB,CAAC,EAbW,QAAQ,KAAR,QAAQ,QAanB;AAmDD,MAAM,CAAN,IAAY,kBASX;AATD,WAAY,kBAAkB;IAC5B,qFAA+D,CAAA;IAC/D,2DAAqC,CAAA;IACrC,2CAAqB,CAAA;IACrB,+CAAyB,CAAA;IACzB,2CAAqB,CAAA;IACrB,mDAA6B,CAAA;IAC7B,yFAAmE,CAAA;IACnE,uFAAiE,CAAA;AACnE,CAAC,EATW,kBAAkB,KAAlB,kBAAkB,QAS7B","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type {\n  BridgeBackgroundAction,\n  BridgeControllerAction,\n  ChainId,\n  FeatureId,\n  Quote,\n  QuoteMetadata,\n  QuoteResponse,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type { GetGasFeeState } from '@metamask/gas-fee-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n  NetworkControllerGetStateAction,\n} from '@metamask/network-controller';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  TransactionControllerGetStateAction,\n  TransactionControllerTransactionConfirmedEvent,\n  TransactionControllerTransactionFailedEvent,\n  TransactionMeta,\n} from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\n\nimport type { BridgeStatusController } from './bridge-status-controller';\nimport { BRIDGE_STATUS_CONTROLLER_NAME } from './constants';\nimport type { StatusResponseSchema } from './utils/validators';\n\n// All fields need to be types not interfaces, same with their children fields\n// o/w you get a type error\n\nexport enum BridgeClientId {\n  EXTENSION = 'extension',\n  MOBILE = 'mobile',\n}\n\nexport type FetchFunction = (\n  input: RequestInfo | URL,\n  init?: RequestInit,\n) => Promise<unknown>;\n\n/**\n * These fields are specific to Solana transactions and can likely be infered from TransactionMeta\n *\n * @deprecated these should be removed eventually\n */\nexport type SolanaTransactionMeta = {\n  isSolana: boolean;\n  isBridgeTx: boolean;\n};\n\nexport type StatusRequest = {\n  bridgeId: string; // lifi, socket, squid\n  srcTxHash?: string; // lifi, socket, squid, might be undefined for STX\n  bridge: string; // lifi, socket, squid\n  srcChainId: ChainId; // lifi, socket, squid\n  destChainId: ChainId; // lifi, socket, squid\n  quote?: Quote; // squid\n  refuel?: boolean; // lifi\n};\n\nexport type StatusRequestDto = Omit<\n  StatusRequest,\n  'quote' | 'srcChainId' | 'destChainId' | 'refuel'\n> & {\n  srcChainId: string; // lifi, socket, squid\n  destChainId: string; // lifi, socket, squid\n  requestId?: string;\n  refuel?: string; // lifi\n};\n\nexport type StatusRequestWithSrcTxHash = StatusRequest & {\n  srcTxHash: string;\n};\n\nexport enum BridgeId {\n  HOP = 'hop',\n  CELER = 'celer',\n  CELERCIRCLE = 'celercircle',\n  CONNEXT = 'connext',\n  POLYGON = 'polygon',\n  AVALANCHE = 'avalanche',\n  MULTICHAIN = 'multichain',\n  AXELAR = 'axelar',\n  ACROSS = 'across',\n  STARGATE = 'stargate',\n  RELAY = 'relay',\n  MAYAN = 'mayan',\n}\n\nexport type StatusResponse = Infer<typeof StatusResponseSchema>;\n\nexport type RefuelStatusResponse = object & StatusResponse;\n\nexport type BridgeHistoryItem = {\n  txMetaId?: string; // Optional: not available pre-submission or on sync failure\n  actionId?: string; // Only for non-batch EVM transactions\n  originalTransactionId?: string; // Keep original transaction ID for intent transactions\n  batchId?: string;\n  quote: Quote;\n  status: StatusResponse;\n  startTime?: number; // timestamp in ms\n  estimatedProcessingTimeInSeconds: number;\n  slippagePercentage: number;\n  completionTime?: number; // timestamp in ms\n  pricingData?: {\n    /**\n     * The actual amount sent by user in non-atomic decimal form\n     */\n    amountSent: QuoteMetadata['sentAmount']['amount'];\n    amountSentInUsd?: QuoteMetadata['sentAmount']['usd'];\n    quotedGasInUsd?: QuoteMetadata['gasFee']['effective']['usd'];\n    quotedGasAmount?: QuoteMetadata['gasFee']['effective']['amount'];\n    quotedReturnInUsd?: QuoteMetadata['toTokenAmount']['usd'];\n    quotedRefuelSrcAmountInUsd?: string;\n    quotedRefuelDestAmountInUsd?: string;\n  };\n  initialDestAssetBalance?: string;\n  targetContractAddress?: string;\n  account: string;\n  hasApprovalTx: boolean;\n  approvalTxId?: string;\n  featureId?: FeatureId;\n  isStxEnabled?: boolean;\n  /**\n   * The location/entry point from which the user initiated the swap or bridge.\n   * Used to attribute swaps to specific flows (e.g. Trending Explore).\n   */\n  location?: MetaMetricsSwapsEventSource;\n  /**\n   * Attempts tracking for exponential backoff on failed fetches.\n   * We track the number of attempts and the last attempt time for each txMetaId that has failed at least once\n   */\n  attempts?: {\n    counter: number;\n    lastAttemptTime: number; // timestamp in ms\n  };\n};\n\nexport enum BridgeStatusAction {\n  StartPollingForBridgeTxStatus = 'StartPollingForBridgeTxStatus',\n  WipeBridgeStatus = 'WipeBridgeStatus',\n  GetState = 'GetState',\n  ResetState = 'ResetState',\n  SubmitTx = 'SubmitTx',\n  SubmitIntent = 'SubmitIntent',\n  RestartPollingForFailedAttempts = 'RestartPollingForFailedAttempts',\n  GetBridgeHistoryItemByTxMetaId = 'GetBridgeHistoryItemByTxMetaId',\n}\n\nexport type TokenAmountValuesSerialized = {\n  amount: string;\n  valueInCurrency: string | null;\n  usd: string | null;\n};\n\nexport type QuoteMetadataSerialized = {\n  gasFee: TokenAmountValuesSerialized;\n  /**\n   * The total network fee for the bridge transaction\n   * estimatedGasFees + relayerFees\n   */\n  totalNetworkFee: TokenAmountValuesSerialized;\n  /**\n   * The total max network fee for the bridge transaction\n   * maxGasFees + relayerFees\n   */\n  totalMaxNetworkFee: TokenAmountValuesSerialized;\n  toTokenAmount: TokenAmountValuesSerialized;\n  /**\n   * The adjusted return for the bridge transaction\n   * destTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValuesSerialized, 'amount'>;\n  /**\n   * The actual amount sent by user in non-atomic decimal form\n   * srcTokenAmount + metabridgeFee\n   */\n  sentAmount: TokenAmountValuesSerialized;\n  swapRate: string; // destTokenAmount / sentAmount\n  /**\n   * The cost of the bridge transaction\n   * sentAmount - adjustedReturn\n   */\n  cost: Omit<TokenAmountValuesSerialized, 'amount'>;\n};\n\nexport type StartPollingForBridgeTxStatusArgs = {\n  bridgeTxMeta?: TransactionMeta;\n  statusRequest: StatusRequest;\n  quoteResponse: QuoteResponse & QuoteMetadata;\n  startTime?: BridgeHistoryItem['startTime'];\n  slippagePercentage: BridgeHistoryItem['slippagePercentage'];\n  initialDestAssetBalance?: BridgeHistoryItem['initialDestAssetBalance'];\n  targetContractAddress?: BridgeHistoryItem['targetContractAddress'];\n  approvalTxId?: BridgeHistoryItem['approvalTxId'];\n  isStxEnabled?: BridgeHistoryItem['isStxEnabled'];\n  location?: BridgeHistoryItem['location'];\n  accountAddress: string;\n};\n\n/**\n * Chrome: The BigNumber values are automatically serialized to strings when sent to the background\n * Firefox: The BigNumber values are not serialized to strings when sent to the background,\n * so we force the ui to do it manually, by using StartPollingForBridgeTxStatusArgsSerialized type on the startPollingForBridgeTxStatus action\n */\nexport type StartPollingForBridgeTxStatusArgsSerialized = Omit<\n  StartPollingForBridgeTxStatusArgs,\n  'quoteResponse'\n> & {\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>;\n};\n\nexport type SourceChainTxMetaId = string;\n\nexport type BridgeStatusControllerState = {\n  txHistory: Record<SourceChainTxMetaId, BridgeHistoryItem>;\n};\n\n// Actions\ntype BridgeStatusControllerAction<\n  FunctionName extends keyof BridgeStatusController,\n> = {\n  type: `${typeof BRIDGE_STATUS_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeStatusController[FunctionName];\n};\n\nexport type BridgeStatusControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeStatusControllerStartPollingForBridgeTxStatusAction =\n  BridgeStatusControllerAction<'startPollingForBridgeTxStatus'>;\n\nexport type BridgeStatusControllerWipeBridgeStatusAction =\n  BridgeStatusControllerAction<'wipeBridgeStatus'>;\n\nexport type BridgeStatusControllerResetStateAction =\n  BridgeStatusControllerAction<'resetState'>;\n\nexport type BridgeStatusControllerSubmitTxAction =\n  BridgeStatusControllerAction<'submitTx'>;\n\nexport type BridgeStatusControllerSubmitIntentAction =\n  BridgeStatusControllerAction<'submitIntent'>;\n\nexport type BridgeStatusControllerRestartPollingForFailedAttemptsAction =\n  BridgeStatusControllerAction<'restartPollingForFailedAttempts'>;\n\nexport type BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction =\n  BridgeStatusControllerAction<'getBridgeHistoryItemByTxMetaId'>;\n\nexport type BridgeStatusControllerActions =\n  | BridgeStatusControllerStartPollingForBridgeTxStatusAction\n  | BridgeStatusControllerWipeBridgeStatusAction\n  | BridgeStatusControllerResetStateAction\n  | BridgeStatusControllerGetStateAction\n  | BridgeStatusControllerSubmitTxAction\n  | BridgeStatusControllerSubmitIntentAction\n  | BridgeStatusControllerRestartPollingForFailedAttemptsAction\n  | BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction;\n\n// Events\nexport type BridgeStatusControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n/**\n * This event is published when the destination bridge transaction is completed\n * The payload is the asset received on the destination chain\n */\nexport type BridgeStatusControllerDestinationTransactionCompletedEvent = {\n  type: 'BridgeStatusController:destinationTransactionCompleted';\n  payload: [CaipAssetType];\n};\n\nexport type BridgeStatusControllerEvents =\n  | BridgeStatusControllerStateChangeEvent\n  | BridgeStatusControllerDestinationTransactionCompletedEvent;\n\n/**\n * The external actions available to the BridgeStatusController.\n */\ntype AllowedActions =\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | HandleSnapRequest\n  | TransactionControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | GetGasFeeState\n  | AccountsControllerGetAccountByAddressAction\n  | RemoteFeatureFlagControllerGetStateAction;\n\n/**\n * The external events available to the BridgeStatusController.\n */\ntype AllowedEvents =\n  | TransactionControllerTransactionFailedEvent\n  | TransactionControllerTransactionConfirmedEvent;\n\n/**\n * The messenger for the BridgeStatusController.\n */\nexport type BridgeStatusControllerMessenger = Messenger<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerActions | AllowedActions,\n  BridgeStatusControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
+{"version":3,"file":"types.mjs","sourceRoot":"","sources":["../src/types.ts"],"names":[],"mappings":"AAmCA,OAAO,EAAE,6BAA6B,EAAE,wBAAoB;AAG5D,8EAA8E;AAC9E,2BAA2B;AAE3B,MAAM,CAAN,IAAY,cAGX;AAHD,WAAY,cAAc;IACxB,yCAAuB,CAAA;IACvB,mCAAiB,CAAA;AACnB,CAAC,EAHW,cAAc,KAAd,cAAc,QAGzB;AAyCD,MAAM,CAAN,IAAY,QAaX;AAbD,WAAY,QAAQ;IAClB,uBAAW,CAAA;IACX,2BAAe,CAAA;IACf,uCAA2B,CAAA;IAC3B,+BAAmB,CAAA;IACnB,+BAAmB,CAAA;IACnB,mCAAuB,CAAA;IACvB,qCAAyB,CAAA;IACzB,6BAAiB,CAAA;IACjB,6BAAiB,CAAA;IACjB,iCAAqB,CAAA;IACrB,2BAAe,CAAA;IACf,2BAAe,CAAA;AACjB,CAAC,EAbW,QAAQ,KAAR,QAAQ,QAanB;AAwDD,MAAM,CAAN,IAAY,kBASX;AATD,WAAY,kBAAkB;IAC5B,qFAA+D,CAAA;IAC/D,2DAAqC,CAAA;IACrC,2CAAqB,CAAA;IACrB,+CAAyB,CAAA;IACzB,2CAAqB,CAAA;IACrB,mDAA6B,CAAA;IAC7B,yFAAmE,CAAA;IACnE,uFAAiE,CAAA;AACnE,CAAC,EATW,kBAAkB,KAAlB,kBAAkB,QAS7B","sourcesContent":["import type { AccountsControllerGetAccountByAddressAction } from '@metamask/accounts-controller';\nimport type {\n  ControllerGetStateAction,\n  ControllerStateChangeEvent,\n} from '@metamask/base-controller';\nimport type {\n  BridgeBackgroundAction,\n  BridgeControllerAction,\n  ChainId,\n  FeatureId,\n  Quote,\n  QuoteMetadata,\n  QuoteResponse,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type { GetGasFeeState } from '@metamask/gas-fee-controller';\nimport type { Messenger } from '@metamask/messenger';\nimport type {\n  NetworkControllerFindNetworkClientIdByChainIdAction,\n  NetworkControllerGetNetworkClientByIdAction,\n  NetworkControllerGetStateAction,\n} from '@metamask/network-controller';\nimport type { AuthenticationControllerGetBearerToken } from '@metamask/profile-sync-controller/auth';\nimport type { RemoteFeatureFlagControllerGetStateAction } from '@metamask/remote-feature-flag-controller';\nimport type { HandleSnapRequest } from '@metamask/snaps-controllers';\nimport type { Infer } from '@metamask/superstruct';\nimport type {\n  TransactionControllerGetStateAction,\n  TransactionControllerTransactionConfirmedEvent,\n  TransactionControllerTransactionFailedEvent,\n  TransactionMeta,\n} from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\n\nimport type { BridgeStatusController } from './bridge-status-controller';\nimport { BRIDGE_STATUS_CONTROLLER_NAME } from './constants';\nimport type { StatusResponseSchema } from './utils/validators';\n\n// All fields need to be types not interfaces, same with their children fields\n// o/w you get a type error\n\nexport enum BridgeClientId {\n  EXTENSION = 'extension',\n  MOBILE = 'mobile',\n}\n\nexport type FetchFunction = (\n  input: RequestInfo | URL,\n  init?: RequestInit,\n) => Promise<unknown>;\n\n/**\n * These fields are specific to Solana transactions and can likely be infered from TransactionMeta\n *\n * @deprecated these should be removed eventually\n */\nexport type SolanaTransactionMeta = {\n  isSolana: boolean;\n  isBridgeTx: boolean;\n};\n\nexport type StatusRequest = {\n  bridgeId: string; // lifi, socket, squid\n  srcTxHash?: string; // lifi, socket, squid, might be undefined for STX\n  bridge: string; // lifi, socket, squid\n  srcChainId: ChainId; // lifi, socket, squid\n  destChainId: ChainId; // lifi, socket, squid\n  quote?: Quote; // squid\n  refuel?: boolean; // lifi\n};\n\nexport type StatusRequestDto = Omit<\n  StatusRequest,\n  'quote' | 'srcChainId' | 'destChainId' | 'refuel'\n> & {\n  srcChainId: string; // lifi, socket, squid\n  destChainId: string; // lifi, socket, squid\n  requestId?: string;\n  refuel?: string; // lifi\n};\n\nexport type StatusRequestWithSrcTxHash = StatusRequest & {\n  srcTxHash: string;\n};\n\nexport enum BridgeId {\n  HOP = 'hop',\n  CELER = 'celer',\n  CELERCIRCLE = 'celercircle',\n  CONNEXT = 'connext',\n  POLYGON = 'polygon',\n  AVALANCHE = 'avalanche',\n  MULTICHAIN = 'multichain',\n  AXELAR = 'axelar',\n  ACROSS = 'across',\n  STARGATE = 'stargate',\n  RELAY = 'relay',\n  MAYAN = 'mayan',\n}\n\nexport type StatusResponse = Infer<typeof StatusResponseSchema>;\n\nexport type RefuelStatusResponse = object & StatusResponse;\n\nexport type BridgeHistoryItem = {\n  txMetaId?: string; // Optional: not available pre-submission or on sync failure\n  actionId?: string; // Only for non-batch EVM transactions\n  originalTransactionId?: string; // Keep original transaction ID for intent transactions\n  batchId?: string;\n  quote: Quote;\n  status: StatusResponse;\n  startTime?: number; // timestamp in ms\n  estimatedProcessingTimeInSeconds: number;\n  slippagePercentage: number;\n  completionTime?: number; // timestamp in ms\n  pricingData?: {\n    /**\n     * The actual amount sent by user in non-atomic decimal form\n     */\n    amountSent: QuoteMetadata['sentAmount']['amount'];\n    amountSentInUsd?: QuoteMetadata['sentAmount']['usd'];\n    quotedGasInUsd?: QuoteMetadata['gasFee']['effective']['usd'];\n    quotedGasAmount?: QuoteMetadata['gasFee']['effective']['amount'];\n    quotedReturnInUsd?: QuoteMetadata['toTokenAmount']['usd'];\n    quotedRefuelSrcAmountInUsd?: string;\n    quotedRefuelDestAmountInUsd?: string;\n  };\n  initialDestAssetBalance?: string;\n  targetContractAddress?: string;\n  account: string;\n  hasApprovalTx: boolean;\n  approvalTxId?: string;\n  featureId?: FeatureId;\n  isStxEnabled?: boolean;\n  /**\n   * The location/entry point from which the user initiated the swap or bridge.\n   * Used to attribute swaps to specific flows (e.g. Trending Explore).\n   */\n  location?: MetaMetricsSwapsEventSource;\n  /**\n   * A/B test context to attribute swap/bridge events to specific experiments.\n   * Keys are test names, values are variant names (e.g. { token_details_layout: 'treatment' }).\n   */\n  abTests?: Record<string, string>;\n  /**\n   * Attempts tracking for exponential backoff on failed fetches.\n   * We track the number of attempts and the last attempt time for each txMetaId that has failed at least once\n   */\n  attempts?: {\n    counter: number;\n    lastAttemptTime: number; // timestamp in ms\n  };\n};\n\nexport enum BridgeStatusAction {\n  StartPollingForBridgeTxStatus = 'StartPollingForBridgeTxStatus',\n  WipeBridgeStatus = 'WipeBridgeStatus',\n  GetState = 'GetState',\n  ResetState = 'ResetState',\n  SubmitTx = 'SubmitTx',\n  SubmitIntent = 'SubmitIntent',\n  RestartPollingForFailedAttempts = 'RestartPollingForFailedAttempts',\n  GetBridgeHistoryItemByTxMetaId = 'GetBridgeHistoryItemByTxMetaId',\n}\n\nexport type TokenAmountValuesSerialized = {\n  amount: string;\n  valueInCurrency: string | null;\n  usd: string | null;\n};\n\nexport type QuoteMetadataSerialized = {\n  gasFee: TokenAmountValuesSerialized;\n  /**\n   * The total network fee for the bridge transaction\n   * estimatedGasFees + relayerFees\n   */\n  totalNetworkFee: TokenAmountValuesSerialized;\n  /**\n   * The total max network fee for the bridge transaction\n   * maxGasFees + relayerFees\n   */\n  totalMaxNetworkFee: TokenAmountValuesSerialized;\n  toTokenAmount: TokenAmountValuesSerialized;\n  /**\n   * The adjusted return for the bridge transaction\n   * destTokenAmount - totalNetworkFee\n   */\n  adjustedReturn: Omit<TokenAmountValuesSerialized, 'amount'>;\n  /**\n   * The actual amount sent by user in non-atomic decimal form\n   * srcTokenAmount + metabridgeFee\n   */\n  sentAmount: TokenAmountValuesSerialized;\n  swapRate: string; // destTokenAmount / sentAmount\n  /**\n   * The cost of the bridge transaction\n   * sentAmount - adjustedReturn\n   */\n  cost: Omit<TokenAmountValuesSerialized, 'amount'>;\n};\n\nexport type StartPollingForBridgeTxStatusArgs = {\n  bridgeTxMeta?: TransactionMeta;\n  statusRequest: StatusRequest;\n  quoteResponse: QuoteResponse & QuoteMetadata;\n  startTime?: BridgeHistoryItem['startTime'];\n  slippagePercentage: BridgeHistoryItem['slippagePercentage'];\n  initialDestAssetBalance?: BridgeHistoryItem['initialDestAssetBalance'];\n  targetContractAddress?: BridgeHistoryItem['targetContractAddress'];\n  approvalTxId?: BridgeHistoryItem['approvalTxId'];\n  isStxEnabled?: BridgeHistoryItem['isStxEnabled'];\n  location?: BridgeHistoryItem['location'];\n  abTests?: BridgeHistoryItem['abTests'];\n  accountAddress: string;\n};\n\n/**\n * Chrome: The BigNumber values are automatically serialized to strings when sent to the background\n * Firefox: The BigNumber values are not serialized to strings when sent to the background,\n * so we force the ui to do it manually, by using StartPollingForBridgeTxStatusArgsSerialized type on the startPollingForBridgeTxStatus action\n */\nexport type StartPollingForBridgeTxStatusArgsSerialized = Omit<\n  StartPollingForBridgeTxStatusArgs,\n  'quoteResponse'\n> & {\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>;\n};\n\nexport type SourceChainTxMetaId = string;\n\nexport type BridgeStatusControllerState = {\n  txHistory: Record<SourceChainTxMetaId, BridgeHistoryItem>;\n};\n\n// Actions\ntype BridgeStatusControllerAction<\n  FunctionName extends keyof BridgeStatusController,\n> = {\n  type: `${typeof BRIDGE_STATUS_CONTROLLER_NAME}:${FunctionName}`;\n  handler: BridgeStatusController[FunctionName];\n};\n\nexport type BridgeStatusControllerGetStateAction = ControllerGetStateAction<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n\n// Maps to BridgeController function names\nexport type BridgeStatusControllerStartPollingForBridgeTxStatusAction =\n  BridgeStatusControllerAction<'startPollingForBridgeTxStatus'>;\n\nexport type BridgeStatusControllerWipeBridgeStatusAction =\n  BridgeStatusControllerAction<'wipeBridgeStatus'>;\n\nexport type BridgeStatusControllerResetStateAction =\n  BridgeStatusControllerAction<'resetState'>;\n\nexport type BridgeStatusControllerSubmitTxAction =\n  BridgeStatusControllerAction<'submitTx'>;\n\nexport type BridgeStatusControllerSubmitIntentAction =\n  BridgeStatusControllerAction<'submitIntent'>;\n\nexport type BridgeStatusControllerRestartPollingForFailedAttemptsAction =\n  BridgeStatusControllerAction<'restartPollingForFailedAttempts'>;\n\nexport type BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction =\n  BridgeStatusControllerAction<'getBridgeHistoryItemByTxMetaId'>;\n\nexport type BridgeStatusControllerActions =\n  | BridgeStatusControllerStartPollingForBridgeTxStatusAction\n  | BridgeStatusControllerWipeBridgeStatusAction\n  | BridgeStatusControllerResetStateAction\n  | BridgeStatusControllerGetStateAction\n  | BridgeStatusControllerSubmitTxAction\n  | BridgeStatusControllerSubmitIntentAction\n  | BridgeStatusControllerRestartPollingForFailedAttemptsAction\n  | BridgeStatusControllerGetBridgeHistoryItemByTxMetaIdAction;\n\n// Events\nexport type BridgeStatusControllerStateChangeEvent = ControllerStateChangeEvent<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerState\n>;\n/**\n * This event is published when the destination bridge transaction is completed\n * The payload is the asset received on the destination chain\n */\nexport type BridgeStatusControllerDestinationTransactionCompletedEvent = {\n  type: 'BridgeStatusController:destinationTransactionCompleted';\n  payload: [CaipAssetType];\n};\n\nexport type BridgeStatusControllerEvents =\n  | BridgeStatusControllerStateChangeEvent\n  | BridgeStatusControllerDestinationTransactionCompletedEvent;\n\n/**\n * The external actions available to the BridgeStatusController.\n */\ntype AllowedActions =\n  | NetworkControllerFindNetworkClientIdByChainIdAction\n  | NetworkControllerGetStateAction\n  | NetworkControllerGetNetworkClientByIdAction\n  | HandleSnapRequest\n  | TransactionControllerGetStateAction\n  | BridgeControllerAction<BridgeBackgroundAction.TRACK_METAMETRICS_EVENT>\n  | BridgeControllerAction<BridgeBackgroundAction.STOP_POLLING_FOR_QUOTES>\n  | GetGasFeeState\n  | AccountsControllerGetAccountByAddressAction\n  | RemoteFeatureFlagControllerGetStateAction\n  | AuthenticationControllerGetBearerToken;\n\n/**\n * The external events available to the BridgeStatusController.\n */\ntype AllowedEvents =\n  | TransactionControllerTransactionFailedEvent\n  | TransactionControllerTransactionConfirmedEvent;\n\n/**\n * The messenger for the BridgeStatusController.\n */\nexport type BridgeStatusControllerMessenger = Messenger<\n  typeof BRIDGE_STATUS_CONTROLLER_NAME,\n  BridgeStatusControllerActions | AllowedActions,\n  BridgeStatusControllerEvents | AllowedEvents\n>;\n"]}
\ No newline at end of file
diff --git a/dist/utils/bridge-status.cjs b/dist/utils/bridge-status.cjs
index 08fd9b683bf3ebe2404bb219134f5b85d1ccbd56..21b6f7bc5f72cd0e5b6fd8d4e057eb0a22b88e7f 100644
--- a/dist/utils/bridge-status.cjs
+++ b/dist/utils/bridge-status.cjs
@@ -1,13 +1,10 @@
 "use strict";
 Object.defineProperty(exports, "__esModule", { value: true });
-exports.shouldSkipFetchDueToFetchFailures = exports.getStatusRequestWithSrcTxHash = exports.fetchBridgeTxStatus = exports.getStatusRequestDto = exports.getBridgeStatusUrl = exports.getClientIdHeader = void 0;
+exports.shouldSkipFetchDueToFetchFailures = exports.getStatusRequestWithSrcTxHash = exports.fetchBridgeTxStatus = exports.getStatusRequestDto = exports.getBridgeStatusUrl = void 0;
+const bridge_controller_1 = require("@metamask/bridge-controller");
 const superstruct_1 = require("@metamask/superstruct");
 const validators_1 = require("./validators.cjs");
 const constants_1 = require("../constants.cjs");
-const getClientIdHeader = (clientId) => ({
-    'X-Client-Id': clientId,
-});
-exports.getClientIdHeader = getClientIdHeader;
 const getBridgeStatusUrl = (bridgeApiBaseUrl) => `${bridgeApiBaseUrl}/getTxStatus`;
 exports.getBridgeStatusUrl = getBridgeStatusUrl;
 const getStatusRequestDto = (statusRequest) => {
@@ -23,13 +20,13 @@ const getStatusRequestDto = (statusRequest) => {
     };
 };
 exports.getStatusRequestDto = getStatusRequestDto;
-const fetchBridgeTxStatus = async (statusRequest, clientId, fetchFn, bridgeApiBaseUrl) => {
+const fetchBridgeTxStatus = async (statusRequest, clientId, jwt, fetchFn, bridgeApiBaseUrl) => {
     const statusRequestDto = (0, exports.getStatusRequestDto)(statusRequest);
     const params = new URLSearchParams(statusRequestDto);
     // Fetch
     const url = `${(0, exports.getBridgeStatusUrl)(bridgeApiBaseUrl)}?${params.toString()}`;
     const rawTxStatus = await fetchFn(url, {
-        headers: (0, exports.getClientIdHeader)(clientId),
+        headers: (0, bridge_controller_1.getClientHeaders)({ clientId, jwt }),
     });
     const validationFailures = [];
     try {
@@ -39,11 +36,10 @@ const fetchBridgeTxStatus = async (statusRequest, clientId, fetchFn, bridgeApiBa
         // Build validation failure event properties
         if (error instanceof superstruct_1.StructError) {
             error.failures().forEach(({ branch, path }) => {
-                const aggregatorId = branch?.[0]?.quote?.bridgeId ||
-                    branch?.[0]?.quote?.bridges?.[0] ||
-                    rawTxStatus?.bridge ||
-                    statusRequest.bridge ||
-                    statusRequest.bridgeId ||
+                const aggregatorId = branch?.[0]?.quote?.bridgeId ??
+                    branch?.[0]?.quote?.bridges?.[0] ??
+                    rawTxStatus?.bridge ??
+                    (statusRequest.bridge || statusRequest.bridgeId) ??
                     'unknown';
                 const pathString = path?.join('.') || 'unknown';
                 validationFailures.push([aggregatorId, pathString].join('|'));
diff --git a/dist/utils/bridge-status.cjs.map b/dist/utils/bridge-status.cjs.map
index f333b4ec14041fec25882e5e54609ada14a13019..3abf8acaf9c53c452f1ec13d427a3338b34cf1b4 100644
--- a/dist/utils/bridge-status.cjs.map
+++ b/dist/utils/bridge-status.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status.cjs","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Quote } from '@metamask/bridge-controller';\nimport { StructError } from '@metamask/superstruct';\n\nimport { validateBridgeStatusResponse } from './validators';\nimport { REFRESH_INTERVAL_MS } from '../constants';\nimport type {\n  StatusResponse,\n  StatusRequestWithSrcTxHash,\n  StatusRequestDto,\n  FetchFunction,\n  BridgeHistoryItem,\n} from '../types';\n\nexport const getClientIdHeader = (clientId: string) => ({\n  'X-Client-Id': clientId,\n});\n\nexport const getBridgeStatusUrl = (bridgeApiBaseUrl: string) =>\n  `${bridgeApiBaseUrl}/getTxStatus`;\n\nexport const getStatusRequestDto = (\n  statusRequest: StatusRequestWithSrcTxHash,\n): StatusRequestDto => {\n  const { quote, ...statusRequestNoQuote } = statusRequest;\n\n  const statusRequestNoQuoteFormatted = Object.fromEntries(\n    Object.entries(statusRequestNoQuote).map(([key, value]) => [\n      key,\n      value.toString(),\n    ]),\n  ) as unknown as Omit<StatusRequestDto, 'requestId'>;\n\n  const requestId: { requestId: string } | Record<string, never> =\n    quote?.requestId ? { requestId: quote.requestId } : {};\n\n  return {\n    ...statusRequestNoQuoteFormatted,\n    ...requestId,\n  };\n};\n\nexport const fetchBridgeTxStatus = async (\n  statusRequest: StatusRequestWithSrcTxHash,\n  clientId: string,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n): Promise<{ status: StatusResponse; validationFailures: string[] }> => {\n  const statusRequestDto = getStatusRequestDto(statusRequest);\n  const params = new URLSearchParams(statusRequestDto);\n\n  // Fetch\n  const url = `${getBridgeStatusUrl(bridgeApiBaseUrl)}?${params.toString()}`;\n\n  const rawTxStatus: unknown = await fetchFn(url, {\n    headers: getClientIdHeader(clientId),\n  });\n\n  const validationFailures: string[] = [];\n\n  try {\n    validateBridgeStatusResponse(rawTxStatus);\n  } catch (error) {\n    // Build validation failure event properties\n    if (error instanceof StructError) {\n      error.failures().forEach(({ branch, path }) => {\n        const aggregatorId =\n          branch?.[0]?.quote?.bridgeId ||\n          branch?.[0]?.quote?.bridges?.[0] ||\n          (rawTxStatus as StatusResponse)?.bridge ||\n          statusRequest.bridge ||\n          statusRequest.bridgeId ||\n          'unknown';\n        const pathString = path?.join('.') || 'unknown';\n        validationFailures.push([aggregatorId, pathString].join('|'));\n      });\n    }\n  }\n  return {\n    status: rawTxStatus as StatusResponse,\n    validationFailures,\n  };\n};\n\nexport const getStatusRequestWithSrcTxHash = (\n  quote: Quote,\n  srcTxHash: string,\n): StatusRequestWithSrcTxHash => {\n  const { bridgeId, bridges, srcChainId, destChainId, refuel } = quote;\n  return {\n    bridgeId,\n    srcTxHash,\n    bridge: bridges[0],\n    srcChainId,\n    destChainId,\n    quote,\n    refuel: Boolean(refuel),\n  };\n};\n\nexport const shouldSkipFetchDueToFetchFailures = (\n  attempts?: BridgeHistoryItem['attempts'],\n) => {\n  // If there's an attempt, it means we've failed at least once,\n  // so we need to check if we need to wait longer due to exponential backoff\n  if (attempts) {\n    // Calculate exponential backoff delay: base interval * 2^(attempts-1)\n    const backoffDelay =\n      REFRESH_INTERVAL_MS * Math.pow(2, attempts.counter - 1);\n    const timeSinceLastAttempt = Date.now() - attempts.lastAttemptTime;\n\n    if (timeSinceLastAttempt < backoffDelay) {\n      // Not enough time has passed, skip this fetch\n      return true;\n    }\n  }\n  return false;\n};\n"]}
\ No newline at end of file
+{"version":3,"file":"bridge-status.cjs","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"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","sourcesContent":["import { getClientHeaders } from '@metamask/bridge-controller';\nimport type { Quote } from '@metamask/bridge-controller';\nimport { StructError } from '@metamask/superstruct';\n\nimport { validateBridgeStatusResponse } from './validators';\nimport { REFRESH_INTERVAL_MS } from '../constants';\nimport type {\n  StatusResponse,\n  StatusRequestWithSrcTxHash,\n  StatusRequestDto,\n  FetchFunction,\n  BridgeHistoryItem,\n} from '../types';\n\nexport const getBridgeStatusUrl = (bridgeApiBaseUrl: string): string =>\n  `${bridgeApiBaseUrl}/getTxStatus`;\n\nexport const getStatusRequestDto = (\n  statusRequest: StatusRequestWithSrcTxHash,\n): StatusRequestDto => {\n  const { quote, ...statusRequestNoQuote } = statusRequest;\n\n  const statusRequestNoQuoteFormatted = Object.fromEntries(\n    Object.entries(statusRequestNoQuote).map(([key, value]) => [\n      key,\n      value.toString(),\n    ]),\n  ) as unknown as Omit<StatusRequestDto, 'requestId'>;\n\n  const requestId: { requestId: string } | Record<string, never> =\n    quote?.requestId ? { requestId: quote.requestId } : {};\n\n  return {\n    ...statusRequestNoQuoteFormatted,\n    ...requestId,\n  };\n};\n\nexport const fetchBridgeTxStatus = async (\n  statusRequest: StatusRequestWithSrcTxHash,\n  clientId: string,\n  jwt: string | undefined,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n): Promise<{ status: StatusResponse; validationFailures: string[] }> => {\n  const statusRequestDto = getStatusRequestDto(statusRequest);\n  const params = new URLSearchParams(statusRequestDto);\n\n  // Fetch\n  const url = `${getBridgeStatusUrl(bridgeApiBaseUrl)}?${params.toString()}`;\n\n  const rawTxStatus: unknown = await fetchFn(url, {\n    headers: getClientHeaders({ clientId, jwt }),\n  });\n\n  const validationFailures: string[] = [];\n\n  try {\n    validateBridgeStatusResponse(rawTxStatus);\n  } catch (error) {\n    // Build validation failure event properties\n    if (error instanceof StructError) {\n      error.failures().forEach(({ branch, path }) => {\n        const aggregatorId =\n          branch?.[0]?.quote?.bridgeId ??\n          branch?.[0]?.quote?.bridges?.[0] ??\n          (rawTxStatus as StatusResponse)?.bridge ??\n          (statusRequest.bridge || statusRequest.bridgeId) ??\n          ('unknown' as string);\n        const pathString = path?.join('.') || 'unknown';\n        validationFailures.push([aggregatorId, pathString].join('|'));\n      });\n    }\n  }\n  return {\n    status: rawTxStatus as StatusResponse,\n    validationFailures,\n  };\n};\n\nexport const getStatusRequestWithSrcTxHash = (\n  quote: Quote,\n  srcTxHash: string,\n): StatusRequestWithSrcTxHash => {\n  const { bridgeId, bridges, srcChainId, destChainId, refuel } = quote;\n  return {\n    bridgeId,\n    srcTxHash,\n    bridge: bridges[0],\n    srcChainId,\n    destChainId,\n    quote,\n    refuel: Boolean(refuel),\n  };\n};\n\nexport const shouldSkipFetchDueToFetchFailures = (\n  attempts?: BridgeHistoryItem['attempts'],\n): boolean => {\n  // If there's an attempt, it means we've failed at least once,\n  // so we need to check if we need to wait longer due to exponential backoff\n  if (attempts) {\n    // Calculate exponential backoff delay: base interval * 2^(attempts-1)\n    const backoffDelay =\n      REFRESH_INTERVAL_MS * Math.pow(2, attempts.counter - 1);\n    const timeSinceLastAttempt = Date.now() - attempts.lastAttemptTime;\n\n    if (timeSinceLastAttempt < backoffDelay) {\n      // Not enough time has passed, skip this fetch\n      return true;\n    }\n  }\n  return false;\n};\n"]}
\ No newline at end of file
diff --git a/dist/utils/bridge-status.d.cts b/dist/utils/bridge-status.d.cts
index 586634c60d785af1c9bf05cc162f40260c75f24d..d15d78a2506cb2eafee506b01e3dcfa48e58e636 100644
--- a/dist/utils/bridge-status.d.cts
+++ b/dist/utils/bridge-status.d.cts
@@ -1,11 +1,8 @@
 import type { Quote } from "@metamask/bridge-controller";
 import type { StatusResponse, StatusRequestWithSrcTxHash, StatusRequestDto, FetchFunction, BridgeHistoryItem } from "../types.cjs";
-export declare const getClientIdHeader: (clientId: string) => {
-    'X-Client-Id': string;
-};
 export declare const getBridgeStatusUrl: (bridgeApiBaseUrl: string) => string;
 export declare const getStatusRequestDto: (statusRequest: StatusRequestWithSrcTxHash) => StatusRequestDto;
-export declare const fetchBridgeTxStatus: (statusRequest: StatusRequestWithSrcTxHash, clientId: string, fetchFn: FetchFunction, bridgeApiBaseUrl: string) => Promise<{
+export declare const fetchBridgeTxStatus: (statusRequest: StatusRequestWithSrcTxHash, clientId: string, jwt: string | undefined, fetchFn: FetchFunction, bridgeApiBaseUrl: string) => Promise<{
     status: StatusResponse;
     validationFailures: string[];
 }>;
diff --git a/dist/utils/bridge-status.d.cts.map b/dist/utils/bridge-status.d.cts.map
index d61894d0359b6a8dac5d7fb580ce02ff5df49b29..736f3626d80d11ec699f83537b9f7d758d9fd9f0 100644
--- a/dist/utils/bridge-status.d.cts.map
+++ b/dist/utils/bridge-status.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status.d.cts","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,KAAK,EAAE,oCAAoC;AAKzD,OAAO,KAAK,EACV,cAAc,EACd,0BAA0B,EAC1B,gBAAgB,EAChB,aAAa,EACb,iBAAiB,EAClB,qBAAiB;AAElB,eAAO,MAAM,iBAAiB,aAAc,MAAM;;CAEhD,CAAC;AAEH,eAAO,MAAM,kBAAkB,qBAAsB,MAAM,WACxB,CAAC;AAEpC,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,KACxC,gBAiBF,CAAC;AAEF,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,YAC/B,MAAM,WACP,aAAa,oBACJ,MAAM;YACL,cAAc;wBAAsB,MAAM,EAAE;EAmChE,CAAC;AAEF,eAAO,MAAM,6BAA6B,UACjC,KAAK,aACD,MAAM,KAChB,0BAWF,CAAC;AAEF,eAAO,MAAM,iCAAiC,cACjC,iBAAiB,CAAC,UAAU,CAAC,YAgBzC,CAAC"}
\ No newline at end of file
+{"version":3,"file":"bridge-status.d.cts","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,EAAE,KAAK,EAAE,oCAAoC;AAKzD,OAAO,KAAK,EACV,cAAc,EACd,0BAA0B,EAC1B,gBAAgB,EAChB,aAAa,EACb,iBAAiB,EAClB,qBAAiB;AAElB,eAAO,MAAM,kBAAkB,qBAAsB,MAAM,KAAG,MAC3B,CAAC;AAEpC,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,KACxC,gBAiBF,CAAC;AAEF,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,YAC/B,MAAM,OACX,MAAM,GAAG,SAAS,WACd,aAAa,oBACJ,MAAM;YACL,cAAc;wBAAsB,MAAM,EAAE;EAkChE,CAAC;AAEF,eAAO,MAAM,6BAA6B,UACjC,KAAK,aACD,MAAM,KAChB,0BAWF,CAAC;AAEF,eAAO,MAAM,iCAAiC,cACjC,iBAAiB,CAAC,UAAU,CAAC,KACvC,OAeF,CAAC"}
\ No newline at end of file
diff --git a/dist/utils/bridge-status.d.mts b/dist/utils/bridge-status.d.mts
index 644a8750f36c1d7bbc593bff1fea7ec20856f303..42055477fb6fe228aad772627b9eb683b3de4ff2 100644
--- a/dist/utils/bridge-status.d.mts
+++ b/dist/utils/bridge-status.d.mts
@@ -1,11 +1,8 @@
 import type { Quote } from "@metamask/bridge-controller";
 import type { StatusResponse, StatusRequestWithSrcTxHash, StatusRequestDto, FetchFunction, BridgeHistoryItem } from "../types.mjs";
-export declare const getClientIdHeader: (clientId: string) => {
-    'X-Client-Id': string;
-};
 export declare const getBridgeStatusUrl: (bridgeApiBaseUrl: string) => string;
 export declare const getStatusRequestDto: (statusRequest: StatusRequestWithSrcTxHash) => StatusRequestDto;
-export declare const fetchBridgeTxStatus: (statusRequest: StatusRequestWithSrcTxHash, clientId: string, fetchFn: FetchFunction, bridgeApiBaseUrl: string) => Promise<{
+export declare const fetchBridgeTxStatus: (statusRequest: StatusRequestWithSrcTxHash, clientId: string, jwt: string | undefined, fetchFn: FetchFunction, bridgeApiBaseUrl: string) => Promise<{
     status: StatusResponse;
     validationFailures: string[];
 }>;
diff --git a/dist/utils/bridge-status.d.mts.map b/dist/utils/bridge-status.d.mts.map
index cbbbc58157de56f67c2e3c1f79a7e45cd8de8c40..9be4ff6381f6f09cf3b5e555941c8c78126efbf8 100644
--- a/dist/utils/bridge-status.d.mts.map
+++ b/dist/utils/bridge-status.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status.d.mts","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,KAAK,EAAE,oCAAoC;AAKzD,OAAO,KAAK,EACV,cAAc,EACd,0BAA0B,EAC1B,gBAAgB,EAChB,aAAa,EACb,iBAAiB,EAClB,qBAAiB;AAElB,eAAO,MAAM,iBAAiB,aAAc,MAAM;;CAEhD,CAAC;AAEH,eAAO,MAAM,kBAAkB,qBAAsB,MAAM,WACxB,CAAC;AAEpC,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,KACxC,gBAiBF,CAAC;AAEF,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,YAC/B,MAAM,WACP,aAAa,oBACJ,MAAM;YACL,cAAc;wBAAsB,MAAM,EAAE;EAmChE,CAAC;AAEF,eAAO,MAAM,6BAA6B,UACjC,KAAK,aACD,MAAM,KAChB,0BAWF,CAAC;AAEF,eAAO,MAAM,iCAAiC,cACjC,iBAAiB,CAAC,UAAU,CAAC,YAgBzC,CAAC"}
\ No newline at end of file
+{"version":3,"file":"bridge-status.d.mts","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,EAAE,KAAK,EAAE,oCAAoC;AAKzD,OAAO,KAAK,EACV,cAAc,EACd,0BAA0B,EAC1B,gBAAgB,EAChB,aAAa,EACb,iBAAiB,EAClB,qBAAiB;AAElB,eAAO,MAAM,kBAAkB,qBAAsB,MAAM,KAAG,MAC3B,CAAC;AAEpC,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,KACxC,gBAiBF,CAAC;AAEF,eAAO,MAAM,mBAAmB,kBACf,0BAA0B,YAC/B,MAAM,OACX,MAAM,GAAG,SAAS,WACd,aAAa,oBACJ,MAAM;YACL,cAAc;wBAAsB,MAAM,EAAE;EAkChE,CAAC;AAEF,eAAO,MAAM,6BAA6B,UACjC,KAAK,aACD,MAAM,KAChB,0BAWF,CAAC;AAEF,eAAO,MAAM,iCAAiC,cACjC,iBAAiB,CAAC,UAAU,CAAC,KACvC,OAeF,CAAC"}
\ No newline at end of file
diff --git a/dist/utils/bridge-status.mjs b/dist/utils/bridge-status.mjs
index a7469777631fb95c3eaa56ab8ccbdbfb2924da07..d2724dc3658c84a9f5f209c68cd832d87ce5c878 100644
--- a/dist/utils/bridge-status.mjs
+++ b/dist/utils/bridge-status.mjs
@@ -1,9 +1,7 @@
+import { getClientHeaders } from "@metamask/bridge-controller";
 import { StructError } from "@metamask/superstruct";
 import { validateBridgeStatusResponse } from "./validators.mjs";
 import { REFRESH_INTERVAL_MS } from "../constants.mjs";
-export const getClientIdHeader = (clientId) => ({
-    'X-Client-Id': clientId,
-});
 export const getBridgeStatusUrl = (bridgeApiBaseUrl) => `${bridgeApiBaseUrl}/getTxStatus`;
 export const getStatusRequestDto = (statusRequest) => {
     const { quote, ...statusRequestNoQuote } = statusRequest;
@@ -17,13 +15,13 @@ export const getStatusRequestDto = (statusRequest) => {
         ...requestId,
     };
 };
-export const fetchBridgeTxStatus = async (statusRequest, clientId, fetchFn, bridgeApiBaseUrl) => {
+export const fetchBridgeTxStatus = async (statusRequest, clientId, jwt, fetchFn, bridgeApiBaseUrl) => {
     const statusRequestDto = getStatusRequestDto(statusRequest);
     const params = new URLSearchParams(statusRequestDto);
     // Fetch
     const url = `${getBridgeStatusUrl(bridgeApiBaseUrl)}?${params.toString()}`;
     const rawTxStatus = await fetchFn(url, {
-        headers: getClientIdHeader(clientId),
+        headers: getClientHeaders({ clientId, jwt }),
     });
     const validationFailures = [];
     try {
@@ -33,11 +31,10 @@ export const fetchBridgeTxStatus = async (statusRequest, clientId, fetchFn, brid
         // Build validation failure event properties
         if (error instanceof StructError) {
             error.failures().forEach(({ branch, path }) => {
-                const aggregatorId = branch?.[0]?.quote?.bridgeId ||
-                    branch?.[0]?.quote?.bridges?.[0] ||
-                    rawTxStatus?.bridge ||
-                    statusRequest.bridge ||
-                    statusRequest.bridgeId ||
+                const aggregatorId = branch?.[0]?.quote?.bridgeId ??
+                    branch?.[0]?.quote?.bridges?.[0] ??
+                    rawTxStatus?.bridge ??
+                    (statusRequest.bridge || statusRequest.bridgeId) ??
                     'unknown';
                 const pathString = path?.join('.') || 'unknown';
                 validationFailures.push([aggregatorId, pathString].join('|'));
diff --git a/dist/utils/bridge-status.mjs.map b/dist/utils/bridge-status.mjs.map
index d47a2bec5ddbc8ccbd56dd66f59e10a67425c0dc..726a1245209956431f96126ca696754771ae9aaf 100644
--- a/dist/utils/bridge-status.mjs.map
+++ b/dist/utils/bridge-status.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"bridge-status.mjs","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Quote } from '@metamask/bridge-controller';\nimport { StructError } from '@metamask/superstruct';\n\nimport { validateBridgeStatusResponse } from './validators';\nimport { REFRESH_INTERVAL_MS } from '../constants';\nimport type {\n  StatusResponse,\n  StatusRequestWithSrcTxHash,\n  StatusRequestDto,\n  FetchFunction,\n  BridgeHistoryItem,\n} from '../types';\n\nexport const getClientIdHeader = (clientId: string) => ({\n  'X-Client-Id': clientId,\n});\n\nexport const getBridgeStatusUrl = (bridgeApiBaseUrl: string) =>\n  `${bridgeApiBaseUrl}/getTxStatus`;\n\nexport const getStatusRequestDto = (\n  statusRequest: StatusRequestWithSrcTxHash,\n): StatusRequestDto => {\n  const { quote, ...statusRequestNoQuote } = statusRequest;\n\n  const statusRequestNoQuoteFormatted = Object.fromEntries(\n    Object.entries(statusRequestNoQuote).map(([key, value]) => [\n      key,\n      value.toString(),\n    ]),\n  ) as unknown as Omit<StatusRequestDto, 'requestId'>;\n\n  const requestId: { requestId: string } | Record<string, never> =\n    quote?.requestId ? { requestId: quote.requestId } : {};\n\n  return {\n    ...statusRequestNoQuoteFormatted,\n    ...requestId,\n  };\n};\n\nexport const fetchBridgeTxStatus = async (\n  statusRequest: StatusRequestWithSrcTxHash,\n  clientId: string,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n): Promise<{ status: StatusResponse; validationFailures: string[] }> => {\n  const statusRequestDto = getStatusRequestDto(statusRequest);\n  const params = new URLSearchParams(statusRequestDto);\n\n  // Fetch\n  const url = `${getBridgeStatusUrl(bridgeApiBaseUrl)}?${params.toString()}`;\n\n  const rawTxStatus: unknown = await fetchFn(url, {\n    headers: getClientIdHeader(clientId),\n  });\n\n  const validationFailures: string[] = [];\n\n  try {\n    validateBridgeStatusResponse(rawTxStatus);\n  } catch (error) {\n    // Build validation failure event properties\n    if (error instanceof StructError) {\n      error.failures().forEach(({ branch, path }) => {\n        const aggregatorId =\n          branch?.[0]?.quote?.bridgeId ||\n          branch?.[0]?.quote?.bridges?.[0] ||\n          (rawTxStatus as StatusResponse)?.bridge ||\n          statusRequest.bridge ||\n          statusRequest.bridgeId ||\n          'unknown';\n        const pathString = path?.join('.') || 'unknown';\n        validationFailures.push([aggregatorId, pathString].join('|'));\n      });\n    }\n  }\n  return {\n    status: rawTxStatus as StatusResponse,\n    validationFailures,\n  };\n};\n\nexport const getStatusRequestWithSrcTxHash = (\n  quote: Quote,\n  srcTxHash: string,\n): StatusRequestWithSrcTxHash => {\n  const { bridgeId, bridges, srcChainId, destChainId, refuel } = quote;\n  return {\n    bridgeId,\n    srcTxHash,\n    bridge: bridges[0],\n    srcChainId,\n    destChainId,\n    quote,\n    refuel: Boolean(refuel),\n  };\n};\n\nexport const shouldSkipFetchDueToFetchFailures = (\n  attempts?: BridgeHistoryItem['attempts'],\n) => {\n  // If there's an attempt, it means we've failed at least once,\n  // so we need to check if we need to wait longer due to exponential backoff\n  if (attempts) {\n    // Calculate exponential backoff delay: base interval * 2^(attempts-1)\n    const backoffDelay =\n      REFRESH_INTERVAL_MS * Math.pow(2, attempts.counter - 1);\n    const timeSinceLastAttempt = Date.now() - attempts.lastAttemptTime;\n\n    if (timeSinceLastAttempt < backoffDelay) {\n      // Not enough time has passed, skip this fetch\n      return true;\n    }\n  }\n  return false;\n};\n"]}
\ No newline at end of file
+{"version":3,"file":"bridge-status.mjs","sourceRoot":"","sources":["../../src/utils/bridge-status.ts"],"names":[],"mappings":"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","sourcesContent":["import { getClientHeaders } from '@metamask/bridge-controller';\nimport type { Quote } from '@metamask/bridge-controller';\nimport { StructError } from '@metamask/superstruct';\n\nimport { validateBridgeStatusResponse } from './validators';\nimport { REFRESH_INTERVAL_MS } from '../constants';\nimport type {\n  StatusResponse,\n  StatusRequestWithSrcTxHash,\n  StatusRequestDto,\n  FetchFunction,\n  BridgeHistoryItem,\n} from '../types';\n\nexport const getBridgeStatusUrl = (bridgeApiBaseUrl: string): string =>\n  `${bridgeApiBaseUrl}/getTxStatus`;\n\nexport const getStatusRequestDto = (\n  statusRequest: StatusRequestWithSrcTxHash,\n): StatusRequestDto => {\n  const { quote, ...statusRequestNoQuote } = statusRequest;\n\n  const statusRequestNoQuoteFormatted = Object.fromEntries(\n    Object.entries(statusRequestNoQuote).map(([key, value]) => [\n      key,\n      value.toString(),\n    ]),\n  ) as unknown as Omit<StatusRequestDto, 'requestId'>;\n\n  const requestId: { requestId: string } | Record<string, never> =\n    quote?.requestId ? { requestId: quote.requestId } : {};\n\n  return {\n    ...statusRequestNoQuoteFormatted,\n    ...requestId,\n  };\n};\n\nexport const fetchBridgeTxStatus = async (\n  statusRequest: StatusRequestWithSrcTxHash,\n  clientId: string,\n  jwt: string | undefined,\n  fetchFn: FetchFunction,\n  bridgeApiBaseUrl: string,\n): Promise<{ status: StatusResponse; validationFailures: string[] }> => {\n  const statusRequestDto = getStatusRequestDto(statusRequest);\n  const params = new URLSearchParams(statusRequestDto);\n\n  // Fetch\n  const url = `${getBridgeStatusUrl(bridgeApiBaseUrl)}?${params.toString()}`;\n\n  const rawTxStatus: unknown = await fetchFn(url, {\n    headers: getClientHeaders({ clientId, jwt }),\n  });\n\n  const validationFailures: string[] = [];\n\n  try {\n    validateBridgeStatusResponse(rawTxStatus);\n  } catch (error) {\n    // Build validation failure event properties\n    if (error instanceof StructError) {\n      error.failures().forEach(({ branch, path }) => {\n        const aggregatorId =\n          branch?.[0]?.quote?.bridgeId ??\n          branch?.[0]?.quote?.bridges?.[0] ??\n          (rawTxStatus as StatusResponse)?.bridge ??\n          (statusRequest.bridge || statusRequest.bridgeId) ??\n          ('unknown' as string);\n        const pathString = path?.join('.') || 'unknown';\n        validationFailures.push([aggregatorId, pathString].join('|'));\n      });\n    }\n  }\n  return {\n    status: rawTxStatus as StatusResponse,\n    validationFailures,\n  };\n};\n\nexport const getStatusRequestWithSrcTxHash = (\n  quote: Quote,\n  srcTxHash: string,\n): StatusRequestWithSrcTxHash => {\n  const { bridgeId, bridges, srcChainId, destChainId, refuel } = quote;\n  return {\n    bridgeId,\n    srcTxHash,\n    bridge: bridges[0],\n    srcChainId,\n    destChainId,\n    quote,\n    refuel: Boolean(refuel),\n  };\n};\n\nexport const shouldSkipFetchDueToFetchFailures = (\n  attempts?: BridgeHistoryItem['attempts'],\n): boolean => {\n  // If there's an attempt, it means we've failed at least once,\n  // so we need to check if we need to wait longer due to exponential backoff\n  if (attempts) {\n    // Calculate exponential backoff delay: base interval * 2^(attempts-1)\n    const backoffDelay =\n      REFRESH_INTERVAL_MS * Math.pow(2, attempts.counter - 1);\n    const timeSinceLastAttempt = Date.now() - attempts.lastAttemptTime;\n\n    if (timeSinceLastAttempt < backoffDelay) {\n      // Not enough time has passed, skip this fetch\n      return true;\n    }\n  }\n  return false;\n};\n"]}
\ No newline at end of file
diff --git a/dist/utils/intent-api.cjs b/dist/utils/intent-api.cjs
index 73b11ae5bf65670dba0a1b57f6c33fb884fe4b26..320dd91b32b80ce12989ed445ec5308ad0747d98 100644
--- a/dist/utils/intent-api.cjs
+++ b/dist/utils/intent-api.cjs
@@ -15,7 +15,6 @@ Object.defineProperty(exports, "__esModule", { value: true });
 exports.mapIntentOrderStatusToTransactionStatus = exports.translateIntentOrderToBridgeStatus = exports.IntentApiImpl = void 0;
 const bridge_controller_1 = require("@metamask/bridge-controller");
 const transaction_controller_1 = require("@metamask/transaction-controller");
-const bridge_status_1 = require("./bridge-status.cjs");
 const validators_1 = require("./validators.cjs");
 class IntentApiImpl {
     constructor(baseUrl, fetchFn) {
@@ -24,14 +23,14 @@ class IntentApiImpl {
         __classPrivateFieldSet(this, _IntentApiImpl_baseUrl, baseUrl, "f");
         __classPrivateFieldSet(this, _IntentApiImpl_fetchFn, fetchFn, "f");
     }
-    async submitIntent(params, clientId) {
+    async submitIntent(params, clientId, jwt) {
         const endpoint = `${__classPrivateFieldGet(this, _IntentApiImpl_baseUrl, "f")}/submitOrder`;
         try {
             const response = await __classPrivateFieldGet(this, _IntentApiImpl_fetchFn, "f").call(this, endpoint, {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
-                    ...(0, bridge_status_1.getClientIdHeader)(clientId),
+                    ...(0, bridge_controller_1.getClientHeaders)({ clientId, jwt }),
                 },
                 body: JSON.stringify(params),
             });
@@ -47,12 +46,12 @@ class IntentApiImpl {
             throw new Error('Failed to submit intent');
         }
     }
-    async getOrderStatus(orderId, aggregatorId, srcChainId, clientId) {
+    async getOrderStatus(orderId, aggregatorId, srcChainId, clientId, jwt) {
         const endpoint = `${__classPrivateFieldGet(this, _IntentApiImpl_baseUrl, "f")}/getOrderStatus?orderId=${orderId}&aggregatorId=${encodeURIComponent(aggregatorId)}&srcChainId=${srcChainId}`;
         try {
             const response = await __classPrivateFieldGet(this, _IntentApiImpl_fetchFn, "f").call(this, endpoint, {
                 method: 'GET',
-                headers: (0, bridge_status_1.getClientIdHeader)(clientId),
+                headers: (0, bridge_controller_1.getClientHeaders)({ clientId, jwt }),
             });
             if (!(0, validators_1.validateIntentOrderResponse)(response)) {
                 throw new Error('Invalid getOrderStatus response');
diff --git a/dist/utils/intent-api.cjs.map b/dist/utils/intent-api.cjs.map
index 4ed16ad7a975f12404d7bfed3ad867443898a3d6..a3030abc1861a3f311b9af814e62554a4d08b1d2 100644
--- a/dist/utils/intent-api.cjs.map
+++ b/dist/utils/intent-api.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"intent-api.cjs","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"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","sourcesContent":["import { StatusTypes } from '@metamask/bridge-controller';\nimport { TransactionStatus } from '@metamask/transaction-controller';\n\nimport { getClientIdHeader } from './bridge-status';\nimport {\n  IntentOrder,\n  IntentOrderStatus,\n  validateIntentOrderResponse,\n} from './validators';\nimport type { FetchFunction, StatusResponse } from '../types';\n\nexport type IntentSubmissionParams = {\n  srcChainId: string;\n  quoteId: string;\n  signature: string;\n  order: unknown;\n  userAddress: string;\n  aggregatorId: string;\n};\n\nexport type IntentApi = {\n  submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n  ): Promise<IntentOrder>;\n  getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n  ): Promise<IntentOrder>;\n};\n\nexport class IntentApiImpl implements IntentApi {\n  readonly #baseUrl: string;\n\n  readonly #fetchFn: FetchFunction;\n\n  constructor(baseUrl: string, fetchFn: FetchFunction) {\n    this.#baseUrl = baseUrl;\n    this.#fetchFn = fetchFn;\n  }\n\n  async submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/submitOrder`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getClientIdHeader(clientId),\n        },\n        body: JSON.stringify(params),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid submitOrder response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit intent: ${error.message}`);\n      }\n      throw new Error('Failed to submit intent');\n    }\n  }\n\n  async getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/getOrderStatus?orderId=${orderId}&aggregatorId=${encodeURIComponent(aggregatorId)}&srcChainId=${srcChainId}`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'GET',\n        headers: getClientIdHeader(clientId),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid getOrderStatus response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to get order status: ${error.message}`);\n      }\n      throw new Error('Failed to get order status');\n    }\n  }\n}\n\nexport type IntentStatusTranslation = {\n  status: StatusResponse;\n  txHash?: string;\n  transactionStatus: TransactionStatus;\n};\n\nexport const translateIntentOrderToBridgeStatus = (\n  intentOrder: IntentOrder,\n  srcChainId: number,\n  fallbackTxHash?: string,\n): IntentStatusTranslation => {\n  let statusType: StatusTypes;\n  switch (intentOrder.status) {\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      statusType = StatusTypes.COMPLETE;\n      break;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      statusType = StatusTypes.FAILED;\n      break;\n    case IntentOrderStatus.PENDING:\n      statusType = StatusTypes.PENDING;\n      break;\n    case IntentOrderStatus.SUBMITTED:\n      statusType = StatusTypes.SUBMITTED;\n      break;\n    default:\n      statusType = StatusTypes.UNKNOWN;\n  }\n\n  const txHash = intentOrder.txHash ?? fallbackTxHash ?? '';\n  const status: StatusResponse = {\n    status: statusType,\n    srcChain: {\n      chainId: srcChainId,\n      txHash,\n    },\n  };\n\n  return {\n    status,\n    txHash: intentOrder.txHash,\n    transactionStatus: mapIntentOrderStatusToTransactionStatus(\n      intentOrder.status,\n    ),\n  };\n};\n\nexport function mapIntentOrderStatusToTransactionStatus(\n  intentStatus: IntentOrderStatus,\n): TransactionStatus {\n  switch (intentStatus) {\n    case IntentOrderStatus.PENDING:\n    case IntentOrderStatus.SUBMITTED:\n      return TransactionStatus.submitted;\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      return TransactionStatus.confirmed;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      return TransactionStatus.failed;\n    default:\n      return TransactionStatus.submitted;\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"intent-api.cjs","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"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","sourcesContent":["import { getClientHeaders, StatusTypes } from '@metamask/bridge-controller';\nimport { TransactionStatus } from '@metamask/transaction-controller';\n\nimport {\n  IntentOrder,\n  IntentOrderStatus,\n  validateIntentOrderResponse,\n} from './validators';\nimport type { FetchFunction, StatusResponse } from '../types';\n\nexport type IntentSubmissionParams = {\n  srcChainId: string;\n  quoteId: string;\n  signature: string;\n  order: unknown;\n  userAddress: string;\n  aggregatorId: string;\n};\n\nexport type IntentApi = {\n  submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n    jwt: string,\n  ): Promise<IntentOrder>;\n  getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n    jwt: string,\n  ): Promise<IntentOrder>;\n};\n\nexport class IntentApiImpl implements IntentApi {\n  readonly #baseUrl: string;\n\n  readonly #fetchFn: FetchFunction;\n\n  constructor(baseUrl: string, fetchFn: FetchFunction) {\n    this.#baseUrl = baseUrl;\n    this.#fetchFn = fetchFn;\n  }\n\n  async submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n    jwt: string | undefined,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/submitOrder`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getClientHeaders({ clientId, jwt }),\n        },\n        body: JSON.stringify(params),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid submitOrder response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit intent: ${error.message}`);\n      }\n      throw new Error('Failed to submit intent');\n    }\n  }\n\n  async getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n    jwt: string | undefined,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/getOrderStatus?orderId=${orderId}&aggregatorId=${encodeURIComponent(aggregatorId)}&srcChainId=${srcChainId}`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'GET',\n        headers: getClientHeaders({ clientId, jwt }),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid getOrderStatus response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to get order status: ${error.message}`);\n      }\n      throw new Error('Failed to get order status');\n    }\n  }\n}\n\nexport type IntentStatusTranslation = {\n  status: StatusResponse;\n  txHash?: string;\n  transactionStatus: TransactionStatus;\n};\n\nexport const translateIntentOrderToBridgeStatus = (\n  intentOrder: IntentOrder,\n  srcChainId: number,\n  fallbackTxHash?: string,\n): IntentStatusTranslation => {\n  let statusType: StatusTypes;\n  switch (intentOrder.status) {\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      statusType = StatusTypes.COMPLETE;\n      break;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      statusType = StatusTypes.FAILED;\n      break;\n    case IntentOrderStatus.PENDING:\n      statusType = StatusTypes.PENDING;\n      break;\n    case IntentOrderStatus.SUBMITTED:\n      statusType = StatusTypes.SUBMITTED;\n      break;\n    default:\n      statusType = StatusTypes.UNKNOWN;\n  }\n\n  const txHash = intentOrder.txHash ?? fallbackTxHash ?? '';\n  const status: StatusResponse = {\n    status: statusType,\n    srcChain: {\n      chainId: srcChainId,\n      txHash,\n    },\n  };\n\n  return {\n    status,\n    txHash: intentOrder.txHash,\n    transactionStatus: mapIntentOrderStatusToTransactionStatus(\n      intentOrder.status,\n    ),\n  };\n};\n\nexport function mapIntentOrderStatusToTransactionStatus(\n  intentStatus: IntentOrderStatus,\n): TransactionStatus {\n  switch (intentStatus) {\n    case IntentOrderStatus.PENDING:\n    case IntentOrderStatus.SUBMITTED:\n      return TransactionStatus.submitted;\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      return TransactionStatus.confirmed;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      return TransactionStatus.failed;\n    default:\n      return TransactionStatus.submitted;\n  }\n}\n"]}
\ No newline at end of file
diff --git a/dist/utils/intent-api.d.cts b/dist/utils/intent-api.d.cts
index ae2b13f19de978ee56844efe671420ed32a60c89..967ef44ae65d8437030fe99793249fbdbd919eec 100644
--- a/dist/utils/intent-api.d.cts
+++ b/dist/utils/intent-api.d.cts
@@ -10,14 +10,14 @@ export type IntentSubmissionParams = {
     aggregatorId: string;
 };
 export type IntentApi = {
-    submitIntent(params: IntentSubmissionParams, clientId: string): Promise<IntentOrder>;
-    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string): Promise<IntentOrder>;
+    submitIntent(params: IntentSubmissionParams, clientId: string, jwt: string): Promise<IntentOrder>;
+    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string, jwt: string): Promise<IntentOrder>;
 };
 export declare class IntentApiImpl implements IntentApi {
     #private;
     constructor(baseUrl: string, fetchFn: FetchFunction);
-    submitIntent(params: IntentSubmissionParams, clientId: string): Promise<IntentOrder>;
-    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string): Promise<IntentOrder>;
+    submitIntent(params: IntentSubmissionParams, clientId: string, jwt: string | undefined): Promise<IntentOrder>;
+    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string, jwt: string | undefined): Promise<IntentOrder>;
 }
 export type IntentStatusTranslation = {
     status: StatusResponse;
diff --git a/dist/utils/intent-api.d.cts.map b/dist/utils/intent-api.d.cts.map
index c940f0e10001a72c0d7ba94c78a176d85721f0ce..7e39860b879cd9721f41db5a97002ef9eacf5c92 100644
--- a/dist/utils/intent-api.d.cts.map
+++ b/dist/utils/intent-api.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"intent-api.d.cts","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,iBAAiB,EAAE,yCAAyC;AAGrE,OAAO,EACL,WAAW,EACX,iBAAiB,EAElB,yBAAqB;AACtB,OAAO,KAAK,EAAE,aAAa,EAAE,cAAc,EAAE,qBAAiB;AAE9D,MAAM,MAAM,sBAAsB,GAAG;IACnC,UAAU,EAAE,MAAM,CAAC;IACnB,OAAO,EAAE,MAAM,CAAC;IAChB,SAAS,EAAE,MAAM,CAAC;IAClB,KAAK,EAAE,OAAO,CAAC;IACf,WAAW,EAAE,MAAM,CAAC;IACpB,YAAY,EAAE,MAAM,CAAC;CACtB,CAAC;AAEF,MAAM,MAAM,SAAS,GAAG;IACtB,YAAY,CACV,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC,CAAC;IACxB,cAAc,CACZ,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC,CAAC;CACzB,CAAC;AAEF,qBAAa,aAAc,YAAW,SAAS;;gBAKjC,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa;IAK7C,YAAY,CAChB,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC;IAuBjB,cAAc,CAClB,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC;CAkBxB;AAED,MAAM,MAAM,uBAAuB,GAAG;IACpC,MAAM,EAAE,cAAc,CAAC;IACvB,MAAM,CAAC,EAAE,MAAM,CAAC;IAChB,iBAAiB,EAAE,iBAAiB,CAAC;CACtC,CAAC;AAEF,eAAO,MAAM,kCAAkC,gBAChC,WAAW,cACZ,MAAM,mBACD,MAAM,KACtB,uBAsCF,CAAC;AAEF,wBAAgB,uCAAuC,CACrD,YAAY,EAAE,iBAAiB,GAC9B,iBAAiB,CAenB"}
\ No newline at end of file
+{"version":3,"file":"intent-api.d.cts","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,iBAAiB,EAAE,yCAAyC;AAErE,OAAO,EACL,WAAW,EACX,iBAAiB,EAElB,yBAAqB;AACtB,OAAO,KAAK,EAAE,aAAa,EAAE,cAAc,EAAE,qBAAiB;AAE9D,MAAM,MAAM,sBAAsB,GAAG;IACnC,UAAU,EAAE,MAAM,CAAC;IACnB,OAAO,EAAE,MAAM,CAAC;IAChB,SAAS,EAAE,MAAM,CAAC;IAClB,KAAK,EAAE,OAAO,CAAC;IACf,WAAW,EAAE,MAAM,CAAC;IACpB,YAAY,EAAE,MAAM,CAAC;CACtB,CAAC;AAEF,MAAM,MAAM,SAAS,GAAG;IACtB,YAAY,CACV,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GACV,OAAO,CAAC,WAAW,CAAC,CAAC;IACxB,cAAc,CACZ,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GACV,OAAO,CAAC,WAAW,CAAC,CAAC;CACzB,CAAC;AAEF,qBAAa,aAAc,YAAW,SAAS;;gBAKjC,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa;IAK7C,YAAY,CAChB,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,GACtB,OAAO,CAAC,WAAW,CAAC;IAuBjB,cAAc,CAClB,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,GACtB,OAAO,CAAC,WAAW,CAAC;CAkBxB;AAED,MAAM,MAAM,uBAAuB,GAAG;IACpC,MAAM,EAAE,cAAc,CAAC;IACvB,MAAM,CAAC,EAAE,MAAM,CAAC;IAChB,iBAAiB,EAAE,iBAAiB,CAAC;CACtC,CAAC;AAEF,eAAO,MAAM,kCAAkC,gBAChC,WAAW,cACZ,MAAM,mBACD,MAAM,KACtB,uBAsCF,CAAC;AAEF,wBAAgB,uCAAuC,CACrD,YAAY,EAAE,iBAAiB,GAC9B,iBAAiB,CAenB"}
\ No newline at end of file
diff --git a/dist/utils/intent-api.d.mts b/dist/utils/intent-api.d.mts
index 5f98517ce0550312630ae1beec31d332765841a0..35f3d8b2e663759d706b70c72940a843315ed1bc 100644
--- a/dist/utils/intent-api.d.mts
+++ b/dist/utils/intent-api.d.mts
@@ -10,14 +10,14 @@ export type IntentSubmissionParams = {
     aggregatorId: string;
 };
 export type IntentApi = {
-    submitIntent(params: IntentSubmissionParams, clientId: string): Promise<IntentOrder>;
-    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string): Promise<IntentOrder>;
+    submitIntent(params: IntentSubmissionParams, clientId: string, jwt: string): Promise<IntentOrder>;
+    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string, jwt: string): Promise<IntentOrder>;
 };
 export declare class IntentApiImpl implements IntentApi {
     #private;
     constructor(baseUrl: string, fetchFn: FetchFunction);
-    submitIntent(params: IntentSubmissionParams, clientId: string): Promise<IntentOrder>;
-    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string): Promise<IntentOrder>;
+    submitIntent(params: IntentSubmissionParams, clientId: string, jwt: string | undefined): Promise<IntentOrder>;
+    getOrderStatus(orderId: string, aggregatorId: string, srcChainId: string, clientId: string, jwt: string | undefined): Promise<IntentOrder>;
 }
 export type IntentStatusTranslation = {
     status: StatusResponse;
diff --git a/dist/utils/intent-api.d.mts.map b/dist/utils/intent-api.d.mts.map
index bedd151231ae07466380700add68c9eea158f7f3..2ccffef22effcf8a8519d18ef2100a11b8c5a772 100644
--- a/dist/utils/intent-api.d.mts.map
+++ b/dist/utils/intent-api.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"intent-api.d.mts","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,iBAAiB,EAAE,yCAAyC;AAGrE,OAAO,EACL,WAAW,EACX,iBAAiB,EAElB,yBAAqB;AACtB,OAAO,KAAK,EAAE,aAAa,EAAE,cAAc,EAAE,qBAAiB;AAE9D,MAAM,MAAM,sBAAsB,GAAG;IACnC,UAAU,EAAE,MAAM,CAAC;IACnB,OAAO,EAAE,MAAM,CAAC;IAChB,SAAS,EAAE,MAAM,CAAC;IAClB,KAAK,EAAE,OAAO,CAAC;IACf,WAAW,EAAE,MAAM,CAAC;IACpB,YAAY,EAAE,MAAM,CAAC;CACtB,CAAC;AAEF,MAAM,MAAM,SAAS,GAAG;IACtB,YAAY,CACV,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC,CAAC;IACxB,cAAc,CACZ,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC,CAAC;CACzB,CAAC;AAEF,qBAAa,aAAc,YAAW,SAAS;;gBAKjC,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa;IAK7C,YAAY,CAChB,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC;IAuBjB,cAAc,CAClB,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,GACf,OAAO,CAAC,WAAW,CAAC;CAkBxB;AAED,MAAM,MAAM,uBAAuB,GAAG;IACpC,MAAM,EAAE,cAAc,CAAC;IACvB,MAAM,CAAC,EAAE,MAAM,CAAC;IAChB,iBAAiB,EAAE,iBAAiB,CAAC;CACtC,CAAC;AAEF,eAAO,MAAM,kCAAkC,gBAChC,WAAW,cACZ,MAAM,mBACD,MAAM,KACtB,uBAsCF,CAAC;AAEF,wBAAgB,uCAAuC,CACrD,YAAY,EAAE,iBAAiB,GAC9B,iBAAiB,CAenB"}
\ No newline at end of file
+{"version":3,"file":"intent-api.d.mts","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,iBAAiB,EAAE,yCAAyC;AAErE,OAAO,EACL,WAAW,EACX,iBAAiB,EAElB,yBAAqB;AACtB,OAAO,KAAK,EAAE,aAAa,EAAE,cAAc,EAAE,qBAAiB;AAE9D,MAAM,MAAM,sBAAsB,GAAG;IACnC,UAAU,EAAE,MAAM,CAAC;IACnB,OAAO,EAAE,MAAM,CAAC;IAChB,SAAS,EAAE,MAAM,CAAC;IAClB,KAAK,EAAE,OAAO,CAAC;IACf,WAAW,EAAE,MAAM,CAAC;IACpB,YAAY,EAAE,MAAM,CAAC;CACtB,CAAC;AAEF,MAAM,MAAM,SAAS,GAAG;IACtB,YAAY,CACV,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GACV,OAAO,CAAC,WAAW,CAAC,CAAC;IACxB,cAAc,CACZ,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GACV,OAAO,CAAC,WAAW,CAAC,CAAC;CACzB,CAAC;AAEF,qBAAa,aAAc,YAAW,SAAS;;gBAKjC,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa;IAK7C,YAAY,CAChB,MAAM,EAAE,sBAAsB,EAC9B,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,GACtB,OAAO,CAAC,WAAW,CAAC;IAuBjB,cAAc,CAClB,OAAO,EAAE,MAAM,EACf,YAAY,EAAE,MAAM,EACpB,UAAU,EAAE,MAAM,EAClB,QAAQ,EAAE,MAAM,EAChB,GAAG,EAAE,MAAM,GAAG,SAAS,GACtB,OAAO,CAAC,WAAW,CAAC;CAkBxB;AAED,MAAM,MAAM,uBAAuB,GAAG;IACpC,MAAM,EAAE,cAAc,CAAC;IACvB,MAAM,CAAC,EAAE,MAAM,CAAC;IAChB,iBAAiB,EAAE,iBAAiB,CAAC;CACtC,CAAC;AAEF,eAAO,MAAM,kCAAkC,gBAChC,WAAW,cACZ,MAAM,mBACD,MAAM,KACtB,uBAsCF,CAAC;AAEF,wBAAgB,uCAAuC,CACrD,YAAY,EAAE,iBAAiB,GAC9B,iBAAiB,CAenB"}
\ No newline at end of file
diff --git a/dist/utils/intent-api.mjs b/dist/utils/intent-api.mjs
index 4ea430d9434476a1987cd181de6816e699a6e61d..71c1972335fc2b0df5349e3fca85ada7285e4545 100644
--- a/dist/utils/intent-api.mjs
+++ b/dist/utils/intent-api.mjs
@@ -10,9 +10,8 @@ var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (
     return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
 };
 var _IntentApiImpl_baseUrl, _IntentApiImpl_fetchFn;
-import { StatusTypes } from "@metamask/bridge-controller";
+import { getClientHeaders, StatusTypes } from "@metamask/bridge-controller";
 import { TransactionStatus } from "@metamask/transaction-controller";
-import { getClientIdHeader } from "./bridge-status.mjs";
 import { IntentOrderStatus, validateIntentOrderResponse } from "./validators.mjs";
 export class IntentApiImpl {
     constructor(baseUrl, fetchFn) {
@@ -21,14 +20,14 @@ export class IntentApiImpl {
         __classPrivateFieldSet(this, _IntentApiImpl_baseUrl, baseUrl, "f");
         __classPrivateFieldSet(this, _IntentApiImpl_fetchFn, fetchFn, "f");
     }
-    async submitIntent(params, clientId) {
+    async submitIntent(params, clientId, jwt) {
         const endpoint = `${__classPrivateFieldGet(this, _IntentApiImpl_baseUrl, "f")}/submitOrder`;
         try {
             const response = await __classPrivateFieldGet(this, _IntentApiImpl_fetchFn, "f").call(this, endpoint, {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
-                    ...getClientIdHeader(clientId),
+                    ...getClientHeaders({ clientId, jwt }),
                 },
                 body: JSON.stringify(params),
             });
@@ -44,12 +43,12 @@ export class IntentApiImpl {
             throw new Error('Failed to submit intent');
         }
     }
-    async getOrderStatus(orderId, aggregatorId, srcChainId, clientId) {
+    async getOrderStatus(orderId, aggregatorId, srcChainId, clientId, jwt) {
         const endpoint = `${__classPrivateFieldGet(this, _IntentApiImpl_baseUrl, "f")}/getOrderStatus?orderId=${orderId}&aggregatorId=${encodeURIComponent(aggregatorId)}&srcChainId=${srcChainId}`;
         try {
             const response = await __classPrivateFieldGet(this, _IntentApiImpl_fetchFn, "f").call(this, endpoint, {
                 method: 'GET',
-                headers: getClientIdHeader(clientId),
+                headers: getClientHeaders({ clientId, jwt }),
             });
             if (!validateIntentOrderResponse(response)) {
                 throw new Error('Invalid getOrderStatus response');
diff --git a/dist/utils/intent-api.mjs.map b/dist/utils/intent-api.mjs.map
index fe818b50a00f8edd953a415d36f56e82312c2872..e7bc93235207051ca297d80edcd94e093fda5e01 100644
--- a/dist/utils/intent-api.mjs.map
+++ b/dist/utils/intent-api.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"intent-api.mjs","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"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","sourcesContent":["import { StatusTypes } from '@metamask/bridge-controller';\nimport { TransactionStatus } from '@metamask/transaction-controller';\n\nimport { getClientIdHeader } from './bridge-status';\nimport {\n  IntentOrder,\n  IntentOrderStatus,\n  validateIntentOrderResponse,\n} from './validators';\nimport type { FetchFunction, StatusResponse } from '../types';\n\nexport type IntentSubmissionParams = {\n  srcChainId: string;\n  quoteId: string;\n  signature: string;\n  order: unknown;\n  userAddress: string;\n  aggregatorId: string;\n};\n\nexport type IntentApi = {\n  submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n  ): Promise<IntentOrder>;\n  getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n  ): Promise<IntentOrder>;\n};\n\nexport class IntentApiImpl implements IntentApi {\n  readonly #baseUrl: string;\n\n  readonly #fetchFn: FetchFunction;\n\n  constructor(baseUrl: string, fetchFn: FetchFunction) {\n    this.#baseUrl = baseUrl;\n    this.#fetchFn = fetchFn;\n  }\n\n  async submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/submitOrder`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getClientIdHeader(clientId),\n        },\n        body: JSON.stringify(params),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid submitOrder response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit intent: ${error.message}`);\n      }\n      throw new Error('Failed to submit intent');\n    }\n  }\n\n  async getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/getOrderStatus?orderId=${orderId}&aggregatorId=${encodeURIComponent(aggregatorId)}&srcChainId=${srcChainId}`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'GET',\n        headers: getClientIdHeader(clientId),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid getOrderStatus response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to get order status: ${error.message}`);\n      }\n      throw new Error('Failed to get order status');\n    }\n  }\n}\n\nexport type IntentStatusTranslation = {\n  status: StatusResponse;\n  txHash?: string;\n  transactionStatus: TransactionStatus;\n};\n\nexport const translateIntentOrderToBridgeStatus = (\n  intentOrder: IntentOrder,\n  srcChainId: number,\n  fallbackTxHash?: string,\n): IntentStatusTranslation => {\n  let statusType: StatusTypes;\n  switch (intentOrder.status) {\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      statusType = StatusTypes.COMPLETE;\n      break;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      statusType = StatusTypes.FAILED;\n      break;\n    case IntentOrderStatus.PENDING:\n      statusType = StatusTypes.PENDING;\n      break;\n    case IntentOrderStatus.SUBMITTED:\n      statusType = StatusTypes.SUBMITTED;\n      break;\n    default:\n      statusType = StatusTypes.UNKNOWN;\n  }\n\n  const txHash = intentOrder.txHash ?? fallbackTxHash ?? '';\n  const status: StatusResponse = {\n    status: statusType,\n    srcChain: {\n      chainId: srcChainId,\n      txHash,\n    },\n  };\n\n  return {\n    status,\n    txHash: intentOrder.txHash,\n    transactionStatus: mapIntentOrderStatusToTransactionStatus(\n      intentOrder.status,\n    ),\n  };\n};\n\nexport function mapIntentOrderStatusToTransactionStatus(\n  intentStatus: IntentOrderStatus,\n): TransactionStatus {\n  switch (intentStatus) {\n    case IntentOrderStatus.PENDING:\n    case IntentOrderStatus.SUBMITTED:\n      return TransactionStatus.submitted;\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      return TransactionStatus.confirmed;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      return TransactionStatus.failed;\n    default:\n      return TransactionStatus.submitted;\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"intent-api.mjs","sourceRoot":"","sources":["../../src/utils/intent-api.ts"],"names":[],"mappings":"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","sourcesContent":["import { getClientHeaders, StatusTypes } from '@metamask/bridge-controller';\nimport { TransactionStatus } from '@metamask/transaction-controller';\n\nimport {\n  IntentOrder,\n  IntentOrderStatus,\n  validateIntentOrderResponse,\n} from './validators';\nimport type { FetchFunction, StatusResponse } from '../types';\n\nexport type IntentSubmissionParams = {\n  srcChainId: string;\n  quoteId: string;\n  signature: string;\n  order: unknown;\n  userAddress: string;\n  aggregatorId: string;\n};\n\nexport type IntentApi = {\n  submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n    jwt: string,\n  ): Promise<IntentOrder>;\n  getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n    jwt: string,\n  ): Promise<IntentOrder>;\n};\n\nexport class IntentApiImpl implements IntentApi {\n  readonly #baseUrl: string;\n\n  readonly #fetchFn: FetchFunction;\n\n  constructor(baseUrl: string, fetchFn: FetchFunction) {\n    this.#baseUrl = baseUrl;\n    this.#fetchFn = fetchFn;\n  }\n\n  async submitIntent(\n    params: IntentSubmissionParams,\n    clientId: string,\n    jwt: string | undefined,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/submitOrder`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getClientHeaders({ clientId, jwt }),\n        },\n        body: JSON.stringify(params),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid submitOrder response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit intent: ${error.message}`);\n      }\n      throw new Error('Failed to submit intent');\n    }\n  }\n\n  async getOrderStatus(\n    orderId: string,\n    aggregatorId: string,\n    srcChainId: string,\n    clientId: string,\n    jwt: string | undefined,\n  ): Promise<IntentOrder> {\n    const endpoint = `${this.#baseUrl}/getOrderStatus?orderId=${orderId}&aggregatorId=${encodeURIComponent(aggregatorId)}&srcChainId=${srcChainId}`;\n    try {\n      const response = await this.#fetchFn(endpoint, {\n        method: 'GET',\n        headers: getClientHeaders({ clientId, jwt }),\n      });\n      if (!validateIntentOrderResponse(response)) {\n        throw new Error('Invalid getOrderStatus response');\n      }\n      return response;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to get order status: ${error.message}`);\n      }\n      throw new Error('Failed to get order status');\n    }\n  }\n}\n\nexport type IntentStatusTranslation = {\n  status: StatusResponse;\n  txHash?: string;\n  transactionStatus: TransactionStatus;\n};\n\nexport const translateIntentOrderToBridgeStatus = (\n  intentOrder: IntentOrder,\n  srcChainId: number,\n  fallbackTxHash?: string,\n): IntentStatusTranslation => {\n  let statusType: StatusTypes;\n  switch (intentOrder.status) {\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      statusType = StatusTypes.COMPLETE;\n      break;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      statusType = StatusTypes.FAILED;\n      break;\n    case IntentOrderStatus.PENDING:\n      statusType = StatusTypes.PENDING;\n      break;\n    case IntentOrderStatus.SUBMITTED:\n      statusType = StatusTypes.SUBMITTED;\n      break;\n    default:\n      statusType = StatusTypes.UNKNOWN;\n  }\n\n  const txHash = intentOrder.txHash ?? fallbackTxHash ?? '';\n  const status: StatusResponse = {\n    status: statusType,\n    srcChain: {\n      chainId: srcChainId,\n      txHash,\n    },\n  };\n\n  return {\n    status,\n    txHash: intentOrder.txHash,\n    transactionStatus: mapIntentOrderStatusToTransactionStatus(\n      intentOrder.status,\n    ),\n  };\n};\n\nexport function mapIntentOrderStatusToTransactionStatus(\n  intentStatus: IntentOrderStatus,\n): TransactionStatus {\n  switch (intentStatus) {\n    case IntentOrderStatus.PENDING:\n    case IntentOrderStatus.SUBMITTED:\n      return TransactionStatus.submitted;\n    case IntentOrderStatus.CONFIRMED:\n    case IntentOrderStatus.COMPLETED:\n      return TransactionStatus.confirmed;\n    case IntentOrderStatus.FAILED:\n    case IntentOrderStatus.EXPIRED:\n    case IntentOrderStatus.CANCELLED:\n      return TransactionStatus.failed;\n    default:\n      return TransactionStatus.submitted;\n  }\n}\n"]}
\ No newline at end of file
diff --git a/dist/utils/metrics.cjs b/dist/utils/metrics.cjs
index 775367bc08c8a46c19a78913903573a295d1f677..26c3871afec4e54fbf949040bad07125ca0021a6 100644
--- a/dist/utils/metrics.cjs
+++ b/dist/utils/metrics.cjs
@@ -107,9 +107,10 @@ exports.getPriceImpactFromQuote = getPriceImpactFromQuote;
  * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
  * @param isHardwareAccount - whether the tx is submitted using a hardware wallet
  * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+ * @param abTests - A/B test context to attribute events to specific experiments
  * @returns The properties for the pre-confirmation event
  */
-const getPreConfirmationPropertiesFromQuote = (quoteResponse, isStxEnabledOnClient, isHardwareAccount, location = bridge_controller_1.MetaMetricsSwapsEventSource.MainView) => {
+const getPreConfirmationPropertiesFromQuote = (quoteResponse, isStxEnabledOnClient, isHardwareAccount, location = bridge_controller_1.MetaMetricsSwapsEventSource.MainView, abTests) => {
     const { quote } = quoteResponse;
     return {
         ...(0, exports.getPriceImpactFromQuote)(quote),
@@ -125,6 +126,7 @@ const getPreConfirmationPropertiesFromQuote = (quoteResponse, isStxEnabledOnClie
         action_type: bridge_controller_1.MetricsActionType.SWAPBRIDGE_V1,
         custom_slippage: false, // TODO detect whether the user changed the default slippage
         location,
+        ...(abTests && Object.keys(abTests).length > 0 && { ab_tests: abTests }),
     };
 };
 exports.getPreConfirmationPropertiesFromQuote = getPreConfirmationPropertiesFromQuote;
diff --git a/dist/utils/metrics.cjs.map b/dist/utils/metrics.cjs.map
index cfa4c08d8749b13c6af5703d5eed33872ce6c498..84be03ac9184ca0218fc0a1014337fcd6afb84e3 100644
--- a/dist/utils/metrics.cjs.map
+++ b/dist/utils/metrics.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"metrics.cjs","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport type { AccountsControllerState } from '@metamask/accounts-controller';\nimport {\n  StatusTypes,\n  formatChainIdToHex,\n  isEthUsdt,\n  formatChainIdToCaip,\n  formatProviderLabel,\n  isCustomSlippage,\n  getSwapType,\n  isHardwareWallet,\n  formatAddressToAssetId,\n  MetricsActionType,\n  MetricsSwapType,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type {\n  QuoteFetchData,\n  QuoteMetadata,\n  QuoteResponse,\n  TxStatusData,\n  RequestParams,\n  TradeData,\n  RequestMetadata,\n} from '@metamask/bridge-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type { TransactionMeta } from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\nimport { BigNumber } from 'bignumber.js';\n\nimport { calcActualGasUsed } from './gas';\nimport {\n  getActualBridgeReceivedAmount,\n  getActualSwapReceivedAmount,\n} from './swap-received-amount';\nimport type { BridgeHistoryItem } from '../types';\n\nexport const getTxStatusesFromHistory = ({\n  status,\n  hasApprovalTx,\n  approvalTxId,\n  quote,\n}: BridgeHistoryItem): TxStatusData => {\n  const source_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n  const destination_transaction = status.destChain?.txHash\n    ? status.status\n    : StatusTypes.PENDING;\n\n  const hexChainId = formatChainIdToHex(quote.srcChainId);\n  const isEthUsdtTx = isEthUsdt(hexChainId, quote.srcAsset.address);\n  const allowance_reset_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : undefined;\n  const approval_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n\n  return {\n    allowance_reset_transaction: isEthUsdtTx\n      ? allowance_reset_transaction\n      : undefined,\n    approval_transaction:\n      hasApprovalTx || approvalTxId ? approval_transaction : undefined,\n    source_transaction,\n    destination_transaction:\n      status.status === StatusTypes.FAILED\n        ? StatusTypes.FAILED\n        : destination_transaction,\n  };\n};\n\n/**\n * Calculate the properties for a finalized transaction event based on the txHistory\n * and txMeta\n *\n * @param historyItem - The bridge history item\n * @param txMeta - The transaction meta from the TransactionController\n * @param approvalTxMeta - The approval transaction meta from the TransactionController\n * @returns The properties for the finalized transaction\n */\nexport const getFinalizedTxProperties = (\n  historyItem: BridgeHistoryItem,\n  txMeta?: TransactionMeta,\n  approvalTxMeta?: TransactionMeta,\n) => {\n  const startTime =\n    approvalTxMeta?.submittedTime ??\n    txMeta?.submittedTime ??\n    historyItem.startTime;\n  const completionTime =\n    txMeta?.type === TransactionType.swap\n      ? txMeta?.time\n      : historyItem.completionTime;\n\n  const actualGas = calcActualGasUsed(\n    historyItem,\n    txMeta?.txReceipt,\n    approvalTxMeta?.txReceipt,\n  );\n\n  const actualReturn =\n    txMeta?.type === TransactionType.swap\n      ? getActualSwapReceivedAmount(historyItem, actualGas, txMeta)\n      : getActualBridgeReceivedAmount(historyItem);\n\n  const quotedVsUsedGasRatio =\n    historyItem.pricingData?.quotedGasAmount && actualGas?.amount\n      ? new BigNumber(historyItem.pricingData.quotedGasAmount)\n          .multipliedBy(new BigNumber(10).pow(18))\n          .div(actualGas.amount)\n          .toNumber()\n      : 0;\n\n  const quoteVsExecutionRatio =\n    historyItem.pricingData?.quotedReturnInUsd && actualReturn?.usd\n      ? new BigNumber(historyItem.pricingData.quotedReturnInUsd)\n          .div(actualReturn.usd)\n          .toNumber()\n      : 0;\n\n  return {\n    actual_time_minutes:\n      completionTime && startTime ? (completionTime - startTime) / 60000 : 0,\n    usd_actual_return: Number(actualReturn?.usd ?? 0),\n    usd_actual_gas: actualGas?.usd ?? 0,\n    quote_vs_execution_ratio: quoteVsExecutionRatio,\n    quoted_vs_used_gas_ratio: quotedVsUsedGasRatio,\n  };\n};\n\nexport const getRequestParamFromHistory = (\n  historyItem: BridgeHistoryItem,\n): RequestParams => {\n  return {\n    chain_id_source: formatChainIdToCaip(historyItem.quote.srcChainId),\n    token_symbol_source: historyItem.quote.srcAsset.symbol,\n    token_address_source: historyItem.quote.srcAsset.assetId,\n    chain_id_destination: formatChainIdToCaip(historyItem.quote.destChainId),\n    token_symbol_destination: historyItem.quote.destAsset.symbol,\n    token_address_destination: historyItem.quote.destAsset.assetId,\n  };\n};\n\nexport const getTradeDataFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(quoteResponse.gasFee?.effective?.usd ?? 0),\n    gas_included: quoteResponse.quote.gasIncluded ?? false,\n    gas_included_7702: quoteResponse.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(quoteResponse.quote),\n    quoted_time_minutes: Number(\n      quoteResponse.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(quoteResponse.adjustedReturn?.usd ?? 0),\n  };\n};\n\nexport const getPriceImpactFromQuote = (\n  quote: QuoteResponse['quote'],\n): Pick<QuoteFetchData, 'price_impact'> => {\n  return { price_impact: Number(quote.priceData?.priceImpact ?? '0') };\n};\n\n/**\n * Before the tx is confirmed, its data is not available in txHistory\n * The quote is used to populate event properties before confirmation\n *\n * @param quoteResponse - The quote response\n * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n * @param isHardwareAccount - whether the tx is submitted using a hardware wallet\n * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n * @returns The properties for the pre-confirmation event\n */\nexport const getPreConfirmationPropertiesFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n  isStxEnabledOnClient: boolean,\n  isHardwareAccount: boolean,\n  location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n) => {\n  const { quote } = quoteResponse;\n  return {\n    ...getPriceImpactFromQuote(quote),\n    ...getTradeDataFromQuote(quoteResponse),\n    chain_id_source: formatChainIdToCaip(quote.srcChainId),\n    token_symbol_source: quote.srcAsset.symbol,\n    chain_id_destination: formatChainIdToCaip(quote.destChainId),\n    token_symbol_destination: quote.destAsset.symbol,\n    is_hardware_wallet: isHardwareAccount,\n    swap_type: getSwapType(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    ),\n    usd_amount_source: Number(quoteResponse.sentAmount?.usd ?? 0),\n    stx_enabled: isStxEnabledOnClient,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n    custom_slippage: false, // TODO detect whether the user changed the default slippage\n    location,\n  };\n};\n\nexport const getTradeDataFromHistory = (\n  historyItem: BridgeHistoryItem,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(historyItem.pricingData?.quotedGasInUsd ?? 0),\n    gas_included: historyItem.quote.gasIncluded ?? false,\n    gas_included_7702: historyItem.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(historyItem.quote),\n    quoted_time_minutes: Number(\n      historyItem.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(historyItem.pricingData?.quotedReturnInUsd ?? 0),\n  };\n};\n\nexport const getRequestMetadataFromHistory = (\n  historyItem: BridgeHistoryItem,\n  account?: AccountsControllerState['internalAccounts']['accounts'][string],\n): RequestMetadata => {\n  const { quote, slippagePercentage, isStxEnabled } = historyItem;\n\n  return {\n    slippage_limit: slippagePercentage,\n    custom_slippage: isCustomSlippage(slippagePercentage),\n    usd_amount_source: Number(historyItem.pricingData?.amountSentInUsd ?? 0),\n    swap_type: getSwapType(quote.srcChainId, quote.destChainId),\n    is_hardware_wallet: isHardwareWallet(account),\n    stx_enabled: isStxEnabled ?? false,\n    security_warnings: [],\n  };\n};\n\n/**\n * Get the properties for a swap transaction that is not in the txHistory\n *\n * @param transactionMeta - The transaction meta\n * @returns The properties for the swap transaction\n */\nexport const getEVMTxPropertiesFromTransactionMeta = (\n  transactionMeta: TransactionMeta,\n) => {\n  return {\n    source_transaction: [\n      TransactionStatus.failed,\n      TransactionStatus.dropped,\n      TransactionStatus.rejected,\n    ].includes(transactionMeta.status)\n      ? StatusTypes.FAILED\n      : StatusTypes.COMPLETE,\n    error_message: transactionMeta.error?.message ?? '',\n    chain_id_source: formatChainIdToCaip(transactionMeta.chainId),\n    chain_id_destination: formatChainIdToCaip(transactionMeta.chainId),\n    token_symbol_source: transactionMeta.sourceTokenSymbol ?? '',\n    token_symbol_destination: transactionMeta.destinationTokenSymbol ?? '',\n    usd_amount_source: 0,\n    stx_enabled: false,\n    token_address_source:\n      formatAddressToAssetId(\n        transactionMeta.sourceTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    token_address_destination:\n      formatAddressToAssetId(\n        transactionMeta.destinationTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    custom_slippage: false,\n    is_hardware_wallet: false,\n    swap_type:\n      transactionMeta.type &&\n      [TransactionType.swap, TransactionType.swapApproval].includes(\n        transactionMeta.type,\n      )\n        ? MetricsSwapType.SINGLE\n        : MetricsSwapType.CROSSCHAIN,\n    security_warnings: [],\n    price_impact: 0,\n    usd_quoted_gas: 0,\n    gas_included: false,\n    gas_included_7702: false,\n    quoted_time_minutes: 0,\n    usd_quoted_return: 0,\n    provider: '' as `${string}_${string}`,\n    actual_time_minutes: 0,\n    quote_vs_execution_ratio: 0,\n    quoted_vs_used_gas_ratio: 0,\n    usd_actual_return: 0,\n    usd_actual_gas: 0,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n  };\n};\n"]}
\ No newline at end of file
+{"version":3,"file":"metrics.cjs","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport type { AccountsControllerState } from '@metamask/accounts-controller';\nimport {\n  StatusTypes,\n  formatChainIdToHex,\n  isEthUsdt,\n  formatChainIdToCaip,\n  formatProviderLabel,\n  isCustomSlippage,\n  getSwapType,\n  isHardwareWallet,\n  formatAddressToAssetId,\n  MetricsActionType,\n  MetricsSwapType,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type {\n  QuoteFetchData,\n  QuoteMetadata,\n  QuoteResponse,\n  TxStatusData,\n  RequestParams,\n  TradeData,\n  RequestMetadata,\n} from '@metamask/bridge-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type { TransactionMeta } from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\nimport { BigNumber } from 'bignumber.js';\n\nimport { calcActualGasUsed } from './gas';\nimport {\n  getActualBridgeReceivedAmount,\n  getActualSwapReceivedAmount,\n} from './swap-received-amount';\nimport type { BridgeHistoryItem } from '../types';\n\nexport const getTxStatusesFromHistory = ({\n  status,\n  hasApprovalTx,\n  approvalTxId,\n  quote,\n}: BridgeHistoryItem): TxStatusData => {\n  const source_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n  const destination_transaction = status.destChain?.txHash\n    ? status.status\n    : StatusTypes.PENDING;\n\n  const hexChainId = formatChainIdToHex(quote.srcChainId);\n  const isEthUsdtTx = isEthUsdt(hexChainId, quote.srcAsset.address);\n  const allowance_reset_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : undefined;\n  const approval_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n\n  return {\n    allowance_reset_transaction: isEthUsdtTx\n      ? allowance_reset_transaction\n      : undefined,\n    approval_transaction:\n      hasApprovalTx || approvalTxId ? approval_transaction : undefined,\n    source_transaction,\n    destination_transaction:\n      status.status === StatusTypes.FAILED\n        ? StatusTypes.FAILED\n        : destination_transaction,\n  };\n};\n\n/**\n * Calculate the properties for a finalized transaction event based on the txHistory\n * and txMeta\n *\n * @param historyItem - The bridge history item\n * @param txMeta - The transaction meta from the TransactionController\n * @param approvalTxMeta - The approval transaction meta from the TransactionController\n * @returns The properties for the finalized transaction\n */\nexport const getFinalizedTxProperties = (\n  historyItem: BridgeHistoryItem,\n  txMeta?: TransactionMeta,\n  approvalTxMeta?: TransactionMeta,\n) => {\n  const startTime =\n    approvalTxMeta?.submittedTime ??\n    txMeta?.submittedTime ??\n    historyItem.startTime;\n  const completionTime =\n    txMeta?.type === TransactionType.swap\n      ? txMeta?.time\n      : historyItem.completionTime;\n\n  const actualGas = calcActualGasUsed(\n    historyItem,\n    txMeta?.txReceipt,\n    approvalTxMeta?.txReceipt,\n  );\n\n  const actualReturn =\n    txMeta?.type === TransactionType.swap\n      ? getActualSwapReceivedAmount(historyItem, actualGas, txMeta)\n      : getActualBridgeReceivedAmount(historyItem);\n\n  const quotedVsUsedGasRatio =\n    historyItem.pricingData?.quotedGasAmount && actualGas?.amount\n      ? new BigNumber(historyItem.pricingData.quotedGasAmount)\n          .multipliedBy(new BigNumber(10).pow(18))\n          .div(actualGas.amount)\n          .toNumber()\n      : 0;\n\n  const quoteVsExecutionRatio =\n    historyItem.pricingData?.quotedReturnInUsd && actualReturn?.usd\n      ? new BigNumber(historyItem.pricingData.quotedReturnInUsd)\n          .div(actualReturn.usd)\n          .toNumber()\n      : 0;\n\n  return {\n    actual_time_minutes:\n      completionTime && startTime ? (completionTime - startTime) / 60000 : 0,\n    usd_actual_return: Number(actualReturn?.usd ?? 0),\n    usd_actual_gas: actualGas?.usd ?? 0,\n    quote_vs_execution_ratio: quoteVsExecutionRatio,\n    quoted_vs_used_gas_ratio: quotedVsUsedGasRatio,\n  };\n};\n\nexport const getRequestParamFromHistory = (\n  historyItem: BridgeHistoryItem,\n): RequestParams => {\n  return {\n    chain_id_source: formatChainIdToCaip(historyItem.quote.srcChainId),\n    token_symbol_source: historyItem.quote.srcAsset.symbol,\n    token_address_source: historyItem.quote.srcAsset.assetId,\n    chain_id_destination: formatChainIdToCaip(historyItem.quote.destChainId),\n    token_symbol_destination: historyItem.quote.destAsset.symbol,\n    token_address_destination: historyItem.quote.destAsset.assetId,\n  };\n};\n\nexport const getTradeDataFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(quoteResponse.gasFee?.effective?.usd ?? 0),\n    gas_included: quoteResponse.quote.gasIncluded ?? false,\n    gas_included_7702: quoteResponse.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(quoteResponse.quote),\n    quoted_time_minutes: Number(\n      quoteResponse.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(quoteResponse.adjustedReturn?.usd ?? 0),\n  };\n};\n\nexport const getPriceImpactFromQuote = (\n  quote: QuoteResponse['quote'],\n): Pick<QuoteFetchData, 'price_impact'> => {\n  return { price_impact: Number(quote.priceData?.priceImpact ?? '0') };\n};\n\n/**\n * Before the tx is confirmed, its data is not available in txHistory\n * The quote is used to populate event properties before confirmation\n *\n * @param quoteResponse - The quote response\n * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n * @param isHardwareAccount - whether the tx is submitted using a hardware wallet\n * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n * @param abTests - A/B test context to attribute events to specific experiments\n * @returns The properties for the pre-confirmation event\n */\nexport const getPreConfirmationPropertiesFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n  isStxEnabledOnClient: boolean,\n  isHardwareAccount: boolean,\n  location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n  abTests?: Record<string, string>,\n) => {\n  const { quote } = quoteResponse;\n  return {\n    ...getPriceImpactFromQuote(quote),\n    ...getTradeDataFromQuote(quoteResponse),\n    chain_id_source: formatChainIdToCaip(quote.srcChainId),\n    token_symbol_source: quote.srcAsset.symbol,\n    chain_id_destination: formatChainIdToCaip(quote.destChainId),\n    token_symbol_destination: quote.destAsset.symbol,\n    is_hardware_wallet: isHardwareAccount,\n    swap_type: getSwapType(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    ),\n    usd_amount_source: Number(quoteResponse.sentAmount?.usd ?? 0),\n    stx_enabled: isStxEnabledOnClient,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n    custom_slippage: false, // TODO detect whether the user changed the default slippage\n    location,\n    ...(abTests && Object.keys(abTests).length > 0 && { ab_tests: abTests }),\n  };\n};\n\nexport const getTradeDataFromHistory = (\n  historyItem: BridgeHistoryItem,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(historyItem.pricingData?.quotedGasInUsd ?? 0),\n    gas_included: historyItem.quote.gasIncluded ?? false,\n    gas_included_7702: historyItem.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(historyItem.quote),\n    quoted_time_minutes: Number(\n      historyItem.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(historyItem.pricingData?.quotedReturnInUsd ?? 0),\n  };\n};\n\nexport const getRequestMetadataFromHistory = (\n  historyItem: BridgeHistoryItem,\n  account?: AccountsControllerState['internalAccounts']['accounts'][string],\n): RequestMetadata => {\n  const { quote, slippagePercentage, isStxEnabled } = historyItem;\n\n  return {\n    slippage_limit: slippagePercentage,\n    custom_slippage: isCustomSlippage(slippagePercentage),\n    usd_amount_source: Number(historyItem.pricingData?.amountSentInUsd ?? 0),\n    swap_type: getSwapType(quote.srcChainId, quote.destChainId),\n    is_hardware_wallet: isHardwareWallet(account),\n    stx_enabled: isStxEnabled ?? false,\n    security_warnings: [],\n  };\n};\n\n/**\n * Get the properties for a swap transaction that is not in the txHistory\n *\n * @param transactionMeta - The transaction meta\n * @returns The properties for the swap transaction\n */\nexport const getEVMTxPropertiesFromTransactionMeta = (\n  transactionMeta: TransactionMeta,\n) => {\n  return {\n    source_transaction: [\n      TransactionStatus.failed,\n      TransactionStatus.dropped,\n      TransactionStatus.rejected,\n    ].includes(transactionMeta.status)\n      ? StatusTypes.FAILED\n      : StatusTypes.COMPLETE,\n    error_message: transactionMeta.error?.message ?? '',\n    chain_id_source: formatChainIdToCaip(transactionMeta.chainId),\n    chain_id_destination: formatChainIdToCaip(transactionMeta.chainId),\n    token_symbol_source: transactionMeta.sourceTokenSymbol ?? '',\n    token_symbol_destination: transactionMeta.destinationTokenSymbol ?? '',\n    usd_amount_source: 0,\n    stx_enabled: false,\n    token_address_source:\n      formatAddressToAssetId(\n        transactionMeta.sourceTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    token_address_destination:\n      formatAddressToAssetId(\n        transactionMeta.destinationTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    custom_slippage: false,\n    is_hardware_wallet: false,\n    swap_type:\n      transactionMeta.type &&\n      [TransactionType.swap, TransactionType.swapApproval].includes(\n        transactionMeta.type,\n      )\n        ? MetricsSwapType.SINGLE\n        : MetricsSwapType.CROSSCHAIN,\n    security_warnings: [],\n    price_impact: 0,\n    usd_quoted_gas: 0,\n    gas_included: false,\n    gas_included_7702: false,\n    quoted_time_minutes: 0,\n    usd_quoted_return: 0,\n    provider: '' as `${string}_${string}`,\n    actual_time_minutes: 0,\n    quote_vs_execution_ratio: 0,\n    quoted_vs_used_gas_ratio: 0,\n    usd_actual_return: 0,\n    usd_actual_gas: 0,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n  };\n};\n"]}
\ No newline at end of file
diff --git a/dist/utils/metrics.d.cts b/dist/utils/metrics.d.cts
index 65a52218b4a45ddc861401114092091b84388d45..c1405559205863935f7f58a0f82a6a11e592baab 100644
--- a/dist/utils/metrics.d.cts
+++ b/dist/utils/metrics.d.cts
@@ -31,9 +31,11 @@ export declare const getPriceImpactFromQuote: (quote: QuoteResponse['quote']) =>
  * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
  * @param isHardwareAccount - whether the tx is submitted using a hardware wallet
  * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+ * @param abTests - A/B test context to attribute events to specific experiments
  * @returns The properties for the pre-confirmation event
  */
-export declare const getPreConfirmationPropertiesFromQuote: (quoteResponse: QuoteResponse & Partial<QuoteMetadata>, isStxEnabledOnClient: boolean, isHardwareAccount: boolean, location?: MetaMetricsSwapsEventSource) => {
+export declare const getPreConfirmationPropertiesFromQuote: (quoteResponse: QuoteResponse & Partial<QuoteMetadata>, isStxEnabledOnClient: boolean, isHardwareAccount: boolean, location?: MetaMetricsSwapsEventSource, abTests?: Record<string, string>) => {
+    ab_tests?: Record<string, string> | undefined;
     chain_id_source: `${string}:${string}`;
     token_symbol_source: string;
     chain_id_destination: `${string}:${string}`;
diff --git a/dist/utils/metrics.d.cts.map b/dist/utils/metrics.d.cts.map
index 89ea0ec9a15870f6ed50699fa25950fdecef1c9f..5499becb1fd040bdd248276d9d092f957e26a6ba 100644
--- a/dist/utils/metrics.d.cts.map
+++ b/dist/utils/metrics.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"metrics.d.cts","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"AAGA,OAAO,KAAK,EAAE,uBAAuB,EAAE,sCAAsC;AAC7E,OAAO,EACL,WAAW,EASX,iBAAiB,EACjB,eAAe,EACf,2BAA2B,EAC5B,oCAAoC;AACrC,OAAO,KAAK,EACV,cAAc,EACd,aAAa,EACb,aAAa,EACb,YAAY,EACZ,aAAa,EACb,SAAS,EACT,eAAe,EAChB,oCAAoC;AAKrC,OAAO,KAAK,EAAE,eAAe,EAAE,yCAAyC;AASxE,OAAO,KAAK,EAAE,iBAAiB,EAAE,qBAAiB;AAElD,eAAO,MAAM,wBAAwB,oDAKlC,iBAAiB,KAAG,YA6BtB,CAAC;AAEF;;;;;;;;GAQG;AACH,eAAO,MAAM,wBAAwB,gBACtB,iBAAiB,WACrB,eAAe,mBACP,eAAe;;;;;;CA6CjC,CAAC;AAEF,eAAO,MAAM,0BAA0B,gBACxB,iBAAiB,KAC7B,aASF,CAAC;AAEF,eAAO,MAAM,qBAAqB,kBACjB,aAAa,GAAG,QAAQ,aAAa,CAAC,KACpD,SAWF,CAAC;AAEF,eAAO,MAAM,uBAAuB,UAC3B,aAAa,CAAC,OAAO,CAAC,KAC5B,KAAK,cAAc,EAAE,cAAc,CAErC,CAAC;AAEF;;;;;;;;;GASG;AACH,eAAO,MAAM,qCAAqC,kBACjC,aAAa,GAAG,QAAQ,aAAa,CAAC,wBAC/B,OAAO,qBACV,OAAO,aAChB,2BAA2B;;;;;;;;;;;;;;;;;;;CAqBtC,CAAC;AAEF,eAAO,MAAM,uBAAuB,gBACrB,iBAAiB,KAC7B,SAWF,CAAC;AAEF,eAAO,MAAM,6BAA6B,gBAC3B,iBAAiB,YACpB,uBAAuB,CAAC,kBAAkB,CAAC,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,KACxE,eAYF,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,qCAAqC,oBAC/B,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmDjC,CAAC"}
\ No newline at end of file
+{"version":3,"file":"metrics.d.cts","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"AAGA,OAAO,KAAK,EAAE,uBAAuB,EAAE,sCAAsC;AAC7E,OAAO,EACL,WAAW,EASX,iBAAiB,EACjB,eAAe,EACf,2BAA2B,EAC5B,oCAAoC;AACrC,OAAO,KAAK,EACV,cAAc,EACd,aAAa,EACb,aAAa,EACb,YAAY,EACZ,aAAa,EACb,SAAS,EACT,eAAe,EAChB,oCAAoC;AAKrC,OAAO,KAAK,EAAE,eAAe,EAAE,yCAAyC;AASxE,OAAO,KAAK,EAAE,iBAAiB,EAAE,qBAAiB;AAElD,eAAO,MAAM,wBAAwB,oDAKlC,iBAAiB,KAAG,YA6BtB,CAAC;AAEF;;;;;;;;GAQG;AACH,eAAO,MAAM,wBAAwB,gBACtB,iBAAiB,WACrB,eAAe,mBACP,eAAe;;;;;;CA6CjC,CAAC;AAEF,eAAO,MAAM,0BAA0B,gBACxB,iBAAiB,KAC7B,aASF,CAAC;AAEF,eAAO,MAAM,qBAAqB,kBACjB,aAAa,GAAG,QAAQ,aAAa,CAAC,KACpD,SAWF,CAAC;AAEF,eAAO,MAAM,uBAAuB,UAC3B,aAAa,CAAC,OAAO,CAAC,KAC5B,KAAK,cAAc,EAAE,cAAc,CAErC,CAAC;AAEF;;;;;;;;;;GAUG;AACH,eAAO,MAAM,qCAAqC,kBACjC,aAAa,GAAG,QAAQ,aAAa,CAAC,wBAC/B,OAAO,qBACV,OAAO,aAChB,2BAA2B,YAC3B,OAAO,MAAM,EAAE,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;CAsBjC,CAAC;AAEF,eAAO,MAAM,uBAAuB,gBACrB,iBAAiB,KAC7B,SAWF,CAAC;AAEF,eAAO,MAAM,6BAA6B,gBAC3B,iBAAiB,YACpB,uBAAuB,CAAC,kBAAkB,CAAC,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,KACxE,eAYF,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,qCAAqC,oBAC/B,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmDjC,CAAC"}
\ No newline at end of file
diff --git a/dist/utils/metrics.d.mts b/dist/utils/metrics.d.mts
index 0e213ea671bfc5c038a7560285f8c298b3653423..3b62247c132877d23da7fba75441899179ecf461 100644
--- a/dist/utils/metrics.d.mts
+++ b/dist/utils/metrics.d.mts
@@ -31,9 +31,11 @@ export declare const getPriceImpactFromQuote: (quote: QuoteResponse['quote']) =>
  * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
  * @param isHardwareAccount - whether the tx is submitted using a hardware wallet
  * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+ * @param abTests - A/B test context to attribute events to specific experiments
  * @returns The properties for the pre-confirmation event
  */
-export declare const getPreConfirmationPropertiesFromQuote: (quoteResponse: QuoteResponse & Partial<QuoteMetadata>, isStxEnabledOnClient: boolean, isHardwareAccount: boolean, location?: MetaMetricsSwapsEventSource) => {
+export declare const getPreConfirmationPropertiesFromQuote: (quoteResponse: QuoteResponse & Partial<QuoteMetadata>, isStxEnabledOnClient: boolean, isHardwareAccount: boolean, location?: MetaMetricsSwapsEventSource, abTests?: Record<string, string>) => {
+    ab_tests?: Record<string, string> | undefined;
     chain_id_source: `${string}:${string}`;
     token_symbol_source: string;
     chain_id_destination: `${string}:${string}`;
diff --git a/dist/utils/metrics.d.mts.map b/dist/utils/metrics.d.mts.map
index 8fdde15b2b97a8d0dd2bba7cd7c3facfdd20d381..1dbe2fdb885103944f3ffd3a48a194b497da7376 100644
--- a/dist/utils/metrics.d.mts.map
+++ b/dist/utils/metrics.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"metrics.d.mts","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"AAGA,OAAO,KAAK,EAAE,uBAAuB,EAAE,sCAAsC;AAC7E,OAAO,EACL,WAAW,EASX,iBAAiB,EACjB,eAAe,EACf,2BAA2B,EAC5B,oCAAoC;AACrC,OAAO,KAAK,EACV,cAAc,EACd,aAAa,EACb,aAAa,EACb,YAAY,EACZ,aAAa,EACb,SAAS,EACT,eAAe,EAChB,oCAAoC;AAKrC,OAAO,KAAK,EAAE,eAAe,EAAE,yCAAyC;AASxE,OAAO,KAAK,EAAE,iBAAiB,EAAE,qBAAiB;AAElD,eAAO,MAAM,wBAAwB,oDAKlC,iBAAiB,KAAG,YA6BtB,CAAC;AAEF;;;;;;;;GAQG;AACH,eAAO,MAAM,wBAAwB,gBACtB,iBAAiB,WACrB,eAAe,mBACP,eAAe;;;;;;CA6CjC,CAAC;AAEF,eAAO,MAAM,0BAA0B,gBACxB,iBAAiB,KAC7B,aASF,CAAC;AAEF,eAAO,MAAM,qBAAqB,kBACjB,aAAa,GAAG,QAAQ,aAAa,CAAC,KACpD,SAWF,CAAC;AAEF,eAAO,MAAM,uBAAuB,UAC3B,aAAa,CAAC,OAAO,CAAC,KAC5B,KAAK,cAAc,EAAE,cAAc,CAErC,CAAC;AAEF;;;;;;;;;GASG;AACH,eAAO,MAAM,qCAAqC,kBACjC,aAAa,GAAG,QAAQ,aAAa,CAAC,wBAC/B,OAAO,qBACV,OAAO,aAChB,2BAA2B;;;;;;;;;;;;;;;;;;;CAqBtC,CAAC;AAEF,eAAO,MAAM,uBAAuB,gBACrB,iBAAiB,KAC7B,SAWF,CAAC;AAEF,eAAO,MAAM,6BAA6B,gBAC3B,iBAAiB,YACpB,uBAAuB,CAAC,kBAAkB,CAAC,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,KACxE,eAYF,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,qCAAqC,oBAC/B,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmDjC,CAAC"}
\ No newline at end of file
+{"version":3,"file":"metrics.d.mts","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"AAGA,OAAO,KAAK,EAAE,uBAAuB,EAAE,sCAAsC;AAC7E,OAAO,EACL,WAAW,EASX,iBAAiB,EACjB,eAAe,EACf,2BAA2B,EAC5B,oCAAoC;AACrC,OAAO,KAAK,EACV,cAAc,EACd,aAAa,EACb,aAAa,EACb,YAAY,EACZ,aAAa,EACb,SAAS,EACT,eAAe,EAChB,oCAAoC;AAKrC,OAAO,KAAK,EAAE,eAAe,EAAE,yCAAyC;AASxE,OAAO,KAAK,EAAE,iBAAiB,EAAE,qBAAiB;AAElD,eAAO,MAAM,wBAAwB,oDAKlC,iBAAiB,KAAG,YA6BtB,CAAC;AAEF;;;;;;;;GAQG;AACH,eAAO,MAAM,wBAAwB,gBACtB,iBAAiB,WACrB,eAAe,mBACP,eAAe;;;;;;CA6CjC,CAAC;AAEF,eAAO,MAAM,0BAA0B,gBACxB,iBAAiB,KAC7B,aASF,CAAC;AAEF,eAAO,MAAM,qBAAqB,kBACjB,aAAa,GAAG,QAAQ,aAAa,CAAC,KACpD,SAWF,CAAC;AAEF,eAAO,MAAM,uBAAuB,UAC3B,aAAa,CAAC,OAAO,CAAC,KAC5B,KAAK,cAAc,EAAE,cAAc,CAErC,CAAC;AAEF;;;;;;;;;;GAUG;AACH,eAAO,MAAM,qCAAqC,kBACjC,aAAa,GAAG,QAAQ,aAAa,CAAC,wBAC/B,OAAO,qBACV,OAAO,aAChB,2BAA2B,YAC3B,OAAO,MAAM,EAAE,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;CAsBjC,CAAC;AAEF,eAAO,MAAM,uBAAuB,gBACrB,iBAAiB,KAC7B,SAWF,CAAC;AAEF,eAAO,MAAM,6BAA6B,gBAC3B,iBAAiB,YACpB,uBAAuB,CAAC,kBAAkB,CAAC,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,KACxE,eAYF,CAAC;AAEF;;;;;GAKG;AACH,eAAO,MAAM,qCAAqC,oBAC/B,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmDjC,CAAC"}
\ No newline at end of file
diff --git a/dist/utils/metrics.mjs b/dist/utils/metrics.mjs
index c4872f5dfa299ddff2afa50c56729dcfb3b42564..e80642d63726cc15ef8ed747f7fd27737eb79f48 100644
--- a/dist/utils/metrics.mjs
+++ b/dist/utils/metrics.mjs
@@ -99,9 +99,10 @@ export const getPriceImpactFromQuote = (quote) => {
  * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension
  * @param isHardwareAccount - whether the tx is submitted using a hardware wallet
  * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)
+ * @param abTests - A/B test context to attribute events to specific experiments
  * @returns The properties for the pre-confirmation event
  */
-export const getPreConfirmationPropertiesFromQuote = (quoteResponse, isStxEnabledOnClient, isHardwareAccount, location = MetaMetricsSwapsEventSource.MainView) => {
+export const getPreConfirmationPropertiesFromQuote = (quoteResponse, isStxEnabledOnClient, isHardwareAccount, location = MetaMetricsSwapsEventSource.MainView, abTests) => {
     const { quote } = quoteResponse;
     return {
         ...getPriceImpactFromQuote(quote),
@@ -117,6 +118,7 @@ export const getPreConfirmationPropertiesFromQuote = (quoteResponse, isStxEnable
         action_type: MetricsActionType.SWAPBRIDGE_V1,
         custom_slippage: false, // TODO detect whether the user changed the default slippage
         location,
+        ...(abTests && Object.keys(abTests).length > 0 && { ab_tests: abTests }),
     };
 };
 export const getTradeDataFromHistory = (historyItem) => {
diff --git a/dist/utils/metrics.mjs.map b/dist/utils/metrics.mjs.map
index e18fee0c874d13f9bd8ed85d68ee19aa3cf99cf8..3e7bb70c8e815c9cfbf95cdce0b12f60e27aa3cc 100644
--- a/dist/utils/metrics.mjs.map
+++ b/dist/utils/metrics.mjs.map
@@ -1 +1 @@
-{"version":3,"file":"metrics.mjs","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport type { AccountsControllerState } from '@metamask/accounts-controller';\nimport {\n  StatusTypes,\n  formatChainIdToHex,\n  isEthUsdt,\n  formatChainIdToCaip,\n  formatProviderLabel,\n  isCustomSlippage,\n  getSwapType,\n  isHardwareWallet,\n  formatAddressToAssetId,\n  MetricsActionType,\n  MetricsSwapType,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type {\n  QuoteFetchData,\n  QuoteMetadata,\n  QuoteResponse,\n  TxStatusData,\n  RequestParams,\n  TradeData,\n  RequestMetadata,\n} from '@metamask/bridge-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type { TransactionMeta } from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\nimport { BigNumber } from 'bignumber.js';\n\nimport { calcActualGasUsed } from './gas';\nimport {\n  getActualBridgeReceivedAmount,\n  getActualSwapReceivedAmount,\n} from './swap-received-amount';\nimport type { BridgeHistoryItem } from '../types';\n\nexport const getTxStatusesFromHistory = ({\n  status,\n  hasApprovalTx,\n  approvalTxId,\n  quote,\n}: BridgeHistoryItem): TxStatusData => {\n  const source_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n  const destination_transaction = status.destChain?.txHash\n    ? status.status\n    : StatusTypes.PENDING;\n\n  const hexChainId = formatChainIdToHex(quote.srcChainId);\n  const isEthUsdtTx = isEthUsdt(hexChainId, quote.srcAsset.address);\n  const allowance_reset_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : undefined;\n  const approval_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n\n  return {\n    allowance_reset_transaction: isEthUsdtTx\n      ? allowance_reset_transaction\n      : undefined,\n    approval_transaction:\n      hasApprovalTx || approvalTxId ? approval_transaction : undefined,\n    source_transaction,\n    destination_transaction:\n      status.status === StatusTypes.FAILED\n        ? StatusTypes.FAILED\n        : destination_transaction,\n  };\n};\n\n/**\n * Calculate the properties for a finalized transaction event based on the txHistory\n * and txMeta\n *\n * @param historyItem - The bridge history item\n * @param txMeta - The transaction meta from the TransactionController\n * @param approvalTxMeta - The approval transaction meta from the TransactionController\n * @returns The properties for the finalized transaction\n */\nexport const getFinalizedTxProperties = (\n  historyItem: BridgeHistoryItem,\n  txMeta?: TransactionMeta,\n  approvalTxMeta?: TransactionMeta,\n) => {\n  const startTime =\n    approvalTxMeta?.submittedTime ??\n    txMeta?.submittedTime ??\n    historyItem.startTime;\n  const completionTime =\n    txMeta?.type === TransactionType.swap\n      ? txMeta?.time\n      : historyItem.completionTime;\n\n  const actualGas = calcActualGasUsed(\n    historyItem,\n    txMeta?.txReceipt,\n    approvalTxMeta?.txReceipt,\n  );\n\n  const actualReturn =\n    txMeta?.type === TransactionType.swap\n      ? getActualSwapReceivedAmount(historyItem, actualGas, txMeta)\n      : getActualBridgeReceivedAmount(historyItem);\n\n  const quotedVsUsedGasRatio =\n    historyItem.pricingData?.quotedGasAmount && actualGas?.amount\n      ? new BigNumber(historyItem.pricingData.quotedGasAmount)\n          .multipliedBy(new BigNumber(10).pow(18))\n          .div(actualGas.amount)\n          .toNumber()\n      : 0;\n\n  const quoteVsExecutionRatio =\n    historyItem.pricingData?.quotedReturnInUsd && actualReturn?.usd\n      ? new BigNumber(historyItem.pricingData.quotedReturnInUsd)\n          .div(actualReturn.usd)\n          .toNumber()\n      : 0;\n\n  return {\n    actual_time_minutes:\n      completionTime && startTime ? (completionTime - startTime) / 60000 : 0,\n    usd_actual_return: Number(actualReturn?.usd ?? 0),\n    usd_actual_gas: actualGas?.usd ?? 0,\n    quote_vs_execution_ratio: quoteVsExecutionRatio,\n    quoted_vs_used_gas_ratio: quotedVsUsedGasRatio,\n  };\n};\n\nexport const getRequestParamFromHistory = (\n  historyItem: BridgeHistoryItem,\n): RequestParams => {\n  return {\n    chain_id_source: formatChainIdToCaip(historyItem.quote.srcChainId),\n    token_symbol_source: historyItem.quote.srcAsset.symbol,\n    token_address_source: historyItem.quote.srcAsset.assetId,\n    chain_id_destination: formatChainIdToCaip(historyItem.quote.destChainId),\n    token_symbol_destination: historyItem.quote.destAsset.symbol,\n    token_address_destination: historyItem.quote.destAsset.assetId,\n  };\n};\n\nexport const getTradeDataFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(quoteResponse.gasFee?.effective?.usd ?? 0),\n    gas_included: quoteResponse.quote.gasIncluded ?? false,\n    gas_included_7702: quoteResponse.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(quoteResponse.quote),\n    quoted_time_minutes: Number(\n      quoteResponse.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(quoteResponse.adjustedReturn?.usd ?? 0),\n  };\n};\n\nexport const getPriceImpactFromQuote = (\n  quote: QuoteResponse['quote'],\n): Pick<QuoteFetchData, 'price_impact'> => {\n  return { price_impact: Number(quote.priceData?.priceImpact ?? '0') };\n};\n\n/**\n * Before the tx is confirmed, its data is not available in txHistory\n * The quote is used to populate event properties before confirmation\n *\n * @param quoteResponse - The quote response\n * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n * @param isHardwareAccount - whether the tx is submitted using a hardware wallet\n * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n * @returns The properties for the pre-confirmation event\n */\nexport const getPreConfirmationPropertiesFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n  isStxEnabledOnClient: boolean,\n  isHardwareAccount: boolean,\n  location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n) => {\n  const { quote } = quoteResponse;\n  return {\n    ...getPriceImpactFromQuote(quote),\n    ...getTradeDataFromQuote(quoteResponse),\n    chain_id_source: formatChainIdToCaip(quote.srcChainId),\n    token_symbol_source: quote.srcAsset.symbol,\n    chain_id_destination: formatChainIdToCaip(quote.destChainId),\n    token_symbol_destination: quote.destAsset.symbol,\n    is_hardware_wallet: isHardwareAccount,\n    swap_type: getSwapType(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    ),\n    usd_amount_source: Number(quoteResponse.sentAmount?.usd ?? 0),\n    stx_enabled: isStxEnabledOnClient,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n    custom_slippage: false, // TODO detect whether the user changed the default slippage\n    location,\n  };\n};\n\nexport const getTradeDataFromHistory = (\n  historyItem: BridgeHistoryItem,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(historyItem.pricingData?.quotedGasInUsd ?? 0),\n    gas_included: historyItem.quote.gasIncluded ?? false,\n    gas_included_7702: historyItem.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(historyItem.quote),\n    quoted_time_minutes: Number(\n      historyItem.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(historyItem.pricingData?.quotedReturnInUsd ?? 0),\n  };\n};\n\nexport const getRequestMetadataFromHistory = (\n  historyItem: BridgeHistoryItem,\n  account?: AccountsControllerState['internalAccounts']['accounts'][string],\n): RequestMetadata => {\n  const { quote, slippagePercentage, isStxEnabled } = historyItem;\n\n  return {\n    slippage_limit: slippagePercentage,\n    custom_slippage: isCustomSlippage(slippagePercentage),\n    usd_amount_source: Number(historyItem.pricingData?.amountSentInUsd ?? 0),\n    swap_type: getSwapType(quote.srcChainId, quote.destChainId),\n    is_hardware_wallet: isHardwareWallet(account),\n    stx_enabled: isStxEnabled ?? false,\n    security_warnings: [],\n  };\n};\n\n/**\n * Get the properties for a swap transaction that is not in the txHistory\n *\n * @param transactionMeta - The transaction meta\n * @returns The properties for the swap transaction\n */\nexport const getEVMTxPropertiesFromTransactionMeta = (\n  transactionMeta: TransactionMeta,\n) => {\n  return {\n    source_transaction: [\n      TransactionStatus.failed,\n      TransactionStatus.dropped,\n      TransactionStatus.rejected,\n    ].includes(transactionMeta.status)\n      ? StatusTypes.FAILED\n      : StatusTypes.COMPLETE,\n    error_message: transactionMeta.error?.message ?? '',\n    chain_id_source: formatChainIdToCaip(transactionMeta.chainId),\n    chain_id_destination: formatChainIdToCaip(transactionMeta.chainId),\n    token_symbol_source: transactionMeta.sourceTokenSymbol ?? '',\n    token_symbol_destination: transactionMeta.destinationTokenSymbol ?? '',\n    usd_amount_source: 0,\n    stx_enabled: false,\n    token_address_source:\n      formatAddressToAssetId(\n        transactionMeta.sourceTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    token_address_destination:\n      formatAddressToAssetId(\n        transactionMeta.destinationTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    custom_slippage: false,\n    is_hardware_wallet: false,\n    swap_type:\n      transactionMeta.type &&\n      [TransactionType.swap, TransactionType.swapApproval].includes(\n        transactionMeta.type,\n      )\n        ? MetricsSwapType.SINGLE\n        : MetricsSwapType.CROSSCHAIN,\n    security_warnings: [],\n    price_impact: 0,\n    usd_quoted_gas: 0,\n    gas_included: false,\n    gas_included_7702: false,\n    quoted_time_minutes: 0,\n    usd_quoted_return: 0,\n    provider: '' as `${string}_${string}`,\n    actual_time_minutes: 0,\n    quote_vs_execution_ratio: 0,\n    quoted_vs_used_gas_ratio: 0,\n    usd_actual_return: 0,\n    usd_actual_gas: 0,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n  };\n};\n"]}
\ No newline at end of file
+{"version":3,"file":"metrics.mjs","sourceRoot":"","sources":["../../src/utils/metrics.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport type { AccountsControllerState } from '@metamask/accounts-controller';\nimport {\n  StatusTypes,\n  formatChainIdToHex,\n  isEthUsdt,\n  formatChainIdToCaip,\n  formatProviderLabel,\n  isCustomSlippage,\n  getSwapType,\n  isHardwareWallet,\n  formatAddressToAssetId,\n  MetricsActionType,\n  MetricsSwapType,\n  MetaMetricsSwapsEventSource,\n} from '@metamask/bridge-controller';\nimport type {\n  QuoteFetchData,\n  QuoteMetadata,\n  QuoteResponse,\n  TxStatusData,\n  RequestParams,\n  TradeData,\n  RequestMetadata,\n} from '@metamask/bridge-controller';\nimport {\n  TransactionStatus,\n  TransactionType,\n} from '@metamask/transaction-controller';\nimport type { TransactionMeta } from '@metamask/transaction-controller';\nimport type { CaipAssetType } from '@metamask/utils';\nimport { BigNumber } from 'bignumber.js';\n\nimport { calcActualGasUsed } from './gas';\nimport {\n  getActualBridgeReceivedAmount,\n  getActualSwapReceivedAmount,\n} from './swap-received-amount';\nimport type { BridgeHistoryItem } from '../types';\n\nexport const getTxStatusesFromHistory = ({\n  status,\n  hasApprovalTx,\n  approvalTxId,\n  quote,\n}: BridgeHistoryItem): TxStatusData => {\n  const source_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n  const destination_transaction = status.destChain?.txHash\n    ? status.status\n    : StatusTypes.PENDING;\n\n  const hexChainId = formatChainIdToHex(quote.srcChainId);\n  const isEthUsdtTx = isEthUsdt(hexChainId, quote.srcAsset.address);\n  const allowance_reset_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : undefined;\n  const approval_transaction = status.srcChain.txHash\n    ? StatusTypes.COMPLETE\n    : StatusTypes.PENDING;\n\n  return {\n    allowance_reset_transaction: isEthUsdtTx\n      ? allowance_reset_transaction\n      : undefined,\n    approval_transaction:\n      hasApprovalTx || approvalTxId ? approval_transaction : undefined,\n    source_transaction,\n    destination_transaction:\n      status.status === StatusTypes.FAILED\n        ? StatusTypes.FAILED\n        : destination_transaction,\n  };\n};\n\n/**\n * Calculate the properties for a finalized transaction event based on the txHistory\n * and txMeta\n *\n * @param historyItem - The bridge history item\n * @param txMeta - The transaction meta from the TransactionController\n * @param approvalTxMeta - The approval transaction meta from the TransactionController\n * @returns The properties for the finalized transaction\n */\nexport const getFinalizedTxProperties = (\n  historyItem: BridgeHistoryItem,\n  txMeta?: TransactionMeta,\n  approvalTxMeta?: TransactionMeta,\n) => {\n  const startTime =\n    approvalTxMeta?.submittedTime ??\n    txMeta?.submittedTime ??\n    historyItem.startTime;\n  const completionTime =\n    txMeta?.type === TransactionType.swap\n      ? txMeta?.time\n      : historyItem.completionTime;\n\n  const actualGas = calcActualGasUsed(\n    historyItem,\n    txMeta?.txReceipt,\n    approvalTxMeta?.txReceipt,\n  );\n\n  const actualReturn =\n    txMeta?.type === TransactionType.swap\n      ? getActualSwapReceivedAmount(historyItem, actualGas, txMeta)\n      : getActualBridgeReceivedAmount(historyItem);\n\n  const quotedVsUsedGasRatio =\n    historyItem.pricingData?.quotedGasAmount && actualGas?.amount\n      ? new BigNumber(historyItem.pricingData.quotedGasAmount)\n          .multipliedBy(new BigNumber(10).pow(18))\n          .div(actualGas.amount)\n          .toNumber()\n      : 0;\n\n  const quoteVsExecutionRatio =\n    historyItem.pricingData?.quotedReturnInUsd && actualReturn?.usd\n      ? new BigNumber(historyItem.pricingData.quotedReturnInUsd)\n          .div(actualReturn.usd)\n          .toNumber()\n      : 0;\n\n  return {\n    actual_time_minutes:\n      completionTime && startTime ? (completionTime - startTime) / 60000 : 0,\n    usd_actual_return: Number(actualReturn?.usd ?? 0),\n    usd_actual_gas: actualGas?.usd ?? 0,\n    quote_vs_execution_ratio: quoteVsExecutionRatio,\n    quoted_vs_used_gas_ratio: quotedVsUsedGasRatio,\n  };\n};\n\nexport const getRequestParamFromHistory = (\n  historyItem: BridgeHistoryItem,\n): RequestParams => {\n  return {\n    chain_id_source: formatChainIdToCaip(historyItem.quote.srcChainId),\n    token_symbol_source: historyItem.quote.srcAsset.symbol,\n    token_address_source: historyItem.quote.srcAsset.assetId,\n    chain_id_destination: formatChainIdToCaip(historyItem.quote.destChainId),\n    token_symbol_destination: historyItem.quote.destAsset.symbol,\n    token_address_destination: historyItem.quote.destAsset.assetId,\n  };\n};\n\nexport const getTradeDataFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(quoteResponse.gasFee?.effective?.usd ?? 0),\n    gas_included: quoteResponse.quote.gasIncluded ?? false,\n    gas_included_7702: quoteResponse.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(quoteResponse.quote),\n    quoted_time_minutes: Number(\n      quoteResponse.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(quoteResponse.adjustedReturn?.usd ?? 0),\n  };\n};\n\nexport const getPriceImpactFromQuote = (\n  quote: QuoteResponse['quote'],\n): Pick<QuoteFetchData, 'price_impact'> => {\n  return { price_impact: Number(quote.priceData?.priceImpact ?? '0') };\n};\n\n/**\n * Before the tx is confirmed, its data is not available in txHistory\n * The quote is used to populate event properties before confirmation\n *\n * @param quoteResponse - The quote response\n * @param isStxEnabledOnClient - Whether smart transactions are enabled on the client, for example the getSmartTransactionsEnabled selector value from the extension\n * @param isHardwareAccount - whether the tx is submitted using a hardware wallet\n * @param location - The entry point from which the user initiated the swap or bridge (e.g. Main View, Token View, Trending Explore)\n * @param abTests - A/B test context to attribute events to specific experiments\n * @returns The properties for the pre-confirmation event\n */\nexport const getPreConfirmationPropertiesFromQuote = (\n  quoteResponse: QuoteResponse & Partial<QuoteMetadata>,\n  isStxEnabledOnClient: boolean,\n  isHardwareAccount: boolean,\n  location: MetaMetricsSwapsEventSource = MetaMetricsSwapsEventSource.MainView,\n  abTests?: Record<string, string>,\n) => {\n  const { quote } = quoteResponse;\n  return {\n    ...getPriceImpactFromQuote(quote),\n    ...getTradeDataFromQuote(quoteResponse),\n    chain_id_source: formatChainIdToCaip(quote.srcChainId),\n    token_symbol_source: quote.srcAsset.symbol,\n    chain_id_destination: formatChainIdToCaip(quote.destChainId),\n    token_symbol_destination: quote.destAsset.symbol,\n    is_hardware_wallet: isHardwareAccount,\n    swap_type: getSwapType(\n      quoteResponse.quote.srcChainId,\n      quoteResponse.quote.destChainId,\n    ),\n    usd_amount_source: Number(quoteResponse.sentAmount?.usd ?? 0),\n    stx_enabled: isStxEnabledOnClient,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n    custom_slippage: false, // TODO detect whether the user changed the default slippage\n    location,\n    ...(abTests && Object.keys(abTests).length > 0 && { ab_tests: abTests }),\n  };\n};\n\nexport const getTradeDataFromHistory = (\n  historyItem: BridgeHistoryItem,\n): TradeData => {\n  return {\n    usd_quoted_gas: Number(historyItem.pricingData?.quotedGasInUsd ?? 0),\n    gas_included: historyItem.quote.gasIncluded ?? false,\n    gas_included_7702: historyItem.quote.gasIncluded7702 ?? false,\n    provider: formatProviderLabel(historyItem.quote),\n    quoted_time_minutes: Number(\n      historyItem.estimatedProcessingTimeInSeconds / 60,\n    ),\n    usd_quoted_return: Number(historyItem.pricingData?.quotedReturnInUsd ?? 0),\n  };\n};\n\nexport const getRequestMetadataFromHistory = (\n  historyItem: BridgeHistoryItem,\n  account?: AccountsControllerState['internalAccounts']['accounts'][string],\n): RequestMetadata => {\n  const { quote, slippagePercentage, isStxEnabled } = historyItem;\n\n  return {\n    slippage_limit: slippagePercentage,\n    custom_slippage: isCustomSlippage(slippagePercentage),\n    usd_amount_source: Number(historyItem.pricingData?.amountSentInUsd ?? 0),\n    swap_type: getSwapType(quote.srcChainId, quote.destChainId),\n    is_hardware_wallet: isHardwareWallet(account),\n    stx_enabled: isStxEnabled ?? false,\n    security_warnings: [],\n  };\n};\n\n/**\n * Get the properties for a swap transaction that is not in the txHistory\n *\n * @param transactionMeta - The transaction meta\n * @returns The properties for the swap transaction\n */\nexport const getEVMTxPropertiesFromTransactionMeta = (\n  transactionMeta: TransactionMeta,\n) => {\n  return {\n    source_transaction: [\n      TransactionStatus.failed,\n      TransactionStatus.dropped,\n      TransactionStatus.rejected,\n    ].includes(transactionMeta.status)\n      ? StatusTypes.FAILED\n      : StatusTypes.COMPLETE,\n    error_message: transactionMeta.error?.message ?? '',\n    chain_id_source: formatChainIdToCaip(transactionMeta.chainId),\n    chain_id_destination: formatChainIdToCaip(transactionMeta.chainId),\n    token_symbol_source: transactionMeta.sourceTokenSymbol ?? '',\n    token_symbol_destination: transactionMeta.destinationTokenSymbol ?? '',\n    usd_amount_source: 0,\n    stx_enabled: false,\n    token_address_source:\n      formatAddressToAssetId(\n        transactionMeta.sourceTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    token_address_destination:\n      formatAddressToAssetId(\n        transactionMeta.destinationTokenAddress ?? '',\n        transactionMeta.chainId,\n      ) ?? ('' as CaipAssetType),\n    custom_slippage: false,\n    is_hardware_wallet: false,\n    swap_type:\n      transactionMeta.type &&\n      [TransactionType.swap, TransactionType.swapApproval].includes(\n        transactionMeta.type,\n      )\n        ? MetricsSwapType.SINGLE\n        : MetricsSwapType.CROSSCHAIN,\n    security_warnings: [],\n    price_impact: 0,\n    usd_quoted_gas: 0,\n    gas_included: false,\n    gas_included_7702: false,\n    quoted_time_minutes: 0,\n    usd_quoted_return: 0,\n    provider: '' as `${string}_${string}`,\n    actual_time_minutes: 0,\n    quote_vs_execution_ratio: 0,\n    quoted_vs_used_gas_ratio: 0,\n    usd_actual_return: 0,\n    usd_actual_gas: 0,\n    action_type: MetricsActionType.SWAPBRIDGE_V1,\n  };\n};\n"]}
\ No newline at end of file
diff --git a/dist/utils/transaction.d.cts b/dist/utils/transaction.d.cts
index 7a6a4a3f6c064242fae68d2e7f42a880a5b1b09e..25887c6a26011e610180bc856708ed8fc626214f 100644
--- a/dist/utils/transaction.d.cts
+++ b/dist/utils/transaction.d.cts
@@ -277,12 +277,14 @@ export declare const findAndUpdateTransactionsInBatch: ({ messenger, updateTrans
         musdConversion?: string | undefined;
         perpsDeposit?: string | undefined;
         perpsDepositAndOrder?: string | undefined;
+        perpsRelayDeposit?: string | undefined;
         personal_sign?: string | undefined;
         predictBuy?: string | undefined;
         predictClaim?: string | undefined;
         predictDeposit?: string | undefined;
         predictSell?: string | undefined;
         predictWithdraw?: string | undefined;
+        predictRelayDeposit?: string | undefined;
         relayDeposit?: string | undefined;
         retry?: string | undefined;
         revokeDelegation?: string | undefined;
diff --git a/dist/utils/transaction.d.cts.map b/dist/utils/transaction.d.cts.map
index f18bf8b6530dac31068fac457b5b0abc585e8175..1c3a0293d824ab255a24ce1730535403d06e992d 100644
--- a/dist/utils/transaction.d.cts.map
+++ b/dist/utils/transaction.d.cts.map
@@ -1 +1 @@
-{"version":3,"file":"transaction.d.cts","sourceRoot":"","sources":["../../src/utils/transaction.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"transaction.d.cts","sourceRoot":"","sources":["../../src/utils/transaction.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/utils/transaction.d.mts b/dist/utils/transaction.d.mts
index 8b36b50cb9e63833a8d83e42ef7a59cddddfa2c7..e854caaa860998409fb2f1d63b6809f2c774caa5 100644
--- a/dist/utils/transaction.d.mts
+++ b/dist/utils/transaction.d.mts
@@ -277,12 +277,14 @@ export declare const findAndUpdateTransactionsInBatch: ({ messenger, updateTrans
         musdConversion?: string | undefined;
         perpsDeposit?: string | undefined;
         perpsDepositAndOrder?: string | undefined;
+        perpsRelayDeposit?: string | undefined;
         personal_sign?: string | undefined;
         predictBuy?: string | undefined;
         predictClaim?: string | undefined;
         predictDeposit?: string | undefined;
         predictSell?: string | undefined;
         predictWithdraw?: string | undefined;
+        predictRelayDeposit?: string | undefined;
         relayDeposit?: string | undefined;
         retry?: string | undefined;
         revokeDelegation?: string | undefined;
diff --git a/dist/utils/transaction.d.mts.map b/dist/utils/transaction.d.mts.map
index c710fdda891c1ba202ecf36323843783b24e7eb6..c28bb07128d7852088711a99ab91dc9b1dad33ec 100644
--- a/dist/utils/transaction.d.mts.map
+++ b/dist/utils/transaction.d.mts.map
@@ -1 +1 @@
-{"version":3,"file":"transaction.d.mts","sourceRoot":"","sources":["../../src/utils/transaction.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"transaction.d.mts","sourceRoot":"","sources":["../../src/utils/transaction.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
